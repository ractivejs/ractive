{"version":3,"file":"ractive.runtime.min.js","sources":["ractive.runtime.js"],"sourcesContent":["/*\n\tRactive.js v0.8.0-edge\n\tThu Jun 09 2016 03:41:28 GMT+0000 (UTC) - commit d2a4bee5ab6b1dcc6802cf63606e1c5501872561\n\n\thttp://ractivejs.org\n\thttp://twitter.com/RactiveJS\n\n\tReleased under the MIT License.\n*/\n\n\n(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n  typeof define === 'function' && define.amd ? define(factory) :\n  ((function() { var current = global.Ractive; var next = factory(); next.noConflict = function() { global.Ractive = current; return next; }; return global.Ractive = next; })());\n}(this, function () { 'use strict';\n\n  var defaults = {\n  \t// render placement:\n  \tel:                     void 0,\n  \tappend:\t\t\t\t    false,\n\n  \t// template:\n  \ttemplate:               null,\n\n  \t// parse:\n  \tdelimiters:             [ '{{', '}}' ],\n  \ttripleDelimiters:       [ '{{{', '}}}' ],\n  \tstaticDelimiters:       [ '[[', ']]' ],\n  \tstaticTripleDelimiters: [ '[[[', ']]]' ],\n  \tcsp: \t\t\t\t\ttrue,\n  \tinterpolate:            false,\n  \tpreserveWhitespace:     false,\n  \tsanitize:               false,\n  \tstripComments:          true,\n\n  \t// data & binding:\n  \tdata:                   {},\n  \tcomputed:               {},\n  \tmagic:                  false,\n  \tmodifyArrays:           true,\n  \tadapt:                  [],\n  \tisolated:               false,\n  \ttwoway:                 true,\n  \tlazy:                   false,\n\n  \t// transitions:\n  \tnoIntro:                false,\n  \ttransitionsEnabled:     true,\n  \tcomplete:               void 0,\n\n  \t// css:\n  \tcss:                    null,\n  \tnoCssTransform:         false\n  };\n\n  // These are a subset of the easing equations found at\n  // https://raw.github.com/danro/easing-js - license info\n  // follows:\n\n  // --------------------------------------------------\n  // easing.js v0.5.4\n  // Generic set of easing functions with AMD support\n  // https://github.com/danro/easing-js\n  // This code may be freely distributed under the MIT license\n  // http://danro.mit-license.org/\n  // --------------------------------------------------\n  // All functions adapted from Thomas Fuchs & Jeremy Kahn\n  // Easing Equations (c) 2003 Robert Penner, BSD license\n  // https://raw.github.com/danro/easing-js/master/LICENSE\n  // --------------------------------------------------\n\n  // In that library, the functions named easeIn, easeOut, and\n  // easeInOut below are named easeInCubic, easeOutCubic, and\n  // (you guessed it) easeInOutCubic.\n  //\n  // You can add additional easing functions to this list, and they\n  // will be globally available.\n\n\n  var easing = {\n  \tlinear: function ( pos ) { return pos; },\n  \teaseIn: function ( pos ) { return Math.pow( pos, 3 ); },\n  \teaseOut: function ( pos ) { return ( Math.pow( ( pos - 1 ), 3 ) + 1 ); },\n  \teaseInOut: function ( pos ) {\n  \t\tif ( ( pos /= 0.5 ) < 1 ) { return ( 0.5 * Math.pow( pos, 3 ) ); }\n  \t\treturn ( 0.5 * ( Math.pow( ( pos - 2 ), 3 ) + 2 ) );\n  \t}\n  };\n\n  var legacy = null;\n\n  /*global console, navigator */\n\n  var win = typeof window !== 'undefined' ? window : null;\n  var doc = win ? document : null;\n\n  var isClient = !!doc;\n  var isJsdom = ( typeof navigator !== 'undefined' && /jsDom/.test( navigator.appName ) );\n  var hasConsole = ( typeof console !== 'undefined' && typeof console.warn === 'function' && typeof console.warn.apply === 'function' );\n\n  var magicSupported;\n  try {\n  \tObject.defineProperty({}, 'test', { value: 0 });\n  \tmagicSupported = true;\n  } catch ( e ) {\n  \tmagicSupported = false;\n  }\n\n  var svg = doc ?\n  \tdoc.implementation.hasFeature( 'http://www.w3.org/TR/SVG11/feature#BasicStructure', '1.1' ) :\n  \tfalse;\n\n  var vendors = [ 'o', 'ms', 'moz', 'webkit' ];\n\n  var html   = 'http://www.w3.org/1999/xhtml';\n  var mathml = 'http://www.w3.org/1998/Math/MathML';\n  var svg$1    = 'http://www.w3.org/2000/svg';\n  var xlink  = 'http://www.w3.org/1999/xlink';\n  var xml    = 'http://www.w3.org/XML/1998/namespace';\n  var xmlns  = 'http://www.w3.org/2000/xmlns';\n\n  var namespaces = { html: html, mathml: mathml, svg: svg$1, xlink: xlink, xml: xml, xmlns: xmlns };\n\n  var createElement;\n  var matches;\n  var div;\n  var methodNames;\n  var unprefixed;\n  var prefixed;\n  var i;\n  var j;\n  var makeFunction;\n  // Test for SVG support\n  if ( !svg ) {\n  \tcreateElement = function ( type, ns, extend ) {\n  \t\tif ( ns && ns !== html ) {\n  \t\t\tthrow 'This browser does not support namespaces other than http://www.w3.org/1999/xhtml. The most likely cause of this error is that you\\'re trying to render SVG in an older browser. See http://docs.ractivejs.org/latest/svg-and-older-browsers for more information';\n  \t\t}\n\n  \t\treturn extend ?\n  \t\t\tdoc.createElement( type, extend ) :\n  \t\t\tdoc.createElement( type );\n  \t};\n  } else {\n  \tcreateElement = function ( type, ns, extend ) {\n  \t\tif ( !ns || ns === html ) {\n  \t\t\treturn extend ?\n  \t\t\t\tdoc.createElement( type, extend ) :\n  \t\t\t\tdoc.createElement( type );\n  \t\t}\n\n  \t\treturn extend ?\n  \t\t\tdoc.createElementNS( ns, type, extend ) :\n  \t\t\tdoc.createElementNS( ns, type );\n  \t};\n  }\n\n  function createDocumentFragment () {\n  \treturn doc.createDocumentFragment();\n  }\n\n  function getElement ( input ) {\n  \tvar output;\n\n  \tif ( !input || typeof input === 'boolean' ) { return; }\n\n  \tif ( !win || !doc || !input ) {\n  \t\treturn null;\n  \t}\n\n  \t// We already have a DOM node - no work to do. (Duck typing alert!)\n  \tif ( input.nodeType ) {\n  \t\treturn input;\n  \t}\n\n  \t// Get node from string\n  \tif ( typeof input === 'string' ) {\n  \t\t// try ID first\n  \t\toutput = doc.getElementById( input );\n\n  \t\t// then as selector, if possible\n  \t\tif ( !output && doc.querySelector ) {\n  \t\t\toutput = doc.querySelector( input );\n  \t\t}\n\n  \t\t// did it work?\n  \t\tif ( output && output.nodeType ) {\n  \t\t\treturn output;\n  \t\t}\n  \t}\n\n  \t// If we've been given a collection (jQuery, Zepto etc), extract the first item\n  \tif ( input[0] && input[0].nodeType ) {\n  \t\treturn input[0];\n  \t}\n\n  \treturn null;\n  }\n\n  if ( !isClient ) {\n  \tmatches = null;\n  } else {\n  \tdiv = createElement( 'div' );\n  \tmethodNames = [ 'matches', 'matchesSelector' ];\n\n  \tmakeFunction = function ( methodName ) {\n  \t\treturn function ( node, selector ) {\n  \t\t\treturn node[ methodName ]( selector );\n  \t\t};\n  \t};\n\n  \ti = methodNames.length;\n\n  \twhile ( i-- && !matches ) {\n  \t\tunprefixed = methodNames[i];\n\n  \t\tif ( div[ unprefixed ] ) {\n  \t\t\tmatches = makeFunction( unprefixed );\n  \t\t} else {\n  \t\t\tj = vendors.length;\n  \t\t\twhile ( j-- ) {\n  \t\t\t\tprefixed = vendors[i] + unprefixed.substr( 0, 1 ).toUpperCase() + unprefixed.substring( 1 );\n\n  \t\t\t\tif ( div[ prefixed ] ) {\n  \t\t\t\t\tmatches = makeFunction( prefixed );\n  \t\t\t\t\tbreak;\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \t// IE8...\n  \tif ( !matches ) {\n  \t\tmatches = function ( node, selector ) {\n  \t\t\tvar nodes, parentNode, i;\n\n  \t\t\tparentNode = node.parentNode;\n\n  \t\t\tif ( !parentNode ) {\n  \t\t\t\t// empty dummy <div>\n  \t\t\t\tdiv.innerHTML = '';\n\n  \t\t\t\tparentNode = div;\n  \t\t\t\tnode = node.cloneNode();\n\n  \t\t\t\tdiv.appendChild( node );\n  \t\t\t}\n\n  \t\t\tnodes = parentNode.querySelectorAll( selector );\n\n  \t\t\ti = nodes.length;\n  \t\t\twhile ( i-- ) {\n  \t\t\t\tif ( nodes[i] === node ) {\n  \t\t\t\t\treturn true;\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\treturn false;\n  \t\t};\n  \t}\n  }\n\n  function detachNode ( node ) {\n  \tif ( node && typeof node.parentNode !== 'unknown' && node.parentNode ) {\n  \t\tnode.parentNode.removeChild( node );\n  \t}\n\n  \treturn node;\n  }\n\n  function safeToStringValue ( value ) {\n  \treturn ( value == null || !value.toString ) ? '' : '' + value;\n  }\n\n  function safeAttributeString ( string ) {\n  \treturn safeToStringValue( string )\n  \t\t.replace( /&/g, '&amp;' )\n  \t\t.replace( /\"/g, '&quot;' )\n  \t\t.replace( /'/g, '&#39;' );\n  }\n\n  var camel = /(-.)/g;\n  function camelize ( string ) {\n  \treturn string.replace( camel, function ( s ) { return s.charAt( 1 ).toUpperCase(); } );\n  }\n\n  var decamel = /[A-Z]/g;\n  function decamelize ( string ) {\n  \treturn string.replace( decamel, function ( s ) { return (\"-\" + (s.toLowerCase())); } );\n  }\n\n  var create;\n  var defineProperty;\n  var defineProperties;\n  try {\n  \tObject.defineProperty({}, 'test', { get: function() {}, set: function() {} });\n\n  \tif ( doc ) {\n  \t\tObject.defineProperty( createElement( 'div' ), 'test', { value: 0 });\n  \t}\n\n  \tdefineProperty = Object.defineProperty;\n  } catch ( err ) {\n  \t// Object.defineProperty doesn't exist, or we're in IE8 where you can\n  \t// only use it with DOM objects (what were you smoking, MSFT?)\n  \tdefineProperty = function ( obj, prop, desc ) {\n  \t\tif ( desc.get ) obj[ prop ] = desc.get();\n  \t\telse obj[ prop ] = desc.value;\n  \t};\n  }\n\n  try {\n  \ttry {\n  \t\tObject.defineProperties({}, { test: { value: 0 } });\n  \t} catch ( err ) {\n  \t\t// TODO how do we account for this? noMagic = true;\n  \t\tthrow err;\n  \t}\n\n  \tif ( doc ) {\n  \t\tObject.defineProperties( createElement( 'div' ), { test: { value: 0 } });\n  \t}\n\n  \tdefineProperties = Object.defineProperties;\n  } catch ( err ) {\n  \tdefineProperties = function ( obj, props ) {\n  \t\tvar prop;\n\n  \t\tfor ( prop in props ) {\n  \t\t\tif ( props.hasOwnProperty( prop ) ) {\n  \t\t\t\tdefineProperty( obj, prop, props[ prop ] );\n  \t\t\t}\n  \t\t}\n  \t};\n  }\n\n  try {\n  \tObject.create( null );\n\n  \tcreate = Object.create;\n  } catch ( err ) {\n  \t// sigh\n  \tcreate = (function () {\n  \t\tvar F = function () {};\n\n  \t\treturn function ( proto, props ) {\n  \t\t\tvar obj;\n\n  \t\t\tif ( proto === null ) {\n  \t\t\t\treturn {};\n  \t\t\t}\n\n  \t\t\tF.prototype = proto;\n  \t\t\tobj = new F();\n\n  \t\t\tif ( props ) {\n  \t\t\t\tObject.defineProperties( obj, props );\n  \t\t\t}\n\n  \t\t\treturn obj;\n  \t\t};\n  \t}());\n  }\n\n  function extendObj ( target ) {\n  \tvar sources = [], len = arguments.length - 1;\n  \twhile ( len-- > 0 ) sources[ len ] = arguments[ len + 1 ];\n\n  \tvar prop;\n\n  \tsources.forEach( function ( source ) {\n  \t\tfor ( prop in source ) {\n  \t\t\tif ( hasOwn.call( source, prop ) ) {\n  \t\t\t\ttarget[ prop ] = source[ prop ];\n  \t\t\t}\n  \t\t}\n  \t});\n\n  \treturn target;\n  }\n\n  function fillGaps ( target ) {\n  \tvar sources = [], len = arguments.length - 1;\n  \twhile ( len-- > 0 ) sources[ len ] = arguments[ len + 1 ];\n\n  \tsources.forEach( function ( s ) {\n  \t\tfor ( var key in s ) {\n  \t\t\tif ( hasOwn.call( s, key ) && !( key in target ) ) {\n  \t\t\t\ttarget[ key ] = s[ key ];\n  \t\t\t}\n  \t\t}\n  \t});\n\n  \treturn target;\n  }\n\n  var hasOwn = Object.prototype.hasOwnProperty;\n\n  var toString = Object.prototype.toString;\n  // thanks, http://perfectionkills.com/instanceof-considered-harmful-or-how-to-write-a-robust-isarray/\n  function isArray ( thing ) {\n  \treturn toString.call( thing ) === '[object Array]';\n  }\n\n  function isEqual ( a, b ) {\n  \tif ( a === null && b === null ) {\n  \t\treturn true;\n  \t}\n\n  \tif ( typeof a === 'object' || typeof b === 'object' ) {\n  \t\treturn false;\n  \t}\n\n  \treturn a === b;\n  }\n\n  // http://stackoverflow.com/questions/18082/validate-numbers-in-javascript-isnumeric\n  function isNumeric ( thing ) {\n  \treturn !isNaN( parseFloat( thing ) ) && isFinite( thing );\n  }\n\n  function isObject ( thing ) {\n  \treturn ( thing && toString.call( thing ) === '[object Object]' );\n  }\n\n  function noop () {}\n\n  var alreadyWarned = {};\n  var log;\n  var printWarning;\n  var welcome;\n  if ( hasConsole ) {\n  \tvar welcomeIntro = [\n  \t\t(\"%cRactive.js %c0.8.0-edge %cin debug mode, %cmore...\"),\n  \t\t'color: rgb(114, 157, 52); font-weight: normal;',\n  \t\t'color: rgb(85, 85, 85); font-weight: normal;',\n  \t\t'color: rgb(85, 85, 85); font-weight: normal;',\n  \t\t'color: rgb(82, 140, 224); font-weight: normal; text-decoration: underline;'\n  \t];\n  \tvar welcomeMessage = \"You're running Ractive 0.8.0-edge in debug mode - messages will be printed to the console to help you fix problems and optimise your application.\\n\\nTo disable debug mode, add this line at the start of your app:\\n  Ractive.DEBUG = false;\\n\\nTo disable debug mode when your app is minified, add this snippet:\\n  Ractive.DEBUG = /unminified/.test(function(){/*unminified*/});\\n\\nGet help and support:\\n  http://docs.ractivejs.org\\n  http://stackoverflow.com/questions/tagged/ractivejs\\n  http://groups.google.com/forum/#!forum/ractive-js\\n  http://twitter.com/ractivejs\\n\\nFound a bug? Raise an issue:\\n  https://github.com/ractivejs/ractive/issues\\n\\n\";\n\n  \twelcome = function () {\n  \t\tvar hasGroup = !!console.groupCollapsed;\n  \t\tconsole[ hasGroup ? 'groupCollapsed' : 'log' ].apply( console, welcomeIntro );\n  \t\tconsole.log( welcomeMessage );\n  \t\tif ( hasGroup ) {\n  \t\t\tconsole.groupEnd( welcomeIntro );\n  \t\t}\n\n  \t\twelcome = noop;\n  \t};\n\n  \tprintWarning = function ( message, args ) {\n  \t\twelcome();\n\n  \t\t// extract information about the instance this message pertains to, if applicable\n  \t\tif ( typeof args[ args.length - 1 ] === 'object' ) {\n  \t\t\tvar options = args.pop();\n  \t\t\tvar ractive = options ? options.ractive : null;\n\n  \t\t\tif ( ractive ) {\n  \t\t\t\t// if this is an instance of a component that we know the name of, add\n  \t\t\t\t// it to the message\n  \t\t\t\tvar name;\n  \t\t\t\tif ( ractive.component && ( name = ractive.component.name ) ) {\n  \t\t\t\t\tmessage = \"<\" + name + \"> \" + message;\n  \t\t\t\t}\n\n  \t\t\t\tvar node;\n  \t\t\t\tif ( node = ( options.node || ( ractive.fragment && ractive.fragment.rendered && ractive.find( '*' ) ) ) ) {\n  \t\t\t\t\targs.push( node );\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\tconsole.warn.apply( console, [ '%cRactive.js: %c' + message, 'color: rgb(114, 157, 52);', 'color: rgb(85, 85, 85);' ].concat( args ) );\n  \t};\n\n  \tlog = function () {\n  \t\tconsole.log.apply( console, arguments );\n  \t};\n  } else {\n  \tprintWarning = log = welcome = noop;\n  }\n\n  function format ( message, args ) {\n  \treturn message.replace( /%s/g, function () { return args.shift(); } );\n  }\n\n  function fatal ( message ) {\n  \tvar args = [], len = arguments.length - 1;\n  \twhile ( len-- > 0 ) args[ len ] = arguments[ len + 1 ];\n\n  \tmessage = format( message, args );\n  \tthrow new Error( message );\n  }\n\n  function logIfDebug () {\n  \tif ( Ractive.DEBUG ) {\n  \t\tlog.apply( null, arguments );\n  \t}\n  }\n\n  function warn ( message ) {\n  \tvar args = [], len = arguments.length - 1;\n  \twhile ( len-- > 0 ) args[ len ] = arguments[ len + 1 ];\n\n  \tmessage = format( message, args );\n  \tprintWarning( message, args );\n  }\n\n  function warnOnce ( message ) {\n  \tvar args = [], len = arguments.length - 1;\n  \twhile ( len-- > 0 ) args[ len ] = arguments[ len + 1 ];\n\n  \tmessage = format( message, args );\n\n  \tif ( alreadyWarned[ message ] ) {\n  \t\treturn;\n  \t}\n\n  \talreadyWarned[ message ] = true;\n  \tprintWarning( message, args );\n  }\n\n  function warnIfDebug () {\n  \tif ( Ractive.DEBUG ) {\n  \t\twarn.apply( null, arguments );\n  \t}\n  }\n\n  function warnOnceIfDebug () {\n  \tif ( Ractive.DEBUG ) {\n  \t\twarnOnce.apply( null, arguments );\n  \t}\n  }\n\n  // Error messages that are used (or could be) in multiple places\n  var badArguments = 'Bad arguments';\n  var noRegistryFunctionReturn = 'A function was specified for \"%s\" %s, but no %s was returned';\n  var missingPlugin = function ( name, type ) { return (\"Missing \\\"\" + name + \"\\\" \" + type + \" plugin. You may need to download a plugin via http://docs.ractivejs.org/latest/plugins#\" + type + \"s\"); };\n\n  function findInViewHierarchy ( registryName, ractive, name ) {\n  \tvar instance = findInstance( registryName, ractive, name );\n  \treturn instance ? instance[ registryName ][ name ] : null;\n  }\n\n  function findInstance ( registryName, ractive, name ) {\n  \twhile ( ractive ) {\n  \t\tif ( name in ractive[ registryName ] ) {\n  \t\t\treturn ractive;\n  \t\t}\n\n  \t\tif ( ractive.isolated ) {\n  \t\t\treturn null;\n  \t\t}\n\n  \t\tractive = ractive.parent;\n  \t}\n  }\n\n  function interpolate ( from, to, ractive, type ) {\n  \tif ( from === to ) return null;\n\n  \tif ( type ) {\n  \t\tvar interpol = findInViewHierarchy( 'interpolators', ractive, type );\n  \t\tif ( interpol ) return interpol( from, to ) || null;\n\n  \t\tfatal( missingPlugin( type, 'interpolator' ) );\n  \t}\n\n  \treturn interpolators.number( from, to ) ||\n  \t       interpolators.array( from, to ) ||\n  \t       interpolators.object( from, to ) ||\n  \t       null;\n  }\n\n  function snap ( to ) {\n  \treturn function () { return to; };\n  }\n\n  var interpolators = {\n  \tnumber: function ( from, to ) {\n  \t\tvar delta;\n\n  \t\tif ( !isNumeric( from ) || !isNumeric( to ) ) {\n  \t\t\treturn null;\n  \t\t}\n\n  \t\tfrom = +from;\n  \t\tto = +to;\n\n  \t\tdelta = to - from;\n\n  \t\tif ( !delta ) {\n  \t\t\treturn function () { return from; };\n  \t\t}\n\n  \t\treturn function ( t ) {\n  \t\t\treturn from + ( t * delta );\n  \t\t};\n  \t},\n\n  \tarray: function ( from, to ) {\n  \t\tvar intermediate, interpolators, len, i;\n\n  \t\tif ( !isArray( from ) || !isArray( to ) ) {\n  \t\t\treturn null;\n  \t\t}\n\n  \t\tintermediate = [];\n  \t\tinterpolators = [];\n\n  \t\ti = len = Math.min( from.length, to.length );\n  \t\twhile ( i-- ) {\n  \t\t\tinterpolators[i] = interpolate( from[i], to[i] );\n  \t\t}\n\n  \t\t// surplus values - don't interpolate, but don't exclude them either\n  \t\tfor ( i=len; i<from.length; i+=1 ) {\n  \t\t\tintermediate[i] = from[i];\n  \t\t}\n\n  \t\tfor ( i=len; i<to.length; i+=1 ) {\n  \t\t\tintermediate[i] = to[i];\n  \t\t}\n\n  \t\treturn function ( t ) {\n  \t\t\tvar i = len;\n\n  \t\t\twhile ( i-- ) {\n  \t\t\t\tintermediate[i] = interpolators[i]( t );\n  \t\t\t}\n\n  \t\t\treturn intermediate;\n  \t\t};\n  \t},\n\n  \tobject: function ( from, to ) {\n  \t\tvar properties, len, interpolators, intermediate, prop;\n\n  \t\tif ( !isObject( from ) || !isObject( to ) ) {\n  \t\t\treturn null;\n  \t\t}\n\n  \t\tproperties = [];\n  \t\tintermediate = {};\n  \t\tinterpolators = {};\n\n  \t\tfor ( prop in from ) {\n  \t\t\tif ( hasOwn.call( from, prop ) ) {\n  \t\t\t\tif ( hasOwn.call( to, prop ) ) {\n  \t\t\t\t\tproperties.push( prop );\n  \t\t\t\t\tinterpolators[ prop ] = interpolate( from[ prop ], to[ prop ] ) || snap( to[ prop ] );\n  \t\t\t\t}\n\n  \t\t\t\telse {\n  \t\t\t\t\tintermediate[ prop ] = from[ prop ];\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\tfor ( prop in to ) {\n  \t\t\tif ( hasOwn.call( to, prop ) && !hasOwn.call( from, prop ) ) {\n  \t\t\t\tintermediate[ prop ] = to[ prop ];\n  \t\t\t}\n  \t\t}\n\n  \t\tlen = properties.length;\n\n  \t\treturn function ( t ) {\n  \t\t\tvar i = len, prop;\n\n  \t\t\twhile ( i-- ) {\n  \t\t\t\tprop = properties[i];\n\n  \t\t\t\tintermediate[ prop ] = interpolators[ prop ]( t );\n  \t\t\t}\n\n  \t\t\treturn intermediate;\n  \t\t};\n  \t}\n  };\n\n  var refPattern = /\\[\\s*(\\*|[0-9]|[1-9][0-9]+)\\s*\\]/g;\n  var splitPattern = /([^\\\\](?:\\\\\\\\)*)\\./;\n  var escapeKeyPattern = /\\\\|\\./g;\n  var unescapeKeyPattern = /((?:\\\\)+)\\1|\\\\(\\.)/g;\n\n  function escapeKey ( key ) {\n  \tif ( typeof key === 'string' ) {\n  \t\treturn key.replace( escapeKeyPattern, '\\\\$&' );\n  \t}\n\n  \treturn key;\n  }\n\n  function normalise ( ref ) {\n  \treturn ref ? ref.replace( refPattern, '.$1' ) : '';\n  }\n\n  function splitKeypathI ( keypath ) {\n  \tvar result = [],\n  \t\tmatch;\n\n  \tkeypath = normalise( keypath );\n\n  \twhile ( match = splitPattern.exec( keypath ) ) {\n  \t\tvar index = match.index + match[1].length;\n  \t\tresult.push( keypath.substr( 0, index ) );\n  \t\tkeypath = keypath.substr( index + 1 );\n  \t}\n\n  \tresult.push(keypath);\n\n  \treturn result;\n  }\n\n  function unescapeKey ( key ) {\n  \tif ( typeof key === 'string' ) {\n  \t\treturn key.replace( unescapeKeyPattern, '$1$2' );\n  \t}\n\n  \treturn key;\n  }\n\n  var errorMessage = 'Cannot add to a non-numeric value';\n\n  function add ( ractive, keypath, d ) {\n  \tif ( typeof keypath !== 'string' || !isNumeric( d ) ) {\n  \t\tthrow new Error( 'Bad arguments' );\n  \t}\n\n  \tvar changes;\n\n  \tif ( /\\*/.test( keypath ) ) {\n  \t\tchanges = {};\n\n  \t\tractive.viewmodel.findMatches( splitKeypathI( keypath ) ).forEach( function ( model ) {\n  \t\t\tvar value = model.get();\n\n  \t\t\tif ( !isNumeric( value ) ) throw new Error( errorMessage );\n\n  \t\t\tchanges[ model.getKeypath() ] = value + d;\n  \t\t});\n\n  \t\treturn ractive.set( changes );\n  \t}\n\n  \tvar value = ractive.get( keypath );\n\n  \tif ( !isNumeric( value ) ) {\n  \t\tthrow new Error( errorMessage );\n  \t}\n\n  \treturn ractive.set( keypath, +value + d );\n  }\n\n  function Ractive$add ( keypath, d ) {\n  \treturn add( this, keypath, ( d === undefined ? 1 : +d ) );\n  }\n\n  // TODO: deprecate in future release\n  var deprecations = {\n  \tconstruct: {\n  \t\tdeprecated: 'beforeInit',\n  \t\treplacement: 'onconstruct'\n  \t},\n  \trender: {\n  \t\tdeprecated: 'init',\n  \t\tmessage: 'The \"init\" method has been deprecated ' +\n  \t\t\t'and will likely be removed in a future release. ' +\n  \t\t\t'You can either use the \"oninit\" method which will fire ' +\n  \t\t\t'only once prior to, and regardless of, any eventual ractive ' +\n  \t\t\t'instance being rendered, or if you need to access the ' +\n  \t\t\t'rendered DOM, use \"onrender\" instead. ' +\n  \t\t\t'See http://docs.ractivejs.org/latest/migrating for more information.'\n  \t},\n  \tcomplete: {\n  \t\tdeprecated: 'complete',\n  \t\treplacement: 'oncomplete'\n  \t}\n  };\n\n  var Hook = function Hook ( event ) {\n  \tthis.event = event;\n  \tthis.method = 'on' + event;\n  \tthis.deprecate = deprecations[ event ];\n  };\n\n  Hook.prototype.call = function call ( method, ractive, arg ) {\n  \tif ( ractive[ method ] ) {\n  \t\targ ? ractive[ method ]( arg ) : ractive[ method ]();\n  \t\treturn true;\n  \t}\n  };\n\n  Hook.prototype.fire = function fire ( ractive, arg ) {\n  \tthis.call( this.method, ractive, arg );\n\n  \t// handle deprecations\n  \tif ( !ractive[ this.method ] && this.deprecate && this.call( this.deprecate.deprecated, ractive, arg ) ) {\n  \t\tif ( this.deprecate.message ) {\n  \t\t\twarnIfDebug( this.deprecate.message );\n  \t\t} else {\n  \t\t\twarnIfDebug( 'The method \"%s\" has been deprecated in favor of \"%s\" and will likely be removed in a future release. See http://docs.ractivejs.org/latest/migrating for more information.', this.deprecate.deprecated, this.deprecate.replacement );\n  \t\t}\n  \t}\n\n  \t// TODO should probably use internal method, in case ractive.fire was overwritten\n  \targ ? ractive.fire( this.event, arg ) : ractive.fire( this.event );\n  };\n\n  function addToArray ( array, value ) {\n  \tvar index = array.indexOf( value );\n\n  \tif ( index === -1 ) {\n  \t\tarray.push( value );\n  \t}\n  }\n\n  function arrayContains ( array, value ) {\n  \tfor ( var i = 0, c = array.length; i < c; i++ ) {\n  \t\tif ( array[i] == value ) {\n  \t\t\treturn true;\n  \t\t}\n  \t}\n\n  \treturn false;\n  }\n\n  function arrayContentsMatch ( a, b ) {\n  \tvar i;\n\n  \tif ( !isArray( a ) || !isArray( b ) ) {\n  \t\treturn false;\n  \t}\n\n  \tif ( a.length !== b.length ) {\n  \t\treturn false;\n  \t}\n\n  \ti = a.length;\n  \twhile ( i-- ) {\n  \t\tif ( a[i] !== b[i] ) {\n  \t\t\treturn false;\n  \t\t}\n  \t}\n\n  \treturn true;\n  }\n\n  function ensureArray ( x ) {\n  \tif ( typeof x === 'string' ) {\n  \t\treturn [ x ];\n  \t}\n\n  \tif ( x === undefined ) {\n  \t\treturn [];\n  \t}\n\n  \treturn x;\n  }\n\n  function lastItem ( array ) {\n  \treturn array[ array.length - 1 ];\n  }\n\n  function removeFromArray ( array, member ) {\n  \tif ( !array ) {\n  \t\treturn;\n  \t}\n\n  \tvar index = array.indexOf( member );\n\n  \tif ( index !== -1 ) {\n  \t\tarray.splice( index, 1 );\n  \t}\n  }\n\n  function toArray ( arrayLike ) {\n  \tvar array = [], i = arrayLike.length;\n  \twhile ( i-- ) {\n  \t\tarray[i] = arrayLike[i];\n  \t}\n\n  \treturn array;\n  }\n\n  var _Promise;\n  var PENDING = {};\n  var FULFILLED = {};\n  var REJECTED = {};\n  if ( typeof Promise === 'function' ) {\n  \t// use native Promise\n  \t_Promise = Promise;\n  } else {\n  \t_Promise = function ( callback ) {\n  \t\tvar fulfilledHandlers = [],\n  \t\t\trejectedHandlers = [],\n  \t\t\tstate = PENDING,\n\n  \t\t\tresult,\n  \t\t\tdispatchHandlers,\n  \t\t\tmakeResolver,\n  \t\t\tfulfil,\n  \t\t\treject,\n\n  \t\t\tpromise;\n\n  \t\tmakeResolver = function ( newState ) {\n  \t\t\treturn function ( value ) {\n  \t\t\t\tif ( state !== PENDING ) {\n  \t\t\t\t\treturn;\n  \t\t\t\t}\n\n  \t\t\t\tresult = value;\n  \t\t\t\tstate = newState;\n\n  \t\t\t\tdispatchHandlers = makeDispatcher( ( state === FULFILLED ? fulfilledHandlers : rejectedHandlers ), result );\n\n  \t\t\t\t// dispatch onFulfilled and onRejected handlers asynchronously\n  \t\t\t\twait( dispatchHandlers );\n  \t\t\t};\n  \t\t};\n\n  \t\tfulfil = makeResolver( FULFILLED );\n  \t\treject = makeResolver( REJECTED );\n\n  \t\ttry {\n  \t\t\tcallback( fulfil, reject );\n  \t\t} catch ( err ) {\n  \t\t\treject( err );\n  \t\t}\n\n  \t\tpromise = {\n  \t\t\t// `then()` returns a Promise - 2.2.7\n  \t\t\tthen: function ( onFulfilled, onRejected ) {\n  \t\t\t\tvar promise2 = new _Promise( function ( fulfil, reject ) {\n\n  \t\t\t\t\tvar processResolutionHandler = function ( handler, handlers, forward ) {\n\n  \t\t\t\t\t\t// 2.2.1.1\n  \t\t\t\t\t\tif ( typeof handler === 'function' ) {\n  \t\t\t\t\t\t\thandlers.push( function ( p1result ) {\n  \t\t\t\t\t\t\t\tvar x;\n\n  \t\t\t\t\t\t\t\ttry {\n  \t\t\t\t\t\t\t\t\tx = handler( p1result );\n  \t\t\t\t\t\t\t\t\tresolve( promise2, x, fulfil, reject );\n  \t\t\t\t\t\t\t\t} catch ( err ) {\n  \t\t\t\t\t\t\t\t\treject( err );\n  \t\t\t\t\t\t\t\t}\n  \t\t\t\t\t\t\t});\n  \t\t\t\t\t\t} else {\n  \t\t\t\t\t\t\t// Forward the result of promise1 to promise2, if resolution handlers\n  \t\t\t\t\t\t\t// are not given\n  \t\t\t\t\t\t\thandlers.push( forward );\n  \t\t\t\t\t\t}\n  \t\t\t\t\t};\n\n  \t\t\t\t\t// 2.2\n  \t\t\t\t\tprocessResolutionHandler( onFulfilled, fulfilledHandlers, fulfil );\n  \t\t\t\t\tprocessResolutionHandler( onRejected, rejectedHandlers, reject );\n\n  \t\t\t\t\tif ( state !== PENDING ) {\n  \t\t\t\t\t\t// If the promise has resolved already, dispatch the appropriate handlers asynchronously\n  \t\t\t\t\t\twait( dispatchHandlers );\n  \t\t\t\t\t}\n\n  \t\t\t\t});\n\n  \t\t\t\treturn promise2;\n  \t\t\t}\n  \t\t};\n\n  \t\tpromise[ 'catch' ] = function ( onRejected ) {\n  \t\t\treturn this.then( null, onRejected );\n  \t\t};\n\n  \t\treturn promise;\n  \t};\n\n  \t_Promise.all = function ( promises ) {\n  \t\treturn new _Promise( function ( fulfil, reject ) {\n  \t\t\tvar result = [], pending, i, processPromise;\n\n  \t\t\tif ( !promises.length ) {\n  \t\t\t\tfulfil( result );\n  \t\t\t\treturn;\n  \t\t\t}\n\n  \t\t\tprocessPromise = function ( promise, i ) {\n  \t\t\t\tif ( promise && typeof promise.then === 'function' ) {\n  \t\t\t\t\tpromise.then( function ( value ) {\n  \t\t\t\t\t\tresult[i] = value;\n  \t\t\t\t\t\t--pending || fulfil( result );\n  \t\t\t\t\t}, reject );\n  \t\t\t\t}\n\n  \t\t\t\telse {\n  \t\t\t\t\tresult[i] = promise;\n  \t\t\t\t\t--pending || fulfil( result );\n  \t\t\t\t}\n  \t\t\t};\n\n  \t\t\tpending = i = promises.length;\n  \t\t\twhile ( i-- ) {\n  \t\t\t\tprocessPromise( promises[i], i );\n  \t\t\t}\n  \t\t});\n  \t};\n\n  \t_Promise.resolve = function ( value ) {\n  \t\treturn new _Promise( function ( fulfil ) {\n  \t\t\tfulfil( value );\n  \t\t});\n  \t};\n\n  \t_Promise.reject = function ( reason ) {\n  \t\treturn new _Promise( function ( fulfil, reject ) {\n  \t\t\treject( reason );\n  \t\t});\n  \t};\n  }\n\n  var Promise$1 = _Promise;\n\n  // TODO use MutationObservers or something to simulate setImmediate\n  function wait ( callback ) {\n  \tsetTimeout( callback, 0 );\n  }\n\n  function makeDispatcher ( handlers, result ) {\n  \treturn function () {\n  \t\tvar handler;\n\n  \t\twhile ( handler = handlers.shift() ) {\n  \t\t\thandler( result );\n  \t\t}\n  \t};\n  }\n\n  function resolve ( promise, x, fulfil, reject ) {\n  \t// Promise Resolution Procedure\n  \tvar then;\n\n  \t// 2.3.1\n  \tif ( x === promise ) {\n  \t\tthrow new TypeError( 'A promise\\'s fulfillment handler cannot return the same promise' );\n  \t}\n\n  \t// 2.3.2\n  \tif ( x instanceof _Promise ) {\n  \t\tx.then( fulfil, reject );\n  \t}\n\n  \t// 2.3.3\n  \telse if ( x && ( typeof x === 'object' || typeof x === 'function' ) ) {\n  \t\ttry {\n  \t\t\tthen = x.then; // 2.3.3.1\n  \t\t} catch ( e ) {\n  \t\t\treject( e ); // 2.3.3.2\n  \t\t\treturn;\n  \t\t}\n\n  \t\t// 2.3.3.3\n  \t\tif ( typeof then === 'function' ) {\n  \t\t\tvar called, resolvePromise, rejectPromise;\n\n  \t\t\tresolvePromise = function ( y ) {\n  \t\t\t\tif ( called ) {\n  \t\t\t\t\treturn;\n  \t\t\t\t}\n  \t\t\t\tcalled = true;\n  \t\t\t\tresolve( promise, y, fulfil, reject );\n  \t\t\t};\n\n  \t\t\trejectPromise = function ( r ) {\n  \t\t\t\tif ( called ) {\n  \t\t\t\t\treturn;\n  \t\t\t\t}\n  \t\t\t\tcalled = true;\n  \t\t\t\treject( r );\n  \t\t\t};\n\n  \t\t\ttry {\n  \t\t\t\tthen.call( x, resolvePromise, rejectPromise );\n  \t\t\t} catch ( e ) {\n  \t\t\t\tif ( !called ) { // 2.3.3.3.4.1\n  \t\t\t\t\treject( e ); // 2.3.3.3.4.2\n  \t\t\t\t\tcalled = true;\n  \t\t\t\t\treturn;\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\telse {\n  \t\t\tfulfil( x );\n  \t\t}\n  \t}\n\n  \telse {\n  \t\tfulfil( x );\n  \t}\n  }\n\n  var TransitionManager = function TransitionManager ( callback, parent ) {\n  \tthis.callback = callback;\n  \tthis.parent = parent;\n\n  \tthis.intros = [];\n  \tthis.outros = [];\n\n  \tthis.children = [];\n  \tthis.totalChildren = this.outroChildren = 0;\n\n  \tthis.detachQueue = [];\n  \tthis.outrosComplete = false;\n\n  \tif ( parent ) {\n  \t\tparent.addChild( this );\n  \t}\n  };\n\n  TransitionManager.prototype.add = function add ( transition ) {\n  \tvar list = transition.isIntro ? this.intros : this.outros;\n  \tlist.push( transition );\n  };\n\n  TransitionManager.prototype.addChild = function addChild ( child ) {\n  \tthis.children.push( child );\n\n  \tthis.totalChildren += 1;\n  \tthis.outroChildren += 1;\n  };\n\n  TransitionManager.prototype.decrementOutros = function decrementOutros () {\n  \tthis.outroChildren -= 1;\n  \tcheck( this );\n  };\n\n  TransitionManager.prototype.decrementTotal = function decrementTotal () {\n  \tthis.totalChildren -= 1;\n  \tcheck( this );\n  };\n\n  TransitionManager.prototype.detachNodes = function detachNodes () {\n  \tthis.detachQueue.forEach( detach );\n  \tthis.children.forEach( _detachNodes );\n  };\n\n  TransitionManager.prototype.remove = function remove ( transition ) {\n  \tvar list = transition.isIntro ? this.intros : this.outros;\n  \tremoveFromArray( list, transition );\n  \tcheck( this );\n  };\n\n  TransitionManager.prototype.start = function start () {\n  \tdetachImmediate( this );\n  \tthis.intros.concat( this.outros ).forEach( function ( t ) { return t.start(); } );\n  \tthis.ready = true;\n  \tcheck( this );\n  };\n\n  function detach ( element ) {\n  \telement.detach();\n  }\n\n  function _detachNodes ( tm ) { // _ to avoid transpiler quirk\n  \ttm.detachNodes();\n  }\n\n  function check ( tm ) {\n  \tif ( !tm.ready || tm.outros.length || tm.outroChildren ) return;\n\n  \t// If all outros are complete, and we haven't already done this,\n  \t// we notify the parent if there is one, otherwise\n  \t// start detaching nodes\n  \tif ( !tm.outrosComplete ) {\n  \t\tif ( tm.parent && !tm.parent.outrosComplete ) {\n  \t\t\ttm.parent.decrementOutros( tm );\n  \t\t} else {\n  \t\t\ttm.detachNodes();\n  \t\t}\n\n  \t\ttm.outrosComplete = true;\n  \t}\n\n  \t// Once everything is done, we can notify parent transition\n  \t// manager and call the callback\n  \tif ( !tm.intros.length && !tm.totalChildren ) {\n  \t\tif ( typeof tm.callback === 'function' ) {\n  \t\t\ttm.callback();\n  \t\t}\n\n  \t\tif ( tm.parent ) {\n  \t\t\ttm.parent.decrementTotal();\n  \t\t}\n  \t}\n  }\n\n  // check through the detach queue to see if a node is up or downstream from a\n  // transition and if not, go ahead and detach it\n  function detachImmediate ( manager ) {\n  \tvar queue = manager.detachQueue;\n  \tvar outros = collectAllOutros( manager );\n\n  \tvar i = queue.length, j = 0, node, trans;\n  \tstart: while ( i-- ) {\n  \t\tnode = queue[i].node;\n  \t\tj = outros.length;\n  \t\twhile ( j-- ) {\n  \t\t\ttrans = outros[j].node;\n  \t\t\t// check to see if the node is, contains, or is contained by the transitioning node\n  \t\t\tif ( trans === node || trans.contains( node ) || node.contains( trans ) ) continue start;\n  \t\t}\n\n  \t\t// no match, we can drop it\n  \t\tqueue[i].detach();\n  \t\tqueue.splice( i, 1 );\n  \t}\n  }\n\n  function collectAllOutros ( manager, list ) {\n  \tif ( !list ) {\n  \t\tlist = [];\n  \t\tvar parent = manager;\n  \t\twhile ( parent.parent ) parent = parent.parent;\n  \t\treturn collectAllOutros( parent, list );\n  \t} else {\n  \t\tvar i = manager.children.length;\n  \t\twhile ( i-- ) {\n  \t\t\tlist = collectAllOutros( manager.children[i], list );\n  \t\t}\n  \t\tlist = list.concat( manager.outros );\n  \t\treturn list;\n  \t}\n  }\n\n  var changeHook = new Hook( 'change' );\n\n  var batch;\n\n  var runloop = {\n  \tstart: function ( instance, returnPromise ) {\n  \t\tvar promise, fulfilPromise;\n\n  \t\tif ( returnPromise ) {\n  \t\t\tpromise = new Promise$1( function ( f ) { return ( fulfilPromise = f ); } );\n  \t\t}\n\n  \t\tbatch = {\n  \t\t\tpreviousBatch: batch,\n  \t\t\ttransitionManager: new TransitionManager( fulfilPromise, batch && batch.transitionManager ),\n  \t\t\tfragments: [],\n  \t\t\ttasks: [],\n  \t\t\timmediateObservers: [],\n  \t\t\tdeferredObservers: [],\n  \t\t\tractives: [],\n  \t\t\tinstance: instance\n  \t\t};\n\n  \t\treturn promise;\n  \t},\n\n  \tend: function () {\n  \t\tflushChanges();\n  \t\tbatch = batch.previousBatch;\n  \t},\n\n  \taddFragment: function ( fragment ) {\n  \t\taddToArray( batch.fragments, fragment );\n  \t},\n\n  \taddInstance: function ( instance ) {\n  \t\tif ( batch ) addToArray( batch.ractives, instance );\n  \t},\n\n  \taddObserver: function ( observer, defer ) {\n  \t\taddToArray( defer ? batch.deferredObservers : batch.immediateObservers, observer );\n  \t},\n\n  \tregisterTransition: function ( transition ) {\n  \t\ttransition._manager = batch.transitionManager;\n  \t\tbatch.transitionManager.add( transition );\n  \t},\n\n  \t// synchronise node detachments with transition ends\n  \tdetachWhenReady: function ( thing ) {\n  \t\tbatch.transitionManager.detachQueue.push( thing );\n  \t},\n\n  \tscheduleTask: function ( task, postRender ) {\n  \t\tvar _batch;\n\n  \t\tif ( !batch ) {\n  \t\t\ttask();\n  \t\t} else {\n  \t\t\t_batch = batch;\n  \t\t\twhile ( postRender && _batch.previousBatch ) {\n  \t\t\t\t// this can't happen until the DOM has been fully updated\n  \t\t\t\t// otherwise in some situations (with components inside elements)\n  \t\t\t\t// transitions and decorators will initialise prematurely\n  \t\t\t\t_batch = _batch.previousBatch;\n  \t\t\t}\n\n  \t\t\t_batch.tasks.push( task );\n  \t\t}\n  \t}\n  };\n\n  function dispatch ( observer ) {\n  \tobserver.dispatch();\n  }\n\n  function flushChanges () {\n  \tvar which = batch.immediateObservers;\n  \tbatch.immediateObservers = [];\n  \twhich.forEach( dispatch );\n\n  \t// Now that changes have been fully propagated, we can update the DOM\n  \t// and complete other tasks\n  \tvar i = batch.fragments.length;\n  \tvar fragment;\n\n  \twhich = batch.fragments;\n  \tbatch.fragments = [];\n  \tvar ractives = batch.ractives;\n  \tbatch.ractives = [];\n\n  \twhile ( i-- ) {\n  \t\tfragment = which[i];\n\n  \t\t// TODO deprecate this. It's annoying and serves no useful function\n  \t\tvar ractive = fragment.ractive;\n  \t\tchangeHook.fire( ractive, ractive.viewmodel.changes );\n  \t\tractive.viewmodel.changes = {};\n  \t\tremoveFromArray( ractives, ractive );\n\n  \t\tfragment.update();\n  \t}\n\n  \ti = ractives.length;\n  \twhile ( i-- ) {\n  \t\tvar ractive$1 = ractives[i];\n  \t\tchangeHook.fire( ractive$1, ractive$1.viewmodel.changes );\n  \t\tractive$1.viewmodel.changes = {};\n  \t}\n\n  \tbatch.transitionManager.start();\n\n  \twhich = batch.deferredObservers;\n  \tbatch.deferredObservers = [];\n  \twhich.forEach( dispatch );\n\n  \tvar tasks = batch.tasks;\n  \tbatch.tasks = [];\n\n  \tfor ( i = 0; i < tasks.length; i += 1 ) {\n  \t\ttasks[i]();\n  \t}\n\n  \t// If updating the view caused some model blowback - e.g. a triple\n  \t// containing <option> elements caused the binding on the <select>\n  \t// to update - then we start over\n  \tif ( batch.fragments.length || batch.immediateObservers.length || batch.deferredObservers.length || batch.ractives.length ) return flushChanges();\n  }\n\n  var noAnimation = Promise$1.resolve();\n  defineProperty( noAnimation, 'stop', { value: noop });\n\n  var linear = easing.linear;\n\n  function getOptions ( options, instance ) {\n  \toptions = options || {};\n\n  \tvar easing;\n  \tif ( options.easing ) {\n  \t\teasing = typeof options.easing === 'function' ?\n  \t\t\toptions.easing :\n  \t\t\tinstance.easing[ options.easing ];\n  \t}\n\n  \treturn {\n  \t\teasing: easing || linear,\n  \t\tduration: 'duration' in options ? options.duration : 400,\n  \t\tcomplete: options.complete || noop,\n  \t\tstep: options.step || noop\n  \t};\n  }\n\n  function Ractive$animate ( keypath, to, options ) {\n  \tif ( typeof keypath === 'object' ) {\n  \t\tvar keys = Object.keys( keypath );\n\n  \t\tthrow new Error( (\"ractive.animate(...) no longer supports objects. Instead of ractive.animate({\\n  \" + (keys.map( function ( key ) { return (\"'\" + key + \"': \" + (keypath[ key ])); } ).join( '\\n  ' )) + \"\\n}, {...}), do\\n\\n\" + (keys.map( function ( key ) { return (\"ractive.animate('\" + key + \"', \" + (keypath[ key ]) + \", {...});\"); } ).join( '\\n' )) + \"\\n\") );\n  \t}\n\n  \toptions = getOptions( options, this );\n\n  \tvar model = this.viewmodel.joinAll( splitKeypathI( keypath ) );\n  \tvar from = model.get();\n\n  \t// don't bother animating values that stay the same\n  \tif ( isEqual( from, to ) ) {\n  \t\toptions.complete( options.to );\n  \t\treturn noAnimation; // TODO should this have .then and .catch methods?\n  \t}\n\n  \tvar interpolator = interpolate( from, to, this, options.interpolator );\n\n  \t// if we can't interpolate the value, set it immediately\n  \tif ( !interpolator ) {\n  \t\trunloop.start();\n  \t\tmodel.set( to );\n  \t\trunloop.end();\n\n  \t\treturn noAnimation;\n  \t}\n\n  \treturn model.animate( from, to, options, interpolator );\n  }\n\n  var detachHook = new Hook( 'detach' );\n\n  function Ractive$detach () {\n  \tif ( this.isDetached ) {\n  \t\treturn this.el;\n  \t}\n\n  \tif ( this.el ) {\n  \t\tremoveFromArray( this.el.__ractive_instances__, this );\n  \t}\n\n  \tthis.el = this.fragment.detach();\n  \tthis.isDetached = true;\n\n  \tdetachHook.fire( this );\n  \treturn this.el;\n  }\n\n  function Ractive$find ( selector ) {\n  \tif ( !this.el ) throw new Error( (\"Cannot call ractive.find('\" + selector + \"') unless instance is rendered to the DOM\") );\n\n  \treturn this.fragment.find( selector );\n  }\n\n  function sortByDocumentPosition ( node, otherNode ) {\n  \tif ( node.compareDocumentPosition ) {\n  \t\tvar bitmask = node.compareDocumentPosition( otherNode );\n  \t\treturn ( bitmask & 2 ) ? 1 : -1;\n  \t}\n\n  \t// In old IE, we can piggy back on the mechanism for\n  \t// comparing component positions\n  \treturn sortByItemPosition( node, otherNode );\n  }\n\n  function sortByItemPosition ( a, b ) {\n  \tvar ancestryA = getAncestry( a.component || a._ractive.proxy );\n  \tvar ancestryB = getAncestry( b.component || b._ractive.proxy );\n\n  \tvar oldestA = lastItem( ancestryA );\n  \tvar oldestB = lastItem( ancestryB );\n  \tvar mutualAncestor;\n\n  \t// remove items from the end of both ancestries as long as they are identical\n  \t// - the final one removed is the closest mutual ancestor\n  \twhile ( oldestA && ( oldestA === oldestB ) ) {\n  \t\tancestryA.pop();\n  \t\tancestryB.pop();\n\n  \t\tmutualAncestor = oldestA;\n\n  \t\toldestA = lastItem( ancestryA );\n  \t\toldestB = lastItem( ancestryB );\n  \t}\n\n  \t// now that we have the mutual ancestor, we can find which is earliest\n  \toldestA = oldestA.component || oldestA;\n  \toldestB = oldestB.component || oldestB;\n\n  \tvar fragmentA = oldestA.parentFragment;\n  \tvar fragmentB = oldestB.parentFragment;\n\n  \t// if both items share a parent fragment, our job is easy\n  \tif ( fragmentA === fragmentB ) {\n  \t\tvar indexA = fragmentA.items.indexOf( oldestA );\n  \t\tvar indexB = fragmentB.items.indexOf( oldestB );\n\n  \t\t// if it's the same index, it means one contains the other,\n  \t\t// so we see which has the longest ancestry\n  \t\treturn ( indexA - indexB ) || ancestryA.length - ancestryB.length;\n  \t}\n\n  \t// if mutual ancestor is a section, we first test to see which section\n  \t// fragment comes first\n  \tvar fragments = mutualAncestor.iterations;\n  \tif ( fragments ) {\n  \t\tvar indexA$1 = fragments.indexOf( fragmentA );\n  \t\tvar indexB$1 = fragments.indexOf( fragmentB );\n\n  \t\treturn ( indexA$1 - indexB$1 ) || ancestryA.length - ancestryB.length;\n  \t}\n\n  \tthrow new Error( 'An unexpected condition was met while comparing the position of two components. Please file an issue at https://github.com/ractivejs/ractive/issues - thanks!' );\n  }\n\n  function getParent ( item ) {\n  \tvar parentFragment = item.parentFragment;\n\n  \tif ( parentFragment ) return parentFragment.owner;\n\n  \tif ( item.component && ( parentFragment = item.component.parentFragment ) ) {\n  \t\treturn parentFragment.owner;\n  \t}\n  }\n\n  function getAncestry ( item ) {\n  \tvar ancestry = [ item ];\n  \tvar ancestor = getParent( item );\n\n  \twhile ( ancestor ) {\n  \t\tancestry.push( ancestor );\n  \t\tancestor = getParent( ancestor );\n  \t}\n\n  \treturn ancestry;\n  }\n\n\n  var Query = function Query ( ractive, selector, live, isComponentQuery ) {\n  \tthis.ractive = ractive;\n  \tthis.selector = selector;\n  \tthis.live = live;\n  \tthis.isComponentQuery = isComponentQuery;\n\n  \tthis.result = [];\n\n  \tthis.dirty = true;\n  };\n\n  Query.prototype.add = function add ( item ) {\n  \tthis.result.push( item );\n  \tthis.makeDirty();\n  };\n\n  Query.prototype.cancel = function cancel () {\n  \tvar liveQueries = this._root[ this.isComponentQuery ? 'liveComponentQueries' : 'liveQueries' ];\n  \tvar selector = this.selector;\n\n  \tvar index = liveQueries.indexOf( selector );\n\n  \tif ( index !== -1 ) {\n  \t\tliveQueries.splice( index, 1 );\n  \t\tliveQueries[ selector ] = null;\n  \t}\n  };\n\n  Query.prototype.init = function init () {\n  \tthis.dirty = false;\n  };\n\n  Query.prototype.makeDirty = function makeDirty () {\n  \tvar this$1 = this;\n\n  \t\tif ( !this.dirty ) {\n  \t\tthis.dirty = true;\n\n  \t\t// Once the DOM has been updated, ensure the query\n  \t\t// is correctly ordered\n  \t\trunloop.scheduleTask( function () { return this$1.update(); } );\n  \t}\n  };\n\n  Query.prototype.remove = function remove ( nodeOrComponent ) {\n  \tvar index = this.result.indexOf( this.isComponentQuery ? nodeOrComponent.instance : nodeOrComponent );\n  \tif ( index !== -1 ) this.result.splice( index, 1 );\n  };\n\n  Query.prototype.update = function update () {\n  \tthis.result.sort( this.isComponentQuery ? sortByItemPosition : sortByDocumentPosition );\n  \tthis.dirty = false;\n  };\n\n  Query.prototype.test = function test ( item ) {\n  \treturn this.isComponentQuery ?\n  \t\t( !this.selector || item.name === this.selector ) :\n  \t\t( item ? matches( item, this.selector ) : null );\n  };\n\n  function Ractive$findAll ( selector, options ) {\n  \tif ( !this.el ) throw new Error( (\"Cannot call ractive.findAll('\" + selector + \"', ...) unless instance is rendered to the DOM\") );\n\n  \toptions = options || {};\n  \tvar liveQueries = this._liveQueries;\n\n  \t// Shortcut: if we're maintaining a live query with this\n  \t// selector, we don't need to traverse the parallel DOM\n  \tvar query = liveQueries[ selector ];\n  \tif ( query ) {\n  \t\t// Either return the exact same query, or (if not live) a snapshot\n  \t\treturn ( options && options.live ) ? query : query.slice();\n  \t}\n\n  \tquery = new Query( this, selector, !!options.live, false );\n\n  \t// Add this to the list of live queries Ractive needs to maintain,\n  \t// if applicable\n  \tif ( query.live ) {\n  \t\tliveQueries.push( selector );\n  \t\tliveQueries[ '_' + selector ] = query;\n  \t}\n\n  \tthis.fragment.findAll( selector, query );\n\n  \tquery.init();\n  \treturn query.result;\n  }\n\n  function Ractive$findAllComponents ( selector, options ) {\n  \toptions = options || {};\n  \tvar liveQueries = this._liveComponentQueries;\n\n  \t// Shortcut: if we're maintaining a live query with this\n  \t// selector, we don't need to traverse the parallel DOM\n  \tvar query = liveQueries[ selector ];\n  \tif ( query ) {\n  \t\t// Either return the exact same query, or (if not live) a snapshot\n  \t\treturn ( options && options.live ) ? query : query.slice();\n  \t}\n\n  \tquery = new Query( this, selector, !!options.live, true );\n\n  \t// Add this to the list of live queries Ractive needs to maintain,\n  \t// if applicable\n  \tif ( query.live ) {\n  \t\tliveQueries.push( selector );\n  \t\tliveQueries[ '_' + selector ] = query;\n  \t}\n\n  \tthis.fragment.findAllComponents( selector, query );\n\n  \tquery.init();\n  \treturn query.result;\n  }\n\n  function Ractive$findComponent ( selector ) {\n  \treturn this.fragment.findComponent( selector );\n  }\n\n  function Ractive$findContainer ( selector ) {\n  \tif ( this.container ) {\n  \t\tif ( this.container.component && this.container.component.name === selector ) {\n  \t\t\treturn this.container;\n  \t\t} else {\n  \t\t\treturn this.container.findContainer( selector );\n  \t\t}\n  \t}\n\n  \treturn null;\n  }\n\n  function Ractive$findParent ( selector ) {\n\n  \tif ( this.parent ) {\n  \t\tif ( this.parent.component && this.parent.component.name === selector ) {\n  \t\t\treturn this.parent;\n  \t\t} else {\n  \t\t\treturn this.parent.findParent ( selector );\n  \t\t}\n  \t}\n\n  \treturn null;\n  }\n\n  function enqueue ( ractive, event ) {\n  \tif ( ractive.event ) {\n  \t\tractive._eventQueue.push( ractive.event );\n  \t}\n\n  \tractive.event = event;\n  }\n\n  function dequeue ( ractive ) {\n  \tif ( ractive._eventQueue.length ) {\n  \t\tractive.event = ractive._eventQueue.pop();\n  \t} else {\n  \t\tractive.event = null;\n  \t}\n  }\n\n  var starMaps = {};\n\n  // This function takes a keypath such as 'foo.bar.baz', and returns\n  // all the variants of that keypath that include a wildcard in place\n  // of a key, such as 'foo.bar.*', 'foo.*.baz', 'foo.*.*' and so on.\n  // These are then checked against the dependants map (ractive.viewmodel.depsMap)\n  // to see if any pattern observers are downstream of one or more of\n  // these wildcard keypaths (e.g. 'foo.bar.*.status')\n  function getPotentialWildcardMatches ( keypath ) {\n  \tvar keys, starMap, mapper, i, result, wildcardKeypath;\n\n  \tkeys = splitKeypathI( keypath );\n  \tif( !( starMap = starMaps[ keys.length ]) ) {\n  \t\tstarMap = getStarMap( keys.length );\n  \t}\n\n  \tresult = [];\n\n  \tmapper = function ( star, i ) {\n  \t\treturn star ? '*' : keys[i];\n  \t};\n\n  \ti = starMap.length;\n  \twhile ( i-- ) {\n  \t\twildcardKeypath = starMap[i].map( mapper ).join( '.' );\n\n  \t\tif ( !result.hasOwnProperty( wildcardKeypath ) ) {\n  \t\t\tresult.push( wildcardKeypath );\n  \t\t\tresult[ wildcardKeypath ] = true;\n  \t\t}\n  \t}\n\n  \treturn result;\n  }\n\n  // This function returns all the possible true/false combinations for\n  // a given number - e.g. for two, the possible combinations are\n  // [ true, true ], [ true, false ], [ false, true ], [ false, false ].\n  // It does so by getting all the binary values between 0 and e.g. 11\n  function getStarMap ( num ) {\n  \tvar ones = '', max, binary, starMap, mapper, i, j, l, map;\n\n  \tif ( !starMaps[ num ] ) {\n  \t\tstarMap = [];\n\n  \t\twhile ( ones.length < num ) {\n  \t\t\tones += 1;\n  \t\t}\n\n  \t\tmax = parseInt( ones, 2 );\n\n  \t\tmapper = function ( digit ) {\n  \t\t\treturn digit === '1';\n  \t\t};\n\n  \t\tfor ( i = 0; i <= max; i += 1 ) {\n  \t\t\tbinary = i.toString( 2 );\n  \t\t\twhile ( binary.length < num ) {\n  \t\t\t\tbinary = '0' + binary;\n  \t\t\t}\n\n  \t\t\tmap = [];\n  \t\t\tl = binary.length;\n  \t\t\tfor (j = 0; j < l; j++) {\n  \t\t\t\tmap.push( mapper( binary[j] ) );\n  \t\t\t}\n  \t\t\tstarMap[i] = map;\n  \t\t}\n\n  \t\tstarMaps[ num ] = starMap;\n  \t}\n\n  \treturn starMaps[ num ];\n  }\n\n  var wildcardCache = {};\n\n  function fireEvent ( ractive, eventName, options ) {\n  \tif ( options === void 0 ) options = {};\n\n  \tif ( !eventName ) { return; }\n\n  \tif ( !options.event ) {\n  \t\toptions.event = {\n  \t\t\tname: eventName,\n  \t\t\t// until event not included as argument default\n  \t\t\t_noArg: true\n  \t\t};\n  \t} else {\n  \t\toptions.event.name = eventName;\n  \t}\n\n  \tvar eventNames = getWildcardNames( eventName );\n\n  \tfireEventAs( ractive, eventNames, options.event, options.args, true );\n  }\n\n  function getWildcardNames ( eventName ) {\n  \tif ( wildcardCache.hasOwnProperty( eventName ) ) {\n  \t\treturn wildcardCache[ eventName ];\n  \t} else {\n  \t\treturn wildcardCache[ eventName ] = getPotentialWildcardMatches( eventName );\n  \t}\n  }\n\n  function fireEventAs  ( ractive, eventNames, event, args, initialFire ) {\n\n  \tif ( initialFire === void 0 ) initialFire = false;\n\n  \tvar subscribers, i, bubble = true;\n\n  \tenqueue( ractive, event );\n\n  \tfor ( i = eventNames.length; i >= 0; i-- ) {\n  \t\tsubscribers = ractive._subs[ eventNames[ i ] ];\n\n  \t\tif ( subscribers ) {\n  \t\t\tbubble = notifySubscribers( ractive, subscribers, event, args ) && bubble;\n  \t\t}\n  \t}\n\n  \tdequeue( ractive );\n\n  \tif ( ractive.parent && bubble ) {\n\n  \t\tif ( initialFire && ractive.component ) {\n  \t\t\tvar fullName = ractive.component.name + '.' + eventNames[ eventNames.length-1 ];\n  \t\t\teventNames = getWildcardNames( fullName );\n\n  \t\t\tif( event && !event.component ) {\n  \t\t\t\tevent.component = ractive;\n  \t\t\t}\n  \t\t}\n\n  \t\tfireEventAs( ractive.parent, eventNames, event, args );\n  \t}\n  }\n\n  function notifySubscribers ( ractive, subscribers, event, args ) {\n  \tvar originalEvent = null, stopEvent = false;\n\n  \tif ( event && !event._noArg ) {\n  \t\targs = [ event ].concat( args );\n  \t}\n\n  \t// subscribers can be modified inflight, e.g. \"once\" functionality\n  \t// so we need to copy to make sure everyone gets called\n  \tsubscribers = subscribers.slice();\n\n  \tfor ( var i = 0, len = subscribers.length; i < len; i += 1 ) {\n  \t\tif ( subscribers[ i ].apply( ractive, args ) === false ) {\n  \t\t\tstopEvent = true;\n  \t\t}\n  \t}\n\n  \tif ( event && !event._noArg && stopEvent && ( originalEvent = event.original ) ) {\n  \t\toriginalEvent.preventDefault && originalEvent.preventDefault();\n  \t\toriginalEvent.stopPropagation && originalEvent.stopPropagation();\n  \t}\n\n  \treturn !stopEvent;\n  }\n\n  function Ractive$fire ( eventName ) {\n  \tvar args = [], len = arguments.length - 1;\n  \twhile ( len-- > 0 ) args[ len ] = arguments[ len + 1 ];\n\n  \tfireEvent( this, eventName, { args: args });\n  }\n\n  function badReference ( key ) {\n  \tthrow new Error( (\"An index or key reference (\" + key + \") cannot have child properties\") );\n  }\n\n  function resolveAmbiguousReference ( fragment, ref ) {\n  \tvar localViewmodel = fragment.findContext().root;\n  \tvar keys = splitKeypathI( ref );\n  \tvar key = keys[0];\n\n  \tvar hasContextChain;\n  \tvar crossedComponentBoundary;\n  \tvar aliases;\n\n  \twhile ( fragment ) {\n  \t\t// repeated fragments\n  \t\tif ( fragment.isIteration ) {\n  \t\t\tif ( key === fragment.parent.keyRef ) {\n  \t\t\t\tif ( keys.length > 1 ) badReference( key );\n  \t\t\t\treturn fragment.context.getKeyModel();\n  \t\t\t}\n\n  \t\t\tif ( key === fragment.parent.indexRef ) {\n  \t\t\t\tif ( keys.length > 1 ) badReference( key );\n  \t\t\t\treturn fragment.context.getIndexModel( fragment.index );\n  \t\t\t}\n  \t\t}\n\n  \t\t// alias node or iteration\n  \t\tif ( ( ( aliases = fragment.owner.aliases ) || ( aliases = fragment.aliases ) ) && aliases.hasOwnProperty( key ) ) {\n  \t\t\tvar model = aliases[ key ];\n\n  \t\t\tif ( keys.length === 1 ) return model;\n  \t\t\telse if ( typeof model.joinAll === 'function' ) {\n  \t\t\t\treturn model.joinAll( keys.slice( 1 ) );\n  \t\t\t}\n  \t\t}\n\n  \t\tif ( fragment.context ) {\n  \t\t\t// TODO better encapsulate the component check\n  \t\t\tif ( !fragment.isRoot || fragment.ractive.component ) hasContextChain = true;\n\n  \t\t\tif ( fragment.context.has( key ) ) {\n  \t\t\t\tif ( crossedComponentBoundary ) {\n  \t\t\t\t\tlocalViewmodel.map( key, fragment.context.joinKey( key ) );\n  \t\t\t\t}\n\n  \t\t\t\treturn fragment.context.joinAll( keys );\n  \t\t\t}\n  \t\t}\n\n  \t\tif ( fragment.componentParent && !fragment.ractive.isolated ) {\n  \t\t\t// ascend through component boundary\n  \t\t\tfragment = fragment.componentParent;\n  \t\t\tcrossedComponentBoundary = true;\n  \t\t} else {\n  \t\t\tfragment = fragment.parent;\n  \t\t}\n  \t}\n\n  \tif ( !hasContextChain ) {\n  \t\treturn localViewmodel.joinAll( keys );\n  \t}\n  }\n\n  var stack = [];\n  var captureGroup;\n\n  function startCapturing () {\n  \tstack.push( captureGroup = [] );\n  }\n\n  function stopCapturing () {\n  \tvar dependencies = stack.pop();\n  \tcaptureGroup = stack[ stack.length - 1 ];\n  \treturn dependencies;\n  }\n\n  function capture ( model ) {\n  \tif ( captureGroup ) {\n  \t\tcaptureGroup.push( model );\n  \t}\n  }\n\n  function bind               ( x ) { x.bind(); }\n  function cancel             ( x ) { x.cancel(); }\n  function handleChange       ( x ) { x.handleChange(); }\n  function mark               ( x ) { x.mark(); }\n  function render             ( x ) { x.render(); }\n  function rebind             ( x ) { x.rebind(); }\n  function teardown           ( x ) { x.teardown(); }\n  function unbind             ( x ) { x.unbind(); }\n  function unrender           ( x ) { x.unrender(); }\n  function unrenderAndDestroy ( x ) { x.unrender( true ); }\n  function update             ( x ) { x.update(); }\n  function toString$1           ( x ) { return x.toString(); }\n  function toEscapedString    ( x ) { return x.toString( true ); }\n\n  var requestAnimationFrame;\n\n  // If window doesn't exist, we don't need requestAnimationFrame\n  if ( !win ) {\n  \trequestAnimationFrame = null;\n  } else {\n  \t// https://gist.github.com/paulirish/1579671\n  \t(function(vendors, lastTime, win) {\n\n  \t\tvar x, setTimeout;\n\n  \t\tif ( win.requestAnimationFrame ) {\n  \t\t\treturn;\n  \t\t}\n\n  \t\tfor ( x = 0; x < vendors.length && !win.requestAnimationFrame; ++x ) {\n  \t\t\twin.requestAnimationFrame = win[vendors[x]+'RequestAnimationFrame'];\n  \t\t}\n\n  \t\tif ( !win.requestAnimationFrame ) {\n  \t\t\tsetTimeout = win.setTimeout;\n\n  \t\t\twin.requestAnimationFrame = function(callback) {\n  \t\t\t\tvar currTime, timeToCall, id;\n\n  \t\t\t\tcurrTime = Date.now();\n  \t\t\t\ttimeToCall = Math.max( 0, 16 - (currTime - lastTime ) );\n  \t\t\t\tid = setTimeout( function() { callback(currTime + timeToCall); }, timeToCall );\n\n  \t\t\t\tlastTime = currTime + timeToCall;\n  \t\t\t\treturn id;\n  \t\t\t};\n  \t\t}\n\n  \t}( vendors, 0, win ));\n\n  \trequestAnimationFrame = win.requestAnimationFrame;\n  }\n\n  var rAF = requestAnimationFrame;\n\n  var getTime = ( win && win.performance && typeof win.performance.now === 'function' ) ?\n  \tfunction () { return win.performance.now(); } :\n  \tfunction () { return Date.now(); };\n\n  // TODO what happens if a transition is aborted?\n\n  var tickers = [];\n  var running = false;\n\n  function tick () {\n  \trunloop.start();\n\n  \tvar now = getTime();\n\n  \tvar i;\n  \tvar ticker;\n\n  \tfor ( i = 0; i < tickers.length; i += 1 ) {\n  \t\tticker = tickers[i];\n\n  \t\tif ( !ticker.tick( now ) ) {\n  \t\t\t// ticker is complete, remove it from the stack, and decrement i so we don't miss one\n  \t\t\ttickers.splice( i--, 1 );\n  \t\t}\n  \t}\n\n  \trunloop.end();\n\n  \tif ( tickers.length ) {\n  \t\trAF( tick );\n  \t} else {\n  \t\trunning = false;\n  \t}\n  }\n\n  var Ticker = function Ticker ( options ) {\n  \tthis.duration = options.duration;\n  \tthis.step = options.step;\n  \tthis.complete = options.complete;\n  \tthis.easing = options.easing;\n\n  \tthis.start = getTime();\n  \tthis.end = this.start + this.duration;\n\n  \tthis.running = true;\n\n  \ttickers.push( this );\n  \tif ( !running ) rAF( tick );\n  };\n\n  Ticker.prototype.tick = function tick$1 ( now ) {\n  \tif ( !this.running ) return false;\n\n  \tif ( now > this.end ) {\n  \t\tif ( this.step ) this.step( 1 );\n  \t\tif ( this.complete ) this.complete( 1 );\n\n  \t\treturn false;\n  \t}\n\n  \tvar elapsed = now - this.start;\n  \tvar eased = this.easing( elapsed / this.duration );\n\n  \tif ( this.step ) this.step( eased );\n\n  \treturn true;\n  };\n\n  Ticker.prototype.stop = function stop () {\n  \tif ( this.abort ) this.abort();\n  \tthis.running = false;\n  };\n\n  var prefixers = {};\n\n  // TODO this is legacy. sooner we can replace the old adaptor API the better\n  function prefixKeypath ( obj, prefix ) {\n  \tvar prefixed = {}, key;\n\n  \tif ( !prefix ) {\n  \t\treturn obj;\n  \t}\n\n  \tprefix += '.';\n\n  \tfor ( key in obj ) {\n  \t\tif ( obj.hasOwnProperty( key ) ) {\n  \t\t\tprefixed[ prefix + key ] = obj[ key ];\n  \t\t}\n  \t}\n\n  \treturn prefixed;\n  }\n\n  function getPrefixer ( rootKeypath ) {\n  \tvar rootDot;\n\n  \tif ( !prefixers[ rootKeypath ] ) {\n  \t\trootDot = rootKeypath ? rootKeypath + '.' : '';\n\n  \t\tprefixers[ rootKeypath ] = function ( relativeKeypath, value ) {\n  \t\t\tvar obj;\n\n  \t\t\tif ( typeof relativeKeypath === 'string' ) {\n  \t\t\t\tobj = {};\n  \t\t\t\tobj[ rootDot + relativeKeypath ] = value;\n  \t\t\t\treturn obj;\n  \t\t\t}\n\n  \t\t\tif ( typeof relativeKeypath === 'object' ) {\n  \t\t\t\t// 'relativeKeypath' is in fact a hash, not a keypath\n  \t\t\t\treturn rootDot ? prefixKeypath( relativeKeypath, rootKeypath ) : relativeKeypath;\n  \t\t\t}\n  \t\t};\n  \t}\n\n  \treturn prefixers[ rootKeypath ];\n  }\n\n  var KeyModel = function KeyModel ( key ) {\n  \tthis.value = key;\n  \tthis.isReadonly = true;\n  \tthis.dependants = [];\n  };\n\n  KeyModel.prototype.get = function get () {\n  \treturn unescapeKey( this.value );\n  };\n\n  KeyModel.prototype.getKeypath = function getKeypath () {\n  \treturn unescapeKey( this.value );\n  };\n\n  KeyModel.prototype.rebind = function rebind ( key ) {\n  \tthis.value = key;\n  \tthis.dependants.forEach( handleChange );\n  };\n\n  KeyModel.prototype.register = function register ( dependant ) {\n  \tthis.dependants.push( dependant );\n  };\n\n  KeyModel.prototype.unregister = function unregister ( dependant ) {\n  \tremoveFromArray( this.dependants, dependant );\n  };\n\n  var KeypathModel = function KeypathModel ( parent, ractive ) {\n  \tthis.parent = parent;\n  \tthis.ractive = ractive;\n  \tthis.value = ractive ? parent.getKeypath( ractive ) : parent.getKeypath();\n  \tthis.dependants = [];\n  \tthis.children = [];\n  };\n\n  KeypathModel.prototype.addChild = function addChild( model ) {\n  \tthis.children.push( model );\n  \tmodel.owner = this;\n  };\n\n  KeypathModel.prototype.get = function get () {\n  \treturn this.value;\n  };\n\n  KeypathModel.prototype.getKeypath = function getKeypath () {\n  \treturn this.value;\n  };\n\n  KeypathModel.prototype.handleChange = function handleChange$1 () {\n  \tthis.value = this.ractive ? this.parent.getKeypath( this.ractive ) : this.parent.getKeypath();\n  \tif ( this.ractive && this.owner ) {\n  \t\tthis.ractive.viewmodel.keypathModels[ this.owner.value ] = this;\n  \t}\n  \tthis.children.forEach( handleChange );\n  \tthis.dependants.forEach( handleChange );\n  };\n\n  KeypathModel.prototype.register = function register ( dependant ) {\n  \tthis.dependants.push( dependant );\n  };\n\n  KeypathModel.prototype.removeChild = function removeChild( model ) {\n  \tremoveFromArray( this.children, model );\n  };\n\n  KeypathModel.prototype.teardown = function teardown$1 () {\n  \tif ( this.owner ) this.owner.removeChild( this );\n  \tthis.children.forEach( teardown );\n  };\n\n  KeypathModel.prototype.unregister = function unregister ( dependant ) {\n  \tremoveFromArray( this.dependants, dependant );\n  };\n\n  var hasProp = Object.prototype.hasOwnProperty;\n\n  function updateFromBindings ( model ) {\n  \tmodel.updateFromBindings( true );\n  }\n\n  function updateKeypathDependants ( model ) {\n  \tmodel.updateKeypathDependants();\n  }\n\n  var originatingModel = null;\n\n  var Model = function Model ( parent, key ) {\n  \tthis.deps = [];\n\n  \tthis.children = [];\n  \tthis.childByKey = {};\n\n  \tthis.indexModels = [];\n\n  \tthis.unresolved = [];\n  \tthis.unresolvedByKey = {};\n\n  \tthis.bindings = [];\n  \tthis.patternObservers = [];\n\n  \tthis.value = undefined;\n\n  \tthis.ticker = null;\n\n  \tif ( parent ) {\n  \t\tthis.parent = parent;\n  \t\tthis.root = parent.root;\n  \t\tthis.key = unescapeKey( key );\n  \t\tthis.isReadonly = parent.isReadonly;\n\n  \t\tif ( parent.value ) {\n  \t\t\tthis.value = parent.value[ this.key ];\n  \t\t\tthis.adapt();\n  \t\t}\n  \t}\n  };\n\n  Model.prototype.adapt = function adapt () {\n  \tvar this$1 = this;\n\n  \t\tvar adaptors = this.root.adaptors;\n  \tvar len = adaptors.length;\n\n  \tthis.rewrap = false;\n\n  \t// Exit early if no adaptors\n  \tif ( len === 0 ) return;\n\n  \tvar value = this.value;\n\n  \t// TODO remove this legacy nonsense\n  \tvar ractive = this.root.ractive;\n  \tvar keypath = this.getKeypath();\n\n  \t// tear previous adaptor down if present\n  \tif ( this.wrapper ) {\n  \t\tvar shouldTeardown = !this.wrapper.reset || this.wrapper.reset( value ) === false;\n\n  \t\tif ( shouldTeardown ) {\n  \t\t\tthis.wrapper.teardown();\n  \t\t\tthis.wrapper = null;\n\n  \t\t\t// don't branch for undefined values\n  \t\t\tif ( this.value !== undefined ) {\n  \t\t\t\tvar parentValue = this.parent.value || this.parent.createBranch( this.key );\n  \t\t\t\tif ( parentValue[ this.key ] !== this.value ) parentValue[ this.key ] = value;\n  \t\t\t}\n  \t\t} else {\n  \t\t\tthis.value = this.wrapper.get();\n  \t\t\treturn;\n  \t\t}\n  \t}\n\n  \tvar i;\n\n  \tfor ( i = 0; i < len; i += 1 ) {\n  \t\tvar adaptor = adaptors[i];\n  \t\tif ( adaptor.filter( value, keypath, ractive ) ) {\n  \t\t\tthis$1.wrapper = adaptor.wrap( ractive, value, keypath, getPrefixer( keypath ) );\n  \t\t\tthis$1.wrapper.value = this$1.value;\n  \t\t\tthis$1.wrapper.__model = this$1; // massive temporary hack to enable array adaptor\n\n  \t\t\tthis$1.value = this$1.wrapper.get();\n\n  \t\t\tbreak;\n  \t\t}\n  \t}\n  };\n\n  Model.prototype.addUnresolved = function addUnresolved ( key, resolver ) {\n  \tif ( !this.unresolvedByKey[ key ] ) {\n  \t\tthis.unresolved.push( key );\n  \t\tthis.unresolvedByKey[ key ] = [];\n  \t}\n\n  \tthis.unresolvedByKey[ key ].push( resolver );\n  };\n\n  Model.prototype.animate = function animate ( from, to, options, interpolator ) {\n  \tvar this$1 = this;\n\n  \t\tif ( this.ticker ) this.ticker.stop();\n\n  \tvar fulfilPromise;\n  \tvar promise = new Promise$1( function ( fulfil ) { return fulfilPromise = fulfil; } );\n\n  \tthis.ticker = new Ticker({\n  \t\tduration: options.duration,\n  \t\teasing: options.easing,\n  \t\tstep: function ( t ) {\n  \t\t\tvar value = interpolator( t );\n  \t\t\tthis$1.applyValue( value );\n  \t\t\tif ( options.step ) options.step( t, value );\n  \t\t},\n  \t\tcomplete: function () {\n  \t\t\tthis$1.applyValue( to );\n  \t\t\tif ( options.complete ) options.complete( to );\n\n  \t\t\tthis$1.ticker = null;\n  \t\t\tfulfilPromise();\n  \t\t}\n  \t});\n\n  \tpromise.stop = this.ticker.stop;\n  \treturn promise;\n  };\n\n  Model.prototype.applyValue = function applyValue ( value ) {\n  \tif ( isEqual( value, this.value ) ) return;\n\n  \t// TODO deprecate this nonsense\n  \tthis.registerChange( this.getKeypath(), value );\n\n  \tif ( this.parent.wrapper && this.parent.wrapper.set ) {\n  \t\tthis.parent.wrapper.set( this.key, value );\n  \t\tthis.parent.value = this.parent.wrapper.get();\n\n  \t\tthis.value = this.parent.value[ this.key ];\n  \t\tthis.adapt();\n  \t} else if ( this.wrapper ) {\n  \t\tthis.value = value;\n  \t\tthis.adapt();\n  \t} else {\n  \t\tvar parentValue = this.parent.value || this.parent.createBranch( this.key );\n  \t\tparentValue[ this.key ] = value;\n\n  \t\tthis.value = value;\n  \t\tthis.adapt();\n  \t}\n\n  \tthis.parent.clearUnresolveds();\n  \tthis.clearUnresolveds();\n\n  \t// notify dependants\n  \tvar previousOriginatingModel = originatingModel; // for the array.length special case\n  \toriginatingModel = this;\n\n  \tthis.children.forEach( mark );\n  \tthis.deps.forEach( handleChange );\n\n  \tthis.notifyUpstream();\n\n  \toriginatingModel = previousOriginatingModel;\n  };\n\n  Model.prototype.clearUnresolveds = function clearUnresolveds ( specificKey ) {\n  \tvar this$1 = this;\n\n  \t\tvar i = this.unresolved.length;\n\n  \twhile ( i-- ) {\n  \t\tvar key = this$1.unresolved[i];\n\n  \t\tif ( specificKey && key !== specificKey ) continue;\n\n  \t\tvar resolvers = this$1.unresolvedByKey[ key ];\n  \t\tvar hasKey = this$1.has( key );\n\n  \t\tvar j = resolvers.length;\n  \t\twhile ( j-- ) {\n  \t\t\tif ( hasKey ) resolvers[j].attemptResolution();\n  \t\t\tif ( resolvers[j].resolved ) resolvers.splice( j, 1 );\n  \t\t}\n\n  \t\tif ( !resolvers.length ) {\n  \t\t\tthis$1.unresolved.splice( i, 1 );\n  \t\t\tthis$1.unresolvedByKey[ key ] = null;\n  \t\t}\n  \t}\n  };\n\n  Model.prototype.createBranch = function createBranch ( key ) {\n  \tvar branch = isNumeric( key ) ? [] : {};\n  \tthis.set( branch );\n\n  \treturn branch;\n  };\n\n  Model.prototype.findMatches = function findMatches ( keys ) {\n  \tvar len = keys.length;\n\n  \tvar existingMatches = [ this ];\n  \tvar matches;\n  \tvar i;\n\n  \tvar loop = function (  ) {\n  \t\tvar key = keys[i];\n\n  \t\tif ( key === '*' ) {\n  \t\t\tmatches = [];\n  \t\t\texistingMatches.forEach( function ( model ) {\n  \t\t\t\tmatches.push.apply( matches, model.getValueChildren( model.get() ) );\n  \t\t\t});\n  \t\t} else {\n  \t\t\tmatches = existingMatches.map( function ( model ) { return model.joinKey( key ); } );\n  \t\t}\n\n  \t\texistingMatches = matches;\n  \t};\n\n  \t\tfor ( i = 0; i < len; i += 1 ) loop(  );\n\n  \treturn matches;\n  };\n\n  Model.prototype.get = function get ( shouldCapture ) {\n  \tif ( shouldCapture ) capture( this );\n  \treturn this.value;\n  };\n\n  Model.prototype.getIndexModel = function getIndexModel ( fragmentIndex ) {\n  \tvar indexModels = this.parent.indexModels;\n\n  \t// non-numeric keys are a special of a numeric index in a object iteration\n  \tif ( typeof this.key === 'string' && fragmentIndex !== undefined ) {\n  \t\treturn new KeyModel( fragmentIndex );\n  \t} else if ( !indexModels[ this.key ] ) {\n  \t\tindexModels[ this.key ] = new KeyModel( this.key );\n  \t}\n\n  \treturn indexModels[ this.key ];\n  };\n\n  Model.prototype.getKeyModel = function getKeyModel () {\n  \t// TODO... different to IndexModel because key can never change\n  \treturn new KeyModel( escapeKey( this.key ) );\n  };\n\n  Model.prototype.getKeypathModel = function getKeypathModel ( ractive ) {\n  \tvar keypath = this.getKeypath(), model = this.keypathModel || ( this.keypathModel = new KeypathModel( this ) );\n\n  \tif ( ractive && ractive.component ) {\n  \t\tvar mapped = this.getKeypath( ractive );\n  \t\tif ( mapped !== keypath ) {\n  \t\t\tvar map = ractive.viewmodel.keypathModels || ( ractive.viewmodel.keypathModels = {} );\n  \t\t\tvar child = map[ keypath ] || ( map[ keypath ] = new KeypathModel( this, ractive ) );\n  \t\t\tmodel.addChild( child );\n  \t\t\treturn child;\n  \t\t}\n  \t}\n\n  \treturn model;\n  };\n\n  Model.prototype.getKeypath = function getKeypath ( ractive ) {\n  \tvar root = this.parent.isRoot ? escapeKey( this.key ) : this.parent.getKeypath() + '.' + escapeKey( this.key );\n\n  \tif ( ractive && ractive.component ) {\n  \t\tvar map = ractive.viewmodel.mappings;\n  \t\tfor ( var k in map ) {\n  \t\t\tif ( root.indexOf( map[ k ].getKeypath() ) >= 0 ) {\n  \t\t\t\troot = root.replace( map[ k ].getKeypath(), k );\n  \t\t\t\tbreak;\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \treturn root;\n  };\n\n  Model.prototype.getValueChildren = function getValueChildren ( value ) {\n  \tvar this$1 = this;\n\n  \t\tvar children;\n  \tif ( isArray( value ) ) {\n  \t\tchildren = [];\n  \t\t// special case - array.length. This is a horrible kludge, but\n  \t\t// it'll do for now. Alternatives welcome\n  \t\tif ( originatingModel && originatingModel.parent === this && originatingModel.key === 'length' ) {\n  \t\t\tchildren.push( originatingModel );\n  \t\t}\n  \t\tvalue.forEach( function ( m, i ) {\n  \t\t\tchildren.push( this$1.joinKey( i ) );\n  \t\t});\n\n  \t}\n\n  \telse if ( isObject( value ) || typeof value === 'function' ) {\n  \t\tchildren = Object.keys( value ).map( function ( key ) { return this$1.joinKey( key ); } );\n  \t}\n\n  \telse if ( value != null ) {\n  \t\treturn [];\n  \t}\n\n  \treturn children;\n  };\n\n  Model.prototype.has = function has ( key ) {\n  \tvar value = this.get();\n  \tif ( !value ) return false;\n\n  \tkey = unescapeKey( key );\n  \tif ( hasProp.call( value, key ) ) return true;\n\n  \t// We climb up the constructor chain to find if one of them contains the key\n  \tvar constructor = value.constructor;\n  \twhile ( constructor !== Function && constructor !== Array && constructor !== Object ) {\n  \t\tif ( hasProp.call( constructor.prototype, key ) ) return true;\n  \t\tconstructor = constructor.constructor;\n  \t}\n\n  \treturn false;\n  };\n\n  Model.prototype.joinKey = function joinKey ( key ) {\n  \tif ( key === undefined || key === '' ) return this;\n\n  \tif ( !this.childByKey.hasOwnProperty( key ) ) {\n  \t\tvar child = new Model( this, key );\n  \t\tthis.children.push( child );\n  \t\tthis.childByKey[ key ] = child;\n  \t}\n\n  \treturn this.childByKey[ key ];\n  };\n\n  Model.prototype.joinAll = function joinAll ( keys ) {\n  \tvar model = this;\n  \tfor ( var i = 0; i < keys.length; i += 1 ) {\n  \t\tmodel = model.joinKey( keys[i] );\n  \t}\n\n  \treturn model;\n  };\n\n  Model.prototype.mark = function mark$1 () {\n  \tvar value = this.retrieve();\n\n  \tif ( !isEqual( value, this.value ) ) {\n  \t\tvar old = this.value;\n  \t\tthis.value = value;\n\n  \t\t// make sure the wrapper stays in sync\n  \t\tif ( old !== value || this.rewrap ) this.adapt();\n\n  \t\tthis.children.forEach( mark );\n\n  \t\tthis.deps.forEach( handleChange );\n  \t\tthis.clearUnresolveds();\n  \t}\n  };\n\n  Model.prototype.merge = function merge ( array, comparator ) {\n  \tvar oldArray = comparator ? this.value.map( comparator ) : this.value;\n  \tvar newArray = comparator ? array.map( comparator ) : array;\n\n  \tvar oldLength = oldArray.length;\n\n  \tvar usedIndices = {};\n  \tvar firstUnusedIndex = 0;\n\n  \tvar newIndices = oldArray.map( function ( item ) {\n  \t\tvar index;\n  \t\tvar start = firstUnusedIndex;\n\n  \t\tdo {\n  \t\t\tindex = newArray.indexOf( item, start );\n\n  \t\t\tif ( index === -1 ) {\n  \t\t\t\treturn -1;\n  \t\t\t}\n\n  \t\t\tstart = index + 1;\n  \t\t} while ( ( usedIndices[ index ] === true ) && start < oldLength );\n\n  \t\t// keep track of the first unused index, so we don't search\n  \t\t// the whole of newArray for each item in oldArray unnecessarily\n  \t\tif ( index === firstUnusedIndex ) {\n  \t\t\tfirstUnusedIndex += 1;\n  \t\t}\n  \t\t// allow next instance of next \"equal\" to be found item\n  \t\tusedIndices[ index ] = true;\n  \t\treturn index;\n  \t});\n\n  \tthis.parent.value[ this.key ] = array;\n  \tthis._merged = true;\n  \tthis.shuffle( newIndices );\n  };\n\n  Model.prototype.notifyUpstream = function notifyUpstream () {\n  \tvar parent = this.parent, prev = this;\n  \twhile ( parent ) {\n  \t\tif ( parent.patternObservers.length ) parent.patternObservers.forEach( function ( o ) { return o.notify( prev.key ); } );\n  \t\tparent.deps.forEach( handleChange );\n  \t\tprev = parent;\n  \t\tparent = parent.parent;\n  \t}\n  };\n\n  Model.prototype.register = function register ( dep ) {\n  \tthis.deps.push( dep );\n  };\n\n  Model.prototype.registerChange = function registerChange ( key, value ) {\n  \tif ( !this.isRoot ) {\n  \t\tthis.root.registerChange( key, value );\n  \t} else {\n  \t\tthis.changes[ key ] = value;\n  \t\trunloop.addInstance( this.root.ractive );\n  \t}\n  };\n\n  Model.prototype.registerPatternObserver = function registerPatternObserver ( observer ) {\n  \tthis.patternObservers.push( observer );\n  \tthis.register( observer );\n  };\n\n  Model.prototype.registerTwowayBinding = function registerTwowayBinding ( binding ) {\n  \tthis.bindings.push( binding );\n  };\n\n  Model.prototype.removeUnresolved = function removeUnresolved ( key, resolver ) {\n  \tvar resolvers = this.unresolvedByKey[ key ];\n\n  \tif ( resolvers ) {\n  \t\tremoveFromArray( resolvers, resolver );\n  \t}\n  };\n\n  Model.prototype.retrieve = function retrieve () {\n  \treturn this.parent.value ? this.parent.value[ this.key ] : undefined;\n  };\n\n  Model.prototype.set = function set ( value ) {\n  \tif ( this.ticker ) this.ticker.stop();\n  \tthis.applyValue( value );\n  };\n\n  Model.prototype.shuffle = function shuffle ( newIndices ) {\n  \tvar this$1 = this;\n\n  \t\tvar indexModels = [];\n\n  \tnewIndices.forEach( function ( newIndex, oldIndex ) {\n  \t\tif ( newIndex !== oldIndex && this$1.childByKey[oldIndex] ) this$1.childByKey[oldIndex].shuffled();\n\n  \t\tif ( !~newIndex ) return;\n\n  \t\tvar model = this$1.indexModels[ oldIndex ];\n\n  \t\tif ( !model ) return;\n\n  \t\tindexModels[ newIndex ] = model;\n\n  \t\tif ( newIndex !== oldIndex ) {\n  \t\t\tmodel.rebind( newIndex );\n  \t\t}\n  \t});\n\n  \tthis.indexModels = indexModels;\n\n  \t// shuffles need to happen before marks...\n  \tthis.deps.forEach( function ( dep ) {\n  \t\tif ( dep.shuffle ) dep.shuffle( newIndices );\n  \t});\n\n  \tthis.updateKeypathDependants();\n  \tthis.mark();\n\n  \t// ...but handleChange must happen after (TODO document why)\n  \tthis.deps.forEach( function ( dep ) {\n  \t\tif ( !dep.shuffle ) dep.handleChange();\n  \t});\n  };\n\n  Model.prototype.shuffled = function shuffled () {\n  \tvar this$1 = this;\n\n  \t\tvar i = this.children.length;\n  \twhile ( i-- ) {\n  \t\tthis$1.children[i].shuffled();\n  \t}\n  \tif ( this.wrapper ) {\n  \t\tthis.wrapper.teardown();\n  \t\tthis.wrapper = null;\n  \t\tthis.rewrap = true;\n  \t}\n  };\n\n  Model.prototype.teardown = function teardown$1 () {\n  \tthis.children.forEach( teardown );\n  \tif ( this.wrapper ) this.wrapper.teardown();\n  \tif ( this.keypathModels ) {\n  \t\tfor ( var k in this.keypathModels ) {\n  \t\t\tthis.keypathModels[ k ].teardown();\n  \t\t}\n  \t}\n  };\n\n  Model.prototype.unregister = function unregister ( dependant ) {\n  \tremoveFromArray( this.deps, dependant );\n  };\n\n  Model.prototype.unregisterPatternObserver = function unregisterPatternObserver ( observer ) {\n  \tremoveFromArray( this.patternObservers, observer );\n  \tthis.unregister( observer );\n  };\n\n  Model.prototype.unregisterTwowayBinding = function unregisterTwowayBinding ( binding ) {\n  \tremoveFromArray( this.bindings, binding );\n  };\n\n  Model.prototype.updateFromBindings = function updateFromBindings$1 ( cascade ) {\n  \tvar this$1 = this;\n\n  \t\tvar i = this.bindings.length;\n  \twhile ( i-- ) {\n  \t\tvar value = this$1.bindings[i].getValue();\n  \t\tif ( value !== this$1.value ) this$1.set( value );\n  \t}\n\n  \tif ( cascade ) {\n  \t\tthis.children.forEach( updateFromBindings );\n  \t}\n  };\n\n  Model.prototype.updateKeypathDependants = function updateKeypathDependants$1 () {\n  \tthis.children.forEach( updateKeypathDependants );\n  \tif ( this.keypathModel ) this.keypathModel.handleChange();\n  };\n\n  var GlobalModel = (function (Model) {\n  \tfunction GlobalModel ( ) {\n  \t\tModel.call( this, null, '@global' );\n  \t\tthis.value = typeof global !== 'undefined' ? global : window;\n  \t\tthis.isRoot = true;\n  \t\tthis.root = this;\n  \t\tthis.adaptors = [];\n  \t}\n\n  \tGlobalModel.prototype = Object.create( Model && Model.prototype );\n  \tGlobalModel.prototype.constructor = GlobalModel;\n\n  \tGlobalModel.prototype.getKeypath = function getKeypath() {\n  \t\treturn '@global';\n  \t};\n\n  \t// global model doesn't contribute changes events because it has no instance\n  \tGlobalModel.prototype.registerChange = function registerChange () {};\n\n  \treturn GlobalModel;\n  }(Model));\n\n  var GlobalModel$1 = new GlobalModel();\n\n  var keypathExpr = /^@[^\\(]+\\(([^\\)]+)\\)/;\n\n  function resolveReference ( fragment, ref ) {\n  \tvar context = fragment.findContext();\n\n  \t// special references\n  \t// TODO does `this` become `.` at parse time?\n  \tif ( ref === '.' || ref === 'this' ) return context;\n  \tif ( ref.indexOf( '@keypath' ) === 0 ) {\n  \t\tvar match = keypathExpr.exec( ref );\n  \t\tif ( match && match[1] ) {\n  \t\t\tvar model = resolveReference( fragment, match[1] );\n  \t\t\tif ( model ) return model.getKeypathModel( fragment.ractive );\n  \t\t}\n  \t\treturn context.getKeypathModel( fragment.ractive );\n  \t}\n  \tif ( ref.indexOf( '@rootpath' ) === 0 ) {\n  \t\tvar match$1 = keypathExpr.exec( ref );\n  \t\tif ( match$1 && match$1[1] ) {\n  \t\t\tvar model$1 = resolveReference( fragment, match$1[1] );\n  \t\t\tif ( model$1 ) return model$1.getKeypathModel();\n  \t\t}\n  \t\treturn context.getKeypathModel();\n  \t}\n  \tif ( ref === '@index' ) {\n  \t\tvar repeater = fragment.findRepeatingFragment();\n  \t\t// make sure the found fragment is actually an iteration\n  \t\tif ( !repeater.isIteration ) return;\n  \t\treturn repeater.context.getIndexModel( repeater.index );\n  \t}\n  \tif ( ref === '@key' ) return fragment.findRepeatingFragment().context.getKeyModel();\n  \tif ( ref === '@this' ) {\n  \t\treturn fragment.ractive.viewmodel.getRactiveModel();\n  \t}\n  \tif ( ref === '@global' ) {\n  \t\treturn GlobalModel$1;\n  \t}\n\n  \t// ancestor references\n  \tif ( ref[0] === '~' ) return fragment.ractive.viewmodel.joinAll( splitKeypathI( ref.slice( 2 ) ) );\n  \tif ( ref[0] === '.' ) {\n  \t\tvar parts = ref.split( '/' );\n\n  \t\twhile ( parts[0] === '.' || parts[0] === '..' ) {\n  \t\t\tvar part = parts.shift();\n\n  \t\t\tif ( part === '..' ) {\n  \t\t\t\tcontext = context.parent;\n  \t\t\t}\n  \t\t}\n\n  \t\tref = parts.join( '/' );\n\n  \t\t// special case - `{{.foo}}` means the same as `{{./foo}}`\n  \t\tif ( ref[0] === '.' ) ref = ref.slice( 1 );\n  \t\treturn context.joinAll( splitKeypathI( ref ) );\n  \t}\n\n  \treturn resolveAmbiguousReference( fragment, ref );\n  }\n\n  function Ractive$get ( keypath ) {\n  \tif ( !keypath ) return this.viewmodel.get( true );\n\n  \tvar keys = splitKeypathI( keypath );\n  \tvar key = keys[0];\n\n  \tvar model;\n\n  \tif ( !this.viewmodel.has( key ) ) {\n  \t\t// if this is an inline component, we may need to create\n  \t\t// an implicit mapping\n  \t\tif ( this.component && !this.isolated ) {\n  \t\t\tmodel = resolveReference( this.component.parentFragment, key );\n\n  \t\t\tif ( model ) {\n  \t\t\t\tthis.viewmodel.map( key, model );\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \tmodel = this.viewmodel.joinAll( keys );\n  \treturn model.get( true );\n  }\n\n  function gatherRefs( fragment ) {\n  \tvar key = {}, index = {};\n\n  \t// walk up the template gather refs as we go\n  \twhile ( fragment ) {\n  \t\tif ( fragment.parent && ( fragment.parent.indexRef || fragment.parent.keyRef ) ) {\n  \t\t\tvar ref = fragment.parent.indexRef;\n  \t\t\tif ( ref && !( ref in index ) ) index[ref] = fragment.index;\n  \t\t\tref = fragment.parent.keyRef;\n  \t\t\tif ( ref && !( ref in key ) ) key[ref] = fragment.key;\n  \t\t}\n\n  \t\tif ( fragment.componentParent && !fragment.ractive.isolated ) {\n  \t\t\tfragment = fragment.componentParent;\n  \t\t} else {\n  \t\t\tfragment = fragment.parent;\n  \t\t}\n  \t}\n\n  \treturn { key: key, index: index };\n  }\n\n  // get relative keypaths and values\n  function get ( keypath ) {\n  \tif ( !keypath ) return this._element.parentFragment.findContext().get();\n\n  \tvar model = resolveReference( this._element.parentFragment, keypath );\n\n  \treturn model ? model.get() : undefined;\n  }\n\n  function resolve$1 ( path, ractive ) {\n  \tvar frag = this._element.parentFragment;\n\n  \tif ( typeof path !== 'string' ) {\n  \t\treturn frag.findContext().getKeypath( path === undefined ? frag.ractive : path );\n  \t}\n\n  \tvar model = resolveReference( frag, path );\n\n  \treturn model ? model.getKeypath( ractive === undefined ? frag.ractive : ractive ) : path;\n  }\n\n  // the usual mutation suspects\n  function add$1 ( keypath, value ) {\n  \treturn this.ractive.add( this.resolve( keypath ), value );\n  }\n\n  function animate ( keypath, value, options ) {\n  \treturn this.ractive.animate( this.resolve( keypath ), value, options );\n  }\n\n  function link ( source, dest ) {\n  \treturn this.ractive.link( this.resolve( source ), this.resolve( dest ) );\n  }\n\n  function merge ( keypath, array ) {\n  \treturn this.ractive.merge( this.resolve( keypath ), array );\n  }\n\n  function pop ( keypath ) {\n  \treturn this.ractive.pop( this.resolve( keypath ) );\n  }\n\n  function push ( keypath ) {\n  \tvar values = [], len = arguments.length - 1;\n  \twhile ( len-- > 0 ) values[ len ] = arguments[ len + 1 ];\n\n  \tvalues.unshift( this.resolve( keypath ) );\n  \treturn this.ractive.push.apply( this.ractive, values );\n  }\n\n  function set ( keypath, value ) {\n  \treturn this.ractive.set( this.resolve( keypath ), value );\n  }\n\n  function shift ( keypath ) {\n  \treturn this.ractive.shift( this.resolve( keypath ) );\n  }\n\n  function splice ( keypath, index, drop ) {\n  \tvar add = [], len = arguments.length - 3;\n  \twhile ( len-- > 0 ) add[ len ] = arguments[ len + 3 ];\n\n  \tadd.unshift( this.resolve( keypath ), index, drop );\n  \treturn this.ractive.splice.apply( this.ractive, add );\n  }\n\n  function subtract ( keypath, value ) {\n  \treturn this.ractive.subtract( this.resolve( keypath ), value );\n  }\n\n  function toggle ( keypath ) {\n  \treturn this.ractive.toggle( this.resolve( keypath ) );\n  }\n\n  function unlink ( dest ) {\n  \treturn this.ractive.unlink( dest );\n  }\n\n  function unshift ( keypath ) {\n  \tvar add = [], len = arguments.length - 1;\n  \twhile ( len-- > 0 ) add[ len ] = arguments[ len + 1 ];\n\n  \tadd.unshift( this.resolve( keypath ) );\n  \treturn this.ractive.unshift.apply( this.ractive, add );\n  }\n\n  function update$1 ( keypath ) {\n  \treturn this.ractive.update( this.resolve( keypath ) );\n  }\n\n  function updateModel ( keypath, cascade ) {\n  \treturn this.ractive.updateModel( this.resolve( keypath ), cascade );\n  }\n\n  // two-way binding related helpers\n  function isBound () {\n  \tvar el = this._element;\n\n  \tif ( el.binding ) return true;\n  \telse return false;\n  }\n\n  function getBindingPath ( ractive ) {\n  \tvar el = this._element;\n\n  \tif ( el.binding && el.binding.model ) return el.binding.model.getKeypath( ractive || el.parentFragment.ractive );\n  }\n\n  function getBinding () {\n  \tvar el = this._element;\n\n  \tif ( el.binding && el.binding.model ) return el.binding.model.get();\n  }\n\n  function setBinding ( value ) {\n  \treturn this.ractive.set( this.getBindingPath(), value );\n  }\n\n  // deprecated getters\n  function keypath () {\n  \twarnOnceIfDebug( (\"Object property keypath is deprecated, please use resolve() instead.\") );\n  \treturn this.resolve();\n  }\n\n  function rootpath () {\n  \twarnOnceIfDebug( (\"Object property rootpath is deprecated, please use resolve( ractive.root ) instead.\") );\n  \treturn this.resolve( this.ractive.root );\n  }\n\n  function context () {\n  \twarnOnceIfDebug( (\"Object property context is deprecated, please use get() instead.\") );\n  \treturn this.get();\n  }\n\n  function index () {\n  \twarnOnceIfDebug( (\"Object property index is deprecated, you can use get( \\\"indexName\\\" ) instead.\") );\n  \treturn gatherRefs( this._element.parentFragment ).index;\n  }\n\n  function key () {\n  \twarnOnceIfDebug( (\"Object property key is deprecated, you can use get( \\\"keyName\\\" ) instead.\") );\n  \treturn gatherRefs( this._element.parentFragment ).key;\n  }\n\n  function addHelpers ( obj, element ) {\n  \tdefineProperties( obj, {\n  \t\t_element: { value: element },\n  \t\tractive: { value: element.parentFragment.ractive },\n  \t\tresolve: { value: resolve$1 },\n  \t\tget: { value: get },\n\n  \t\tadd: { value: add$1 },\n  \t\tanimate: { value: animate },\n  \t\tlink: { value: link },\n  \t\tmerge: { value: merge },\n  \t\tpop: { value: pop },\n  \t\tpush: { value: push },\n  \t\tset: { value: set },\n  \t\tshift: { value: shift },\n  \t\tsplice: { value: splice },\n  \t\tsubtract: { value: subtract },\n  \t\ttoggle: { value: toggle },\n  \t\tunlink: { value: unlink },\n  \t\tunshift: { value: unshift },\n  \t\tupdate: { value: update$1 },\n  \t\tupdateModel: { value: updateModel },\n\n  \t\tisBound: { value: isBound },\n  \t\tgetBindingPath: { value: getBindingPath },\n  \t\tgetBinding: { value: getBinding },\n  \t\tsetBinding: { value: setBinding },\n\n  \t\tkeypath: { get: keypath },\n  \t\trootpath: { get: rootpath },\n  \t\tcontext: { get: context },\n  \t\tindex: { get: index },\n  \t\tkey: { get: key }\n  \t});\n\n  \treturn obj;\n  }\n\n  var query = doc && doc.querySelector;\n\n  function staticInfo( node ) {\n  \tif ( typeof node === 'string' && query ) {\n  \t\tnode = query.call( document, node );\n  \t}\n\n  \tif ( !node || !node._ractive ) return {};\n\n  \tvar storage = node._ractive;\n\n  \treturn addHelpers( {}, storage.proxy );\n  }\n\n  function getNodeInfo( node ) {\n  \tif ( typeof node === 'string' ) {\n  \t\tnode = this.find( node );\n  \t}\n\n  \treturn staticInfo( node );\n  }\n\n  var insertHook = new Hook( 'insert' );\n\n  function Ractive$insert ( target, anchor ) {\n  \tif ( !this.fragment.rendered ) {\n  \t\t// TODO create, and link to, documentation explaining this\n  \t\tthrow new Error( 'The API has changed - you must call `ractive.render(target[, anchor])` to render your Ractive instance. Once rendered you can use `ractive.insert()`.' );\n  \t}\n\n  \ttarget = getElement( target );\n  \tanchor = getElement( anchor ) || null;\n\n  \tif ( !target ) {\n  \t\tthrow new Error( 'You must specify a valid target to insert into' );\n  \t}\n\n  \ttarget.insertBefore( this.detach(), anchor );\n  \tthis.el = target;\n\n  \t( target.__ractive_instances__ || ( target.__ractive_instances__ = [] ) ).push( this );\n  \tthis.isDetached = false;\n\n  \tfireInsertHook( this );\n  }\n\n  function fireInsertHook( ractive ) {\n  \tinsertHook.fire( ractive );\n\n  \tractive.findAllComponents('*').forEach( function ( child ) {\n  \t\tfireInsertHook( child.instance );\n  \t});\n  }\n\n  function link$1( there, here ) {\n  \tif ( here === there || (there + '.').indexOf( here + '.' ) === 0 || (here + '.').indexOf( there + '.' ) === 0 ) {\n  \t\tthrow new Error( 'A keypath cannot be linked to itself.' );\n  \t}\n\n  \tvar promise = runloop.start();\n\n  \tvar model;\n  \tvar ln = this._links[ here ];\n\n  \tif ( ln ) {\n  \t\tif ( ln.source.model.str !== there || ln.dest.model.str !== here ) {\n  \t\t\tln.unlink();\n  \t\t\tdelete this._links[ here ];\n  \t\t\tthis.viewmodel.joinAll( splitKeypathI( here ) ).set( ln.initialValue );\n  \t\t} else { // already linked, so nothing to do\n  \t\t\trunloop.end();\n  \t\t\treturn promise;\n  \t\t}\n  \t}\n\n  \t// may need to allow a mapping to resolve implicitly\n  \tvar sourcePath = splitKeypathI( there );\n  \tif ( !this.viewmodel.has( sourcePath[0] ) && this.component ) {\n  \t\tmodel = resolveReference( this.component.parentFragment, sourcePath[0] );\n\n  \t\tif ( model ) {\n  \t\t\tthis.viewmodel.map( sourcePath[0], model );\n  \t\t}\n  \t}\n\n  \tln = new Link( this.viewmodel.joinAll( sourcePath ), this.viewmodel.joinAll( splitKeypathI( here ) ), this );\n  \tthis._links[ here ] = ln;\n  \tln.source.handleChange();\n\n  \trunloop.end();\n\n  \treturn promise;\n  }\n\n  var Link = function Link ( source, dest, ractive ) {\n  \tthis.source = new LinkSide( source, this );\n  \tthis.dest = new LinkSide( dest, this );\n  \tthis.ractive = ractive;\n  \tthis.locked = false;\n  \tthis.initialValue = dest.get();\n  };\n\n  Link.prototype.sync = function sync ( side ) {\n  \tif ( !this.locked ) {\n  \t\tthis.locked = true;\n\n  \t\tif ( side === this.dest ) {\n  \t\t\tthis.source.model.set( this.dest.model.get() );\n  \t\t} else {\n  \t\t\tthis.dest.model.set( this.source.model.get() );\n  \t\t}\n\n  \t\tthis.locked = false;\n  \t}\n  };\n\n  Link.prototype.unlink = function unlink () {\n  \tthis.source.model.unregister( this.source );\n  \tthis.dest.model.unregister( this.dest );\n  };\n\n  var LinkSide = function LinkSide ( model, owner ) {\n  \tthis.model = model;\n  \tthis.owner = owner;\n  \tmodel.register( this );\n  };\n\n  LinkSide.prototype.handleChange = function handleChange () {\n  \tthis.owner.sync( this );\n  };\n\n  var comparators = {};\n\n  function getComparator ( option ) {\n  \tif ( !option ) return null; // use existing arrays\n  \tif ( option === true ) return JSON.stringify;\n  \tif ( typeof option === 'function' ) return option;\n\n  \tif ( typeof option === 'string' ) {\n  \t\treturn comparators[ option ] || ( comparators[ option ] = function ( thing ) { return thing[ option ]; } );\n  \t}\n\n  \tthrow new Error( 'If supplied, options.compare must be a string, function, or `true`' ); // TODO link to docs\n  }\n\n  function Ractive$merge ( keypath, array, options ) {\n  \tvar model = this.viewmodel.joinAll( splitKeypathI( keypath ) );\n  \tvar promise = runloop.start( this, true );\n  \tvar value = model.get();\n\n  \tif ( array === value ) {\n  \t\tthrow new Error( 'You cannot merge an array with itself' ); // TODO link to docs\n  \t} else if ( !isArray( value ) || !isArray( array ) ) {\n  \t\tthrow new Error( 'You cannot merge an array with a non-array' );\n  \t}\n\n  \tvar comparator = getComparator( options && options.compare );\n  \tmodel.merge( array, comparator );\n\n  \trunloop.end();\n  \treturn promise;\n  }\n\n  function observe ( keypath, callback, options ) {\n  \tvar this$1 = this;\n\n  \tvar observers = [];\n  \tvar map;\n\n  \tif ( isObject( keypath ) ) {\n  \t\tmap = keypath;\n  \t\toptions = callback || {};\n\n  \t\tObject.keys( map ).forEach( function ( keypath ) {\n  \t\t\tvar callback = map[ keypath ];\n\n  \t\t\tkeypath.split( ' ' ).forEach( function ( keypath ) {\n  \t\t\t\tobservers.push( createObserver( this$1, keypath, callback, options ) );\n  \t\t\t});\n  \t\t});\n  \t}\n\n  \telse {\n  \t\tvar keypaths;\n\n  \t\tif ( typeof keypath === 'function' ) {\n  \t\t\toptions = callback;\n  \t\t\tcallback = keypath;\n  \t\t\tkeypaths = [ '' ];\n  \t\t} else {\n  \t\t\tkeypaths = keypath.split( ' ' );\n  \t\t}\n\n  \t\tkeypaths.forEach( function ( keypath ) {\n  \t\t\tobservers.push( createObserver( this$1, keypath, callback, options || {} ) );\n  \t\t});\n  \t}\n\n  \t// add observers to the Ractive instance, so they can be\n  \t// cancelled on ractive.teardown()\n  \tthis._observers.push.apply( this._observers, observers );\n\n  \treturn {\n  \t\tcancel: function () {\n  \t\t\tobservers.forEach( function ( observer ) {\n  \t\t\t\tremoveFromArray ( this$1._observers, observer );\n  \t\t\t\tobserver.cancel();\n  \t\t\t} );\n  \t\t}\n  \t};\n  }\n\n  function createObserver ( ractive, keypath, callback, options ) {\n  \tvar viewmodel = ractive.viewmodel;\n\n  \tvar keys = splitKeypathI( keypath );\n  \tvar wildcardIndex = keys.indexOf( '*' );\n\n  \t// normal keypath - no wildcards\n  \tif ( !~wildcardIndex ) {\n  \t\tvar key = keys[0];\n\n  \t\t// if not the root model itself, check if viewmodel has key.\n  \t\tif ( key !== '' && !viewmodel.has( key ) ) {\n  \t\t\t// if this is an inline component, we may need to create an implicit mapping\n  \t\t\tif ( ractive.component ) {\n  \t\t\t\tvar model = resolveReference( ractive.component.parentFragment, key );\n  \t\t\t\tif ( model ) viewmodel.map( key, model );\n  \t\t\t}\n  \t\t}\n\n  \t\tvar model$1 = viewmodel.joinAll( keys );\n  \t\treturn new Observer( ractive, model$1, callback, options );\n  \t}\n\n  \t// pattern observers - more complex case\n  \tvar baseModel = wildcardIndex === 0 ?\n  \t\tviewmodel :\n  \t\tviewmodel.joinAll( keys.slice( 0, wildcardIndex ) );\n\n  \treturn new PatternObserver( ractive, baseModel, keys.splice( wildcardIndex ), callback, options );\n  }\n\n  var Observer = function Observer ( ractive, model, callback, options ) {\n  \tthis.context = options.context || ractive;\n  \tthis.model = model;\n  \tthis.keypath = model.getKeypath( ractive );\n  \tthis.callback = callback;\n\n  \tthis.oldValue = undefined;\n  \tthis.newValue = model.get();\n\n  \tthis.defer = options.defer;\n  \tthis.once = options.once;\n  \tthis.strict = options.strict;\n\n  \tthis.dirty = false;\n\n  \tif ( options.init !== false ) {\n  \t\tthis.dispatch();\n  \t} else {\n  \t\tthis.oldValue = this.newValue;\n  \t}\n\n  \tmodel.register( this );\n  };\n\n  Observer.prototype.cancel = function cancel () {\n  \tthis.model.unregister( this );\n  };\n\n  Observer.prototype.dispatch = function dispatch () {\n  \tthis.callback.call( this.context, this.newValue, this.oldValue, this.keypath );\n  \tthis.oldValue = this.newValue;\n  \tthis.dirty = false;\n  };\n\n  Observer.prototype.handleChange = function handleChange () {\n  \tif ( !this.dirty ) {\n  \t\tthis.newValue = this.model.get();\n\n  \t\tif ( this.strict && this.newValue === this.oldValue ) return;\n\n  \t\trunloop.addObserver( this, this.defer );\n  \t\tthis.dirty = true;\n\n  \t\tif ( this.once ) this.cancel();\n  \t}\n  };\n\n  var PatternObserver = function PatternObserver ( ractive, baseModel, keys, callback, options ) {\n  \tvar this$1 = this;\n\n  \t\tthis.context = options.context || ractive;\n  \tthis.ractive = ractive;\n  \tthis.baseModel = baseModel;\n  \tthis.keys = keys;\n  \tthis.callback = callback;\n\n  \tvar pattern = keys.join( '\\\\.' ).replace( /\\*/g, '(.+)' );\n  \tvar baseKeypath = baseModel.getKeypath( ractive );\n  \tthis.pattern = new RegExp( (\"^\" + (baseKeypath ? baseKeypath + '\\\\.' : '') + \"\" + pattern + \"$\") );\n\n  \tthis.oldValues = {};\n  \tthis.newValues = {};\n\n  \tthis.defer = options.defer;\n  \tthis.once = options.once;\n  \tthis.strict = options.strict;\n\n  \tthis.dirty = false;\n  \tthis.changed = [];\n  \tthis.partial = false;\n\n  \tvar models = baseModel.findMatches( this.keys );\n\n  \tmodels.forEach( function ( model ) {\n  \t\tthis$1.newValues[ model.getKeypath( this$1.ractive ) ] = model.get();\n  \t});\n\n  \tif ( options.init !== false ) {\n  \t\tthis.dispatch();\n  \t} else {\n  \t\tthis.oldValues = this.newValues;\n  \t}\n\n  \tbaseModel.registerPatternObserver( this );\n  };\n\n  PatternObserver.prototype.cancel = function cancel () {\n  \tthis.baseModel.unregisterPatternObserver( this );\n  };\n\n  PatternObserver.prototype.dispatch = function dispatch () {\n  \tvar this$1 = this;\n\n  \t\tObject.keys( this.newValues ).forEach( function ( keypath ) {\n  \t\tif ( this$1.newKeys && !this$1.newKeys[ keypath ] ) return;\n\n  \t\tvar newValue = this$1.newValues[ keypath ];\n  \t\tvar oldValue = this$1.oldValues[ keypath ];\n\n  \t\tif ( this$1.strict && newValue === oldValue ) return;\n  \t\tif ( isEqual( newValue, oldValue ) ) return;\n\n  \t\tvar args = [ newValue, oldValue, keypath ];\n  \t\tif ( keypath ) {\n  \t\t\tvar wildcards = this$1.pattern.exec( keypath ).slice( 1 );\n  \t\t\targs = args.concat( wildcards );\n  \t\t}\n\n  \t\tthis$1.callback.apply( this$1.context, args );\n  \t});\n\n  \tif ( this.partial ) {\n  \t\tfor ( var k in this.newValues ) {\n  \t\t\tthis.oldValues[k] = this.newValues[k];\n  \t\t}\n  \t} else {\n  \t\tthis.oldValues = this.newValues;\n  \t}\n\n  \tthis.newKeys = null;\n  \tthis.dirty = false;\n  };\n\n  PatternObserver.prototype.notify = function notify ( key ) {\n  \tthis.changed.push( key );\n  };\n\n  PatternObserver.prototype.shuffle = function shuffle ( newIndices ) {\n  \tvar this$1 = this;\n\n  \t\tif ( !isArray( this.baseModel.value ) ) return;\n\n  \tvar base = this.baseModel.getKeypath( this.ractive );\n  \tvar max = this.baseModel.value.length;\n  \tvar suffix = this.keys.length > 1 ? '.' + this.keys.slice( 1 ).join( '.' ) : '';\n\n  \tthis.newKeys = {};\n  \tfor ( var i = 0; i < newIndices.length; i++ ) {\n  \t\tif ( newIndices[ i ] === -1 || newIndices[ i ] === i ) continue;\n  \t\tthis$1.newKeys[ (\"\" + base + \".\" + i + \"\" + suffix) ] = true;\n  \t}\n\n  \tfor ( var i$1 = newIndices.touchedFrom; i$1 < max; i$1++ ) {\n  \t\tthis$1.newKeys[ (\"\" + base + \".\" + i$1 + \"\" + suffix) ] = true;\n  \t}\n  };\n\n  PatternObserver.prototype.handleChange = function handleChange () {\n  \tvar this$1 = this;\n\n  \t\tif ( !this.dirty ) {\n  \t\tthis.newValues = {};\n\n  \t\t// handle case where previously extant keypath no longer exists -\n  \t\t// observer should still fire, with undefined as new value\n  \t\t// TODO huh. according to the test suite that's not the case...\n  \t\t// Object.keys( this.oldValues ).forEach( keypath => {\n  \t\t// this.newValues[ keypath ] = undefined;\n  \t\t// });\n\n  \t\tif ( !this.changed.length ) {\n  \t\t\tthis.baseModel.findMatches( this.keys ).forEach( function ( model ) {\n  \t\t\t\tvar keypath = model.getKeypath( this$1.ractive );\n  \t\t\t\tthis$1.newValues[ keypath ] = model.get();\n  \t\t\t});\n  \t\t\tthis.partial = false;\n  \t\t} else {\n  \t\t\tvar ok = this.baseModel.isRoot ?\n  \t\t\t\tthis.changed :\n  \t\t\t\tthis.changed.map( function ( key ) { return this$1.baseModel.getKeypath( this$1.ractive ) + '.' + escapeKey( key ); } );\n\n  \t\t\tthis.baseModel.findMatches( this.keys ).forEach( function ( model ) {\n  \t\t\t\tvar keypath = model.getKeypath( this$1.ractive );\n  \t\t\t\t// is this model on a changed keypath?\n  \t\t\t\tif ( ok.filter( function ( k ) { return keypath.indexOf( k ) === 0 && ( keypath.length === k.length || keypath[k.length] === '.' ); } ).length ) {\n  \t\t\t\t\tthis$1.newValues[ keypath ] = model.get();\n  \t\t\t\t}\n  \t\t\t});\n  \t\t\tthis.partial = true;\n  \t\t}\n\n  \t\trunloop.addObserver( this, this.defer );\n  \t\tthis.dirty = true;\n  \t\tthis.changed.length = 0;\n\n  \t\tif ( this.once ) this.cancel();\n  \t}\n  };\n\n  function observeList ( keypath, callback, options ) {\n  \tif ( typeof keypath !== 'string' ) {\n  \t\tthrow new Error( 'ractive.observeList() must be passed a string as its first argument' );\n  \t}\n\n  \tvar model = this.viewmodel.joinAll( splitKeypathI( keypath ) );\n  \tvar observer = new ListObserver( this, model, callback, options || {} );\n\n  \t// add observer to the Ractive instance, so it can be\n  \t// cancelled on ractive.teardown()\n  \tthis._observers.push( observer );\n\n  \treturn {\n  \t\tcancel: function () {\n  \t\t\tobserver.cancel();\n  \t\t}\n  \t};\n  }\n\n  function negativeOne () {\n  \treturn -1;\n  }\n\n  var ListObserver = function ListObserver ( context, model, callback, options ) {\n  \tthis.context = context;\n  \tthis.model = model;\n  \tthis.keypath = model.getKeypath();\n  \tthis.callback = callback;\n\n  \tthis.pending = null;\n\n  \tmodel.register( this );\n\n  \tif ( options.init !== false ) {\n  \t\tthis.sliced = [];\n  \t\tthis.shuffle([]);\n  \t\tthis.handleChange();\n  \t} else {\n  \t\tthis.sliced = this.slice();\n  \t}\n  };\n\n  ListObserver.prototype.handleChange = function handleChange () {\n  \tif ( this.pending ) {\n  \t\t// post-shuffle\n  \t\tthis.callback( this.pending );\n  \t\tthis.pending = null;\n  \t}\n\n  \telse {\n  \t\t// entire array changed\n  \t\tthis.shuffle( this.sliced.map( negativeOne ) );\n  \t\tthis.handleChange();\n  \t}\n  };\n\n  ListObserver.prototype.shuffle = function shuffle ( newIndices ) {\n  \tvar this$1 = this;\n\n  \t\tvar newValue = this.slice();\n\n  \tvar inserted = [];\n  \tvar deleted = [];\n  \tvar start;\n\n  \tvar hadIndex = {};\n\n  \tnewIndices.forEach( function ( newIndex, oldIndex ) {\n  \t\thadIndex[ newIndex ] = true;\n\n  \t\tif ( newIndex !== oldIndex && start === undefined ) {\n  \t\t\tstart = oldIndex;\n  \t\t}\n\n  \t\tif ( newIndex === -1 ) {\n  \t\t\tdeleted.push( this$1.sliced[ oldIndex ] );\n  \t\t}\n  \t});\n\n  \tif ( start === undefined ) start = newIndices.length;\n\n  \tvar len = newValue.length;\n  \tfor ( var i = 0; i < len; i += 1 ) {\n  \t\tif ( !hadIndex[i] ) inserted.push( newValue[i] );\n  \t}\n\n  \tthis.pending = { inserted: inserted, deleted: deleted, start: start };\n  \tthis.sliced = newValue;\n  };\n\n  ListObserver.prototype.slice = function slice () {\n  \tvar value = this.model.get();\n  \treturn isArray( value ) ? value.slice() : [];\n  };\n\n  var onceOptions = { init: false, once: true };\n\n  function observeOnce ( keypath, callback, options ) {\n  \tif ( isObject( keypath ) || typeof keypath === 'function' ) {\n  \t\toptions = extendObj( callback || {}, onceOptions );\n  \t\treturn this.observe( keypath, options );\n  \t}\n\n  \toptions = extendObj( options || {}, onceOptions );\n  \treturn this.observe( keypath, callback, options );\n  }\n\n  function trim ( str ) { return str.trim(); };\n\n  function notEmptyString ( str ) { return str !== ''; };\n\n  function Ractive$off ( eventName, callback ) {\n  \t// if no arguments specified, remove all callbacks\n  \tvar this$1 = this;\n\n  \tif ( !eventName ) {\n  \t\t// TODO use this code instead, once the following issue has been resolved\n  \t\t// in PhantomJS (tests are unpassable otherwise!)\n  \t\t// https://github.com/ariya/phantomjs/issues/11856\n  \t\t// defineProperty( this, '_subs', { value: create( null ), configurable: true });\n  \t\tfor ( eventName in this._subs ) {\n  \t\t\tdelete this._subs[ eventName ];\n  \t\t}\n  \t}\n\n  \telse {\n  \t\t// Handle multiple space-separated event names\n  \t\tvar eventNames = eventName.split( ' ' ).map( trim ).filter( notEmptyString );\n\n  \t\teventNames.forEach( function ( eventName ) {\n  \t\t\tvar subscribers = this$1._subs[ eventName ];\n\n  \t\t\t// If we have subscribers for this event...\n  \t\t\tif ( subscribers ) {\n  \t\t\t\t// ...if a callback was specified, only remove that\n  \t\t\t\tif ( callback ) {\n  \t\t\t\t\tvar index = subscribers.indexOf( callback );\n  \t\t\t\t\tif ( index !== -1 ) {\n  \t\t\t\t\t\tsubscribers.splice( index, 1 );\n  \t\t\t\t\t}\n  \t\t\t\t}\n\n  \t\t\t\t// ...otherwise remove all callbacks\n  \t\t\t\telse {\n  \t\t\t\t\tthis$1._subs[ eventName ] = [];\n  \t\t\t\t}\n  \t\t\t}\n  \t\t});\n  \t}\n\n  \treturn this;\n  }\n\n  function Ractive$on ( eventName, callback ) {\n  \t// allow multiple listeners to be bound in one go\n  \tvar this$1 = this;\n\n  \tif ( typeof eventName === 'object' ) {\n  \t\tvar listeners = [];\n  \t\tvar n;\n\n  \t\tfor ( n in eventName ) {\n  \t\t\tif ( eventName.hasOwnProperty( n ) ) {\n  \t\t\t\tlisteners.push( this.on( n, eventName[ n ] ) );\n  \t\t\t}\n  \t\t}\n\n  \t\treturn {\n  \t\t\tcancel: function () {\n  \t\t\t\tvar listener;\n  \t\t\t\twhile ( listener = listeners.pop() ) listener.cancel();\n  \t\t\t}\n  \t\t};\n  \t}\n\n  \t// Handle multiple space-separated event names\n  \tvar eventNames = eventName.split( ' ' ).map( trim ).filter( notEmptyString );\n\n  \teventNames.forEach( function ( eventName ) {\n  \t\t( this$1._subs[ eventName ] || ( this$1._subs[ eventName ] = [] ) ).push( callback );\n  \t});\n\n  \treturn {\n  \t\tcancel: function () { return this$1.off( eventName, callback ); }\n  \t};\n  }\n\n  function Ractive$once ( eventName, handler ) {\n  \tvar listener = this.on( eventName, function () {\n  \t\thandler.apply( this, arguments );\n  \t\tlistener.cancel();\n  \t});\n\n  \t// so we can still do listener.cancel() manually\n  \treturn listener;\n  }\n\n  // This function takes an array, the name of a mutator method, and the\n  // arguments to call that mutator method with, and returns an array that\n  // maps the old indices to their new indices.\n\n  // So if you had something like this...\n  //\n  //     array = [ 'a', 'b', 'c', 'd' ];\n  //     array.push( 'e' );\n  //\n  // ...you'd get `[ 0, 1, 2, 3 ]` - in other words, none of the old indices\n  // have changed. If you then did this...\n  //\n  //     array.unshift( 'z' );\n  //\n  // ...the indices would be `[ 1, 2, 3, 4, 5 ]` - every item has been moved\n  // one higher to make room for the 'z'. If you removed an item, the new index\n  // would be -1...\n  //\n  //     array.splice( 2, 2 );\n  //\n  // ...this would result in [ 0, 1, -1, -1, 2, 3 ].\n  //\n  // This information is used to enable fast, non-destructive shuffling of list\n  // sections when you do e.g. `ractive.splice( 'items', 2, 2 );\n\n  function getNewIndices ( length, methodName, args ) {\n  \tvar spliceArguments, newIndices = [], removeStart, removeEnd, balance, i;\n\n  \tspliceArguments = getSpliceEquivalent( length, methodName, args );\n\n  \tif ( !spliceArguments ) {\n  \t\treturn null; // TODO support reverse and sort?\n  \t}\n\n  \tbalance = ( spliceArguments.length - 2 ) - spliceArguments[1];\n\n  \tremoveStart = Math.min( length, spliceArguments[0] );\n  \tremoveEnd = removeStart + spliceArguments[1];\n\n  \tfor ( i = 0; i < removeStart; i += 1 ) {\n  \t\tnewIndices.push( i );\n  \t}\n\n  \tfor ( ; i < removeEnd; i += 1 ) {\n  \t\tnewIndices.push( -1 );\n  \t}\n\n  \tfor ( ; i < length; i += 1 ) {\n  \t\tnewIndices.push( i + balance );\n  \t}\n\n  \t// there is a net shift for the rest of the array starting with index + balance\n  \tif ( balance !== 0 ) {\n  \t\tnewIndices.touchedFrom = spliceArguments[0];\n  \t} else {\n  \t\tnewIndices.touchedFrom = length;\n  \t}\n\n  \treturn newIndices;\n  }\n\n\n  // The pop, push, shift an unshift methods can all be represented\n  // as an equivalent splice\n  function getSpliceEquivalent ( length, methodName, args ) {\n  \tswitch ( methodName ) {\n  \t\tcase 'splice':\n  \t\t\tif ( args[0] !== undefined && args[0] < 0 ) {\n  \t\t\t\targs[0] = length + Math.max( args[0], -length );\n  \t\t\t}\n\n  \t\t\twhile ( args.length < 2 ) {\n  \t\t\t\targs.push( length - args[0] );\n  \t\t\t}\n\n  \t\t\tif ( typeof args[1] !== 'number' ) {\n  \t\t\t\targs[1] = length - args[0];\n  \t\t\t}\n\n  \t\t\t// ensure we only remove elements that exist\n  \t\t\targs[1] = Math.min( args[1], length - args[0] );\n\n  \t\t\treturn args;\n\n  \t\tcase 'sort':\n  \t\tcase 'reverse':\n  \t\t\treturn null;\n\n  \t\tcase 'pop':\n  \t\t\tif ( length ) {\n  \t\t\t\treturn [ length - 1, 1 ];\n  \t\t\t}\n  \t\t\treturn [ 0, 0 ];\n\n  \t\tcase 'push':\n  \t\t\treturn [ length, 0 ].concat( args );\n\n  \t\tcase 'shift':\n  \t\t\treturn [ 0, length ? 1 : 0 ];\n\n  \t\tcase 'unshift':\n  \t\t\treturn [ 0, 0 ].concat( args );\n  \t}\n  }\n\n  var arrayProto = Array.prototype;\n\n  function makeArrayMethod ( methodName ) {\n  \treturn function ( keypath ) {\n  \t\tvar args = [], len = arguments.length - 1;\n  \t\twhile ( len-- > 0 ) args[ len ] = arguments[ len + 1 ];\n\n  \t\tvar model = this.viewmodel.joinAll( splitKeypathI( keypath ) );\n  \t\tvar array = model.get();\n\n  \t\tif ( !isArray( array ) ) {\n  \t\t\tif ( array === undefined ) {\n  \t\t\t\tarray = [];\n  \t\t\t\tvar result$1 = arrayProto[ methodName ].apply( array, args );\n  \t\t\t\treturn this.set( keypath, array ).then( function () { return result$1; } );\n  \t\t\t} else {\n  \t\t\t\tthrow new Error( (\"shuffle array method \" + methodName + \" called on non-array at \" + (model.getKeypath())) );\n  \t\t\t}\n  \t\t}\n\n  \t\tvar newIndices = getNewIndices( array.length, methodName, args );\n  \t\tvar result = arrayProto[ methodName ].apply( array, args );\n\n  \t\tvar promise = runloop.start( this, true ).then( function () { return result; } );\n  \t\tpromise.result = result;\n\n  \t\tif ( newIndices ) {\n  \t\t\tmodel.shuffle( newIndices );\n  \t\t} else {\n  \t\t\tmodel.set( result );\n  \t\t}\n\n  \t\trunloop.end();\n\n  \t\treturn promise;\n  \t};\n  }\n\n  var pop$1 = makeArrayMethod( 'pop' );\n\n  var push$1 = makeArrayMethod( 'push' );\n\n  var PREFIX = '/* Ractive.js component styles */';\n\n  // Holds current definitions of styles.\n  var styleDefinitions = [];\n\n  // Flag to tell if we need to update the CSS\n  var isDirty = false;\n\n  // These only make sense on the browser. See additional setup below.\n  var styleElement = null;\n  var useCssText = null;\n\n  function addCSS( styleDefinition ) {\n  \tstyleDefinitions.push( styleDefinition );\n  \tisDirty = true;\n  }\n\n  function applyCSS() {\n\n  \t// Apply only seems to make sense when we're in the DOM. Server-side renders\n  \t// can call toCSS to get the updated CSS.\n  \tif ( !doc || !isDirty ) return;\n\n  \tif ( useCssText ) {\n  \t\tstyleElement.styleSheet.cssText = getCSS( null );\n  \t} else {\n  \t\tstyleElement.innerHTML = getCSS( null );\n  \t}\n\n  \tisDirty = false;\n  }\n\n  function getCSS( cssIds ) {\n\n  \tvar filteredStyleDefinitions = cssIds ? styleDefinitions.filter( function ( style ) { return ~cssIds.indexOf( style.id ); } ) : styleDefinitions;\n\n  \treturn filteredStyleDefinitions.reduce( function ( styles, style ) { return (\"\" + styles + \"\\n\\n/* {\" + (style.id) + \"} */\\n\" + (style.styles)); }, PREFIX );\n\n  }\n\n  // If we're on the browser, additional setup needed.\n  if ( doc && ( !styleElement || !styleElement.parentNode ) ) {\n\n  \tstyleElement = doc.createElement( 'style' );\n  \tstyleElement.type = 'text/css';\n\n  \tdoc.getElementsByTagName( 'head' )[ 0 ].appendChild( styleElement );\n\n  \tuseCssText = !!styleElement.styleSheet;\n  }\n\n  var renderHook = new Hook( 'render' );\n  var completeHook = new Hook( 'complete' );\n\n  function render$1 ( ractive, target, anchor, occupants ) {\n  \t// if `noIntro` is `true`, temporarily disable transitions\n  \tvar transitionsEnabled = ractive.transitionsEnabled;\n  \tif ( ractive.noIntro ) ractive.transitionsEnabled = false;\n\n  \tvar promise = runloop.start( ractive, true );\n  \trunloop.scheduleTask( function () { return renderHook.fire( ractive ); }, true );\n\n  \tif ( ractive.fragment.rendered ) {\n  \t\tthrow new Error( 'You cannot call ractive.render() on an already rendered instance! Call ractive.unrender() first' );\n  \t}\n\n  \tanchor = getElement( anchor ) || ractive.anchor;\n\n  \tractive.el = target;\n  \tractive.anchor = anchor;\n\n  \t// ensure encapsulated CSS is up-to-date\n  \tif ( ractive.cssId ) applyCSS();\n\n  \tif ( target ) {\n  \t\t( target.__ractive_instances__ || ( target.__ractive_instances__ = [] ) ).push( ractive );\n\n  \t\tif ( anchor ) {\n  \t\t\tvar docFrag = doc.createDocumentFragment();\n  \t\t\tractive.fragment.render( docFrag );\n  \t\t\ttarget.insertBefore( docFrag, anchor );\n  \t\t} else {\n  \t\t\tractive.fragment.render( target, occupants );\n  \t\t}\n  \t}\n\n  \trunloop.end();\n  \tractive.transitionsEnabled = transitionsEnabled;\n\n  \treturn promise.then( function () { return completeHook.fire( ractive ); } );\n  }\n\n  function Ractive$render ( target, anchor ) {\n  \ttarget = getElement( target ) || this.el;\n\n  \tif ( !this.append && target ) {\n  \t\t// Teardown any existing instances *before* trying to set up the new one -\n  \t\t// avoids certain weird bugs\n  \t\tvar others = target.__ractive_instances__;\n  \t\tif ( others ) others.forEach( teardown );\n\n  \t\t// make sure we are the only occupants\n  \t\tif ( !this.enhance ) {\n  \t\t\ttarget.innerHTML = ''; // TODO is this quicker than removeChild? Initial research inconclusive\n  \t\t}\n  \t}\n\n  \tvar occupants = this.enhance ? toArray( target.childNodes ) : null;\n  \tvar promise = render$1( this, target, anchor, occupants );\n\n  \tif ( occupants ) {\n  \t\twhile ( occupants.length ) target.removeChild( occupants.pop() );\n  \t}\n\n  \treturn promise;\n  }\n\n  var adaptConfigurator = {\n  \textend: function ( Parent, proto, options ) {\n  \t\tproto.adapt = combine( proto.adapt, ensureArray( options.adapt ) );\n  \t},\n\n  \tinit: function () {}\n  };\n\n  function combine ( a, b ) {\n  \tvar c = a.slice();\n  \tvar i = b.length;\n\n  \twhile ( i-- ) {\n  \t\tif ( !~c.indexOf( b[i] ) ) {\n  \t\t\tc.push( b[i] );\n  \t\t}\n  \t}\n\n  \treturn c;\n  }\n\n  var selectorsPattern = /(?:^|\\})?\\s*([^\\{\\}]+)\\s*\\{/g;\n  var commentsPattern = /\\/\\*.*?\\*\\//g;\n  var selectorUnitPattern = /((?:(?:\\[[^\\]+]\\])|(?:[^\\s\\+\\>~:]))+)((?:::?[^\\s\\+\\>\\~\\(:]+(?:\\([^\\)]+\\))?)*\\s*[\\s\\+\\>\\~]?)\\s*/g;\n  var excludePattern = /^(?:@|\\d+%)/;\n  var dataRvcGuidPattern = /\\[data-ractive-css~=\"\\{[a-z0-9-]+\\}\"]/g;\n\n  function trim$1 ( str ) {\n  \treturn str.trim();\n  }\n\n  function extractString ( unit ) {\n  \treturn unit.str;\n  }\n\n  function transformSelector ( selector, parent ) {\n  \tvar selectorUnits = [];\n  \tvar match;\n\n  \twhile ( match = selectorUnitPattern.exec( selector ) ) {\n  \t\tselectorUnits.push({\n  \t\t\tstr: match[0],\n  \t\t\tbase: match[1],\n  \t\t\tmodifiers: match[2]\n  \t\t});\n  \t}\n\n  \t// For each simple selector within the selector, we need to create a version\n  \t// that a) combines with the id, and b) is inside the id\n  \tvar base = selectorUnits.map( extractString );\n\n  \tvar transformed = [];\n  \tvar i = selectorUnits.length;\n\n  \twhile ( i-- ) {\n  \t\tvar appended = base.slice();\n\n  \t\t// Pseudo-selectors should go after the attribute selector\n  \t\tvar unit = selectorUnits[i];\n  \t\tappended[i] = unit.base + parent + unit.modifiers || '';\n\n  \t\tvar prepended = base.slice();\n  \t\tprepended[i] = parent + ' ' + prepended[i];\n\n  \t\ttransformed.push( appended.join( ' ' ), prepended.join( ' ' ) );\n  \t}\n\n  \treturn transformed.join( ', ' );\n  }\n\n  function transformCss ( css, id ) {\n  \tvar dataAttr = \"[data-ractive-css~=\\\"{\" + id + \"}\\\"]\";\n\n  \tvar transformed;\n\n  \tif ( dataRvcGuidPattern.test( css ) ) {\n  \t\ttransformed = css.replace( dataRvcGuidPattern, dataAttr );\n  \t} else {\n  \t\ttransformed = css\n  \t\t.replace( commentsPattern, '' )\n  \t\t.replace( selectorsPattern, function ( match, $1 ) {\n  \t\t\t// don't transform at-rules and keyframe declarations\n  \t\t\tif ( excludePattern.test( $1 ) ) return match;\n\n  \t\t\tvar selectors = $1.split( ',' ).map( trim$1 );\n  \t\t\tvar transformed = selectors\n  \t\t\t\t.map( function ( selector ) { return transformSelector( selector, dataAttr ); } )\n  \t\t\t\t.join( ', ' ) + ' ';\n\n  \t\t\treturn match.replace( $1, transformed );\n  \t\t});\n  \t}\n\n  \treturn transformed;\n  }\n\n  function s4() {\n  \treturn Math.floor((1 + Math.random()) * 0x10000).toString(16).substring(1);\n  }\n\n  function uuid() {\n  \treturn s4() + s4() + '-' + s4() + '-' + s4() + '-' + s4() + '-' + s4() + s4() + s4();\n  }\n\n  var cssConfigurator = {\n  \tname: 'css',\n\n  \t// Called when creating a new component definition\n  \textend: function ( Parent, proto, options ) {\n  \t\tif ( !options.css ) return;\n\n  \t\tvar id = uuid();\n  \t\tvar styles = options.noCssTransform ? options.css : transformCss( options.css, id );\n\n  \t\tproto.cssId = id;\n\n  \t\taddCSS( { id: id, styles: styles } );\n\n  \t},\n\n  \t// Called when creating a new component instance\n  \tinit: function ( Parent, target, options ) {\n  \t\tif ( !options.css ) return;\n\n  \t\twarnIfDebug( (\"\\nThe css option is currently not supported on a per-instance basis and will be discarded. Instead, we recommend instantiating from a component definition with a css option.\\n\\nconst Component = Ractive.extend({\\n\\t...\\n\\tcss: '/* your css */',\\n\\t...\\n});\\n\\nconst componentInstance = new Component({ ... })\\n\\t\\t\") );\n  \t}\n\n  };\n\n  function bind$1 ( fn, context ) {\n  \tif ( !/this/.test( fn.toString() ) ) return fn;\n\n  \tvar bound = fn.bind( context );\n  \tfor ( var prop in fn ) bound[ prop ] = fn[ prop ];\n\n  \treturn bound;\n  }\n\n  function validate ( data ) {\n  \t// Warn if userOptions.data is a non-POJO\n  \tif ( data && data.constructor !== Object ) {\n  \t\tif ( typeof data === 'function' ) {\n  \t\t\t// TODO do we need to support this in the new Ractive() case?\n  \t\t} else if ( typeof data !== 'object' ) {\n  \t\t\tfatal( (\"data option must be an object or a function, `\" + data + \"` is not valid\") );\n  \t\t} else {\n  \t\t\twarnIfDebug( 'If supplied, options.data should be a plain JavaScript object - using a non-POJO as the root object may work, but is discouraged' );\n  \t\t}\n  \t}\n  }\n\n  var dataConfigurator = {\n  \tname: 'data',\n\n  \textend: function ( Parent, proto, options ) {\n  \t\tvar key;\n  \t\tvar value;\n\n  \t\t// check for non-primitives, which could cause mutation-related bugs\n  \t\tif ( options.data && isObject( options.data ) ) {\n  \t\t\tfor ( key in options.data ) {\n  \t\t\t\tvalue = options.data[ key ];\n\n  \t\t\t\tif ( value && typeof value === 'object' ) {\n  \t\t\t\t\tif ( isObject( value ) || isArray( value ) ) {\n  \t\t\t\t\t\twarnIfDebug( (\"Passing a `data` option with object and array properties to Ractive.extend() is discouraged, as mutating them is likely to cause bugs. Consider using a data function instead:\\n\\n  // this...\\n  data: function () {\\n    return {\\n      myObject: {}\\n    };\\n  })\\n\\n  // instead of this:\\n  data: {\\n    myObject: {}\\n  }\") );\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\tproto.data = combine$1( proto.data, options.data );\n  \t},\n\n  \tinit: function ( Parent, ractive, options ) {\n  \t\tvar result = combine$1( Parent.prototype.data, options.data );\n\n  \t\tif ( typeof result === 'function' ) result = result.call( ractive );\n\n  \t\t// bind functions to the ractive instance at the top level,\n  \t\t// unless it's a non-POJO (in which case alarm bells should ring)\n  \t\tif ( result && result.constructor === Object ) {\n  \t\t\tfor ( var prop in result ) {\n  \t\t\t\tif ( typeof result[ prop ] === 'function' ) result[ prop ] = bind$1( result[ prop ], ractive );\n  \t\t\t}\n  \t\t}\n\n  \t\treturn result || {};\n  \t},\n\n  \treset: function ( ractive ) {\n  \t\tvar result = this.init( ractive.constructor, ractive, ractive.viewmodel );\n  \t\tractive.viewmodel.root.set( result );\n  \t\treturn true;\n  \t}\n  };\n\n  function combine$1 ( parentValue, childValue ) {\n  \tvalidate( childValue );\n\n  \tvar parentIsFn = typeof parentValue === 'function';\n  \tvar childIsFn = typeof childValue === 'function';\n\n  \t// Very important, otherwise child instance can become\n  \t// the default data object on Ractive or a component.\n  \t// then ractive.set() ends up setting on the prototype!\n  \tif ( !childValue && !parentIsFn ) {\n  \t\tchildValue = {};\n  \t}\n\n  \t// Fast path, where we just need to copy properties from\n  \t// parent to child\n  \tif ( !parentIsFn && !childIsFn ) {\n  \t\treturn fromProperties( childValue, parentValue );\n  \t}\n\n  \treturn function () {\n  \t\tvar child = childIsFn ? callDataFunction( childValue, this ) : childValue;\n  \t\tvar parent = parentIsFn ? callDataFunction( parentValue, this ) : parentValue;\n\n  \t\treturn fromProperties( child, parent );\n  \t};\n  }\n\n  function callDataFunction ( fn, context ) {\n  \tvar data = fn.call( context );\n\n  \tif ( !data ) return;\n\n  \tif ( typeof data !== 'object' ) {\n  \t\tfatal( 'Data function must return an object' );\n  \t}\n\n  \tif ( data.constructor !== Object ) {\n  \t\twarnOnceIfDebug( 'Data function returned something other than a plain JavaScript object. This might work, but is strongly discouraged' );\n  \t}\n\n  \treturn data;\n  }\n\n  function fromProperties ( primary, secondary ) {\n  \tif ( primary && secondary ) {\n  \t\tfor ( var key in secondary ) {\n  \t\t\tif ( !( key in primary ) ) {\n  \t\t\t\tprimary[ key ] = secondary[ key ];\n  \t\t\t}\n  \t\t}\n\n  \t\treturn primary;\n  \t}\n\n  \treturn primary || secondary;\n  }\n\n  var TEMPLATE_VERSION = 3;\n\n  var pattern = /\\$\\{([^\\}]+)\\}/g;\n\n  function fromExpression ( body, length ) {\n  \tif ( length === void 0 ) length = 0;\n\n  \tvar args = new Array( length );\n\n  \twhile ( length-- ) {\n  \t\targs[length] = \"_\" + length;\n  \t}\n\n  \t// Functions created directly with new Function() look like this:\n  \t//     function anonymous (_0 /**/) { return _0*2 }\n  \t//\n  \t// With this workaround, we get a little more compact:\n  \t//     function (_0){return _0*2}\n  \treturn new Function( [], (\"return function (\" + (args.join(',')) + \"){return(\" + body + \");};\") )();\n  }\n\n  function fromComputationString ( str, bindTo ) {\n  \tvar hasThis;\n\n  \tvar functionBody = 'return (' + str.replace( pattern, function ( match, keypath ) {\n  \t\thasThis = true;\n  \t\treturn (\"__ractive.get(\\\"\" + keypath + \"\\\")\");\n  \t}) + ');';\n\n  \tif ( hasThis ) functionBody = \"var __ractive = this; \" + functionBody;\n  \tvar fn = new Function( functionBody );\n  \treturn hasThis ? fn.bind( bindTo ) : fn;\n  }\n\n  var functions = create( null );\n\n  function getFunction ( str, i ) {\n  \tif ( functions[ str ] ) return functions[ str ];\n  \treturn functions[ str ] = createFunction( str, i );\n  }\n\n  function addFunctions( template ) {\n  \tif ( !template ) return;\n\n  \tvar exp = template.e;\n\n  \tif ( !exp ) return;\n\n  \tObject.keys( exp ).forEach( function ( str ) {\n  \t\tif ( functions[ str ] ) return;\n  \t\tfunctions[ str ] = exp[ str ];\n  \t});\n  }\n\n  var parse = null;\n\n  var parseOptions = [\n  \t'delimiters',\n  \t'tripleDelimiters',\n  \t'staticDelimiters',\n  \t'staticTripleDelimiters',\n  \t'csp',\n  \t'interpolate',\n  \t'preserveWhitespace',\n  \t'sanitize',\n  \t'stripComments'\n  ];\n\n  var TEMPLATE_INSTRUCTIONS = \"Either preparse or use a ractive runtime source that includes the parser. \";\n\n  var COMPUTATION_INSTRUCTIONS = \"Either use:\\n\\n\\tRactive.parse.computedStrings( component.computed )\\n\\nat build time to pre-convert the strings to functions, or use functions instead of strings in computed properties.\";\n\n\n  function throwNoParse ( method, error, instructions ) {\n  \tif ( !method ) {\n  \t\tfatal( (\"Missing Ractive.parse - cannot parse \" + error + \". \" + instructions) );\n  \t}\n  }\n\n  function createFunction ( body, length ) {\n  \tthrowNoParse( fromExpression, 'new expression function', TEMPLATE_INSTRUCTIONS );\n  \treturn fromExpression( body, length );\n  }\n\n  function createFunctionFromString ( str, bindTo ) {\n  \tthrowNoParse( fromComputationString, 'compution string \"${str}\"', COMPUTATION_INSTRUCTIONS );\n  \treturn fromComputationString( str, bindTo );\n  }\n\n  var parser = {\n\n  \tfromId: function ( id, options ) {\n  \t\tif ( !doc ) {\n  \t\t\tif ( options && options.noThrow ) { return; }\n  \t\t\tthrow new Error( (\"Cannot retrieve template #\" + id + \" as Ractive is not running in a browser.\") );\n  \t\t}\n\n  \t\tif ( id ) id = id.replace( /^#/, '' );\n\n  \t\tvar template;\n\n  \t\tif ( !( template = doc.getElementById( id ) )) {\n  \t\t\tif ( options && options.noThrow ) { return; }\n  \t\t\tthrow new Error( (\"Could not find template element with id #\" + id) );\n  \t\t}\n\n  \t\tif ( template.tagName.toUpperCase() !== 'SCRIPT' ) {\n  \t\t\tif ( options && options.noThrow ) { return; }\n  \t\t\tthrow new Error( (\"Template element with id #\" + id + \", must be a <script> element\") );\n  \t\t}\n\n  \t\treturn ( 'textContent' in template ? template.textContent : template.innerHTML );\n\n  \t},\n\n  \tisParsed: function ( template) {\n  \t\treturn !( typeof template === 'string' );\n  \t},\n\n  \tgetParseOptions: function ( ractive ) {\n  \t\t// Could be Ractive or a Component\n  \t\tif ( ractive.defaults ) { ractive = ractive.defaults; }\n\n  \t\treturn parseOptions.reduce( function ( val, key ) {\n  \t\t\tval[ key ] = ractive[ key ];\n  \t\t\treturn val;\n  \t\t}, {});\n  \t},\n\n  \tparse: function ( template, options ) {\n  \t\tthrowNoParse( parse, 'template', TEMPLATE_INSTRUCTIONS );\n  \t\tvar parsed = parse( template, options );\n  \t\taddFunctions( parsed );\n  \t\treturn parsed;\n  \t},\n\n  \tparseFor: function( template, ractive ) {\n  \t\treturn this.parse( template, this.getParseOptions( ractive ) );\n  \t}\n  };\n\n  var templateConfigurator = {\n  \tname: 'template',\n\n  \textend: function ( Parent, proto, options ) {\n  \t\t// only assign if exists\n  \t\tif ( 'template' in options ) {\n  \t\t\tvar template = options.template;\n\n  \t\t\tif ( typeof template === 'function' ) {\n  \t\t\t\tproto.template = template;\n  \t\t\t} else {\n  \t\t\t\tproto.template = parseTemplate( template, proto );\n  \t\t\t}\n  \t\t}\n  \t},\n\n  \tinit: function ( Parent, ractive, options ) {\n  \t\t// TODO because of prototypal inheritance, we might just be able to use\n  \t\t// ractive.template, and not bother passing through the Parent object.\n  \t\t// At present that breaks the test mocks' expectations\n  \t\tvar template = 'template' in options ? options.template : Parent.prototype.template;\n  \t\ttemplate = template || { v: TEMPLATE_VERSION, t: [] };\n\n  \t\tif ( typeof template === 'function' ) {\n  \t\t\tvar fn = template;\n  \t\t\ttemplate = getDynamicTemplate( ractive, fn );\n\n  \t\t\tractive._config.template = {\n  \t\t\t\tfn: fn,\n  \t\t\t\tresult: template\n  \t\t\t};\n  \t\t}\n\n  \t\ttemplate = parseTemplate( template, ractive );\n\n  \t\t// TODO the naming of this is confusing - ractive.template refers to [...],\n  \t\t// but Component.prototype.template refers to {v:1,t:[],p:[]}...\n  \t\t// it's unnecessary, because the developer never needs to access\n  \t\t// ractive.template\n  \t\tractive.template = template.t;\n\n  \t\tif ( template.p ) {\n  \t\t\textendPartials( ractive.partials, template.p );\n  \t\t}\n  \t},\n\n  \treset: function ( ractive ) {\n  \t\tvar result = resetValue( ractive );\n\n  \t\tif ( result ) {\n  \t\t\tvar parsed = parseTemplate( result, ractive );\n\n  \t\t\tractive.template = parsed.t;\n  \t\t\textendPartials( ractive.partials, parsed.p, true );\n\n  \t\t\treturn true;\n  \t\t}\n  \t}\n  };\n\n  function resetValue ( ractive ) {\n  \tvar initial = ractive._config.template;\n\n  \t// If this isn't a dynamic template, there's nothing to do\n  \tif ( !initial || !initial.fn ) {\n  \t\treturn;\n  \t}\n\n  \tvar result = getDynamicTemplate( ractive, initial.fn );\n\n  \t// TODO deep equality check to prevent unnecessary re-rendering\n  \t// in the case of already-parsed templates\n  \tif ( result !== initial.result ) {\n  \t\tinitial.result = result;\n  \t\treturn result;\n  \t}\n  }\n\n  function getDynamicTemplate ( ractive, fn ) {\n  \treturn fn.call( ractive, {\n  \t\tfromId: parser.fromId,\n  \t\tisParsed: parser.isParsed,\n  \t\tparse: function ( template, options ) {\n  \t\t\tif ( options === void 0 ) options = parser.getParseOptions( ractive );\n\n  \t\t\treturn parser.parse( template, options );\n  \t\t}\n  \t});\n  }\n\n  function parseTemplate ( template, ractive ) {\n  \tif ( typeof template === 'string' ) {\n  \t\t// parse will validate and add expression functions\n  \t\ttemplate = parseAsString( template, ractive );\n  \t}\n  \telse {\n  \t\t// need to validate and add exp for already parsed template\n  \t\tvalidate$1( template );\n  \t\taddFunctions( template );\n  \t}\n\n  \treturn template;\n  }\n\n  function parseAsString ( template, ractive ) {\n  \t// ID of an element containing the template?\n  \tif ( template[0] === '#' ) {\n  \t\ttemplate = parser.fromId( template );\n  \t}\n\n  \treturn parser.parseFor( template, ractive );\n  }\n\n  function validate$1( template ) {\n\n  \t// Check that the template even exists\n  \tif ( template == undefined ) {\n  \t\tthrow new Error( (\"The template cannot be \" + template + \".\") );\n  \t}\n\n  \t// Check the parsed template has a version at all\n  \telse if ( typeof template.v !== 'number' ) {\n  \t\tthrow new Error( 'The template parser was passed a non-string template, but the template doesn\\'t have a version.  Make sure you\\'re passing in the template you think you are.' );\n  \t}\n\n  \t// Check we're using the correct version\n  \telse if ( template.v !== TEMPLATE_VERSION ) {\n  \t\tthrow new Error( (\"Mismatched template version (expected \" + TEMPLATE_VERSION + \", got \" + (template.v) + \") Please ensure you are using the latest version of Ractive.js in your build process as well as in your app\") );\n  \t}\n  }\n\n  function extendPartials ( existingPartials, newPartials, overwrite ) {\n  \tif ( !newPartials ) return;\n\n  \t// TODO there's an ambiguity here - we need to overwrite in the `reset()`\n  \t// case, but not initially...\n\n  \tfor ( var key in newPartials ) {\n  \t\tif ( overwrite || !existingPartials.hasOwnProperty( key ) ) {\n  \t\t\texistingPartials[ key ] = newPartials[ key ];\n  \t\t}\n  \t}\n  }\n\n  var registryNames = [\n  \t'adaptors',\n  \t'components',\n  \t'computed',\n  \t'decorators',\n  \t'easing',\n  \t'events',\n  \t'interpolators',\n  \t'partials',\n  \t'transitions'\n  ];\n\n  var Registry = function Registry ( name, useDefaults ) {\n  \tthis.name = name;\n  \tthis.useDefaults = useDefaults;\n  };\n\n  Registry.prototype.extend = function extend ( Parent, proto, options ) {\n  \tthis.configure(\n  \t\tthis.useDefaults ? Parent.defaults : Parent,\n  \t\tthis.useDefaults ? proto : proto.constructor,\n  \t\toptions );\n  };\n\n  Registry.prototype.init = function init () {\n  \t// noop\n  };\n\n  Registry.prototype.configure = function configure ( Parent, target, options ) {\n  \tvar name = this.name;\n  \tvar option = options[ name ];\n\n  \tvar registry = create( Parent[name] );\n\n  \tfor ( var key in option ) {\n  \t\tregistry[ key ] = option[ key ];\n  \t}\n\n  \ttarget[ name ] = registry;\n  };\n\n  Registry.prototype.reset = function reset ( ractive ) {\n  \tvar registry = ractive[ this.name ];\n  \tvar changed = false;\n\n  \tObject.keys( registry ).forEach( function ( key ) {\n  \t\tvar item = registry[ key ];\n  \t\t\t\n  \t\tif ( item._fn ) {\n  \t\t\tif ( item._fn.isOwner ) {\n  \t\t\t\tregistry[key] = item._fn;\n  \t\t\t} else {\n  \t\t\t\tdelete registry[key];\n  \t\t\t}\n  \t\t\tchanged = true;\n  \t\t}\n  \t});\n\n  \treturn changed;\n  };\n\n  var registries = registryNames.map( function ( name ) { return new Registry( name, name === 'computed' ); } );\n\n  function wrap ( parent, name, method ) {\n  \tif ( !/_super/.test( method ) ) return method;\n\n  \tfunction wrapper () {\n  \t\tvar superMethod = getSuperMethod( wrapper._parent, name );\n  \t\tvar hasSuper = '_super' in this;\n  \t\tvar oldSuper = this._super;\n\n  \t\tthis._super = superMethod;\n\n  \t\tvar result = method.apply( this, arguments );\n\n  \t\tif ( hasSuper ) {\n  \t\t\tthis._super = oldSuper;\n  \t\t} else {\n  \t\t\tdelete this._super;\n  \t\t}\n\n  \t\treturn result;\n  \t}\n\n  \twrapper._parent = parent;\n  \twrapper._method = method;\n\n  \treturn wrapper;\n  }\n\n  function getSuperMethod ( parent, name ) {\n  \tif ( name in parent ) {\n  \t\tvar value = parent[ name ];\n\n  \t\treturn typeof value === 'function' ?\n  \t\t\tvalue :\n  \t\t\tfunction () { return value; };\n  \t}\n\n  \treturn noop;\n  }\n\n  function getMessage( deprecated, correct, isError ) {\n  \treturn \"options.\" + deprecated + \" has been deprecated in favour of options.\" + correct + \".\"\n  \t\t+ ( isError ? (\" You cannot specify both options, please use options.\" + correct + \".\") : '' );\n  }\n\n  function deprecateOption ( options, deprecatedOption, correct ) {\n  \tif ( deprecatedOption in options ) {\n  \t\tif( !( correct in options ) ) {\n  \t\t\twarnIfDebug( getMessage( deprecatedOption, correct ) );\n  \t\t\toptions[ correct ] = options[ deprecatedOption ];\n  \t\t} else {\n  \t\t\tthrow new Error( getMessage( deprecatedOption, correct, true ) );\n  \t\t}\n  \t}\n  }\n\n  function deprecate ( options ) {\n  \tdeprecateOption( options, 'beforeInit', 'onconstruct' );\n  \tdeprecateOption( options, 'init', 'onrender' );\n  \tdeprecateOption( options, 'complete', 'oncomplete' );\n  \tdeprecateOption( options, 'eventDefinitions', 'events' );\n\n  \t// Using extend with Component instead of options,\n  \t// like Human.extend( Spider ) means adaptors as a registry\n  \t// gets copied to options. So we have to check if actually an array\n  \tif ( isArray( options.adaptors ) ) {\n  \t\tdeprecateOption( options, 'adaptors', 'adapt' );\n  \t}\n  }\n\n  var custom = {\n  \tadapt: adaptConfigurator,\n  \tcss: cssConfigurator,\n  \tdata: dataConfigurator,\n  \ttemplate: templateConfigurator\n  };\n\n  var defaultKeys = Object.keys( defaults );\n\n  var isStandardKey = makeObj( defaultKeys.filter( function ( key ) { return !custom[ key ]; } ) );\n\n  // blacklisted keys that we don't double extend\n  var isBlacklisted = makeObj( defaultKeys.concat( registries.map( function ( r ) { return r.name; } ) ) );\n\n  var order = [].concat(\n  \tdefaultKeys.filter( function ( key ) { return !registries[ key ] && !custom[ key ]; } ),\n  \tregistries,\n  \t//custom.data,\n  \tcustom.template,\n  \tcustom.css\n  );\n\n  var config = {\n  \textend: function ( Parent, proto, options ) { return configure( 'extend', Parent, proto, options ); },\n\n  \tinit: function ( Parent, ractive, options ) { return configure( 'init', Parent, ractive, options ); },\n\n  \treset: function ( ractive ) {\n  \t\treturn order.filter( function ( c ) {\n  \t\t\treturn c.reset && c.reset( ractive );\n  \t\t}).map( function ( c ) { return c.name; } );\n  \t},\n\n  \t// this defines the order. TODO this isn't used anywhere in the codebase,\n  \t// only in the test suite - should get rid of it\n  \torder: order\n  };\n\n  function configure ( method, Parent, target, options ) {\n  \tdeprecate( options );\n\n  \tfor ( var key in options ) {\n  \t\tif ( isStandardKey.hasOwnProperty( key ) ) {\n  \t\t\tvar value = options[ key ];\n\n  \t\t\t// warn the developer if they passed a function and ignore its value\n\n  \t\t\t// NOTE: we allow some functions on \"el\" because we duck type element lists\n  \t\t\t// and some libraries or ef'ed-up virtual browsers (phantomJS) return a\n  \t\t\t// function object as the result of querySelector methods\n  \t\t\tif ( key !== 'el' && typeof value === 'function' ) {\n  \t\t\t\twarnIfDebug( (\"\" + key + \" is a Ractive option that does not expect a function and will be ignored\"),\n  \t\t\t\t\tmethod === 'init' ? target : null );\n  \t\t\t}\n  \t\t\telse {\n  \t\t\t\ttarget[ key ] = value;\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \t// disallow combination of `append` and `enhance`\n  \tif ( options.append && options.enhance ) {\n  \t\tthrow new Error( 'Cannot use append and enhance at the same time' );\n  \t}\n\n  \tregistries.forEach( function ( registry ) {\n  \t\tregistry[ method ]( Parent, target, options );\n  \t});\n\n  \tadaptConfigurator[ method ]( Parent, target, options );\n  \ttemplateConfigurator[ method ]( Parent, target, options );\n  \tcssConfigurator[ method ]( Parent, target, options );\n\n  \textendOtherMethods( Parent.prototype, target, options );\n  }\n\n  function extendOtherMethods ( parent, target, options ) {\n  \tfor ( var key in options ) {\n  \t\tif ( !isBlacklisted[ key ] && options.hasOwnProperty( key ) ) {\n  \t\t\tvar member = options[ key ];\n\n  \t\t\t// if this is a method that overwrites a method, wrap it:\n  \t\t\tif ( typeof member === 'function' ) {\n  \t\t\t\tmember = wrap( parent, key, member );\n  \t\t\t}\n\n  \t\t\ttarget[ key ] = member;\n  \t\t}\n  \t}\n  }\n\n  function makeObj ( array ) {\n  \tvar obj = {};\n  \tarray.forEach( function ( x ) { return obj[x] = true; } );\n  \treturn obj;\n  }\n\n  var shouldRerender = [ 'template', 'partials', 'components', 'decorators', 'events' ];\n\n  var completeHook$1 = new Hook( 'complete' );\n  var resetHook = new Hook( 'reset' );\n  var renderHook$1 = new Hook( 'render' );\n  var unrenderHook = new Hook( 'unrender' );\n\n  function Ractive$reset ( data ) {\n  \tdata = data || {};\n\n  \tif ( typeof data !== 'object' ) {\n  \t\tthrow new Error( 'The reset method takes either no arguments, or an object containing new data' );\n  \t}\n\n  \t// TEMP need to tidy this up\n  \tdata = dataConfigurator.init( this.constructor, this, { data: data });\n\n  \tvar promise = runloop.start( this, true );\n\n  \t// If the root object is wrapped, try and use the wrapper's reset value\n  \tvar wrapper = this.viewmodel.wrapper;\n  \tif ( wrapper && wrapper.reset ) {\n  \t\tif ( wrapper.reset( data ) === false ) {\n  \t\t\t// reset was rejected, we need to replace the object\n  \t\t\tthis.viewmodel.set( data );\n  \t\t}\n  \t} else {\n  \t\tthis.viewmodel.set( data );\n  \t}\n\n  \t// reset config items and track if need to rerender\n  \tvar changes = config.reset( this );\n  \tvar rerender;\n\n  \tvar i = changes.length;\n  \twhile ( i-- ) {\n  \t\tif ( shouldRerender.indexOf( changes[i] ) > -1 ) {\n  \t\t\trerender = true;\n  \t\t\tbreak;\n  \t\t}\n  \t}\n\n  \tif ( rerender ) {\n  \t\tunrenderHook.fire( this );\n  \t\tthis.fragment.resetTemplate( this.template );\n  \t\trenderHook$1.fire( this );\n  \t\tcompleteHook$1.fire( this );\n  \t}\n\n  \trunloop.end();\n\n  \tresetHook.fire( this, data );\n\n  \treturn promise;\n  }\n\n  var TEXT              = 1;\n  var INTERPOLATOR      = 2;\n  var TRIPLE            = 3;\n  var SECTION           = 4;\n  var ELEMENT           = 7;\n  var PARTIAL           = 8;\n  var COMPONENT         = 15;\n  var YIELDER           = 16;\n  var DOCTYPE           = 18;\n  var ALIAS             = 19;\n\n  var NUMBER_LITERAL    = 20;\n  var STRING_LITERAL    = 21;\n  var REFERENCE         = 30;\n  var SECTION_IF        = 50;\n  var SECTION_UNLESS    = 51;\n  var SECTION_EACH      = 52;\n  var SECTION_WITH      = 53;\n  var SECTION_IF_WITH   = 54;\n\n  function collect( source, name, dest ) {\n  \tsource.forEach( function ( item ) {\n  \t\t// queue to rerender if the item is a partial and the current name matches\n  \t\tif ( item.type === PARTIAL && ( item.refName ===  name || item.name === name ) ) {\n  \t\t\tdest.push( item );\n  \t\t\treturn; // go no further\n  \t\t}\n\n  \t\t// if it has a fragment, process its items\n  \t\tif ( item.fragment ) {\n  \t\t\tcollect( item.fragment.iterations || item.fragment.items, name, dest );\n  \t\t}\n\n  \t\t// or if it is itself a fragment, process its items\n  \t\telse if ( isArray( item.items ) ) {\n  \t\t\tcollect( item.items, name, dest );\n  \t\t}\n\n  \t\t// or if it is a component, step in and process its items\n  \t\telse if ( item.type === COMPONENT && item.instance ) {\n  \t\t\t// ...unless the partial is shadowed\n  \t\t\tif ( item.instance.partials[ name ] ) return;\n  \t\t\tcollect( item.instance.fragment.items, name, dest );\n  \t\t}\n\n  \t\t// if the item is an element, process its attributes too\n  \t\tif ( item.type === ELEMENT ) {\n  \t\t\tif ( isArray( item.attributes ) ) {\n  \t\t\t\tcollect( item.attributes, name, dest );\n  \t\t\t}\n\n  \t\t\tif ( isArray( item.conditionalAttributes ) ) {\n  \t\t\t\tcollect( item.conditionalAttributes, name, dest );\n  \t\t\t}\n  \t\t}\n  \t});\n  }\n\n  function forceResetTemplate ( partial ) {\n  \tpartial.forceResetTemplate();\n  }\n\n  function resetPartial ( name, partial ) {\n  \tvar collection = [];\n  \tcollect( this.fragment.items, name, collection );\n\n  \tvar promise = runloop.start( this, true );\n\n  \tthis.partials[ name ] = partial;\n  \tcollection.forEach( forceResetTemplate );\n\n  \trunloop.end();\n\n  \treturn promise;\n  }\n\n  var Item = function Item ( options ) {\n  \tthis.parentFragment = options.parentFragment;\n  \tthis.ractive = options.parentFragment.ractive;\n\n  \tthis.template = options.template;\n  \tthis.index = options.index;\n  \tthis.type = options.template.t;\n\n  \tthis.dirty = false;\n  };\n\n  Item.prototype.bubble = function bubble () {\n  \tif ( !this.dirty ) {\n  \t\tthis.dirty = true;\n  \t\tthis.parentFragment.bubble();\n  \t}\n  };\n\n  Item.prototype.find = function find () {\n  \treturn null;\n  };\n\n  Item.prototype.findAll = function findAll () {\n  \t// noop\n  };\n\n  Item.prototype.findComponent = function findComponent () {\n  \treturn null;\n  };\n\n  Item.prototype.findAllComponents = function findAllComponents () {\n  \t// noop;\n  };\n\n  Item.prototype.findNextNode = function findNextNode () {\n  \treturn this.parentFragment.findNextNode( this );\n  };\n\n  Item.prototype.valueOf = function valueOf () {\n  \treturn this.toString();\n  };\n\n  var ComputationChild = (function (Model) {\n  \tfunction ComputationChild () {\n  \t\tModel.apply(this, arguments);\n  \t}\n\n  \tComputationChild.prototype = Object.create( Model && Model.prototype );\n  \tComputationChild.prototype.constructor = ComputationChild;\n\n  \tComputationChild.prototype.get = function get ( shouldCapture ) {\n  \t\tif ( shouldCapture ) capture( this );\n\n  \t\tvar parentValue = this.parent.get();\n  \t\treturn parentValue ? parentValue[ this.key ] : undefined;\n  \t};\n\n  \tComputationChild.prototype.handleChange = function handleChange$1 () {\n  \t\tthis.dirty = true;\n\n  \t\tthis.deps.forEach( handleChange );\n  \t\tthis.children.forEach( handleChange );\n  \t\tthis.clearUnresolveds(); // TODO is this necessary?\n  \t};\n\n  \tComputationChild.prototype.joinKey = function joinKey ( key ) {\n  \t\tif ( key === undefined || key === '' ) return this;\n\n  \t\tif ( !this.childByKey.hasOwnProperty( key ) ) {\n  \t\t\tvar child = new ComputationChild( this, key );\n  \t\t\tthis.children.push( child );\n  \t\t\tthis.childByKey[ key ] = child;\n  \t\t}\n\n  \t\treturn this.childByKey[ key ];\n  \t};\n\n  \treturn ComputationChild;\n  }(Model));\n\n  function getValue ( model ) {\n  \treturn model ? model.get( true ) : undefined;\n  }\n\n  var ExpressionProxy = (function (Model) {\n  \tfunction ExpressionProxy ( fragment, template ) {\n  \t\tvar this$1 = this;\n\n  \t\tModel.call( this, fragment.ractive.viewmodel, null );\n\n  \t\tthis.fragment = fragment;\n  \t\tthis.template = template;\n\n  \t\tthis.isReadonly = true;\n\n  \t\tthis.fn = getFunction( template.s, template.r.length );\n  \t\tthis.computation = null;\n\n  \t\tthis.resolvers = [];\n  \t\tthis.models = this.template.r.map( function ( ref, index ) {\n  \t\t\tvar model = resolveReference( this$1.fragment, ref );\n  \t\t\tvar resolver;\n\n  \t\t\tif ( !model ) {\n  \t\t\t\tresolver = this$1.fragment.resolve( ref, function ( model ) {\n  \t\t\t\t\tremoveFromArray( this$1.resolvers, resolver );\n  \t\t\t\t\tthis$1.models[ index ] = model;\n  \t\t\t\t\tthis$1.bubble();\n  \t\t\t\t});\n\n  \t\t\t\tthis$1.resolvers.push( resolver );\n  \t\t\t}\n\n  \t\t\treturn model;\n  \t\t});\n\n  \t\tthis.bubble();\n  \t}\n\n  \tExpressionProxy.prototype = Object.create( Model && Model.prototype );\n  \tExpressionProxy.prototype.constructor = ExpressionProxy;\n\n  \tExpressionProxy.prototype.bubble = function bubble () {\n  \t\tvar this$1 = this;\n\n  \t\tvar ractive = this.fragment.ractive;\n\n  \t\t// TODO the @ prevents computed props from shadowing keypaths, but the real\n  \t\t// question is why it's a computed prop in the first place... (hint, it's\n  \t\t// to do with {{else}} blocks)\n  \t\tvar key = '@' + this.template.s.replace( /_(\\d+)/g, function ( match, i ) {\n  \t\t\tif ( i >= this$1.models.length ) return match;\n\n  \t\t\tvar model = this$1.models[i];\n  \t\t\treturn model ? model.getKeypath() : '@undefined';\n  \t\t});\n\n  \t\t// TODO can/should we reuse computations?\n  \t\tvar signature = {\n  \t\t\tgetter: function () {\n  \t\t\t\tvar values = this$1.models.map( getValue );\n  \t\t\t\treturn this$1.fn.apply( ractive, values );\n  \t\t\t},\n  \t\t\tgetterString: key\n  \t\t};\n\n  \t\tvar computation = ractive.viewmodel.compute( key, signature );\n\n  \t\tthis.value = computation.get(); // TODO should not need this, eventually\n\n  \t\tif ( this.computation ) {\n  \t\t\tthis.computation.unregister( this );\n  \t\t\t// notify children...\n  \t\t}\n\n  \t\tthis.computation = computation;\n  \t\tcomputation.register( this );\n\n  \t\tthis.handleChange();\n  \t};\n\n  \tExpressionProxy.prototype.get = function get ( shouldCapture ) {\n  \t\treturn this.computation.get( shouldCapture );\n  \t};\n\n  \tExpressionProxy.prototype.getKeypath = function getKeypath () {\n  \t\treturn this.computation ? this.computation.getKeypath() : '@undefined';\n  \t};\n\n  \tExpressionProxy.prototype.handleChange = function handleChange$1 () {\n  \t\tthis.deps.forEach( handleChange );\n  \t\tthis.children.forEach( handleChange );\n\n  \t\tthis.clearUnresolveds();\n  \t};\n\n  \tExpressionProxy.prototype.joinKey = function joinKey ( key ) {\n  \t\tif ( key === undefined || key === '' ) return this;\n\n  \t\tif ( !this.childByKey.hasOwnProperty( key ) ) {\n  \t\t\tvar child = new ComputationChild( this, key );\n  \t\t\tthis.children.push( child );\n  \t\t\tthis.childByKey[ key ] = child;\n  \t\t}\n\n  \t\treturn this.childByKey[ key ];\n  \t};\n\n  \tExpressionProxy.prototype.mark = function mark () {\n  \t\tthis.handleChange();\n  \t};\n\n  \tExpressionProxy.prototype.retrieve = function retrieve () {\n  \t\treturn this.get();\n  \t};\n\n  \tExpressionProxy.prototype.teardown = function teardown () {\n  \t\tthis.unbind();\n  \t\tthis.fragment = undefined;\n  \t\tif ( this.computation ) {\n  \t\t\tthis.computation.teardown();\n  \t\t}\n  \t\tthis.computation = undefined;\n  \t\tModel.prototype.teardown.call(this);\n  \t};\n\n  \tExpressionProxy.prototype.unregister = function unregister( dep ) {\n  \t\tModel.prototype.unregister.call( this, dep );\n  \t\tif ( !this.deps.length ) this.teardown();\n  \t};\n\n  \tExpressionProxy.prototype.unbind = function unbind$1 () {\n  \t\tvar this$1 = this;\n\n  \t\tthis.resolvers.forEach( unbind );\n\n  \t\tvar i = this.models.length;\n  \t\twhile ( i-- ) {\n  \t\t\tif ( this$1.models[i] ) this$1.models[i].unregister( this$1 );\n  \t\t}\n  \t};\n\n  \treturn ExpressionProxy;\n  }(Model));\n\n  var ReferenceExpressionChild = (function (Model) {\n  \tfunction ReferenceExpressionChild ( parent, key ) {\n  \t\tModel.call ( this, parent, key );\n  \t}\n\n  \tReferenceExpressionChild.prototype = Object.create( Model && Model.prototype );\n  \tReferenceExpressionChild.prototype.constructor = ReferenceExpressionChild;\n\n  \tReferenceExpressionChild.prototype.applyValue = function applyValue ( value ) {\n  \t\tif ( isEqual( value, this.value ) ) return;\n\n  \t\tvar parent = this.parent, keys = [ this.key ];\n  \t\twhile ( parent ) {\n  \t\t\tif ( parent.base ) {\n  \t\t\t\tvar target = parent.model.joinAll( keys );\n  \t\t\t\ttarget.applyValue( value );\n  \t\t\t\tbreak;\n  \t\t\t}\n\n  \t\t\tkeys.unshift( parent.key );\n\n  \t\t\tparent = parent.parent;\n  \t\t}\n  \t};\n\n  \tReferenceExpressionChild.prototype.joinKey = function joinKey ( key ) {\n  \t\tif ( key === undefined || key === '' ) return this;\n\n  \t\tif ( !this.childByKey.hasOwnProperty( key ) ) {\n  \t\t\tvar child = new ReferenceExpressionChild( this, key );\n  \t\t\tthis.children.push( child );\n  \t\t\tthis.childByKey[ key ] = child;\n  \t\t}\n\n  \t\treturn this.childByKey[ key ];\n  \t};\n\n  \treturn ReferenceExpressionChild;\n  }(Model));\n\n  var ReferenceExpressionProxy = (function (Model) {\n  \tfunction ReferenceExpressionProxy ( fragment, template ) {\n  \t\tvar this$1 = this;\n\n  \t\tModel.call( this, null, null );\n  \t\tthis.root = fragment.ractive.viewmodel;\n\n  \t\tthis.resolvers = [];\n\n  \t\tthis.base = resolve$2( fragment, template );\n  \t\tvar baseResolver;\n\n  \t\tif ( !this.base ) {\n  \t\t\tbaseResolver = fragment.resolve( template.r, function ( model ) {\n  \t\t\t\tthis$1.base = model;\n  \t\t\t\tthis$1.bubble();\n\n  \t\t\t\tremoveFromArray( this$1.resolvers, baseResolver );\n  \t\t\t});\n\n  \t\t\tthis.resolvers.push( baseResolver );\n  \t\t}\n\n  \t\tvar intermediary = {\n  \t\t\thandleChange: function () { return this$1.bubble(); }\n  \t\t};\n\n  \t\tthis.members = template.m.map( function ( template, i ) {\n  \t\t\tif ( typeof template === 'string' ) {\n  \t\t\t\treturn { get: function () { return template; } };\n  \t\t\t}\n\n  \t\t\tvar model;\n  \t\t\tvar resolver;\n\n  \t\t\tif ( template.t === REFERENCE ) {\n  \t\t\t\tmodel = resolveReference( fragment, template.n );\n\n  \t\t\t\tif ( model ) {\n  \t\t\t\t\tmodel.register( intermediary );\n  \t\t\t\t} else {\n  \t\t\t\t\tresolver = fragment.resolve( template.n, function ( model ) {\n  \t\t\t\t\t\tthis$1.members[i] = model;\n\n  \t\t\t\t\t\tmodel.register( intermediary );\n  \t\t\t\t\t\tthis$1.bubble();\n\n  \t\t\t\t\t\tremoveFromArray( this$1.resolvers, resolver );\n  \t\t\t\t\t});\n\n  \t\t\t\t\tthis$1.resolvers.push( resolver );\n  \t\t\t\t}\n\n  \t\t\t\treturn model;\n  \t\t\t}\n\n  \t\t\tmodel = new ExpressionProxy( fragment, template );\n  \t\t\tmodel.register( intermediary );\n  \t\t\treturn model;\n  \t\t});\n\n  \t\tthis.isUnresolved = true;\n  \t\tthis.bubble();\n  \t}\n\n  \tReferenceExpressionProxy.prototype = Object.create( Model && Model.prototype );\n  \tReferenceExpressionProxy.prototype.constructor = ReferenceExpressionProxy;\n\n  \tReferenceExpressionProxy.prototype.bubble = function bubble () {\n  \t\tvar this$1 = this;\n\n  \t\tif ( !this.base ) return;\n\n  \t\t// if some members are not resolved, abort\n  \t\tvar i = this.members.length;\n  \t\twhile ( i-- ) {\n  \t\t\tif ( !this$1.members[i] ) return;\n  \t\t}\n\n  \t\tthis.isUnresolved = false;\n\n  \t\tvar keys = this.members.map( function ( model ) { return escapeKey( String( model.get() ) ); } );\n  \t\tvar model = this.base.joinAll( keys );\n\n  \t\tif ( this.model ) {\n  \t\t\tthis.model.unregister( this );\n  \t\t\tthis.model.unregisterTwowayBinding( this );\n  \t\t}\n\n  \t\tthis.model = model;\n  \t\tthis.parent = model.parent;\n\n  \t\tmodel.register( this );\n  \t\tmodel.registerTwowayBinding( this );\n\n  \t\tif ( this.keypathModel ) this.keypathModel.handleChange();\n\n  \t\tthis.mark();\n  \t};\n\n  \tReferenceExpressionProxy.prototype.forceResolution = function forceResolution () {\n  \t\tthis.resolvers.forEach( function ( resolver ) { return resolver.forceResolution(); } );\n  \t\tthis.bubble();\n  \t};\n\n  \tReferenceExpressionProxy.prototype.get = function get ( shouldCapture ) {\n  \t\treturn this.model ? this.model.get( shouldCapture ) : undefined;\n  \t};\n\n  \t// indirect two-way bindings\n  \tReferenceExpressionProxy.prototype.getValue = function getValue () {\n  \t\tvar this$1 = this;\n\n  \t\tvar i = this.bindings.length;\n  \t\twhile ( i-- ) {\n  \t\t\tvar value = this$1.bindings[i].getValue();\n  \t\t\tif ( value !== this$1.value ) return value;\n  \t\t}\n\n  \t\treturn this.value;\n  \t};\n\n  \tReferenceExpressionProxy.prototype.getKeypath = function getKeypath () {\n  \t\treturn this.model ? this.model.getKeypath() : '@undefined';\n  \t};\n\n  \tReferenceExpressionProxy.prototype.handleChange = function handleChange () {\n  \t\tthis.mark();\n  \t};\n\n  \tReferenceExpressionProxy.prototype.joinKey = function joinKey ( key ) {\n  \t\tif ( key === undefined || key === '' ) return this;\n\n  \t\tif ( !this.childByKey.hasOwnProperty( key ) ) {\n  \t\t\tvar child = new ReferenceExpressionChild( this, key );\n  \t\t\tthis.children.push( child );\n  \t\t\tthis.childByKey[ key ] = child;\n  \t\t}\n\n  \t\treturn this.childByKey[ key ];\n  \t};\n\n  \tReferenceExpressionProxy.prototype.retrieve = function retrieve () {\n  \t\treturn this.get();\n  \t};\n\n  \tReferenceExpressionProxy.prototype.set = function set ( value ) {\n  \t\tif ( !this.model ) throw new Error( 'Unresolved reference expression. This should not happen!' );\n  \t\tthis.model.set( value );\n  \t};\n\n  \tReferenceExpressionProxy.prototype.unbind = function unbind$1 () {\n  \t\tthis.resolvers.forEach( unbind );\n  \t};\n\n  \treturn ReferenceExpressionProxy;\n  }(Model));\n\n  function resolve$2 ( fragment, template ) {\n  \tif ( template.r ) {\n  \t\treturn resolveReference( fragment, template.r );\n  \t}\n\n  \telse if ( template.x ) {\n  \t\treturn new ExpressionProxy( fragment, template.x );\n  \t}\n\n  \telse {\n  \t\treturn new ReferenceExpressionProxy( fragment, template.rx );\n  \t}\n  }\n\n  function resolveAliases( section ) {\n  \tif ( section.template.z ) {\n  \t\tsection.aliases = {};\n\n  \t\tvar refs = section.template.z;\n  \t\tfor ( var i = 0; i < refs.length; i++ ) {\n  \t\t\tsection.aliases[ refs[i].n ] = resolve$2( section.parentFragment, refs[i].x );\n  \t\t}\n  \t}\n  }\n\n  var Alias = (function (Item) {\n  \tfunction Alias ( options ) {\n  \t\tItem.call( this, options );\n\n  \t\tthis.fragment = null;\n  \t}\n\n  \tAlias.prototype = Object.create( Item && Item.prototype );\n  \tAlias.prototype.constructor = Alias;\n\n  \tAlias.prototype.bind = function bind () {\n  \t\tresolveAliases( this );\n\n  \t\tthis.fragment = new Fragment({\n  \t\t\towner: this,\n  \t\t\ttemplate: this.template.f\n  \t\t}).bind();\n  \t};\n\n  \tAlias.prototype.detach = function detach () {\n  \t\treturn this.fragment ? this.fragment.detach() : createDocumentFragment();\n  \t};\n\n  \tAlias.prototype.find = function find ( selector ) {\n  \t\tif ( this.fragment ) {\n  \t\t\treturn this.fragment.find( selector );\n  \t\t}\n  \t};\n\n  \tAlias.prototype.findAll = function findAll ( selector, query ) {\n  \t\tif ( this.fragment ) {\n  \t\t\tthis.fragment.findAll( selector, query );\n  \t\t}\n  \t};\n\n  \tAlias.prototype.findComponent = function findComponent ( name ) {\n  \t\tif ( this.fragment ) {\n  \t\t\treturn this.fragment.findComponent( name );\n  \t\t}\n  \t};\n\n  \tAlias.prototype.findAllComponents = function findAllComponents ( name, query ) {\n  \t\tif ( this.fragment ) {\n  \t\t\tthis.fragment.findAllComponents( name, query );\n  \t\t}\n  \t};\n\n  \tAlias.prototype.firstNode = function firstNode ( skipParent ) {\n  \t\treturn this.fragment && this.fragment.firstNode( skipParent );\n  \t};\n\n  \tAlias.prototype.rebind = function rebind () {\n  \t\tresolveAliases( this );\n  \t\tif ( this.fragment ) this.fragment.rebind();\n  \t};\n\n  \tAlias.prototype.render = function render ( target ) {\n  \t\tthis.rendered = true;\n  \t\tif ( this.fragment ) this.fragment.render( target );\n  \t};\n\n  \tAlias.prototype.toString = function toString ( escape ) {\n  \t\treturn this.fragment ? this.fragment.toString( escape ) : '';\n  \t};\n\n  \tAlias.prototype.unbind = function unbind () {\n  \t\tthis.aliases = {};\n  \t\tif ( this.fragment ) this.fragment.unbind();\n  \t};\n\n  \tAlias.prototype.unrender = function unrender ( shouldDestroy ) {\n  \t\tif ( this.rendered && this.fragment ) this.fragment.unrender( shouldDestroy );\n  \t\tthis.rendered = false;\n  \t};\n\n  \tAlias.prototype.update = function update () {\n  \t\tif ( this.dirty ) {\n  \t\t\tthis.dirty = false;\n  \t\t\tthis.fragment.update();\n  \t\t}\n  \t};\n\n  \treturn Alias;\n  }(Item));\n\n  function processWrapper ( wrapper, array, methodName, newIndices ) {\n  \tvar __model = wrapper.__model;\n\n  \tif ( newIndices ) {\n  \t\t__model.shuffle( newIndices );\n  \t} else {\n  \t\t// If this is a sort or reverse, we just do root.set()...\n  \t\t// TODO use merge logic?\n  \t\t//root.viewmodel.mark( keypath );\n  \t}\n  }\n\n  var mutatorMethods = [ 'pop', 'push', 'reverse', 'shift', 'sort', 'splice', 'unshift' ];\n  var patchedArrayProto = [];\n\n  mutatorMethods.forEach( function ( methodName ) {\n  \tvar method = function () {\n  \t\tvar this$1 = this;\n  \t\tvar args = [], len = arguments.length;\n  \t\twhile ( len-- ) args[ len ] = arguments[ len ];\n\n  \t\tvar newIndices = getNewIndices( this.length, methodName, args );\n\n  \t\t// apply the underlying method\n  \t\tvar result = Array.prototype[ methodName ].apply( this, arguments );\n\n  \t\t// trigger changes\n  \t\trunloop.start();\n\n  \t\tthis._ractive.setting = true;\n  \t\tvar i = this._ractive.wrappers.length;\n  \t\twhile ( i-- ) {\n  \t\t\tprocessWrapper( this$1._ractive.wrappers[i], this$1, methodName, newIndices );\n  \t\t}\n\n  \t\trunloop.end();\n\n  \t\tthis._ractive.setting = false;\n  \t\treturn result;\n  \t};\n\n  \tdefineProperty( patchedArrayProto, methodName, {\n  \t\tvalue: method\n  \t});\n  });\n\n  var patchArrayMethods;\n  var unpatchArrayMethods;\n\n  // can we use prototype chain injection?\n  // http://perfectionkills.com/how-ecmascript-5-still-does-not-allow-to-subclass-an-array/#wrappers_prototype_chain_injection\n  if ( ({}).__proto__ ) {\n  \t// yes, we can\n  \tpatchArrayMethods = function ( array ) { return array.__proto__ = patchedArrayProto; };\n  \tunpatchArrayMethods = function ( array ) { return array.__proto__ = Array.prototype; };\n  }\n\n  else {\n  \t// no, we can't\n  \tpatchArrayMethods = function ( array ) {\n  \t\tvar i = mutatorMethods.length;\n  \t\twhile ( i-- ) {\n  \t\t\tvar methodName = mutatorMethods[i];\n  \t\t\tdefineProperty( array, methodName, {\n  \t\t\t\tvalue: patchedArrayProto[ methodName ],\n  \t\t\t\tconfigurable: true\n  \t\t\t});\n  \t\t}\n  \t};\n\n  \tunpatchArrayMethods = function ( array ) {\n  \t\tvar i = mutatorMethods.length;\n  \t\twhile ( i-- ) {\n  \t\t\tdelete array[ mutatorMethods[i] ];\n  \t\t}\n  \t};\n  }\n\n  patchArrayMethods.unpatch = unpatchArrayMethods; // TODO export separately?\n  var patch = patchArrayMethods;\n\n  var errorMessage$1 = 'Something went wrong in a rather interesting way';\n\n  var arrayAdaptor = {\n  \tfilter: function ( object ) {\n  \t\t// wrap the array if a) b) it's an array, and b) either it hasn't been wrapped already,\n  \t\t// or the array didn't trigger the get() itself\n  \t\treturn isArray( object ) && ( !object._ractive || !object._ractive.setting );\n  \t},\n  \twrap: function ( ractive, array, keypath ) {\n  \t\treturn new ArrayWrapper( ractive, array, keypath );\n  \t}\n  };\n\n  var ArrayWrapper = function ArrayWrapper ( ractive, array ) {\n  \tthis.root = ractive;\n  \tthis.value = array;\n  \tthis.__model = null; // filled in later\n\n  \t// if this array hasn't already been ractified, ractify it\n  \tif ( !array._ractive ) {\n  \t\t// define a non-enumerable _ractive property to store the wrappers\n  \t\tdefineProperty( array, '_ractive', {\n  \t\t\tvalue: {\n  \t\t\t\twrappers: [],\n  \t\t\t\tinstances: [],\n  \t\t\t\tsetting: false\n  \t\t\t},\n  \t\t\tconfigurable: true\n  \t\t});\n\n  \t\tpatch( array );\n  \t}\n\n  \t// store the ractive instance, so we can handle transitions later\n  \tif ( !array._ractive.instances[ ractive._guid ] ) {\n  \t\tarray._ractive.instances[ ractive._guid ] = 0;\n  \t\tarray._ractive.instances.push( ractive );\n  \t}\n\n  \tarray._ractive.instances[ ractive._guid ] += 1;\n  \tarray._ractive.wrappers.push( this );\n  };\n\n  ArrayWrapper.prototype.get = function get () {\n  \treturn this.value;\n  };\n\n  ArrayWrapper.prototype.reset = function reset ( value ) {\n  \treturn this.value === value;\n  };\n\n  ArrayWrapper.prototype.teardown = function teardown () {\n  \tvar array, storage, wrappers, instances, index;\n\n  \tarray = this.value;\n  \tstorage = array._ractive;\n  \twrappers = storage.wrappers;\n  \tinstances = storage.instances;\n\n  \t// if teardown() was invoked because we're clearing the cache as a result of\n  \t// a change that the array itself triggered, we can save ourselves the teardown\n  \t// and immediate setup\n  \tif ( storage.setting ) {\n  \t\treturn false; // so that we don't remove it from cached wrappers\n  \t}\n\n  \tindex = wrappers.indexOf( this );\n  \tif ( index === -1 ) {\n  \t\tthrow new Error( errorMessage$1 );\n  \t}\n\n  \twrappers.splice( index, 1 );\n\n  \t// if nothing else depends on this array, we can revert it to its\n  \t// natural state\n  \tif ( !wrappers.length ) {\n  \t\tdelete array._ractive;\n  \t\tpatch.unpatch( this.value );\n  \t}\n\n  \telse {\n  \t\t// remove ractive instance if possible\n  \t\tinstances[ this.root._guid ] -= 1;\n  \t\tif ( !instances[ this.root._guid ] ) {\n  \t\t\tindex = instances.indexOf( this.root );\n\n  \t\t\tif ( index === -1 ) {\n  \t\t\t\tthrow new Error( errorMessage$1 );\n  \t\t\t}\n\n  \t\t\tinstances.splice( index, 1 );\n  \t\t}\n  \t}\n  };\n\n  var magicAdaptor;\n\n  try {\n  \tObject.defineProperty({}, 'test', { get: function() {}, set: function() {} });\n\n  \tmagicAdaptor = {\n  \t\tfilter: function ( value ) {\n  \t\t\treturn value && typeof value === 'object';\n  \t\t},\n  \t\twrap: function ( ractive, value, keypath ) {\n  \t\t\treturn new MagicWrapper( ractive, value, keypath );\n  \t\t}\n  \t};\n  } catch ( err ) {\n  \tmagicAdaptor = false;\n  }\n\n  var magicAdaptor$1 = magicAdaptor;\n\n  function createOrWrapDescriptor ( originalDescriptor, ractive, keypath ) {\n  \tif ( originalDescriptor.set && originalDescriptor.set.__magic ) {\n  \t\toriginalDescriptor.set.__magic.dependants.push({ ractive: ractive, keypath: keypath });\n  \t\treturn originalDescriptor;\n  \t}\n\n  \tvar setting;\n\n  \tvar dependants = [{ ractive: ractive, keypath: keypath }];\n\n  \tvar descriptor = {\n  \t\tget: function () {\n  \t\t\treturn 'value' in originalDescriptor ? originalDescriptor.value : originalDescriptor.get();\n  \t\t},\n  \t\tset: function ( value ) {\n  \t\t\tif ( setting ) return;\n\n  \t\t\tif ( 'value' in originalDescriptor ) {\n  \t\t\t\toriginalDescriptor.value = value;\n  \t\t\t} else {\n  \t\t\t\toriginalDescriptor.set( value );\n  \t\t\t}\n\n  \t\t\tsetting = true;\n  \t\t\tdependants.forEach( function (ref) {\n  \t\t\t\tvar ractive = ref.ractive;\n  \t\t\t\tvar keypath = ref.keypath;\n\n  \t\t\t\tractive.set( keypath, value );\n  \t\t\t});\n  \t\t\tsetting = false;\n  \t\t},\n  \t\tenumerable: true\n  \t};\n\n  \tdescriptor.set.__magic = { dependants: dependants, originalDescriptor: originalDescriptor };\n\n  \treturn descriptor;\n  }\n\n  function revert ( descriptor, ractive, keypath ) {\n  \tif ( !descriptor.set || !descriptor.set.__magic ) return true;\n\n  \tvar dependants = descriptor.set.__magic;\n  \tvar i = dependants.length;\n  \twhile ( i-- ) {\n  \t\tvar dependant = dependants[i];\n  \t\tif ( dependant.ractive === ractive && dependant.keypath === keypath ) {\n  \t\t\tdependants.splice( i, 1 );\n  \t\t\treturn false;\n  \t\t}\n  \t}\n  }\n\n  var MagicWrapper = function MagicWrapper ( ractive, value, keypath ) {\n  \tvar this$1 = this;\n\n  \t\tthis.ractive = ractive;\n  \tthis.value = value;\n  \tthis.keypath = keypath;\n\n  \tthis.originalDescriptors = {};\n\n  \t// wrap all properties with getters\n  \tObject.keys( value ).forEach( function ( key ) {\n  \t\tvar originalDescriptor = Object.getOwnPropertyDescriptor( this$1.value, key );\n  \t\tthis$1.originalDescriptors[ key ] = originalDescriptor;\n\n  \t\tvar childKeypath = keypath ? (\"\" + keypath + \".\" + (escapeKey( key ))) : escapeKey( key );\n\n  \t\tvar descriptor = createOrWrapDescriptor( originalDescriptor, ractive, childKeypath );\n\n\n\n  \t\tObject.defineProperty( this$1.value, key, descriptor );\n  \t});\n  };\n\n  MagicWrapper.prototype.get = function get () {\n  \treturn this.value;\n  };\n\n  MagicWrapper.prototype.reset = function reset ( value ) {\n  \treturn this.value === value;\n  };\n\n  MagicWrapper.prototype.set = function set ( key, value ) {\n  \tthis.value[ key ] = value;\n  };\n\n  MagicWrapper.prototype.teardown = function teardown () {\n  \tvar this$1 = this;\n\n  \t\tObject.keys( this.value ).forEach( function ( key ) {\n  \t\tvar descriptor = Object.getOwnPropertyDescriptor( this$1.value, key );\n  \t\tif ( !descriptor.set || !descriptor.set.__magic ) return;\n\n  \t\trevert( descriptor );\n\n  \t\tif ( descriptor.set.__magic.dependants.length === 1 ) {\n  \t\t\tObject.defineProperty( this$1.value, key, descriptor.set.__magic.originalDescriptor );\n  \t\t}\n  \t});\n  };\n\n  var MagicArrayWrapper = function MagicArrayWrapper ( ractive, array, keypath ) {\n  \tthis.value = array;\n\n  \tthis.magic = true;\n\n  \tthis.magicWrapper = magicAdaptor$1.wrap( ractive, array, keypath );\n  \tthis.arrayWrapper = arrayAdaptor.wrap( ractive, array, keypath );\n\n  \t// ugh, this really is a terrible hack\n  \tObject.defineProperty( this, '__model', {\n  \t\tget: function () {\n  \t\t\treturn this.arrayWrapper.__model;\n  \t\t},\n  \t\tset: function ( model ) {\n  \t\t\tthis.arrayWrapper.__model = model;\n  \t\t}\n  \t});\n  };\n\n  MagicArrayWrapper.prototype.get = function get () {\n  \treturn this.value;\n  };\n\n  MagicArrayWrapper.prototype.teardown = function teardown () {\n  \tthis.arrayWrapper.teardown();\n  \tthis.magicWrapper.teardown();\n  };\n\n  MagicArrayWrapper.prototype.reset = function reset ( value ) {\n  \treturn this.arrayWrapper.reset( value ) && this.magicWrapper.reset( value );\n  };\n\n  var magicArrayAdaptor = {\n  \tfilter: function ( object, keypath, ractive ) {\n  \t\treturn magicAdaptor$1.filter( object, keypath, ractive ) && arrayAdaptor.filter( object );\n  \t},\n\n  \twrap: function ( ractive, array, keypath ) {\n  \t\treturn new MagicArrayWrapper( ractive, array, keypath );\n  \t}\n  };\n\n  // TODO this is probably a bit anal, maybe we should leave it out\n  function prettify ( fnBody ) {\n  \tvar lines = fnBody\n  \t\t.replace( /^\\t+/gm, function ( tabs ) { return tabs.split( '\\t' ).join( '  ' ); } )\n  \t\t.split( '\\n' );\n\n  \tvar minIndent = lines.length < 2 ? 0 :\n  \t\tlines.slice( 1 ).reduce( function ( prev, line ) {\n  \t\t\treturn Math.min( prev, /^\\s*/.exec( line )[0].length );\n  \t\t}, Infinity );\n\n  \treturn lines.map( function ( line, i ) {\n  \t\treturn '    ' + ( i ? line.substring( minIndent ) : line );\n  \t}).join( '\\n' );\n  }\n\n  // Ditto. This function truncates the stack to only include app code\n  function truncateStack ( stack ) {\n  \tif ( !stack ) return '';\n\n  \tvar lines = stack.split( '\\n' );\n  \tvar name = Computation.name + '.getValue';\n\n  \tvar truncated = [];\n\n  \tvar len = lines.length;\n  \tfor ( var i = 1; i < len; i += 1 ) {\n  \t\tvar line = lines[i];\n\n  \t\tif ( ~line.indexOf( name ) ) {\n  \t\t\treturn truncated.join( '\\n' );\n  \t\t} else {\n  \t\t\ttruncated.push( line );\n  \t\t}\n  \t}\n  }\n\n  var Computation = (function (Model) {\n  \tfunction Computation ( viewmodel, signature, key ) {\n  \t\tModel.call( this, null, null );\n\n  \t\tthis.root = this.parent = viewmodel;\n  \t\tthis.signature = signature;\n\n  \t\tthis.key = key; // not actually used, but helps with debugging\n  \t\tthis.isExpression = key && key[0] === '@';\n\n  \t\tthis.isReadonly = !this.signature.setter;\n\n  \t\tthis.context = viewmodel.computationContext;\n\n  \t\tthis.dependencies = [];\n\n  \t\tthis.children = [];\n  \t\tthis.childByKey = {};\n\n  \t\tthis.deps = [];\n\n  \t\tthis.boundsSensitive = true;\n  \t\tthis.dirty = true;\n\n  \t\t// TODO: is there a less hackish way to do this?\n  \t\tthis.shuffle = undefined;\n  \t}\n\n  \tComputation.prototype = Object.create( Model && Model.prototype );\n  \tComputation.prototype.constructor = Computation;\n\n  \tComputation.prototype.get = function get ( shouldCapture ) {\n  \t\tif ( shouldCapture ) capture( this );\n\n  \t\tif ( this.dirty ) {\n  \t\t\tthis.dirty = false;\n  \t\t\tthis.value = this.getValue();\n  \t\t\tthis.adapt();\n  \t\t}\n\n  \t\treturn this.value;\n  \t};\n\n  \tComputation.prototype.getValue = function getValue () {\n  \t\tstartCapturing();\n  \t\tvar result;\n\n  \t\ttry {\n  \t\t\tresult = this.signature.getter.call( this.context );\n  \t\t} catch ( err ) {\n  \t\t\twarnIfDebug( (\"Failed to compute \" + (this.getKeypath()) + \": \" + (err.message || err)) );\n\n  \t\t\t// TODO this is all well and good in Chrome, but...\n  \t\t\t// ...also, should encapsulate this stuff better, and only\n  \t\t\t// show it if Ractive.DEBUG\n  \t\t\tif ( hasConsole ) {\n  \t\t\t\tif ( console.groupCollapsed ) console.groupCollapsed( '%cshow details', 'color: rgb(82, 140, 224); font-weight: normal; text-decoration: underline;' );\n  \t\t\t\tvar functionBody = prettify( this.signature.getterString );\n  \t\t\t\tvar stack = this.signature.getterUseStack ? '\\n\\n' + truncateStack( err.stack ) : '';\n  \t\t\t\tconsole.error( (\"\" + (err.name) + \": \" + (err.message) + \"\\n\\n\" + functionBody + \"\" + stack) );\n  \t\t\t\tif ( console.groupCollapsed ) console.groupEnd();\n  \t\t\t}\n  \t\t}\n\n  \t\tvar dependencies = stopCapturing();\n  \t\tthis.setDependencies( dependencies );\n\n  \t\treturn result;\n  \t};\n\n  \tComputation.prototype.handleChange = function handleChange$1 () {\n  \t\tthis.dirty = true;\n\n  \t\tthis.deps.forEach( handleChange );\n  \t\tthis.children.forEach( handleChange );\n  \t\tthis.clearUnresolveds(); // TODO same question as on Model - necessary for primitives?\n  \t};\n\n  \tComputation.prototype.joinKey = function joinKey ( key ) {\n  \t\tif ( key === undefined || key === '' ) return this;\n\n  \t\tif ( !this.childByKey.hasOwnProperty( key ) ) {\n  \t\t\tvar child = new ComputationChild( this, key );\n  \t\t\tthis.children.push( child );\n  \t\t\tthis.childByKey[ key ] = child;\n  \t\t}\n\n  \t\treturn this.childByKey[ key ];\n  \t};\n\n  \tComputation.prototype.mark = function mark () {\n  \t\tthis.handleChange();\n  \t};\n\n  \tComputation.prototype.set = function set ( value ) {\n  \t\tif ( !this.signature.setter ) {\n  \t\t\tthrow new Error( (\"Cannot set read-only computed value '\" + (this.key) + \"'\") );\n  \t\t}\n\n  \t\tthis.signature.setter( value );\n  \t};\n\n  \tComputation.prototype.setDependencies = function setDependencies ( dependencies ) {\n  \t\t// unregister any soft dependencies we no longer have\n  \t\tvar this$1 = this;\n\n  \t\tvar i = this.dependencies.length;\n  \t\twhile ( i-- ) {\n  \t\t\tvar model = this$1.dependencies[i];\n  \t\t\tif ( !~dependencies.indexOf( model ) ) model.unregister( this$1 );\n  \t\t}\n\n  \t\t// and add any new ones\n  \t\ti = dependencies.length;\n  \t\twhile ( i-- ) {\n  \t\t\tvar model$1 = dependencies[i];\n  \t\t\tif ( !~this$1.dependencies.indexOf( model$1 ) ) model$1.register( this$1 );\n  \t\t}\n\n  \t\tthis.dependencies = dependencies;\n  \t};\n\n  \tComputation.prototype.teardown = function teardown () {\n  \t\tvar this$1 = this;\n\n  \t\tvar i = this.dependencies.length;\n  \t\twhile ( i-- ) {\n  \t\t\tif ( this$1.dependencies[i] ) this$1.dependencies[i].unregister( this$1 );\n  \t\t}\n  \t\tif ( this.root.computations[this.key] === this ) delete this.root.computations[this.key];\n  \t\tModel.prototype.teardown.call(this);\n  \t};\n\n  \treturn Computation;\n  }(Model));\n\n  var RactiveModel = (function (Model) {\n  \tfunction RactiveModel ( ractive ) {\n  \t\tModel.call( this, null, '' );\n  \t\tthis.value = ractive;\n  \t\tthis.isRoot = true;\n  \t\tthis.root = this;\n  \t\tthis.adaptors = [];\n  \t\tthis.ractive = ractive;\n  \t\tthis.changes = {};\n  \t}\n\n  \tRactiveModel.prototype = Object.create( Model && Model.prototype );\n  \tRactiveModel.prototype.constructor = RactiveModel;\n\n  \tRactiveModel.prototype.getKeypath = function getKeypath() {\n  \t\treturn '@this';\n  \t};\n\n  \treturn RactiveModel;\n  }(Model));\n\n  var hasProp$1 = Object.prototype.hasOwnProperty;\n\n  var RootModel = (function (Model) {\n  \tfunction RootModel ( options ) {\n  \t\tModel.call( this, null, null );\n\n  \t\t// TODO deprecate this\n  \t\tthis.changes = {};\n\n  \t\tthis.isRoot = true;\n  \t\tthis.root = this;\n  \t\tthis.ractive = options.ractive; // TODO sever this link\n\n  \t\tthis.value = options.data;\n  \t\tthis.adaptors = options.adapt;\n  \t\tthis.adapt();\n\n  \t\tthis.mappings = {};\n\n  \t\tthis.computationContext = options.ractive;\n  \t\tthis.computations = {};\n  \t}\n\n  \tRootModel.prototype = Object.create( Model && Model.prototype );\n  \tRootModel.prototype.constructor = RootModel;\n\n  \tRootModel.prototype.applyChanges = function applyChanges () {\n  \t\tthis._changeHash = {};\n  \t\tthis.flush();\n\n  \t\treturn this._changeHash;\n  \t};\n\n  \tRootModel.prototype.compute = function compute ( key, signature ) {\n  \t\tvar computation = new Computation( this, signature, key );\n  \t\tthis.computations[ key ] = computation;\n\n  \t\treturn computation;\n  \t};\n\n  \tRootModel.prototype.extendChildren = function extendChildren ( fn ) {\n  \t\tvar mappings = this.mappings;\n  \t\tObject.keys( mappings ).forEach( function ( key ) {\n  \t\t\tfn( key, mappings[ key ] );\n  \t\t});\n\n  \t\tvar computations = this.computations;\n  \t\tObject.keys( computations ).forEach( function ( key ) {\n  \t\t\tvar computation = computations[ key ];\n  \t\t\t// exclude template expressions\n  \t\t\tif ( !computation.isExpression ) {\n  \t\t\t\tfn( key, computation );\n  \t\t\t}\n  \t\t});\n  \t};\n\n  \tRootModel.prototype.get = function get ( shouldCapture ) {\n  \t\tif ( shouldCapture ) capture( this );\n  \t\tvar result = extendObj( {}, this.value );\n\n  \t\tthis.extendChildren( function ( key, model ) {\n  \t\t\tresult[ key ] = model.value;\n  \t\t});\n\n  \t\treturn result;\n  \t};\n\n  \tRootModel.prototype.getKeypath = function getKeypath () {\n  \t\treturn '';\n  \t};\n\n  \tRootModel.prototype.getRactiveModel = function getRactiveModel() {\n  \t\treturn this.ractiveModel || ( this.ractiveModel = new RactiveModel( this.ractive ) );\n  \t};\n\n  \tRootModel.prototype.getValueChildren = function getValueChildren () {\n  \t\tvar children = Model.prototype.getValueChildren.call( this, this.value );\n\n  \t\tthis.extendChildren( function ( key, model ) {\n  \t\t\tchildren.push( model );\n  \t\t});\n\n  \t\treturn children;\n  \t};\n\n  \tRootModel.prototype.handleChange = function handleChange$1 () {\n  \t\tthis.deps.forEach( handleChange );\n  \t};\n\n  \tRootModel.prototype.has = function has ( key ) {\n  \t\tif ( ( key in this.mappings ) || ( key in this.computations ) ) return true;\n\n  \t\tvar value = this.value;\n\n  \t\tkey = unescapeKey( key );\n  \t\tif ( hasProp$1.call( value, key ) ) return true;\n\n  \t\t// We climb up the constructor chain to find if one of them contains the key\n  \t\tvar constructor = value.constructor;\n  \t\twhile ( constructor !== Function && constructor !== Array && constructor !== Object ) {\n  \t\t\tif ( hasProp$1.call( constructor.prototype, key ) ) return true;\n  \t\t\tconstructor = constructor.constructor;\n  \t\t}\n\n  \t\treturn false;\n  \t};\n\n  \tRootModel.prototype.joinKey = function joinKey ( key ) {\n  \t\tif ( key === '@global' ) return GlobalModel$1;\n  \t\tif ( key === '@this' ) return this.getRactiveModel();\n\n  \t\treturn this.mappings.hasOwnProperty( key ) ? this.mappings[ key ] :\n  \t\t       this.computations.hasOwnProperty( key ) ? this.computations[ key ] :\n  \t\t       Model.prototype.joinKey.call( this, key );\n  \t};\n\n  \tRootModel.prototype.map = function map ( localKey, origin ) {\n  \t\t// TODO remapping\n  \t\tthis.mappings[ localKey ] = origin;\n  \t\torigin.register( this );\n  \t};\n\n  \tRootModel.prototype.set = function set ( value ) {\n  \t\t// TODO wrapping root node is a baaaad idea. We should prevent this\n  \t\tvar wrapper = this.wrapper;\n  \t\tif ( wrapper ) {\n  \t\t\tvar shouldTeardown = !wrapper.reset || wrapper.reset( value ) === false;\n\n  \t\t\tif ( shouldTeardown ) {\n  \t\t\t\twrapper.teardown();\n  \t\t\t\tthis.wrapper = null;\n  \t\t\t\tthis.value = value;\n  \t\t\t\tthis.adapt();\n  \t\t\t}\n  \t\t} else {\n  \t\t\tthis.value = value;\n  \t\t\tthis.adapt();\n  \t\t}\n\n  \t\tthis.deps.forEach( handleChange );\n  \t\tthis.children.forEach( mark );\n  \t\tthis.clearUnresolveds(); // TODO do we need to do this with primitive values? if not, what about e.g. unresolved `length` property of null -> string?\n  \t};\n\n  \tRootModel.prototype.retrieve = function retrieve () {\n  \t\treturn this.value;\n  \t};\n\n  \tRootModel.prototype.teardown = function teardown () {\n  \t\tvar this$1 = this;\n\n  \t\tvar keys = Object.keys( this.mappings );\n  \t\tvar i = keys.length;\n  \t\twhile ( i-- ){\n  \t\t\tif ( this$1.mappings[ keys[i] ] ) this$1.mappings[ keys[i] ].unregister( this$1 );\n  \t\t}\n\n  \t\tModel.prototype.teardown.call(this);\n  \t};\n\n  \tRootModel.prototype.update = function update () {\n  \t\t// noop\n  \t};\n\n  \tRootModel.prototype.updateFromBindings = function updateFromBindings ( cascade ) {\n  \t\tvar this$1 = this;\n\n  \t\tModel.prototype.updateFromBindings.call( this, cascade );\n\n  \t\tif ( cascade ) {\n  \t\t\t// TODO computations as well?\n  \t\t\tObject.keys( this.mappings ).forEach( function ( key ) {\n  \t\t\t\tvar model = this$1.mappings[ key ];\n  \t\t\t\tmodel.updateFromBindings( cascade );\n  \t\t\t});\n  \t\t}\n  \t};\n\n  \treturn RootModel;\n  }(Model));\n\n  function getComputationSignature ( ractive, key, signature ) {\n  \tvar getter;\n  \tvar setter;\n\n  \t// useful for debugging\n  \tvar getterString;\n  \tvar getterUseStack;\n  \tvar setterString;\n\n  \tif ( typeof signature === 'function' ) {\n  \t\tgetter = bind$1( signature, ractive );\n  \t\tgetterString = signature.toString();\n  \t\tgetterUseStack = true;\n  \t}\n\n  \tif ( typeof signature === 'string' ) {\n  \t\tgetter = createFunctionFromString( signature, ractive );\n  \t\tgetterString = signature;\n  \t}\n\n  \tif ( typeof signature === 'object' ) {\n  \t\tif ( typeof signature.get === 'string' ) {\n  \t\t\tgetter = createFunctionFromString( signature.get, ractive );\n  \t\t\tgetterString = signature.get;\n  \t\t} else if ( typeof signature.get === 'function' ) {\n  \t\t\tgetter = bind$1( signature.get, ractive );\n  \t\t\tgetterString = signature.get.toString();\n  \t\t\tgetterUseStack = true;\n  \t\t} else {\n  \t\t\tfatal( '`%s` computation must have a `get()` method', key );\n  \t\t}\n\n  \t\tif ( typeof signature.set === 'function' ) {\n  \t\t\tsetter = bind$1( signature.set, ractive );\n  \t\t\tsetterString = signature.set.toString();\n  \t\t}\n  \t}\n\n  \treturn {\n  \t\tgetter: getter,\n  \t\tsetter: setter,\n  \t\tgetterString: getterString,\n  \t\tsetterString: setterString,\n  \t\tgetterUseStack: getterUseStack\n  \t};\n  }\n\n  var constructHook = new Hook( 'construct' );\n\n  var registryNames$1 = [\n  \t'adaptors',\n  \t'components',\n  \t'decorators',\n  \t'easing',\n  \t'events',\n  \t'interpolators',\n  \t'partials',\n  \t'transitions'\n  ];\n\n  var uid = 0;\n\n  function construct ( ractive, options ) {\n  \tif ( Ractive.DEBUG ) welcome();\n\n  \tinitialiseProperties( ractive );\n\n  \t// TODO remove this, eventually\n  \tdefineProperty( ractive, 'data', { get: deprecateRactiveData });\n\n  \t// TODO don't allow `onconstruct` with `new Ractive()`, there's no need for it\n  \tconstructHook.fire( ractive, options );\n\n  \t// Add registries\n  \tregistryNames$1.forEach( function ( name ) {\n  \t\tractive[ name ] = extendObj( create( ractive.constructor[ name ] || null ), options[ name ] );\n  \t});\n\n  \t// Create a viewmodel\n  \tvar viewmodel = new RootModel({\n  \t\tadapt: getAdaptors( ractive, ractive.adapt, options ),\n  \t\tdata: dataConfigurator.init( ractive.constructor, ractive, options ),\n  \t\tractive: ractive\n  \t});\n\n  \tractive.viewmodel = viewmodel;\n\n  \t// Add computed properties\n  \tvar computed = extendObj( create( ractive.constructor.prototype.computed ), options.computed );\n\n  \tfor ( var key in computed ) {\n  \t\tvar signature = getComputationSignature( ractive, key, computed[ key ] );\n  \t\tviewmodel.compute( key, signature );\n  \t}\n  }\n\n  function combine$2 ( a, b ) {\n  \tvar c = a.slice();\n  \tvar i = b.length;\n\n  \twhile ( i-- ) {\n  \t\tif ( !~c.indexOf( b[i] ) ) {\n  \t\t\tc.push( b[i] );\n  \t\t}\n  \t}\n\n  \treturn c;\n  }\n\n  function getAdaptors ( ractive, protoAdapt, options ) {\n  \tprotoAdapt = protoAdapt.map( lookup );\n  \tvar adapt = ensureArray( options.adapt ).map( lookup );\n\n  \tadapt = combine$2( protoAdapt, adapt );\n\n  \tvar magic = 'magic' in options ? options.magic : ractive.magic;\n  \tvar modifyArrays = 'modifyArrays' in options ? options.modifyArrays : ractive.modifyArrays;\n\n  \tif ( magic ) {\n  \t\tif ( !magicSupported ) {\n  \t\t\tthrow new Error( 'Getters and setters (magic mode) are not supported in this browser' );\n  \t\t}\n\n  \t\tif ( modifyArrays ) {\n  \t\t\tadapt.push( magicArrayAdaptor );\n  \t\t}\n\n  \t\tadapt.push( magicAdaptor$1 );\n  \t}\n\n  \tif ( modifyArrays ) {\n  \t\tadapt.push( arrayAdaptor );\n  \t}\n\n  \treturn adapt;\n\n\n  \tfunction lookup ( adaptor ) {\n  \t\tif ( typeof adaptor === 'string' ) {\n  \t\t\tadaptor = findInViewHierarchy( 'adaptors', ractive, adaptor );\n\n  \t\t\tif ( !adaptor ) {\n  \t\t\t\tfatal( missingPlugin( adaptor, 'adaptor' ) );\n  \t\t\t}\n  \t\t}\n\n  \t\treturn adaptor;\n  \t}\n  }\n\n  function initialiseProperties ( ractive ) {\n  \t// Generate a unique identifier, for places where you'd use a weak map if it\n  \t// existed\n  \tractive._guid = 'r-' + uid++;\n\n  \t// events\n  \tractive._subs = create( null );\n\n  \t// storage for item configuration from instantiation to reset,\n  \t// like dynamic functions or original values\n  \tractive._config = {};\n\n  \t// nodes registry\n  \tractive.nodes = {};\n\n  \t// events\n  \tractive.event = null;\n  \tractive._eventQueue = [];\n\n  \t// live queries\n  \tractive._liveQueries = [];\n  \tractive._liveComponentQueries = [];\n\n  \t// observers\n  \tractive._observers = [];\n\n  \t// links\n  \tractive._links = {};\n\n  \tif(!ractive.component){\n  \t\tractive.root = ractive;\n  \t\tractive.parent = ractive.container = null; // TODO container still applicable?\n  \t}\n\n  }\n\n  function deprecateRactiveData () {\n  \tthrow new Error( 'Using `ractive.data` is no longer supported - you must use the `ractive.get()` API instead' );\n  }\n\n  function getChildQueue ( queue, ractive ) {\n  \treturn queue[ ractive._guid ] || ( queue[ ractive._guid ] = [] );\n  }\n\n  function fire ( hookQueue, ractive ) {\n  \tvar childQueue = getChildQueue( hookQueue.queue, ractive );\n\n  \thookQueue.hook.fire( ractive );\n\n  \t// queue is \"live\" because components can end up being\n  \t// added while hooks fire on parents that modify data values.\n  \twhile ( childQueue.length ) {\n  \t\tfire( hookQueue, childQueue.shift() );\n  \t}\n\n  \tdelete hookQueue.queue[ ractive._guid ];\n  }\n\n  var HookQueue = function HookQueue ( event ) {\n  \tthis.hook = new Hook( event );\n  \tthis.inProcess = {};\n  \tthis.queue = {};\n  };\n\n  HookQueue.prototype.begin = function begin ( ractive ) {\n  \tthis.inProcess[ ractive._guid ] = true;\n  };\n\n  HookQueue.prototype.end = function end ( ractive ) {\n  \tvar parent = ractive.parent;\n\n  \t// If this is *isn't* a child of a component that's in process,\n  \t// it should call methods or fire at this point\n  \tif ( !parent || !this.inProcess[ parent._guid ] ) {\n  \t\tfire( this, ractive );\n  \t}\n  \t// elsewise, handoff to parent to fire when ready\n  \telse {\n  \t\tgetChildQueue( this.queue, parent ).push( ractive );\n  \t}\n\n  \tdelete this.inProcess[ ractive._guid ];\n  };\n\n  var configHook = new Hook( 'config' );\n  var initHook = new HookQueue( 'init' );\n\n  function initialise ( ractive, userOptions, options ) {\n  \tObject.keys( ractive.viewmodel.computations ).forEach( function ( key ) {\n  \t\tvar computation = ractive.viewmodel.computations[ key ];\n\n  \t\tif ( ractive.viewmodel.value.hasOwnProperty( key ) ) {\n  \t\t\tcomputation.set( ractive.viewmodel.value[ key ] );\n  \t\t}\n  \t});\n\n  \t// init config from Parent and options\n  \tconfig.init( ractive.constructor, ractive, userOptions );\n\n  \tconfigHook.fire( ractive );\n  \tinitHook.begin( ractive );\n\n  \tvar fragment;\n\n  \t// Render virtual DOM\n  \tif ( ractive.template ) {\n  \t\tvar cssIds;\n\n  \t\tif ( options.cssIds || ractive.cssId ) {\n  \t\t\tcssIds = options.cssIds ? options.cssIds.slice() : [];\n\n  \t\t\tif ( ractive.cssId ) {\n  \t\t\t\tcssIds.push( ractive.cssId );\n  \t\t\t}\n  \t\t}\n\n  \t\tractive.fragment = fragment = new Fragment({\n  \t\t\towner: ractive,\n  \t\t\ttemplate: ractive.template,\n  \t\t\tcssIds: cssIds\n  \t\t}).bind( ractive.viewmodel );\n  \t}\n\n  \tinitHook.end( ractive );\n\n  \tif ( fragment ) {\n  \t\t// render automatically ( if `el` is specified )\n  \t\tvar el = getElement( ractive.el );\n  \t\tif ( el ) {\n  \t\t\tvar promise = ractive.render( el, ractive.append );\n\n  \t\t\tif ( Ractive.DEBUG_PROMISES ) {\n  \t\t\t\tpromise['catch']( function ( err ) {\n  \t\t\t\t\twarnOnceIfDebug( 'Promise debugging is enabled, to help solve errors that happen asynchronously. Some browsers will log unhandled promise rejections, in which case you can safely disable promise debugging:\\n  Ractive.DEBUG_PROMISES = false;' );\n  \t\t\t\t\twarnIfDebug( 'An error happened during rendering', { ractive: ractive });\n  \t\t\t\t\tlogIfDebug( err );\n\n  \t\t\t\t\tthrow err;\n  \t\t\t\t});\n  \t\t\t}\n  \t\t}\n  \t}\n  }\n\n  var Parser;\n  var ParseError;\n  var leadingWhitespace = /^\\s+/;\n  ParseError = function ( message ) {\n  \tthis.name = 'ParseError';\n  \tthis.message = message;\n  \ttry {\n  \t\tthrow new Error(message);\n  \t} catch (e) {\n  \t\tthis.stack = e.stack;\n  \t}\n  };\n\n  ParseError.prototype = Error.prototype;\n\n  Parser = function ( str, options ) {\n  \tvar this$1 = this;\n\n  \tvar items, item, lineStart = 0;\n\n  \tthis.str = str;\n  \tthis.options = options || {};\n  \tthis.pos = 0;\n\n  \tthis.lines = this.str.split( '\\n' );\n  \tthis.lineEnds = this.lines.map( function ( line ) {\n  \t\tvar lineEnd = lineStart + line.length + 1; // +1 for the newline\n\n  \t\tlineStart = lineEnd;\n  \t\treturn lineEnd;\n  \t}, 0 );\n\n  \t// Custom init logic\n  \tif ( this.init ) this.init( str, options );\n\n  \titems = [];\n\n  \twhile ( ( this$1.pos < this$1.str.length ) && ( item = this$1.read() ) ) {\n  \t\titems.push( item );\n  \t}\n\n  \tthis.leftover = this.remaining();\n  \tthis.result = this.postProcess ? this.postProcess( items, options ) : items;\n  };\n\n  Parser.prototype = {\n  \tread: function ( converters ) {\n  \t\tvar this$1 = this;\n\n  \t\tvar pos, i, len, item;\n\n  \t\tif ( !converters ) converters = this.converters;\n\n  \t\tpos = this.pos;\n\n  \t\tlen = converters.length;\n  \t\tfor ( i = 0; i < len; i += 1 ) {\n  \t\t\tthis$1.pos = pos; // reset for each attempt\n\n  \t\t\tif ( item = converters[i]( this$1 ) ) {\n  \t\t\t\treturn item;\n  \t\t\t}\n  \t\t}\n\n  \t\treturn null;\n  \t},\n\n  \tgetLinePos: function ( char ) {\n  \t\tvar this$1 = this;\n\n  \t\tvar lineNum = 0, lineStart = 0, columnNum;\n\n  \t\twhile ( char >= this$1.lineEnds[ lineNum ] ) {\n  \t\t\tlineStart = this$1.lineEnds[ lineNum ];\n  \t\t\tlineNum += 1;\n  \t\t}\n\n  \t\tcolumnNum = char - lineStart;\n  \t\treturn [ lineNum + 1, columnNum + 1, char ]; // line/col should be one-based, not zero-based!\n  \t},\n\n  \terror: function ( message ) {\n  \t\tvar pos = this.getLinePos( this.pos );\n  \t\tvar lineNum = pos[0];\n  \t\tvar columnNum = pos[1];\n\n  \t\tvar line = this.lines[ pos[0] - 1 ];\n  \t\tvar numTabs = 0;\n  \t\tvar annotation = line.replace( /\\t/g, function ( match, char ) {\n  \t\t\tif ( char < pos[1] ) {\n  \t\t\t\tnumTabs += 1;\n  \t\t\t}\n\n  \t\t\treturn '  ';\n  \t\t}) + '\\n' + new Array( pos[1] + numTabs ).join( ' ' ) + '^----';\n\n  \t\tvar error = new ParseError( (\"\" + message + \" at line \" + lineNum + \" character \" + columnNum + \":\\n\" + annotation) );\n\n  \t\terror.line = pos[0];\n  \t\terror.character = pos[1];\n  \t\terror.shortMessage = message;\n\n  \t\tthrow error;\n  \t},\n\n  \tmatchString: function ( string ) {\n  \t\tif ( this.str.substr( this.pos, string.length ) === string ) {\n  \t\t\tthis.pos += string.length;\n  \t\t\treturn string;\n  \t\t}\n  \t},\n\n  \tmatchPattern: function ( pattern ) {\n  \t\tvar match;\n\n  \t\tif ( match = pattern.exec( this.remaining() ) ) {\n  \t\t\tthis.pos += match[0].length;\n  \t\t\treturn match[1] || match[0];\n  \t\t}\n  \t},\n\n  \tallowWhitespace: function () {\n  \t\tthis.matchPattern( leadingWhitespace );\n  \t},\n\n  \tremaining: function () {\n  \t\treturn this.str.substring( this.pos );\n  \t},\n\n  \tnextChar: function () {\n  \t\treturn this.str.charAt( this.pos );\n  \t}\n  };\n\n  Parser.extend = function ( proto ) {\n  \tvar Parent = this, Child, key;\n\n  \tChild = function ( str, options ) {\n  \t\tParser.call( this, str, options );\n  \t};\n\n  \tChild.prototype = create( Parent.prototype );\n\n  \tfor ( key in proto ) {\n  \t\tif ( hasOwn.call( proto, key ) ) {\n  \t\t\tChild.prototype[ key ] = proto[ key ];\n  \t\t}\n  \t}\n\n  \tChild.extend = Parser.extend;\n  \treturn Child;\n  };\n\n  var Parser$1 = Parser;\n\n  var stringMiddlePattern;\n  var escapeSequencePattern;\n  var lineContinuationPattern;\n  // Match one or more characters until: \", ', \\, or EOL/EOF.\n  // EOL/EOF is written as (?!.) (meaning there's no non-newline char next).\n  stringMiddlePattern = /^(?=.)[^\"'\\\\]+?(?:(?!.)|(?=[\"'\\\\]))/;\n\n  // Match one escape sequence, including the backslash.\n  escapeSequencePattern = /^\\\\(?:['\"\\\\bfnrt]|0(?![0-9])|x[0-9a-fA-F]{2}|u[0-9a-fA-F]{4}|(?=.)[^ux0-9])/;\n\n  // Match one ES5 line continuation (backslash + line terminator).\n  lineContinuationPattern = /^\\\\(?:\\r\\n|[\\u000A\\u000D\\u2028\\u2029])/;\n\n  // Helper for defining getDoubleQuotedString and getSingleQuotedString.\n  function makeQuotedStringMatcher ( okQuote ) {\n  \treturn function ( parser ) {\n  \t\tvar literal = '\"';\n  \t\tvar done = false;\n  \t\tvar next;\n\n  \t\twhile ( !done ) {\n  \t\t\tnext = ( parser.matchPattern( stringMiddlePattern ) || parser.matchPattern( escapeSequencePattern ) ||\n  \t\t\t\tparser.matchString( okQuote ) );\n  \t\t\tif ( next ) {\n  \t\t\t\tif ( next === (\"\\\"\") ) {\n  \t\t\t\t\tliteral += \"\\\\\\\"\";\n  \t\t\t\t} else if ( next === (\"\\\\'\") ) {\n  \t\t\t\t\tliteral += \"'\";\n  \t\t\t\t} else {\n  \t\t\t\t\tliteral += next;\n  \t\t\t\t}\n  \t\t\t} else {\n  \t\t\t\tnext = parser.matchPattern( lineContinuationPattern );\n  \t\t\t\tif ( next ) {\n  \t\t\t\t\t// convert \\(newline-like) into a \\u escape, which is allowed in JSON\n  \t\t\t\t\tliteral += '\\\\u' + ( '000' + next.charCodeAt(1).toString(16) ).slice( -4 );\n  \t\t\t\t} else {\n  \t\t\t\t\tdone = true;\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\tliteral += '\"';\n\n  \t\t// use JSON.parse to interpret escapes\n  \t\treturn JSON.parse( literal );\n  \t};\n  }\n\n  var getSingleQuotedString = makeQuotedStringMatcher( (\"\\\"\") );\n  var getDoubleQuotedString = makeQuotedStringMatcher( (\"'\") );\n\n  function readStringLiteral ( parser ) {\n  \tvar start, string;\n\n  \tstart = parser.pos;\n\n  \tif ( parser.matchString( '\"' ) ) {\n  \t\tstring = getDoubleQuotedString( parser );\n\n  \t\tif ( !parser.matchString( '\"' ) ) {\n  \t\t\tparser.pos = start;\n  \t\t\treturn null;\n  \t\t}\n\n  \t\treturn {\n  \t\t\tt: STRING_LITERAL,\n  \t\t\tv: string\n  \t\t};\n  \t}\n\n  \tif ( parser.matchString( (\"'\") ) ) {\n  \t\tstring = getSingleQuotedString( parser );\n\n  \t\tif ( !parser.matchString( (\"'\") ) ) {\n  \t\t\tparser.pos = start;\n  \t\t\treturn null;\n  \t\t}\n\n  \t\treturn {\n  \t\t\tt: STRING_LITERAL,\n  \t\t\tv: string\n  \t\t};\n  \t}\n\n  \treturn null;\n  }\n\n  // bulletproof number regex from https://gist.github.com/Rich-Harris/7544330\n  var numberPattern$1 = /^(?:[+-]?)0*(?:(?:(?:[1-9]\\d*)?\\.\\d+)|(?:(?:0|[1-9]\\d*)\\.)|(?:0|[1-9]\\d*))(?:[eE][+-]?\\d+)?/;\n\n  function readNumberLiteral ( parser ) {\n  \tvar result;\n\n  \tif ( result = parser.matchPattern( numberPattern$1 ) ) {\n  \t\treturn {\n  \t\t\tt: NUMBER_LITERAL,\n  \t\t\tv: result\n  \t\t};\n  \t}\n\n  \treturn null;\n  }\n\n  var name = /^[a-zA-Z_$][a-zA-Z_$0-9]*/;\n\n  var identifier = /^[a-zA-Z_$][a-zA-Z_$0-9]*$/;\n\n  // http://mathiasbynens.be/notes/javascript-properties\n  // can be any name, string literal, or number literal\n  function readKey ( parser ) {\n  \tvar token;\n\n  \tif ( token = readStringLiteral( parser ) ) {\n  \t\treturn identifier.test( token.v ) ? token.v : '\"' + token.v.replace( /\"/g, '\\\\\"' ) + '\"';\n  \t}\n\n  \tif ( token = readNumberLiteral( parser ) ) {\n  \t\treturn token.v;\n  \t}\n\n  \tif ( token = parser.matchPattern( name ) ) {\n  \t\treturn token;\n  \t}\n\n  \treturn null;\n  }\n\n  // simple JSON parser, without the restrictions of JSON parse\n  // (i.e. having to double-quote keys).\n  //\n  // If passed a hash of values as the second argument, ${placeholders}\n  // will be replaced with those values\n\n  var specials = {\n  \t'true': true,\n  \t'false': false,\n  \t'null': null,\n  \tundefined: undefined\n  };\n\n  var specialsPattern = new RegExp( '^(?:' + Object.keys( specials ).join( '|' ) + ')' );\n  var numberPattern = /^(?:[+-]?)(?:(?:(?:0|[1-9]\\d*)?\\.\\d+)|(?:(?:0|[1-9]\\d*)\\.)|(?:0|[1-9]\\d*))(?:[eE][+-]?\\d+)?/;\n  var placeholderPattern = /\\$\\{([^\\}]+)\\}/g;\n  var placeholderAtStartPattern = /^\\$\\{([^\\}]+)\\}/;\n  var onlyWhitespace = /^\\s*$/;\n\n  var JsonParser = Parser$1.extend({\n  \tinit: function ( str, options ) {\n  \t\tthis.values = options.values;\n  \t\tthis.allowWhitespace();\n  \t},\n\n  \tpostProcess: function ( result ) {\n  \t\tif ( result.length !== 1 || !onlyWhitespace.test( this.leftover ) ) {\n  \t\t\treturn null;\n  \t\t}\n\n  \t\treturn { value: result[0].v };\n  \t},\n\n  \tconverters: [\n  \t\tfunction getPlaceholder ( parser ) {\n  \t\t\tif ( !parser.values ) return null;\n\n  \t\t\tvar placeholder = parser.matchPattern( placeholderAtStartPattern );\n\n  \t\t\tif ( placeholder && ( parser.values.hasOwnProperty( placeholder ) ) ) {\n  \t\t\t\treturn { v: parser.values[ placeholder ] };\n  \t\t\t}\n  \t\t},\n\n  \t\tfunction getSpecial ( parser ) {\n  \t\t\tvar special = parser.matchPattern( specialsPattern );\n  \t\t\tif ( special ) return { v: specials[ special ] };\n  \t\t},\n\n  \t\tfunction getNumber ( parser ) {\n  \t\t\tvar number = parser.matchPattern( numberPattern );\n  \t\t\tif ( number ) return { v: +number };\n  \t\t},\n\n  \t\tfunction getString ( parser ) {\n  \t\t\tvar stringLiteral = readStringLiteral( parser );\n  \t\t\tvar values = parser.values;\n\n  \t\t\tif ( stringLiteral && values ) {\n  \t\t\t\treturn {\n  \t\t\t\t\tv: stringLiteral.v.replace( placeholderPattern, function ( match, $1 ) { return ( $1 in values ? values[ $1 ] : $1 ); } )\n  \t\t\t\t};\n  \t\t\t}\n\n  \t\t\treturn stringLiteral;\n  \t\t},\n\n  \t\tfunction getObject ( parser ) {\n  \t\t\tif ( !parser.matchString( '{' ) ) return null;\n\n  \t\t\tvar result = {};\n\n  \t\t\tparser.allowWhitespace();\n\n  \t\t\tif ( parser.matchString( '}' ) ) {\n  \t\t\t\treturn { v: result };\n  \t\t\t}\n\n  \t\t\tvar pair;\n  \t\t\twhile ( pair = getKeyValuePair( parser ) ) {\n  \t\t\t\tresult[ pair.key ] = pair.value;\n\n  \t\t\t\tparser.allowWhitespace();\n\n  \t\t\t\tif ( parser.matchString( '}' ) ) {\n  \t\t\t\t\treturn { v: result };\n  \t\t\t\t}\n\n  \t\t\t\tif ( !parser.matchString( ',' ) ) {\n  \t\t\t\t\treturn null;\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\treturn null;\n  \t\t},\n\n  \t\tfunction getArray ( parser ) {\n  \t\t\tif ( !parser.matchString( '[' ) ) return null;\n\n  \t\t\tvar result = [];\n\n  \t\t\tparser.allowWhitespace();\n\n  \t\t\tif ( parser.matchString( ']' ) ) {\n  \t\t\t\treturn { v: result };\n  \t\t\t}\n\n  \t\t\tvar valueToken;\n  \t\t\twhile ( valueToken = parser.read() ) {\n  \t\t\t\tresult.push( valueToken.v );\n\n  \t\t\t\tparser.allowWhitespace();\n\n  \t\t\t\tif ( parser.matchString( ']' ) ) {\n  \t\t\t\t\treturn { v: result };\n  \t\t\t\t}\n\n  \t\t\t\tif ( !parser.matchString( ',' ) ) {\n  \t\t\t\t\treturn null;\n  \t\t\t\t}\n\n  \t\t\t\tparser.allowWhitespace();\n  \t\t\t}\n\n  \t\t\treturn null;\n  \t\t}\n  \t]\n  });\n\n  function getKeyValuePair ( parser ) {\n  \tparser.allowWhitespace();\n\n  \tvar key = readKey( parser );\n\n  \tif ( !key ) return null;\n\n  \tvar pair = { key: key };\n\n  \tparser.allowWhitespace();\n  \tif ( !parser.matchString( ':' ) ) {\n  \t\treturn null;\n  \t}\n  \tparser.allowWhitespace();\n\n  \tvar valueToken = parser.read();\n\n  \tif ( !valueToken ) return null;\n\n  \tpair.value = valueToken.v;\n  \treturn pair;\n  }\n\n  function parseJSON ( str, values ) {\n  \tvar parser = new JsonParser( str, { values: values });\n  \treturn parser.result;\n  }\n\n  var specialPattern = /^(event|arguments)(\\..+)?$/;\n  var dollarArgsPattern = /^\\$(\\d+)(\\..+)?$/;\n\n  var EventDirective = function EventDirective ( owner, event, template ) {\n  \tthis.owner = owner;\n  \tthis.event = event;\n  \tthis.template = template;\n\n  \tthis.ractive = owner.parentFragment.ractive;\n  \tthis.parentFragment = owner.parentFragment;\n\n  \tthis.context = null;\n\n  \t// method calls\n  \tthis.resolvers = null;\n  \tthis.models = null;\n\n  \t// handler directive\n  \tthis.action = null;\n  \tthis.args = null;\n  };\n\n  EventDirective.prototype.bind = function bind () {\n  \tvar this$1 = this;\n\n  \t\tthis.context = this.parentFragment.findContext();\n\n  \tvar template = this.template;\n\n  \tif ( template.x ) {\n  \t\tthis.fn = getFunction( template.x.s, template.x.r.length );\n  \t\tthis.resolvers = [];\n  \t\tthis.models = template.x.r.map( function ( ref, i ) {\n  \t\t\tvar specialMatch = specialPattern.exec( ref );\n  \t\t\tif ( specialMatch ) {\n  \t\t\t\t// on-click=\"foo(event.node)\"\n  \t\t\t\treturn {\n  \t\t\t\t\tspecial: specialMatch[1],\n  \t\t\t\t\tkeys: specialMatch[2] ? splitKeypathI( specialMatch[2].substr(1) ) : []\n  \t\t\t\t};\n  \t\t\t}\n\n  \t\t\tvar dollarMatch = dollarArgsPattern.exec( ref );\n  \t\t\tif ( dollarMatch ) {\n  \t\t\t\t// on-click=\"foo($1)\"\n  \t\t\t\treturn {\n  \t\t\t\t\tspecial: 'arguments',\n  \t\t\t\t\tkeys: [ dollarMatch[1] - 1 ].concat( dollarMatch[2] ? splitKeypathI( dollarMatch[2].substr( 1 ) ) : [] )\n  \t\t\t\t};\n  \t\t\t}\n\n  \t\t\tvar resolver;\n\n  \t\t\tvar model = resolveReference( this$1.parentFragment, ref );\n  \t\t\tif ( !model ) {\n  \t\t\t\tresolver = this$1.parentFragment.resolve( ref, function ( model ) {\n  \t\t\t\t\tthis$1.models[i] = model;\n  \t\t\t\t\tremoveFromArray( this$1.resolvers, resolver );\n  \t\t\t\t});\n\n  \t\t\t\tthis$1.resolvers.push( resolver );\n  \t\t\t}\n\n  \t\t\treturn model;\n  \t\t});\n  \t}\n\n  \telse {\n  \t\t// TODO deprecate this style of directive\n  \t\tthis.action = typeof template === 'string' ? // on-click='foo'\n  \t\t\ttemplate :\n  \t\t\ttypeof template.n === 'string' ? // on-click='{{dynamic}}'\n  \t\t\t\ttemplate.n :\n  \t\t\t\tnew Fragment({\n  \t\t\t\t\towner: this,\n  \t\t\t\t\ttemplate: template.n\n  \t\t\t\t});\n\n  \t\tthis.args = template.a ? // static arguments\n  \t\t\t( typeof template.a === 'string' ? [ template.a ] : template.a ) :\n  \t\t\ttemplate.d ? // dynamic arguments\n  \t\t\t\tnew Fragment({\n  \t\t\t\t\towner: this,\n  \t\t\t\t\ttemplate: template.d\n  \t\t\t\t}) :\n  \t\t\t\t[]; // no arguments\n  \t}\n\n  \tif ( this.template.n && typeof this.template.n !== 'string' ) this.action.bind();\n  \tif ( this.template.d ) this.args.bind();\n  };\n\n  EventDirective.prototype.bubble = function bubble () {\n  \tif ( !this.dirty ) {\n  \t\tthis.dirty = true;\n  \t\tthis.owner.bubble();\n  \t}\n  };\n\n  EventDirective.prototype.fire = function fire ( event, passedArgs ) {\n\n  \t// augment event object\n  \tif ( passedArgs === void 0 ) passedArgs = [];\n\n  \t\tif ( event && !event.hasOwnProperty( '_element' ) ) {\n  \t\t   addHelpers( event, this.owner );\n  \t}\n\n  \tif ( this.fn ) {\n  \t\tvar values = [];\n\n  \t\tif ( event ) passedArgs.unshift( event );\n\n  \t\tif ( this.models ) {\n  \t\t\tthis.models.forEach( function ( model ) {\n  \t\t\t\tif ( !model ) return values.push( undefined );\n\n  \t\t\t\tif ( model.special ) {\n  \t\t\t\t\tvar obj = model.special === 'event' ? event : passedArgs;\n  \t\t\t\t\tvar keys = model.keys.slice();\n\n  \t\t\t\t\twhile ( keys.length ) obj = obj[ keys.shift() ];\n  \t\t\t\t\treturn values.push( obj );\n  \t\t\t\t}\n\n  \t\t\t\tif ( model.wrapper ) {\n  \t\t\t\t\treturn values.push( model.wrapper.value );\n  \t\t\t\t}\n\n  \t\t\t\tvalues.push( model.get() );\n  \t\t\t});\n  \t\t}\n\n  \t\t// make event available as `this.event`\n  \t\tvar ractive = this.ractive;\n  \t\tvar oldEvent = ractive.event;\n\n  \t\tractive.event = event;\n  \t\tvar result = this.fn.apply( ractive, values ).pop();\n\n  \t\t// Auto prevent and stop if return is explicitly false\n  \t\tvar original;\n  \t\tif ( result === false && ( original = event.original ) ) {\n  \t\t\toriginal.preventDefault && original.preventDefault();\n  \t\t\toriginal.stopPropagation && original.stopPropagation();\n  \t\t}\n\n  \t\tractive.event = oldEvent;\n  \t}\n\n  \telse {\n  \t\tvar action = this.action.toString();\n  \t\tvar args = this.template.d ? this.args.getArgsList() : this.args;\n\n  \t\tif ( passedArgs.length ) args = args.concat( passedArgs );\n\n  \t\tif ( event ) event.name = action;\n\n  \t\tfireEvent( this.ractive, action, {\n  \t\t\tevent: event,\n  \t\t\targs: args\n  \t\t});\n  \t}\n  };\n\n  EventDirective.prototype.rebind = function rebind () {\n  \tthis.unbind();\n  \tthis.bind();\n  };\n\n  EventDirective.prototype.render = function render () {\n  \tthis.event.listen( this );\n  };\n\n  EventDirective.prototype.unbind = function unbind$1 () {\n  \tif ( this.resolvers ) this.resolvers.forEach( unbind );\n  \tif ( this.action && this.action.unbind ) this.action.unbind();\n  \tif ( this.args && this.args.unbind ) this.args.unbind();\n  };\n\n  EventDirective.prototype.unrender = function unrender () {\n  \tthis.event.unlisten();\n  };\n\n  EventDirective.prototype.update = function update () {\n  \tif ( this.method || !this.dirty ) return; // nothing to do\n\n  \tthis.dirty = false;\n\n  \t// ugh legacy\n  \tif ( this.action && this.action.update ) this.action.update();\n  \tif ( this.args && this.args.update ) this.args.update();\n  };\n\n  var RactiveEvent = function RactiveEvent ( ractive, name ) {\n  \tthis.ractive = ractive;\n  \tthis.name = name;\n  \tthis.handler = null;\n  };\n\n  RactiveEvent.prototype.listen = function listen ( directive ) {\n  \tvar ractive = this.ractive;\n\n  \tthis.handler = ractive.on( this.name, function () {\n  \t\tvar event;\n\n  \t\t// semi-weak test, but what else? tag the event obj ._isEvent ?\n  \t\tif ( arguments.length && arguments[0] && arguments[0].node ) {\n  \t\t\tevent = Array.prototype.shift.call( arguments );\n  \t\t\tevent.component = ractive;\n  \t\t}\n\n  \t\tvar args = Array.prototype.slice.call( arguments );\n  \t\tdirective.fire( event, args );\n\n  \t\t// cancel bubbling\n  \t\treturn false;\n  \t});\n  };\n\n  RactiveEvent.prototype.unlisten = function unlisten () {\n  \tthis.handler.cancel();\n  };\n\n  // TODO it's unfortunate that this has to run every time a\n  // component is rendered... is there a better way?\n  function updateLiveQueries ( component ) {\n  \t// Does this need to be added to any live queries?\n  \tvar instance = component.ractive;\n\n  \tdo {\n  \t\tvar liveQueries = instance._liveComponentQueries;\n\n  \t\tvar i = liveQueries.length;\n  \t\twhile ( i-- ) {\n  \t\t\tvar name = liveQueries[i];\n  \t\t\tvar query = liveQueries[ (\"_\" + name) ];\n\n  \t\t\tif ( query.test( component ) ) {\n  \t\t\t\tquery.add( component.instance );\n  \t\t\t\t// keep register of applicable selectors, for when we teardown\n  \t\t\t\tcomponent.liveQueries.push( query );\n  \t\t\t}\n  \t\t}\n  \t} while ( instance = instance.parent );\n  }\n\n  function removeFromLiveComponentQueries ( component ) {\n  \tvar instance = component.ractive;\n\n  \twhile ( instance ) {\n  \t\tvar query = instance._liveComponentQueries[ (\"_\" + (component.name)) ];\n  \t\tif ( query ) query.remove( component );\n\n  \t\tinstance = instance.parent;\n  \t}\n  }\n\n  function makeDirty ( query ) {\n  \tquery.makeDirty();\n  }\n\n  var teardownHook = new Hook( 'teardown' );\n\n  var Component = (function (Item) {\n  \tfunction Component ( options, ComponentConstructor ) {\n  \t\tItem.call( this, options );\n  \t\tthis.type = COMPONENT; // override ELEMENT from super\n\n  \t\tvar instance = create( ComponentConstructor.prototype );\n\n  \t\tthis.instance = instance;\n  \t\tthis.name = options.template.e;\n  \t\tthis.parentFragment = options.parentFragment;\n  \t\tthis.complexMappings = [];\n\n  \t\tthis.liveQueries = [];\n\n  \t\tif ( instance.el ) {\n  \t\t\twarnIfDebug( (\"The <\" + (this.name) + \"> component has a default 'el' property; it has been disregarded\") );\n  \t\t}\n\n  \t\tvar partials = options.template.p || {};\n  \t\tif ( !( 'content' in partials ) ) partials.content = options.template.f || [];\n  \t\tthis._partials = partials; // TEMP\n\n  \t\tthis.yielders = {};\n\n  \t\t// find container\n  \t\tvar fragment = options.parentFragment;\n  \t\tvar container;\n  \t\twhile ( fragment ) {\n  \t\t\tif ( fragment.owner.type === YIELDER ) {\n  \t\t\t\tcontainer = fragment.owner.container;\n  \t\t\t\tbreak;\n  \t\t\t}\n\n  \t\t\tfragment = fragment.parent;\n  \t\t}\n\n  \t\t// add component-instance-specific properties\n  \t\tinstance.parent = this.parentFragment.ractive;\n  \t\tinstance.container = container || null;\n  \t\tinstance.root = instance.parent.root;\n  \t\tinstance.component = this;\n\n  \t\tconstruct( this.instance, { partials: partials });\n\n  \t\t// for hackability, this could be an open option\n  \t\t// for any ractive instance, but for now, just\n  \t\t// for components and just for ractive...\n  \t\tinstance._inlinePartials = partials;\n\n  \t\tthis.eventHandlers = [];\n  \t\tif ( this.template.v ) this.setupEvents();\n  \t}\n\n  \tComponent.prototype = Object.create( Item && Item.prototype );\n  \tComponent.prototype.constructor = Component;\n\n  \tComponent.prototype.bind = function bind$1 () {\n  \t\tvar this$1 = this;\n\n  \t\tvar viewmodel = this.instance.viewmodel;\n  \t\tvar childData = viewmodel.value;\n\n  \t\t// determine mappings\n  \t\tif ( this.template.a ) {\n  \t\t\tObject.keys( this.template.a ).forEach( function ( localKey ) {\n  \t\t\t\tvar template = this$1.template.a[ localKey ];\n  \t\t\t\tvar model;\n  \t\t\t\tvar fragment;\n\n  \t\t\t\tif ( template === 0 ) {\n  \t\t\t\t\t// empty attributes are `true`\n  \t\t\t\t\tviewmodel.joinKey( localKey ).set( true );\n  \t\t\t\t}\n\n  \t\t\t\telse if ( typeof template === 'string' ) {\n  \t\t\t\t\tvar parsed = parseJSON( template );\n  \t\t\t\t\tviewmodel.joinKey( localKey ).set( parsed ? parsed.value : template );\n  \t\t\t\t}\n\n  \t\t\t\telse if ( isArray( template ) ) {\n  \t\t\t\t\tif ( template.length === 1 && template[0].t === INTERPOLATOR ) {\n  \t\t\t\t\t\tmodel = resolve$2( this$1.parentFragment, template[0] );\n\n  \t\t\t\t\t\tif ( !model ) {\n  \t\t\t\t\t\t\twarnOnceIfDebug( (\"The \" + localKey + \"='{{\" + (template[0].r) + \"}}' mapping is ambiguous, and may cause unexpected results. Consider initialising your data to eliminate the ambiguity\"), { ractive: this$1.instance }); // TODO add docs page explaining this\n  \t\t\t\t\t\t\tthis$1.parentFragment.ractive.get( localKey ); // side-effect: create mappings as necessary\n  \t\t\t\t\t\t\tmodel = this$1.parentFragment.findContext().joinKey( localKey );\n  \t\t\t\t\t\t}\n\n  \t\t\t\t\t\tviewmodel.map( localKey, model );\n\n  \t\t\t\t\t\tif ( model.get() === undefined && localKey in childData ) {\n  \t\t\t\t\t\t\tmodel.set( childData[ localKey ] );\n  \t\t\t\t\t\t}\n  \t\t\t\t\t}\n\n  \t\t\t\t\telse {\n  \t\t\t\t\t\tfragment = new Fragment({\n  \t\t\t\t\t\t\towner: this$1,\n  \t\t\t\t\t\t\ttemplate: template\n  \t\t\t\t\t\t}).bind();\n\n  \t\t\t\t\t\tmodel = viewmodel.joinKey( localKey );\n  \t\t\t\t\t\tmodel.set( fragment.valueOf() );\n\n  \t\t\t\t\t\t// this is a *bit* of a hack\n  \t\t\t\t\t\tfragment.bubble = function () {\n  \t\t\t\t\t\t\tFragment.prototype.bubble.call( fragment );\n  \t\t\t\t\t\t\tfragment.update();\n  \t\t\t\t\t\t\tmodel.set( fragment.valueOf() );\n  \t\t\t\t\t\t};\n\n  \t\t\t\t\t\tthis$1.complexMappings.push( fragment );\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t\t});\n  \t\t}\n\n  \t\tinitialise( this.instance, {\n  \t\t\tpartials: this._partials\n  \t\t}, {\n  \t\t\tcssIds: this.parentFragment.cssIds\n  \t\t});\n\n  \t\tthis.eventHandlers.forEach( bind );\n  \t};\n\n  \tComponent.prototype.bubble = function bubble () {\n  \t\tif ( !this.dirty ) {\n  \t\t\tthis.dirty = true;\n  \t\t\tthis.parentFragment.bubble();\n  \t\t}\n  \t};\n\n  \tComponent.prototype.checkYielders = function checkYielders () {\n  \t\tvar this$1 = this;\n\n  \t\tObject.keys( this.yielders ).forEach( function ( name ) {\n  \t\t\tif ( this$1.yielders[ name ].length > 1 ) {\n  \t\t\t\trunloop.end();\n  \t\t\t\tthrow new Error( (\"A component template can only have one {{yield\" + (name ? ' ' + name : '') + \"}} declaration at a time\") );\n  \t\t\t}\n  \t\t});\n  \t};\n\n  \tComponent.prototype.detach = function detach () {\n  \t\treturn this.instance.fragment.detach();\n  \t};\n\n  \tComponent.prototype.find = function find ( selector ) {\n  \t\treturn this.instance.fragment.find( selector );\n  \t};\n\n  \tComponent.prototype.findAll = function findAll ( selector, query ) {\n  \t\tthis.instance.fragment.findAll( selector, query );\n  \t};\n\n  \tComponent.prototype.findComponent = function findComponent ( name ) {\n  \t\tif ( !name || this.name === name ) return this.instance;\n\n  \t\tif ( this.instance.fragment ) {\n  \t\t\treturn this.instance.fragment.findComponent( name );\n  \t\t}\n  \t};\n\n  \tComponent.prototype.findAllComponents = function findAllComponents ( name, query ) {\n  \t\tif ( query.test( this ) ) {\n  \t\t\tquery.add( this.instance );\n\n  \t\t\tif ( query.live ) {\n  \t\t\t\tthis.liveQueries.push( query );\n  \t\t\t}\n  \t\t}\n\n  \t\tthis.instance.fragment.findAllComponents( name, query );\n  \t};\n\n  \tComponent.prototype.firstNode = function firstNode ( skipParent ) {\n  \t\treturn this.instance.fragment.firstNode( skipParent );\n  \t};\n\n  \tComponent.prototype.rebind = function rebind$1 () {\n  \t\tvar this$1 = this;\n\n  \t\tthis.complexMappings.forEach( rebind );\n\n  \t\tthis.liveQueries.forEach( makeDirty );\n\n  \t\t// update relevant mappings\n  \t\tvar viewmodel = this.instance.viewmodel;\n  \t\tviewmodel.mappings = {};\n\n  \t\tif ( this.template.a ) {\n  \t\t\tObject.keys( this.template.a ).forEach( function ( localKey ) {\n  \t\t\t\tvar template = this$1.template.a[ localKey ];\n  \t\t\t\tvar model;\n\n  \t\t\t\tif ( isArray( template ) && template.length === 1 && template[0].t === INTERPOLATOR ) {\n  \t\t\t\t\tmodel = resolve$2( this$1.parentFragment, template[0] );\n\n  \t\t\t\t\tif ( !model ) {\n  \t\t\t\t\t\t// TODO is this even possible?\n  \t\t\t\t\t\twarnOnceIfDebug( (\"The \" + localKey + \"='{{\" + (template[0].r) + \"}}' mapping is ambiguous, and may cause unexpected results. Consider initialising your data to eliminate the ambiguity\"), { ractive: this$1.instance });\n  \t\t\t\t\t\tthis$1.parentFragment.ractive.get( localKey ); // side-effect: create mappings as necessary\n  \t\t\t\t\t\tmodel = this$1.parentFragment.findContext().joinKey( localKey );\n  \t\t\t\t\t}\n\n  \t\t\t\t\tviewmodel.map( localKey, model );\n  \t\t\t\t}\n  \t\t\t});\n  \t\t}\n\n  \t\tthis.instance.fragment.rebind( viewmodel );\n  \t};\n\n  \tComponent.prototype.render = function render$1$$ ( target, occupants ) {\n  \t\trender$1( this.instance, target, null, occupants );\n\n  \t\tthis.checkYielders();\n  \t\tthis.eventHandlers.forEach( render );\n  \t\tupdateLiveQueries( this );\n\n  \t\tthis.rendered = true;\n  \t};\n\n  \tComponent.prototype.setupEvents = function setupEvents () {\n  \t\tvar this$1 = this;\n\n  \t\tvar handlers = this.eventHandlers;\n\n  \t\tObject.keys( this.template.v ).forEach( function ( key ) {\n  \t\t\tvar eventNames = key.split( '-' );\n  \t\t\tvar template = this$1.template.v[ key ];\n\n  \t\t\teventNames.forEach( function ( eventName ) {\n  \t\t\t\tvar event = new RactiveEvent( this$1.instance, eventName );\n  \t\t\t\thandlers.push( new EventDirective( this$1, event, template ) );\n  \t\t\t});\n  \t\t});\n  \t};\n\n  \tComponent.prototype.toString = function toString () {\n  \t\treturn this.instance.toHTML();\n  \t};\n\n  \tComponent.prototype.unbind = function unbind$1 () {\n  \t\tthis.complexMappings.forEach( unbind );\n\n  \t\tvar instance = this.instance;\n  \t\tinstance.viewmodel.teardown();\n  \t\tinstance.fragment.unbind();\n  \t\tinstance._observers.forEach( cancel );\n\n  \t\tremoveFromLiveComponentQueries( this );\n\n  \t\tif ( instance.fragment.rendered && instance.el.__ractive_instances__ ) {\n  \t\t\tremoveFromArray( instance.el.__ractive_instances__, instance );\n  \t\t}\n\n  \t\tObject.keys( instance._links ).forEach( function ( k ) { return instance._links[k].unlink(); } );\n\n  \t\tteardownHook.fire( instance );\n  \t};\n\n  \tComponent.prototype.unrender = function unrender$1 ( shouldDestroy ) {\n  \t\tvar this$1 = this;\n\n  \t\tthis.shouldDestroy = shouldDestroy;\n  \t\tthis.instance.unrender();\n  \t\tthis.eventHandlers.forEach( unrender );\n  \t\tthis.liveQueries.forEach( function ( query ) { return query.remove( this$1.instance ); } );\n  \t};\n\n  \tComponent.prototype.update = function update$1 () {\n  \t\tthis.dirty = false;\n  \t\tthis.instance.fragment.update();\n  \t\tthis.checkYielders();\n  \t\tthis.eventHandlers.forEach( update );\n  \t\tthis.complexMappings.forEach( update );\n  \t};\n\n  \treturn Component;\n  }(Item));\n\n  var Doctype = (function (Item) {\n  \tfunction Doctype () {\n  \t\tItem.apply(this, arguments);\n  \t}\n\n  \tDoctype.prototype = Object.create( Item && Item.prototype );\n  \tDoctype.prototype.constructor = Doctype;\n\n  \tDoctype.prototype.bind = function bind () {\n  \t\t// noop\n  \t};\n\n  \tDoctype.prototype.render = function render () {\n  \t\t// noop\n  \t};\n\n  \tDoctype.prototype.teardown = function teardown () {\n  \t\t// noop\n  \t};\n\n  \tDoctype.prototype.toString = function toString () {\n  \t\treturn '<!DOCTYPE' + this.template.a + '>';\n  \t};\n\n  \tDoctype.prototype.unbind = function unbind () {\n  \t\t// noop\n  \t};\n\n  \tDoctype.prototype.unrender = function unrender () {\n  \t\t// noop\n  \t};\n\n  \treturn Doctype;\n  }(Item));\n\n  function camelCase ( hyphenatedStr ) {\n  \treturn hyphenatedStr.replace( /-([a-zA-Z])/g, function ( match, $1 ) {\n  \t\treturn $1.toUpperCase();\n  \t});\n  }\n\n  var space = /\\s+/;\n  var specials$1 = { 'float': 'cssFloat' };\n  var remove = /\\/\\*(?:[\\s\\S]*?)\\*\\//g;\n  var escape = /url\\(\\s*(['\"])(?:\\\\[\\s\\S]|(?!\\1).)*\\1\\s*\\)|url\\((?:\\\\[\\s\\S]|[^)])*\\)|(['\"])(?:\\\\[\\s\\S]|(?!\\1).)*\\2/gi;\n  var value = /\\0(\\d+)/g;\n\n  function readStyle ( css ) {\n      var values = [];\n\n      if ( typeof css !== 'string' ) return {};\n\n      return css.replace( escape, function ( match ) { return (\"\\u0000\" + (values.push( match ) - 1)); })\n          .replace( remove, '' )\n          .split( ';' )\n          .filter( function ( rule ) { return !!rule.trim(); } )\n          .map( function ( rule ) { return rule.replace( value, function ( match, n ) { return values[ n ]; } ); } )\n          .reduce(function ( rules, rule ) {\n              var i = rule.indexOf(':');\n              var name = camelCase( rule.substr( 0, i ).trim() );\n              rules[ specials$1[ name ] || name ] = rule.substr( i + 1 ).trim();\n              return rules;\n          }, {});\n  }\n\n  function readClass ( str ) {\n    var list = str.split( space );\n\n    // remove any empty entries\n    var i = list.length;\n    while ( i-- ) {\n      if ( !list[i] ) list.splice( i, 1 );\n    }\n\n    return list;\n  }\n\n  var textTypes = [ undefined, 'text', 'search', 'url', 'email', 'hidden', 'password', 'search', 'reset', 'submit' ];\n\n  function getUpdateDelegate ( attribute ) {\n  \tvar element = attribute.element, name = attribute.name;\n\n  \tif ( name === 'id' ) return updateId;\n\n  \tif ( name === 'value' ) {\n  \t\t// special case - selects\n  \t\tif ( element.name === 'select' && name === 'value' ) {\n  \t\t\treturn element.getAttribute( 'multiple' ) ? updateMultipleSelectValue : updateSelectValue;\n  \t\t}\n\n  \t\tif ( element.name === 'textarea' ) return updateStringValue;\n\n  \t\t// special case - contenteditable\n  \t\tif ( element.getAttribute( 'contenteditable' ) != null ) return updateContentEditableValue;\n\n  \t\t// special case - <input>\n  \t\tif ( element.name === 'input' ) {\n  \t\t\tvar type = element.getAttribute( 'type' );\n\n  \t\t\t// type='file' value='{{fileList}}'>\n  \t\t\tif ( type === 'file' ) return noop; // read-only\n\n  \t\t\t// type='radio' name='{{twoway}}'\n  \t\t\tif ( type === 'radio' && element.binding && element.binding.attribute.name === 'name' ) return updateRadioValue;\n\n  \t\t\tif ( ~textTypes.indexOf( type ) ) return updateStringValue;\n  \t\t}\n\n  \t\treturn updateValue;\n  \t}\n\n  \tvar node = element.node;\n\n  \t// special case - <input type='radio' name='{{twoway}}' value='foo'>\n  \tif ( attribute.isTwoway && name === 'name' ) {\n  \t\tif ( node.type === 'radio' ) return updateRadioName;\n  \t\tif ( node.type === 'checkbox' ) return updateCheckboxName;\n  \t}\n\n  \tif ( name === 'style' ) return updateStyleAttribute;\n\n  \tif ( name.indexOf( 'style-' ) === 0 ) return updateInlineStyle;\n\n  \t// special case - class names. IE fucks things up, again\n  \tif ( name === 'class' && ( !node.namespaceURI || node.namespaceURI === html ) ) return updateClassName;\n\n  \tif ( name.indexOf( 'class-' ) === 0 ) return updateInlineClass;\n\n  \tif ( attribute.isBoolean ) return updateBoolean;\n\n  \tif ( attribute.namespace && attribute.namespace !== attribute.node.namespaceURI ) return updateNamespacedAttribute;\n\n  \treturn updateAttribute;\n  }\n\n  function updateId () {\n  \tvar ref = this, node = ref.node;\n  \tvar value = this.getValue();\n\n  \tdelete this.ractive.nodes[ node.id ];\n  \tthis.ractive.nodes[ value ] = node;\n\n  \tnode.id = value;\n  }\n\n  function updateMultipleSelectValue () {\n  \tvar value = this.getValue();\n\n  \tif ( !isArray( value ) ) value = [ value ];\n\n  \tvar options = this.node.options;\n  \tvar i = options.length;\n\n  \twhile ( i-- ) {\n  \t\tvar option = options[i];\n  \t\tvar optionValue = option._ractive ?\n  \t\t\toption._ractive.value :\n  \t\t\toption.value; // options inserted via a triple don't have _ractive\n\n  \t\toption.selected = arrayContains( value, optionValue );\n  \t}\n  }\n\n  function updateSelectValue () {\n  \tvar value = this.getValue();\n\n  \tif ( !this.locked ) { // TODO is locked still a thing?\n  \t\tthis.node._ractive.value = value;\n\n  \t\tvar options = this.node.options;\n  \t\tvar i = options.length;\n\n  \t\twhile ( i-- ) {\n  \t\t\tvar option = options[i];\n  \t\t\tvar optionValue = option._ractive ?\n  \t\t\t\toption._ractive.value :\n  \t\t\t\toption.value; // options inserted via a triple don't have _ractive\n\n  \t\t\tif ( optionValue == value ) { // double equals as we may be comparing numbers with strings\n  \t\t\t\toption.selected = true;\n  \t\t\t\treturn;\n  \t\t\t}\n  \t\t}\n\n  \t\tthis.node.selectedIndex = -1;\n  \t}\n  }\n\n\n  function updateContentEditableValue () {\n  \tvar value = this.getValue();\n\n  \tif ( !this.locked ) {\n  \t\tthis.node.innerHTML = value === undefined ? '' : value;\n  \t}\n  }\n\n  function updateRadioValue () {\n  \tvar node = this.node;\n  \tvar wasChecked = node.checked;\n\n  \tvar value = this.getValue();\n\n  \t//node.value = this.element.getAttribute( 'value' );\n  \tnode.value = this.node._ractive.value = value;\n  \tnode.checked = value === this.element.getAttribute( 'name' );\n\n  \t// This is a special case - if the input was checked, and the value\n  \t// changed so that it's no longer checked, the twoway binding is\n  \t// most likely out of date. To fix it we have to jump through some\n  \t// hoops... this is a little kludgy but it works\n  \tif ( wasChecked && !node.checked && this.element.binding && this.element.binding.rendered ) {\n  \t\tthis.element.binding.group.model.set( this.element.binding.group.getValue() );\n  \t}\n  }\n\n  function updateValue () {\n  \tif ( !this.locked ) {\n  \t\tvar value = this.getValue();\n\n  \t\tthis.node.value = this.node._ractive.value = value;\n  \t\tthis.node.setAttribute( 'value', value );\n  \t}\n  }\n\n  function updateStringValue () {\n  \tif ( !this.locked ) {\n  \t\tvar value = this.getValue();\n\n  \t\tthis.node._ractive.value = value;\n\n  \t\tthis.node.value = safeToStringValue( value );\n  \t\tthis.node.setAttribute( 'value', safeToStringValue( value ) );\n  \t}\n  }\n\n  function updateRadioName () {\n  \tthis.node.checked = ( this.getValue() == this.node._ractive.value );\n  }\n\n  function updateCheckboxName () {\n  \tvar ref = this, element = ref.element, node = ref.node;\n  \tvar binding = element.binding;\n\n  \tvar value = this.getValue();\n  \tvar valueAttribute = element.getAttribute( 'value' );\n\n  \tif ( !isArray( value ) ) {\n  \t\tbinding.isChecked = node.checked = ( value == valueAttribute );\n  \t} else {\n  \t\tvar i = value.length;\n  \t\twhile ( i-- ) {\n  \t\t\tif ( valueAttribute == value[i] ) {\n  \t\t\t\tbinding.isChecked = node.checked = true;\n  \t\t\t\treturn;\n  \t\t\t}\n  \t\t}\n  \t\tbinding.isChecked = node.checked = false;\n  \t}\n  }\n\n  function updateStyleAttribute () {\n  \tvar props = readStyle( this.getValue() || '' );\n  \tvar style = this.node.style;\n  \tvar keys = Object.keys( props );\n  \tvar prev = this.previous || [];\n\n  \tvar i = 0;\n  \twhile ( i < keys.length ) {\n  \t\tif ( keys[i] in style ) style[ keys[i] ] = props[ keys[i] ];\n  \t\ti++;\n  \t}\n\n  \t// remove now-missing attrs\n  \ti = prev.length;\n  \twhile ( i-- ) {\n  \t\tif ( !~keys.indexOf( prev[i] ) && prev[i] in style ) style[ prev[i] ] = '';\n  \t}\n\n  \tthis.previous = keys;\n  }\n\n  function updateInlineStyle () {\n  \tif ( !this.styleName ) {\n  \t\tthis.styleName = camelize( this.name.substr( 6 ) );\n  \t}\n\n  \tthis.node.style[ this.styleName ] = this.getValue();\n  }\n\n  function updateClassName () {\n  \tvar value = readClass( safeToStringValue( this.getValue() ) );\n  \tvar attr = readClass( this.node.className );\n  \tvar prev = this.previous || attr.slice( 0 );\n\n  \tvar i = 0;\n  \twhile ( i < value.length ) {\n  \t\tif ( !~attr.indexOf( value[i] ) ) attr.push( value[i] );\n  \t\ti++;\n  \t}\n\n  \t// remove now-missing classes\n  \ti = prev.length;\n  \twhile ( i-- ) {\n  \t\tif ( !~value.indexOf( prev[i] ) ) {\n  \t\t\tvar idx = attr.indexOf( prev[i] );\n  \t\t\tif ( ~idx ) attr.splice( idx, 1 );\n  \t\t}\n  \t}\n\n  \tvar className = attr.join( ' ' );\n\n  \tif ( className !== this.node.className ) {\n  \t\tthis.node.className = className;\n  \t}\n\n  \tthis.previous = value;\n  }\n\n  function updateInlineClass () {\n  \tvar name = this.name.substr( 6 );\n  \tvar attr = readClass( this.node.className );\n  \tvar value = this.getValue();\n\n  \tif ( !this.inlineClass ) this.inlineClass = name;\n\n  \tif ( value && !~attr.indexOf( name ) ) attr.push( name );\n  \telse if ( !value && ~attr.indexOf( name ) ) attr.splice( attr.indexOf( name ), 1 );\n\n  \tthis.node.className = attr.join( ' ' );\n  }\n\n  function updateBoolean () {\n  \t// with two-way binding, only update if the change wasn't initiated by the user\n  \t// otherwise the cursor will often be sent to the wrong place\n  \tif ( !this.locked ) {\n  \t\tif ( this.useProperty ) {\n  \t\t\tthis.node[ this.propertyName ] = this.getValue();\n  \t\t} else {\n  \t\t\tif ( this.getValue() ) {\n  \t\t\t\tthis.node.setAttribute( this.propertyName, '' );\n  \t\t\t} else {\n  \t\t\t\tthis.node.removeAttribute( this.propertyName );\n  \t\t\t}\n  \t\t}\n  \t}\n  }\n\n  function updateAttribute () {\n  \tthis.node.setAttribute( this.name, safeToStringValue( this.getString() ) );\n  }\n\n  function updateNamespacedAttribute () {\n  \tthis.node.setAttributeNS( this.namespace, this.name.slice( this.name.indexOf( ':' ) + 1 ), safeToStringValue( this.getString() ) );\n  }\n\n  var propertyNames = {\n  \t'accept-charset': 'acceptCharset',\n  \taccesskey: 'accessKey',\n  \tbgcolor: 'bgColor',\n  \t'class': 'className',\n  \tcodebase: 'codeBase',\n  \tcolspan: 'colSpan',\n  \tcontenteditable: 'contentEditable',\n  \tdatetime: 'dateTime',\n  \tdirname: 'dirName',\n  \t'for': 'htmlFor',\n  \t'http-equiv': 'httpEquiv',\n  \tismap: 'isMap',\n  \tmaxlength: 'maxLength',\n  \tnovalidate: 'noValidate',\n  \tpubdate: 'pubDate',\n  \treadonly: 'readOnly',\n  \trowspan: 'rowSpan',\n  \ttabindex: 'tabIndex',\n  \tusemap: 'useMap'\n  };\n\n  // https://github.com/kangax/html-minifier/issues/63#issuecomment-37763316\n  var booleanAttributes = /^(allowFullscreen|async|autofocus|autoplay|checked|compact|controls|declare|default|defaultChecked|defaultMuted|defaultSelected|defer|disabled|enabled|formNoValidate|hidden|indeterminate|inert|isMap|itemScope|loop|multiple|muted|noHref|noResize|noShade|noValidate|noWrap|open|pauseOnExit|readOnly|required|reversed|scoped|seamless|selected|sortable|translate|trueSpeed|typeMustMatch|visible)$/i;\n  var voidElementNames = /^(?:area|base|br|col|command|doctype|embed|hr|img|input|keygen|link|meta|param|source|track|wbr)$/i;\n\n  var htmlEntities = { quot: 34, amp: 38, apos: 39, lt: 60, gt: 62, nbsp: 160, iexcl: 161, cent: 162, pound: 163, curren: 164, yen: 165, brvbar: 166, sect: 167, uml: 168, copy: 169, ordf: 170, laquo: 171, not: 172, shy: 173, reg: 174, macr: 175, deg: 176, plusmn: 177, sup2: 178, sup3: 179, acute: 180, micro: 181, para: 182, middot: 183, cedil: 184, sup1: 185, ordm: 186, raquo: 187, frac14: 188, frac12: 189, frac34: 190, iquest: 191, Agrave: 192, Aacute: 193, Acirc: 194, Atilde: 195, Auml: 196, Aring: 197, AElig: 198, Ccedil: 199, Egrave: 200, Eacute: 201, Ecirc: 202, Euml: 203, Igrave: 204, Iacute: 205, Icirc: 206, Iuml: 207, ETH: 208, Ntilde: 209, Ograve: 210, Oacute: 211, Ocirc: 212, Otilde: 213, Ouml: 214, times: 215, Oslash: 216, Ugrave: 217, Uacute: 218, Ucirc: 219, Uuml: 220, Yacute: 221, THORN: 222, szlig: 223, agrave: 224, aacute: 225, acirc: 226, atilde: 227, auml: 228, aring: 229, aelig: 230, ccedil: 231, egrave: 232, eacute: 233, ecirc: 234, euml: 235, igrave: 236, iacute: 237, icirc: 238, iuml: 239, eth: 240, ntilde: 241, ograve: 242, oacute: 243, ocirc: 244, otilde: 245, ouml: 246, divide: 247, oslash: 248, ugrave: 249, uacute: 250, ucirc: 251, uuml: 252, yacute: 253, thorn: 254, yuml: 255, OElig: 338, oelig: 339, Scaron: 352, scaron: 353, Yuml: 376, fnof: 402, circ: 710, tilde: 732, Alpha: 913, Beta: 914, Gamma: 915, Delta: 916, Epsilon: 917, Zeta: 918, Eta: 919, Theta: 920, Iota: 921, Kappa: 922, Lambda: 923, Mu: 924, Nu: 925, Xi: 926, Omicron: 927, Pi: 928, Rho: 929, Sigma: 931, Tau: 932, Upsilon: 933, Phi: 934, Chi: 935, Psi: 936, Omega: 937, alpha: 945, beta: 946, gamma: 947, delta: 948, epsilon: 949, zeta: 950, eta: 951, theta: 952, iota: 953, kappa: 954, lambda: 955, mu: 956, nu: 957, xi: 958, omicron: 959, pi: 960, rho: 961, sigmaf: 962, sigma: 963, tau: 964, upsilon: 965, phi: 966, chi: 967, psi: 968, omega: 969, thetasym: 977, upsih: 978, piv: 982, ensp: 8194, emsp: 8195, thinsp: 8201, zwnj: 8204, zwj: 8205, lrm: 8206, rlm: 8207, ndash: 8211, mdash: 8212, lsquo: 8216, rsquo: 8217, sbquo: 8218, ldquo: 8220, rdquo: 8221, bdquo: 8222, dagger: 8224, Dagger: 8225, bull: 8226, hellip: 8230, permil: 8240, prime: 8242, Prime: 8243, lsaquo: 8249, rsaquo: 8250, oline: 8254, frasl: 8260, euro: 8364, image: 8465, weierp: 8472, real: 8476, trade: 8482, alefsym: 8501, larr: 8592, uarr: 8593, rarr: 8594, darr: 8595, harr: 8596, crarr: 8629, lArr: 8656, uArr: 8657, rArr: 8658, dArr: 8659, hArr: 8660, forall: 8704, part: 8706, exist: 8707, empty: 8709, nabla: 8711, isin: 8712, notin: 8713, ni: 8715, prod: 8719, sum: 8721, minus: 8722, lowast: 8727, radic: 8730, prop: 8733, infin: 8734, ang: 8736, and: 8743, or: 8744, cap: 8745, cup: 8746, 'int': 8747, there4: 8756, sim: 8764, cong: 8773, asymp: 8776, ne: 8800, equiv: 8801, le: 8804, ge: 8805, sub: 8834, sup: 8835, nsub: 8836, sube: 8838, supe: 8839, oplus: 8853, otimes: 8855, perp: 8869, sdot: 8901, lceil: 8968, rceil: 8969, lfloor: 8970, rfloor: 8971, lang: 9001, rang: 9002, loz: 9674, spades: 9824, clubs: 9827, hearts: 9829, diams: 9830\t};\n  var controlCharacters = [ 8364, 129, 8218, 402, 8222, 8230, 8224, 8225, 710, 8240, 352, 8249, 338, 141, 381, 143, 144, 8216, 8217, 8220, 8221, 8226, 8211, 8212, 732, 8482, 353, 8250, 339, 157, 382, 376 ];\n  var entityPattern = new RegExp( '&(#?(?:x[\\\\w\\\\d]+|\\\\d+|' + Object.keys( htmlEntities ).join( '|' ) + '));?', 'g' );\n  var codePointSupport = typeof String.fromCodePoint === 'function';\n  var codeToChar = codePointSupport ? String.fromCodePoint : String.fromCharCode;\n\n  function decodeCharacterReferences ( html ) {\n  \treturn html.replace( entityPattern, function ( match, entity ) {\n  \t\tvar code;\n\n  \t\t// Handle named entities\n  \t\tif ( entity[0] !== '#' ) {\n  \t\t\tcode = htmlEntities[ entity ];\n  \t\t} else if ( entity[1] === 'x' ) {\n  \t\t\tcode = parseInt( entity.substring( 2 ), 16 );\n  \t\t} else {\n  \t\t\tcode = parseInt( entity.substring( 1 ), 10 );\n  \t\t}\n\n  \t\tif ( !code ) {\n  \t\t\treturn match;\n  \t\t}\n\n  \t\treturn codeToChar( validateCode( code ) );\n  \t});\n  }\n\n  var lessThan = /</g;\n  var greaterThan = />/g;\n  var amp = /&/g;\n  var invalid = 65533;\n\n  function escapeHtml ( str ) {\n  \treturn str\n  \t\t.replace( amp, '&amp;' )\n  \t\t.replace( lessThan, '&lt;' )\n  \t\t.replace( greaterThan, '&gt;' );\n  }\n\n  // some code points are verboten. If we were inserting HTML, the browser would replace the illegal\n  // code points with alternatives in some cases - since we're bypassing that mechanism, we need\n  // to replace them ourselves\n  //\n  // Source: http://en.wikipedia.org/wiki/Character_encodings_in_HTML#Illegal_characters\n  function validateCode ( code ) {\n  \tif ( !code ) {\n  \t\treturn invalid;\n  \t}\n\n  \t// line feed becomes generic whitespace\n  \tif ( code === 10 ) {\n  \t\treturn 32;\n  \t}\n\n  \t// ASCII range. (Why someone would use HTML entities for ASCII characters I don't know, but...)\n  \tif ( code < 128 ) {\n  \t\treturn code;\n  \t}\n\n  \t// code points 128-159 are dealt with leniently by browsers, but they're incorrect. We need\n  \t// to correct the mistake or we'll end up with missing  signs and so on\n  \tif ( code <= 159 ) {\n  \t\treturn controlCharacters[ code - 128 ];\n  \t}\n\n  \t// basic multilingual plane\n  \tif ( code < 55296 ) {\n  \t\treturn code;\n  \t}\n\n  \t// UTF-16 surrogate halves\n  \tif ( code <= 57343 ) {\n  \t\treturn invalid;\n  \t}\n\n  \t// rest of the basic multilingual plane\n  \tif ( code <= 65535 ) {\n  \t\treturn code;\n  \t} else if ( !codePointSupport ) {\n  \t\treturn invalid;\n  \t}\n\n  \t// supplementary multilingual plane 0x10000 - 0x1ffff\n  \tif ( code >= 65536 && code <= 131071 ) {\n  \t\treturn code;\n  \t}\n\n  \t// supplementary ideographic plane 0x20000 - 0x2ffff\n  \tif ( code >= 131072 && code <= 196607 ) {\n  \t\treturn code;\n  \t}\n\n  \treturn invalid;\n  }\n\n  function lookupNamespace ( node, prefix ) {\n  \tvar qualified = \"xmlns:\" + prefix;\n\n  \twhile ( node ) {\n  \t\tif ( node.hasAttribute( qualified ) ) return node.getAttribute( qualified );\n  \t\tnode = node.parentNode;\n  \t}\n\n  \treturn namespaces[ prefix ];\n  }\n\n  var Attribute = (function (Item) {\n  \tfunction Attribute ( options ) {\n  \t\tItem.call( this, options );\n\n  \t\tthis.name = options.name;\n  \t\tthis.namespace = null;\n  \t\tthis.element = options.element;\n  \t\tthis.parentFragment = options.element.parentFragment; // shared\n  \t\tthis.ractive = this.parentFragment.ractive;\n\n  \t\tthis.rendered = false;\n  \t\tthis.updateDelegate = null;\n  \t\tthis.fragment = null;\n  \t\tthis.value = null;\n\n  \t\tif ( !isArray( options.template ) ) {\n  \t\t\tthis.value = options.template;\n  \t\t\tif ( this.value === 0 ) {\n  \t\t\t\tthis.value = '';\n  \t\t\t}\n  \t\t} else {\n  \t\t\tthis.fragment = new Fragment({\n  \t\t\t\towner: this,\n  \t\t\t\ttemplate: options.template\n  \t\t\t});\n  \t\t}\n\n  \t\tthis.interpolator = this.fragment &&\n  \t\t                    this.fragment.items.length === 1 &&\n  \t\t                    this.fragment.items[0].type === INTERPOLATOR &&\n  \t\t                    this.fragment.items[0];\n  \t}\n\n  \tAttribute.prototype = Object.create( Item && Item.prototype );\n  \tAttribute.prototype.constructor = Attribute;\n\n  \tAttribute.prototype.bind = function bind () {\n  \t\tif ( this.fragment ) {\n  \t\t\tthis.fragment.bind();\n  \t\t}\n  \t};\n\n  \tAttribute.prototype.bubble = function bubble () {\n  \t\tif ( !this.dirty ) {\n  \t\t\tthis.element.bubble();\n  \t\t\tthis.dirty = true;\n  \t\t}\n  \t};\n\n  \tAttribute.prototype.getString = function getString () {\n  \t\treturn this.fragment ?\n  \t\t\tthis.fragment.toString() :\n  \t\t\tthis.value != null ? '' + this.value : '';\n  \t};\n\n  \t// TODO could getValue ever be called for a static attribute,\n  \t// or can we assume that this.fragment exists?\n  \tAttribute.prototype.getValue = function getValue () {\n  \t\treturn this.fragment ? this.fragment.valueOf() : booleanAttributes.test( this.name ) ? true : this.value;\n  \t};\n\n  \tAttribute.prototype.rebind = function rebind () {\n  \t\tif (this.fragment) this.fragment.rebind();\n  \t};\n\n  \tAttribute.prototype.render = function render () {\n  \t\tvar node = this.element.node;\n  \t\tthis.node = node;\n\n  \t\t// should we use direct property access, or setAttribute?\n  \t\tif ( !node.namespaceURI || node.namespaceURI === namespaces.html ) {\n  \t\t\tthis.propertyName = propertyNames[ this.name ] || this.name;\n\n  \t\t\tif ( node[ this.propertyName ] !== undefined ) {\n  \t\t\t\tthis.useProperty = true;\n  \t\t\t}\n\n  \t\t\t// is attribute a boolean attribute or 'value'? If so we're better off doing e.g.\n  \t\t\t// node.selected = true rather than node.setAttribute( 'selected', '' )\n  \t\t\tif ( booleanAttributes.test( this.name ) || this.isTwoway ) {\n  \t\t\t\tthis.isBoolean = true;\n  \t\t\t}\n\n  \t\t\tif ( this.propertyName === 'value' ) {\n  \t\t\t\tnode._ractive.value = this.value;\n  \t\t\t}\n  \t\t}\n\n  \t\tif ( node.namespaceURI ) {\n  \t\t\tvar index = this.name.indexOf( ':' );\n  \t\t\tif ( index !== -1 ) {\n  \t\t\t\tthis.namespace = lookupNamespace( node, this.name.slice( 0, index ) );\n  \t\t\t} else {\n  \t\t\t\tthis.namespace = node.namespaceURI;\n  \t\t\t}\n  \t\t}\n\n  \t\tthis.rendered = true;\n  \t\tthis.updateDelegate = getUpdateDelegate( this );\n  \t\tthis.updateDelegate();\n  \t};\n\n  \tAttribute.prototype.toString = function toString () {\n  \t\tvar value = this.getValue();\n\n  \t\t// Special case - select and textarea values (should not be stringified)\n  \t\tif ( this.name === 'value' && ( this.element.getAttribute( 'contenteditable' ) !== undefined || ( this.element.name === 'select' || this.element.name === 'textarea' ) ) ) {\n  \t\t\treturn;\n  \t\t}\n\n  \t\t// Special case  bound radio `name` attributes\n  \t\tif ( this.name === 'name' && this.element.name === 'input' && this.interpolator && this.element.getAttribute( 'type' ) === 'radio' ) {\n  \t\t\treturn (\"name=\\\"{{\" + (this.interpolator.model.getKeypath()) + \"}}\\\"\");\n  \t\t}\n\n  \t\t// Special case - style and class attributes and directives\n  \t\tif ( this.name === 'style' || this.name === 'class' || this.styleName || this.inlineClass ) {\n  \t\t\treturn;\n  \t\t}\n\n  \t\tif ( booleanAttributes.test( this.name ) ) return value ? this.name : '';\n  \t\tif ( value == null ) return '';\n\n  \t\tvar str = safeAttributeString( this.getString() );\n  \t\treturn str ?\n  \t\t\t(\"\" + (this.name) + \"=\\\"\" + str + \"\\\"\") :\n  \t\t\tthis.name;\n  \t};\n\n  \tAttribute.prototype.unbind = function unbind () {\n  \t\tif ( this.fragment ) this.fragment.unbind();\n  \t};\n\n  \tAttribute.prototype.update = function update () {\n  \t\tif ( this.dirty ) {\n  \t\t\tthis.dirty = false;\n  \t\t\tif ( this.fragment ) this.fragment.update();\n  \t\t\tif ( this.rendered ) this.updateDelegate();\n  \t\t}\n  \t};\n\n  \treturn Attribute;\n  }(Item));\n\n  var div$1 = doc ? createElement( 'div' ) : null;\n\n  var ConditionalAttribute = (function (Item) {\n  \tfunction ConditionalAttribute ( options ) {\n  \t\tItem.call( this, options );\n\n  \t\tthis.attributes = [];\n\n  \t\tthis.owner = options.owner;\n\n  \t\tthis.fragment = new Fragment({\n  \t\t\tractive: this.ractive,\n  \t\t\towner: this,\n  \t\t\ttemplate: [ this.template ]\n  \t\t});\n\n  \t\tthis.dirty = false;\n  \t}\n\n  \tConditionalAttribute.prototype = Object.create( Item && Item.prototype );\n  \tConditionalAttribute.prototype.constructor = ConditionalAttribute;\n\n  \tConditionalAttribute.prototype.bind = function bind () {\n  \t\tthis.fragment.bind();\n  \t};\n\n  \tConditionalAttribute.prototype.bubble = function bubble () {\n  \t\tif ( !this.dirty ) {\n  \t\t\tthis.dirty = true;\n  \t\t\tthis.owner.bubble();\n  \t\t}\n  \t};\n\n  \tConditionalAttribute.prototype.rebind = function rebind () {\n  \t\tthis.fragment.rebind();\n  \t};\n\n  \tConditionalAttribute.prototype.render = function render () {\n  \t\tthis.node = this.owner.node;\n  \t\tthis.isSvg = this.node.namespaceURI === svg$1;\n\n  \t\tthis.rendered = true;\n  \t\tthis.dirty = true; // TODO this seems hacky, but necessary for tests to pass in browser AND node.js\n  \t\tthis.update();\n  \t};\n\n  \tConditionalAttribute.prototype.toString = function toString () {\n  \t\treturn this.fragment.toString();\n  \t};\n\n  \tConditionalAttribute.prototype.unbind = function unbind () {\n  \t\tthis.fragment.unbind();\n  \t};\n\n  \tConditionalAttribute.prototype.unrender = function unrender () {\n  \t\tthis.rendered = false;\n  \t};\n\n  \tConditionalAttribute.prototype.update = function update () {\n  \t\tvar this$1 = this;\n\n  \t\tvar str;\n  \t\tvar attrs;\n\n  \t\tif ( this.dirty ) {\n  \t\t\tthis.dirty = false;\n\n  \t\t\tthis.fragment.update();\n\n  \t\t\tif ( this.rendered ) {\n  \t\t\t\tstr = this.fragment.toString();\n  \t\t\t\tattrs = parseAttributes( str, this.isSvg );\n\n  \t\t\t\t// any attributes that previously existed but no longer do\n  \t\t\t\t// must be removed\n  \t\t\t\tthis.attributes.filter( function ( a ) { return notIn( attrs, a ); } ).forEach( function ( a ) {\n  \t\t\t\t\tthis$1.node.removeAttribute( a.name );\n  \t\t\t\t});\n\n  \t\t\t\tattrs.forEach( function ( a ) {\n  \t\t\t\t\tthis$1.node.setAttribute( a.name, a.value );\n  \t\t\t\t});\n\n  \t\t\t\tthis.attributes = attrs;\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \treturn ConditionalAttribute;\n  }(Item));\n\n  function parseAttributes ( str, isSvg ) {\n  \tvar tagName = isSvg ? 'svg' : 'div';\n  \treturn str\n  \t\t? (div$1.innerHTML = \"<\" + tagName + \" \" + str + \"></\" + tagName + \">\") &&\n  \t\t\ttoArray(div$1.childNodes[0].attributes)\n  \t\t: [];\n  }\n\n  function notIn ( haystack, needle ) {\n  \tvar i = haystack.length;\n\n  \twhile ( i-- ) {\n  \t\tif ( haystack[i].name === needle.name ) {\n  \t\t\treturn false;\n  \t\t}\n  \t}\n\n  \treturn true;\n  }\n\n  var missingDecorator = {\n  \tupdate: noop,\n  \tteardown: noop\n  };\n\n  var Decorator = function Decorator ( owner, template ) {\n  \tthis.owner = owner;\n  \tthis.template = template;\n\n  \tthis.parentFragment = owner.parentFragment;\n  \tthis.ractive = owner.ractive;\n\n  \tthis.dynamicName = typeof template.n === 'object';\n  \tthis.dynamicArgs = !!template.d;\n\n  \tif ( this.dynamicName ) {\n  \t\tthis.nameFragment = new Fragment({\n  \t\t\towner: this,\n  \t\t\ttemplate: template.n\n  \t\t});\n  \t} else {\n  \t\tthis.name = template.n || template;\n  \t}\n\n  \tif ( this.dynamicArgs ) {\n  \t\tthis.argsFragment = new Fragment({\n  \t\t\towner: this,\n  \t\t\ttemplate: template.d\n  \t\t});\n  \t} else {\n  \t\tthis.args = template.a || [];\n  \t}\n\n  \tthis.node = null;\n  \tthis.intermediary = null;\n  };\n\n  Decorator.prototype.bind = function bind () {\n  \tif ( this.dynamicName ) {\n  \t\tthis.nameFragment.bind();\n  \t\tthis.name = this.nameFragment.toString();\n  \t}\n\n  \tif ( this.dynamicArgs ) this.argsFragment.bind();\n  };\n\n  Decorator.prototype.bubble = function bubble () {\n  \tif ( !this.dirty ) {\n  \t\tthis.dirty = true;\n  \t\tthis.owner.bubble();\n  \t}\n  };\n\n  Decorator.prototype.rebind = function rebind () {\n  \tif ( this.dynamicName ) this.nameFragment.rebind();\n  \tif ( this.dynamicArgs ) this.argsFragment.rebind();\n  };\n\n  Decorator.prototype.render = function render () {\n  \tvar fn = findInViewHierarchy( 'decorators', this.ractive, this.name );\n\n  \tif ( !fn ) {\n  \t\twarnOnce( missingPlugin( this.name, 'decorator' ) );\n  \t\tthis.intermediary = missingDecorator;\n  \t\treturn;\n  \t}\n\n  \tthis.node = this.owner.node;\n\n  \tvar args = this.dynamicArgs ? this.argsFragment.getArgsList() : this.args;\n  \tthis.intermediary = fn.apply( this.ractive, [ this.node ].concat( args ) );\n\n  \tif ( !this.intermediary || !this.intermediary.teardown ) {\n  \t\tthrow new Error( (\"The '\" + (this.name) + \"' decorator must return an object with a teardown method\") );\n  \t}\n  };\n\n  Decorator.prototype.unbind = function unbind () {\n  \tif ( this.dynamicName ) this.nameFragment.unbind();\n  \tif ( this.dynamicArgs ) this.argsFragment.unbind();\n  };\n\n  Decorator.prototype.unrender = function unrender () {\n  \tif ( this.intermediary ) this.intermediary.teardown();\n  };\n\n  Decorator.prototype.update = function update () {\n  \tif ( !this.dirty ) return;\n\n  \tthis.dirty = false;\n\n  \tvar nameChanged = false;\n\n  \tif ( this.dynamicName && this.nameFragment.dirty ) {\n  \t\tvar name = this.nameFragment.toString();\n  \t\tnameChanged = name !== this.name;\n  \t\tthis.name = name;\n  \t}\n\n  \tif ( this.intermediary ) {\n  \t\tif ( nameChanged || !this.intermediary.update ) {\n  \t\t\tthis.unrender();\n  \t\t\tthis.render();\n  \t\t}\n  \t\telse {\n  \t\t\tif ( this.dynamicArgs ) {\n  \t\t\t\tif ( this.argsFragment.dirty ) {\n  \t\t\t\t\tvar args = this.argsFragment.getArgsList();\n  \t\t\t\t\tthis.intermediary.update.apply( this.ractive, args );\n  \t\t\t\t}\n  \t\t\t}\n  \t\t\telse {\n  \t\t\t\tthis.intermediary.update.apply( this.ractive, this.args );\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \t// need to run these for unrender/render cases\n  \t// so can't just be in conditional if above\n\n  \tif ( this.dynamicName && this.nameFragment.dirty ) {\n  \t\tthis.nameFragment.update();\n  \t}\n\n  \tif ( this.dynamicArgs && this.argsFragment.dirty ) {\n  \t\tthis.argsFragment.update();\n  \t}\n  };\n\n  var DOMEvent = function DOMEvent ( name, owner ) {\n  \tif ( name.indexOf( '*' ) !== -1 ) {\n  \t\tfatal( (\"Only component proxy-events may contain \\\"*\\\" wildcards, <\" + (owner.name) + \" on-\" + name + \"=\\\"...\\\"/> is not valid\") );\n  \t}\n\n  \tthis.name = name;\n  \tthis.owner = owner;\n  \tthis.node = null;\n  \tthis.handler = null;\n  };\n\n  DOMEvent.prototype.listen = function listen ( directive ) {\n  \tvar node = this.node = this.owner.node;\n  \tvar name = this.name;\n\n  \tif ( !( (\"on\" + name) in node ) ) {\n  \t\twarnOnce( missingPlugin( name, 'events' ) );\n  \t\t}\n\n  \t\tnode.addEventListener( name, this.handler = function( event ) {\n  \t\tdirective.fire({\n  \t\t\t\tnode: node,\n  \t\t\toriginal: event\n  \t\t\t});\n  \t\t}, false );\n  };\n\n  DOMEvent.prototype.unlisten = function unlisten () {\n  \tthis.node.removeEventListener( this.name, this.handler, false );\n  };\n\n  var CustomEvent = function CustomEvent ( eventPlugin, owner ) {\n  \tthis.eventPlugin = eventPlugin;\n  \tthis.owner = owner;\n  \tthis.handler = null;\n  };\n\n  CustomEvent.prototype.listen = function listen ( directive ) {\n  \tvar node = this.owner.node;\n\n  \tthis.handler = this.eventPlugin( node, function ( event ) {\n  \t\tif ( event === void 0 ) event = {};\n\n  \t\t\tevent.node = event.node || node;\n  \t\tdirective.fire( event );\n  \t});\n  };\n\n  CustomEvent.prototype.unlisten = function unlisten () {\n  \tthis.handler.teardown();\n  };\n\n  var prefix;\n\n  if ( !isClient ) {\n  \tprefix = null;\n  } else {\n  \tvar prefixCache = {};\n  \tvar testStyle = createElement( 'div' ).style;\n\n  \tprefix = function ( prop ) {\n  \t\tprop = camelCase( prop );\n\n  \t\tif ( !prefixCache[ prop ] ) {\n  \t\t\tif ( testStyle[ prop ] !== undefined ) {\n  \t\t\t\tprefixCache[ prop ] = prop;\n  \t\t\t}\n\n  \t\t\telse {\n  \t\t\t\t// test vendors...\n  \t\t\t\tvar capped = prop.charAt( 0 ).toUpperCase() + prop.substring( 1 );\n\n  \t\t\t\tvar i = vendors.length;\n  \t\t\t\twhile ( i-- ) {\n  \t\t\t\t\tvar vendor = vendors[i];\n  \t\t\t\t\tif ( testStyle[ vendor + capped ] !== undefined ) {\n  \t\t\t\t\t\tprefixCache[ prop ] = vendor + capped;\n  \t\t\t\t\t\tbreak;\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\treturn prefixCache[ prop ];\n  \t};\n  }\n\n  var prefix$1 = prefix;\n\n  var visible;\n  var hidden = 'hidden';\n\n  if ( doc ) {\n  \tvar prefix$2;\n\n  \tif ( hidden in doc ) {\n  \t\tprefix$2 = '';\n  \t} else {\n  \t\tvar i$1 = vendors.length;\n  \t\twhile ( i$1-- ) {\n  \t\t\tvar vendor = vendors[i$1];\n  \t\t\thidden = vendor + 'Hidden';\n\n  \t\t\tif ( hidden in doc ) {\n  \t\t\t\tprefix$2 = vendor;\n  \t\t\t\tbreak;\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \tif ( prefix$2 !== undefined ) {\n  \t\tdoc.addEventListener( prefix$2 + 'visibilitychange', onChange );\n  \t\tonChange();\n  \t} else {\n  \t\t// gah, we're in an old browser\n  \t\tif ( 'onfocusout' in doc ) {\n  \t\t\tdoc.addEventListener( 'focusout', onHide );\n  \t\t\tdoc.addEventListener( 'focusin', onShow );\n  \t\t}\n\n  \t\telse {\n  \t\t\twin.addEventListener( 'pagehide', onHide );\n  \t\t\twin.addEventListener( 'blur', onHide );\n\n  \t\t\twin.addEventListener( 'pageshow', onShow );\n  \t\t\twin.addEventListener( 'focus', onShow );\n  \t\t}\n\n  \t\tvisible = true; // until proven otherwise. Not ideal but hey\n  \t}\n  }\n\n  function onChange () {\n  \tvisible = !doc[ hidden ];\n  }\n\n  function onHide () {\n  \tvisible = false;\n  }\n\n  function onShow () {\n  \tvisible = true;\n  }\n\n  var unprefixPattern = new RegExp( '^-(?:' + vendors.join( '|' ) + ')-' );\n\n  function unprefix ( prop ) {\n  \treturn prop.replace( unprefixPattern, '' );\n  }\n\n  var vendorPattern = new RegExp( '^(?:' + vendors.join( '|' ) + ')([A-Z])' );\n\n  function hyphenate ( str ) {\n  \tif ( !str ) return ''; // edge case\n\n  \tif ( vendorPattern.test( str ) ) str = '-' + str;\n\n  \treturn str.replace( /[A-Z]/g, function ( match ) { return '-' + match.toLowerCase(); } );\n  }\n\n  var createTransitions;\n\n  if ( !isClient ) {\n  \tcreateTransitions = null;\n  } else {\n  \tvar testStyle$1 = createElement( 'div' ).style;\n  \tvar linear$1 = function ( x ) { return x; };\n\n  \tvar canUseCssTransitions = {};\n  \tvar cannotUseCssTransitions = {};\n\n  \t// determine some facts about our environment\n  \tvar TRANSITION;\n  \tvar TRANSITIONEND;\n  \tvar CSS_TRANSITIONS_ENABLED;\n  \tvar TRANSITION_DURATION;\n  \tvar TRANSITION_PROPERTY;\n  \tvar TRANSITION_TIMING_FUNCTION;\n\n  \tif ( testStyle$1.transition !== undefined ) {\n  \t\tTRANSITION = 'transition';\n  \t\tTRANSITIONEND = 'transitionend';\n  \t\tCSS_TRANSITIONS_ENABLED = true;\n  \t} else if ( testStyle$1.webkitTransition !== undefined ) {\n  \t\tTRANSITION = 'webkitTransition';\n  \t\tTRANSITIONEND = 'webkitTransitionEnd';\n  \t\tCSS_TRANSITIONS_ENABLED = true;\n  \t} else {\n  \t\tCSS_TRANSITIONS_ENABLED = false;\n  \t}\n\n  \tif ( TRANSITION ) {\n  \t\tTRANSITION_DURATION = TRANSITION + 'Duration';\n  \t\tTRANSITION_PROPERTY = TRANSITION + 'Property';\n  \t\tTRANSITION_TIMING_FUNCTION = TRANSITION + 'TimingFunction';\n  \t}\n\n  \tcreateTransitions = function ( t, to, options, changedProperties, resolve ) {\n\n  \t\t// Wait a beat (otherwise the target styles will be applied immediately)\n  \t\t// TODO use a fastdom-style mechanism?\n  \t\tsetTimeout( function () {\n  \t\t\tvar jsTransitionsComplete;\n  \t\t\tvar cssTransitionsComplete;\n\n  \t\t\tfunction checkComplete () {\n  \t\t\t\tif ( jsTransitionsComplete && cssTransitionsComplete ) {\n  \t\t\t\t\t// will changes to events and fire have an unexpected consequence here?\n  \t\t\t\t\tt.ractive.fire( t.name + ':end', t.node, t.isIntro );\n  \t\t\t\t\tresolve();\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\t// this is used to keep track of which elements can use CSS to animate\n  \t\t\t// which properties\n  \t\t\tvar hashPrefix = ( t.node.namespaceURI || '' ) + t.node.tagName;\n\n  \t\t\t// need to reset transition properties\n  \t\t\tvar style = t.node.style;\n  \t\t\tvar previous = {\n  \t\t\t\tproperty: style[ TRANSITION_PROPERTY ],\n  \t\t\t\ttiming: style[ TRANSITION_TIMING_FUNCTION ],\n  \t\t\t\tduration: style[ TRANSITION_DURATION ]\n  \t\t\t};\n\n  \t\t\tstyle[ TRANSITION_PROPERTY ] = changedProperties.map( prefix$1 ).map( hyphenate ).join( ',' );\n  \t\t\tstyle[ TRANSITION_TIMING_FUNCTION ] = hyphenate( options.easing || 'linear' );\n  \t\t\tstyle[ TRANSITION_DURATION ] = ( options.duration / 1000 ) + 's';\n\n  \t\t\tfunction transitionEndHandler ( event ) {\n  \t\t\t\tvar index = changedProperties.indexOf( camelCase( unprefix( event.propertyName ) ) );\n\n  \t\t\t\tif ( index !== -1 ) {\n  \t\t\t\t\tchangedProperties.splice( index, 1 );\n  \t\t\t\t}\n\n  \t\t\t\tif ( changedProperties.length ) {\n  \t\t\t\t\t// still transitioning...\n  \t\t\t\t\treturn;\n  \t\t\t\t}\n\n  \t\t\t\tstyle[ TRANSITION_PROPERTY ] = previous.property;\n  \t\t\t\tstyle[ TRANSITION_TIMING_FUNCTION ] = previous.duration;\n  \t\t\t\tstyle[ TRANSITION_DURATION ] = previous.timing;\n\n  \t\t\t\tt.node.removeEventListener( TRANSITIONEND, transitionEndHandler, false );\n\n  \t\t\t\tcssTransitionsComplete = true;\n  \t\t\t\tcheckComplete();\n  \t\t\t}\n\n  \t\t\tt.node.addEventListener( TRANSITIONEND, transitionEndHandler, false );\n\n  \t\t\tsetTimeout( function () {\n  \t\t\t\tvar i = changedProperties.length;\n  \t\t\t\tvar hash;\n  \t\t\t\tvar originalValue;\n  \t\t\t\tvar index;\n  \t\t\t\tvar propertiesToTransitionInJs = [];\n  \t\t\t\tvar prop;\n  \t\t\t\tvar suffix;\n  \t\t\t\tvar interpolator;\n\n  \t\t\t\twhile ( i-- ) {\n  \t\t\t\t\tprop = changedProperties[i];\n  \t\t\t\t\thash = hashPrefix + prop;\n\n  \t\t\t\t\tif ( CSS_TRANSITIONS_ENABLED && !cannotUseCssTransitions[ hash ] ) {\n  \t\t\t\t\t\tstyle[ prefix$1( prop ) ] = to[ prop ];\n\n  \t\t\t\t\t\t// If we're not sure if CSS transitions are supported for\n  \t\t\t\t\t\t// this tag/property combo, find out now\n  \t\t\t\t\t\tif ( !canUseCssTransitions[ hash ] ) {\n  \t\t\t\t\t\t\toriginalValue = t.getStyle( prop );\n\n  \t\t\t\t\t\t\t// if this property is transitionable in this browser,\n  \t\t\t\t\t\t\t// the current style will be different from the target style\n  \t\t\t\t\t\t\tcanUseCssTransitions[ hash ] = ( t.getStyle( prop ) != to[ prop ] );\n  \t\t\t\t\t\t\tcannotUseCssTransitions[ hash ] = !canUseCssTransitions[ hash ];\n\n  \t\t\t\t\t\t\t// Reset, if we're going to use timers after all\n  \t\t\t\t\t\t\tif ( cannotUseCssTransitions[ hash ] ) {\n  \t\t\t\t\t\t\t\tstyle[ prefix$1( prop ) ] = originalValue;\n  \t\t\t\t\t\t\t}\n  \t\t\t\t\t\t}\n  \t\t\t\t\t}\n\n  \t\t\t\t\tif ( !CSS_TRANSITIONS_ENABLED || cannotUseCssTransitions[ hash ] ) {\n  \t\t\t\t\t\t// we need to fall back to timer-based stuff\n  \t\t\t\t\t\tif ( originalValue === undefined ) {\n  \t\t\t\t\t\t\toriginalValue = t.getStyle( prop );\n  \t\t\t\t\t\t}\n\n  \t\t\t\t\t\t// need to remove this from changedProperties, otherwise transitionEndHandler\n  \t\t\t\t\t\t// will get confused\n  \t\t\t\t\t\tindex = changedProperties.indexOf( prop );\n  \t\t\t\t\t\tif ( index === -1 ) {\n  \t\t\t\t\t\t\twarnIfDebug( 'Something very strange happened with transitions. Please raise an issue at https://github.com/ractivejs/ractive/issues - thanks!', { node: t.node });\n  \t\t\t\t\t\t} else {\n  \t\t\t\t\t\t\tchangedProperties.splice( index, 1 );\n  \t\t\t\t\t\t}\n\n  \t\t\t\t\t\t// TODO Determine whether this property is animatable at all\n\n  \t\t\t\t\t\tsuffix = /[^\\d]*$/.exec( to[ prop ] )[0];\n  \t\t\t\t\t\tinterpolator = interpolate( parseFloat( originalValue ), parseFloat( to[ prop ] ) ) || ( function () { return to[ prop ]; } );\n\n  \t\t\t\t\t\t// ...then kick off a timer-based transition\n  \t\t\t\t\t\tpropertiesToTransitionInJs.push({\n  \t\t\t\t\t\t\tname: prefix$1( prop ),\n  \t\t\t\t\t\t\tinterpolator: interpolator,\n  \t\t\t\t\t\t\tsuffix: suffix\n  \t\t\t\t\t\t});\n  \t\t\t\t\t}\n  \t\t\t\t}\n\n  \t\t\t\t// javascript transitions\n  \t\t\t\tif ( propertiesToTransitionInJs.length ) {\n  \t\t\t\t\tvar easing;\n\n  \t\t\t\t\tif ( typeof options.easing === 'string' ) {\n  \t\t\t\t\t\teasing = t.ractive.easing[ options.easing ];\n\n  \t\t\t\t\t\tif ( !easing ) {\n  \t\t\t\t\t\t\twarnOnceIfDebug( missingPlugin( options.easing, 'easing' ) );\n  \t\t\t\t\t\t\teasing = linear$1;\n  \t\t\t\t\t\t}\n  \t\t\t\t\t} else if ( typeof options.easing === 'function' ) {\n  \t\t\t\t\t\teasing = options.easing;\n  \t\t\t\t\t} else {\n  \t\t\t\t\t\teasing = linear$1;\n  \t\t\t\t\t}\n\n  \t\t\t\t\tnew Ticker({\n  \t\t\t\t\t\tduration: options.duration,\n  \t\t\t\t\t\teasing: easing,\n  \t\t\t\t\t\tstep: function ( pos ) {\n  \t\t\t\t\t\t\tvar i = propertiesToTransitionInJs.length;\n  \t\t\t\t\t\t\twhile ( i-- ) {\n  \t\t\t\t\t\t\t\tvar prop = propertiesToTransitionInJs[i];\n  \t\t\t\t\t\t\t\tt.node.style[ prop.name ] = prop.interpolator( pos ) + prop.suffix;\n  \t\t\t\t\t\t\t}\n  \t\t\t\t\t\t},\n  \t\t\t\t\t\tcomplete: function () {\n  \t\t\t\t\t\t\tjsTransitionsComplete = true;\n  \t\t\t\t\t\t\tcheckComplete();\n  \t\t\t\t\t\t}\n  \t\t\t\t\t});\n  \t\t\t\t} else {\n  \t\t\t\t\tjsTransitionsComplete = true;\n  \t\t\t\t}\n\n  \t\t\t\tif ( !changedProperties.length ) {\n  \t\t\t\t\t// We need to cancel the transitionEndHandler, and deal with\n  \t\t\t\t\t// the fact that it will never fire\n  \t\t\t\t\tt.node.removeEventListener( TRANSITIONEND, transitionEndHandler, false );\n  \t\t\t\t\tcssTransitionsComplete = true;\n  \t\t\t\t\tcheckComplete();\n  \t\t\t\t}\n  \t\t\t}, 0 );\n  \t\t}, options.delay || 0 );\n  \t};\n  }\n\n  var createTransitions$1 = createTransitions;\n\n  function resetStyle ( node, style ) {\n  \tif ( style ) {\n  \t\tnode.setAttribute( 'style', style );\n  \t} else {\n  \t\t// Next line is necessary, to remove empty style attribute!\n  \t\t// See http://stackoverflow.com/a/7167553\n  \t\tnode.getAttribute( 'style' );\n  \t\tnode.removeAttribute( 'style' );\n  \t}\n  }\n\n  var getComputedStyle = win && ( win.getComputedStyle || legacy.getComputedStyle );\n  var resolved = Promise$1.resolve();\n\n  var Transition = function Transition ( ractive, node, name, params, eventName ) {\n  \tthis.ractive = ractive;\n  \tthis.node = node;\n  \tthis.name = name;\n  \tthis.params = params;\n\n  \t// TODO this will need to change...\n  \tthis.eventName = eventName;\n  \tthis.isIntro = eventName !== 'outro';\n\n  \tif ( typeof name === 'function' ) {\n  \t\tthis._fn = name;\n  \t}\n  \telse {\n  \t\tthis._fn = findInViewHierarchy( 'transitions', ractive, name );\n\n  \t\tif ( !this._fn ) {\n  \t\t\twarnOnceIfDebug( missingPlugin( name, 'transition' ), { ractive: ractive });\n  \t\t}\n  \t}\n  };\n\n  Transition.prototype.animateStyle = function animateStyle ( style, value, options ) {\n  \tvar this$1 = this;\n\n  \t\tif ( arguments.length === 4 ) {\n  \t\tthrow new Error( 't.animateStyle() returns a promise - use .then() instead of passing a callback' );\n  \t}\n\n  \t// Special case - page isn't visible. Don't animate anything, because\n  \t// that way you'll never get CSS transitionend events\n  \tif ( !visible ) {\n  \t\tthis.setStyle( style, value );\n  \t\treturn resolved;\n  \t}\n\n  \tvar to;\n\n  \tif ( typeof style === 'string' ) {\n  \t\tto = {};\n  \t\tto[ style ] = value;\n  \t} else {\n  \t\tto = style;\n\n  \t\t// shuffle arguments\n  \t\toptions = value;\n  \t}\n\n  \t// As of 0.3.9, transition authors should supply an `option` object with\n  \t// `duration` and `easing` properties (and optional `delay`), plus a\n  \t// callback function that gets called after the animation completes\n\n  \t// TODO remove this check in a future version\n  \tif ( !options ) {\n  \t\twarnOnceIfDebug( 'The \"%s\" transition does not supply an options object to `t.animateStyle()`. This will break in a future version of Ractive. For more info see https://github.com/RactiveJS/Ractive/issues/340', this.name );\n  \t\toptions = this;\n  \t}\n\n  \treturn new Promise$1( function ( fulfil ) {\n  \t\t// Edge case - if duration is zero, set style synchronously and complete\n  \t\tif ( !options.duration ) {\n  \t\t\tthis$1.setStyle( to );\n  \t\t\tfulfil();\n  \t\t\treturn;\n  \t\t}\n\n  \t\t// Get a list of the properties we're animating\n  \t\tvar propertyNames = Object.keys( to );\n  \t\tvar changedProperties = [];\n\n  \t\t// Store the current styles\n  \t\tvar computedStyle = getComputedStyle( this$1.node );\n\n  \t\tvar i = propertyNames.length;\n  \t\twhile ( i-- ) {\n  \t\t\tvar prop = propertyNames[i];\n  \t\t\tvar current = computedStyle[ prefix$1( prop ) ];\n\n  \t\t\tif ( current === '0px' ) current = 0;\n\n  \t\t\t// we need to know if we're actually changing anything\n  \t\t\tif ( current != to[ prop ] ) { // use != instead of !==, so we can compare strings with numbers\n  \t\t\t\tchangedProperties.push( prop );\n\n  \t\t\t\t// make the computed style explicit, so we can animate where\n  \t\t\t\t// e.g. height='auto'\n  \t\t\t\tthis$1.node.style[ prefix$1( prop ) ] = current;\n  \t\t\t}\n  \t\t}\n\n  \t\t// If we're not actually changing anything, the transitionend event\n  \t\t// will never fire! So we complete early\n  \t\tif ( !changedProperties.length ) {\n  \t\t\tfulfil();\n  \t\t\treturn;\n  \t\t}\n\n  \t\tcreateTransitions$1( this$1, to, options, changedProperties, fulfil );\n  \t});\n  };\n\n  Transition.prototype.getStyle = function getStyle ( props ) {\n  \tvar computedStyle = getComputedStyle( this.node );\n\n  \tif ( typeof props === 'string' ) {\n  \t\tvar value = computedStyle[ prefix$1( props ) ];\n  \t\treturn value === '0px' ? 0 : value;\n  \t}\n\n  \tif ( !isArray( props ) ) {\n  \t\tthrow new Error( 'Transition$getStyle must be passed a string, or an array of strings representing CSS properties' );\n  \t}\n\n  \tvar styles = {};\n\n  \tvar i = props.length;\n  \twhile ( i-- ) {\n  \t\tvar prop = props[i];\n  \t\tvar value$1 = computedStyle[ prefix$1( prop ) ];\n\n  \t\tif ( value$1 === '0px' ) value$1 = 0;\n  \t\tstyles[ prop ] = value$1;\n  \t}\n\n  \treturn styles;\n  };\n\n  Transition.prototype.processParams = function processParams ( params, defaults ) {\n  \tif ( typeof params === 'number' ) {\n  \t\tparams = { duration: params };\n  \t}\n\n  \telse if ( typeof params === 'string' ) {\n  \t\tif ( params === 'slow' ) {\n  \t\t\tparams = { duration: 600 };\n  \t\t} else if ( params === 'fast' ) {\n  \t\t\tparams = { duration: 200 };\n  \t\t} else {\n  \t\t\tparams = { duration: 400 };\n  \t\t}\n  \t} else if ( !params ) {\n  \t\tparams = {};\n  \t}\n\n  \treturn extendObj( {}, defaults, params );\n  };\n\n  Transition.prototype.setStyle = function setStyle ( style, value ) {\n  \tif ( typeof style === 'string' ) {\n  \t\tthis.node.style[ prefix$1( style ) ] = value;\n  \t}\n\n  \telse {\n  \t\tvar prop;\n  \t\tfor ( prop in style ) {\n  \t\t\tif ( style.hasOwnProperty( prop ) ) {\n  \t\t\t\tthis.node.style[ prefix$1( prop ) ] = style[ prop ];\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \treturn this;\n  };\n\n  Transition.prototype.start = function start () {\n  \tvar this$1 = this;\n\n  \t\tvar node = this.node;\n  \tvar originalStyle = node.getAttribute( 'style' );\n\n  \tvar completed;\n\n  \t// create t.complete() - we don't want this on the prototype,\n  \t// because we don't want `this` silliness when passing it as\n  \t// an argument\n  \tthis.complete = function ( noReset ) {\n  \t\tif ( completed ) {\n  \t\t\treturn;\n  \t\t}\n\n  \t\tif ( !noReset && this$1.eventName === 'intro' ) {\n  \t\t\tresetStyle( node, originalStyle);\n  \t\t}\n\n  \t\tthis$1._manager.remove( this$1 );\n\n  \t\tcompleted = true;\n  \t};\n\n  \t// If the transition function doesn't exist, abort\n  \tif ( !this._fn ) {\n  \t\tthis.complete();\n  \t\treturn;\n  \t}\n\n  \tvar promise = this._fn.apply( this.ractive, [ this ].concat( this.params ) );\n  \tif ( promise ) promise.then( this.complete );\n  };\n\n  function updateLiveQueries$1 ( element ) {\n  \t// Does this need to be added to any live queries?\n  \tvar node = element.node;\n  \tvar instance = element.ractive;\n\n  \tdo {\n  \t\tvar liveQueries = instance._liveQueries;\n\n  \t\tvar i = liveQueries.length;\n  \t\twhile ( i-- ) {\n  \t\t\tvar selector = liveQueries[i];\n  \t\t\tvar query = liveQueries[ (\"_\" + selector) ];\n\n  \t\t\tif ( query.test( node ) ) {\n  \t\t\t\tquery.add( node );\n  \t\t\t\t// keep register of applicable selectors, for when we teardown\n  \t\t\t\telement.liveQueries.push( query );\n  \t\t\t}\n  \t\t}\n  \t} while ( instance = instance.parent );\n  }\n\n  // TODO element.parent currently undefined\n  function findParentForm ( element ) {\n  \twhile ( element = element.parent ) {\n  \t\tif ( element.name === 'form' ) {\n  \t\t\treturn element;\n  \t\t}\n  \t}\n  }\n\n  function warnAboutAmbiguity ( description, ractive ) {\n  \twarnOnceIfDebug( (\"The \" + description + \" being used for two-way binding is ambiguous, and may cause unexpected results. Consider initialising your data to eliminate the ambiguity\"), { ractive: ractive });\n  }\n\n  var Binding = function Binding ( element, name ) {\n  \tif ( name === void 0 ) name = 'value';\n\n  \t\tthis.element = element;\n  \tthis.ractive = element.ractive;\n  \tthis.attribute = element.attributeByName[ name ];\n\n  \tvar interpolator = this.attribute.interpolator;\n  \tinterpolator.twowayBinding = this;\n\n  \tvar model = interpolator.model;\n\n  \t// not bound?\n  \tif ( !model ) {\n  \t\t// try to force resolution\n  \t\tinterpolator.resolver.forceResolution();\n  \t\tmodel = interpolator.model;\n\n  \t\twarnAboutAmbiguity( (\"'\" + (interpolator.template.r) + \"' reference\"), this.ractive );\n  \t}\n\n  \telse if ( model.isUnresolved ) {\n  \t\t// reference expressions (e.g. foo[bar])\n  \t\tmodel.forceResolution();\n  \t\twarnAboutAmbiguity( 'expression', this.ractive );\n  \t}\n\n  \t// TODO include index/key/keypath refs as read-only\n  \telse if ( model.isReadonly ) {\n  \t\tvar keypath = model.getKeypath().replace( /^@/, '' );\n  \t\t\twarnOnceIfDebug( (\"Cannot use two-way binding on <\" + (element.name) + \"> element: \" + keypath + \" is read-only. To suppress this warning use <\" + (element.name) + \" twoway='false'...>\"), { ractive: this.ractive });\n  \t\treturn false;\n  \t}\n\n  \tthis.attribute.isTwoway = true;\n  \tthis.model = model;\n\n  \t// initialise value, if it's undefined\n  \tvar value = model.get();\n  \tthis.wasUndefined = value === undefined;\n\n  \tif ( value === undefined && this.getInitialValue ) {\n  \t\tvalue = this.getInitialValue();\n  \t\tmodel.set( value );\n  \t}\n\n  \tvar parentForm = findParentForm( element );\n  \tif ( parentForm ) {\n  \t\tthis.resetValue = value;\n  \t\tparentForm.formBindings.push( this );\n  \t}\n  };\n\n  Binding.prototype.bind = function bind () {\n  \tthis.model.registerTwowayBinding( this );\n  };\n\n  Binding.prototype.handleChange = function handleChange () {\n  \tvar this$1 = this;\n\n  \t\trunloop.start( this.root );\n  \tthis.attribute.locked = true;\n  \tthis.model.set( this.getValue() );\n  \trunloop.scheduleTask( function () { return this$1.attribute.locked = false; } );\n  \trunloop.end();\n  };\n\n  Binding.prototype.rebind = function rebind () {\n  \t// TODO what does this work with CheckboxNameBinding et al?\n  \tthis.unbind();\n  \tthis.model = this.attribute.interpolator.model;\n  \tthis.bind();\n  };\n\n  Binding.prototype.render = function render () {\n  \tthis.node = this.element.node;\n  \tthis.node._ractive.binding = this;\n  \tthis.rendered = true; // TODO is this used anywhere?\n  \t};\n\n  Binding.prototype.setFromNode = function setFromNode ( node ) {\n  \tthis.model.set( node.value );\n  \t};\n\n  \tBinding.prototype.unbind = function unbind () {\n  \tthis.model.unregisterTwowayBinding( this );\n  };\n\n  Binding.prototype.unrender = function unrender () {\n  \t// noop?\n  };\n\n  // This is the handler for DOM events that would lead to a change in the model\n  // (i.e. change, sometimes, input, and occasionally click and keyup)\n  function handleDomEvent () {\n  \tthis._ractive.binding.handleChange();\n  }\n\n  var CheckboxBinding = (function (Binding) {\n  \tfunction CheckboxBinding ( element ) {\n  \t\tBinding.call( this, element, 'checked' );\n  \t}\n\n  \tCheckboxBinding.prototype = Object.create( Binding && Binding.prototype );\n  \tCheckboxBinding.prototype.constructor = CheckboxBinding;\n\n  \tCheckboxBinding.prototype.render = function render () {\n  \t\tBinding.prototype.render.call(this);\n\n  \t\tthis.node.addEventListener( 'change', handleDomEvent, false );\n\n  \t\tif ( this.node.attachEvent ) {\n  \t\t\tthis.node.addEventListener( 'click', handleDomEvent, false );\n  \t\t}\n  \t};\n\n  \tCheckboxBinding.prototype.unrender = function unrender () {\n  \t\tthis.node.removeEventListener( 'change', handleDomEvent, false );\n  \t\tthis.node.removeEventListener( 'click', handleDomEvent, false );\n  \t};\n\n  \tCheckboxBinding.prototype.getInitialValue = function getInitialValue () {\n  \t\treturn !!this.element.getAttribute( 'checked' );\n  \t};\n\n  \tCheckboxBinding.prototype.getValue = function getValue () {\n  \t\treturn this.node.checked;\n  \t};\n\n  \tCheckboxBinding.prototype.setFromNode = function setFromNode ( node ) {\n  \t\tthis.model.set( node.checked );\n  \t};\n\n  \treturn CheckboxBinding;\n  }(Binding));\n\n  function getBindingGroup ( group, model, getValue ) {\n  \tvar hash = \"\" + group + \"-bindingGroup\";\n  \treturn model[hash] || ( model[ hash ] = new BindingGroup( hash, model, getValue ) );\n  }\n\n  var BindingGroup = function BindingGroup ( hash, model, getValue ) {\n  \tvar this$1 = this;\n\n  \t\tthis.model = model;\n  \tthis.hash = hash;\n  \tthis.getValue = function () {\n  \t\tthis$1.value = getValue.call(this$1);\n  \t\treturn this$1.value;\n  \t};\n\n  \tthis.bindings = [];\n  };\n\n  BindingGroup.prototype.add = function add ( binding ) {\n  \tthis.bindings.push( binding );\n  };\n\n  BindingGroup.prototype.bind = function bind () {\n  \tthis.value = this.model.get();\n  \tthis.model.registerTwowayBinding( this );\n  \tthis.bound = true;\n  };\n\n  BindingGroup.prototype.remove = function remove ( binding ) {\n  \tremoveFromArray( this.bindings, binding );\n  \tif ( !this.bindings.length ) {\n  \t\tthis.unbind();\n  \t}\n  };\n\n  BindingGroup.prototype.unbind = function unbind () {\n  \tthis.model.unregisterTwowayBinding( this );\n  \tthis.bound = false;\n  \tdelete this.model[this.hash];\n  };\n\n  var push$2 = [].push;\n\n  function getValue$1() {\n  \tvar all = this.bindings.filter(function ( b ) { return b.node && b.node.checked; }).map(function ( b ) { return b.element.getAttribute( 'value' ); });\n  \tvar res = [];\n  \tall.forEach(function ( v ) { if ( !arrayContains( res, v ) ) res.push( v ); });\n  \treturn res;\n  }\n\n  var CheckboxNameBinding = (function (Binding) {\n  \tfunction CheckboxNameBinding ( element ) {\n  \t\tBinding.call( this, element, 'name' );\n\n  \t\tthis.checkboxName = true; // so that ractive.updateModel() knows what to do with this\n\n  \t\t// Each input has a reference to an array containing it and its\n  \t\t// group, as two-way binding depends on being able to ascertain\n  \t\t// the status of all inputs within the group\n  \t\tthis.group = getBindingGroup( 'checkboxes', this.model, getValue$1 );\n  \t\tthis.group.add( this );\n\n  \t\tif ( this.noInitialValue ) {\n  \t\t\tthis.group.noInitialValue = true;\n  \t\t}\n\n  \t\t// If no initial value was set, and this input is checked, we\n  \t\t// update the model\n  \t\tif ( this.group.noInitialValue && this.element.getAttribute( 'checked' ) ) {\n  \t\t\tvar existingValue = this.model.get();\n  \t\t\tvar bindingValue = this.element.getAttribute( 'value' );\n\n  \t\t\tif ( !arrayContains( existingValue, bindingValue ) ) {\n  \t\t\t\tpush$2.call( existingValue, bindingValue ); // to avoid triggering runloop with array adaptor\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \tCheckboxNameBinding.prototype = Object.create( Binding && Binding.prototype );\n  \tCheckboxNameBinding.prototype.constructor = CheckboxNameBinding;\n\n  \tCheckboxNameBinding.prototype.bind = function bind () {\n  \t\tif ( !this.group.bound ) {\n  \t\t\tthis.group.bind();\n  \t\t}\n  \t};\n\n  \tCheckboxNameBinding.prototype.changed = function changed () {\n  \t\tvar wasChecked = !!this.isChecked;\n  \t\tthis.isChecked = this.node.checked;\n  \t\treturn this.isChecked === wasChecked;\n  \t};\n\n  \tCheckboxNameBinding.prototype.getInitialValue = function getInitialValue () {\n  \t\t// This only gets called once per group (of inputs that\n  \t\t// share a name), because it only gets called if there\n  \t\t// isn't an initial value. By the same token, we can make\n  \t\t// a note of that fact that there was no initial value,\n  \t\t// and populate it using any `checked` attributes that\n  \t\t// exist (which users should avoid, but which we should\n  \t\t// support anyway to avoid breaking expectations)\n  \t\tthis.noInitialValue = true; // TODO are noInitialValue and wasUndefined the same thing?\n  \t\treturn [];\n  \t};\n\n  \tCheckboxNameBinding.prototype.getValue = function getValue$1 () {\n  \t\treturn this.group.value;\n  \t};\n\n  \tCheckboxNameBinding.prototype.handleChange = function handleChange () {\n  \t\tthis.isChecked = this.element.node.checked;\n  \t\tthis.group.value = this.model.get();\n  \t\tvar value = this.element.getAttribute( 'value' );\n  \t\tif ( this.isChecked && !arrayContains( this.group.value, value ) ) {\n  \t\t\tthis.group.value.push( value );\n  \t\t} else if ( !this.isChecked && arrayContains( this.group.value, value ) ) {\n  \t\t\tremoveFromArray( this.group.value, value );\n  \t\t}\n  \t\tBinding.prototype.handleChange.call(this);\n  \t};\n\n  \tCheckboxNameBinding.prototype.render = function render () {\n  \t\tBinding.prototype.render.call(this);\n\n  \t\tvar node = this.node;\n\n  \t\tvar existingValue = this.model.get();\n  \t\tvar bindingValue = this.element.getAttribute( 'value' );\n\n  \t\tif ( isArray( existingValue ) ) {\n  \t\t\tthis.isChecked = arrayContains( existingValue, bindingValue );\n  \t\t} else {\n  \t\t\tthis.isChecked = existingValue == bindingValue;\n  \t\t}\n\n  \t\tnode.name = '{{' + this.model.getKeypath() + '}}';\n  \t\tnode.checked = this.isChecked;\n\n  \t\tnode.addEventListener( 'change', handleDomEvent, false );\n\n  \t\t// in case of IE emergency, bind to click event as well\n  \t\tif ( node.attachEvent ) {\n  \t\t\tnode.addEventListener( 'click', handleDomEvent, false );\n  \t\t}\n  \t};\n\n  \tCheckboxNameBinding.prototype.setFromNode = function setFromNode ( node ) {\n  \t\tthis.group.bindings.forEach( function ( binding ) { return binding.wasUndefined = true; } );\n\n  \t\tif ( node.checked ) {\n  \t\t\tvar valueSoFar = this.group.getValue();\n  \t\t\tvalueSoFar.push( this.element.getAttribute( 'value' ) );\n\n  \t\t\tthis.group.model.set( valueSoFar );\n  \t\t}\n  \t};\n\n  \tCheckboxNameBinding.prototype.unbind = function unbind () {\n  \t\tthis.group.remove( this );\n  \t};\n\n  \tCheckboxNameBinding.prototype.unrender = function unrender () {\n  \t\tvar node = this.element.node;\n\n  \t\tnode.removeEventListener( 'change', handleDomEvent, false );\n  \t\tnode.removeEventListener( 'click', handleDomEvent, false );\n  \t};\n\n  \treturn CheckboxNameBinding;\n  }(Binding));\n\n  var ContentEditableBinding = (function (Binding) {\n  \tfunction ContentEditableBinding () {\n  \t\tBinding.apply(this, arguments);\n  \t}\n\n  \tContentEditableBinding.prototype = Object.create( Binding && Binding.prototype );\n  \tContentEditableBinding.prototype.constructor = ContentEditableBinding;\n\n  \tContentEditableBinding.prototype.getInitialValue = function getInitialValue () {\n  \t\treturn this.element.fragment ? this.element.fragment.toString() : '';\n  \t};\n\n  \tContentEditableBinding.prototype.getValue = function getValue () {\n  \t\treturn this.element.node.innerHTML;\n  \t};\n\n  \tContentEditableBinding.prototype.render = function render () {\n  \t\tBinding.prototype.render.call(this);\n\n  \t\tvar node = this.node;\n\n  \t\tnode.addEventListener( 'change', handleDomEvent, false );\n  \t\tnode.addEventListener( 'blur', handleDomEvent, false );\n\n  \t\tif ( !this.ractive.lazy ) {\n  \t\t\tnode.addEventListener( 'input', handleDomEvent, false );\n\n  \t\t\tif ( node.attachEvent ) {\n  \t\t\t\tnode.addEventListener( 'keyup', handleDomEvent, false );\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tContentEditableBinding.prototype.setFromNode = function setFromNode ( node ) {\n  \t\tthis.model.set( node.innerHTML );\n  \t};\n\n  \tContentEditableBinding.prototype.unrender = function unrender () {\n  \t\tvar node = this.node;\n\n  \t\tnode.removeEventListener( 'blur', handleDomEvent, false );\n  \t\tnode.removeEventListener( 'change', handleDomEvent, false );\n  \t\tnode.removeEventListener( 'input', handleDomEvent, false );\n  \t\tnode.removeEventListener( 'keyup', handleDomEvent, false );\n  \t};\n\n  \treturn ContentEditableBinding;\n  }(Binding));\n\n  function handleBlur () {\n  \thandleDomEvent.call( this );\n\n  \tvar value = this._ractive.binding.model.get();\n  \tthis.value = value == undefined ? '' : value;\n  }\n\n  function handleDelay ( delay ) {\n  \tvar timeout;\n\n  \treturn function () {\n  \t\tvar this$1 = this;\n\n  \t\tif ( timeout ) clearTimeout( timeout );\n\n  \t\ttimeout = setTimeout( function () {\n  \t\t\tvar binding = this$1._ractive.binding;\n  \t\t\tif ( binding.rendered ) handleDomEvent.call( this$1 );\n  \t\t\ttimeout = null;\n  \t\t}, delay );\n  \t};\n  }\n\n  var GenericBinding = (function (Binding) {\n  \tfunction GenericBinding () {\n  \t\tBinding.apply(this, arguments);\n  \t}\n\n  \tGenericBinding.prototype = Object.create( Binding && Binding.prototype );\n  \tGenericBinding.prototype.constructor = GenericBinding;\n\n  \tGenericBinding.prototype.getInitialValue = function getInitialValue () {\n  \t\treturn '';\n  \t};\n\n  \tGenericBinding.prototype.getValue = function getValue () {\n  \t\treturn this.node.value;\n  \t};\n\n  \tGenericBinding.prototype.render = function render () {\n  \t\tBinding.prototype.render.call(this);\n\n  \t\t// any lazy setting for this element overrides the root\n  \t\t// if the value is a number, it's a timeout\n  \t\tvar lazy = this.ractive.lazy;\n  \t\tvar timeout = false;\n\n  \t\t// TODO handle at parse time\n  \t\tif ( this.element.template.a && ( 'lazy' in this.element.template.a ) ) {\n  \t\t\tlazy = this.element.template.a.lazy;\n  \t\t\tif ( lazy === 0 ) lazy = true; // empty attribute\n  \t\t}\n\n  \t\t// TODO handle this at parse time as well?\n  \t\tif ( lazy === 'false' ) lazy = false;\n\n  \t\tif ( isNumeric( lazy ) ) {\n  \t\t\ttimeout = +lazy;\n  \t\t\tlazy = false;\n  \t\t}\n\n  \t\tthis.handler = timeout ? handleDelay( timeout ) : handleDomEvent;\n\n  \t\tvar node = this.node;\n\n  \t\tnode.addEventListener( 'change', handleDomEvent, false );\n\n  \t\tif ( !lazy ) {\n  \t\t\tnode.addEventListener( 'input', this.handler, false );\n\n  \t\t\tif ( node.attachEvent ) {\n  \t\t\t\tnode.addEventListener( 'keyup', this.handler, false );\n  \t\t\t}\n  \t\t}\n\n  \t\tnode.addEventListener( 'blur', handleBlur, false );\n  \t};\n\n  \tGenericBinding.prototype.unrender = function unrender () {\n  \t\tvar node = this.element.node;\n  \t\tthis.rendered = false;\n\n  \t\tnode.removeEventListener( 'change', handleDomEvent, false );\n  \t\tnode.removeEventListener( 'input', this.handler, false );\n  \t\tnode.removeEventListener( 'keyup', this.handler, false );\n  \t\tnode.removeEventListener( 'blur', handleBlur, false );\n  \t};\n\n  \treturn GenericBinding;\n  }(Binding));\n\n  function getSelectedOptions ( select ) {\n      return select.selectedOptions\n  \t\t? toArray( select.selectedOptions )\n  \t\t: select.options\n  \t\t\t? toArray( select.options ).filter( function ( option ) { return option.selected; } )\n  \t\t\t: [];\n  }\n\n  var MultipleSelectBinding = (function (Binding) {\n  \tfunction MultipleSelectBinding () {\n  \t\tBinding.apply(this, arguments);\n  \t}\n\n  \tMultipleSelectBinding.prototype = Object.create( Binding && Binding.prototype );\n  \tMultipleSelectBinding.prototype.constructor = MultipleSelectBinding;\n\n  \tMultipleSelectBinding.prototype.forceUpdate = function forceUpdate () {\n  \t\tvar this$1 = this;\n\n  \t\tvar value = this.getValue();\n\n  \t\tif ( value !== undefined ) {\n  \t\t\tthis.attribute.locked = true;\n  \t\t\trunloop.scheduleTask( function () { return this$1.attribute.locked = false; } );\n  \t\t\tthis.model.set( value );\n  \t\t}\n  \t};\n\n  \tMultipleSelectBinding.prototype.getInitialValue = function getInitialValue () {\n  \t\treturn this.element.options\n  \t\t\t.filter( function ( option ) { return option.getAttribute( 'selected' ); } )\n  \t\t\t.map( function ( option ) { return option.getAttribute( 'value' ); } );\n  \t};\n\n  \tMultipleSelectBinding.prototype.getValue = function getValue () {\n  \t\tvar options = this.element.node.options;\n  \t\tvar len = options.length;\n\n  \t\tvar selectedValues = [];\n\n  \t\tfor ( var i = 0; i < len; i += 1 ) {\n  \t\t\tvar option = options[i];\n\n  \t\t\tif ( option.selected ) {\n  \t\t\t\tvar optionValue = option._ractive ? option._ractive.value : option.value;\n  \t\t\t\tselectedValues.push( optionValue );\n  \t\t\t}\n  \t\t}\n\n  \t\treturn selectedValues;\n  \t};\n\n  \tMultipleSelectBinding.prototype.handleChange = function handleChange () {\n  \t\tvar attribute = this.attribute;\n  \t\tvar previousValue = attribute.getValue();\n\n  \t\tvar value = this.getValue();\n\n  \t\tif ( previousValue === undefined || !arrayContentsMatch( value, previousValue ) ) {\n  \t\t\tBinding.prototype.handleChange.call(this);\n  \t\t}\n\n  \t\treturn this;\n  \t};\n\n  \tMultipleSelectBinding.prototype.render = function render () {\n  \t\tBinding.prototype.render.call(this);\n\n  \t\tthis.node.addEventListener( 'change', handleDomEvent, false );\n\n  \t\tif ( this.model.get() === undefined ) {\n  \t\t\t// get value from DOM, if possible\n  \t\t\tthis.handleChange();\n  \t\t}\n  \t};\n\n  \tMultipleSelectBinding.prototype.setFromNode = function setFromNode ( node ) {\n  \t\tvar selectedOptions = getSelectedOptions( node );\n  \t\tvar i = selectedOptions.length;\n  \t\tvar result = new Array( i );\n\n  \t\twhile ( i-- ) {\n  \t\t\tvar option = selectedOptions[i];\n  \t\t\tresult[i] = option._ractive ? option._ractive.value : option.value;\n  \t\t}\n\n  \t\tthis.model.set( result );\n  \t};\n\n  \tMultipleSelectBinding.prototype.setValue = function setValue () {\n  \t\tthrow new Error( 'TODO not implemented yet' );\n  \t};\n\n  \tMultipleSelectBinding.prototype.unrender = function unrender () {\n  \t\tthis.node.removeEventListener( 'change', handleDomEvent, false );\n  \t};\n\n  \tMultipleSelectBinding.prototype.updateModel = function updateModel () {\n  \t\tif ( this.attribute.value === undefined || !this.attribute.value.length ) {\n  \t\t\tthis.keypath.set( this.initialValue );\n  \t\t}\n  \t};\n\n  \treturn MultipleSelectBinding;\n  }(Binding));\n\n  var NumericBinding = (function (GenericBinding) {\n  \tfunction NumericBinding () {\n  \t\tGenericBinding.apply(this, arguments);\n  \t}\n\n  \tNumericBinding.prototype = Object.create( GenericBinding && GenericBinding.prototype );\n  \tNumericBinding.prototype.constructor = NumericBinding;\n\n  \tNumericBinding.prototype.getInitialValue = function getInitialValue () {\n  \t\treturn undefined;\n  \t};\n\n  \tNumericBinding.prototype.getValue = function getValue () {\n  \t\tvar value = parseFloat( this.node.value );\n  \t\treturn isNaN( value ) ? undefined : value;\n  \t};\n\n  \tNumericBinding.prototype.setFromNode = function setFromNode( node ) {\n  \t\tvar value = parseFloat( node.value );\n  \t\tif ( !isNaN( value ) ) this.model.set( value );\n  \t};\n\n  \treturn NumericBinding;\n  }(GenericBinding));\n\n  var siblings = {};\n\n  function getSiblings ( hash ) {\n  \treturn siblings[ hash ] || ( siblings[ hash ] = [] );\n  }\n\n  var RadioBinding = (function (Binding) {\n  \tfunction RadioBinding ( element ) {\n  \t\tBinding.call( this, element, 'checked' );\n\n  \t\tthis.siblings = getSiblings( this.ractive._guid + this.element.getAttribute( 'name' ) );\n  \t\tthis.siblings.push( this );\n  \t}\n\n  \tRadioBinding.prototype = Object.create( Binding && Binding.prototype );\n  \tRadioBinding.prototype.constructor = RadioBinding;\n\n  \tRadioBinding.prototype.getValue = function getValue () {\n  \t\treturn this.node.checked;\n  \t};\n\n  \tRadioBinding.prototype.handleChange = function handleChange () {\n  \t\trunloop.start( this.root );\n\n  \t\tthis.siblings.forEach( function ( binding ) {\n  \t\t\tbinding.model.set( binding.getValue() );\n  \t\t});\n\n  \t\trunloop.end();\n  \t};\n\n  \tRadioBinding.prototype.render = function render () {\n  \t\tBinding.prototype.render.call(this);\n\n  \t\tthis.node.addEventListener( 'change', handleDomEvent, false );\n\n  \t\tif ( this.node.attachEvent ) {\n  \t\t\tthis.node.addEventListener( 'click', handleDomEvent, false );\n  \t\t}\n  \t};\n\n  \tRadioBinding.prototype.setFromNode = function setFromNode ( node ) {\n  \t\tthis.model.set( node.checked );\n  \t};\n\n  \tRadioBinding.prototype.unbind = function unbind () {\n  \t\tremoveFromArray( this.siblings, this );\n  \t};\n\n  \tRadioBinding.prototype.unrender = function unrender () {\n  \t\tthis.node.removeEventListener( 'change', handleDomEvent, false );\n  \t\tthis.node.removeEventListener( 'click', handleDomEvent, false );\n  \t};\n\n  \treturn RadioBinding;\n  }(Binding));\n\n  function getValue$2() {\n  \tvar checked = this.bindings.filter( function ( b ) { return b.node.checked; } );\n  \tif ( checked.length > 0 ) {\n  \t\treturn checked[0].element.getAttribute( 'value' );\n  \t}\n  }\n\n  var RadioNameBinding = (function (Binding) {\n  \tfunction RadioNameBinding ( element ) {\n  \t\tBinding.call( this, element, 'name' );\n\n  \t\tthis.group = getBindingGroup( 'radioname', this.model, getValue$2 );\n  \t\tthis.group.add( this );\n\n  \t\tif ( element.checked ) {\n  \t\t\tthis.group.value = this.getValue();\n  \t\t}\n  \t}\n\n  \tRadioNameBinding.prototype = Object.create( Binding && Binding.prototype );\n  \tRadioNameBinding.prototype.constructor = RadioNameBinding;\n\n  \tRadioNameBinding.prototype.bind = function bind () {\n  \t\tvar this$1 = this;\n\n  \t\tif ( !this.group.bound ) {\n  \t\t\tthis.group.bind();\n  \t\t}\n\n  \t\t// update name keypath when necessary\n  \t\tthis.nameAttributeBinding = {\n  \t\t\thandleChange: function () { return this$1.node.name = \"{{\" + (this$1.model.getKeypath()) + \"}}\"; }\n  \t\t};\n\n  \t\tthis.model.getKeypathModel().register( this.nameAttributeBinding );\n  \t};\n\n  \tRadioNameBinding.prototype.getInitialValue = function getInitialValue () {\n  \t\tif ( this.element.getAttribute( 'checked' ) ) {\n  \t\t\treturn this.element.getAttribute( 'value' );\n  \t\t}\n  \t};\n\n  \tRadioNameBinding.prototype.getValue = function getValue$1 () {\n  \t\treturn this.element.getAttribute( 'value' );\n  \t};\n\n  \tRadioNameBinding.prototype.handleChange = function handleChange () {\n  \t\t// If this <input> is the one that's checked, then the value of its\n  \t\t// `name` model gets set to its value\n  \t\tif ( this.node.checked ) {\n  \t\t\tthis.group.value = this.getValue();\n  \t\t\tBinding.prototype.handleChange.call(this);\n  \t\t}\n  \t};\n\n  \tRadioNameBinding.prototype.render = function render () {\n  \t\tBinding.prototype.render.call(this);\n\n  \t\tvar node = this.node;\n\n  \t\tnode.name = \"{{\" + (this.model.getKeypath()) + \"}}\";\n  \t\tnode.checked = this.model.get() == this.element.getAttribute( 'value' );\n\n  \t\tnode.addEventListener( 'change', handleDomEvent, false );\n\n  \t\tif ( node.attachEvent ) {\n  \t\t\tnode.addEventListener( 'click', handleDomEvent, false );\n  \t\t}\n  \t};\n\n  \tRadioNameBinding.prototype.setFromNode = function setFromNode ( node ) {\n  \t\tif ( node.checked ) {\n  \t\t\tthis.group.model.set( this.element.getAttribute( 'value' ) );\n  \t\t}\n  \t};\n\n  \tRadioNameBinding.prototype.unbind = function unbind () {\n  \t\tthis.group.remove( this );\n\n  \t\tthis.model.getKeypathModel().unregister( this.nameAttributeBinding );\n  \t};\n\n  \tRadioNameBinding.prototype.unrender = function unrender () {\n  \t\tvar node = this.node;\n\n  \t\tnode.removeEventListener( 'change', handleDomEvent, false );\n  \t\tnode.removeEventListener( 'click', handleDomEvent, false );\n  \t};\n\n  \treturn RadioNameBinding;\n  }(Binding));\n\n  var SingleSelectBinding = (function (Binding) {\n  \tfunction SingleSelectBinding () {\n  \t\tBinding.apply(this, arguments);\n  \t}\n\n  \tSingleSelectBinding.prototype = Object.create( Binding && Binding.prototype );\n  \tSingleSelectBinding.prototype.constructor = SingleSelectBinding;\n\n  \tSingleSelectBinding.prototype.forceUpdate = function forceUpdate () {\n  \t\tvar this$1 = this;\n\n  \t\tvar value = this.getValue();\n\n  \t\tif ( value !== undefined ) {\n  \t\t\tthis.attribute.locked = true;\n  \t\t\trunloop.scheduleTask( function () { return this$1.attribute.locked = false; } );\n  \t\t\tthis.model.set( value );\n  \t\t}\n  \t};\n\n  \tSingleSelectBinding.prototype.getInitialValue = function getInitialValue () {\n  \t\tif ( this.element.getAttribute( 'value' ) !== undefined ) {\n  \t\t\treturn;\n  \t\t}\n\n  \t\tvar options = this.element.options;\n  \t\tvar len = options.length;\n\n  \t\tif ( !len ) return;\n\n  \t\tvar value;\n  \t\tvar optionWasSelected;\n  \t\tvar i = len;\n\n  \t\t// take the final selected option...\n  \t\twhile ( i-- ) {\n  \t\t\tvar option = options[i];\n\n  \t\t\tif ( option.getAttribute( 'selected' ) ) {\n  \t\t\t\tif ( !option.getAttribute( 'disabled' ) ) {\n  \t\t\t\t\tvalue = option.getAttribute( 'value' );\n  \t\t\t\t}\n\n  \t\t\t\toptionWasSelected = true;\n  \t\t\t\tbreak;\n  \t\t\t}\n  \t\t}\n\n  \t\t// or the first non-disabled option, if none are selected\n  \t\tif ( !optionWasSelected ) {\n  \t\t\twhile ( ++i < len ) {\n  \t\t\t\tif ( !options[i].getAttribute( 'disabled' ) ) {\n  \t\t\t\t\tvalue = options[i].getAttribute( 'value' );\n  \t\t\t\t\tbreak;\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\t// This is an optimisation (aka hack) that allows us to forgo some\n  \t\t// other more expensive work\n  \t\t// TODO does it still work? seems at odds with new architecture\n  \t\tif ( value !== undefined ) {\n  \t\t\tthis.element.attributeByName.value.value = value;\n  \t\t}\n\n  \t\treturn value;\n  \t};\n\n  \tSingleSelectBinding.prototype.getValue = function getValue () {\n  \t\tvar options = this.node.options;\n  \t\tvar len = options.length;\n\n  \t\tvar i;\n  \t\tfor ( i = 0; i < len; i += 1 ) {\n  \t\t\tvar option = options[i];\n\n  \t\t\tif ( options[i].selected && !options[i].disabled ) {\n  \t\t\t\treturn option._ractive ? option._ractive.value : option.value;\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tSingleSelectBinding.prototype.render = function render () {\n  \t\tBinding.prototype.render.call(this);\n  \t\tthis.node.addEventListener( 'change', handleDomEvent, false );\n  \t};\n\n  \tSingleSelectBinding.prototype.setFromNode = function setFromNode ( node ) {\n  \t\tvar option = getSelectedOptions( node )[0];\n  \t\tthis.model.set( option._ractive ? option._ractive.value : option.value );\n  \t};\n\n  \t// TODO this method is an anomaly... is it necessary?\n  \tSingleSelectBinding.prototype.setValue = function setValue ( value ) {\n  \t\tthis.model.set( value );\n  \t};\n\n  \tSingleSelectBinding.prototype.unrender = function unrender () {\n  \t\tthis.node.removeEventListener( 'change', handleDomEvent, false );\n  \t};\n\n  \treturn SingleSelectBinding;\n  }(Binding));\n\n  function isBindable ( attribute ) {\n  \treturn attribute &&\n  \t       attribute.template.length === 1 &&\n  \t       attribute.template[0].t === INTERPOLATOR &&\n  \t       !attribute.template[0].s;\n  }\n\n  function selectBinding ( element ) {\n  \tvar attributes = element.attributeByName;\n\n  \t// contenteditable - bind if the contenteditable attribute is true\n  \t// or is bindable and may thus become true...\n  \tif ( element.getAttribute( 'contenteditable' ) || isBindable( attributes.contenteditable ) ) {\n  \t\t// ...and this element also has a value attribute to bind\n  \t\treturn isBindable( attributes.value ) ? ContentEditableBinding : null;\n  \t}\n\n  \t// <input>\n  \tif ( element.name === 'input' ) {\n  \t\tvar type = element.getAttribute( 'type' );\n\n  \t\tif ( type === 'radio' || type === 'checkbox' ) {\n  \t\t\tvar bindName = isBindable( attributes.name );\n  \t\t\tvar bindChecked = isBindable( attributes.checked );\n\n  \t\t\t// for radios we can either bind the name attribute, or the checked attribute - not both\n  \t\t\tif ( bindName && bindChecked ) {\n  \t\t\t\tif ( type === 'radio' ) {\n  \t\t\t\t\twarnIfDebug( 'A radio input can have two-way binding on its name attribute, or its checked attribute - not both', { ractive: element.root });\n  \t\t\t\t} else {\n  \t\t\t\t\t// A checkbox with bindings for both name and checked - see https://github.com/ractivejs/ractive/issues/1749\n  \t\t\t\t\treturn CheckboxBinding;\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\tif ( bindName ) {\n  \t\t\t\treturn type === 'radio' ? RadioNameBinding : CheckboxNameBinding;\n  \t\t\t}\n\n  \t\t\tif ( bindChecked ) {\n  \t\t\t\treturn type === 'radio' ? RadioBinding : CheckboxBinding;\n  \t\t\t}\n  \t\t}\n\n  \t\tif ( type === 'file' && isBindable( attributes.value ) ) {\n  \t\t\treturn Binding;\n  \t\t}\n\n  \t\tif ( isBindable( attributes.value ) ) {\n  \t\t\treturn ( type === 'number' || type === 'range' ) ? NumericBinding : GenericBinding;\n  \t\t}\n\n  \t\treturn null;\n  \t}\n\n  \t// <select>\n  \tif ( element.name === 'select' && isBindable( attributes.value ) ) {\n  \t\treturn element.getAttribute( 'multiple' ) ? MultipleSelectBinding : SingleSelectBinding;\n  \t}\n\n  \t// <textarea>\n  \tif ( element.name === 'textarea' && isBindable( attributes.value ) ) {\n  \t\treturn GenericBinding;\n  \t}\n  }\n\n  function makeDirty$1 ( query ) {\n  \tquery.makeDirty();\n  }\n\n  var endsWithSemi = /;\\s*$/;\n\n  var Element = (function (Item) {\n  \tfunction Element ( options ) {\n  \t\tvar this$1 = this;\n\n  \t\tItem.call( this, options );\n\n  \t\tthis.liveQueries = []; // TODO rare case. can we handle differently?\n\n  \t\tthis.name = options.template.e.toLowerCase();\n  \t\tthis.isVoid = voidElementNames.test( this.name );\n\n  \t\t// find parent element\n  \t\tvar fragment = this.parentFragment;\n  \t\twhile ( fragment ) {\n  \t\t\tif ( fragment.owner.type === ELEMENT ) {\n  \t\t\t\tthis$1.parent = fragment.owner;\n  \t\t\t\tbreak;\n  \t\t\t}\n  \t\t\tfragment = fragment.parent;\n  \t\t}\n\n  \t\tif ( this.parent && this.parent.name === 'option' ) {\n  \t\t\tthrow new Error( (\"An <option> element cannot contain other elements (encountered <\" + (this.name) + \">)\") );\n  \t\t}\n\n  \t\t// create attributes\n  \t\tthis.attributeByName = {};\n  \t\tthis.attributes = [];\n\n  \t\tif ( this.template.a ) {\n  \t\t\tObject.keys( this.template.a ).forEach( function ( name ) {\n  \t\t\t\t// TODO process this at parse time\n  \t\t\t\tif ( name === 'twoway' || name === 'lazy' ) return;\n\n  \t\t\t\tvar attribute = new Attribute({\n  \t\t\t\t\tname: name,\n  \t\t\t\t\telement: this$1,\n  \t\t\t\t\tparentFragment: this$1.parentFragment,\n  \t\t\t\t\ttemplate: this$1.template.a[ name ]\n  \t\t\t\t});\n\n  \t\t\t\tthis$1.attributeByName[ name ] = attribute;\n\n  \t\t\t\tif ( name !== 'value' && name !== 'type' ) this$1.attributes.push( attribute );\n  \t\t\t});\n\n  \t\t\tif ( this.attributeByName.type ) this.attributes.unshift( this.attributeByName.type );\n  \t\t\tif ( this.attributeByName.value ) this.attributes.push( this.attributeByName.value );\n  \t\t}\n\n  \t\t// create conditional attributes\n  \t\tthis.conditionalAttributes = ( this.template.m || [] ).map( function ( template ) {\n  \t\t\treturn new ConditionalAttribute({\n  \t\t\t\towner: this$1,\n  \t\t\t\tparentFragment: this$1.parentFragment,\n  \t\t\t\ttemplate: template\n  \t\t\t});\n  \t\t});\n\n  \t\t// create decorator\n  \t\tif ( this.template.o ) {\n  \t\t\tthis.decorator = new Decorator( this, this.template.o );\n  \t\t}\n\n  \t\t// attach event handlers\n  \t\tthis.eventHandlers = [];\n  \t\tif ( this.template.v ) {\n  \t\t\tObject.keys( this.template.v ).forEach( function ( key ) {\n  \t\t\t\tvar eventNames = key.split( '-' );\n  \t\t\t\tvar template = this$1.template.v[ key ];\n\n  \t\t\t\teventNames.forEach( function ( eventName ) {\n  \t\t\t\t\tvar fn = findInViewHierarchy( 'events', this$1.ractive, eventName );\n  \t\t\t\t\t// we need to pass in \"this\" in order to get\n  \t\t\t\t\t// access to node when it is created.\n  \t\t\t\t\tvar event = fn ? new CustomEvent( fn, this$1 ) : new DOMEvent( eventName, this$1 );\n  \t\t\t\t\tthis$1.eventHandlers.push( new EventDirective( this$1, event, template ) );\n  \t\t\t\t});\n  \t\t\t});\n  \t\t}\n\n  \t\t// create children\n  \t\tif ( options.template.f && !options.noContent ) {\n  \t\t\tthis.fragment = new Fragment({\n  \t\t\t\ttemplate: options.template.f,\n  \t\t\t\towner: this,\n  \t\t\t\tcssIds: null\n  \t\t\t});\n  \t\t}\n\n  \t\tthis.binding = null; // filled in later\n  \t}\n\n  \tElement.prototype = Object.create( Item && Item.prototype );\n  \tElement.prototype.constructor = Element;\n\n  \tElement.prototype.bind = function bind$1 () {\n  \t\tthis.attributes.forEach( bind );\n  \t\tthis.conditionalAttributes.forEach( bind );\n  \t\tthis.eventHandlers.forEach( bind );\n\n  \t\tif ( this.decorator ) this.decorator.bind();\n  \t\tif ( this.fragment ) this.fragment.bind();\n\n  \t\t// create two-way binding if necessary\n  \t\tif ( this.binding = this.createTwowayBinding() ) this.binding.bind();\n  \t};\n\n  \tElement.prototype.createTwowayBinding = function createTwowayBinding () {\n  \t\tvar attributes = this.template.a;\n\n  \t\tif ( !attributes ) return null;\n\n  \t\tvar shouldBind = 'twoway' in attributes ?\n  \t\t\tattributes.twoway === 0 || attributes.twoway === 'true' : // covers `twoway` and `twoway='true'`\n  \t\t\tthis.ractive.twoway;\n\n  \t\tif ( !shouldBind ) return null;\n\n  \t\tvar Binding = selectBinding( this );\n\n  \t\tif ( !Binding ) return null;\n\n  \t\tvar binding = new Binding( this );\n\n  \t\treturn binding && binding.model ?\n  \t\t\tbinding :\n  \t\t\tnull;\n  \t};\n\n  \tElement.prototype.detach = function detach () {\n  \t\tif ( this.decorator ) this.decorator.unrender();\n  \t\treturn detachNode( this.node );\n  \t};\n\n  \tElement.prototype.find = function find ( selector ) {\n  \t\tif ( matches( this.node, selector ) ) return this.node;\n  \t\tif ( this.fragment ) {\n  \t\t\treturn this.fragment.find( selector );\n  \t\t}\n  \t};\n\n  \tElement.prototype.findAll = function findAll ( selector, query ) {\n  \t\t// Add this node to the query, if applicable, and register the\n  \t\t// query on this element\n  \t\tvar matches = query.test( this.node );\n  \t\tif ( matches ) {\n  \t\t\tquery.add( this.node );\n  \t\t\tif ( query.live ) this.liveQueries.push( query );\n  \t\t}\n\n  \t\tif ( this.fragment ) {\n  \t\t\tthis.fragment.findAll( selector, query );\n  \t\t}\n  \t};\n\n  \tElement.prototype.findComponent = function findComponent ( name ) {\n  \t\tif ( this.fragment ) {\n  \t\t\treturn this.fragment.findComponent( name );\n  \t\t}\n  \t};\n\n  \tElement.prototype.findAllComponents = function findAllComponents ( name, query ) {\n  \t\tif ( this.fragment ) {\n  \t\t\tthis.fragment.findAllComponents( name, query );\n  \t\t}\n  \t};\n\n  \tElement.prototype.findNextNode = function findNextNode () {\n  \t\treturn null;\n  \t};\n\n  \tElement.prototype.firstNode = function firstNode () {\n  \t\treturn this.node;\n  \t};\n\n  \tElement.prototype.getAttribute = function getAttribute ( name ) {\n  \t\tvar attribute = this.attributeByName[ name ];\n  \t\treturn attribute ? attribute.getValue() : undefined;\n  \t};\n\n  \tElement.prototype.rebind = function rebind$1 () {\n  \t\tthis.attributes.forEach( rebind );\n  \t\tthis.conditionalAttributes.forEach( rebind );\n  \t\tthis.eventHandlers.forEach( rebind );\n  \t\tif ( this.decorator ) this.decorator.rebind();\n  \t\tif ( this.fragment ) this.fragment.rebind();\n  \t\tif ( this.binding ) this.binding.rebind();\n\n  \t\tthis.liveQueries.forEach( makeDirty$1 );\n  \t};\n\n  \tElement.prototype.render = function render$1 ( target, occupants ) {\n  \t\t// TODO determine correct namespace\n  \t\tvar this$1 = this;\n\n  \t\tthis.namespace = getNamespace( this );\n\n  \t\tvar node;\n  \t\tvar existing = false;\n\n  \t\tif ( occupants ) {\n  \t\t\tvar n;\n  \t\t\twhile ( ( n = occupants.shift() ) ) {\n  \t\t\t\tif ( n.nodeName.toUpperCase() === this$1.template.e.toUpperCase() && n.namespaceURI === this$1.namespace ) {\n  \t\t\t\t\tthis$1.node = node = n;\n  \t\t\t\t\texisting = true;\n  \t\t\t\t\tbreak;\n  \t\t\t\t} else {\n  \t\t\t\t\tdetachNode( n );\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\tif ( !node ) {\n  \t\t\tnode = createElement( this.template.e, this.namespace, this.getAttribute( 'is' ) );\n  \t\t\tthis.node = node;\n  \t\t}\n\n  \t\tdefineProperty( node, '_ractive', {\n  \t\t\tvalue: {\n  \t\t\t\tproxy: this\n  \t\t\t}\n  \t\t});\n\n  \t\t// Is this a top-level node of a component? If so, we may need to add\n  \t\t// a data-ractive-css attribute, for CSS encapsulation\n  \t\tif ( this.parentFragment.cssIds ) {\n  \t\t\tnode.setAttribute( 'data-ractive-css', this.parentFragment.cssIds.map( function ( x ) { return (\"{\" + x + \"}\"); } ).join( ' ' ) );\n  \t\t}\n\n  \t\tif ( existing && this.foundNode ) this.foundNode( node );\n\n  \t\tif ( this.fragment ) {\n  \t\t\tvar children = existing ? toArray( node.childNodes ) : undefined;\n  \t\t\tthis.fragment.render( node, children );\n\n  \t\t\t// clean up leftover children\n  \t\t\tif ( children ) {\n  \t\t\t\tchildren.forEach( detachNode );\n  \t\t\t}\n  \t\t}\n\n  \t\tif ( existing ) {\n  \t\t\t// store initial values for two-way binding\n  \t\t\tif ( this.binding && this.binding.wasUndefined ) this.binding.setFromNode( node );\n\n  \t\t\t// remove unused attributes\n  \t\t\tvar i = node.attributes.length;\n  \t\t\twhile ( i-- ) {\n  \t\t\t\tvar name = node.attributes[i].name;\n  \t\t\t\tif ( !this$1.template.a || !( name in this$1.template.a ) ) node.removeAttribute( name );\n  \t\t\t}\n  \t\t}\n\n  \t\tthis.attributes.forEach( render );\n  \t\tthis.conditionalAttributes.forEach( render );\n\n  \t\tif ( this.decorator ) runloop.scheduleTask( function () { return this$1.decorator.render(); }, true );\n  \t\tif ( this.binding ) this.binding.render();\n\n  \t\tthis.eventHandlers.forEach( render );\n\n  \t\tupdateLiveQueries$1( this );\n\n  \t\t// store so we can abort if it gets removed\n  \t\tthis._introTransition = getTransition( this, this.template.t0 || this.template.t1, 'intro' );\n\n  \t\tif ( !existing ) {\n  \t\t\ttarget.appendChild( node );\n  \t\t}\n\n  \t\tthis.rendered = true;\n  \t};\n\n  \tElement.prototype.toString = function toString () {\n  \t\tvar tagName = this.template.e;\n\n  \t\tvar attrs = this.attributes.map( stringifyAttribute ).join( '' ) +\n  \t\t            this.conditionalAttributes.map( stringifyAttribute ).join( '' );\n\n  \t\t// Special case - selected options\n  \t\tif ( this.name === 'option' && this.isSelected() ) {\n  \t\t\tattrs += ' selected';\n  \t\t}\n\n  \t\t// Special case - two-way radio name bindings\n  \t\tif ( this.name === 'input' && inputIsCheckedRadio( this ) ) {\n  \t\t\tattrs += ' checked';\n  \t\t}\n\n  \t\t// Special case style and class attributes and directives\n  \t\tvar style, cls;\n  \t\tthis.attributes.forEach( function ( attr ) {\n  \t\t\tif ( attr.name === 'class' ) {\n  \t\t\t\tcls = ( cls || '' ) + ( cls ? ' ' : '' ) + safeAttributeString( attr.getString() );\n  \t\t\t} else if ( attr.name === 'style' ) {\n  \t\t\t\tstyle = ( style || '' ) + ( style ? ' ' : '' ) + safeAttributeString( attr.getString() );\n  \t\t\t\tif ( style && !endsWithSemi.test( style ) ) style += ';';\n  \t\t\t} else if ( attr.styleName ) {\n  \t\t\t\tstyle = ( style || '' ) + ( style ? ' ' : '' ) +  \"\" + (decamelize( attr.styleName )) + \": \" + (safeAttributeString( attr.getString() )) + \";\";\n  \t\t\t} else if ( attr.inlineClass && attr.getValue() ) {\n  \t\t\t\tcls = ( cls || '' ) + ( cls ? ' ' : '' ) + attr.inlineClass;\n  \t\t\t}\n  \t\t});\n  \t\t// put classes first, then inline style\n  \t\tif ( style !== undefined ) attrs = ' style' + ( style ? (\"=\\\"\" + style + \"\\\"\") : '' ) + attrs;\n  \t\tif ( cls !== undefined ) attrs = ' class' + (cls ? (\"=\\\"\" + cls + \"\\\"\") : '') + attrs;\n\n  \t\tvar str = \"<\" + tagName + \"\" + attrs + \">\";\n\n  \t\tif ( this.isVoid ) return str;\n\n  \t\t// Special case - textarea\n  \t\tif ( this.name === 'textarea' && this.getAttribute( 'value' ) !== undefined ) {\n  \t\t\tstr += escapeHtml( this.getAttribute( 'value' ) );\n  \t\t}\n\n  \t\t// Special case - contenteditable\n  \t\telse if ( this.getAttribute( 'contenteditable' ) !== undefined ) {\n  \t\t\tstr += ( this.getAttribute( 'value' ) || '' );\n  \t\t}\n\n  \t\tif ( this.fragment ) {\n  \t\t\tstr += this.fragment.toString( !/^(?:script|style)$/i.test( this.template.e ) ); // escape text unless script/style\n  \t\t}\n\n  \t\tstr += \"</\" + tagName + \">\";\n  \t\treturn str;\n  \t};\n\n  \tElement.prototype.unbind = function unbind$1 () {\n  \t\tthis.attributes.forEach( unbind );\n  \t\tthis.conditionalAttributes.forEach( unbind );\n\n  \t\tif ( this.decorator ) this.decorator.unbind();\n  \t\tif ( this.fragment ) this.fragment.unbind();\n  \t};\n\n  \tElement.prototype.unrender = function unrender$1 ( shouldDestroy ) {\n  \t\tif ( !this.rendered ) return;\n  \t\tthis.rendered = false;\n\n  \t\t// unrendering before intro completed? complete it now\n  \t\t// TODO should be an API for aborting transitions\n  \t\tvar transition = this._introTransition;\n  \t\tif ( transition ) transition.complete();\n\n  \t\t// Detach as soon as we can\n  \t\tif ( this.name === 'option' ) {\n  \t\t\t// <option> elements detach immediately, so that\n  \t\t\t// their parent <select> element syncs correctly, and\n  \t\t\t// since option elements can't have transitions anyway\n  \t\t\tthis.detach();\n  \t\t} else if ( shouldDestroy ) {\n  \t\t\trunloop.detachWhenReady( this );\n  \t\t}\n\n  \t\tif ( this.fragment ) this.fragment.unrender();\n\n  \t\tthis.eventHandlers.forEach( unrender );\n\n  \t\tif ( this.binding ) this.binding.unrender();\n  \t\tif ( !shouldDestroy && this.decorator ) this.decorator.unrender();\n\n  \t\t// outro transition\n  \t\tgetTransition( this, this.template.t0 || this.template.t2, 'outro' );\n\n  \t\t// special case\n  \t\tvar id = this.attributeByName.id;\n  \t\tif ( id  ) {\n  \t\t\tdelete this.ractive.nodes[ id.getValue() ];\n  \t\t}\n\n  \t\tremoveFromLiveQueries( this );\n  \t\t// TODO forms are a special case\n  \t};\n\n  \tElement.prototype.update = function update$1 () {\n  \t\tif ( this.dirty ) {\n  \t\t\tthis.dirty = false;\n\n  \t\t\tthis.attributes.forEach( update );\n  \t\t\tthis.conditionalAttributes.forEach( update );\n  \t\t\tthis.eventHandlers.forEach( update );\n\n  \t\t\tif ( this.decorator ) this.decorator.update();\n  \t\t\tif ( this.fragment ) this.fragment.update();\n  \t\t}\n  \t};\n\n  \treturn Element;\n  }(Item));\n\n  function getTransition( owner, template, eventName ) {\n  \tif ( !template || !owner.ractive.transitionsEnabled ) return;\n\n  \tvar name = getTransitionName( owner, template );\n  \tif ( !name ) return;\n\n  \tvar params = getTransitionParams( owner, template );\n  \tvar transition = new Transition( owner.ractive, owner.node, name, params, eventName );\n  \trunloop.registerTransition( transition );\n  \treturn transition;\n  }\n\n  function getTransitionName ( owner, template ) {\n  \tvar name = template.n || template;\n\n  \tif ( typeof name === 'string' ) return name;\n\n  \tvar fragment = new Fragment({\n  \t\towner: owner,\n  \t\ttemplate: name\n  \t}).bind(); // TODO need a way to capture values without bind()\n\n  \tname = fragment.toString();\n  \tfragment.unbind();\n\n  \treturn name;\n  }\n\n  function getTransitionParams ( owner, template ) {\n  \tif ( template.a ) return template.a;\n  \tif ( !template.d )  return;\n\n  \t// TODO is there a way to interpret dynamic arguments without all the\n  \t// 'dependency thrashing'?\n  \tvar fragment = new Fragment({\n  \t\towner: owner,\n  \t\ttemplate: template.d\n  \t}).bind();\n\n  \tvar params = fragment.getArgsList();\n  \tfragment.unbind();\n\n  \treturn params;\n  }\n\n  function inputIsCheckedRadio ( element ) {\n  \tvar attributes = element.attributeByName;\n\n  \tvar typeAttribute  = attributes.type;\n  \tvar valueAttribute = attributes.value;\n  \tvar nameAttribute  = attributes.name;\n\n  \tif ( !typeAttribute || ( typeAttribute.value !== 'radio' ) || !valueAttribute || !nameAttribute.interpolator ) {\n  \t\treturn;\n  \t}\n\n  \tif ( valueAttribute.getValue() === nameAttribute.interpolator.model.get() ) {\n  \t\treturn true;\n  \t}\n  }\n\n  function stringifyAttribute ( attribute ) {\n  \tvar str = attribute.toString();\n  \treturn str ? ' ' + str : '';\n  }\n\n  function removeFromLiveQueries ( element ) {\n  \tvar i = element.liveQueries.length;\n  \twhile ( i-- ) {\n  \t\tvar query = element.liveQueries[i];\n  \t\tquery.remove( element.node );\n  \t}\n  }\n\n  function getNamespace ( element ) {\n  \t// Use specified namespace...\n  \tvar xmlns = element.getAttribute( 'xmlns' );\n  \tif ( xmlns ) return xmlns;\n\n  \t// ...or SVG namespace, if this is an <svg> element\n  \tif ( element.name === 'svg' ) return svg$1;\n\n  \tvar parent = element.parent;\n\n  \tif ( parent ) {\n  \t\t// ...or HTML, if the parent is a <foreignObject>\n  \t\tif ( parent.name === 'foreignobject' ) return html;\n\n  \t\t// ...or inherit from the parent node\n  \t\treturn parent.node.namespaceURI;\n  \t}\n\n  \treturn element.ractive.el.namespaceURI;\n  }\n\n  var Form = (function (Element) {\n  \tfunction Form ( options ) {\n  \t\tElement.call( this, options );\n  \t\tthis.formBindings = [];\n  \t}\n\n  \tForm.prototype = Object.create( Element && Element.prototype );\n  \tForm.prototype.constructor = Form;\n\n  \tForm.prototype.render = function render ( target, occupants ) {\n  \t\tElement.prototype.render.call( this, target, occupants );\n  \t\tthis.node.addEventListener( 'reset', handleReset, false );\n  \t};\n\n  \tForm.prototype.unrender = function unrender ( shouldDestroy ) {\n  \t\tthis.node.removeEventListener( 'reset', handleReset, false );\n  \t\tElement.prototype.unrender.call( this, shouldDestroy );\n  \t};\n\n  \treturn Form;\n  }(Element));\n\n  function handleReset () {\n  \tvar element = this._ractive.proxy;\n\n  \trunloop.start();\n  \telement.formBindings.forEach( updateModel$1 );\n  \trunloop.end();\n  }\n\n  function updateModel$1 ( binding ) {\n  \tbinding.model.set( binding.resetValue );\n  }\n\n  var Mustache = (function (Item) {\n  \tfunction Mustache ( options ) {\n  \t\tItem.call( this, options );\n\n  \t\tthis.parentFragment = options.parentFragment;\n  \t\tthis.template = options.template;\n  \t\tthis.index = options.index;\n\n  \t\tthis.isStatic = !!options.template.s;\n\n  \t\tthis.model = null;\n  \t\tthis.dirty = false;\n  \t}\n\n  \tMustache.prototype = Object.create( Item && Item.prototype );\n  \tMustache.prototype.constructor = Mustache;\n\n  \tMustache.prototype.bind = function bind () {\n  \t\t// try to find a model for this view\n  \t\tvar this$1 = this;\n\n  \t\tvar model = resolve$2( this.parentFragment, this.template );\n  \t\tvar value = model ? model.get() : undefined;\n\n  \t\tif ( this.isStatic ) {\n  \t\t\tthis.model = { get: function () { return value; } };\n  \t\t\treturn;\n  \t\t}\n\n  \t\tif ( model ) {\n  \t\t\tmodel.register( this );\n  \t\t\tthis.model = model;\n  \t\t} else {\n  \t\t\tthis.resolver = this.parentFragment.resolve( this.template.r, function ( model ) {\n  \t\t\t\tthis$1.model = model;\n  \t\t\t\tmodel.register( this$1 );\n\n  \t\t\t\tthis$1.handleChange();\n  \t\t\t\tthis$1.resolver = null;\n  \t\t\t});\n  \t\t}\n  \t};\n\n  \tMustache.prototype.handleChange = function handleChange () {\n  \t\tthis.bubble();\n  \t};\n\n  \tMustache.prototype.rebind = function rebind () {\n  \t\tif ( this.isStatic || !this.model ) return;\n\n  \t\tvar model = resolve$2( this.parentFragment, this.template );\n\n  \t\tif ( model === this.model ) return;\n\n  \t\tthis.model.unregister( this );\n\n  \t\tthis.model = model;\n\n  \t\tif ( model ) {\n  \t\t\tmodel.register( this );\n  \t\t\tthis.handleChange();\n  \t\t}\n  \t};\n\n  \tMustache.prototype.unbind = function unbind () {\n  \t\tif ( !this.isStatic ) {\n  \t\t\tthis.model && this.model.unregister( this );\n  \t\t\tthis.model = undefined;\n  \t\t\tthis.resolver && this.resolver.unbind();\n  \t\t}\n  \t};\n\n  \treturn Mustache;\n  }(Item));\n\n  var Interpolator = (function (Mustache) {\n  \tfunction Interpolator () {\n  \t\tMustache.apply(this, arguments);\n  \t}\n\n  \tInterpolator.prototype = Object.create( Mustache && Mustache.prototype );\n  \tInterpolator.prototype.constructor = Interpolator;\n\n  \tInterpolator.prototype.detach = function detach () {\n  \t\treturn detachNode( this.node );\n  \t};\n\n  \tInterpolator.prototype.firstNode = function firstNode () {\n  \t\treturn this.node;\n  \t};\n\n  \tInterpolator.prototype.getString = function getString () {\n  \t\treturn this.model ? safeToStringValue( this.model.get() ) : '';\n  \t};\n\n  \tInterpolator.prototype.render = function render ( target, occupants ) {\n  \t\tvar value = this.getString();\n\n  \t\tthis.rendered = true;\n\n  \t\tif ( occupants ) {\n  \t\t\tvar n = occupants[0];\n  \t\t\tif ( n && n.nodeType === 3 ) {\n  \t\t\t\toccupants.shift();\n  \t\t\t\tif ( n.nodeValue !== value ) {\n  \t\t\t\t\tn.nodeValue = value;\n  \t\t\t\t}\n  \t\t\t} else {\n  \t\t\t\tn = this.node = doc.createTextNode( value );\n  \t\t\t\tif ( occupants[0] ) {\n  \t\t\t\t\ttarget.insertBefore( n, occupants[0] );\n  \t\t\t\t} else {\n  \t\t\t\t\ttarget.appendChild( n );\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\tthis.node = n;\n  \t\t} else {\n  \t\t\tthis.node = doc.createTextNode( value );\n  \t\t\ttarget.appendChild( this.node );\n  \t\t}\n  \t};\n\n  \tInterpolator.prototype.toString = function toString ( escape ) {\n  \t\tvar string = this.getString();\n  \t\treturn escape ? escapeHtml( string ) : string;\n  \t};\n\n  \tInterpolator.prototype.unrender = function unrender ( shouldDestroy ) {\n  \t\tif ( shouldDestroy ) this.detach();\n  \t\tthis.rendered = false;\n  \t};\n\n  \tInterpolator.prototype.update = function update () {\n  \t\tif ( this.dirty ) {\n  \t\t\tthis.dirty = false;\n  \t\t\tif ( this.rendered ) {\n  \t\t\t\tthis.node.data = this.getString();\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tInterpolator.prototype.valueOf = function valueOf () {\n  \t\treturn this.model ? this.model.get() : undefined;\n  \t};\n\n  \treturn Interpolator;\n  }(Mustache));\n\n  var Input = (function (Element) {\n  \tfunction Input () {\n  \t\tElement.apply(this, arguments);\n  \t}\n\n  \tInput.prototype = Object.create( Element && Element.prototype );\n  \tInput.prototype.constructor = Input;\n\n  \tInput.prototype.render = function render ( target, occupants ) {\n  \t\tElement.prototype.render.call( this, target, occupants );\n  \t\tthis.node.defaultValue = this.node.value;\n  \t};\n\n  \treturn Input;\n  }(Element));\n\n  function findParentSelect ( element ) {\n  \twhile ( element ) {\n  \t\tif ( element.name === 'select' ) return element;\n  \t\telement = element.parent;\n  \t}\n  }\n\n  var Option = (function (Element) {\n  \tfunction Option ( options ) {\n  \t\tvar template = options.template;\n  \t\tif ( !template.a ) template.a = {};\n\n  \t\t// If the value attribute is missing, use the element's content,\n  \t\t// as long as it isn't disabled\n  \t\tif ( template.a.value === undefined && !( 'disabled' in template.a ) ) {\n  \t\t\ttemplate.a.value = template.f || '';\n  \t\t}\n\n  \t\tElement.call( this, options );\n\n  \t\tthis.select = findParentSelect( this.parent );\n  \t}\n\n  \tOption.prototype = Object.create( Element && Element.prototype );\n  \tOption.prototype.constructor = Option;\n\n  \tOption.prototype.bind = function bind () {\n  \t\tif ( !this.select ) {\n  \t\t\tElement.prototype.bind.call(this);\n  \t\t\treturn;\n  \t\t}\n\n  \t\t// If the select has a value, it overrides the `selected` attribute on\n  \t\t// this option - so we delete the attribute\n  \t\tvar selectedAttribute = this.attributeByName.selected;\n  \t\tif ( selectedAttribute && this.select.getAttribute( 'value' ) !== undefined ) {\n  \t\t\tvar index = this.attributes.indexOf( selectedAttribute );\n  \t\t\tthis.attributes.splice( index, 1 );\n  \t\t\tdelete this.attributeByName.selected;\n  \t\t}\n\n  \t\tElement.prototype.bind.call(this);\n  \t\tthis.select.options.push( this );\n  \t};\n\n  \tOption.prototype.isSelected = function isSelected () {\n  \t\tvar optionValue = this.getAttribute( 'value' );\n\n  \t\tif ( optionValue === undefined || !this.select ) {\n  \t\t\treturn false;\n  \t\t}\n\n  \t\tvar selectValue = this.select.getAttribute( 'value' );\n\n  \t\tif ( selectValue == optionValue ) {\n  \t\t\treturn true;\n  \t\t}\n\n  \t\tif ( this.select.getAttribute( 'multiple' ) && isArray( selectValue ) ) {\n  \t\t\tvar i = selectValue.length;\n  \t\t\twhile ( i-- ) {\n  \t\t\t\tif ( selectValue[i] == optionValue ) {\n  \t\t\t\t\treturn true;\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tOption.prototype.unbind = function unbind () {\n  \t\tElement.prototype.unbind.call(this);\n\n  \t\tif ( this.select ) {\n  \t\t\tremoveFromArray( this.select.options, this );\n  \t\t}\n  \t};\n\n  \treturn Option;\n  }(Element));\n\n  function getPartialTemplate ( ractive, name, parentFragment ) {\n  \t// If the partial in instance or view heirarchy instances, great\n  \tvar partial = getPartialFromRegistry( ractive, name, parentFragment || {} );\n  \tif ( partial ) return partial;\n\n  \t// Does it exist on the page as a script tag?\n  \tpartial = parser.fromId( name, { noThrow: true } );\n  \tif ( partial ) {\n  \t\t// parse and register to this ractive instance\n  \t\tvar parsed = parser.parseFor( partial, ractive );\n\n  \t\t// register extra partials on the ractive instance if they don't already exist\n  \t\tif ( parsed.p ) fillGaps( ractive.partials, parsed.p );\n\n  \t\t// register (and return main partial if there are others in the template)\n  \t\treturn ractive.partials[ name ] = parsed.t;\n  \t}\n  }\n\n  function getPartialFromRegistry ( ractive, name, parentFragment ) {\n  \t// if there was an instance up-hierarchy, cool\n  \tvar partial = findParentPartial( name, parentFragment.owner );\n  \tif ( partial ) return partial;\n\n  \t// find first instance in the ractive or view hierarchy that has this partial\n  \tvar instance = findInstance( 'partials', ractive, name );\n\n  \tif ( !instance ) { return; }\n\n  \tpartial = instance.partials[ name ];\n\n  \t// partial is a function?\n  \tvar fn;\n  \tif ( typeof partial === 'function' ) {\n  \t\tfn = partial.bind( instance );\n  \t\tfn.isOwner = instance.partials.hasOwnProperty(name);\n  \t\tpartial = fn.call( ractive, parser );\n  \t}\n\n  \tif ( !partial && partial !== '' ) {\n  \t\twarnIfDebug( noRegistryFunctionReturn, name, 'partial', 'partial', { ractive: ractive });\n  \t\treturn;\n  \t}\n\n  \t// If this was added manually to the registry,\n  \t// but hasn't been parsed, parse it now\n  \tif ( !parser.isParsed( partial ) ) {\n  \t\t// use the parseOptions of the ractive instance on which it was found\n  \t\tvar parsed = parser.parseFor( partial, instance );\n\n  \t\t// Partials cannot contain nested partials!\n  \t\t// TODO add a test for this\n  \t\tif ( parsed.p ) {\n  \t\t\twarnIfDebug( 'Partials ({{>%s}}) cannot contain nested inline partials', name, { ractive: ractive });\n  \t\t}\n\n  \t\t// if fn, use instance to store result, otherwise needs to go\n  \t\t// in the correct point in prototype chain on instance or constructor\n  \t\tvar target = fn ? instance : findOwner( instance, name );\n\n  \t\t// may be a template with partials, which need to be registered and main template extracted\n  \t\ttarget.partials[ name ] = partial = parsed.t;\n  \t}\n\n  \t// store for reset\n  \tif ( fn ) partial._fn = fn;\n\n  \treturn partial.v ? partial.t : partial;\n  }\n\n  function findOwner ( ractive, key ) {\n  \treturn ractive.partials.hasOwnProperty( key )\n  \t\t? ractive\n  \t\t: findConstructor( ractive.constructor, key);\n  }\n\n  function findConstructor ( constructor, key ) {\n  \tif ( !constructor ) { return; }\n  \treturn constructor.partials.hasOwnProperty( key )\n  \t\t? constructor\n  \t\t: findConstructor( constructor._Parent, key );\n  }\n\n  function findParentPartial( name, parent ) {\n  \tif ( parent ) {\n  \t\tif ( parent.template && parent.template.p && parent.template.p[name] ) {\n  \t\t\treturn parent.template.p[name];\n  \t\t} else if ( parent.parentFragment && parent.parentFragment.owner ) {\n  \t\t\treturn findParentPartial( name, parent.parentFragment.owner );\n  \t\t}\n  \t}\n  }\n\n  var Partial = (function (Mustache) {\n  \tfunction Partial () {\n  \t\tMustache.apply(this, arguments);\n  \t}\n\n  \tPartial.prototype = Object.create( Mustache && Mustache.prototype );\n  \tPartial.prototype.constructor = Partial;\n\n  \tPartial.prototype.bind = function bind () {\n  \t\t// keep track of the reference name for future resets\n  \t\tthis.refName = this.template.r;\n\n  \t\t// name matches take priority over expressions\n  \t\tvar template = this.refName ? getPartialTemplate( this.ractive, this.refName, this.parentFragment ) || null : null;\n  \t\tvar templateObj;\n\n  \t\tif ( template ) {\n  \t\t\tthis.named = true;\n  \t\t\tthis.setTemplate( this.template.r, template );\n  \t\t}\n\n  \t\tif ( !template ) {\n  \t\t\tMustache.prototype.bind.call(this);\n  \t\t\tif ( this.model && ( templateObj = this.model.get() ) && typeof templateObj === 'object' && ( typeof templateObj.template === 'string' || isArray( templateObj.t ) ) ) {\n  \t\t\t\tif ( templateObj.template ) {\n  \t\t\t\t\ttemplateObj = parsePartial( this.template.r, templateObj.template, this.ractive );\n  \t\t\t\t}\n  \t\t\t\tthis.setTemplate( this.template.r, templateObj.t );\n  \t\t\t} else if ( ( !this.model || typeof this.model.get() !== 'string' ) && this.refName ) {\n  \t\t\t\tthis.setTemplate( this.refName, template );\n  \t\t\t} else {\n  \t\t\t\tthis.setTemplate( this.model.get() );\n  \t\t\t}\n  \t\t}\n\n  \t\tthis.fragment = new Fragment({\n  \t\t\towner: this,\n  \t\t\ttemplate: this.partialTemplate\n  \t\t}).bind();\n  \t};\n\n  \tPartial.prototype.detach = function detach () {\n  \t\treturn this.fragment.detach();\n  \t};\n\n  \tPartial.prototype.find = function find ( selector ) {\n  \t\treturn this.fragment.find( selector );\n  \t};\n\n  \tPartial.prototype.findAll = function findAll ( selector, query ) {\n  \t\tthis.fragment.findAll( selector, query );\n  \t};\n\n  \tPartial.prototype.findComponent = function findComponent ( name ) {\n  \t\treturn this.fragment.findComponent( name );\n  \t};\n\n  \tPartial.prototype.findAllComponents = function findAllComponents ( name, query ) {\n  \t\tthis.fragment.findAllComponents( name, query );\n  \t};\n\n  \tPartial.prototype.firstNode = function firstNode ( skipParent ) {\n  \t\treturn this.fragment.firstNode( skipParent );\n  \t};\n\n  \tPartial.prototype.forceResetTemplate = function forceResetTemplate () {\n  \t\tthis.partialTemplate = undefined;\n\n  \t\t// on reset, check for the reference name first\n  \t\tif ( this.refName ) {\n  \t\t\tthis.partialTemplate = getPartialTemplate( this.ractive, this.refName, this.parentFragment );\n  \t\t}\n\n  \t\t// then look for the resolved name\n  \t\tif ( !this.partialTemplate ) {\n  \t\t\tthis.partialTemplate = getPartialTemplate( this.ractive, this.name, this.parentFragment );\n  \t\t}\n\n  \t\tif ( !this.partialTemplate ) {\n  \t\t\twarnOnceIfDebug( (\"Could not find template for partial '\" + (this.name) + \"'\") );\n  \t\t\tthis.partialTemplate = [];\n  \t\t}\n\n  \t\tthis.fragment.resetTemplate( this.partialTemplate );\n  \t\tthis.bubble();\n  \t};\n\n  \tPartial.prototype.rebind = function rebind () {\n  \t\tMustache.prototype.unbind.call(this);\n  \t\tMustache.prototype.bind.call(this);\n  \t\tthis.fragment.rebind();\n  \t};\n\n  \tPartial.prototype.render = function render ( target, occupants ) {\n  \t\tthis.fragment.render( target, occupants );\n  \t};\n\n  \tPartial.prototype.setTemplate = function setTemplate ( name, template ) {\n  \t\tthis.name = name;\n\n  \t\tif ( !template && template !== null ) template = getPartialTemplate( this.ractive, name, this.parentFragment );\n\n  \t\tif ( !template ) {\n  \t\t\twarnOnceIfDebug( (\"Could not find template for partial '\" + name + \"'\") );\n  \t\t}\n\n  \t\tthis.partialTemplate = template || [];\n  \t};\n\n  \tPartial.prototype.toString = function toString ( escape ) {\n  \t\treturn this.fragment.toString( escape );\n  \t};\n\n  \tPartial.prototype.unbind = function unbind () {\n  \t\tMustache.prototype.unbind.call(this);\n  \t\tthis.fragment.unbind();\n  \t};\n\n  \tPartial.prototype.unrender = function unrender ( shouldDestroy ) {\n  \t\tthis.fragment.unrender( shouldDestroy );\n  \t};\n\n  \tPartial.prototype.update = function update () {\n  \t\tvar template;\n\n  \t\tif ( this.dirty ) {\n  \t\t\tthis.dirty = false;\n\n  \t\t\tif ( !this.named ) {\n  \t\t\t\tif ( this.model ) {\n  \t\t\t\t\ttemplate = this.model.get();\n  \t\t\t\t}\n\n  \t\t\t\tif ( template && typeof template === 'string' && template !== this.name ) {\n  \t\t\t\t\tthis.setTemplate( template );\n  \t\t\t\t\tthis.fragment.resetTemplate( this.partialTemplate );\n  \t\t\t\t} else if ( template && typeof template === 'object' && ( typeof template.template === 'string' || isArray( template.t ) ) ) {\n  \t\t\t\t\tif ( template.template ) {\n  \t\t\t\t\t\ttemplate = parsePartial( this.name, template.template, this.ractive );\n  \t\t\t\t\t}\n  \t\t\t\t\tthis.setTemplate( this.name, template.t );\n  \t\t\t\t\tthis.fragment.resetTemplate( this.partialTemplate );\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\tthis.fragment.update();\n  \t\t}\n  \t};\n\n  \treturn Partial;\n  }(Mustache));\n\n  function parsePartial( name, partial, ractive ) {\n  \tvar parsed;\n\n  \ttry {\n  \t\tparsed = parser.parse( partial, parser.getParseOptions( ractive ) );\n  \t} catch (e) {\n  \t\twarnIfDebug( (\"Could not parse partial from expression '\" + name + \"'\\n\" + (e.message)) );\n  \t}\n\n  \treturn parsed || { t: [] };\n  }\n\n  var RepeatedFragment = function RepeatedFragment ( options ) {\n  \tthis.parent = options.owner.parentFragment;\n\n  \t// bit of a hack, so reference resolution works without another\n  \t// layer of indirection\n  \tthis.parentFragment = this;\n  \tthis.owner = options.owner;\n  \tthis.ractive = this.parent.ractive;\n\n  \t// encapsulated styles should be inherited until they get applied by an element\n  \tthis.cssIds = 'cssIds' in options ? options.cssIds : ( this.parent ? this.parent.cssIds : null );\n\n  \tthis.context = null;\n  \tthis.rendered = false;\n  \tthis.iterations = [];\n\n  \tthis.template = options.template;\n\n  \tthis.indexRef = options.indexRef;\n  \tthis.keyRef = options.keyRef;\n\n  \tthis.pendingNewIndices = null;\n  \tthis.previousIterations = null;\n\n  \t// track array versus object so updates of type rest\n  \tthis.isArray = false;\n  };\n\n  RepeatedFragment.prototype.bind = function bind ( context ) {\n  \tvar this$1 = this;\n\n  \t\tthis.context = context;\n  \tvar value = context.get();\n\n  \t// {{#each array}}...\n  \tif ( this.isArray = isArray( value ) ) {\n  \t\t// we can't use map, because of sparse arrays\n  \t\tthis.iterations = [];\n  \t\tfor ( var i = 0; i < value.length; i += 1 ) {\n  \t\t\tthis$1.iterations[i] = this$1.createIteration( i, i );\n  \t\t}\n  \t}\n\n  \t// {{#each object}}...\n  \telse if ( isObject( value ) ) {\n  \t\tthis.isArray = false;\n\n  \t\t// TODO this is a dreadful hack. There must be a neater way\n  \t\tif ( this.indexRef ) {\n  \t\t\tvar refs = this.indexRef.split( ',' );\n  \t\t\tthis.keyRef = refs[0];\n  \t\t\tthis.indexRef = refs[1];\n  \t\t}\n\n  \t\tthis.iterations = Object.keys( value ).map( function ( key, index ) {\n  \t\t\treturn this$1.createIteration( key, index );\n  \t\t});\n  \t}\n\n  \treturn this;\n  };\n\n  RepeatedFragment.prototype.bubble = function bubble () {\n  \tthis.owner.bubble();\n  };\n\n  RepeatedFragment.prototype.createIteration = function createIteration ( key, index ) {\n  \tvar fragment = new Fragment({\n  \t\towner: this,\n  \t\ttemplate: this.template\n  \t});\n\n  \t// TODO this is a bit hacky\n  \tfragment.key = key;\n  \tfragment.index = index;\n  \tfragment.isIteration = true;\n\n  \tvar model = this.context.joinKey( key );\n\n  \t// set up an iteration alias if there is one\n  \tif ( this.owner.template.z ) {\n  \t\tfragment.aliases = {};\n  \t\tfragment.aliases[ this.owner.template.z[0].n ] = model;\n  \t}\n\n  \treturn fragment.bind( model );\n  };\n\n  RepeatedFragment.prototype.detach = function detach () {\n  \tvar docFrag = createDocumentFragment();\n  \tthis.iterations.forEach( function ( fragment ) { return docFrag.appendChild( fragment.detach() ); } );\n  \treturn docFrag;\n  };\n\n  RepeatedFragment.prototype.find = function find ( selector ) {\n  \tvar this$1 = this;\n\n  \t\tvar len = this.iterations.length;\n  \tvar i;\n\n  \tfor ( i = 0; i < len; i += 1 ) {\n  \t\tvar found = this$1.iterations[i].find( selector );\n  \t\tif ( found ) return found;\n  \t}\n  };\n\n  RepeatedFragment.prototype.findAll = function findAll ( selector, query ) {\n  \tvar this$1 = this;\n\n  \t\tvar len = this.iterations.length;\n  \tvar i;\n\n  \tfor ( i = 0; i < len; i += 1 ) {\n  \t\tthis$1.iterations[i].findAll( selector, query );\n  \t}\n  };\n\n  RepeatedFragment.prototype.findComponent = function findComponent ( name ) {\n  \tvar this$1 = this;\n\n  \t\tvar len = this.iterations.length;\n  \tvar i;\n\n  \tfor ( i = 0; i < len; i += 1 ) {\n  \t\tvar found = this$1.iterations[i].findComponent( name );\n  \t\tif ( found ) return found;\n  \t}\n  };\n\n  RepeatedFragment.prototype.findAllComponents = function findAllComponents ( name, query ) {\n  \tvar this$1 = this;\n\n  \t\tvar len = this.iterations.length;\n  \tvar i;\n\n  \tfor ( i = 0; i < len; i += 1 ) {\n  \t\tthis$1.iterations[i].findAllComponents( name, query );\n  \t}\n  };\n\n  RepeatedFragment.prototype.findNextNode = function findNextNode ( iteration ) {\n  \tvar this$1 = this;\n\n  \t\tif ( iteration.index < this.iterations.length - 1 ) {\n  \t\tfor ( var i = iteration.index + 1; i < this$1.iterations.length; i++ ) {\n  \t\t\tvar node = this$1.iterations[ i ].firstNode( true );\n  \t\t\tif ( node ) return node;\n  \t\t}\n  \t}\n\n  \treturn this.owner.findNextNode();\n  };\n\n  RepeatedFragment.prototype.firstNode = function firstNode ( skipParent ) {\n  \treturn this.iterations[0] ? this.iterations[0].firstNode( skipParent ) : null;\n  };\n\n  RepeatedFragment.prototype.rebind = function rebind ( context ) {\n  \tvar this$1 = this;\n\n  \t\tthis.context = context;\n\n  \tthis.iterations.forEach( function ( fragment ) {\n  \t\tvar model = context.joinKey( fragment.key || fragment.index );\n  \t\tif ( this$1.owner.template.z ) {\n  \t\t\tfragment.aliases = {};\n  \t\t\tfragment.aliases[ this$1.owner.template.z[0].n ] = model;\n  \t\t}\n  \t\tfragment.rebind( model );\n  \t});\n  };\n\n  RepeatedFragment.prototype.render = function render ( target, occupants ) {\n  \t// TODO use docFrag.cloneNode...\n\n  \tif ( this.iterations ) {\n  \t\tthis.iterations.forEach( function ( fragment ) { return fragment.render( target, occupants ); } );\n  \t}\n\n  \tthis.rendered = true;\n  };\n\n  RepeatedFragment.prototype.shuffle = function shuffle ( newIndices ) {\n  \tvar this$1 = this;\n\n  \t\tif ( !this.pendingNewIndices ) this.previousIterations = this.iterations.slice();\n\n  \tif ( !this.pendingNewIndices ) this.pendingNewIndices = [];\n\n  \tthis.pendingNewIndices.push( newIndices );\n\n  \tvar iterations = [];\n\n  \tnewIndices.forEach( function ( newIndex, oldIndex ) {\n  \t\tif ( newIndex === -1 ) return;\n\n  \t\tvar fragment = this$1.iterations[ oldIndex ];\n  \t\titerations[ newIndex ] = fragment;\n\n  \t\tif ( newIndex !== oldIndex && fragment ) fragment.dirty = true;\n  \t});\n\n  \tthis.iterations = iterations;\n\n  \tthis.bubble();\n  };\n\n  RepeatedFragment.prototype.toString = function toString$1$$ ( escape ) {\n  \treturn this.iterations ?\n  \t\tthis.iterations.map( escape ? toEscapedString : toString$1 ).join( '' ) :\n  \t\t'';\n  };\n\n  RepeatedFragment.prototype.unbind = function unbind$1 () {\n  \tthis.iterations.forEach( unbind );\n  \treturn this;\n  };\n\n  RepeatedFragment.prototype.unrender = function unrender$1 ( shouldDestroy ) {\n  \tthis.iterations.forEach( shouldDestroy ? unrenderAndDestroy : unrender );\n  \tif ( this.pendingNewIndices && this.previousIterations ) {\n  \t\tthis.previousIterations.forEach( function ( fragment ) {\n  \t\t\tif ( fragment.rendered ) shouldDestroy ? unrenderAndDestroy( fragment ) : unrender( fragment );\n  \t\t});\n  \t}\n  \tthis.rendered = false;\n  };\n\n  // TODO smart update\n  RepeatedFragment.prototype.update = function update$1 () {\n  \t// skip dirty check, since this is basically just a facade\n\n  \tvar this$1 = this;\n\n  \t\tif ( this.pendingNewIndices ) {\n  \t\tthis.updatePostShuffle();\n  \t\treturn;\n  \t}\n\n  \tif ( this.updating ) return;\n  \tthis.updating = true;\n\n  \tvar value = this.context.get(),\n  \t\t\t  wasArray = this.isArray;\n\n  \tvar toRemove;\n  \tvar oldKeys;\n  \tvar reset = true;\n  \tvar i;\n\n  \tif ( this.isArray = isArray( value ) ) {\n  \t\tif ( wasArray ) {\n  \t\t\treset = false;\n  \t\t\tif ( this.iterations.length > value.length ) {\n  \t\t\t\ttoRemove = this.iterations.splice( value.length );\n  \t\t\t}\n  \t\t}\n  \t} else if ( isObject( value ) && !wasArray ) {\n  \t\treset = false;\n  \t\ttoRemove = [];\n  \t\toldKeys = {};\n  \t\ti = this.iterations.length;\n\n  \t\twhile ( i-- ) {\n  \t\t\tvar fragment$1 = this$1.iterations[i];\n  \t\t\tif ( fragment$1.key in value ) {\n  \t\t\t\toldKeys[ fragment$1.key ] = true;\n  \t\t\t} else {\n  \t\t\t\tthis$1.iterations.splice( i, 1 );\n  \t\t\t\ttoRemove.push( fragment$1 );\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \tif ( reset ) {\n  \t\ttoRemove = this.iterations;\n  \t\tthis.iterations = [];\n  \t}\n\n  \tif ( toRemove ) {\n  \t\ttoRemove.forEach( function ( fragment ) {\n  \t\t\tfragment.unbind();\n  \t\t\tfragment.unrender( true );\n  \t\t});\n  \t}\n\n  \t// update the remaining ones\n  \tthis.iterations.forEach( update );\n\n  \t// add new iterations\n  \tvar newLength = isArray( value ) ?\n  \t\tvalue.length :\n  \t\tisObject( value ) ?\n  \t\t\tObject.keys( value ).length :\n  \t\t\t0;\n\n  \tvar docFrag;\n  \tvar fragment;\n\n  \tif ( newLength > this.iterations.length ) {\n  \t\tdocFrag = this.rendered ? createDocumentFragment() : null;\n  \t\ti = this.iterations.length;\n\n  \t\tif ( isArray( value ) ) {\n  \t\t\twhile ( i < value.length ) {\n  \t\t\t\tfragment = this$1.createIteration( i, i );\n\n  \t\t\t\tthis$1.iterations.push( fragment );\n  \t\t\t\tif ( this$1.rendered ) fragment.render( docFrag );\n\n  \t\t\t\ti += 1;\n  \t\t\t}\n  \t\t}\n\n  \t\telse if ( isObject( value ) ) {\n  \t\t\t// TODO this is a dreadful hack. There must be a neater way\n  \t\t\tif ( this.indexRef && !this.keyRef ) {\n  \t\t\t\tvar refs = this.indexRef.split( ',' );\n  \t\t\t\tthis.keyRef = refs[0];\n  \t\t\t\tthis.indexRef = refs[1];\n  \t\t\t}\n\n  \t\t\tObject.keys( value ).forEach( function ( key ) {\n  \t\t\t\tif ( !oldKeys || !( key in oldKeys ) ) {\n  \t\t\t\t\tfragment = this$1.createIteration( key, i );\n\n  \t\t\t\t\tthis$1.iterations.push( fragment );\n  \t\t\t\t\tif ( this$1.rendered ) fragment.render( docFrag );\n\n  \t\t\t\t\ti += 1;\n  \t\t\t\t}\n  \t\t\t});\n  \t\t}\n\n  \t\tif ( this.rendered ) {\n  \t\t\tvar parentNode = this.parent.findParentNode();\n  \t\t\tvar anchor = this.parent.findNextNode( this.owner );\n\n  \t\t\tparentNode.insertBefore( docFrag, anchor );\n  \t\t}\n  \t}\n\n  \tthis.updating = false;\n  };\n\n  RepeatedFragment.prototype.updatePostShuffle = function updatePostShuffle () {\n  \tvar this$1 = this;\n\n  \t\tvar newIndices = this.pendingNewIndices[ 0 ];\n\n  \t// map first shuffle through\n  \tthis.pendingNewIndices.slice( 1 ).forEach( function ( indices ) {\n  \t\tnewIndices.forEach( function ( newIndex, oldIndex ) {\n  \t\t\tnewIndices[ oldIndex ] = indices[ newIndex ];\n  \t\t});\n  \t});\n\n  \t// This algorithm (for detaching incorrectly-ordered fragments from the DOM and\n  \t// storing them in a document fragment for later reinsertion) seems a bit hokey,\n  \t// but it seems to work for now\n  \tvar len = this.context.get().length;\n  \tvar i, maxIdx = 0, merged = false;\n\n  \tnewIndices.forEach( function ( newIndex, oldIndex ) {\n  \t\tvar fragment = this$1.previousIterations[ oldIndex ];\n\n  \t\t// check for merged shuffles\n  \t\tif ( !merged && newIndex !== -1 ) {\n  \t\t\tif ( newIndex < maxIdx ) merged = true;\n  \t\t\tif ( newIndex > maxIdx ) maxIdx = newIndex;\n  \t\t}\n\n\n  \t\tif ( newIndex === -1 ) {\n  \t\t\tfragment.unbind().unrender( true );\n  \t\t} else {\n  \t\t\tfragment.index = newIndex;\n  \t\t\tvar model = this$1.context.joinKey( newIndex );\n  \t\t\tif ( this$1.owner.template.z ) {\n  \t\t\t\tfragment.aliases = {};\n  \t\t\t\tfragment.aliases[ this$1.owner.template.z[0].n ] = model;\n  \t\t\t}\n  \t\t\tfragment.rebind( model );\n  \t\t}\n  \t});\n\n  \t// create new iterations\n  \tvar docFrag = this.rendered ? createDocumentFragment() : null;\n  \tvar parentNode = this.rendered ? this.parent.findParentNode() : null;\n\n  \tif ( merged ) {\n  \t\tfor ( i = 0; i < len; i += 1 ) {\n  \t\t\tvar frag = this$1.iterations[i];\n\n  \t\t\tif ( this$1.rendered ) {\n  \t\t\t\tif ( frag ) {\n  \t\t\t\t\tdocFrag.appendChild( frag.detach() );\n  \t\t\t\t} else {\n  \t\t\t\t\tthis$1.iterations[i] = this$1.createIteration( i, i );\n  \t\t\t\t\tthis$1.iterations[i].render( docFrag );\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\tif ( !this$1.rendered ) {\n  \t\t\t\tif ( !frag ) {\n  \t\t\t\t\tthis$1.iterations[i] = this$1.createIteration( i, i );\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n  \t} else {\n  \t\tfor ( i = 0; i < len; i++ ) {\n  \t\t\tvar frag$1 = this$1.iterations[i];\n\n  \t\t\tif ( this$1.rendered ) {\n  \t\t\t\tif ( frag$1 && docFrag.childNodes.length ) {\n  \t\t\t\t\tparentNode.insertBefore( docFrag, frag$1.firstNode() );\n  \t\t\t\t}\n\n  \t\t\t\tif ( !frag$1 ) {\n  \t\t\t\t\tfrag$1 = this$1.iterations[i] = this$1.createIteration( i, i );\n  \t\t\t\t\tfrag$1.render( docFrag );\n  \t\t\t\t}\n  \t\t\t} else if ( !frag$1 ) {\n  \t\t\t\tthis$1.iterations[i] = this$1.createIteration( i, i );\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \tif ( this.rendered && docFrag.childNodes.length ) {\n  \t\tparentNode.insertBefore( docFrag, this.owner.findNextNode() );\n  \t}\n\n  \tthis.iterations.forEach( update );\n\n  \tthis.pendingNewIndices = null;\n  };\n\n  function isEmpty ( value ) {\n  \treturn !value ||\n  \t       ( isArray( value ) && value.length === 0 ) ||\n  \t\t   ( isObject( value ) && Object.keys( value ).length === 0 );\n  }\n\n  function getType ( value, hasIndexRef ) {\n  \tif ( hasIndexRef || isArray( value ) ) return SECTION_EACH;\n  \tif ( isObject( value ) || typeof value === 'function' ) return SECTION_IF_WITH;\n  \tif ( value === undefined ) return null;\n  \treturn SECTION_IF;\n  }\n\n  var Section = (function (Mustache) {\n  \tfunction Section ( options ) {\n  \t\tMustache.call( this, options );\n\n  \t\tthis.sectionType = options.template.n || null;\n  \t\tthis.templateSectionType = this.sectionType;\n  \t\tthis.fragment = null;\n  \t}\n\n  \tSection.prototype = Object.create( Mustache && Mustache.prototype );\n  \tSection.prototype.constructor = Section;\n\n  \tSection.prototype.bind = function bind () {\n  \t\tMustache.prototype.bind.call(this);\n\n  \t\t// if we managed to bind, we need to create children\n  \t\tif ( this.model ) {\n  \t\t\tthis.dirty = true;\n  \t\t\tthis.update();\n  \t\t} else if (this.sectionType && this.sectionType === SECTION_UNLESS) {\n  \t\t\tthis.fragment = new Fragment({\n  \t\t\t\towner: this,\n  \t\t\t\ttemplate: this.template.f\n  \t\t\t}).bind();\n  \t\t}\n  \t};\n\n  \tSection.prototype.detach = function detach () {\n  \t\treturn this.fragment ? this.fragment.detach() : createDocumentFragment();\n  \t};\n\n  \tSection.prototype.find = function find ( selector ) {\n  \t\tif ( this.fragment ) {\n  \t\t\treturn this.fragment.find( selector );\n  \t\t}\n  \t};\n\n  \tSection.prototype.findAll = function findAll ( selector, query ) {\n  \t\tif ( this.fragment ) {\n  \t\t\tthis.fragment.findAll( selector, query );\n  \t\t}\n  \t};\n\n  \tSection.prototype.findComponent = function findComponent ( name ) {\n  \t\tif ( this.fragment ) {\n  \t\t\treturn this.fragment.findComponent( name );\n  \t\t}\n  \t};\n\n  \tSection.prototype.findAllComponents = function findAllComponents ( name, query ) {\n  \t\tif ( this.fragment ) {\n  \t\t\tthis.fragment.findAllComponents( name, query );\n  \t\t}\n  \t};\n\n  \tSection.prototype.firstNode = function firstNode ( skipParent ) {\n  \t\treturn this.fragment && this.fragment.firstNode( skipParent );\n  \t};\n\n  \tSection.prototype.rebind = function rebind () {\n  \t\tMustache.prototype.rebind.call(this);\n\n  \t\tif ( this.fragment ) {\n  \t\t\tthis.fragment.rebind( this.sectionType === SECTION_IF || this.sectionType === SECTION_UNLESS ? null : this.model );\n  \t\t}\n  \t};\n\n  \tSection.prototype.render = function render ( target, occupants ) {\n  \t\tthis.rendered = true;\n  \t\tif ( this.fragment ) this.fragment.render( target, occupants );\n  \t};\n\n  \tSection.prototype.shuffle = function shuffle ( newIndices ) {\n  \t\tif ( this.fragment && this.sectionType === SECTION_EACH ) {\n  \t\t\tthis.fragment.shuffle( newIndices );\n  \t\t}\n  \t};\n\n  \tSection.prototype.toString = function toString ( escape ) {\n  \t\treturn this.fragment ? this.fragment.toString( escape ) : '';\n  \t};\n\n  \tSection.prototype.unbind = function unbind () {\n  \t\tMustache.prototype.unbind.call(this);\n  \t\tif ( this.fragment ) this.fragment.unbind();\n  \t};\n\n  \tSection.prototype.unrender = function unrender ( shouldDestroy ) {\n  \t\tif ( this.rendered && this.fragment ) this.fragment.unrender( shouldDestroy );\n  \t\tthis.rendered = false;\n  \t};\n\n  \tSection.prototype.update = function update () {\n  \t\tif ( !this.dirty ) return;\n  \t\tif ( !this.model && this.sectionType !== SECTION_UNLESS ) return;\n\n  \t\tthis.dirty = false;\n\n  \t\tvar value = !this.model ? undefined : this.model.isRoot ? this.model.value : this.model.get();\n  \t\tvar lastType = this.sectionType;\n\n  \t\t// watch for switching section types\n  \t\tif ( this.sectionType === null || this.templateSectionType === null ) this.sectionType = getType( value, this.template.i );\n  \t\tif ( lastType && lastType !== this.sectionType && this.fragment ) {\n  \t\t\tif ( this.rendered ) {\n  \t\t\t\tthis.fragment.unbind().unrender( true );\n  \t\t\t}\n\n  \t\t\tthis.fragment = null;\n  \t\t}\n\n  \t\tvar newFragment;\n\n  \t\tif ( this.sectionType === SECTION_EACH ) {\n  \t\t\tif ( this.fragment ) {\n  \t\t\t\tthis.fragment.update();\n  \t\t\t} else {\n  \t\t\t\t// TODO can this happen?\n  \t\t\t\tnewFragment = new RepeatedFragment({\n  \t\t\t\t\towner: this,\n  \t\t\t\t\ttemplate: this.template.f,\n  \t\t\t\t\tindexRef: this.template.i\n  \t\t\t\t}).bind( this.model );\n  \t\t\t}\n  \t\t}\n\n  \t\t// WITH is now IF_WITH; WITH is only used for {{>partial context}}\n  \t\telse if ( this.sectionType === SECTION_WITH ) {\n  \t\t\tif ( this.fragment ) {\n  \t\t\t\tthis.fragment.update();\n  \t\t\t} else {\n  \t\t\t\tnewFragment = new Fragment({\n  \t\t\t\t\towner: this,\n  \t\t\t\t\ttemplate: this.template.f\n  \t\t\t\t}).bind( this.model );\n  \t\t\t}\n  \t\t}\n\n  \t\telse if ( this.sectionType === SECTION_IF_WITH ) {\n  \t\t\tif ( this.fragment ) {\n  \t\t\t\tif ( isEmpty( value ) ) {\n  \t\t\t\t\tif ( this.rendered ) {\n  \t\t\t\t\t\tthis.fragment.unbind().unrender( true );\n  \t\t\t\t\t}\n\n  \t\t\t\t\tthis.fragment = null;\n  \t\t\t\t} else {\n  \t\t\t\t\tthis.fragment.update();\n  \t\t\t\t}\n  \t\t\t} else if ( !isEmpty( value ) ) {\n  \t\t\t\tnewFragment = new Fragment({\n  \t\t\t\t\towner: this,\n  \t\t\t\t\ttemplate: this.template.f\n  \t\t\t\t}).bind( this.model );\n  \t\t\t}\n  \t\t}\n\n  \t\telse {\n  \t\t\tvar fragmentShouldExist = this.sectionType === SECTION_UNLESS ? isEmpty( value ) : !!value && !isEmpty( value );\n\n  \t\t\tif ( this.fragment ) {\n  \t\t\t\tif ( fragmentShouldExist ) {\n  \t\t\t\t\tthis.fragment.update();\n  \t\t\t\t} else {\n  \t\t\t\t\tif ( this.rendered ) {\n  \t\t\t\t\t\tthis.fragment.unbind().unrender( true );\n  \t\t\t\t\t}\n\n  \t\t\t\t\tthis.fragment = null;\n  \t\t\t\t}\n  \t\t\t} else if ( fragmentShouldExist ) {\n  \t\t\t\tnewFragment = new Fragment({\n  \t\t\t\t\towner: this,\n  \t\t\t\t\ttemplate: this.template.f\n  \t\t\t\t}).bind( null );\n  \t\t\t}\n  \t\t}\n\n  \t\tif ( newFragment ) {\n  \t\t\tif ( this.rendered ) {\n  \t\t\t\tvar parentNode = this.parentFragment.findParentNode();\n  \t\t\t\tvar anchor = this.parentFragment.findNextNode( this );\n\n  \t\t\t\tif ( anchor ) {\n  \t\t\t\t\tvar docFrag = createDocumentFragment();\n  \t\t\t\t\tnewFragment.render( docFrag );\n\n  \t\t\t\t\t// we use anchor.parentNode, not parentNode, because the sibling\n  \t\t\t\t\t// may be temporarily detached as a result of a shuffle\n  \t\t\t\t\tanchor.parentNode.insertBefore( docFrag, anchor );\n  \t\t\t\t} else {\n  \t\t\t\t\tnewFragment.render( parentNode );\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\tthis.fragment = newFragment;\n  \t\t}\n  \t};\n\n  \treturn Section;\n  }(Mustache));\n\n  function valueContains ( selectValue, optionValue ) {\n  \tvar i = selectValue.length;\n  \twhile ( i-- ) {\n  \t\tif ( selectValue[i] == optionValue ) return true;\n  \t}\n  }\n\n  var Select = (function (Element) {\n  \tfunction Select ( options ) {\n  \t\tElement.call( this, options );\n  \t\tthis.options = [];\n  \t}\n\n  \tSelect.prototype = Object.create( Element && Element.prototype );\n  \tSelect.prototype.constructor = Select;\n\n  \tSelect.prototype.foundNode = function foundNode ( node ) {\n  \t\tif ( this.binding ) {\n  \t\t\tvar selectedOptions = getSelectedOptions( node );\n\n  \t\t\tif ( selectedOptions.length > 0 ) {\n  \t\t\t\tthis.selectedOptions = selectedOptions;\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tSelect.prototype.render = function render ( target, occupants ) {\n  \t\tElement.prototype.render.call( this, target, occupants );\n  \t\tthis.sync();\n\n  \t\tvar node = this.node;\n\n  \t\tvar i = node.options.length;\n  \t\twhile ( i-- ) {\n  \t\t\tnode.options[i].defaultSelected = node.options[i].selected;\n  \t\t}\n\n  \t\tthis.rendered = true;\n  \t};\n\n  \tSelect.prototype.sync = function sync () {\n  \t\tvar this$1 = this;\n\n  \t\tvar selectNode = this.node;\n\n  \t\tif ( !selectNode ) return;\n\n  \t\tvar options = toArray( selectNode.options );\n\n  \t\tif ( this.selectedOptions ) {\n  \t\t\toptions.forEach( function ( o ) {\n  \t\t\t\tif ( this$1.selectedOptions.indexOf( o ) >= 0 ) o.selected = true;\n  \t\t\t\telse o.selected = false;\n  \t\t\t});\n  \t\t\tthis.binding.setFromNode( selectNode );\n  \t\t\tdelete this.selectedOptions;\n  \t\t\treturn;\n  \t\t}\n\n  \t\tvar selectValue = this.getAttribute( 'value' );\n  \t\tvar isMultiple = this.getAttribute( 'multiple' );\n\n  \t\t// If the <select> has a specified value, that should override\n  \t\t// these options\n  \t\tif ( selectValue !== undefined ) {\n  \t\t\tvar optionWasSelected;\n\n  \t\t\toptions.forEach( function ( o ) {\n  \t\t\t\tvar optionValue = o._ractive ? o._ractive.value : o.value;\n  \t\t\t\tvar shouldSelect = isMultiple ? valueContains( selectValue, optionValue ) : selectValue == optionValue;\n\n  \t\t\t\tif ( shouldSelect ) {\n  \t\t\t\t\toptionWasSelected = true;\n  \t\t\t\t}\n\n  \t\t\t\to.selected = shouldSelect;\n  \t\t\t});\n\n  \t\t\tif ( !optionWasSelected && !isMultiple ) {\n  \t\t\t\tif ( this.binding ) {\n  \t\t\t\t\tthis.binding.forceUpdate();\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\t// Otherwise the value should be initialised according to which\n  \t\t// <option> element is selected, if twoway binding is in effect\n  \t\telse if ( this.binding ) {\n  \t\t\tthis.binding.forceUpdate();\n  \t\t}\n  \t};\n\n  \tSelect.prototype.update = function update () {\n  \t\tElement.prototype.update.call(this);\n  \t\tthis.sync();\n  \t};\n\n  \treturn Select;\n  }(Element));\n\n  var Textarea = (function (Input) {\n  \tfunction Textarea( options ) {\n  \t\tvar template = options.template;\n\n  \t\t// if there is a bindable value, there should be no body\n  \t\tif ( template.a && template.a.value && isBindable( { template: template.a.value } ) ) {\n  \t\t\toptions.noContent = true;\n  \t\t}\n\n  \t\t// otherwise, if there is a single bindable interpolator as content, move it to the value attr\n  \t\telse if ( template.f && (!template.a || !template.a.value) && isBindable( { template: template.f } ) ) {\n  \t\t\tif ( !template.a ) template.a = {};\n  \t\t\ttemplate.a.value = template.f;\n  \t\t\toptions.noContent = true;\n  \t\t}\n\n  \t\tInput.call( this, options );\n  \t}\n\n  \tTextarea.prototype = Object.create( Input && Input.prototype );\n  \tTextarea.prototype.constructor = Textarea;\n\n  \tTextarea.prototype.bubble = function bubble () {\n  \t\tvar this$1 = this;\n\n  \t\tif ( !this.dirty ) {\n  \t\t\tthis.dirty = true;\n\n  \t\t\tif ( this.rendered && !this.binding && this.fragment ) {\n  \t\t\t\trunloop.scheduleTask( function () {\n  \t\t\t\t\tthis$1.dirty = false;\n  \t\t\t\t\tthis$1.node.value = this$1.fragment.toString();\n  \t\t\t\t});\n  \t\t\t}\n\n  \t\t\tthis.parentFragment.bubble(); // default behaviour\n  \t\t}\n  \t};\n\n  \treturn Textarea;\n  }(Input));\n\n  var Text = (function (Item) {\n  \tfunction Text ( options ) {\n  \t\tItem.call( this, options );\n  \t\tthis.type = TEXT;\n  \t}\n\n  \tText.prototype = Object.create( Item && Item.prototype );\n  \tText.prototype.constructor = Text;\n\n  \tText.prototype.bind = function bind () {\n  \t\t// noop\n  \t};\n\n  \tText.prototype.detach = function detach () {\n  \t\treturn detachNode( this.node );\n  \t};\n\n  \tText.prototype.firstNode = function firstNode () {\n  \t\treturn this.node;\n  \t};\n\n  \tText.prototype.rebind = function rebind () {\n  \t\t// noop\n  \t};\n\n  \tText.prototype.render = function render ( target, occupants ) {\n  \t\tthis.rendered = true;\n\n  \t\tif ( occupants ) {\n  \t\t\tvar n = occupants[0];\n  \t\t\tif ( n && n.nodeType === 3 ) {\n  \t\t\t\toccupants.shift();\n  \t\t\t\tif ( n.nodeValue !== this.template ) {\n  \t\t\t\t\tn.nodeValue = this.template;\n  \t\t\t\t}\n  \t\t\t} else {\n  \t\t\t\tn = this.node = doc.createTextNode( this.template );\n  \t\t\t\tif ( occupants[0] ) {\n  \t\t\t\t\ttarget.insertBefore( n, occupants[0] );\n  \t\t\t\t} else {\n  \t\t\t\t\ttarget.appendChild( n );\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\tthis.node = n;\n  \t\t} else {\n  \t\t\tthis.node = doc.createTextNode( this.template );\n  \t\t\ttarget.appendChild( this.node );\n  \t\t}\n  \t};\n\n  \tText.prototype.toString = function toString ( escape ) {\n  \t\treturn escape ? escapeHtml( this.template ) : this.template;\n  \t};\n\n  \tText.prototype.unbind = function unbind () {\n  \t\t// noop\n  \t};\n\n  \tText.prototype.unrender = function unrender ( shouldDestroy ) {\n  \t\tif ( this.rendered && shouldDestroy ) this.detach();\n  \t\tthis.rendered = false;\n  \t};\n\n  \tText.prototype.update = function update () {\n  \t\t// noop\n  \t};\n\n  \tText.prototype.valueOf = function valueOf () {\n  \t\treturn this.template;\n  \t};\n\n  \treturn Text;\n  }(Item));\n\n  var elementCache = {};\n\n  var ieBug;\n  var ieBlacklist;\n\n  try {\n  \tcreateElement( 'table' ).innerHTML = 'foo';\n  } catch ( err ) {\n  \tieBug = true;\n\n  \tieBlacklist = {\n  \t\tTABLE:  [ '<table class=\"x\">', '</table>' ],\n  \t\tTHEAD:  [ '<table><thead class=\"x\">', '</thead></table>' ],\n  \t\tTBODY:  [ '<table><tbody class=\"x\">', '</tbody></table>' ],\n  \t\tTR:     [ '<table><tr class=\"x\">', '</tr></table>' ],\n  \t\tSELECT: [ '<select class=\"x\">', '</select>' ]\n  \t};\n  }\n\n  function insertHtml ( html, node, docFrag ) {\n  \tvar nodes = [];\n\n  \t// render 0 and false\n  \tif ( html == null || html === '' ) return nodes;\n\n  \tvar container;\n  \tvar wrapper;\n  \tvar selectedOption;\n\n  \tif ( ieBug && ( wrapper = ieBlacklist[ node.tagName ] ) ) {\n  \t\tcontainer = element( 'DIV' );\n  \t\tcontainer.innerHTML = wrapper[0] + html + wrapper[1];\n  \t\tcontainer = container.querySelector( '.x' );\n\n  \t\tif ( container.tagName === 'SELECT' ) {\n  \t\t\tselectedOption = container.options[ container.selectedIndex ];\n  \t\t}\n  \t}\n\n  \telse if ( node.namespaceURI === svg$1 ) {\n  \t\tcontainer = element( 'DIV' );\n  \t\tcontainer.innerHTML = '<svg class=\"x\">' + html + '</svg>';\n  \t\tcontainer = container.querySelector( '.x' );\n  \t}\n\n  \telse if ( node.tagName === 'TEXTAREA' ) {\n  \t\tcontainer = createElement( 'div' );\n\n  \t\tif ( typeof container.textContent !== 'undefined' ) {\n  \t\t\tcontainer.textContent = html;\n  \t\t} else {\n  \t\t\tcontainer.innerHTML = html;\n  \t\t}\n  \t}\n\n  \telse {\n  \t\tcontainer = element( node.tagName );\n  \t\tcontainer.innerHTML = html;\n\n  \t\tif ( container.tagName === 'SELECT' ) {\n  \t\t\tselectedOption = container.options[ container.selectedIndex ];\n  \t\t}\n  \t}\n\n  \tvar child;\n  \twhile ( child = container.firstChild ) {\n  \t\tnodes.push( child );\n  \t\tdocFrag.appendChild( child );\n  \t}\n\n  \t// This is really annoying. Extracting <option> nodes from the\n  \t// temporary container <select> causes the remaining ones to\n  \t// become selected. So now we have to deselect them. IE8, you\n  \t// amaze me. You really do\n  \t// ...and now Chrome too\n  \tvar i;\n  \tif ( node.tagName === 'SELECT' ) {\n  \t\ti = nodes.length;\n  \t\twhile ( i-- ) {\n  \t\t\tif ( nodes[i] !== selectedOption ) {\n  \t\t\t\tnodes[i].selected = false;\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \treturn nodes;\n  }\n\n  function element ( tagName ) {\n  \treturn elementCache[ tagName ] || ( elementCache[ tagName ] = createElement( tagName ) );\n  }\n\n  var Triple = (function (Mustache) {\n  \tfunction Triple ( options ) {\n  \t\tMustache.call( this, options );\n  \t}\n\n  \tTriple.prototype = Object.create( Mustache && Mustache.prototype );\n  \tTriple.prototype.constructor = Triple;\n\n  \tTriple.prototype.detach = function detach () {\n  \t\tvar docFrag = createDocumentFragment();\n  \t\tthis.nodes.forEach( function ( node ) { return docFrag.appendChild( node ); } );\n  \t\treturn docFrag;\n  \t};\n\n  \tTriple.prototype.find = function find ( selector ) {\n  \t\tvar this$1 = this;\n\n  \t\tvar len = this.nodes.length;\n  \t\tvar i;\n\n  \t\tfor ( i = 0; i < len; i += 1 ) {\n  \t\t\tvar node = this$1.nodes[i];\n\n  \t\t\tif ( node.nodeType !== 1 ) continue;\n\n  \t\t\tif ( matches( node, selector ) ) return node;\n\n  \t\t\tvar queryResult = node.querySelector( selector );\n  \t\t\tif ( queryResult ) return queryResult;\n  \t\t}\n\n  \t\treturn null;\n  \t};\n\n  \tTriple.prototype.findAll = function findAll ( selector, query ) {\n  \t\tvar this$1 = this;\n\n  \t\tvar len = this.nodes.length;\n  \t\tvar i;\n\n  \t\tfor ( i = 0; i < len; i += 1 ) {\n  \t\t\tvar node = this$1.nodes[i];\n\n  \t\t\tif ( node.nodeType !== 1 ) continue;\n\n  \t\t\tif ( query.test( node ) ) query.add( node );\n\n  \t\t\tvar queryAllResult = node.querySelectorAll( selector );\n  \t\t\tif ( queryAllResult ) {\n  \t\t\t\tvar numNodes = queryAllResult.length;\n  \t\t\t\tvar j;\n\n  \t\t\t\tfor ( j = 0; j < numNodes; j += 1 ) {\n  \t\t\t\t\tquery.add( queryAllResult[j] );\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tTriple.prototype.findComponent = function findComponent () {\n  \t\treturn null;\n  \t};\n\n  \tTriple.prototype.firstNode = function firstNode () {\n  \t\treturn this.nodes[0];\n  \t};\n\n  \tTriple.prototype.render = function render ( target ) {\n  \t\tvar html = this.model ? this.model.get() : '';\n  \t\tthis.nodes = insertHtml( html, this.parentFragment.findParentNode(), target );\n  \t\tthis.rendered = true;\n  \t};\n\n  \tTriple.prototype.toString = function toString () {\n  \t\treturn this.model && this.model.get() != null ? decodeCharacterReferences( '' + this.model.get() ) : '';\n  \t};\n\n  \tTriple.prototype.unrender = function unrender () {\n  \t\tif ( this.nodes ) this.nodes.forEach( function ( node ) { return detachNode( node ); } );\n  \t\tthis.rendered = false;\n  \t};\n\n  \tTriple.prototype.update = function update () {\n  \t\tif ( this.rendered && this.dirty ) {\n  \t\t\tthis.dirty = false;\n\n  \t\t\tthis.unrender();\n  \t\t\tvar docFrag = createDocumentFragment();\n  \t\t\tthis.render( docFrag );\n\n  \t\t\tvar parentNode = this.parentFragment.findParentNode();\n  \t\t\tvar anchor = this.parentFragment.findNextNode( this );\n\n  \t\t\tparentNode.insertBefore( docFrag, anchor );\n  \t\t}\n  \t};\n\n  \treturn Triple;\n  }(Mustache));\n\n  var Yielder = (function (Item) {\n  \tfunction Yielder ( options ) {\n  \t\tItem.call( this, options );\n\n  \t\tthis.container = options.parentFragment.ractive;\n  \t\tthis.component = this.container.component;\n\n  \t\tthis.containerFragment = options.parentFragment;\n  \t\tthis.parentFragment = this.component.parentFragment;\n\n  \t\t// {{yield}} is equivalent to {{yield content}}\n  \t\tthis.name = options.template.n || '';\n  \t}\n\n  \tYielder.prototype = Object.create( Item && Item.prototype );\n  \tYielder.prototype.constructor = Yielder;\n\n  \tYielder.prototype.bind = function bind () {\n  \t\tvar name = this.name;\n\n  \t\t( this.component.yielders[ name ] || ( this.component.yielders[ name ] = [] ) ).push( this );\n\n  \t\t// TODO don't parse here\n  \t\tvar template = this.container._inlinePartials[ name || 'content' ];\n\n  \t\tif ( typeof template === 'string' ) {\n  \t\t\ttemplate = parse( template ).t;\n  \t\t}\n\n  \t\tif ( !template ) {\n  \t\t\twarnIfDebug( (\"Could not find template for partial \\\"\" + name + \"\\\"\"), { ractive: this.ractive });\n  \t\t\ttemplate = [];\n  \t\t}\n\n  \t\tthis.fragment = new Fragment({\n  \t\t\towner: this,\n  \t\t\tractive: this.container.parent,\n  \t\t\ttemplate: template\n  \t\t}).bind();\n  \t};\n\n  \tYielder.prototype.bubble = function bubble () {\n  \t\tif ( !this.dirty ) {\n  \t\t\tthis.containerFragment.bubble();\n  \t\t\tthis.dirty = true;\n  \t\t}\n  \t};\n\n  \tYielder.prototype.detach = function detach () {\n  \t\treturn this.fragment.detach();\n  \t};\n\n  \tYielder.prototype.find = function find ( selector ) {\n  \t\treturn this.fragment.find( selector );\n  \t};\n\n  \tYielder.prototype.findAll = function findAll ( selector, queryResult ) {\n  \t\tthis.fragment.find( selector, queryResult );\n  \t};\n\n  \tYielder.prototype.findComponent = function findComponent ( name ) {\n  \t\treturn this.fragment.findComponent( name );\n  \t};\n\n  \tYielder.prototype.findAllComponents = function findAllComponents ( name, queryResult ) {\n  \t\tthis.fragment.findAllComponents( name, queryResult );\n  \t};\n\n  \tYielder.prototype.findNextNode = function findNextNode() {\n  \t\treturn this.containerFragment.findNextNode( this );\n  \t};\n\n  \tYielder.prototype.firstNode = function firstNode ( skipParent ) {\n  \t\treturn this.fragment.firstNode( skipParent );\n  \t};\n\n  \tYielder.prototype.rebind = function rebind () {\n  \t\tthis.fragment.rebind();\n  \t};\n\n  \tYielder.prototype.render = function render ( target, occupants ) {\n  \t\treturn this.fragment.render( target, occupants );\n  \t};\n\n  \tYielder.prototype.setTemplate = function setTemplate ( name ) {\n  \t\tvar template = this.parentFragment.ractive.partials[ name ];\n\n  \t\tif ( typeof template === 'string' ) {\n  \t\t\ttemplate = parse( template ).t;\n  \t\t}\n\n  \t\tthis.partialTemplate = template || []; // TODO warn on missing partial\n  \t};\n\n  \tYielder.prototype.toString = function toString ( escape ) {\n  \t\treturn this.fragment.toString( escape );\n  \t};\n\n  \tYielder.prototype.unbind = function unbind () {\n  \t\tthis.fragment.unbind();\n  \t\tremoveFromArray( this.component.yielders[ this.name ], this );\n  \t};\n\n  \tYielder.prototype.unrender = function unrender ( shouldDestroy ) {\n  \t\tthis.fragment.unrender( shouldDestroy );\n  \t};\n\n  \tYielder.prototype.update = function update () {\n  \t\tthis.dirty = false;\n  \t\tthis.fragment.update();\n  \t};\n\n  \treturn Yielder;\n  }(Item));\n\n  // finds the component constructor in the registry or view hierarchy registries\n  function getComponentConstructor ( ractive, name ) {\n  \tvar instance = findInstance( 'components', ractive, name );\n  \tvar Component;\n\n  \tif ( instance ) {\n  \t\tComponent = instance.components[ name ];\n\n  \t\t// best test we have for not Ractive.extend\n  \t\tif ( !Component._Parent ) {\n  \t\t\t// function option, execute and store for reset\n  \t\t\tvar fn = Component.bind( instance );\n  \t\t\tfn.isOwner = instance.components.hasOwnProperty( name );\n  \t\t\tComponent = fn();\n\n  \t\t\tif ( !Component ) {\n  \t\t\t\twarnIfDebug( noRegistryFunctionReturn, name, 'component', 'component', { ractive: ractive });\n  \t\t\t\treturn;\n  \t\t\t}\n\n  \t\t\tif ( typeof Component === 'string' ) {\n  \t\t\t\t// allow string lookup\n  \t\t\t\tComponent = getComponentConstructor( ractive, Component );\n  \t\t\t}\n\n  \t\t\tComponent._fn = fn;\n  \t\t\tinstance.components[ name ] = Component;\n  \t\t}\n  \t}\n\n  \treturn Component;\n  }\n\n  var constructors = {};\n  constructors[ ALIAS ] = Alias;\n  constructors[ DOCTYPE ] = Doctype;\n  constructors[ INTERPOLATOR ] = Interpolator;\n  constructors[ PARTIAL ] = Partial;\n  constructors[ SECTION ] = Section;\n  constructors[ TRIPLE ] = Triple;\n  constructors[ YIELDER ] = Yielder;\n\n  var specialElements = {\n  \tdoctype: Doctype,\n  \tform: Form,\n  \tinput: Input,\n  \toption: Option,\n  \tselect: Select,\n  \ttextarea: Textarea\n  };\n\n  function createItem ( options ) {\n  \tif ( typeof options.template === 'string' ) {\n  \t\treturn new Text( options );\n  \t}\n\n  \tif ( options.template.t === ELEMENT ) {\n  \t\t// could be component or element\n  \t\tvar ComponentConstructor = getComponentConstructor( options.parentFragment.ractive, options.template.e );\n  \t\tif ( ComponentConstructor ) {\n  \t\t\treturn new Component( options, ComponentConstructor );\n  \t\t}\n\n  \t\tvar tagName = options.template.e.toLowerCase();\n\n  \t\tvar ElementConstructor = specialElements[ tagName ] || Element;\n  \t\treturn new ElementConstructor( options );\n  \t}\n\n  \tvar Item = constructors[ options.template.t ];\n\n  \tif ( !Item ) throw new Error( (\"Unrecognised item type \" + (options.template.t)) );\n\n  \treturn new Item( options );\n  }\n\n  var ReferenceResolver = function ReferenceResolver ( fragment, reference, callback ) {\n  \tvar this$1 = this;\n\n  \t\tthis.fragment = fragment;\n  \tthis.reference = normalise( reference );\n  \tthis.callback = callback;\n\n  \tthis.keys = splitKeypathI( reference );\n  \tthis.resolved = false;\n\n  \t// TODO the consumer should take care of addUnresolved\n  \t// we attach to all the contexts between here and the root\n  \t// - whenever their values change, they can quickly\n  \t// check to see if we can resolve\n  \twhile ( fragment ) {\n  \t\tif ( fragment.context ) {\n  \t\t\tfragment.context.addUnresolved( this$1.keys[0], this$1 );\n  \t\t}\n\n  \t\tfragment = fragment.componentParent || fragment.parent;\n  \t}\n  };\n\n  ReferenceResolver.prototype.attemptResolution = function attemptResolution () {\n  \tif ( this.resolved ) return;\n\n  \tvar model = resolveAmbiguousReference( this.fragment, this.reference );\n\n  \tif ( model ) {\n  \t\tthis.resolved = true;\n  \t\tthis.callback( model );\n  \t}\n  };\n\n  ReferenceResolver.prototype.forceResolution = function forceResolution () {\n  \tif ( this.resolved ) return;\n\n  \tvar model = this.fragment.findContext().joinAll( this.keys );\n  \tthis.callback( model );\n  \tthis.resolved = true;\n  };\n\n  ReferenceResolver.prototype.unbind = function unbind () {\n  \tvar this$1 = this;\n\n  \t\tremoveFromArray( this.fragment.unresolved, this );\n\n  \tif ( this.resolved ) return;\n\n  \tvar fragment = this.fragment;\n  \twhile ( fragment ) {\n  \t\tif ( fragment.context ) {\n  \t\t\tfragment.context.removeUnresolved( this$1.keys[0], this$1 );\n  \t\t}\n\n  \t\tfragment = fragment.componentParent || fragment.parent;\n  \t}\n  };\n\n  // TODO all this code needs to die\n  function processItems ( items, values, guid, counter ) {\n  \tif ( counter === void 0 ) counter = 0;\n\n  \treturn items.map( function ( item ) {\n  \t\tif ( item.type === TEXT ) {\n  \t\t\treturn item.template;\n  \t\t}\n\n  \t\tif ( item.fragment ) {\n  \t\t\tif ( item.fragment.iterations ) {\n  \t\t\t\treturn item.fragment.iterations.map( function ( fragment ) {\n  \t\t\t\t\treturn processItems( fragment.items, values, guid, counter );\n  \t\t\t\t}).join( '' );\n  \t\t\t} else {\n  \t\t\t\treturn processItems( item.fragment.items, values, guid, counter );\n  \t\t\t}\n  \t\t}\n\n  \t\tvar placeholderId = \"\" + guid + \"-\" + (counter++);\n\n  \t\tvalues[ placeholderId ] = item.model ?\n  \t\t\titem.model.wrapper ?\n  \t\t\t\titem.model.wrapper.value :\n  \t\t\t\titem.model.get() :\n  \t\t\tundefined;\n\n  \t\treturn '${' + placeholderId + '}';\n  \t}).join( '' );\n  }\n\n  function unrenderAndDestroy$1 ( item ) {\n  \titem.unrender( true );\n  }\n\n  var Fragment = function Fragment ( options ) {\n  \tthis.owner = options.owner; // The item that owns this fragment - an element, section, partial, or attribute\n\n  \tthis.isRoot = !options.owner.parentFragment;\n  \tthis.parent = this.isRoot ? null : this.owner.parentFragment;\n  \tthis.ractive = options.ractive || ( this.isRoot ? options.owner : this.parent.ractive );\n\n  \tthis.componentParent = ( this.isRoot && this.ractive.component ) ? this.ractive.component.parentFragment : null;\n\n  \tthis.context = null;\n  \tthis.rendered = false;\n\n  \t// encapsulated styles should be inherited until they get applied by an element\n  \tthis.cssIds = 'cssIds' in options ? options.cssIds : ( this.parent ? this.parent.cssIds : null );\n\n  \tthis.resolvers = [];\n\n  \tthis.dirty = false;\n  \tthis.dirtyArgs = this.dirtyValue = true; // TODO getArgsList is nonsense - should deprecate legacy directives style\n\n  \tthis.template = options.template || [];\n  \tthis.createItems();\n  };\n\n  Fragment.prototype.bind = function bind$1 ( context ) {\n  \tthis.context = context;\n  \tthis.items.forEach( bind );\n  \tthis.bound = true;\n\n  \t// in rare cases, a forced resolution (or similar) will cause the\n  \t// fragment to be dirty before it's even finished binding. In those\n  \t// cases we update immediately\n  \tif ( this.dirty ) this.update();\n\n  \treturn this;\n  };\n\n  Fragment.prototype.bubble = function bubble () {\n  \tthis.dirtyArgs = this.dirtyValue = true;\n\n  \tif ( !this.dirty ) {\n  \t\tthis.dirty = true;\n\n  \t\tif ( this.isRoot ) { // TODO encapsulate 'is component root, but not overall root' check?\n  \t\t\tif ( this.ractive.component ) {\n  \t\t\t\tthis.ractive.component.bubble();\n  \t\t\t} else if ( this.bound ) {\n  \t\t\t\trunloop.addFragment( this );\n  \t\t\t}\n  \t\t} else {\n  \t\t\tthis.owner.bubble();\n  \t\t}\n  \t}\n  };\n\n  Fragment.prototype.createItems = function createItems () {\n  \tvar this$1 = this;\n\n  \t\tthis.items = this.template.map( function ( template, index ) {\n  \t\treturn createItem({ parentFragment: this$1, template: template, index: index });\n  \t});\n  };\n\n  Fragment.prototype.detach = function detach () {\n  \tvar docFrag = createDocumentFragment();\n  \tthis.items.forEach( function ( item ) { return docFrag.appendChild( item.detach() ); } );\n  \treturn docFrag;\n  };\n\n  Fragment.prototype.find = function find ( selector ) {\n  \tvar this$1 = this;\n\n  \t\tvar len = this.items.length;\n  \tvar i;\n\n  \tfor ( i = 0; i < len; i += 1 ) {\n  \t\tvar found = this$1.items[i].find( selector );\n  \t\tif ( found ) return found;\n  \t}\n  };\n\n  Fragment.prototype.findAll = function findAll ( selector, query ) {\n  \tvar this$1 = this;\n\n  \t\tif ( this.items ) {\n  \t\tvar len = this.items.length;\n  \t\tvar i;\n\n  \t\tfor ( i = 0; i < len; i += 1 ) {\n  \t\t\tvar item = this$1.items[i];\n\n  \t\t\tif ( item.findAll ) {\n  \t\t\t\titem.findAll( selector, query );\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \treturn query;\n  };\n\n  Fragment.prototype.findComponent = function findComponent ( name ) {\n  \tvar this$1 = this;\n\n  \t\tvar len = this.items.length;\n  \tvar i;\n\n  \tfor ( i = 0; i < len; i += 1 ) {\n  \t\tvar found = this$1.items[i].findComponent( name );\n  \t\tif ( found ) return found;\n  \t}\n  };\n\n  Fragment.prototype.findAllComponents = function findAllComponents ( name, query ) {\n  \tvar this$1 = this;\n\n  \t\tif ( this.items ) {\n  \t\tvar len = this.items.length;\n  \t\tvar i;\n\n  \t\tfor ( i = 0; i < len; i += 1 ) {\n  \t\t\tvar item = this$1.items[i];\n\n  \t\t\tif ( item.findAllComponents ) {\n  \t\t\t\titem.findAllComponents( name, query );\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \treturn query;\n  };\n\n  Fragment.prototype.findContext = function findContext () {\n  \tvar fragment = this;\n  \twhile ( !fragment.context ) fragment = fragment.parent;\n  \treturn fragment.context;\n  };\n\n  Fragment.prototype.findNextNode = function findNextNode ( item ) {\n  \t// search for the next node going forward\n  \tvar this$1 = this;\n\n  \t\tfor ( var i = item.index + 1; i < this$1.items.length; i++ ) {\n  \t\tif ( !this$1.items[ i ] ) continue;\n\n  \t\tvar node = this$1.items[ i ].firstNode( true );\n  \t\tif ( node ) return node;\n  \t}\n\n  \t// if this is the root fragment, and there are no more items,\n  \t// it means we're at the end...\n  \tif ( this.isRoot ) {\n  \t\tif ( this.ractive.component ) {\n  \t\t\treturn this.ractive.component.parentFragment.findNextNode( this.ractive.component );\n  \t\t}\n\n  \t\t// TODO possible edge case with other content\n  \t\t// appended to this.ractive.el?\n  \t\treturn null;\n  \t}\n\n  \treturn this.owner.findNextNode( this ); // the argument is in case the parent is a RepeatedFragment\n  };\n\n  Fragment.prototype.findParentNode = function findParentNode () {\n  \tvar fragment = this;\n\n  \tdo {\n  \t\tif ( fragment.owner.type === ELEMENT ) {\n  \t\t\treturn fragment.owner.node;\n  \t\t}\n\n  \t\tif ( fragment.isRoot && !fragment.ractive.component ) { // TODO encapsulate check\n  \t\t\treturn fragment.ractive.el;\n  \t\t}\n\n  \t\tif ( fragment.owner.type === YIELDER ) {\n  \t\t\tfragment = fragment.owner.containerFragment;\n  \t\t} else {\n  \t\t\tfragment = fragment.componentParent || fragment.parent; // TODO ugh\n  \t\t}\n  \t} while ( fragment );\n\n  \tthrow new Error( 'Could not find parent node' ); // TODO link to issue tracker\n  };\n\n  Fragment.prototype.findRepeatingFragment = function findRepeatingFragment () {\n  \tvar fragment = this;\n  \t// TODO better check than fragment.parent.iterations\n  \twhile ( fragment.parent && !fragment.isIteration ) {\n  \t\tfragment = fragment.parent || fragment.componentParent;\n  \t}\n\n  \treturn fragment;\n  };\n\n  Fragment.prototype.firstNode = function firstNode ( skipParent ) {\n  \tvar this$1 = this;\n\n  \t\tvar node;\n  \tfor ( var i = 0; i < this$1.items.length; i++ ) {\n  \t\tnode = this$1.items[i].firstNode( true );\n\n  \t\tif ( node ) {\n  \t\t\treturn node;\n  \t\t}\n  \t}\n\n  \tif ( skipParent ) return null;\n\n  \treturn this.parent.findNextNode( this.owner );\n  };\n\n  // TODO ideally, this would be deprecated in favour of an\n  // expression-like approach\n  Fragment.prototype.getArgsList = function getArgsList () {\n  \tif ( this.dirtyArgs ) {\n  \t\tvar values = {};\n  \t\tvar source = processItems( this.items, values, this.ractive._guid );\n  \t\tvar parsed = parseJSON( '[' + source + ']', values );\n\n  \t\tthis.argsList = parsed ?\n  \t\t\tparsed.value :\n  \t\t\t[ this.toString() ];\n\n  \t\tthis.dirtyArgs = false;\n  \t}\n\n  \treturn this.argsList;\n  };\n\n  Fragment.prototype.rebind = function rebind$1 ( context ) {\n  \tthis.context = context;\n\n  \tthis.items.forEach( rebind );\n  };\n\n  Fragment.prototype.render = function render ( target, occupants ) {\n  \tif ( this.rendered ) throw new Error( 'Fragment is already rendered!' );\n  \tthis.rendered = true;\n\n  \tthis.items.forEach( function ( item ) { return item.render( target, occupants ); } );\n  };\n\n  Fragment.prototype.resetTemplate = function resetTemplate ( template ) {\n  \tvar wasBound = this.bound;\n  \tvar wasRendered = this.rendered;\n\n  \t// TODO ensure transitions are disabled globally during reset\n\n  \tif ( wasBound ) {\n  \t\tif ( wasRendered ) this.unrender( true );\n  \t\tthis.unbind();\n  \t}\n\n  \tthis.template = template;\n  \tthis.createItems();\n\n  \tif ( wasBound ) {\n  \t\tthis.bind( this.context );\n\n  \t\tif ( wasRendered ) {\n  \t\t\tvar parentNode = this.findParentNode();\n  \t\t\tvar anchor = this.parent ? this.parent.findNextNode( this.owner ) : null;\n\n  \t\t\tif ( anchor ) {\n  \t\t\t\tvar docFrag = createDocumentFragment();\n  \t\t\t\tthis.render( docFrag );\n  \t\t\t\tparentNode.insertBefore( docFrag, anchor );\n  \t\t\t} else {\n  \t\t\t\tthis.render( parentNode );\n  \t\t\t}\n  \t\t}\n  \t}\n  };\n\n  Fragment.prototype.resolve = function resolve ( template, callback ) {\n  \tif ( !this.context ) {\n  \t\treturn this.parent.resolve( template, callback );\n  \t}\n\n  \tvar resolver = new ReferenceResolver( this, template, callback );\n  \tthis.resolvers.push( resolver );\n\n  \treturn resolver; // so we can e.g. force resolution\n  };\n\n  Fragment.prototype.toHtml = function toHtml () {\n  \treturn this.toString();\n  };\n\n  Fragment.prototype.toString = function toString$1$$ ( escape ) {\n  \treturn this.items.map( escape ? toEscapedString : toString$1 ).join( '' );\n  };\n\n  Fragment.prototype.unbind = function unbind$1 () {\n  \tthis.items.forEach( unbind );\n  \tthis.bound = false;\n\n  \treturn this;\n  };\n\n  Fragment.prototype.unrender = function unrender$1 ( shouldDestroy ) {\n  \tthis.items.forEach( shouldDestroy ? unrenderAndDestroy$1 : unrender );\n  \tthis.rendered = false;\n  };\n\n  Fragment.prototype.update = function update$1 () {\n  \tif ( this.dirty && !this.updating ) {\n  \t\tthis.dirty = false;\n  \t\tthis.updating = true;\n  \t\tthis.items.forEach( update );\n  \t\tthis.updating = false;\n  \t}\n  };\n\n  Fragment.prototype.valueOf = function valueOf () {\n  \tif ( this.items.length === 1 ) {\n  \t\treturn this.items[0].valueOf();\n  \t}\n\n  \tif ( this.dirtyValue ) {\n  \t\tvar values = {};\n  \t\tvar source = processItems( this.items, values, this.ractive._guid );\n  \t\tvar parsed = parseJSON( source, values );\n\n  \t\tthis.value = parsed ?\n  \t\t\tparsed.value :\n  \t\t\tthis.toString();\n\n  \t\tthis.dirtyValue = false;\n  \t}\n\n  \treturn this.value;\n  };\n\n  // TODO should resetTemplate be asynchronous? i.e. should it be a case\n  // of outro, update template, intro? I reckon probably not, since that\n  // could be achieved with unrender-resetTemplate-render. Also, it should\n  // conceptually be similar to resetPartial, which couldn't be async\n\n  function Ractive$resetTemplate ( template ) {\n  \ttemplateConfigurator.init( null, this, { template: template });\n\n  \tvar transitionsEnabled = this.transitionsEnabled;\n  \tthis.transitionsEnabled = false;\n\n  \t// Is this is a component, we need to set the `shouldDestroy`\n  \t// flag, otherwise it will assume by default that a parent node\n  \t// will be detached, and therefore it doesn't need to bother\n  \t// detaching its own nodes\n  \tvar component = this.component;\n  \tif ( component ) component.shouldDestroy = true;\n  \tthis.unrender();\n  \tif ( component ) component.shouldDestroy = false;\n\n  \t// remove existing fragment and create new one\n  \tthis.fragment.unbind().unrender( true );\n\n  \tthis.fragment = new Fragment({\n  \t\ttemplate: this.template,\n  \t\troot: this,\n  \t\towner: this\n  \t});\n\n  \tvar docFrag = createDocumentFragment();\n  \tthis.fragment.bind( this.viewmodel ).render( docFrag );\n  \tthis.el.insertBefore( docFrag, this.anchor );\n\n  \tthis.transitionsEnabled = transitionsEnabled;\n  }\n\n  var reverse = makeArrayMethod( 'reverse' );\n\n  function Ractive$set ( keypath, value ) {\n  \tvar promise = runloop.start( this, true );\n\n  \t// Set multiple keypaths in one go\n  \tif ( isObject( keypath ) ) {\n  \t\tvar map = keypath;\n\n  \t\tfor ( var k in map ) {\n  \t\t\tif ( map.hasOwnProperty( k) ) {\n  \t\t\t\tset$1( this, k, map[k] );\n  \t\t\t}\n  \t\t}\n  \t}\n  \t// Set a single keypath\n  \telse {\n  \t\tset$1( this, keypath, value );\n  \t}\n\n  \trunloop.end();\n\n  \treturn promise;\n  }\n\n\n  function set$1 ( ractive, keypath, value ) {\n  \tif ( typeof value === 'function' ) value = bind$1( value, ractive );\n\n  \tif ( /\\*/.test( keypath ) ) {\n  \t\tractive.viewmodel.findMatches( splitKeypathI( keypath ) ).forEach( function ( model ) {\n  \t\t\tmodel.set( value );\n  \t\t});\n  \t} else {\n  \t\tvar model = ractive.viewmodel.joinAll( splitKeypathI( keypath ) );\n  \t\tmodel.set( value );\n  \t}\n  }\n\n  var shift$1 = makeArrayMethod( 'shift' );\n\n  var sort = makeArrayMethod( 'sort' );\n\n  var splice$1 = makeArrayMethod( 'splice' );\n\n  function Ractive$subtract ( keypath, d ) {\n  \treturn add( this, keypath, ( d === undefined ? -1 : -d ) );\n  }\n\n  var teardownHook$1 = new Hook( 'teardown' );\n\n  // Teardown. This goes through the root fragment and all its children, removing observers\n  // and generally cleaning up after itself\n\n  function Ractive$teardown () {\n  \tvar this$1 = this;\n\n  \tthis.fragment.unbind();\n  \tthis.viewmodel.teardown();\n\n  \tthis._observers.forEach( cancel );\n\n  \tif ( this.fragment.rendered && this.el.__ractive_instances__ ) {\n  \t\tremoveFromArray( this.el.__ractive_instances__, this );\n  \t}\n\n  \tthis.shouldDestroy = true;\n  \tvar promise = ( this.fragment.rendered ? this.unrender() : Promise$1.resolve() );\n\n  \tObject.keys( this._links ).forEach( function ( k ) { return this$1._links[k].unlink(); } );\n\n  \tteardownHook$1.fire( this );\n\n  \treturn promise;\n  }\n\n  function Ractive$toggle ( keypath ) {\n  \tif ( typeof keypath !== 'string' ) {\n  \t\tthrow new TypeError( badArguments );\n  \t}\n\n  \tvar changes;\n\n  \tif ( /\\*/.test( keypath ) ) {\n  \t\tchanges = {};\n\n  \t\tthis.viewmodel.findMatches( splitKeypathI( keypath ) ).forEach( function ( model ) {\n  \t\t\tchanges[ model.getKeypath() ] = !model.get();\n  \t\t});\n\n  \t\treturn this.set( changes );\n  \t}\n\n  \treturn this.set( keypath, !this.get( keypath ) );\n  }\n\n  function Ractive$toCSS() {\n  \tvar cssIds = [ this.cssId ].concat( this.findAllComponents().map( function ( c ) { return c.cssId; } ) );\n  \tvar uniqueCssIds = Object.keys(cssIds.reduce( function ( ids, id ) { return (ids[id] = true, ids); }, {}));\n  \treturn getCSS( uniqueCssIds );\n  }\n\n  function Ractive$toHTML () {\n  \treturn this.fragment.toString( true );\n  }\n\n  function Ractive$transition ( name, node, params ) {\n\n  \tif ( node instanceof HTMLElement ) {\n  \t\t// good to go\n  \t}\n  \telse if ( isObject( node ) ) {\n  \t\t// omitted, use event node\n  \t\tparams = node;\n  \t}\n\n  \t// if we allow query selector, then it won't work\n  \t// simple params like \"fast\"\n\n  \t// else if ( typeof node === 'string' ) {\n  \t// \t// query selector\n  \t// \tnode = this.find( node )\n  \t// }\n\n  \tnode = node || this.event.node;\n\n  \tif ( !node ) {\n  \t\tfatal( (\"No node was supplied for transition \" + name) );\n  \t}\n\n  \tvar transition = new Transition( this, node, name, params );\n  \tvar promise = runloop.start( this, true );\n  \trunloop.registerTransition( transition );\n  \trunloop.end();\n  \treturn promise;\n  }\n\n  function unlink$1( here ) {\n  \tvar ln = this._links[ here ];\n\n  \tif ( ln ) {\n  \t\tln.unlink();\n  \t\tdelete this._links[ here ];\n  \t\treturn this.set( here, ln.intialValue );\n  \t} else {\n  \t\treturn Promise$1.resolve( true );\n  \t}\n  }\n\n  var unrenderHook$1 = new Hook( 'unrender' );\n\n  function Ractive$unrender () {\n  \tif ( !this.fragment.rendered ) {\n  \t\twarnIfDebug( 'ractive.unrender() was called on a Ractive instance that was not rendered' );\n  \t\treturn Promise$1.resolve();\n  \t}\n\n  \tvar promise = runloop.start( this, true );\n\n  \t// If this is a component, and the component isn't marked for destruction,\n  \t// don't detach nodes from the DOM unnecessarily\n  \tvar shouldDestroy = !this.component || this.component.shouldDestroy || this.shouldDestroy;\n  \tthis.fragment.unrender( shouldDestroy );\n\n  \tremoveFromArray( this.el.__ractive_instances__, this );\n\n  \tunrenderHook$1.fire( this );\n\n  \trunloop.end();\n  \treturn promise;\n  }\n\n  var unshift$1 = makeArrayMethod( 'unshift' );\n\n  var updateHook = new Hook( 'update' );\n\n  function Ractive$update ( keypath ) {\n  \tif ( keypath ) keypath = splitKeypathI( keypath );\n\n  \tvar model = keypath ?\n  \t\tthis.viewmodel.joinAll( keypath ) :\n  \t\tthis.viewmodel;\n\n  \tif ( model.parent && model.parent.wrapper ) return this.update( model.parent.getKeypath( this ) );\n\n  \tvar promise = runloop.start( this, true );\n\n  \tmodel.mark();\n  \tmodel.registerChange( model.getKeypath(), model.get() );\n\n  \tif ( keypath ) {\n  \t\t// there may be unresolved refs that are now resolvable up the context tree\n  \t\tvar parent = model.parent;\n  \t\twhile ( keypath.length && parent ) {\n  \t\t\tif ( parent.clearUnresolveds ) parent.clearUnresolveds( keypath.pop() );\n  \t\t\tparent = parent.parent;\n  \t\t}\n  \t}\n\n  \t// notify upstream of changes\n  \tmodel.notifyUpstream();\n\n  \trunloop.end();\n\n  \tupdateHook.fire( this, model );\n\n  \treturn promise;\n  }\n\n  function Ractive$updateModel ( keypath, cascade ) {\n  \tvar promise = runloop.start( this, true );\n\n  \tif ( !keypath ) {\n  \t\tthis.viewmodel.updateFromBindings( true );\n  \t} else {\n  \t\tthis.viewmodel.joinAll( splitKeypathI( keypath ) ).updateFromBindings( cascade !== false );\n  \t}\n\n  \trunloop.end();\n\n  \treturn promise;\n  }\n\n  var proto = {\n  \tadd: Ractive$add,\n  \tanimate: Ractive$animate,\n  \tdetach: Ractive$detach,\n  \tfind: Ractive$find,\n  \tfindAll: Ractive$findAll,\n  \tfindAllComponents: Ractive$findAllComponents,\n  \tfindComponent: Ractive$findComponent,\n  \tfindContainer: Ractive$findContainer,\n  \tfindParent: Ractive$findParent,\n  \tfire: Ractive$fire,\n  \tget: Ractive$get,\n  \tgetNodeInfo: getNodeInfo,\n  \tinsert: Ractive$insert,\n  \tlink: link$1,\n  \tmerge: Ractive$merge,\n  \tobserve: observe,\n  \tobserveList: observeList,\n  \tobserveOnce: observeOnce,\n  \t// TODO reinstate these\n  \t// observeListOnce,\n  \toff: Ractive$off,\n  \ton: Ractive$on,\n  \tonce: Ractive$once,\n  \tpop: pop$1,\n  \tpush: push$1,\n  \trender: Ractive$render,\n  \treset: Ractive$reset,\n  \tresetPartial: resetPartial,\n  \tresetTemplate: Ractive$resetTemplate,\n  \treverse: reverse,\n  \tset: Ractive$set,\n  \tshift: shift$1,\n  \tsort: sort,\n  \tsplice: splice$1,\n  \tsubtract: Ractive$subtract,\n  \tteardown: Ractive$teardown,\n  \ttoggle: Ractive$toggle,\n  \ttoCSS: Ractive$toCSS,\n  \ttoCss: Ractive$toCSS,\n  \ttoHTML: Ractive$toHTML,\n  \ttoHtml: Ractive$toHTML,\n  \ttransition: Ractive$transition,\n  \tunlink: unlink$1,\n  \tunrender: Ractive$unrender,\n  \tunshift: unshift$1,\n  \tupdate: Ractive$update,\n  \tupdateModel: Ractive$updateModel\n  };\n\n  function wrap$1 ( method, superMethod, force ) {\n\n  \tif ( force || needsSuper( method, superMethod ) )  {\n\n  \t\treturn function () {\n\n  \t\t\tvar hasSuper = ( '_super' in this ), _super = this._super, result;\n\n  \t\t\tthis._super = superMethod;\n\n  \t\t\tresult = method.apply( this, arguments );\n\n  \t\t\tif ( hasSuper ) {\n  \t\t\t\tthis._super = _super;\n  \t\t\t}\n\n  \t\t\treturn result;\n  \t\t};\n  \t}\n\n  \telse {\n  \t\treturn method;\n  \t}\n  }\n\n  function needsSuper ( method, superMethod ) {\n  \treturn typeof superMethod === 'function' && /_super/.test( method );\n  }\n\n  function unwrap ( Child ) {\n  \tvar options = {};\n\n  \twhile ( Child ) {\n  \t\taddRegistries( Child, options );\n  \t\taddOtherOptions( Child, options );\n\n  \t\tif ( Child._Parent !== Ractive ) {\n  \t\t\tChild = Child._Parent;\n  \t\t} else {\n  \t\t\tChild = false;\n  \t\t}\n  \t}\n\n  \treturn options;\n  }\n\n  function addRegistries ( Child, options ) {\n  \tregistries.forEach( function ( r ) {\n  \t\taddRegistry(\n  \t\t\tr.useDefaults ? Child.prototype : Child,\n  \t\t\toptions, r.name );\n  \t});\n  }\n\n  function addRegistry ( target, options, name ) {\n  \tvar registry, keys = Object.keys( target[ name ] );\n\n  \tif ( !keys.length ) { return; }\n\n  \tif ( !( registry = options[ name ] ) ) {\n  \t\tregistry = options[ name ] = {};\n  \t}\n\n  \tkeys\n  \t\t.filter( function ( key ) { return !( key in registry ); } )\n  \t\t.forEach( function ( key ) { return registry[ key ] = target[ name ][ key ]; } );\n  }\n\n  function addOtherOptions ( Child, options ) {\n  \tObject.keys( Child.prototype ).forEach( function ( key ) {\n  \t\tif ( key === 'computed' ) { return; }\n\n  \t\tvar value = Child.prototype[ key ];\n\n  \t\tif ( !( key in options ) ) {\n  \t\t\toptions[ key ] = value._method ? value._method : value;\n  \t\t}\n\n  \t\t// is it a wrapped function?\n  \t\telse if ( typeof options[ key ] === 'function'\n  \t\t\t\t&& typeof value === 'function'\n  \t\t\t\t&& options[ key ]._method ) {\n\n  \t\t\tvar result, needsSuper = value._method;\n\n  \t\t\tif ( needsSuper ) { value = value._method; }\n\n  \t\t\t// rewrap bound directly to parent fn\n  \t\t\tresult = wrap$1( options[ key ]._method, value );\n\n  \t\t\tif ( needsSuper ) { result._method = result; }\n\n  \t\t\toptions[ key ] = result;\n  \t\t}\n  \t});\n  }\n\n  function extend () {\n  \tvar options = [], len = arguments.length;\n  \twhile ( len-- ) options[ len ] = arguments[ len ];\n\n  \tif( !options.length ) {\n  \t\treturn extendOne( this );\n  \t} else {\n  \t\treturn options.reduce( extendOne, this );\n  \t}\n  }\n\n  function extendOne ( Parent, options ) {\n  \tif ( options === void 0 ) options = {};\n\n  \tvar Child, proto;\n\n  \t// if we're extending with another Ractive instance...\n  \t//\n  \t//   var Human = Ractive.extend(...), Spider = Ractive.extend(...);\n  \t//   var Spiderman = Human.extend( Spider );\n  \t//\n  \t// ...inherit prototype methods and default options as well\n  \tif ( options.prototype instanceof Ractive ) {\n  \t\toptions = unwrap( options );\n  \t}\n\n  \tChild = function ( options ) {\n  \t\tif ( !( this instanceof Child ) ) return new Child( options );\n\n  \t\tconstruct( this, options || {} );\n  \t\tinitialise( this, options || {}, {} );\n  \t};\n\n  \tproto = create( Parent.prototype );\n  \tproto.constructor = Child;\n\n  \t// Static properties\n  \tdefineProperties( Child, {\n  \t\t// alias prototype as defaults\n  \t\tdefaults: { value: proto },\n\n  \t\t// extendable\n  \t\textend: { value: extend, writable: true, configurable: true },\n\n  \t\t// Parent - for IE8, can't use Object.getPrototypeOf\n  \t\t_Parent: { value: Parent }\n  \t});\n\n  \t// extend configuration\n  \tconfig.extend( Parent, proto, options );\n\n  \tdataConfigurator.extend( Parent, proto, options );\n\n  \tif ( options.computed ) {\n  \t\tproto.computed = extendObj( create( Parent.prototype.computed ), options.computed );\n  \t}\n\n  \tChild.prototype = proto;\n\n  \treturn Child;\n  }\n\n  function joinKeys () {\n  \tvar keys = [], len = arguments.length;\n  \twhile ( len-- ) keys[ len ] = arguments[ len ];\n\n  \treturn keys.map( escapeKey ).join( '.' );\n  }\n\n  function splitKeypath ( keypath ) {\n  \treturn splitKeypathI( keypath ).map( unescapeKey );\n  }\n\n  // Ractive.js makes liberal use of things like Array.prototype.indexOf. In\n  // older browsers, these are made available via a shim - here, we do a quick\n  // pre-flight check to make sure that either a) we're not in a shit browser,\n  // or b) we're using a Ractive-legacy.js build\n  var FUNCTION = 'function';\n\n  if (\n  \ttypeof Date.now !== FUNCTION                 ||\n  \ttypeof String.prototype.trim !== FUNCTION    ||\n  \ttypeof Object.keys !== FUNCTION              ||\n  \ttypeof Array.prototype.indexOf !== FUNCTION  ||\n  \ttypeof Array.prototype.forEach !== FUNCTION  ||\n  \ttypeof Array.prototype.map !== FUNCTION      ||\n  \ttypeof Array.prototype.filter !== FUNCTION   ||\n  \t( win && typeof win.addEventListener !== FUNCTION )\n  ) {\n  \tthrow new Error( 'It looks like you\\'re attempting to use Ractive.js in an older browser. You\\'ll need to use one of the \\'legacy builds\\' in order to continue - see http://docs.ractivejs.org/latest/legacy-builds for more information.' );\n  }\n\n  function Ractive ( options ) {\n  \tif ( !( this instanceof Ractive ) ) return new Ractive( options );\n\n  \tconstruct( this, options || {} );\n  \tinitialise( this, options || {}, {} );\n  }\n\n  extendObj( Ractive.prototype, proto, defaults );\n  Ractive.prototype.constructor = Ractive;\n\n  // alias prototype as `defaults`\n  Ractive.defaults = Ractive.prototype;\n\n  // static properties\n  defineProperties( Ractive, {\n\n  \t// debug flag\n  \tDEBUG:          { writable: true, value: true },\n  \tDEBUG_PROMISES: { writable: true, value: true },\n\n  \t// static methods:\n  \textend:         { value: extend },\n  \tescapeKey:      { value: escapeKey },\n  \tgetNodeInfo:    { value: staticInfo },\n  \tjoinKeys:       { value: joinKeys },\n  \tparse:          { value: parse },\n  \tsplitKeypath:   { value: splitKeypath },\n  \tunescapeKey:    { value: unescapeKey },\n  \tgetCSS:         { value: getCSS },\n\n  \t// namespaced constructors\n  \tPromise:        { value: Promise$1 },\n\n  \t// support\n  \tenhance:        { writable: true, value: false },\n  \tsvg:            { value: svg },\n  \tmagic:          { value: magicSupported },\n\n  \t// version\n  \tVERSION:        { value: '0.8.0-edge' },\n\n  \t// plugins\n  \tadaptors:       { writable: true, value: {} },\n  \tcomponents:     { writable: true, value: {} },\n  \tdecorators:     { writable: true, value: {} },\n  \teasing:         { writable: true, value: easing },\n  \tevents:         { writable: true, value: {} },\n  \tinterpolators:  { writable: true, value: interpolators },\n  \tpartials:       { writable: true, value: {} },\n  \ttransitions:    { writable: true, value: {} }\n  });\n\n  return Ractive;\n\n}));"],"names":["resolver","ReferenceResolver","this","template","callback","resolvers","push","Fragment","prototype","toHtml","toString","escape","items","map","toEscapedString","toString$1","join","unbind","forEach","bound","unrender","shouldDestroy","unrenderAndDestroy$1","rendered","update","dirty","updating","valueOf","length","dirtyValue","values","source","processItems","ractive","_guid","parsed","parseJSON","value","reverse","makeArrayMethod","shift$1","sort","splice$1","teardownHook$1","Hook","unrenderHook$1","unshift$1","updateHook","proto","add","Ractive$add","animate","Ractive$animate","detach","Ractive$detach","find","Ractive$find","findAll","Ractive$findAll","findAllComponents","Ractive$findAllComponents","findComponent","Ractive$findComponent","findContainer","Ractive$findContainer","findParent","Ractive$findParent","fire","Ractive$fire","get","Ractive$get","getNodeInfo","insert","Ractive$insert","link","link$1","merge","Ractive$merge","observe","observeList","observeOnce","off","Ractive$off","on","Ractive$on","once","Ractive$once","pop","pop$1","push$1","render","Ractive$render","reset","Ractive$reset","resetPartial","resetTemplate","Ractive$resetTemplate","set","Ractive$set","shift","splice","subtract","Ractive$subtract","teardown","Ractive$teardown","toggle","Ractive$toggle","toCSS","Ractive$toCSS","toCss","toHTML","Ractive$toHTML","transition","Ractive$transition","unlink","unlink$1","Ractive$unrender","unshift","Ractive$update","updateModel","Ractive$updateModel","FUNCTION","Date","now","String","trim","Object","keys","Array","indexOf","filter","win","addEventListener","Error","extendObj","Ractive","defaults","constructor","defineProperties","DEBUG","writable","DEBUG_PROMISES","extend","escapeKey","staticInfo","joinKeys","parse","splitKeypath","unescapeKey","getCSS","Promise","Promise$1","enhance","svg","magic","magicSupported","VERSION","adaptors","components","decorators","easing","events","interpolators","partials","transitions","node","removeEventListener","handleDomEvent","RadioNameBinding","Binding","SingleSelectBinding","apply","arguments","create","forceUpdate","this$1","getValue","undefined","attribute","locked","runloop","scheduleTask","model","getInitialValue","element","getAttribute","options","len","optionWasSelected","i","option","attributeByName","selected","disabled","_ractive","call","setFromNode","getSelectedOptions","setValue","endsWithSemi","Element","Item","liveQueries","name","e","toLowerCase","isVoid","voidElementNames","test","fragment","parentFragment","owner","type","ELEMENT","parent","attributes","a","Attribute","conditionalAttributes","m","ConditionalAttribute","o","decorator","Decorator","eventHandlers","v","key","eventNames","split","eventName","fn","findInViewHierarchy","event","CustomEvent","DOMEvent","EventDirective","f","noContent","cssIds","binding","bind","createTwowayBinding","shouldBind","twoway","selectBinding","detachNode","selector","matches","query","live","findNextNode","firstNode","rebind","makeDirty$1","target","occupants","namespace","getNamespace","existing","n","nodeName","toUpperCase","namespaceURI","createElement","defineProperty","proxy","setAttribute","x","foundNode","children","toArray","childNodes","wasUndefined","removeAttribute","updateLiveQueries$1","_introTransition","getTransition","t0","t1","appendChild","tagName","attrs","stringifyAttribute","isSelected","inputIsCheckedRadio","style","cls","attr","safeAttributeString","getString","styleName","decamelize","inlineClass","str","escapeHtml","complete","detachWhenReady","t2","id","nodes","removeFromLiveQueries","Form","formBindings","handleReset","Mustache","index","isStatic","s","resolve$2","register","resolve","r","handleChange","bubble","unregister","Interpolator","safeToStringValue","nodeType","nodeValue","doc","createTextNode","insertBefore","string","data","Input","defaultValue","Option","select","findParentSelect","selectedAttribute","optionValue","selectValue","isArray","removeFromArray","Partial","refName","templateObj","getPartialTemplate","named","setTemplate","t","parsePartial","partialTemplate","skipParent","forceResetTemplate","warnOnceIfDebug","RepeatedFragment","context","iterations","indexRef","keyRef","pendingNewIndices","previousIterations","createIteration","isObject","refs","isIteration","joinKey","z","aliases","docFrag","createDocumentFragment","found","iteration","shuffle","newIndices","slice","newIndex","oldIndex","unrenderAndDestroy","updatePostShuffle","toRemove","oldKeys","wasArray","fragment$1","newLength","parentNode","findParentNode","anchor","indices","maxIdx","merged","frag","frag$1","ieBug","ieBlacklist","Section","sectionType","templateSectionType","SECTION_UNLESS","SECTION_IF","SECTION_EACH","isRoot","lastType","getType","newFragment","SECTION_WITH","SECTION_IF_WITH","isEmpty","fragmentShouldExist","Select","selectedOptions","sync","defaultSelected","selectNode","isMultiple","shouldSelect","valueContains","Textarea","isBindable","Text","TEXT","elementCache","innerHTML","err","TABLE","THEAD","TBODY","TR","SELECT","Triple","queryResult","querySelector","queryAllResult","querySelectorAll","j","numNodes","html","insertHtml","decodeCharacterReferences","Yielder","container","component","containerFragment","yielders","_inlinePartials","warnIfDebug","constructors","ALIAS","Alias","DOCTYPE","Doctype","INTERPOLATOR","PARTIAL","SECTION","TRIPLE","YIELDER","specialElements","doctype","form","input","textarea","reference","normalise","splitKeypathI","resolved","addUnresolved","componentParent","attemptResolution","resolveAmbiguousReference","forceResolution","findContext","joinAll","unresolved","removeUnresolved","dirtyArgs","createItems","addFragment","createItem","item","el","findRepeatingFragment","getArgsList","argsList","wasBound","wasRendered","special","specialMatch","substr","dollarMatch","dollarArgsPattern","exec","ref","concat","resolveReference","models","action","args","d","passedArgs","hasOwnProperty","addHelpers","obj","wrapper","oldEvent","original","result","preventDefault","stopPropagation","fireEvent","listen","unlisten","method","RactiveEvent","handler","directive","cancel","teardownHook","Component","ComponentConstructor","COMPONENT","instance","complexMappings","p","content","_partials","root","construct","setupEvents","viewmodel","childData","localKey","initialise","checkYielders","end","makeDirty","mappings","render$1","updateLiveQueries","handlers","_observers","removeFromLiveComponentQueries","__ractive_instances__","_links","k","remove","space","specials$1","float","textTypes","propertyNames","accept-charset","accesskey","bgcolor","class","codebase","colspan","contenteditable","datetime","dirname","for","http-equiv","ismap","maxlength","novalidate","pubdate","readonly","rowspan","tabindex","usemap","booleanAttributes","htmlEntities","quot","amp","apos","lt","gt","nbsp","iexcl","cent","pound","curren","yen","brvbar","sect","uml","copy","ordf","laquo","not","shy","reg","macr","deg","plusmn","sup2","sup3","acute","micro","para","middot","cedil","sup1","ordm","raquo","frac14","frac12","frac34","iquest","Agrave","Aacute","Acirc","Atilde","Auml","Aring","AElig","Ccedil","Egrave","Eacute","Ecirc","Euml","Igrave","Iacute","Icirc","Iuml","ETH","Ntilde","Ograve","Oacute","Ocirc","Otilde","Ouml","times","Oslash","Ugrave","Uacute","Ucirc","Uuml","Yacute","THORN","szlig","agrave","aacute","acirc","atilde","auml","aring","aelig","ccedil","egrave","eacute","ecirc","euml","igrave","iacute","icirc","iuml","eth","ntilde","ograve","oacute","ocirc","otilde","ouml","divide","oslash","ugrave","uacute","ucirc","uuml","yacute","thorn","yuml","OElig","oelig","Scaron","scaron","Yuml","fnof","circ","tilde","Alpha","Beta","Gamma","Delta","Epsilon","Zeta","Eta","Theta","Iota","Kappa","Lambda","Mu","Nu","Xi","Omicron","Pi","Rho","Sigma","Tau","Upsilon","Phi","Chi","Psi","Omega","alpha","beta","gamma","delta","epsilon","zeta","eta","theta","iota","kappa","lambda","mu","nu","xi","omicron","pi","rho","sigmaf","sigma","tau","upsilon","phi","chi","psi","omega","thetasym","upsih","piv","ensp","emsp","thinsp","zwnj","zwj","lrm","rlm","ndash","mdash","lsquo","rsquo","sbquo","ldquo","rdquo","bdquo","dagger","Dagger","bull","hellip","permil","prime","Prime","lsaquo","rsaquo","oline","frasl","euro","image","weierp","real","trade","alefsym","larr","uarr","rarr","darr","harr","crarr","lArr","uArr","rArr","dArr","hArr","forall","part","exist","empty","nabla","isin","notin","ni","prod","sum","minus","lowast","radic","prop","infin","ang","and","or","cap","cup","int","there4","sim","cong","asymp","ne","equiv","le","ge","sub","sup","nsub","sube","supe","oplus","otimes","perp","sdot","lceil","rceil","lfloor","rfloor","lang","rang","loz","spades","clubs","hearts","diams","controlCharacters","entityPattern","RegExp","codePointSupport","fromCodePoint","codeToChar","fromCharCode","lessThan","greaterThan","invalid","updateDelegate","interpolator","namespaces","propertyName","useProperty","isTwoway","isBoolean","lookupNamespace","getUpdateDelegate","getKeypath","div$1","isSvg","svg$1","parseAttributes","notIn","missingDecorator","noop","dynamicName","dynamicArgs","nameFragment","argsFragment","intermediary","warnOnce","missingPlugin","nameChanged","fatal","eventPlugin","prefix","isClient","prefixCache","testStyle","camelCase","capped","charAt","substring","vendors","vendor","visible","prefix$1","hidden","prefix$2","i$1","onChange","onHide","onShow","createTransitions","unprefixPattern","vendorPattern","TRANSITION","TRANSITIONEND","CSS_TRANSITIONS_ENABLED","TRANSITION_DURATION","TRANSITION_PROPERTY","TRANSITION_TIMING_FUNCTION","testStyle$1","linear$1","canUseCssTransitions","cannotUseCssTransitions","webkitTransition","to","changedProperties","setTimeout","checkComplete","jsTransitionsComplete","cssTransitionsComplete","isIntro","transitionEndHandler","unprefix","previous","property","duration","timing","hashPrefix","hyphenate","hash","originalValue","suffix","propertiesToTransitionInJs","getStyle","interpolate","parseFloat","Ticker","step","pos","delay","createTransitions$1","getComputedStyle","legacy","Transition","params","_fn","animateStyle","setStyle","fulfil","computedStyle","current","props","styles","value$1","processParams","start","completed","originalStyle","noReset","resetStyle","_manager","promise","then","twowayBinding","isUnresolved","warnAboutAmbiguity","isReadonly","keypath","replace","parentForm","findParentForm","resetValue","registerTwowayBinding","unregisterTwowayBinding","CheckboxBinding","attachEvent","checked","BindingGroup","bindings","push$2","CheckboxNameBinding","checkboxName","group","getBindingGroup","getValue$1","noInitialValue","existingValue","bindingValue","arrayContains","changed","wasChecked","isChecked","valueSoFar","ContentEditableBinding","lazy","GenericBinding","timeout","isNumeric","handleDelay","handleBlur","MultipleSelectBinding","selectedValues","previousValue","arrayContentsMatch","initialValue","NumericBinding","isNaN","siblings","RadioBinding","getSiblings","getValue$2","nameAttributeBinding","getKeypathModel","originatingModel","Model","has","hasProp","Function","childByKey","child","mark","retrieve","isEqual","old","rewrap","adapt","deps","clearUnresolveds","array","comparator","oldArray","newArray","oldLength","usedIndices","firstUnusedIndex","_merged","notifyUpstream","prev","patternObservers","notify","dep","registerChange","changes","addInstance","registerPatternObserver","observer","unresolvedByKey","ticker","stop","applyValue","indexModels","shuffled","updateKeypathDependants","keypathModels","dependant","unregisterPatternObserver","updateFromBindings","cascade","keypathModel","GlobalModel","global","window","GlobalModel$1","keypathExpr","insertHook","Link","dest","LinkSide","side","comparators","Observer","oldValue","newValue","defer","strict","init","dispatch","addObserver","PatternObserver","baseModel","pattern","baseKeypath","oldValues","newValues","partial","findMatches","newKeys","wildcards","base","max","touchedFrom","ok","ListObserver","pending","sliced","negativeOne","inserted","deleted","hadIndex","onceOptions","arrayProto","PREFIX","styleDefinitions","isDirty","styleElement","useCssText","getElementsByTagName","styleSheet","renderHook","completeHook","adaptConfigurator","Parent","combine","ensureArray","selectorsPattern","commentsPattern","selectorUnitPattern","excludePattern","dataRvcGuidPattern","cssConfigurator","css","uuid","noCssTransform","transformCss","cssId","addCSS","dataConfigurator","combine$1","bind$1","TEMPLATE_VERSION","functions","parseOptions","TEMPLATE_INSTRUCTIONS","COMPUTATION_INSTRUCTIONS","parser","fromId","noThrow","getElementById","textContent","isParsed","getParseOptions","reduce","val","throwNoParse","addFunctions","parseFor","templateConfigurator","parseTemplate","getDynamicTemplate","_config","extendPartials","registryNames","Registry","useDefaults","configure","registry","isOwner","registries","custom","defaultKeys","isStandardKey","makeObj","isBlacklisted","order","config","c","shouldRerender","completeHook$1","resetHook","renderHook$1","unrenderHook","NUMBER_LITERAL","STRING_LITERAL","REFERENCE","ComputationChild","shouldCapture","capture","parentValue","ExpressionProxy","getFunction","computation","match","signature","getter","getterString","compute","ReferenceExpressionChild","ReferenceExpressionProxy","baseResolver","members","resolveAliases","mutatorMethods","patchedArrayProto","methodName","getNewIndices","setting","wrappers","processWrapper","patchArrayMethods","unpatchArrayMethods","__proto__","configurable","unpatch","patch","errorMessage$1","arrayAdaptor","object","wrap","ArrayWrapper","__model","instances","storage","magicAdaptor","MagicWrapper","magicAdaptor$1","originalDescriptors","originalDescriptor","getOwnPropertyDescriptor","childKeypath","descriptor","createOrWrapDescriptor","__magic","revert","dependants","MagicArrayWrapper","magicWrapper","arrayWrapper","magicArrayAdaptor","Computation","isExpression","setter","computationContext","dependencies","boundsSensitive","startCapturing","message","hasConsole","console","groupCollapsed","functionBody","prettify","stack","getterUseStack","truncateStack","error","groupEnd","stopCapturing","setDependencies","model$1","computations","RactiveModel","hasProp$1","RootModel","applyChanges","_changeHash","flush","extendChildren","getRactiveModel","ractiveModel","getValueChildren","origin","shouldTeardown","constructHook","registryNames$1","uid","HookQueue","hook","inProcess","queue","begin","getChildQueue","Parser","ParseError","configHook","initHook","leadingWhitespace","lineStart","lines","lineEnds","line","lineEnd","read","leftover","remaining","postProcess","converters","getLinePos","char","columnNum","lineNum","numTabs","annotation","character","shortMessage","matchString","matchPattern","allowWhitespace","nextChar","Child","hasOwn","stringMiddlePattern","escapeSequencePattern","lineContinuationPattern","Parser$1","getSingleQuotedString","makeQuotedStringMatcher","getDoubleQuotedString","numberPattern$1","identifier","specials","true","false","null","specialsPattern","numberPattern","placeholderPattern","placeholderAtStartPattern","onlyWhitespace","JsonParser","placeholder","number","stringLiteral","readStringLiteral","$1","pair","getKeyValuePair","valueToken","specialPattern","_liveComponentQueries","hyphenatedStr","readStyle","rule","rules","readClass","list","updateId","updateMultipleSelectValue","updateSelectValue","updateStringValue","updateContentEditableValue","updateRadioValue","updateValue","updateRadioName","updateCheckboxName","updateStyleAttribute","updateInlineStyle","updateInlineClass","updateBoolean","updateNamespacedAttribute","updateAttribute","updateClassName","selectedIndex","valueAttribute","camelize","className","idx","setAttributeNS","entity","code","parseInt","validateCode","qualified","hasAttribute","haystack","needle","_liveQueries","description","all","b","res","clearTimeout","bindName","bindChecked","transitionsEnabled","getTransitionName","getTransitionParams","registerTransition","typeAttribute","nameAttribute","xmlns","updateModel$1","getPartialFromRegistry","fillGaps","findParentPartial","findInstance","noRegistryFunctionReturn","findOwner","findConstructor","_Parent","hasIndexRef","selectedOption","firstChild","getComponentConstructor","ElementConstructor","guid","counter","placeholderId","set$1","TypeError","badArguments","uniqueCssIds","ids","HTMLElement","here","ln","intialValue","wrap$1","superMethod","force","needsSuper","hasSuper","_super","unwrap","addRegistries","addOtherOptions","addRegistry","_method","extendOne","computed","append","delimiters","tripleDelimiters","staticDelimiters","staticTripleDelimiters","csp","preserveWhitespace","sanitize","stripComments","modifyArrays","isolated","noIntro","linear","easeIn","Math","pow","easeOut","easeInOut","document","navigator","appName","warn","div","methodNames","unprefixed","prefixed","makeFunction","implementation","hasFeature","mathml","xlink","xml","ns","createElementNS","cloneNode","camel","decamel","desc","F","log","printWarning","welcome","alreadyWarned","welcomeIntro","welcomeMessage","hasGroup","from","intermediate","min","properties","snap","refPattern","splitPattern","escapeKeyPattern","unescapeKeyPattern","errorMessage","deprecations","deprecated","replacement","deprecate","arg","_Promise","PENDING","FULFILLED","REJECTED","dispatchHandlers","makeResolver","reject","fulfilledHandlers","rejectedHandlers","state","newState","makeDispatcher","wait","onFulfilled","onRejected","promise2","processResolutionHandler","forward","p1result","promises","processPromise","reason","TransitionManager","intros","outros","totalChildren","outroChildren","detachQueue","outrosComplete","addChild","decrementOutros","check","decrementTotal","detachNodes","_detachNodes","detachImmediate","ready","batch","changeHook","returnPromise","fulfilPromise","previousBatch","transitionManager","fragments","tasks","immediateObservers","deferredObservers","ractives","flushChanges","addToArray","thing","task","postRender","_batch","noAnimation","detachHook","Query","isComponentQuery","_root","nodeOrComponent","sortByItemPosition","sortByDocumentPosition","captureGroup","requestAnimationFrame","starMaps","wildcardCache","lastTime","currTime","timeToCall","rAF","getTime","performance","tickers","running","tick","elapsed","eased","abort","prefixers","KeyModel","KeypathModel","removeChild","createBranch","adaptor","getPrefixer","previousOriginatingModel","specificKey","hasKey","branch","existingMatches","loop","getIndexModel","fragmentIndex","getKeyModel","mapped","factory","exports","module","define","amd","next","noConflict","getElement","output","sources","isFinite","format","logIfDebug","registryName","interpol","lastItem","member","arrayLike","called","resolvePromise","rejectPromise","y","tm","manager","trans","collectAllOutros","contains","which","ractive$1","getOptions","isDetached","otherNode","compareDocumentPosition","bitmask","mutualAncestor","ancestryA","getAncestry","ancestryB","oldestA","oldestB","fragmentA","fragmentB","indexA","indexB","indexA$1","indexB$1","getParent","ancestry","ancestor","enqueue","_eventQueue","dequeue","getPotentialWildcardMatches","starMap","mapper","wildcardKeypath","getStarMap","star","num","binary","l","ones","digit","_noArg","getWildcardNames","fireEventAs","initialFire","subscribers","_subs","notifySubscribers","fullName","originalEvent","stopEvent","badReference","hasContextChain","crossedComponentBoundary","localViewmodel","prefixKeypath","rootKeypath","rootDot","relativeKeypath","match$1","repeater","parts","gatherRefs","_element","resolve$1","path","add$1","drop","update$1","isBound","getBindingPath","getBinding","setBinding","rootpath","fireInsertHook","there","sourcePath","getComparator","JSON","stringify","compare","observers","createObserver","keypaths","wildcardIndex","notEmptyString","listeners","listener","spliceArguments","removeStart","removeEnd","balance","getSpliceEquivalent","result$1","styleDefinition","applyCSS","cssText","filteredStyleDefinitions","others","trim$1","extractString","unit","transformSelector","selectorUnits","modifiers","transformed","appended","prepended","dataAttr","selectors","s4","floor","random","validate","childValue","parentIsFn","childIsFn","callDataFunction","fromProperties","primary","secondary","fromExpression","body","fromComputationString","bindTo","hasThis","createFunction","exp","instructions","createFunctionFromString","initial","parseAsString","validate$1","existingPartials","newPartials","overwrite","getSuperMethod","_parent","oldSuper","getMessage","correct","isError","deprecateOption","deprecatedOption","extendOtherMethods","rerender","collect","collection","rx","section","enumerable","fnBody","tabs","minIndent","Infinity","truncated","getComputationSignature","setterString","initialiseProperties","deprecateRactiveData","getAdaptors","combine$2","protoAdapt","lookup","hookQueue","childQueue","userOptions","okQuote","literal","done","charCodeAt","readNumberLiteral","readKey","token"],"mappings":"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C,OAAQ,IAAKC,KAAM,IAAKC,KAAM,IAAKC,KAAM,IAAKC,MAAO,IAAKC,MAAO,IAAKC,KAAM,IAAKC,MAAO,IAAKC,MAAO,IAAKC,QAAS,IAAKC,KAAM,IAAKC,IAAK,IAAKC,MAAO,IAAKC,KAAM,IAAKC,MAAO,IAAKC,OAAQ,IAAKC,GAAI,IAAKC,GAAI,IAAKC,GAAI,IAAKC,QAAS,IAAKC,GAAI,IAAKC,IAAK,IAAKC,MAAO,IAAKC,IAAK,IAAKC,QAAS,IAAKC,IAAK,IAAKC,IAAK,IAAKC,IAAK,IAAKC,MAAO,IAAKC,MAAO,IAAKC,KAAM,IAAKC,MAAO,IAAKC,MAAO,IAAKC,QAAS,IAAKC,KAAM,IAAKC,IAAK,IAAKC,MAAO,IAAKC,KAAM,IAAKC,MAAO,IAAKC,OAAQ,IAAKC,GAAI,IAAKC,GAAI,IAAKC,GAAI,IAAKC,QAAS,IAAKC,GAAI,IAAKC,IAAK,IAAKC,OAAQ,IAAKC,MAAO,IAAKC,IAAK,IAAKC,QAAS,IAAKC,IAAK,IAAKC,IAAK,IAAKC,IAAK,IAAKC,MAAO,IAAKC,SAAU,IAAKC,MAAO,IAAKC,IAAK,IAAKC,KAAM,KAAMC,KAAM,KAAMC,OAAQ,KAAMC,KAAM,KAAMC,IAAK,KAAMC,IAAK,KAAMC,IAAK,KAAMC,MAAO,KAAMC,MAAO,KAAMC,MAAO,KAAMC,MAAO,KAAMC,MAAO,KAAMC,MAAO,KAAMC,MAAO,KAAMC,MAAO,KAAMC,OAAQ,KAAMC,OAAQ,KAAMC,KAAM,KAAMC,OAAQ,KAAMC,OAAQ,KAAMC,MAAO,KAAMC,MAAO,KAAMC,OAAQ,KAAMC,OAAQ,KAAMC,MAAO,KAAMC,MAAO,KAAMC,KAAM,KAAMC,MAAO,KAAMC,OAAQ,KAAMC,KAAM,KAAMC,MAAO,KAAMC,QAAS,KAAMC,KAAM,KAAMC,KAAM,KAAMC,KAAM,KAAMC,KAAM,KAAMC,KAAM,KAAMC,MAAO,KAAMC,KAAM,KAAMC,KAAM,KAAMC,KAAM,KAAMC,KAAM,KAAMC,KAAM,KAAMC,OAAQ,KAAMC,KAAM,KAAMC,MAAO,KAAMC,MAAO,KAAMC,MAAO,KAAMC,KAAM,KAAMC,MAAO,KAAMC,GAAI,KAAMC,KAAM,KAAMC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"}