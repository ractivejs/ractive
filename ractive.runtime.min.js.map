{"version":3,"file":"ractive.runtime.min.js","sources":["ractive.runtime.js"],"sourcesContent":["/*\n\tRactive.js v0.8.0-edge\n\tFri Oct 09 2015 01:17:13 GMT+0000 (UTC) - commit cdb5c621ac612d0e6d079f43bd333c1d39f9d076\n\n\thttp://ractivejs.org\n\thttp://twitter.com/RactiveJS\n\n\tReleased under the MIT License.\n*/\n\n\n(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n  typeof define === 'function' && define.amd ? define(factory) :\n  global.Ractive = factory();\n}(this, function () { 'use strict';\n\n  var namespaces = {\n    get html () { return _html; },\n    get mathml () { return mathml; },\n    get svg () { return svg; },\n    get xlink () { return xlink; },\n    get xml () { return xml; },\n    get xmlns () { return xmlns; }\n  };\n\n  /*global console, navigator */\n\n  var win = typeof window !== 'undefined' ? window : null;\n  var doc = win ? document : null;\n\n  var isClient = !!doc;\n  var hasConsole = typeof console !== 'undefined' && typeof console.warn === 'function' && typeof console.warn.apply === 'function';\n\n  var magic = undefined;\n  try {\n  \tObject.defineProperty({}, 'test', { value: 0 });\n  \tmagic = true;\n  } catch (e) {\n  \tmagic = false;\n  }\n\n  var _svg = doc ? doc.implementation.hasFeature('http://www.w3.org/TR/SVG11/feature#BasicStructure', '1.1') : false;\n\n  var vendors = ['o', 'ms', 'moz', 'webkit'];\n\n  var _defaults = {\n  \t// render placement:\n  \tel: void 0,\n  \tappend: false,\n\n  \t// template:\n  \ttemplate: null,\n\n  \t// parse:     // TODO static delimiters?\n  \tpreserveWhitespace: false,\n  \tsanitize: false,\n  \tstripComments: true,\n  \tdelimiters: ['{{', '}}'],\n  \ttripleDelimiters: ['{{{', '}}}'],\n  \tinterpolate: false,\n\n  \t// data & binding:\n  \tdata: {},\n  \tcomputed: {},\n  \tmagic: false,\n  \tmodifyArrays: true,\n  \tadapt: [],\n  \tisolated: false,\n  \ttwoway: true,\n  \tlazy: false,\n\n  \t// transitions:\n  \tnoIntro: false,\n  \ttransitionsEnabled: true,\n  \tcomplete: void 0,\n\n  \t// css:\n  \tcss: null,\n  \tnoCssTransform: false\n  };\n\n  function noop () {}\n\n  var alreadyWarned = {};\n  var log;\n  var printWarning;\n  var welcome;\n  if (hasConsole) {\n  \t(function () {\n  \t\tvar welcomeIntro = ['%cRactive.js %c0.8.0-edge %cin debug mode, %cmore...', 'color: rgb(114, 157, 52); font-weight: normal;', 'color: rgb(85, 85, 85); font-weight: normal;', 'color: rgb(85, 85, 85); font-weight: normal;', 'color: rgb(82, 140, 224); font-weight: normal; text-decoration: underline;'];\n  \t\tvar welcomeMessage = 'You\\'re running Ractive 0.8.0-edge in debug mode - messages will be printed to the console to help you fix problems and optimise your application.\\n\\nTo disable debug mode, add this line at the start of your app:\\n  Ractive.DEBUG = false;\\n\\nTo disable debug mode when your app is minified, add this snippet:\\n  Ractive.DEBUG = /unminified/.test(function(){/*unminified*/});\\n\\nGet help and support:\\n  http://docs.ractivejs.org\\n  http://stackoverflow.com/questions/tagged/ractivejs\\n  http://groups.google.com/forum/#!forum/ractive-js\\n  http://twitter.com/ractivejs\\n\\nFound a bug? Raise an issue:\\n  https://github.com/ractivejs/ractive/issues\\n\\n';\n\n  \t\twelcome = function () {\n  \t\t\tvar hasGroup = !!console.groupCollapsed;\n  \t\t\tconsole[hasGroup ? 'groupCollapsed' : 'log'].apply(console, welcomeIntro);\n  \t\t\tconsole.log(welcomeMessage);\n  \t\t\tif (hasGroup) {\n  \t\t\t\tconsole.groupEnd(welcomeIntro);\n  \t\t\t}\n\n  \t\t\twelcome = noop;\n  \t\t};\n\n  \t\tprintWarning = function (message, args) {\n  \t\t\twelcome();\n\n  \t\t\t// extract information about the instance this message pertains to, if applicable\n  \t\t\tif (typeof args[args.length - 1] === 'object') {\n  \t\t\t\tvar options = args.pop();\n  \t\t\t\tvar ractive = options ? options.ractive : null;\n\n  \t\t\t\tif (ractive) {\n  \t\t\t\t\t// if this is an instance of a component that we know the name of, add\n  \t\t\t\t\t// it to the message\n  \t\t\t\t\tvar _name = undefined;\n  \t\t\t\t\tif (ractive.component && (_name = ractive.component.name)) {\n  \t\t\t\t\t\tmessage = '<' + _name + '> ' + message;\n  \t\t\t\t\t}\n\n  \t\t\t\t\tvar node = undefined;\n  \t\t\t\t\tif (node = options.node || ractive.fragment && ractive.fragment.rendered && ractive.find('*')) {\n  \t\t\t\t\t\targs.push(node);\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\tconsole.warn.apply(console, ['%cRactive.js: %c' + message, 'color: rgb(114, 157, 52);', 'color: rgb(85, 85, 85);'].concat(args));\n  \t\t};\n\n  \t\tlog = function () {\n  \t\t\tconsole.log.apply(console, arguments);\n  \t\t};\n  \t})();\n  } else {\n  \tprintWarning = log = welcome = noop;\n  }\n\n  function format(message, args) {\n  \treturn message.replace(/%s/g, function () {\n  \t\treturn args.shift();\n  \t});\n  }\n\n  function fatal(message) {\n  \tfor (var _len = arguments.length, args = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n  \t\targs[_key - 1] = arguments[_key];\n  \t}\n\n  \tmessage = format(message, args);\n  \tthrow new Error(message);\n  }\n\n  function logIfDebug() {\n  \tif (Ractive.DEBUG) {\n  \t\tlog.apply(null, arguments);\n  \t}\n  }\n\n  function warn(message) {\n  \tfor (var _len2 = arguments.length, args = Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {\n  \t\targs[_key2 - 1] = arguments[_key2];\n  \t}\n\n  \tmessage = format(message, args);\n  \tprintWarning(message, args);\n  }\n\n  function warnOnce(message) {\n  \tfor (var _len3 = arguments.length, args = Array(_len3 > 1 ? _len3 - 1 : 0), _key3 = 1; _key3 < _len3; _key3++) {\n  \t\targs[_key3 - 1] = arguments[_key3];\n  \t}\n\n  \tmessage = format(message, args);\n\n  \tif (alreadyWarned[message]) {\n  \t\treturn;\n  \t}\n\n  \talreadyWarned[message] = true;\n  \tprintWarning(message, args);\n  }\n\n  function warnIfDebug() {\n  \tif (Ractive.DEBUG) {\n  \t\twarn.apply(null, arguments);\n  \t}\n  }\n\n  function warnOnceIfDebug() {\n  \tif (Ractive.DEBUG) {\n  \t\twarnOnce.apply(null, arguments);\n  \t}\n  }\n\nvar inherits = function (subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass);\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      enumerable: false,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n};\n\nvar classCallCheck = function (instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n};\n\n  // TODO: deprecate in future release\n  var deprecations = {\n  \tconstruct: {\n  \t\tdeprecated: 'beforeInit',\n  \t\treplacement: 'onconstruct'\n  \t},\n  \trender: {\n  \t\tdeprecated: 'init',\n  \t\tmessage: 'The \"init\" method has been deprecated ' + 'and will likely be removed in a future release. ' + 'You can either use the \"oninit\" method which will fire ' + 'only once prior to, and regardless of, any eventual ractive ' + 'instance being rendered, or if you need to access the ' + 'rendered DOM, use \"onrender\" instead. ' + 'See http://docs.ractivejs.org/latest/migrating for more information.'\n  \t},\n  \tcomplete: {\n  \t\tdeprecated: 'complete',\n  \t\treplacement: 'oncomplete'\n  \t}\n  };\n\n  var Hook = (function () {\n  \tfunction Hook(event) {\n  \t\tclassCallCheck(this, Hook);\n\n  \t\tthis.event = event;\n  \t\tthis.method = 'on' + event;\n  \t\tthis.deprecate = deprecations[event];\n  \t}\n\n  \tHook.prototype.call = function call(method, ractive, arg) {\n  \t\tif (ractive[method]) {\n  \t\t\targ ? ractive[method](arg) : ractive[method]();\n  \t\t\treturn true;\n  \t\t}\n  \t};\n\n  \tHook.prototype.fire = function fire(ractive, arg) {\n  \t\tthis.call(this.method, ractive, arg);\n\n  \t\t// handle deprecations\n  \t\tif (!ractive[this.method] && this.deprecate && this.call(this.deprecate.deprecated, ractive, arg)) {\n  \t\t\tif (this.deprecate.message) {\n  \t\t\t\twarnIfDebug(this.deprecate.message);\n  \t\t\t} else {\n  \t\t\t\twarnIfDebug('The method \"%s\" has been deprecated in favor of \"%s\" and will likely be removed in a future release. See http://docs.ractivejs.org/latest/migrating for more information.', this.deprecate.deprecated, this.deprecate.replacement);\n  \t\t\t}\n  \t\t}\n\n  \t\t// TODO should probably use internal method, in case ractive.fire was overwritten\n  \t\targ ? ractive.fire(this.event, arg) : ractive.fire(this.event);\n  \t};\n\n  \treturn Hook;\n  })();\n\n  var __toString = Object.prototype.toString;\n  // thanks, http://perfectionkills.com/instanceof-considered-harmful-or-how-to-write-a-robust-isarray/\n\n  function isArray(thing) {\n  \treturn __toString.call(thing) === '[object Array]';\n  }\n\n  function isEqual(a, b) {\n  \tif (a === null && b === null) {\n  \t\treturn true;\n  \t}\n\n  \tif (typeof a === 'object' || typeof b === 'object') {\n  \t\treturn false;\n  \t}\n\n  \treturn a === b;\n  }\n\n  // http://stackoverflow.com/questions/18082/validate-numbers-in-javascript-isnumeric\n\n  function isNumeric(thing) {\n  \treturn !isNaN(parseFloat(thing)) && isFinite(thing);\n  }\n\n  function isObject(thing) {\n  \treturn thing && __toString.call(thing) === '[object Object]';\n  }\n\n  function addToArray(array, value) {\n  \tvar index = array.indexOf(value);\n\n  \tif (index === -1) {\n  \t\tarray.push(value);\n  \t}\n  }\n\n  function arrayContains(array, value) {\n  \tfor (var i = 0, c = array.length; i < c; i++) {\n  \t\tif (array[i] == value) {\n  \t\t\treturn true;\n  \t\t}\n  \t}\n\n  \treturn false;\n  }\n\n  function arrayContentsMatch(a, b) {\n  \tvar i;\n\n  \tif (!isArray(a) || !isArray(b)) {\n  \t\treturn false;\n  \t}\n\n  \tif (a.length !== b.length) {\n  \t\treturn false;\n  \t}\n\n  \ti = a.length;\n  \twhile (i--) {\n  \t\tif (a[i] !== b[i]) {\n  \t\t\treturn false;\n  \t\t}\n  \t}\n\n  \treturn true;\n  }\n\n  function ensureArray(x) {\n  \tif (typeof x === 'string') {\n  \t\treturn [x];\n  \t}\n\n  \tif (x === undefined) {\n  \t\treturn [];\n  \t}\n\n  \treturn x;\n  }\n\n  function lastItem(array) {\n  \treturn array[array.length - 1];\n  }\n\n  function removeFromArray(array, member) {\n  \tif (!array) {\n  \t\treturn;\n  \t}\n\n  \tvar index = array.indexOf(member);\n\n  \tif (index !== -1) {\n  \t\tarray.splice(index, 1);\n  \t}\n  }\n\n  function toArray(arrayLike) {\n  \tvar array = [],\n  \t    i = arrayLike.length;\n  \twhile (i--) {\n  \t\tarray[i] = arrayLike[i];\n  \t}\n\n  \treturn array;\n  }\n\n  function __bind(x) {\n    x.bind();\n  }\n\n  function _cancel(x) {\n    x.cancel();\n  }\n\n  function _handleChange(x) {\n    x.handleChange();\n  }\n\n  function _mark(x) {\n    x.mark();\n  }\n\n  function __render(x) {\n    x.render();\n  }\n\n  function _rebind(x) {\n    x.rebind();\n  }\n\n  function _teardown(x) {\n    x.teardown();\n  }\n\n  function _unbind(x) {\n    x.unbind();\n  }\n\n  function _unrender(x) {\n    x.unrender();\n  }\n\n  function _unrenderAndDestroy(x) {\n    x.unrender(true);\n  }\n\n  function __update(x) {\n    x.update();\n  }\n\n  function _toString(x) {\n    return x.toString();\n  }\n\n  function toEscapedString(x) {\n    return x.toString(true);\n  }\n\n  var TransitionManager = (function () {\n  \tfunction TransitionManager(callback, parent) {\n  \t\tclassCallCheck(this, TransitionManager);\n\n  \t\tthis.callback = callback;\n  \t\tthis.parent = parent;\n\n  \t\tthis.intros = [];\n  \t\tthis.outros = [];\n\n  \t\tthis.children = [];\n  \t\tthis.totalChildren = this.outroChildren = 0;\n\n  \t\tthis.detachQueue = [];\n  \t\tthis.decoratorQueue = [];\n  \t\tthis.outrosComplete = false;\n\n  \t\tif (parent) {\n  \t\t\tparent.addChild(this);\n  \t\t}\n  \t}\n\n  \tTransitionManager.prototype.add = function add(transition) {\n  \t\tvar list = transition.isIntro ? this.intros : this.outros;\n  \t\tlist.push(transition);\n  \t};\n\n  \tTransitionManager.prototype.addChild = function addChild(child) {\n  \t\tthis.children.push(child);\n\n  \t\tthis.totalChildren += 1;\n  \t\tthis.outroChildren += 1;\n  \t};\n\n  \t// TODO can we move decorator stuff to element detach() methods?\n\n  \tTransitionManager.prototype.addDecorator = function addDecorator(decorator) {\n  \t\tthis.decoratorQueue.push(decorator);\n  \t};\n\n  \tTransitionManager.prototype.decrementOutros = function decrementOutros() {\n  \t\tthis.outroChildren -= 1;\n  \t\tcheck(this);\n  \t};\n\n  \tTransitionManager.prototype.decrementTotal = function decrementTotal() {\n  \t\tthis.totalChildren -= 1;\n  \t\tcheck(this);\n  \t};\n\n  \tTransitionManager.prototype.detachNodes = function detachNodes() {\n  \t\tthis.decoratorQueue.forEach(_teardown);\n  \t\tthis.detachQueue.forEach(_detach);\n  \t\tthis.children.forEach(_detachNodes);\n  \t};\n\n  \tTransitionManager.prototype.init = function init() {\n  \t\tthis.ready = true;\n  \t\tcheck(this);\n  \t};\n\n  \tTransitionManager.prototype.remove = function remove(transition) {\n  \t\tvar list = transition.isIntro ? this.intros : this.outros;\n  \t\tremoveFromArray(list, transition);\n  \t\tcheck(this);\n  \t};\n\n  \tTransitionManager.prototype.start = function start() {\n  \t\tthis.intros.concat(this.outros).forEach(function (t) {\n  \t\t\treturn t.start();\n  \t\t});\n  \t};\n\n  \treturn TransitionManager;\n  })();\n\n  function _detach(element) {\n  \telement.detach();\n  }\n\n  function _detachNodes(tm) {\n  \t// _ to avoid transpiler quirk\n  \ttm.detachNodes();\n  }\n\n  function check(tm) {\n  \tif (!tm.ready || tm.outros.length || tm.outroChildren) return;\n\n  \t// If all outros are complete, and we haven't already done this,\n  \t// we notify the parent if there is one, otherwise\n  \t// start detaching nodes\n  \tif (!tm.outrosComplete) {\n  \t\tif (tm.parent) {\n  \t\t\ttm.parent.decrementOutros(tm);\n  \t\t} else {\n  \t\t\ttm.detachNodes();\n  \t\t}\n\n  \t\ttm.outrosComplete = true;\n  \t}\n\n  \t// Once everything is done, we can notify parent transition\n  \t// manager and call the callback\n  \tif (!tm.intros.length && !tm.totalChildren) {\n  \t\tif (typeof tm.callback === 'function') {\n  \t\t\ttm.callback();\n  \t\t}\n\n  \t\tif (tm.parent) {\n  \t\t\ttm.parent.decrementTotal();\n  \t\t}\n  \t}\n  }\n\n  var _Promise;\n  var PENDING = {};\n  var FULFILLED = {};\n  var REJECTED = {};\n  if (typeof Promise === 'function') {\n  \t// use native Promise\n  \t_Promise = Promise;\n  } else {\n  \t_Promise = function (callback) {\n  \t\tvar fulfilledHandlers = [],\n  \t\t    rejectedHandlers = [],\n  \t\t    state = PENDING,\n  \t\t    result,\n  \t\t    dispatchHandlers,\n  \t\t    makeResolver,\n  \t\t    fulfil,\n  \t\t    reject,\n  \t\t    promise;\n\n  \t\tmakeResolver = function (newState) {\n  \t\t\treturn function (value) {\n  \t\t\t\tif (state !== PENDING) {\n  \t\t\t\t\treturn;\n  \t\t\t\t}\n\n  \t\t\t\tresult = value;\n  \t\t\t\tstate = newState;\n\n  \t\t\t\tdispatchHandlers = makeDispatcher(state === FULFILLED ? fulfilledHandlers : rejectedHandlers, result);\n\n  \t\t\t\t// dispatch onFulfilled and onRejected handlers asynchronously\n  \t\t\t\twait(dispatchHandlers);\n  \t\t\t};\n  \t\t};\n\n  \t\tfulfil = makeResolver(FULFILLED);\n  \t\treject = makeResolver(REJECTED);\n\n  \t\ttry {\n  \t\t\tcallback(fulfil, reject);\n  \t\t} catch (err) {\n  \t\t\treject(err);\n  \t\t}\n\n  \t\tpromise = {\n  \t\t\t// `then()` returns a Promise - 2.2.7\n  \t\t\tthen: function (onFulfilled, onRejected) {\n  \t\t\t\tvar promise2 = new _Promise(function (fulfil, reject) {\n\n  \t\t\t\t\tvar processResolutionHandler = function (handler, handlers, forward) {\n\n  \t\t\t\t\t\t// 2.2.1.1\n  \t\t\t\t\t\tif (typeof handler === 'function') {\n  \t\t\t\t\t\t\thandlers.push(function (p1result) {\n  \t\t\t\t\t\t\t\tvar x;\n\n  \t\t\t\t\t\t\t\ttry {\n  \t\t\t\t\t\t\t\t\tx = handler(p1result);\n  \t\t\t\t\t\t\t\t\t__resolve(promise2, x, fulfil, reject);\n  \t\t\t\t\t\t\t\t} catch (err) {\n  \t\t\t\t\t\t\t\t\treject(err);\n  \t\t\t\t\t\t\t\t}\n  \t\t\t\t\t\t\t});\n  \t\t\t\t\t\t} else {\n  \t\t\t\t\t\t\t// Forward the result of promise1 to promise2, if resolution handlers\n  \t\t\t\t\t\t\t// are not given\n  \t\t\t\t\t\t\thandlers.push(forward);\n  \t\t\t\t\t\t}\n  \t\t\t\t\t};\n\n  \t\t\t\t\t// 2.2\n  \t\t\t\t\tprocessResolutionHandler(onFulfilled, fulfilledHandlers, fulfil);\n  \t\t\t\t\tprocessResolutionHandler(onRejected, rejectedHandlers, reject);\n\n  \t\t\t\t\tif (state !== PENDING) {\n  \t\t\t\t\t\t// If the promise has resolved already, dispatch the appropriate handlers asynchronously\n  \t\t\t\t\t\twait(dispatchHandlers);\n  \t\t\t\t\t}\n  \t\t\t\t});\n\n  \t\t\t\treturn promise2;\n  \t\t\t}\n  \t\t};\n\n  \t\tpromise['catch'] = function (onRejected) {\n  \t\t\treturn this.then(null, onRejected);\n  \t\t};\n\n  \t\treturn promise;\n  \t};\n\n  \t_Promise.all = function (promises) {\n  \t\treturn new _Promise(function (fulfil, reject) {\n  \t\t\tvar result = [],\n  \t\t\t    pending,\n  \t\t\t    i,\n  \t\t\t    processPromise;\n\n  \t\t\tif (!promises.length) {\n  \t\t\t\tfulfil(result);\n  \t\t\t\treturn;\n  \t\t\t}\n\n  \t\t\tprocessPromise = function (promise, i) {\n  \t\t\t\tif (promise && typeof promise.then === 'function') {\n  \t\t\t\t\tpromise.then(function (value) {\n  \t\t\t\t\t\tresult[i] = value;\n  \t\t\t\t\t\t--pending || fulfil(result);\n  \t\t\t\t\t}, reject);\n  \t\t\t\t} else {\n  \t\t\t\t\tresult[i] = promise;\n  \t\t\t\t\t--pending || fulfil(result);\n  \t\t\t\t}\n  \t\t\t};\n\n  \t\t\tpending = i = promises.length;\n  \t\t\twhile (i--) {\n  \t\t\t\tprocessPromise(promises[i], i);\n  \t\t\t}\n  \t\t});\n  \t};\n\n  \t_Promise.resolve = function (value) {\n  \t\treturn new _Promise(function (fulfil) {\n  \t\t\tfulfil(value);\n  \t\t});\n  \t};\n\n  \t_Promise.reject = function (reason) {\n  \t\treturn new _Promise(function (fulfil, reject) {\n  \t\t\treject(reason);\n  \t\t});\n  \t};\n  }\n\n  // TODO use MutationObservers or something to simulate setImmediate\n  function wait(callback) {\n  \tsetTimeout(callback, 0);\n  }\n\n  function makeDispatcher(handlers, result) {\n  \treturn function () {\n  \t\tvar handler;\n\n  \t\twhile (handler = handlers.shift()) {\n  \t\t\thandler(result);\n  \t\t}\n  \t};\n  }\n\n  function __resolve(promise, x, fulfil, reject) {\n  \t// Promise Resolution Procedure\n  \tvar then;\n\n  \t// 2.3.1\n  \tif (x === promise) {\n  \t\tthrow new TypeError('A promise\\'s fulfillment handler cannot return the same promise');\n  \t}\n\n  \t// 2.3.2\n  \tif (x instanceof _Promise) {\n  \t\tx.then(fulfil, reject);\n  \t}\n\n  \t// 2.3.3\n  \telse if (x && (typeof x === 'object' || typeof x === 'function')) {\n  \t\t\ttry {\n  \t\t\t\tthen = x.then; // 2.3.3.1\n  \t\t\t} catch (e) {\n  \t\t\t\treject(e); // 2.3.3.2\n  \t\t\t\treturn;\n  \t\t\t}\n\n  \t\t\t// 2.3.3.3\n  \t\t\tif (typeof then === 'function') {\n  \t\t\t\tvar called, resolvePromise, rejectPromise;\n\n  \t\t\t\tresolvePromise = function (y) {\n  \t\t\t\t\tif (called) {\n  \t\t\t\t\t\treturn;\n  \t\t\t\t\t}\n  \t\t\t\t\tcalled = true;\n  \t\t\t\t\t__resolve(promise, y, fulfil, reject);\n  \t\t\t\t};\n\n  \t\t\t\trejectPromise = function (r) {\n  \t\t\t\t\tif (called) {\n  \t\t\t\t\t\treturn;\n  \t\t\t\t\t}\n  \t\t\t\t\tcalled = true;\n  \t\t\t\t\treject(r);\n  \t\t\t\t};\n\n  \t\t\t\ttry {\n  \t\t\t\t\tthen.call(x, resolvePromise, rejectPromise);\n  \t\t\t\t} catch (e) {\n  \t\t\t\t\tif (!called) {\n  \t\t\t\t\t\t// 2.3.3.3.4.1\n  \t\t\t\t\t\treject(e); // 2.3.3.3.4.2\n  \t\t\t\t\t\tcalled = true;\n  \t\t\t\t\t\treturn;\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t\t} else {\n  \t\t\t\tfulfil(x);\n  \t\t\t}\n  \t\t} else {\n  \t\t\tfulfil(x);\n  \t\t}\n  }\n\n  var changeHook = new Hook('change');\n\n  var batch = undefined;\n\n  var runloop = {\n  \tstart: function (instance, returnPromise) {\n  \t\tvar promise, fulfilPromise;\n\n  \t\tif (returnPromise) {\n  \t\t\tpromise = new _Promise(function (f) {\n  \t\t\t\treturn fulfilPromise = f;\n  \t\t\t});\n  \t\t}\n\n  \t\tbatch = {\n  \t\t\tpreviousBatch: batch,\n  \t\t\ttransitionManager: new TransitionManager(fulfilPromise, batch && batch.transitionManager),\n  \t\t\tfragments: [],\n  \t\t\ttasks: [],\n  \t\t\timmediateObservers: [],\n  \t\t\tdeferredObservers: [],\n  \t\t\tinstance: instance\n  \t\t};\n\n  \t\treturn promise;\n  \t},\n\n  \tend: function () {\n  \t\tflushChanges();\n\n  \t\tbatch.transitionManager.init();\n  \t\tbatch = batch.previousBatch;\n  \t},\n\n  \taddFragment: function (fragment) {\n  \t\taddToArray(batch.fragments, fragment);\n  \t},\n\n  \taddObserver: function (observer, defer) {\n  \t\taddToArray(defer ? batch.deferredObservers : batch.immediateObservers, observer);\n  \t},\n\n  \tregisterTransition: function (transition) {\n  \t\ttransition._manager = batch.transitionManager;\n  \t\tbatch.transitionManager.add(transition);\n  \t},\n\n  \tregisterDecorator: function (decorator) {\n  \t\tbatch.transitionManager.addDecorator(decorator);\n  \t},\n\n  \t// synchronise node detachments with transition ends\n  \tdetachWhenReady: function (thing) {\n  \t\tbatch.transitionManager.detachQueue.push(thing);\n  \t},\n\n  \tscheduleTask: function (task, postRender) {\n  \t\tvar _batch;\n\n  \t\tif (!batch) {\n  \t\t\ttask();\n  \t\t} else {\n  \t\t\t_batch = batch;\n  \t\t\twhile (postRender && _batch.previousBatch) {\n  \t\t\t\t// this can't happen until the DOM has been fully updated\n  \t\t\t\t// otherwise in some situations (with components inside elements)\n  \t\t\t\t// transitions and decorators will initialise prematurely\n  \t\t\t\t_batch = _batch.previousBatch;\n  \t\t\t}\n\n  \t\t\t_batch.tasks.push(task);\n  \t\t}\n  \t}\n  };\n\n  function _dispatch(observer) {\n  \tobserver.dispatch();\n  }\n\n  function flushChanges() {\n  \tbatch.immediateObservers.forEach(_dispatch);\n\n  \t// Now that changes have been fully propagated, we can update the DOM\n  \t// and complete other tasks\n  \tvar i = batch.fragments.length;\n  \tvar fragment = undefined;\n\n  \twhile (i--) {\n  \t\tfragment = batch.fragments[i];\n\n  \t\t// TODO deprecate this. It's annoying and serves no useful function\n  \t\tvar ractive = fragment.ractive;\n  \t\tchangeHook.fire(ractive, ractive.viewmodel.changes);\n  \t\tractive.viewmodel.changes = {};\n\n  \t\tfragment.update();\n  \t}\n  \tbatch.fragments.length = 0;\n\n  \tbatch.transitionManager.start();\n\n  \tbatch.deferredObservers.forEach(_dispatch);\n\n  \tvar tasks = batch.tasks;\n  \tbatch.tasks = [];\n\n  \tfor (i = 0; i < tasks.length; i += 1) {\n  \t\ttasks[i]();\n  \t}\n\n  \t// If updating the view caused some model blowback - e.g. a triple\n  \t// containing <option> elements caused the binding on the <select>\n  \t// to update - then we start over\n  \tif (batch.fragments.length) return flushChanges();\n  }\n\n  var refPattern = /\\[\\s*(\\*|[0-9]|[1-9][0-9]+)\\s*\\]/g;\n\n  function normalise(ref) {\n  \treturn ref ? ref.replace(refPattern, '.$1') : '';\n  }\n\n  function splitKeypath(keypath) {\n  \treturn normalise(keypath).split('.');\n  }\n\n  function Ractive$updateModel(keypath, cascade) {\n  \tvar promise = runloop.start(this, true);\n\n  \tif (!keypath) {\n  \t\tthis.viewmodel.updateFromBindings(true);\n  \t} else {\n  \t\tthis.viewmodel.joinAll(splitKeypath(keypath)).updateFromBindings(cascade !== false);\n  \t}\n\n  \trunloop.end();\n\n  \treturn promise;\n  }\n\n  var updateHook = new Hook('update');\n  function Ractive$update(keypath) {\n  \tvar model = keypath ? this.viewmodel.joinAll(splitKeypath(keypath)) : this.viewmodel;\n\n  \tvar promise = runloop.start(this, true);\n  \tmodel.mark();\n  \trunloop.end();\n\n  \tupdateHook.fire(this, model);\n\n  \treturn promise;\n  }\n\n  // This function takes an array, the name of a mutator method, and the\n  // arguments to call that mutator method with, and returns an array that\n  // maps the old indices to their new indices.\n\n  // So if you had something like this...\n  //\n  //     array = [ 'a', 'b', 'c', 'd' ];\n  //     array.push( 'e' );\n  //\n  // ...you'd get `[ 0, 1, 2, 3 ]` - in other words, none of the old indices\n  // have changed. If you then did this...\n  //\n  //     array.unshift( 'z' );\n  //\n  // ...the indices would be `[ 1, 2, 3, 4, 5 ]` - every item has been moved\n  // one higher to make room for the 'z'. If you removed an item, the new index\n  // would be -1...\n  //\n  //     array.splice( 2, 2 );\n  //\n  // ...this would result in [ 0, 1, -1, -1, 2, 3 ].\n  //\n  // This information is used to enable fast, non-destructive shuffling of list\n  // sections when you do e.g. `ractive.splice( 'items', 2, 2 );\n\n  function getNewIndices(length, methodName, args) {\n  \tvar spliceArguments,\n  \t    newIndices = [],\n  \t    removeStart,\n  \t    removeEnd,\n  \t    balance,\n  \t    i;\n\n  \tspliceArguments = getSpliceEquivalent(length, methodName, args);\n\n  \tif (!spliceArguments) {\n  \t\treturn null; // TODO support reverse and sort?\n  \t}\n\n  \tbalance = spliceArguments.length - 2 - spliceArguments[1];\n\n  \tremoveStart = Math.min(length, spliceArguments[0]);\n  \tremoveEnd = removeStart + spliceArguments[1];\n\n  \tfor (i = 0; i < removeStart; i += 1) {\n  \t\tnewIndices.push(i);\n  \t}\n\n  \tfor (; i < removeEnd; i += 1) {\n  \t\tnewIndices.push(-1);\n  \t}\n\n  \tfor (; i < length; i += 1) {\n  \t\tnewIndices.push(i + balance);\n  \t}\n\n  \t// there is a net shift for the rest of the array starting with index + balance\n  \tif (balance !== 0) {\n  \t\tnewIndices.touchedFrom = spliceArguments[0];\n  \t} else {\n  \t\tnewIndices.touchedFrom = length;\n  \t}\n\n  \treturn newIndices;\n  }\n\n  // The pop, push, shift an unshift methods can all be represented\n  // as an equivalent splice\n  function getSpliceEquivalent(length, methodName, args) {\n  \tswitch (methodName) {\n  \t\tcase 'splice':\n  \t\t\tif (args[0] !== undefined && args[0] < 0) {\n  \t\t\t\targs[0] = length + Math.max(args[0], -length);\n  \t\t\t}\n\n  \t\t\twhile (args.length < 2) {\n  \t\t\t\targs.push(length - args[0]);\n  \t\t\t}\n\n  \t\t\t// ensure we only remove elements that exist\n  \t\t\targs[1] = Math.min(args[1], length - args[0]);\n\n  \t\t\treturn args;\n\n  \t\tcase 'sort':\n  \t\tcase 'reverse':\n  \t\t\treturn null;\n\n  \t\tcase 'pop':\n  \t\t\tif (length) {\n  \t\t\t\treturn [length - 1, 1];\n  \t\t\t}\n  \t\t\treturn [0, 0];\n\n  \t\tcase 'push':\n  \t\t\treturn [length, 0].concat(args);\n\n  \t\tcase 'shift':\n  \t\t\treturn [0, length ? 1 : 0];\n\n  \t\tcase 'unshift':\n  \t\t\treturn [0, 0].concat(args);\n  \t}\n  }\n\n  var arrayProto = Array.prototype;\n\n  function makeArrayMethod (methodName) {\n  \treturn function (keypath) {\n  \t\tvar model = this.viewmodel.joinAll(normalise(keypath).split('.'));\n  \t\tvar array = model.get();\n\n  \t\tif (!isArray(array)) {\n  \t\t\tthrow new Error('shuffle array method ' + methodName + ' called on non-array at ' + keypath.getKeypath());\n  \t\t}\n\n  \t\tfor (var _len = arguments.length, args = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n  \t\t\targs[_key - 1] = arguments[_key];\n  \t\t}\n\n  \t\tvar newIndices = getNewIndices(array.length, methodName, args);\n  \t\tvar result = arrayProto[methodName].apply(array, args);\n\n  \t\tvar promise = runloop.start(this, true).then(function () {\n  \t\t\treturn result;\n  \t\t});\n\n  \t\tif (newIndices) {\n  \t\t\tmodel.shuffle(newIndices);\n  \t\t} else {\n  \t\t\tmodel.set(result);\n  \t\t}\n\n  \t\trunloop.end();\n\n  \t\treturn promise;\n  \t};\n  }\n\n  var unshift = makeArrayMethod('unshift');\n\n  var _unrenderHook = new Hook('unrender');\n  function Ractive$unrender() {\n  \tif (!this.fragment.rendered) {\n  \t\twarnIfDebug('ractive.unrender() was called on a Ractive instance that was not rendered');\n  \t\treturn _Promise.resolve();\n  \t}\n\n  \tvar promise = runloop.start(this, true);\n\n  \t// If this is a component, and the component isn't marked for destruction,\n  \t// don't detach nodes from the DOM unnecessarily\n  \tvar shouldDestroy = !this.component || this.component.shouldDestroy || this.shouldDestroy;\n  \tthis.fragment.unrender(shouldDestroy);\n\n  \tremoveFromArray(this.el.__ractive_instances__, this);\n\n  \t_unrenderHook.fire(this);\n\n  \trunloop.end();\n  \treturn promise;\n  }\n\n  function Ractive$toHTML() {\n  \treturn this.fragment.toString(true);\n  }\n\n  // Error messages that are used (or could be) in multiple places\n  var badArguments = 'Bad arguments';\n  var noRegistryFunctionReturn = 'A function was specified for \"%s\" %s, but no %s was returned';\n  var missingPlugin = function (name, type) {\n    return 'Missing \"' + name + '\" ' + type + ' plugin. You may need to download a plugin via http://docs.ractivejs.org/latest/plugins#' + type + 's';\n  };\n\n  function Ractive$toggle(keypath) {\n  \tif (typeof keypath !== 'string') {\n  \t\tthrow new TypeError(badArguments);\n  \t}\n\n  \tvar changes = undefined;\n\n  \tif (/\\*/.test(keypath)) {\n  \t\tchanges = {};\n\n  \t\tthis.viewmodel.findMatches(splitKeypath(keypath)).forEach(function (model) {\n  \t\t\tchanges[model.getKeypath()] = !model.get();\n  \t\t});\n\n  \t\treturn this.set(changes);\n  \t}\n\n  \treturn this.set(keypath, !this.get(keypath));\n  }\n\n  var _teardownHook = new Hook('teardown');\n\n  // Teardown. This goes through the root fragment and all its children, removing observers\n  // and generally cleaning up after itself\n\n  function Ractive$teardown() {\n  \tthis.fragment.unbind();\n  \tthis.viewmodel.teardown();\n\n  \tthis._observers.forEach(_cancel);\n\n  \tif (this.fragment.rendered && this.el.__ractive_instances__) {\n  \t\tremoveFromArray(this.el.__ractive_instances__, this);\n  \t}\n\n  \tthis.shouldDestroy = true;\n  \tvar promise = this.fragment.rendered ? this.unrender() : _Promise.resolve();\n\n  \t_teardownHook.fire(this);\n\n  \treturn promise;\n  }\n\n  var _errorMessage = 'Cannot add to a non-numeric value';\n  function _add(ractive, keypath, d) {\n  \tif (typeof keypath !== 'string' || !isNumeric(d)) {\n  \t\tthrow new Error('Bad arguments');\n  \t}\n\n  \tvar changes = undefined;\n\n  \tif (/\\*/.test(keypath)) {\n  \t\tchanges = {};\n\n  \t\tractive.viewmodel.findMatches(splitKeypath(keypath)).forEach(function (model) {\n  \t\t\tvar value = model.get();\n\n  \t\t\tif (!isNumeric(value)) throw new Error(_errorMessage);\n\n  \t\t\tchanges[model.getKeypath()] = value + d;\n  \t\t});\n\n  \t\treturn ractive.set(changes);\n  \t}\n\n  \tvar value = ractive.get(keypath);\n\n  \tif (!isNumeric(value)) {\n  \t\tthrow new Error(_errorMessage);\n  \t}\n\n  \treturn ractive.set(keypath, +value + d);\n  }\n\n  function Ractive$subtract(keypath, d) {\n  \treturn _add(this, keypath, d === undefined ? -1 : -d);\n  }\n\n  var splice = makeArrayMethod('splice');\n\n  var sort = makeArrayMethod('sort');\n\n  var shift = makeArrayMethod('shift');\n\n  function _bind(fn, context) {\n  \tif (!/this/.test(fn.toString())) return fn;\n\n  \tvar bound = fn.bind(context);\n  \tfor (var prop in fn) {\n  \t\tbound[prop] = fn[prop];\n  \t}return bound;\n  }\n\n  function Ractive$set(keypath, value) {\n  \tvar promise = runloop.start(this, true);\n\n  \t// Set multiple keypaths in one go\n  \tif (isObject(keypath)) {\n  \t\tvar map = keypath;\n\n  \t\tfor (keypath in map) {\n  \t\t\tif (map.hasOwnProperty(keypath)) {\n  \t\t\t\t_set(this, keypath, map[keypath]);\n  \t\t\t}\n  \t\t}\n  \t}\n  \t// Set a single keypath\n  \telse {\n  \t\t\t_set(this, keypath, value);\n  \t\t}\n\n  \trunloop.end();\n\n  \treturn promise;\n  }\n\n  function _set(ractive, keypath, value) {\n  \tif (typeof value === 'function') value = _bind(value, ractive);\n\n  \tif (/\\*/.test(keypath)) {\n  \t\tractive.viewmodel.findMatches(splitKeypath(keypath)).forEach(function (model) {\n  \t\t\tmodel.set(value);\n  \t\t});\n  \t} else {\n  \t\tvar model = ractive.viewmodel.joinAll(splitKeypath(keypath));\n  \t\tmodel.set(value);\n  \t}\n  }\n\n  var reverse = makeArrayMethod('reverse');\n\n  var legacy = null;\n\n  var _html = 'http://www.w3.org/1999/xhtml';\n  var mathml = 'http://www.w3.org/1998/Math/MathML';\n  var svg = 'http://www.w3.org/2000/svg';\n  var xlink = 'http://www.w3.org/1999/xlink';\n  var xml = 'http://www.w3.org/XML/1998/namespace';\n  var xmlns = 'http://www.w3.org/2000/xmlns/';\n\n  var createElement;\n  var matches;\n  var _div;\n  var methodNames;\n  var unprefixed;\n  var prefixed;\n  var __i;\n  var j;\n  var makeFunction;\n  // Test for SVG support\n  if (!_svg) {\n  \tcreateElement = function (type, ns, extend) {\n  \t\tif (ns && ns !== _html) {\n  \t\t\tthrow 'This browser does not support namespaces other than http://www.w3.org/1999/xhtml. The most likely cause of this error is that you\\'re trying to render SVG in an older browser. See http://docs.ractivejs.org/latest/svg-and-older-browsers for more information';\n  \t\t}\n\n  \t\treturn extend ? doc.createElement(type, extend) : doc.createElement(type);\n  \t};\n  } else {\n  \tcreateElement = function (type, ns, extend) {\n  \t\tif (!ns || ns === _html) {\n  \t\t\treturn extend ? doc.createElement(type, extend) : doc.createElement(type);\n  \t\t}\n\n  \t\treturn extend ? doc.createElementNS(ns, type, extend) : doc.createElementNS(ns, type);\n  \t};\n  }\n\n  function createDocumentFragment() {\n  \treturn doc.createDocumentFragment();\n  }\n\n  function getElement(input) {\n  \tvar output;\n\n  \tif (!input || typeof input === 'boolean') {\n  \t\treturn;\n  \t}\n\n  \tif (!win || !doc || !input) {\n  \t\treturn null;\n  \t}\n\n  \t// We already have a DOM node - no work to do. (Duck typing alert!)\n  \tif (input.nodeType) {\n  \t\treturn input;\n  \t}\n\n  \t// Get node from string\n  \tif (typeof input === 'string') {\n  \t\t// try ID first\n  \t\toutput = doc.getElementById(input);\n\n  \t\t// then as selector, if possible\n  \t\tif (!output && doc.querySelector) {\n  \t\t\toutput = doc.querySelector(input);\n  \t\t}\n\n  \t\t// did it work?\n  \t\tif (output && output.nodeType) {\n  \t\t\treturn output;\n  \t\t}\n  \t}\n\n  \t// If we've been given a collection (jQuery, Zepto etc), extract the first item\n  \tif (input[0] && input[0].nodeType) {\n  \t\treturn input[0];\n  \t}\n\n  \treturn null;\n  }\n\n  if (!isClient) {\n  \tmatches = null;\n  } else {\n  \t_div = createElement('div');\n  \tmethodNames = ['matches', 'matchesSelector'];\n\n  \tmakeFunction = function (methodName) {\n  \t\treturn function (node, selector) {\n  \t\t\treturn node[methodName](selector);\n  \t\t};\n  \t};\n\n  \t__i = methodNames.length;\n\n  \twhile (__i-- && !matches) {\n  \t\tunprefixed = methodNames[__i];\n\n  \t\tif (_div[unprefixed]) {\n  \t\t\tmatches = makeFunction(unprefixed);\n  \t\t} else {\n  \t\t\tj = vendors.length;\n  \t\t\twhile (j--) {\n  \t\t\t\tprefixed = vendors[__i] + unprefixed.substr(0, 1).toUpperCase() + unprefixed.substring(1);\n\n  \t\t\t\tif (_div[prefixed]) {\n  \t\t\t\t\tmatches = makeFunction(prefixed);\n  \t\t\t\t\tbreak;\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \t// IE8...\n  \tif (!matches) {\n  \t\tmatches = function (node, selector) {\n  \t\t\tvar nodes, parentNode, i;\n\n  \t\t\tparentNode = node.parentNode;\n\n  \t\t\tif (!parentNode) {\n  \t\t\t\t// empty dummy <div>\n  \t\t\t\t_div.innerHTML = '';\n\n  \t\t\t\tparentNode = _div;\n  \t\t\t\tnode = node.cloneNode();\n\n  \t\t\t\t_div.appendChild(node);\n  \t\t\t}\n\n  \t\t\tnodes = parentNode.querySelectorAll(selector);\n\n  \t\t\ti = nodes.length;\n  \t\t\twhile (i--) {\n  \t\t\t\tif (nodes[i] === node) {\n  \t\t\t\t\treturn true;\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\treturn false;\n  \t\t};\n  \t}\n  }\n\n  function detachNode(node) {\n  \tif (node && typeof node.parentNode !== 'unknown' && node.parentNode) {\n  \t\tnode.parentNode.removeChild(node);\n  \t}\n\n  \treturn node;\n  }\n\n  function safeToStringValue(value) {\n  \treturn value == null || !value.toString ? '' : '' + value;\n  }\n\n  var create;\n  var defineProperty;\n  var defineProperties;\n  try {\n  \tObject.defineProperty({}, 'test', { value: 0 });\n\n  \tif (doc) {\n  \t\tObject.defineProperty(createElement('div'), 'test', { value: 0 });\n  \t}\n\n  \tdefineProperty = Object.defineProperty;\n  } catch (err) {\n  \t// Object.defineProperty doesn't exist, or we're in IE8 where you can\n  \t// only use it with DOM objects (what were you smoking, MSFT?)\n  \tdefineProperty = function (obj, prop, desc) {\n  \t\tobj[prop] = desc.value;\n  \t};\n  }\n\n  try {\n  \ttry {\n  \t\tObject.defineProperties({}, { test: { value: 0 } });\n  \t} catch (err) {\n  \t\t// TODO how do we account for this? noMagic = true;\n  \t\tthrow err;\n  \t}\n\n  \tif (doc) {\n  \t\tObject.defineProperties(createElement('div'), { test: { value: 0 } });\n  \t}\n\n  \tdefineProperties = Object.defineProperties;\n  } catch (err) {\n  \tdefineProperties = function (obj, props) {\n  \t\tvar prop;\n\n  \t\tfor (prop in props) {\n  \t\t\tif (props.hasOwnProperty(prop)) {\n  \t\t\t\tdefineProperty(obj, prop, props[prop]);\n  \t\t\t}\n  \t\t}\n  \t};\n  }\n\n  try {\n  \tObject.create(null);\n\n  \tcreate = Object.create;\n  } catch (err) {\n  \t// sigh\n  \tcreate = (function () {\n  \t\tvar F = function () {};\n\n  \t\treturn function (proto, props) {\n  \t\t\tvar obj;\n\n  \t\t\tif (proto === null) {\n  \t\t\t\treturn {};\n  \t\t\t}\n\n  \t\t\tF.prototype = proto;\n  \t\t\tobj = new F();\n\n  \t\t\tif (props) {\n  \t\t\t\tObject.defineProperties(obj, props);\n  \t\t\t}\n\n  \t\t\treturn obj;\n  \t\t};\n  \t})();\n  }\n\n  function __extend(target) {\n  \tvar prop, source;\n\n  \tfor (var _len = arguments.length, sources = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n  \t\tsources[_key - 1] = arguments[_key];\n  \t}\n\n  \twhile (source = sources.shift()) {\n  \t\tfor (prop in source) {\n  \t\t\tif (hasOwn.call(source, prop)) {\n  \t\t\t\ttarget[prop] = source[prop];\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \treturn target;\n  }\n\n  var hasOwn = Object.prototype.hasOwnProperty;\n\n  var Parser;\n  var ParseError;\n  var leadingWhitespace = /^\\s+/;\n  ParseError = function (message) {\n  \tthis.name = 'ParseError';\n  \tthis.message = message;\n  \ttry {\n  \t\tthrow new Error(message);\n  \t} catch (e) {\n  \t\tthis.stack = e.stack;\n  \t}\n  };\n\n  ParseError.prototype = Error.prototype;\n\n  Parser = function (str, options) {\n  \tvar items,\n  \t    item,\n  \t    lineStart = 0;\n\n  \tthis.str = str;\n  \tthis.options = options || {};\n  \tthis.pos = 0;\n\n  \tthis.lines = this.str.split('\\n');\n  \tthis.lineEnds = this.lines.map(function (line) {\n  \t\tvar lineEnd = lineStart + line.length + 1; // +1 for the newline\n\n  \t\tlineStart = lineEnd;\n  \t\treturn lineEnd;\n  \t}, 0);\n\n  \t// Custom init logic\n  \tif (this.init) this.init(str, options);\n\n  \titems = [];\n\n  \twhile (this.pos < this.str.length && (item = this.read())) {\n  \t\titems.push(item);\n  \t}\n\n  \tthis.leftover = this.remaining();\n  \tthis.result = this.postProcess ? this.postProcess(items, options) : items;\n  };\n\n  Parser.prototype = {\n  \tread: function (converters) {\n  \t\tvar pos, i, len, item;\n\n  \t\tif (!converters) converters = this.converters;\n\n  \t\tpos = this.pos;\n\n  \t\tlen = converters.length;\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tthis.pos = pos; // reset for each attempt\n\n  \t\t\tif (item = converters[i](this)) {\n  \t\t\t\treturn item;\n  \t\t\t}\n  \t\t}\n\n  \t\treturn null;\n  \t},\n\n  \tgetLinePos: function (char) {\n  \t\tvar lineNum = 0,\n  \t\t    lineStart = 0,\n  \t\t    columnNum;\n\n  \t\twhile (char >= this.lineEnds[lineNum]) {\n  \t\t\tlineStart = this.lineEnds[lineNum];\n  \t\t\tlineNum += 1;\n  \t\t}\n\n  \t\tcolumnNum = char - lineStart;\n  \t\treturn [lineNum + 1, columnNum + 1, char]; // line/col should be one-based, not zero-based!\n  \t},\n\n  \terror: function (message) {\n  \t\tvar pos = this.getLinePos(this.pos);\n  \t\tvar lineNum = pos[0];\n  \t\tvar columnNum = pos[1];\n\n  \t\tvar line = this.lines[pos[0] - 1];\n  \t\tvar numTabs = 0;\n  \t\tvar annotation = line.replace(/\\t/g, function (match, char) {\n  \t\t\tif (char < pos[1]) {\n  \t\t\t\tnumTabs += 1;\n  \t\t\t}\n\n  \t\t\treturn '  ';\n  \t\t}) + '\\n' + new Array(pos[1] + numTabs).join(' ') + '^----';\n\n  \t\tvar error = new ParseError(message + ' at line ' + lineNum + ' character ' + columnNum + ':\\n' + annotation);\n\n  \t\terror.line = pos[0];\n  \t\terror.character = pos[1];\n  \t\terror.shortMessage = message;\n\n  \t\tthrow error;\n  \t},\n\n  \tmatchString: function (string) {\n  \t\tif (this.str.substr(this.pos, string.length) === string) {\n  \t\t\tthis.pos += string.length;\n  \t\t\treturn string;\n  \t\t}\n  \t},\n\n  \tmatchPattern: function (pattern) {\n  \t\tvar match;\n\n  \t\tif (match = pattern.exec(this.remaining())) {\n  \t\t\tthis.pos += match[0].length;\n  \t\t\treturn match[1] || match[0];\n  \t\t}\n  \t},\n\n  \tallowWhitespace: function () {\n  \t\tthis.matchPattern(leadingWhitespace);\n  \t},\n\n  \tremaining: function () {\n  \t\treturn this.str.substring(this.pos);\n  \t},\n\n  \tnextChar: function () {\n  \t\treturn this.str.charAt(this.pos);\n  \t}\n  };\n\n  Parser.extend = function (proto) {\n  \tvar Parent = this,\n  \t    Child,\n  \t    key;\n\n  \tChild = function (str, options) {\n  \t\tParser.call(this, str, options);\n  \t};\n\n  \tChild.prototype = create(Parent.prototype);\n\n  \tfor (key in proto) {\n  \t\tif (hasOwn.call(proto, key)) {\n  \t\t\tChild.prototype[key] = proto[key];\n  \t\t}\n  \t}\n\n  \tChild.extend = Parser.extend;\n  \treturn Child;\n  };\n\n  var stringMiddlePattern;\n  var escapeSequencePattern;\n  var lineContinuationPattern;\n  // Match one or more characters until: \", ', \\, or EOL/EOF.\n  // EOL/EOF is written as (?!.) (meaning there's no non-newline char next).\n  stringMiddlePattern = /^(?=.)[^\"'\\\\]+?(?:(?!.)|(?=[\"'\\\\]))/;\n\n  // Match one escape sequence, including the backslash.\n  escapeSequencePattern = /^\\\\(?:['\"\\\\bfnrt]|0(?![0-9])|x[0-9a-fA-F]{2}|u[0-9a-fA-F]{4}|(?=.)[^ux0-9])/;\n\n  // Match one ES5 line continuation (backslash + line terminator).\n  lineContinuationPattern = /^\\\\(?:\\r\\n|[\\u000A\\u000D\\u2028\\u2029])/;\n\n  // Helper for defining getDoubleQuotedString and getSingleQuotedString.\n  function makeQuotedStringMatcher (okQuote) {\n  \treturn function (parser) {\n  \t\tvar literal = '\"';\n  \t\tvar done = false;\n  \t\tvar next = undefined;\n\n  \t\twhile (!done) {\n  \t\t\tnext = parser.matchPattern(stringMiddlePattern) || parser.matchPattern(escapeSequencePattern) || parser.matchString(okQuote);\n  \t\t\tif (next) {\n  \t\t\t\tif (next === '\"') {\n  \t\t\t\t\tliteral += '\\\\\"';\n  \t\t\t\t} else if (next === '\\\\\\'') {\n  \t\t\t\t\tliteral += '\\'';\n  \t\t\t\t} else {\n  \t\t\t\t\tliteral += next;\n  \t\t\t\t}\n  \t\t\t} else {\n  \t\t\t\tnext = parser.matchPattern(lineContinuationPattern);\n  \t\t\t\tif (next) {\n  \t\t\t\t\t// convert \\(newline-like) into a \\u escape, which is allowed in JSON\n  \t\t\t\t\tliteral += '\\\\u' + ('000' + next.charCodeAt(1).toString(16)).slice(-4);\n  \t\t\t\t} else {\n  \t\t\t\t\tdone = true;\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\tliteral += '\"';\n\n  \t\t// use JSON.parse to interpret escapes\n  \t\treturn JSON.parse(literal);\n  \t};\n  }\n\n  var TEXT = 1;\n  var INTERPOLATOR = 2;\n  var TRIPLE = 3;\n  var SECTION = 4;\n  var ELEMENT = 7;\n  var PARTIAL = 8;\n  var COMPONENT = 15;\n  var YIELDER = 16;\n  var DOCTYPE = 18;\n\n  var NUMBER_LITERAL = 20;\n  var STRING_LITERAL = 21;\n  var REFERENCE = 30;\n  var SECTION_IF = 50;\n  var SECTION_UNLESS = 51;\n  var SECTION_EACH = 52;\n  var SECTION_WITH = 53;\n  var SECTION_IF_WITH = 54;\n\n  var getSingleQuotedString = makeQuotedStringMatcher('\"');\n  var getDoubleQuotedString = makeQuotedStringMatcher('\\'');\n\n  function readStringLiteral (parser) {\n  \tvar start, string;\n\n  \tstart = parser.pos;\n\n  \tif (parser.matchString('\"')) {\n  \t\tstring = getDoubleQuotedString(parser);\n\n  \t\tif (!parser.matchString('\"')) {\n  \t\t\tparser.pos = start;\n  \t\t\treturn null;\n  \t\t}\n\n  \t\treturn {\n  \t\t\tt: STRING_LITERAL,\n  \t\t\tv: string\n  \t\t};\n  \t}\n\n  \tif (parser.matchString('\\'')) {\n  \t\tstring = getSingleQuotedString(parser);\n\n  \t\tif (!parser.matchString('\\'')) {\n  \t\t\tparser.pos = start;\n  \t\t\treturn null;\n  \t\t}\n\n  \t\treturn {\n  \t\t\tt: STRING_LITERAL,\n  \t\t\tv: string\n  \t\t};\n  \t}\n\n  \treturn null;\n  }\n\n  var _name = /^[a-zA-Z_$][a-zA-Z_$0-9]*/;\n\n  // bulletproof number regex from https://gist.github.com/Rich-Harris/7544330\n  var _numberPattern = /^(?:[+-]?)0*(?:(?:(?:[1-9]\\d*)?\\.\\d+)|(?:(?:0|[1-9]\\d*)\\.)|(?:0|[1-9]\\d*))(?:[eE][+-]?\\d+)?/;\n  function readNumberLiteral(parser) {\n  \tvar result;\n\n  \tif (result = parser.matchPattern(_numberPattern)) {\n  \t\treturn {\n  \t\t\tt: NUMBER_LITERAL,\n  \t\t\tv: result\n  \t\t};\n  \t}\n\n  \treturn null;\n  }\n\n  var identifier = /^[a-zA-Z_$][a-zA-Z_$0-9]*$/;\n\n  // http://mathiasbynens.be/notes/javascript-properties\n  // can be any name, string literal, or number literal\n\n  function readKey(parser) {\n  \tvar token;\n\n  \tif (token = readStringLiteral(parser)) {\n  \t\treturn identifier.test(token.v) ? token.v : '\"' + token.v.replace(/\"/g, '\\\\\"') + '\"';\n  \t}\n\n  \tif (token = readNumberLiteral(parser)) {\n  \t\treturn token.v;\n  \t}\n\n  \tif (token = parser.matchPattern(_name)) {\n  \t\treturn token;\n  \t}\n  }\n\n  // simple JSON parser, without the restrictions of JSON parse\n  // (i.e. having to double-quote keys).\n  //\n  // If passed a hash of values as the second argument, ${placeholders}\n  // will be replaced with those values\n\n  var specials = {\n  \t'true': true,\n  \t'false': false,\n  \t'null': null,\n  \tundefined: undefined\n  };\n\n  var specialsPattern = new RegExp('^(?:' + Object.keys(specials).join('|') + ')');\n  var numberPattern = /^(?:[+-]?)(?:(?:(?:0|[1-9]\\d*)?\\.\\d+)|(?:(?:0|[1-9]\\d*)\\.)|(?:0|[1-9]\\d*))(?:[eE][+-]?\\d+)?/;\n  var placeholderPattern = /\\$\\{([^\\}]+)\\}/g;\n  var placeholderAtStartPattern = /^\\$\\{([^\\}]+)\\}/;\n  var onlyWhitespace = /^\\s*$/;\n\n  var JsonParser = Parser.extend({\n  \tinit: function (str, options) {\n  \t\tthis.values = options.values;\n  \t\tthis.allowWhitespace();\n  \t},\n\n  \tpostProcess: function (result) {\n  \t\tif (result.length !== 1 || !onlyWhitespace.test(this.leftover)) {\n  \t\t\treturn null;\n  \t\t}\n\n  \t\treturn { value: result[0].v };\n  \t},\n\n  \tconverters: [function getPlaceholder(parser) {\n  \t\tif (!parser.values) return null;\n\n  \t\tvar placeholder = parser.matchPattern(placeholderAtStartPattern);\n\n  \t\tif (placeholder && parser.values.hasOwnProperty(placeholder)) {\n  \t\t\treturn { v: parser.values[placeholder] };\n  \t\t}\n  \t}, function getSpecial(parser) {\n  \t\tvar special = parser.matchPattern(specialsPattern);\n  \t\tif (special) return { v: specials[special] };\n  \t}, function getNumber(parser) {\n  \t\tvar number = parser.matchPattern(numberPattern);\n  \t\tif (number) return { v: +number };\n  \t}, function getString(parser) {\n  \t\tvar stringLiteral = readStringLiteral(parser);\n  \t\tvar values = parser.values;\n\n  \t\tif (stringLiteral && values) {\n  \t\t\treturn {\n  \t\t\t\tv: stringLiteral.v.replace(placeholderPattern, function (match, $1) {\n  \t\t\t\t\treturn $1 in values ? values[$1] : $1;\n  \t\t\t\t})\n  \t\t\t};\n  \t\t}\n\n  \t\treturn stringLiteral;\n  \t}, function getObject(parser) {\n  \t\tif (!parser.matchString('{')) return null;\n\n  \t\tvar result = {};\n\n  \t\tparser.allowWhitespace();\n\n  \t\tif (parser.matchString('}')) {\n  \t\t\treturn { v: result };\n  \t\t}\n\n  \t\tvar pair = undefined;\n  \t\twhile (pair = getKeyValuePair(parser)) {\n  \t\t\tresult[pair.key] = pair.value;\n\n  \t\t\tparser.allowWhitespace();\n\n  \t\t\tif (parser.matchString('}')) {\n  \t\t\t\treturn { v: result };\n  \t\t\t}\n\n  \t\t\tif (!parser.matchString(',')) {\n  \t\t\t\treturn null;\n  \t\t\t}\n  \t\t}\n\n  \t\treturn null;\n  \t}, function getArray(parser) {\n  \t\tif (!parser.matchString('[')) return null;\n\n  \t\tvar result = [];\n\n  \t\tparser.allowWhitespace();\n\n  \t\tif (parser.matchString(']')) {\n  \t\t\treturn { v: result };\n  \t\t}\n\n  \t\tvar valueToken = undefined;\n  \t\twhile (valueToken = parser.read()) {\n  \t\t\tresult.push(valueToken.v);\n\n  \t\t\tparser.allowWhitespace();\n\n  \t\t\tif (parser.matchString(']')) {\n  \t\t\t\treturn { v: result };\n  \t\t\t}\n\n  \t\t\tif (!parser.matchString(',')) {\n  \t\t\t\treturn null;\n  \t\t\t}\n\n  \t\t\tparser.allowWhitespace();\n  \t\t}\n\n  \t\treturn null;\n  \t}]\n  });\n\n  function getKeyValuePair(parser) {\n  \tparser.allowWhitespace();\n\n  \tvar key = readKey(parser);\n\n  \tif (!key) return null;\n\n  \tvar pair = { key: key };\n\n  \tparser.allowWhitespace();\n  \tif (!parser.matchString(':')) {\n  \t\treturn null;\n  \t}\n  \tparser.allowWhitespace();\n\n  \tvar valueToken = parser.read();\n\n  \tif (!valueToken) return null;\n\n  \tpair.value = valueToken.v;\n  \treturn pair;\n  }\n\n  function parseJSON (str, values) {\n  \tvar parser = new JsonParser(str, { values: values });\n  \treturn parser.result;\n  }\n\n  // TODO all this code needs to die\n\n  function processItems(items, values, guid) {\n  \tvar counter = arguments.length <= 3 || arguments[3] === undefined ? 0 : arguments[3];\n\n  \treturn items.map(function (item) {\n  \t\tif (item.type === TEXT) {\n  \t\t\treturn item.template;\n  \t\t}\n\n  \t\tif (item.fragment) {\n  \t\t\tif (item.fragment.iterations) {\n  \t\t\t\treturn item.fragment.iterations.map(function (fragment) {\n  \t\t\t\t\treturn processItems(fragment.items, values, guid, counter);\n  \t\t\t\t}).join('');\n  \t\t\t} else {\n  \t\t\t\treturn processItems(item.fragment.items, values, guid, counter);\n  \t\t\t}\n  \t\t}\n\n  \t\tvar placeholderId = guid + '-' + counter++;\n\n  \t\tvalues[placeholderId] = item.model ? item.model.wrapper ? item.model.wrapper.value : item.model.get() : undefined;\n\n  \t\treturn '${' + placeholderId + '}';\n  \t}).join('');\n  }\n\n  function badReference(key) {\n  \tthrow new Error(\"An index or key reference (\" + key + \") cannot have child properties\");\n  }\n  function resolveAmbiguousReference(fragment, ref) {\n  \tvar localViewmodel = fragment.findContext().root;\n  \tvar keys = ref.split('.');\n  \tvar key = keys[0];\n\n  \tvar hasContextChain = undefined;\n  \tvar crossedComponentBoundary = undefined;\n\n  \twhile (fragment) {\n  \t\t// repeated fragments\n  \t\tif (fragment.isIteration) {\n  \t\t\tif (key === fragment.parent.keyRef) {\n  \t\t\t\tif (keys.length > 1) badReference(key);\n  \t\t\t\treturn fragment.context.getKeyModel();\n  \t\t\t}\n\n  \t\t\tif (key === fragment.parent.indexRef) {\n  \t\t\t\tif (keys.length > 1) badReference(key);\n  \t\t\t\treturn fragment.context.getIndexModel(fragment.index);\n  \t\t\t}\n  \t\t}\n\n  \t\tif (fragment.context) {\n  \t\t\t// TODO better encapsulate the component check\n  \t\t\tif (!fragment.isRoot || fragment.ractive.component) hasContextChain = true;\n\n  \t\t\tif (fragment.context.has(key)) {\n  \t\t\t\tif (crossedComponentBoundary) {\n  \t\t\t\t\tlocalViewmodel.map(key, fragment.context.joinKey(key));\n  \t\t\t\t}\n\n  \t\t\t\treturn fragment.context.joinAll(keys);\n  \t\t\t}\n  \t\t}\n\n  \t\tif (fragment.componentParent && !fragment.ractive.isolated) {\n  \t\t\t// ascend through component boundary\n  \t\t\tfragment = fragment.componentParent;\n  \t\t\tcrossedComponentBoundary = true;\n  \t\t} else {\n  \t\t\tfragment = fragment.parent;\n  \t\t}\n  \t}\n\n  \tif (!hasContextChain) {\n  \t\treturn localViewmodel.joinAll(keys);\n  \t}\n  }\n\n  var ReferenceResolver = (function () {\n  \tfunction ReferenceResolver(fragment, reference, callback) {\n  \t\tclassCallCheck(this, ReferenceResolver);\n\n  \t\tthis.fragment = fragment;\n  \t\tthis.reference = normalise(reference);\n  \t\tthis.callback = callback;\n\n  \t\tthis.keys = reference.split('.');\n  \t\tthis.resolved = false;\n\n  \t\t// TODO the consumer should take care of addUnresolved\n  \t\t// we attach to all the contexts between here and the root\n  \t\t// - whenever their values change, they can quickly\n  \t\t// check to see if we can resolve\n  \t\twhile (fragment) {\n  \t\t\tif (fragment.context) {\n  \t\t\t\tfragment.context.addUnresolved(this.keys[0], this);\n  \t\t\t}\n\n  \t\t\tfragment = fragment.componentParent || fragment.parent;\n  \t\t}\n  \t}\n\n  \tReferenceResolver.prototype.attemptResolution = function attemptResolution() {\n  \t\tif (this.resolved) return;\n\n  \t\tvar model = resolveAmbiguousReference(this.fragment, this.reference);\n\n  \t\tif (model) {\n  \t\t\tthis.resolved = true;\n  \t\t\tthis.callback(model);\n  \t\t}\n  \t};\n\n  \tReferenceResolver.prototype.forceResolution = function forceResolution() {\n  \t\tif (this.resolved) return;\n\n  \t\tvar model = this.fragment.findContext().joinAll(this.keys);\n  \t\tthis.callback(model);\n  \t\tthis.resolved = true;\n  \t};\n\n  \tReferenceResolver.prototype.unbind = function unbind() {\n  \t\tremoveFromArray(this.fragment.unresolved, this);\n  \t};\n\n  \treturn ReferenceResolver;\n  })();\n\n  var Item = (function () {\n  \tfunction Item(options) {\n  \t\tclassCallCheck(this, Item);\n\n  \t\tthis.parentFragment = options.parentFragment;\n  \t\tthis.ractive = options.parentFragment.ractive;\n\n  \t\tthis.template = options.template;\n  \t\tthis.index = options.index;\n  \t\tthis.type = options.template.t;\n\n  \t\tthis.dirty = false;\n  \t}\n\n  \tItem.prototype.bubble = function bubble() {\n  \t\tif (!this.dirty) {\n  \t\t\tthis.dirty = true;\n  \t\t\tthis.parentFragment.bubble();\n  \t\t}\n  \t};\n\n  \tItem.prototype.find = function find() {\n  \t\treturn null;\n  \t};\n\n  \tItem.prototype.findAll = function findAll() {\n  \t\t// noop\n  \t};\n\n  \tItem.prototype.findComponent = function findComponent() {\n  \t\treturn null;\n  \t};\n\n  \tItem.prototype.findAllComponents = function findAllComponents() {\n  \t\t// noop;\n  \t};\n\n  \tItem.prototype.findNextNode = function findNextNode() {\n  \t\treturn this.parentFragment.findNextNode(this);\n  \t};\n\n  \treturn Item;\n  })();\n\n  var Doctype = (function (_Item) {\n  \tinherits(Doctype, _Item);\n\n  \tfunction Doctype() {\n  \t\tclassCallCheck(this, Doctype);\n\n  \t\t_Item.apply(this, arguments);\n  \t}\n\n  \tDoctype.prototype.bind = function bind() {\n  \t\t// noop\n  \t};\n\n  \tDoctype.prototype.render = function render() {\n  \t\t// noop\n  \t};\n\n  \tDoctype.prototype.teardown = function teardown() {\n  \t\t// noop\n  \t};\n\n  \tDoctype.prototype.toString = function toString() {\n  \t\treturn '<!DOCTYPE' + this.template.a + '>';\n  \t};\n\n  \tDoctype.prototype.unbind = function unbind() {\n  \t\t// noop\n  \t};\n\n  \tDoctype.prototype.unrender = function unrender() {\n  \t\t// noop\n  \t};\n\n  \treturn Doctype;\n  })(Item);\n\n  var KeypathModel = (function () {\n  \tfunction KeypathModel(parent) {\n  \t\tclassCallCheck(this, KeypathModel);\n\n  \t\tthis.parent = parent;\n  \t\tthis.value = parent.getKeypath();\n  \t\tthis.dependants = [];\n  \t}\n\n  \tKeypathModel.prototype.get = function get() {\n  \t\treturn this.value;\n  \t};\n\n  \tKeypathModel.prototype.getKeypath = function getKeypath() {\n  \t\treturn this.value;\n  \t};\n\n  \tKeypathModel.prototype.handleChange = function handleChange() {\n  \t\tthis.value = this.parent.getKeypath();\n  \t\tthis.dependants.forEach(_handleChange);\n  \t};\n\n  \tKeypathModel.prototype.register = function register(dependant) {\n  \t\tthis.dependants.push(dependant);\n  \t};\n\n  \tKeypathModel.prototype.unregister = function unregister(dependant) {\n  \t\tremoveFromArray(this.dependants, dependant);\n  \t};\n\n  \treturn KeypathModel;\n  })();\n\n  var KeyModel = (function () {\n  \tfunction KeyModel(key) {\n  \t\tclassCallCheck(this, KeyModel);\n\n  \t\tthis.value = key;\n  \t\tthis.isReadonly = true;\n  \t\tthis.dependants = [];\n  \t}\n\n  \tKeyModel.prototype.get = function get() {\n  \t\treturn this.value;\n  \t};\n\n  \tKeyModel.prototype.getKeypath = function getKeypath() {\n  \t\treturn this.value;\n  \t};\n\n  \tKeyModel.prototype.rebind = function rebind(key) {\n  \t\tthis.value = key;\n  \t\tthis.dependants.forEach(_handleChange);\n  \t};\n\n  \tKeyModel.prototype.register = function register(dependant) {\n  \t\tthis.dependants.push(dependant);\n  \t};\n\n  \tKeyModel.prototype.unregister = function unregister(dependant) {\n  \t\tremoveFromArray(this.dependants, dependant);\n  \t};\n\n  \treturn KeyModel;\n  })();\n\n  var _stack = [];\n  var captureGroup = undefined;\n\n  function startCapturing() {\n  \t_stack.push(captureGroup = []);\n  }\n\n  function stopCapturing() {\n  \treturn _stack.pop();\n  }\n\n  function capture(model) {\n  \tif (captureGroup) {\n  \t\tcaptureGroup.push(model);\n  \t}\n  }\n\n  var requestAnimationFrame;\n\n  // If window doesn't exist, we don't need requestAnimationFrame\n  if (!win) {\n  \trequestAnimationFrame = null;\n  } else {\n  \t// https://gist.github.com/paulirish/1579671\n  \t(function (vendors, lastTime, win) {\n\n  \t\tvar x, setTimeout;\n\n  \t\tif (win.requestAnimationFrame) {\n  \t\t\treturn;\n  \t\t}\n\n  \t\tfor (x = 0; x < vendors.length && !win.requestAnimationFrame; ++x) {\n  \t\t\twin.requestAnimationFrame = win[vendors[x] + 'RequestAnimationFrame'];\n  \t\t}\n\n  \t\tif (!win.requestAnimationFrame) {\n  \t\t\tsetTimeout = win.setTimeout;\n\n  \t\t\twin.requestAnimationFrame = function (callback) {\n  \t\t\t\tvar currTime, timeToCall, id;\n\n  \t\t\t\tcurrTime = Date.now();\n  \t\t\t\ttimeToCall = Math.max(0, 16 - (currTime - lastTime));\n  \t\t\t\tid = setTimeout(function () {\n  \t\t\t\t\tcallback(currTime + timeToCall);\n  \t\t\t\t}, timeToCall);\n\n  \t\t\t\tlastTime = currTime + timeToCall;\n  \t\t\t\treturn id;\n  \t\t\t};\n  \t\t}\n  \t})(vendors, 0, win);\n\n  \trequestAnimationFrame = win.requestAnimationFrame;\n  }\n\n  var getTime = win && win.performance && typeof win.performance.now === 'function' ? function () {\n  \treturn win.performance.now();\n  } : function () {\n  \treturn Date.now();\n  };\n\n  // TODO what happens if a transition is aborted?\n\n  var tickers = [];\n  var running = false;\n\n  function tick() {\n  \trunloop.start();\n\n  \tvar now = getTime();\n\n  \tvar i = undefined;\n  \tvar ticker = undefined;\n\n  \tfor (i = 0; i < tickers.length; i += 1) {\n  \t\tticker = tickers[i];\n\n  \t\tif (!ticker.tick(now)) {\n  \t\t\t// ticker is complete, remove it from the stack, and decrement i so we don't miss one\n  \t\t\ttickers.splice(i--, 1);\n  \t\t}\n  \t}\n\n  \trunloop.end();\n\n  \tif (tickers.length) {\n  \t\trequestAnimationFrame(tick);\n  \t} else {\n  \t\trunning = false;\n  \t}\n  }\n\n  var Ticker = (function () {\n  \tfunction Ticker(options) {\n  \t\tclassCallCheck(this, Ticker);\n\n  \t\tthis.duration = options.duration;\n  \t\tthis.step = options.step;\n  \t\tthis.complete = options.complete;\n  \t\tthis.easing = options.easing;\n\n  \t\tthis.start = getTime();\n  \t\tthis.end = this.start + this.duration;\n\n  \t\tthis.running = true;\n\n  \t\ttickers.push(this);\n  \t\tif (!running) requestAnimationFrame(tick);\n  \t}\n\n  \tTicker.prototype.tick = function tick(now) {\n  \t\tif (!this.running) return false;\n\n  \t\tif (now > this.end) {\n  \t\t\tif (this.step) this.step(1);\n  \t\t\tif (this.complete) this.complete(1);\n\n  \t\t\treturn false;\n  \t\t}\n\n  \t\tvar elapsed = now - this.start;\n  \t\tvar eased = this.easing(elapsed / this.duration);\n\n  \t\tif (this.step) this.step(eased);\n\n  \t\treturn true;\n  \t};\n\n  \tTicker.prototype.stop = function stop() {\n  \t\tif (this.abort) this.abort();\n  \t\tthis.running = false;\n  \t};\n\n  \treturn Ticker;\n  })();\n\n  var prefixers = {};\n\n  // TODO this is legacy. sooner we can replace the old adaptor API the better\n  function prefixKeypath(obj, prefix) {\n  \tvar prefixed = {},\n  \t    key;\n\n  \tif (!prefix) {\n  \t\treturn obj;\n  \t}\n\n  \tprefix += '.';\n\n  \tfor (key in obj) {\n  \t\tif (obj.hasOwnProperty(key)) {\n  \t\t\tprefixed[prefix + key] = obj[key];\n  \t\t}\n  \t}\n\n  \treturn prefixed;\n  }\n  function getPrefixer(rootKeypath) {\n  \tvar rootDot;\n\n  \tif (!prefixers[rootKeypath]) {\n  \t\trootDot = rootKeypath ? rootKeypath + '.' : '';\n\n  \t\tprefixers[rootKeypath] = function (relativeKeypath, value) {\n  \t\t\tvar obj;\n\n  \t\t\tif (typeof relativeKeypath === 'string') {\n  \t\t\t\tobj = {};\n  \t\t\t\tobj[rootDot + relativeKeypath] = value;\n  \t\t\t\treturn obj;\n  \t\t\t}\n\n  \t\t\tif (typeof relativeKeypath === 'object') {\n  \t\t\t\t// 'relativeKeypath' is in fact a hash, not a keypath\n  \t\t\t\treturn rootDot ? prefixKeypath(relativeKeypath, rootKeypath) : relativeKeypath;\n  \t\t\t}\n  \t\t};\n  \t}\n\n  \treturn prefixers[rootKeypath];\n  }\n\n  var hasProp = Object.prototype.hasOwnProperty;\n\n  function _updateFromBindings(model) {\n  \tmodel.updateFromBindings(true);\n  }\n\n  function _updateKeypathDependants(model) {\n  \tmodel.updateKeypathDependants();\n  }\n\n  var originatingModel = null;\n\n  var Model = (function () {\n  \tfunction Model(parent, key) {\n  \t\tclassCallCheck(this, Model);\n\n  \t\tthis.deps = [];\n\n  \t\tthis.children = [];\n  \t\tthis.childByKey = {};\n\n  \t\tthis.indexModels = [];\n\n  \t\tthis.unresolved = [];\n  \t\tthis.unresolvedByKey = {};\n\n  \t\tthis.bindings = [];\n\n  \t\tthis.value = undefined;\n\n  \t\tthis.ticker = null;\n\n  \t\tif (parent) {\n  \t\t\tthis.parent = parent;\n  \t\t\tthis.root = parent.root;\n  \t\t\tthis.key = key;\n  \t\t\tthis.isReadonly = parent.isReadonly;\n\n  \t\t\tif (parent.value) {\n  \t\t\t\tthis.value = parent.value[this.key];\n  \t\t\t\tthis.adapt();\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \tModel.prototype.adapt = function adapt() {\n  \t\tvar adaptors = this.root.adaptors;\n  \t\tvar value = this.value;\n  \t\tvar len = adaptors.length;\n\n  \t\t// TODO remove this legacy nonsense\n  \t\tvar ractive = this.root.ractive;\n  \t\tvar keypath = this.getKeypath();\n\n  \t\tvar i = undefined;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tvar adaptor = adaptors[i];\n  \t\t\tif (adaptor.filter(value, keypath, ractive)) {\n  \t\t\t\tthis.wrapper = adaptor.wrap(ractive, value, keypath, getPrefixer(keypath));\n  \t\t\t\tthis.wrapper.value = this.value;\n  \t\t\t\tthis.wrapper.__model = this; // massive temporary hack to enable array adaptor\n\n  \t\t\t\tthis.value = this.wrapper.get();\n\n  \t\t\t\tbreak;\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tModel.prototype.addUnresolved = function addUnresolved(key, resolver) {\n  \t\tif (!this.unresolvedByKey[key]) {\n  \t\t\tthis.unresolved.push(key);\n  \t\t\tthis.unresolvedByKey[key] = [];\n  \t\t}\n\n  \t\tthis.unresolvedByKey[key].push(resolver);\n  \t};\n\n  \tModel.prototype.animate = function animate(from, to, options, interpolator) {\n  \t\tvar _this = this;\n\n  \t\tif (this.ticker) this.ticker.stop();\n\n  \t\tvar fulfilPromise = undefined;\n  \t\tvar promise = new _Promise(function (fulfil) {\n  \t\t\treturn fulfilPromise = fulfil;\n  \t\t});\n\n  \t\tthis.ticker = new Ticker({\n  \t\t\tduration: options.duration,\n  \t\t\teasing: options.easing,\n  \t\t\tstep: function (t) {\n  \t\t\t\tvar value = interpolator(t);\n  \t\t\t\t_this.applyValue(value);\n  \t\t\t\tif (options.step) options.step(t, value);\n  \t\t\t},\n  \t\t\tcomplete: function () {\n  \t\t\t\t_this.applyValue(to);\n  \t\t\t\tif (options.complete) options.complete(to);\n\n  \t\t\t\t_this.ticker = null;\n  \t\t\t\tfulfilPromise();\n  \t\t\t}\n  \t\t});\n\n  \t\tpromise.stop = this.ticker.stop;\n  \t\treturn promise;\n  \t};\n\n  \tModel.prototype.applyValue = function applyValue(value) {\n  \t\tif (isEqual(value, this.value)) return;\n\n  \t\t// TODO deprecate this nonsense\n  \t\tthis.root.changes[this.getKeypath()] = value;\n\n  \t\tif (this.parent.wrapper && this.parent.wrapper.set) {\n  \t\t\tthis.parent.wrapper.set(this.key, value);\n  \t\t\tthis.parent.value = this.parent.wrapper.get();\n\n  \t\t\tthis.value = this.parent.value[this.key];\n  \t\t\t// TODO should this value be adapted? probably\n  \t\t} else if (this.wrapper) {\n  \t\t\t\tvar shouldTeardown = !this.wrapper.reset || this.wrapper.reset(value) === false;\n\n  \t\t\t\tif (shouldTeardown) {\n  \t\t\t\t\tthis.wrapper.teardown();\n  \t\t\t\t\tthis.wrapper = null;\n  \t\t\t\t\tthis.parent.value[this.key] = this.value = value;\n  \t\t\t\t\tthis.adapt();\n  \t\t\t\t} else {\n  \t\t\t\t\tthis.value = this.wrapper.get();\n  \t\t\t\t}\n  \t\t\t} else {\n  \t\t\t\tvar parentValue = this.parent.value || this.parent.createBranch(this.key);\n  \t\t\t\tparentValue[this.key] = value;\n\n  \t\t\t\tthis.value = value;\n  \t\t\t\tthis.adapt();\n  \t\t\t}\n\n  \t\tthis.parent.clearUnresolveds();\n  \t\tthis.clearUnresolveds();\n\n  \t\t// notify dependants\n  \t\tvar previousOriginatingModel = originatingModel; // for the array.length special case\n  \t\toriginatingModel = this;\n\n  \t\tthis.children.forEach(_mark);\n  \t\tthis.deps.forEach(_handleChange);\n\n  \t\tvar parent = this.parent;\n  \t\twhile (parent) {\n  \t\t\tparent.deps.forEach(_handleChange);\n  \t\t\tparent = parent.parent;\n  \t\t}\n\n  \t\toriginatingModel = previousOriginatingModel;\n  \t};\n\n  \tModel.prototype.clearUnresolveds = function clearUnresolveds(specificKey) {\n  \t\tvar i = this.unresolved.length;\n\n  \t\twhile (i--) {\n  \t\t\tvar key = this.unresolved[i];\n\n  \t\t\tif (specificKey && key !== specificKey) continue;\n\n  \t\t\tvar resolvers = this.unresolvedByKey[key];\n  \t\t\tvar hasKey = this.has(key);\n\n  \t\t\tvar j = resolvers.length;\n  \t\t\twhile (j--) {\n  \t\t\t\tif (hasKey) resolvers[j].attemptResolution();\n  \t\t\t\tif (resolvers[j].resolved) resolvers.splice(j, 1);\n  \t\t\t}\n\n  \t\t\tif (!resolvers.length) {\n  \t\t\t\tthis.unresolved.splice(i, 1);\n  \t\t\t\tthis.unresolvedByKey[key] = null;\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tModel.prototype.createBranch = function createBranch(key) {\n  \t\tvar branch = isNumeric(key) ? [] : {};\n  \t\tthis.set(branch);\n\n  \t\treturn branch;\n  \t};\n\n  \tModel.prototype.discard = function discard() {\n  \t\tvar _this2 = this;\n\n  \t\tthis.deps.forEach(function (d) {\n  \t\t\tif (d.boundsSensitive) _this2.unregister(d);\n  \t\t});\n  \t};\n\n  \tModel.prototype.findMatches = function findMatches(keys) {\n  \t\tvar len = keys.length;\n\n  \t\tvar existingMatches = [this];\n  \t\tvar matches = undefined;\n  \t\tvar i = undefined;\n\n  \t\tvar _loop = function () {\n  \t\t\tvar key = keys[i];\n\n  \t\t\tif (key === '*') {\n  \t\t\t\tmatches = [];\n  \t\t\t\texistingMatches.forEach(function (model) {\n  \t\t\t\t\tif (isArray(model.value)) {\n  \t\t\t\t\t\t// special case - array.length. This is a horrible kludge, but\n  \t\t\t\t\t\t// it'll do for now. Alternatives welcome\n  \t\t\t\t\t\tif (originatingModel && originatingModel.parent === model && originatingModel.key === 'length') {\n  \t\t\t\t\t\t\tmatches.push(originatingModel);\n  \t\t\t\t\t\t}\n\n  \t\t\t\t\t\tmodel.value.forEach(function (member, i) {\n  \t\t\t\t\t\t\tmatches.push(model.joinKey(i));\n  \t\t\t\t\t\t});\n  \t\t\t\t\t} else if (isObject(model.value) || typeof model.value === 'function') {\n  \t\t\t\t\t\tObject.keys(model.value).forEach(function (key) {\n  \t\t\t\t\t\t\tmatches.push(model.joinKey(key));\n  \t\t\t\t\t\t});\n\n  \t\t\t\t\t\t// special case - computed properties. TODO mappings also?\n  \t\t\t\t\t\tif (model.isRoot) {\n  \t\t\t\t\t\t\tObject.keys(model.computations).forEach(function (key) {\n  \t\t\t\t\t\t\t\tmatches.push(model.joinKey(key));\n  \t\t\t\t\t\t\t});\n  \t\t\t\t\t\t}\n  \t\t\t\t\t}\n  \t\t\t\t});\n  \t\t\t} else {\n  \t\t\t\tmatches = existingMatches.map(function (model) {\n  \t\t\t\t\treturn model.joinKey(key);\n  \t\t\t\t});\n  \t\t\t}\n\n  \t\t\texistingMatches = matches;\n  \t\t};\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\t_loop();\n  \t\t}\n\n  \t\treturn matches;\n  \t};\n\n  \tModel.prototype.get = function get(shouldCapture) {\n  \t\tif (shouldCapture) capture(this);\n  \t\treturn this.value;\n  \t};\n\n  \tModel.prototype.getIndexModel = function getIndexModel(fragmentIndex) {\n  \t\tvar indexModels = this.parent.indexModels;\n\n  \t\t// non-numeric keys are a special of a numeric index in a object iteration\n  \t\tif (typeof this.key === 'string' && fragmentIndex !== undefined) {\n  \t\t\treturn new KeyModel(fragmentIndex);\n  \t\t} else if (!indexModels[this.key]) {\n  \t\t\tindexModels[this.key] = new KeyModel(this.key);\n  \t\t}\n\n  \t\treturn indexModels[this.key];\n  \t};\n\n  \tModel.prototype.getKeyModel = function getKeyModel() {\n  \t\t// TODO... different to IndexModel because key can never change\n  \t\treturn new KeyModel(this.key);\n  \t};\n\n  \tModel.prototype.getKeypathModel = function getKeypathModel() {\n  \t\treturn this.keypathModel || (this.keypathModel = new KeypathModel(this));\n  \t};\n\n  \tModel.prototype.getKeypath = function getKeypath() {\n  \t\t// TODO keypaths inside components... tricky\n  \t\treturn this.parent.isRoot ? this.key : this.parent.getKeypath() + '.' + this.key;\n  \t};\n\n  \tModel.prototype.has = function has(key) {\n  \t\tvar value = this.get();\n  \t\treturn value && hasProp.call(value, key);\n  \t};\n\n  \tModel.prototype.joinKey = function joinKey(key) {\n  \t\tif (key === undefined || key === '') return this;\n\n  \t\tif (!this.childByKey.hasOwnProperty(key)) {\n  \t\t\tvar child = new Model(this, key);\n  \t\t\tthis.children.push(child);\n  \t\t\tthis.childByKey[key] = child;\n  \t\t}\n\n  \t\treturn this.childByKey[key];\n  \t};\n\n  \tModel.prototype.joinAll = function joinAll(keys) {\n  \t\tvar model = this;\n  \t\tfor (var i = 0; i < keys.length; i += 1) {\n  \t\t\tmodel = model.joinKey(keys[i]);\n  \t\t}\n\n  \t\treturn model;\n  \t};\n\n  \tModel.prototype.mark = function mark() {\n  \t\tvar value = this.retrieve();\n\n  \t\tif (!isEqual(value, this.value)) {\n  \t\t\tthis.value = value;\n\n  \t\t\tthis.children.forEach(_mark);\n\n  \t\t\tthis.deps.forEach(_handleChange);\n  \t\t\tthis.clearUnresolveds();\n  \t\t}\n  \t};\n\n  \tModel.prototype.merge = function merge(array, comparator) {\n  \t\tvar oldArray = comparator ? this.value.map(comparator) : this.value;\n  \t\tvar newArray = comparator ? array.map(comparator) : array;\n\n  \t\tvar oldLength = oldArray.length;\n\n  \t\tvar usedIndices = {};\n  \t\tvar firstUnusedIndex = 0;\n\n  \t\tvar newIndices = oldArray.map(function (item) {\n  \t\t\tvar index = undefined;\n  \t\t\tvar start = firstUnusedIndex;\n\n  \t\t\tdo {\n  \t\t\t\tindex = newArray.indexOf(item, start);\n\n  \t\t\t\tif (index === -1) {\n  \t\t\t\t\treturn -1;\n  \t\t\t\t}\n\n  \t\t\t\tstart = index + 1;\n  \t\t\t} while (usedIndices[index] === true && start < oldLength);\n\n  \t\t\t// keep track of the first unused index, so we don't search\n  \t\t\t// the whole of newArray for each item in oldArray unnecessarily\n  \t\t\tif (index === firstUnusedIndex) {\n  \t\t\t\tfirstUnusedIndex += 1;\n  \t\t\t}\n  \t\t\t// allow next instance of next \"equal\" to be found item\n  \t\t\tusedIndices[index] = true;\n  \t\t\treturn index;\n  \t\t});\n\n  \t\tthis.parent.value[this.key] = array;\n  \t\tthis._merged = true;\n  \t\tthis.shuffle(newIndices);\n  \t};\n\n  \tModel.prototype.register = function register(dep) {\n  \t\tthis.deps.push(dep);\n  \t};\n\n  \tModel.prototype.registerTwowayBinding = function registerTwowayBinding(binding) {\n  \t\tthis.bindings.push(binding);\n  \t};\n\n  \tModel.prototype.retrieve = function retrieve() {\n  \t\treturn this.parent.value ? this.parent.value[this.key] : undefined;\n  \t};\n\n  \tModel.prototype.set = function set(value) {\n  \t\tif (this.ticker) this.ticker.stop();\n  \t\tthis.applyValue(value);\n  \t};\n\n  \tModel.prototype.shuffle = function shuffle(newIndices) {\n  \t\tvar _this3 = this;\n\n  \t\tvar indexModels = [];\n  \t\tvar max = 0,\n  \t\t    child = undefined;\n\n  \t\tnewIndices.forEach(function (newIndex, oldIndex) {\n  \t\t\tif (newIndex > max) max = newIndex;\n\n  \t\t\tif (! ~newIndex) return;\n\n  \t\t\tvar model = _this3.indexModels[oldIndex];\n\n  \t\t\tif (!model) return;\n\n  \t\t\tindexModels[newIndex] = model;\n\n  \t\t\tif (newIndex !== oldIndex) {\n  \t\t\t\tmodel.rebind(newIndex);\n  \t\t\t}\n  \t\t});\n\n  \t\t// some children, notably computations, need to be notified when they are\n  \t\t// no longer attached to anything so they don't recompute\n  \t\twhile (child = this.childByKey[++max]) {\n  \t\t\tif (typeof child.discard === 'function') child.discard();\n  \t\t}\n\n  \t\tthis.indexModels = indexModels;\n\n  \t\t// shuffles need to happen before marks...\n  \t\tthis.deps.forEach(function (dep) {\n  \t\t\tif (dep.shuffle) dep.shuffle(newIndices);\n  \t\t});\n\n  \t\tthis.updateKeypathDependants();\n  \t\tthis.mark();\n\n  \t\t// ...but handleChange must happen after (TODO document why)\n  \t\tthis.deps.forEach(function (dep) {\n  \t\t\tif (!dep.shuffle) dep.handleChange();\n  \t\t});\n  \t};\n\n  \tModel.prototype.teardown = function teardown() {\n  \t\tthis.children.forEach(_teardown);\n  \t\tif (this.wrapper) this.wrapper.teardown();\n  \t};\n\n  \tModel.prototype.unregister = function unregister(dependant) {\n  \t\tremoveFromArray(this.deps, dependant);\n  \t};\n\n  \tModel.prototype.unregisterTwowayBinding = function unregisterTwowayBinding(binding) {\n  \t\tremoveFromArray(this.bindings, binding);\n  \t};\n\n  \tModel.prototype.updateFromBindings = function updateFromBindings(cascade) {\n  \t\tvar i = this.bindings.length;\n  \t\twhile (i--) {\n  \t\t\tvar value = this.bindings[i].getValue();\n  \t\t\tif (value !== this.value) this.set(value);\n  \t\t}\n\n  \t\tif (cascade) {\n  \t\t\tthis.children.forEach(_updateFromBindings);\n  \t\t}\n  \t};\n\n  \tModel.prototype.updateKeypathDependants = function updateKeypathDependants() {\n  \t\tthis.children.forEach(_updateKeypathDependants);\n  \t\tif (this.keypathModel) this.keypathModel.handleChange();\n  \t};\n\n  \treturn Model;\n  })();\n\n  var ComputationChild = (function (_Model) {\n  \tinherits(ComputationChild, _Model);\n\n  \tfunction ComputationChild() {\n  \t\tclassCallCheck(this, ComputationChild);\n\n  \t\t_Model.apply(this, arguments);\n  \t}\n\n  \tComputationChild.prototype.get = function get(shouldCapture) {\n  \t\tif (shouldCapture) capture(this);\n\n  \t\tvar parentValue = this.parent.get();\n  \t\treturn parentValue ? parentValue[this.key] : undefined;\n  \t};\n\n  \tComputationChild.prototype.handleChange = function handleChange() {\n  \t\tthis.dirty = true;\n\n  \t\tthis.deps.forEach(_handleChange);\n  \t\tthis.children.forEach(_handleChange);\n  \t\tthis.clearUnresolveds(); // TODO is this necessary?\n  \t};\n\n  \tComputationChild.prototype.joinKey = function joinKey(key) {\n  \t\tif (key === undefined || key === '') return this;\n\n  \t\tif (!this.childByKey.hasOwnProperty(key)) {\n  \t\t\tvar child = new ComputationChild(this, key);\n  \t\t\tthis.children.push(child);\n  \t\t\tthis.childByKey[key] = child;\n  \t\t}\n\n  \t\treturn this.childByKey[key];\n  \t};\n\n  \t// TODO this causes problems with inter-component mappings\n  \t// set () {\n  \t// \tthrow new Error( `Cannot set read-only property of computed value (${this.getKeypath()})` );\n  \t// }\n  \treturn ComputationChild;\n  })(Model);\n\n  function resolveReference(fragment, ref) {\n  \tvar context = fragment.findContext();\n\n  \t// special references\n  \t// TODO does `this` become `.` at parse time?\n  \tif (ref === '.' || ref === 'this') return context;\n  \tif (ref === '@keypath') return context.getKeypathModel();\n  \tif (ref === '@index') {\n  \t\tvar repeater = fragment.findRepeatingFragment();\n  \t\t// make sure the found fragment is actually an iteration\n  \t\tif (!repeater.isIteration) return;\n  \t\treturn repeater.context.getIndexModel(repeater.index);\n  \t}\n  \tif (ref === '@key') return fragment.findRepeatingFragment().context.getKeyModel();\n\n  \t// ancestor references\n  \tif (ref[0] === '~') return context.root.joinAll(ref.slice(2).split('.'));\n  \tif (ref[0] === '.') {\n  \t\tvar parts = ref.split('/');\n\n  \t\twhile (parts[0] === '.' || parts[0] === '..') {\n  \t\t\tvar part = parts.shift();\n\n  \t\t\tif (part === '..') {\n  \t\t\t\tcontext = context.parent;\n  \t\t\t}\n  \t\t}\n\n  \t\tref = parts.join('/');\n\n  \t\t// special case - `{{.foo}}` means the same as `{{./foo}}`\n  \t\tif (ref[0] === '.') ref = ref.slice(1);\n  \t\treturn context.joinAll(ref.split('.'));\n  \t}\n\n  \treturn resolveAmbiguousReference(fragment, ref);\n  }\n\n  var functionCache = {};\n  function createFunction(str, i) {\n  \tif (functionCache[str]) return functionCache[str];\n\n  \tvar args = new Array(i);\n  \twhile (i--) args[i] = \"_\" + i;\n\n  \tvar fn = new Function(args.join(','), \"return (\" + str + \")\");\n\n  \treturn functionCache[str] = fn;\n  }\n\n  function __getValue(model) {\n  \treturn model ? model.get(true) : undefined;\n  }\n\n  var ExpressionProxy = (function (_Model) {\n  \tinherits(ExpressionProxy, _Model);\n\n  \tfunction ExpressionProxy(fragment, template) {\n  \t\tvar _this = this;\n\n  \t\tclassCallCheck(this, ExpressionProxy);\n\n  \t\t_Model.call(this, fragment.ractive.viewmodel, null);\n\n  \t\tthis.fragment = fragment;\n  \t\tthis.template = template;\n\n  \t\tthis.isReadonly = true;\n\n  \t\tthis.fn = createFunction(template.s, template.r.length);\n  \t\tthis.computation = null;\n\n  \t\tthis.resolvers = [];\n  \t\tthis.models = template.r.map(function (ref, index) {\n  \t\t\tvar model = resolveReference(fragment, ref);\n  \t\t\tvar resolver = undefined;\n\n  \t\t\tif (!model) {\n  \t\t\t\tresolver = fragment.resolve(ref, function (model) {\n  \t\t\t\t\tremoveFromArray(_this.resolvers, resolver);\n  \t\t\t\t\t_this.models[index] = model;\n  \t\t\t\t\t_this.bubble();\n  \t\t\t\t});\n\n  \t\t\t\t_this.resolvers.push(resolver);\n  \t\t\t}\n\n  \t\t\treturn model;\n  \t\t});\n\n  \t\tthis.bubble();\n  \t}\n\n  \tExpressionProxy.prototype.bubble = function bubble() {\n  \t\tvar _this2 = this;\n\n  \t\tvar ractive = this.fragment.ractive;\n\n  \t\t// TODO the @ prevents computed props from shadowing keypaths, but the real\n  \t\t// question is why it's a computed prop in the first place... (hint, it's\n  \t\t// to do with {{else}} blocks)\n  \t\tvar key = '@' + this.template.s.replace(/_(\\d+)/g, function (match, i) {\n  \t\t\tif (i >= _this2.models.length) return match;\n\n  \t\t\tvar model = _this2.models[i];\n  \t\t\treturn model ? model.getKeypath() : '@undefined';\n  \t\t});\n\n  \t\t// TODO can/should we reuse computations?\n  \t\tvar signature = {\n  \t\t\tgetter: function () {\n  \t\t\t\tvar values = _this2.models.map(__getValue);\n  \t\t\t\treturn _this2.fn.apply(ractive, values);\n  \t\t\t},\n  \t\t\tgetterString: key\n  \t\t};\n\n  \t\tvar computation = ractive.viewmodel.compute(key, signature);\n\n  \t\tthis.value = computation.get(); // TODO should not need this, eventually\n\n  \t\tif (this.computation) {\n  \t\t\tthis.computation.unregister(this);\n  \t\t\t// notify children...\n  \t\t}\n\n  \t\tthis.computation = computation;\n  \t\tcomputation.register(this);\n  \t};\n\n  \tExpressionProxy.prototype.get = function get() {\n  \t\treturn this.computation.get();\n  \t};\n\n  \tExpressionProxy.prototype.getKeypath = function getKeypath() {\n  \t\treturn this.computation ? this.computation.getKeypath() : '@undefined';\n  \t};\n\n  \tExpressionProxy.prototype.handleChange = function handleChange() {\n  \t\tthis.deps.forEach(_handleChange);\n  \t\tthis.children.forEach(_handleChange);\n\n  \t\tthis.clearUnresolveds();\n  \t};\n\n  \tExpressionProxy.prototype.joinKey = function joinKey(key) {\n  \t\tif (key === undefined || key === '') return this;\n\n  \t\tif (!this.childByKey.hasOwnProperty(key)) {\n  \t\t\tvar child = new ComputationChild(this, key);\n  \t\t\tthis.children.push(child);\n  \t\t\tthis.childByKey[key] = child;\n  \t\t}\n\n  \t\treturn this.childByKey[key];\n  \t};\n\n  \tExpressionProxy.prototype.mark = function mark() {\n  \t\tthis.handleChange();\n  \t};\n\n  \tExpressionProxy.prototype.retrieve = function retrieve() {\n  \t\treturn this.get();\n  \t};\n\n  \tExpressionProxy.prototype.unbind = function unbind() {\n  \t\tthis.resolvers.forEach(_unbind);\n  \t};\n\n  \treturn ExpressionProxy;\n  })(Model);\n\n  var ReferenceExpressionProxy = (function (_Model) {\n  \tinherits(ReferenceExpressionProxy, _Model);\n\n  \tfunction ReferenceExpressionProxy(fragment, template) {\n  \t\tvar _this = this;\n\n  \t\tclassCallCheck(this, ReferenceExpressionProxy);\n\n  \t\t_Model.call(this, null, null);\n  \t\tthis.root = fragment.ractive.viewmodel;\n\n  \t\tthis.resolvers = [];\n\n  \t\tthis.base = _resolve(fragment, template);\n  \t\tvar baseResolver = undefined;\n\n  \t\tif (!this.base) {\n  \t\t\tbaseResolver = fragment.resolve(template.r, function (model) {\n  \t\t\t\t_this.base = model;\n  \t\t\t\t_this.bubble();\n\n  \t\t\t\tremoveFromArray(_this.resolvers, baseResolver);\n  \t\t\t});\n\n  \t\t\tthis.resolvers.push(baseResolver);\n  \t\t}\n\n  \t\tvar intermediary = {\n  \t\t\thandleChange: function () {\n  \t\t\t\treturn _this.bubble();\n  \t\t\t}\n  \t\t};\n\n  \t\tthis.members = template.m.map(function (template, i) {\n  \t\t\tif (typeof template === 'string') {\n  \t\t\t\treturn { get: function () {\n  \t\t\t\t\t\treturn template;\n  \t\t\t\t\t} };\n  \t\t\t}\n\n  \t\t\tvar model = undefined;\n  \t\t\tvar resolver = undefined;\n\n  \t\t\tif (template.t === REFERENCE) {\n  \t\t\t\tmodel = resolveReference(fragment, template.n);\n\n  \t\t\t\tif (model) {\n  \t\t\t\t\tmodel.register(intermediary);\n  \t\t\t\t} else {\n  \t\t\t\t\tresolver = fragment.resolve(template.n, function (model) {\n  \t\t\t\t\t\t_this.members[i] = model;\n\n  \t\t\t\t\t\tmodel.register(intermediary);\n  \t\t\t\t\t\t_this.bubble();\n\n  \t\t\t\t\t\tremoveFromArray(_this.resolvers, resolver);\n  \t\t\t\t\t});\n\n  \t\t\t\t\t_this.resolvers.push(resolver);\n  \t\t\t\t}\n\n  \t\t\t\treturn model;\n  \t\t\t}\n\n  \t\t\tmodel = new ExpressionProxy(fragment, template);\n  \t\t\tmodel.register(intermediary);\n  \t\t\treturn model;\n  \t\t});\n\n  \t\tthis.isUnresolved = true;\n  \t\tthis.bubble();\n  \t}\n\n  \tReferenceExpressionProxy.prototype.bubble = function bubble() {\n  \t\tif (!this.base) return;\n\n  \t\t// if some members are not resolved, abort\n  \t\tvar i = this.members.length;\n  \t\twhile (i--) {\n  \t\t\tif (!this.members[i] || this.members[i].get() === undefined) return;\n  \t\t}\n\n  \t\tthis.isUnresolved = false;\n\n  \t\tvar keys = this.members.map(function (model) {\n  \t\t\treturn model.get();\n  \t\t});\n  \t\tvar model = this.base.joinAll(keys);\n\n  \t\tif (this.model) {\n  \t\t\tthis.model.unregister(this);\n  \t\t\tthis.model.unregisterTwowayBinding(this);\n  \t\t}\n\n  \t\tthis.model = model;\n  \t\tthis.parent = model.parent;\n\n  \t\tmodel.register(this);\n  \t\tmodel.registerTwowayBinding(this);\n\n  \t\tif (this.keypathModel) this.keypathModel.handleChange();\n\n  \t\tthis.mark();\n  \t};\n\n  \tReferenceExpressionProxy.prototype.forceResolution = function forceResolution() {\n  \t\tthis.resolvers.forEach(function (resolver) {\n  \t\t\treturn resolver.forceResolution();\n  \t\t});\n  \t\tthis.bubble();\n  \t};\n\n  \tReferenceExpressionProxy.prototype.get = function get() {\n  \t\treturn this.model ? this.model.get() : undefined;\n  \t};\n\n  \t// indirect two-way bindings\n\n  \tReferenceExpressionProxy.prototype.getValue = function getValue() {\n  \t\tvar i = this.bindings.length;\n  \t\twhile (i--) {\n  \t\t\tvar value = this.bindings[i].getValue();\n  \t\t\tif (value !== this.value) return value;\n  \t\t}\n\n  \t\treturn this.value;\n  \t};\n\n  \tReferenceExpressionProxy.prototype.getKeypath = function getKeypath() {\n  \t\treturn this.model ? this.model.getKeypath() : '@undefined';\n  \t};\n\n  \tReferenceExpressionProxy.prototype.handleChange = function handleChange() {\n  \t\tthis.mark();\n  \t};\n\n  \tReferenceExpressionProxy.prototype.retrieve = function retrieve() {\n  \t\treturn this.get();\n  \t};\n\n  \tReferenceExpressionProxy.prototype.set = function set(value) {\n  \t\tif (!this.model) throw new Error('Unresolved reference expression. This should not happen!');\n  \t\tthis.model.set(value);\n  \t};\n\n  \tReferenceExpressionProxy.prototype.unbind = function unbind() {\n  \t\tthis.resolvers.forEach(_unbind);\n  \t};\n\n  \treturn ReferenceExpressionProxy;\n  })(Model);\n\n  function _resolve(fragment, template) {\n  \tif (template.r) {\n  \t\treturn resolveReference(fragment, template.r);\n  \t} else if (template.x) {\n  \t\treturn new ExpressionProxy(fragment, template.x);\n  \t} else {\n  \t\treturn new ReferenceExpressionProxy(fragment, template.rx);\n  \t}\n  }\n\n  var Mustache = (function (_Item) {\n  \tinherits(Mustache, _Item);\n\n  \tfunction Mustache(options) {\n  \t\tclassCallCheck(this, Mustache);\n\n  \t\t_Item.call(this, options);\n\n  \t\tthis.parentFragment = options.parentFragment;\n  \t\tthis.template = options.template;\n  \t\tthis.index = options.index;\n\n  \t\tthis.isStatic = !!options.template.s;\n\n  \t\tthis.model = null;\n  \t\tthis.dirty = false;\n  \t}\n\n  \tMustache.prototype.bind = function bind() {\n  \t\tvar _this = this;\n\n  \t\t// try to find a model for this view\n  \t\tvar model = _resolve(this.parentFragment, this.template);\n  \t\tvar value = model ? model.get() : undefined;\n\n  \t\tif (this.isStatic) {\n  \t\t\tthis.model = { get: function () {\n  \t\t\t\t\treturn value;\n  \t\t\t\t} };\n  \t\t\treturn;\n  \t\t}\n\n  \t\tif (model) {\n  \t\t\tmodel.register(this);\n  \t\t\tthis.model = model;\n  \t\t} else {\n  \t\t\tthis.resolver = this.parentFragment.resolve(this.template.r, function (model) {\n  \t\t\t\t_this.model = model;\n  \t\t\t\tmodel.register(_this);\n\n  \t\t\t\t_this.handleChange();\n  \t\t\t\t_this.resolver = null;\n  \t\t\t});\n  \t\t}\n  \t};\n\n  \tMustache.prototype.handleChange = function handleChange() {\n  \t\tthis.bubble();\n  \t};\n\n  \tMustache.prototype.rebind = function rebind() {\n  \t\tif (this.isStatic || !this.model) return;\n\n  \t\tvar model = _resolve(this.parentFragment, this.template);\n\n  \t\tif (model === this.model) return;\n\n  \t\tvar oldValue = this.model.get();\n  \t\tthis.model.unregister(this);\n\n  \t\tthis.model = model;\n\n  \t\tif (model) {\n  \t\t\tmodel.register(this);\n  \t\t\tif (model.get() !== oldValue) this.handleChange();\n  \t\t}\n  \t};\n\n  \tMustache.prototype.unbind = function unbind() {\n  \t\tif (!this.isStatic) {\n  \t\t\tthis.model && this.model.unregister(this);\n  \t\t\tthis.resolver && this.resolver.unbind();\n  \t\t}\n  \t};\n\n  \treturn Mustache;\n  })(Item);\n\n  // https://github.com/kangax/html-minifier/issues/63#issuecomment-37763316\n  var booleanAttributes = /^(allowFullscreen|async|autofocus|autoplay|checked|compact|controls|declare|default|defaultChecked|defaultMuted|defaultSelected|defer|disabled|enabled|formNoValidate|hidden|indeterminate|inert|isMap|itemScope|loop|multiple|muted|noHref|noResize|noShade|noValidate|noWrap|open|pauseOnExit|readOnly|required|reversed|scoped|seamless|selected|sortable|translate|trueSpeed|typeMustMatch|visible)$/i;\n  var voidElementNames = /^(?:area|base|br|col|command|doctype|embed|hr|img|input|keygen|link|meta|param|source|track|wbr)$/i;\n\n  var htmlEntities = { quot: 34, amp: 38, apos: 39, lt: 60, gt: 62, nbsp: 160, iexcl: 161, cent: 162, pound: 163, curren: 164, yen: 165, brvbar: 166, sect: 167, uml: 168, copy: 169, ordf: 170, laquo: 171, not: 172, shy: 173, reg: 174, macr: 175, deg: 176, plusmn: 177, sup2: 178, sup3: 179, acute: 180, micro: 181, para: 182, middot: 183, cedil: 184, sup1: 185, ordm: 186, raquo: 187, frac14: 188, frac12: 189, frac34: 190, iquest: 191, Agrave: 192, Aacute: 193, Acirc: 194, Atilde: 195, Auml: 196, Aring: 197, AElig: 198, Ccedil: 199, Egrave: 200, Eacute: 201, Ecirc: 202, Euml: 203, Igrave: 204, Iacute: 205, Icirc: 206, Iuml: 207, ETH: 208, Ntilde: 209, Ograve: 210, Oacute: 211, Ocirc: 212, Otilde: 213, Ouml: 214, times: 215, Oslash: 216, Ugrave: 217, Uacute: 218, Ucirc: 219, Uuml: 220, Yacute: 221, THORN: 222, szlig: 223, agrave: 224, aacute: 225, acirc: 226, atilde: 227, auml: 228, aring: 229, aelig: 230, ccedil: 231, egrave: 232, eacute: 233, ecirc: 234, euml: 235, igrave: 236, iacute: 237, icirc: 238, iuml: 239, eth: 240, ntilde: 241, ograve: 242, oacute: 243, ocirc: 244, otilde: 245, ouml: 246, divide: 247, oslash: 248, ugrave: 249, uacute: 250, ucirc: 251, uuml: 252, yacute: 253, thorn: 254, yuml: 255, OElig: 338, oelig: 339, Scaron: 352, scaron: 353, Yuml: 376, fnof: 402, circ: 710, tilde: 732, Alpha: 913, Beta: 914, Gamma: 915, Delta: 916, Epsilon: 917, Zeta: 918, Eta: 919, Theta: 920, Iota: 921, Kappa: 922, Lambda: 923, Mu: 924, Nu: 925, Xi: 926, Omicron: 927, Pi: 928, Rho: 929, Sigma: 931, Tau: 932, Upsilon: 933, Phi: 934, Chi: 935, Psi: 936, Omega: 937, alpha: 945, beta: 946, gamma: 947, delta: 948, epsilon: 949, zeta: 950, eta: 951, theta: 952, iota: 953, kappa: 954, lambda: 955, mu: 956, nu: 957, xi: 958, omicron: 959, pi: 960, rho: 961, sigmaf: 962, sigma: 963, tau: 964, upsilon: 965, phi: 966, chi: 967, psi: 968, omega: 969, thetasym: 977, upsih: 978, piv: 982, ensp: 8194, emsp: 8195, thinsp: 8201, zwnj: 8204, zwj: 8205, lrm: 8206, rlm: 8207, ndash: 8211, mdash: 8212, lsquo: 8216, rsquo: 8217, sbquo: 8218, ldquo: 8220, rdquo: 8221, bdquo: 8222, dagger: 8224, Dagger: 8225, bull: 8226, hellip: 8230, permil: 8240, prime: 8242, Prime: 8243, lsaquo: 8249, rsaquo: 8250, oline: 8254, frasl: 8260, euro: 8364, image: 8465, weierp: 8472, real: 8476, trade: 8482, alefsym: 8501, larr: 8592, uarr: 8593, rarr: 8594, darr: 8595, harr: 8596, crarr: 8629, lArr: 8656, uArr: 8657, rArr: 8658, dArr: 8659, hArr: 8660, forall: 8704, part: 8706, exist: 8707, empty: 8709, nabla: 8711, isin: 8712, notin: 8713, ni: 8715, prod: 8719, sum: 8721, minus: 8722, lowast: 8727, radic: 8730, prop: 8733, infin: 8734, ang: 8736, and: 8743, or: 8744, cap: 8745, cup: 8746, 'int': 8747, there4: 8756, sim: 8764, cong: 8773, asymp: 8776, ne: 8800, equiv: 8801, le: 8804, ge: 8805, sub: 8834, sup: 8835, nsub: 8836, sube: 8838, supe: 8839, oplus: 8853, otimes: 8855, perp: 8869, sdot: 8901, lceil: 8968, rceil: 8969, lfloor: 8970, rfloor: 8971, lang: 9001, rang: 9002, loz: 9674, spades: 9824, clubs: 9827, hearts: 9829, diams: 9830 };\n  var controlCharacters = [8364, 129, 8218, 402, 8222, 8230, 8224, 8225, 710, 8240, 352, 8249, 338, 141, 381, 143, 144, 8216, 8217, 8220, 8221, 8226, 8211, 8212, 732, 8482, 353, 8250, 339, 157, 382, 376];\n  var entityPattern = new RegExp('&(#?(?:x[\\\\w\\\\d]+|\\\\d+|' + Object.keys(htmlEntities).join('|') + '));?', 'g');\n\n  function decodeCharacterReferences(html) {\n  \treturn html.replace(entityPattern, function (match, entity) {\n  \t\tvar code;\n\n  \t\t// Handle named entities\n  \t\tif (entity[0] !== '#') {\n  \t\t\tcode = htmlEntities[entity];\n  \t\t} else if (entity[1] === 'x') {\n  \t\t\tcode = parseInt(entity.substring(2), 16);\n  \t\t} else {\n  \t\t\tcode = parseInt(entity.substring(1), 10);\n  \t\t}\n\n  \t\tif (!code) {\n  \t\t\treturn match;\n  \t\t}\n\n  \t\treturn String.fromCharCode(validateCode(code));\n  \t});\n  }\n\n  var lessThan = /</g;\n  var greaterThan = />/g;\n  var amp = /&/g;\n\n  function escapeHtml(str) {\n  \treturn str.replace(amp, '&amp;').replace(lessThan, '&lt;').replace(greaterThan, '&gt;');\n  }\n\n  // some code points are verboten. If we were inserting HTML, the browser would replace the illegal\n  // code points with alternatives in some cases - since we're bypassing that mechanism, we need\n  // to replace them ourselves\n  //\n  // Source: http://en.wikipedia.org/wiki/Character_encodings_in_HTML#Illegal_characters\n  function validateCode(code) {\n  \tif (!code) {\n  \t\treturn 65533;\n  \t}\n\n  \t// line feed becomes generic whitespace\n  \tif (code === 10) {\n  \t\treturn 32;\n  \t}\n\n  \t// ASCII range. (Why someone would use HTML entities for ASCII characters I don't know, but...)\n  \tif (code < 128) {\n  \t\treturn code;\n  \t}\n\n  \t// code points 128-159 are dealt with leniently by browsers, but they're incorrect. We need\n  \t// to correct the mistake or we'll end up with missing  signs and so on\n  \tif (code <= 159) {\n  \t\treturn controlCharacters[code - 128];\n  \t}\n\n  \t// basic multilingual plane\n  \tif (code < 55296) {\n  \t\treturn code;\n  \t}\n\n  \t// UTF-16 surrogate halves\n  \tif (code <= 57343) {\n  \t\treturn 65533;\n  \t}\n\n  \t// rest of the basic multilingual plane\n  \tif (code <= 65535) {\n  \t\treturn code;\n  \t}\n\n  \treturn 65533;\n  }\n\n  var Interpolator = (function (_Mustache) {\n  \tinherits(Interpolator, _Mustache);\n\n  \tfunction Interpolator() {\n  \t\tclassCallCheck(this, Interpolator);\n\n  \t\t_Mustache.apply(this, arguments);\n  \t}\n\n  \tInterpolator.prototype.detach = function detach() {\n  \t\treturn detachNode(this.node);\n  \t};\n\n  \tInterpolator.prototype.firstNode = function firstNode() {\n  \t\treturn this.node;\n  \t};\n\n  \tInterpolator.prototype.getString = function getString() {\n  \t\treturn this.model ? safeToStringValue(this.model.get()) : '';\n  \t};\n\n  \tInterpolator.prototype.render = function render(target) {\n  \t\tthis.rendered = true;\n  \t\tthis.node = doc.createTextNode(this.getString());\n\n  \t\ttarget.appendChild(this.node);\n  \t};\n\n  \tInterpolator.prototype.toString = function toString(escape) {\n  \t\tvar string = this.getString();\n  \t\treturn escape ? escapeHtml(string) : string;\n  \t};\n\n  \tInterpolator.prototype.unrender = function unrender(shouldDestroy) {\n  \t\tif (shouldDestroy) this.detach();\n  \t\tthis.rendered = false;\n  \t};\n\n  \tInterpolator.prototype.update = function update() {\n  \t\tif (this.dirty) {\n  \t\t\tif (this.rendered) {\n  \t\t\t\tthis.node.data = this.getString();\n  \t\t\t}\n\n  \t\t\tthis.dirty = false;\n  \t\t}\n  \t};\n\n  \tInterpolator.prototype.valueOf = function valueOf() {\n  \t\treturn this.model ? this.model.get() : undefined;\n  \t};\n\n  \treturn Interpolator;\n  })(Mustache);\n\n  var parse = null;\n\n  var _parseOptions = ['preserveWhitespace', 'sanitize', 'stripComments', 'delimiters', 'tripleDelimiters', 'interpolate'];\n\n  var _parser = {\n  \tfromId: fromId, isHashedId: isHashedId, isParsed: isParsed, getParseOptions: getParseOptions, createHelper: _createHelper,\n  \tparse: doParse\n  };\n\n  function _createHelper(parseOptions) {\n  \tvar helper = create(_parser);\n  \thelper.parse = function (template, options) {\n  \t\treturn doParse(template, options || parseOptions);\n  \t};\n  \treturn helper;\n  }\n\n  function doParse(template, parseOptions) {\n  \tif (!parse) {\n  \t\tthrow new Error('Missing Ractive.parse - cannot parse template. Either preparse or use the version that includes the parser');\n  \t}\n\n  \treturn parse(template, parseOptions || this.options);\n  }\n\n  function fromId(id, options) {\n  \tif (!doc) {\n  \t\tif (options && options.noThrow) {\n  \t\t\treturn;\n  \t\t}\n  \t\tthrow new Error('Cannot retrieve template #' + id + ' as Ractive is not running in a browser.');\n  \t}\n\n  \tif (isHashedId(id)) id = id.substring(1);\n\n  \tvar template = undefined;\n\n  \tif (!(template = doc.getElementById(id))) {\n  \t\tif (options && options.noThrow) {\n  \t\t\treturn;\n  \t\t}\n  \t\tthrow new Error('Could not find template element with id #' + id);\n  \t}\n\n  \tif (template.tagName.toUpperCase() !== 'SCRIPT') {\n  \t\tif (options && options.noThrow) {\n  \t\t\treturn;\n  \t\t}\n  \t\tthrow new Error('Template element with id #' + id + ', must be a <script> element');\n  \t}\n\n  \treturn 'textContent' in template ? template.textContent : template.innerHTML;\n  }\n\n  function isHashedId(id) {\n  \treturn id && id[0] === '#';\n  }\n\n  function isParsed(template) {\n  \treturn !(typeof template === 'string');\n  }\n\n  function getParseOptions(ractive) {\n  \t// Could be Ractive or a Component\n  \tif (ractive.defaults) {\n  \t\tractive = ractive.defaults;\n  \t}\n\n  \treturn _parseOptions.reduce(function (val, key) {\n  \t\tval[key] = ractive[key];\n  \t\treturn val;\n  \t}, {});\n  }\n\n  function findInViewHierarchy(registryName, ractive, name) {\n  \tvar instance = findInstance(registryName, ractive, name);\n  \treturn instance ? instance[registryName][name] : null;\n  }\n\n  function findInstance(registryName, ractive, name) {\n  \twhile (ractive) {\n  \t\tif (name in ractive[registryName]) {\n  \t\t\treturn ractive;\n  \t\t}\n\n  \t\tif (ractive.isolated) {\n  \t\t\treturn null;\n  \t\t}\n\n  \t\tractive = ractive.parent;\n  \t}\n  }\n\n  function getPartialTemplate(ractive, name, parentFragment) {\n  \t// If the partial in instance or view heirarchy instances, great\n  \tvar partial = getPartialFromRegistry(ractive, name, parentFragment || {});\n  \tif (partial) return partial;\n\n  \t// Does it exist on the page as a script tag?\n  \tpartial = _parser.fromId(name, { noThrow: true });\n  \tif (partial) {\n  \t\t// parse and register to this ractive instance\n  \t\tvar parsed = _parser.parse(partial, _parser.getParseOptions(ractive));\n\n  \t\t// register (and return main partial if there are others in the template)\n  \t\treturn ractive.partials[name] = parsed.t;\n  \t}\n  }\n\n  function getPartialFromRegistry(ractive, name, parentFragment) {\n  \t// if there was an instance up-hierarchy, cool\n  \tvar partial = findParentPartial(name, parentFragment.owner);\n  \tif (partial) return partial;\n\n  \t// find first instance in the ractive or view hierarchy that has this partial\n  \tvar instance = findInstance('partials', ractive, name);\n\n  \tif (!instance) {\n  \t\treturn;\n  \t}\n\n  \tpartial = instance.partials[name];\n\n  \t// partial is a function?\n  \tvar fn = undefined;\n  \tif (typeof partial === 'function') {\n  \t\tfn = partial.bind(instance);\n  \t\tfn.isOwner = instance.partials.hasOwnProperty(name);\n  \t\tpartial = fn.call(ractive, _parser);\n  \t}\n\n  \tif (!partial && partial !== '') {\n  \t\twarnIfDebug(noRegistryFunctionReturn, name, 'partial', 'partial', { ractive: ractive });\n  \t\treturn;\n  \t}\n\n  \t// If this was added manually to the registry,\n  \t// but hasn't been parsed, parse it now\n  \tif (!_parser.isParsed(partial)) {\n  \t\t// use the parseOptions of the ractive instance on which it was found\n  \t\tvar parsed = _parser.parse(partial, _parser.getParseOptions(instance));\n\n  \t\t// Partials cannot contain nested partials!\n  \t\t// TODO add a test for this\n  \t\tif (parsed.p) {\n  \t\t\twarnIfDebug('Partials ({{>%s}}) cannot contain nested inline partials', name, { ractive: ractive });\n  \t\t}\n\n  \t\t// if fn, use instance to store result, otherwise needs to go\n  \t\t// in the correct point in prototype chain on instance or constructor\n  \t\tvar target = fn ? instance : findOwner(instance, name);\n\n  \t\t// may be a template with partials, which need to be registered and main template extracted\n  \t\ttarget.partials[name] = partial = parsed.t;\n  \t}\n\n  \t// store for reset\n  \tif (fn) partial._fn = fn;\n\n  \treturn partial.v ? partial.t : partial;\n  }\n\n  function findOwner(ractive, key) {\n  \treturn ractive.partials.hasOwnProperty(key) ? ractive : findConstructor(ractive.constructor, key);\n  }\n\n  function findConstructor(constructor, key) {\n  \tif (!constructor) {\n  \t\treturn;\n  \t}\n  \treturn constructor.partials.hasOwnProperty(key) ? constructor : findConstructor(constructor._Parent, key);\n  }\n\n  function findParentPartial(name, parent) {\n  \tif (parent) {\n  \t\tif (parent.template && parent.template.p && parent.template.p[name]) {\n  \t\t\treturn parent.template.p[name];\n  \t\t} else if (parent.parentFragment && parent.parentFragment.owner) {\n  \t\t\treturn findParentPartial(name, parent.parentFragment.owner);\n  \t\t}\n  \t}\n  }\n\n  var Partial = (function (_Mustache) {\n  \tinherits(Partial, _Mustache);\n\n  \tfunction Partial() {\n  \t\tclassCallCheck(this, Partial);\n\n  \t\t_Mustache.apply(this, arguments);\n  \t}\n\n  \tPartial.prototype.bind = function bind() {\n  \t\t_Mustache.prototype.bind.call(this);\n\n  \t\t// name matches take priority over expressions\n  \t\tvar template = this.template.r ? getPartialTemplate(this.ractive, this.template.r, this.parentFragment) || null : null;\n\n  \t\tif (template) {\n  \t\t\tthis.named = true;\n  \t\t\tthis.setTemplate(this.template.r, template);\n  \t\t} else if ((!this.model || typeof this.model.get() !== 'string') && this.template.r) {\n  \t\t\tthis.setTemplate(this.template.r, template);\n  \t\t} else {\n  \t\t\tthis.setTemplate(this.model.get());\n  \t\t}\n\n  \t\tthis.fragment = new Fragment({\n  \t\t\towner: this,\n  \t\t\ttemplate: this.partialTemplate\n  \t\t}).bind();\n  \t};\n\n  \tPartial.prototype.detach = function detach() {\n  \t\treturn this.fragment.detach();\n  \t};\n\n  \tPartial.prototype.find = function find(selector) {\n  \t\treturn this.fragment.find(selector);\n  \t};\n\n  \tPartial.prototype.findAll = function findAll(selector, query) {\n  \t\tthis.fragment.findAll(selector, query);\n  \t};\n\n  \tPartial.prototype.findComponent = function findComponent(name) {\n  \t\treturn this.fragment.findComponent(name);\n  \t};\n\n  \tPartial.prototype.findAllComponents = function findAllComponents(name, query) {\n  \t\tthis.fragment.findAllComponents(name, query);\n  \t};\n\n  \tPartial.prototype.firstNode = function firstNode() {\n  \t\treturn this.fragment.firstNode();\n  \t};\n\n  \tPartial.prototype.forceResetTemplate = function forceResetTemplate() {\n  \t\tthis.partialTemplate = getPartialTemplate(this.ractive, this.name, this.parentFragment);\n\n  \t\tif (!this.partialTemplate) {\n  \t\t\twarnOnceIfDebug('Could not find template for partial \\'' + this.name + '\\'');\n  \t\t\tthis.partialTemplate = [];\n  \t\t}\n\n  \t\tthis.fragment.resetTemplate(this.partialTemplate);\n  \t\tthis.bubble();\n  \t};\n\n  \tPartial.prototype.rebind = function rebind() {\n  \t\t_Mustache.prototype.unbind.call(this);\n  \t\t_Mustache.prototype.bind.call(this);\n  \t\tthis.fragment.rebind();\n  \t};\n\n  \tPartial.prototype.render = function render(target) {\n  \t\tthis.fragment.render(target);\n  \t};\n\n  \tPartial.prototype.setTemplate = function setTemplate(name, template) {\n  \t\tthis.name = name;\n\n  \t\tif (!template && template !== null) template = getPartialTemplate(this.ractive, name, this.parentFragment);\n\n  \t\tif (!template) {\n  \t\t\twarnOnceIfDebug('Could not find template for partial \\'' + name + '\\'');\n  \t\t}\n\n  \t\tthis.partialTemplate = template || [];\n  \t};\n\n  \tPartial.prototype.toString = function toString(escape) {\n  \t\treturn this.fragment.toString(escape);\n  \t};\n\n  \tPartial.prototype.unbind = function unbind() {\n  \t\t_Mustache.prototype.unbind.call(this);\n  \t\tthis.fragment.unbind();\n  \t};\n\n  \tPartial.prototype.unrender = function unrender(shouldDestroy) {\n  \t\tthis.fragment.unrender(shouldDestroy);\n  \t};\n\n  \tPartial.prototype.update = function update() {\n  \t\tif (this.dirty) {\n  \t\t\tif (!this.named) {\n  \t\t\t\tif (this.model && typeof this.model.get() === 'string' && this.model.get() !== this.name) {\n  \t\t\t\t\tthis.setTemplate(this.model.get());\n  \t\t\t\t\tthis.fragment.resetTemplate(this.partialTemplate);\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\tthis.fragment.update();\n  \t\t\tthis.dirty = false;\n  \t\t}\n  \t};\n\n  \treturn Partial;\n  })(Mustache);\n\n  function getRefs(ref, value, parent) {\n  \tvar refs = undefined;\n\n  \tif (ref) {\n  \t\trefs = {};\n  \t\tObject.keys(parent).forEach(function (ref) {\n  \t\t\trefs[ref] = parent[ref];\n  \t\t});\n  \t\trefs[ref] = value;\n  \t} else {\n  \t\trefs = parent;\n  \t}\n\n  \treturn refs;\n  }\n\n  var RepeatedFragment = (function () {\n  \tfunction RepeatedFragment(options) {\n  \t\tclassCallCheck(this, RepeatedFragment);\n\n  \t\tthis.parent = options.owner.parentFragment;\n\n  \t\t// bit of a hack, so reference resolution works without another\n  \t\t// layer of indirection\n  \t\tthis.parentFragment = this;\n  \t\tthis.owner = options.owner;\n  \t\tthis.ractive = this.parent.ractive;\n\n  \t\tthis.context = null;\n  \t\tthis.rendered = false;\n  \t\tthis.iterations = [];\n\n  \t\tthis.template = options.template;\n\n  \t\tthis.indexRef = options.indexRef;\n  \t\tthis.keyRef = options.keyRef;\n  \t\tthis.indexByKey = null; // for `{{#each object}}...`\n\n  \t\tthis.pendingNewIndices = null;\n  \t\tthis.previousIterations = null;\n\n  \t\t// track array versus object so updates of type rest\n  \t\tthis.isArray = false;\n  \t}\n\n  \tRepeatedFragment.prototype.bind = function bind(context) {\n  \t\tvar _this = this;\n\n  \t\tthis.context = context;\n  \t\tvar value = context.get();\n\n  \t\t// {{#each array}}...\n  \t\tif (this.isArray = isArray(value)) {\n  \t\t\t// we can't use map, because of sparse arrays\n  \t\t\tthis.iterations = [];\n  \t\t\tfor (var i = 0; i < value.length; i += 1) {\n  \t\t\t\tthis.iterations[i] = this.createIteration(i, i);\n  \t\t\t}\n  \t\t}\n\n  \t\t// {{#each object}}...\n  \t\telse if (isObject(value)) {\n  \t\t\t\tthis.isArray = false;\n\n  \t\t\t\t// TODO this is a dreadful hack. There must be a neater way\n  \t\t\t\tif (this.indexRef) {\n  \t\t\t\t\tvar refs = this.indexRef.split(',');\n  \t\t\t\t\tthis.keyRef = refs[0];\n  \t\t\t\t\tthis.indexRef = refs[1];\n  \t\t\t\t}\n\n  \t\t\t\tthis.indexByKey = {};\n  \t\t\t\tthis.iterations = Object.keys(value).map(function (key, index) {\n  \t\t\t\t\t_this.indexByKey[key] = index;\n  \t\t\t\t\treturn _this.createIteration(key, index);\n  \t\t\t\t});\n  \t\t\t}\n\n  \t\treturn this;\n  \t};\n\n  \tRepeatedFragment.prototype.bubble = function bubble() {\n  \t\tthis.owner.bubble();\n  \t};\n\n  \tRepeatedFragment.prototype.createIteration = function createIteration(key, index) {\n  \t\tvar parentFragment = this.owner.parentFragment;\n  \t\tvar keyRefs = getRefs(this.keyRef, key, parentFragment.keyRefs);\n  \t\tvar indexRefs = getRefs(this.indexRef, index, parentFragment.indexRefs);\n\n  \t\tvar fragment = new Fragment({\n  \t\t\towner: this,\n  \t\t\ttemplate: this.template,\n  \t\t\tindexRefs: indexRefs,\n  \t\t\tkeyRefs: keyRefs\n  \t\t});\n\n  \t\t// TODO this is a bit hacky\n  \t\tfragment.key = key;\n  \t\tfragment.index = index;\n  \t\tfragment.isIteration = true;\n\n  \t\tvar model = this.context.joinKey(key);\n  \t\treturn fragment.bind(model);\n  \t};\n\n  \tRepeatedFragment.prototype.detach = function detach() {\n  \t\tvar docFrag = createDocumentFragment();\n  \t\tthis.iterations.forEach(function (fragment) {\n  \t\t\treturn docFrag.appendChild(fragment.detach());\n  \t\t});\n  \t\treturn docFrag;\n  \t};\n\n  \tRepeatedFragment.prototype.find = function find(selector) {\n  \t\tvar len = this.iterations.length;\n  \t\tvar i = undefined;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tvar found = this.iterations[i].find(selector);\n  \t\t\tif (found) return found;\n  \t\t}\n  \t};\n\n  \tRepeatedFragment.prototype.findAll = function findAll(selector, query) {\n  \t\tvar len = this.iterations.length;\n  \t\tvar i = undefined;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tthis.iterations[i].findAll(selector, query);\n  \t\t}\n  \t};\n\n  \tRepeatedFragment.prototype.findComponent = function findComponent(name) {\n  \t\tvar len = this.iterations.length;\n  \t\tvar i = undefined;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tvar found = this.iterations[i].findComponent(name);\n  \t\t\tif (found) return found;\n  \t\t}\n  \t};\n\n  \tRepeatedFragment.prototype.findAllComponents = function findAllComponents(name, query) {\n  \t\tvar len = this.iterations.length;\n  \t\tvar i = undefined;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tthis.iterations[i].findAllComponents(name, query);\n  \t\t}\n  \t};\n\n  \tRepeatedFragment.prototype.findNextNode = function findNextNode(iteration) {\n  \t\tif (iteration.index < this.iterations.length - 1) {\n  \t\t\treturn this.iterations[iteration.index + 1].firstNode();\n  \t\t}\n\n  \t\treturn this.owner.findNextNode();\n  \t};\n\n  \tRepeatedFragment.prototype.firstNode = function firstNode() {\n  \t\treturn this.iterations[0] ? this.iterations[0].firstNode() : null;\n  \t};\n\n  \tRepeatedFragment.prototype.rebind = function rebind(context) {\n  \t\tthis.context = context;\n\n  \t\t// {{#each array}}...\n  \t\tif (isArray(context.get())) {\n  \t\t\tthis.iterations.forEach(function (fragment, i) {\n  \t\t\t\tfragment.rebind(context.joinKey(i));\n  \t\t\t});\n  \t\t}\n  \t};\n\n  \tRepeatedFragment.prototype.render = function render(target) {\n  \t\t// TODO use docFrag.cloneNode...\n\n  \t\tif (this.iterations) {\n  \t\t\tthis.iterations.forEach(function (fragment) {\n  \t\t\t\treturn fragment.render(target);\n  \t\t\t});\n  \t\t}\n\n  \t\tthis.rendered = true;\n  \t};\n\n  \tRepeatedFragment.prototype.shuffle = function shuffle(newIndices) {\n  \t\tvar _this2 = this;\n\n  \t\tif (this.pendingNewIndices) {\n  \t\t\tthrow new Error('Section was already shuffled!');\n  \t\t}\n\n  \t\tthis.pendingNewIndices = newIndices;\n  \t\tthis.previousIterations = this.iterations.slice();\n\n  \t\tvar iterations = [];\n\n  \t\tnewIndices.forEach(function (newIndex, oldIndex) {\n  \t\t\tif (newIndex === -1) return;\n\n  \t\t\tvar fragment = _this2.iterations[oldIndex];\n  \t\t\titerations[newIndex] = fragment;\n\n  \t\t\tif (newIndex !== oldIndex) fragment.dirty = true;\n  \t\t});\n\n  \t\tthis.iterations = iterations;\n  \t\tthis.bubble();\n  \t};\n\n  \tRepeatedFragment.prototype.toString = function toString(escape) {\n  \t\treturn this.iterations ? this.iterations.map(escape ? toEscapedString : _toString).join('') : '';\n  \t};\n\n  \tRepeatedFragment.prototype.unbind = function unbind() {\n  \t\tthis.iterations.forEach(_unbind);\n  \t\treturn this;\n  \t};\n\n  \tRepeatedFragment.prototype.unrender = function unrender(shouldDestroy) {\n  \t\tthis.iterations.forEach(shouldDestroy ? _unrenderAndDestroy : _unrender);\n  \t\tthis.rendered = false;\n  \t};\n\n  \t// TODO smart update\n\n  \tRepeatedFragment.prototype.update = function update() {\n  \t\tvar _this3 = this;\n\n  \t\t// skip dirty check, since this is basically just a facade\n\n  \t\tif (this.pendingNewIndices) {\n  \t\t\tthis.updatePostShuffle();\n  \t\t\treturn;\n  \t\t}\n\n  \t\tvar value = this.context.get(),\n  \t\t    wasArray = this.isArray;\n\n  \t\tvar toRemove = undefined;\n  \t\tvar oldKeys = undefined;\n  \t\tvar reset = true;\n  \t\tvar i = undefined;\n\n  \t\tif (this.isArray = isArray(value)) {\n  \t\t\tif (wasArray) {\n  \t\t\t\treset = false;\n  \t\t\t\tif (this.iterations.length > value.length) {\n  \t\t\t\t\ttoRemove = this.iterations.splice(value.length);\n  \t\t\t\t}\n  \t\t\t}\n  \t\t} else if (isObject(value) && !wasArray) {\n  \t\t\treset = false;\n  \t\t\ttoRemove = [];\n  \t\t\toldKeys = {};\n  \t\t\ti = this.iterations.length;\n\n  \t\t\twhile (i--) {\n  \t\t\t\tvar _fragment = this.iterations[i];\n  \t\t\t\tif (_fragment.key in value) {\n  \t\t\t\t\toldKeys[_fragment.key] = true;\n  \t\t\t\t} else {\n  \t\t\t\t\tthis.iterations.splice(i, 1);\n  \t\t\t\t\ttoRemove.push(_fragment);\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\tif (reset) {\n  \t\t\ttoRemove = this.iterations;\n  \t\t\tthis.iterations = [];\n  \t\t}\n\n  \t\tif (toRemove) {\n  \t\t\ttoRemove.forEach(function (fragment) {\n  \t\t\t\tfragment.unbind();\n  \t\t\t\tfragment.unrender(true);\n  \t\t\t});\n  \t\t}\n\n  \t\t// update the remaining ones\n  \t\tthis.iterations.forEach(__update);\n\n  \t\t// add new iterations\n  \t\tvar newLength = isArray(value) ? value.length : isObject(value) ? Object.keys(value).length : 0;\n\n  \t\tvar docFrag = undefined;\n  \t\tvar fragment = undefined;\n\n  \t\tif (newLength > this.iterations.length) {\n  \t\t\tdocFrag = this.rendered ? createDocumentFragment() : null;\n  \t\t\ti = this.iterations.length;\n\n  \t\t\tif (isArray(value)) {\n  \t\t\t\twhile (i < value.length) {\n  \t\t\t\t\tfragment = this.createIteration(i, i);\n\n  \t\t\t\t\tthis.iterations.push(fragment);\n  \t\t\t\t\tif (this.rendered) fragment.render(docFrag);\n\n  \t\t\t\t\ti += 1;\n  \t\t\t\t}\n  \t\t\t} else if (isObject(value)) {\n  \t\t\t\tObject.keys(value).forEach(function (key) {\n  \t\t\t\t\tif (!oldKeys || !(key in oldKeys)) {\n  \t\t\t\t\t\tfragment = _this3.createIteration(key, i);\n\n  \t\t\t\t\t\t_this3.iterations.push(fragment);\n  \t\t\t\t\t\tif (_this3.rendered) fragment.render(docFrag);\n\n  \t\t\t\t\t\ti += 1;\n  \t\t\t\t\t}\n  \t\t\t\t});\n  \t\t\t}\n\n  \t\t\tif (this.rendered) {\n  \t\t\t\tvar parentNode = this.parent.findParentNode();\n  \t\t\t\tvar anchor = this.parent.findNextNode(this.owner);\n\n  \t\t\t\tparentNode.insertBefore(docFrag, anchor);\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tRepeatedFragment.prototype.updatePostShuffle = function updatePostShuffle() {\n  \t\tvar _this4 = this;\n\n  \t\tvar newIndices = this.pendingNewIndices;\n\n  \t\t// This algorithm (for detaching incorrectly-ordered fragments from the DOM and\n  \t\t// storing them in a document fragment for later reinsertion) seems a bit hokey,\n  \t\t// but it seems to work for now\n  \t\tvar previousNewIndex = -1;\n  \t\tvar reinsertFrom = null;\n\n  \t\tnewIndices.forEach(function (newIndex, oldIndex) {\n  \t\t\tvar fragment = _this4.previousIterations[oldIndex];\n\n  \t\t\tif (newIndex === -1) {\n  \t\t\t\tfragment.unbind().unrender(true);\n  \t\t\t} else {\n  \t\t\t\tfragment.index = newIndex;\n  \t\t\t\tfragment.rebind(_this4.context.joinKey(newIndex));\n\n  \t\t\t\tif (reinsertFrom === null && newIndex !== previousNewIndex + 1) {\n  \t\t\t\t\treinsertFrom = oldIndex;\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\tpreviousNewIndex = newIndex;\n  \t\t});\n\n  \t\t// create new iterations\n  \t\tvar docFrag = this.rendered ? createDocumentFragment() : null;\n  \t\tvar parentNode = this.rendered ? this.parent.findParentNode() : null;\n\n  \t\tvar len = this.context.get().length;\n  \t\tvar i = undefined;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tvar existingFragment = this.iterations[i];\n\n  \t\t\tif (this.rendered) {\n  \t\t\t\tif (existingFragment) {\n  \t\t\t\t\tif (reinsertFrom !== null && i >= reinsertFrom) {\n  \t\t\t\t\t\tdocFrag.appendChild(existingFragment.detach());\n  \t\t\t\t\t} else if (docFrag.childNodes.length) {\n  \t\t\t\t\t\tparentNode.insertBefore(docFrag, existingFragment.firstNode());\n  \t\t\t\t\t}\n  \t\t\t\t} else {\n  \t\t\t\t\tthis.iterations[i] = this.createIteration(i, i);\n  \t\t\t\t\tthis.iterations[i].render(docFrag);\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\tif (!this.rendered) {\n  \t\t\t\tif (!existingFragment) {\n  \t\t\t\t\tthis.iterations[i] = this.createIteration(i, i);\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\tif (this.rendered && docFrag.childNodes.length) {\n  \t\t\tparentNode.insertBefore(docFrag, this.owner.findNextNode());\n  \t\t}\n\n  \t\tthis.iterations.forEach(__update);\n\n  \t\tthis.pendingNewIndices = null;\n  \t};\n\n  \treturn RepeatedFragment;\n  })();\n\n  function isEmpty(value) {\n  \treturn !value || isArray(value) && value.length === 0 || isObject(value) && Object.keys(value).length === 0;\n  }\n\n  function getType(value, hasIndexRef) {\n  \tif (hasIndexRef || isArray(value)) return SECTION_EACH;\n  \tif (isObject(value) || typeof value === 'function') return SECTION_WITH;\n  \tif (value === undefined) return null;\n  \treturn SECTION_IF;\n  }\n\n  var Section = (function (_Mustache) {\n  \tinherits(Section, _Mustache);\n\n  \tfunction Section(options) {\n  \t\tclassCallCheck(this, Section);\n\n  \t\t_Mustache.call(this, options);\n\n  \t\tthis.sectionType = options.template.n || null;\n  \t\tthis.fragment = null;\n  \t}\n\n  \tSection.prototype.bind = function bind() {\n  \t\t_Mustache.prototype.bind.call(this);\n\n  \t\t// if we managed to bind, we need to create children\n  \t\tif (this.model) {\n  \t\t\tvar value = this.model.parent ? this.model.get() : this.model.value;\n  \t\t\tvar fragment = undefined;\n\n  \t\t\tif (!this.sectionType) this.sectionType = getType(value, this.template.i);\n\n  \t\t\tif (isEmpty(value) && this.sectionType !== SECTION_WITH) {\n  \t\t\t\t// TODO again, WITH should not render if empty\n  \t\t\t\tif (this.sectionType === SECTION_UNLESS) {\n  \t\t\t\t\tthis.fragment = new Fragment({\n  \t\t\t\t\t\towner: this,\n  \t\t\t\t\t\ttemplate: this.template.f\n  \t\t\t\t\t}).bind();\n  \t\t\t\t}\n\n  \t\t\t\t// otherwise, create no children\n  \t\t\t\treturn;\n  \t\t\t}\n\n  \t\t\tif (this.sectionType === SECTION_UNLESS) return;\n\n  \t\t\tif (this.sectionType === SECTION_IF) {\n  \t\t\t\tfragment = new Fragment({\n  \t\t\t\t\towner: this,\n  \t\t\t\t\ttemplate: this.template.f\n  \t\t\t\t}).bind();\n  \t\t\t}\n\n  \t\t\t// TODO should only be WITH, and it should behave like IF_WITH\n  \t\t\telse if (this.sectionType === SECTION_WITH || this.sectionType === SECTION_IF_WITH) {\n  \t\t\t\t\tfragment = new Fragment({\n  \t\t\t\t\t\towner: this,\n  \t\t\t\t\t\ttemplate: this.template.f\n  \t\t\t\t\t}).bind(this.model);\n  \t\t\t\t} else {\n  \t\t\t\t\tfragment = new RepeatedFragment({\n  \t\t\t\t\t\towner: this,\n  \t\t\t\t\t\ttemplate: this.template.f,\n  \t\t\t\t\t\tindexRef: this.template.i\n  \t\t\t\t\t}).bind(this.model);\n  \t\t\t\t}\n\n  \t\t\tthis.fragment = fragment;\n  \t\t} else if (this.sectionType && this.sectionType === SECTION_UNLESS) {\n  \t\t\tthis.fragment = new Fragment({\n  \t\t\t\towner: this,\n  \t\t\t\ttemplate: this.template.f\n  \t\t\t}).bind();\n  \t\t}\n  \t};\n\n  \tSection.prototype.detach = function detach() {\n  \t\treturn this.fragment ? this.fragment.detach() : createDocumentFragment();\n  \t};\n\n  \tSection.prototype.find = function find(selector) {\n  \t\tif (this.fragment) {\n  \t\t\treturn this.fragment.find(selector);\n  \t\t}\n  \t};\n\n  \tSection.prototype.findAll = function findAll(selector, query) {\n  \t\tif (this.fragment) {\n  \t\t\tthis.fragment.findAll(selector, query);\n  \t\t}\n  \t};\n\n  \tSection.prototype.findComponent = function findComponent(name) {\n  \t\tif (this.fragment) {\n  \t\t\treturn this.fragment.findComponent(name);\n  \t\t}\n  \t};\n\n  \tSection.prototype.findAllComponents = function findAllComponents(name, query) {\n  \t\tif (this.fragment) {\n  \t\t\tthis.fragment.findAllComponents(name, query);\n  \t\t}\n  \t};\n\n  \tSection.prototype.firstNode = function firstNode() {\n  \t\treturn this.fragment && this.fragment.firstNode();\n  \t};\n\n  \tSection.prototype.rebind = function rebind() {\n  \t\t_Mustache.prototype.rebind.call(this);\n\n  \t\tif (this.fragment) {\n  \t\t\tthis.fragment.rebind(this.sectionType === SECTION_IF ? null : this.model);\n  \t\t}\n  \t};\n\n  \tSection.prototype.render = function render(target) {\n  \t\tthis.rendered = true;\n  \t\tif (this.fragment) this.fragment.render(target);\n  \t};\n\n  \tSection.prototype.shuffle = function shuffle(newIndices) {\n  \t\tif (this.fragment && this.sectionType === SECTION_EACH) {\n  \t\t\tthis.fragment.shuffle(newIndices);\n  \t\t}\n  \t};\n\n  \tSection.prototype.toString = function toString(escape) {\n  \t\treturn this.fragment ? this.fragment.toString(escape) : '';\n  \t};\n\n  \tSection.prototype.unbind = function unbind() {\n  \t\t_Mustache.prototype.unbind.call(this);\n  \t\tif (this.fragment) this.fragment.unbind();\n  \t};\n\n  \tSection.prototype.unrender = function unrender(shouldDestroy) {\n  \t\tif (this.rendered && this.fragment) this.fragment.unrender(shouldDestroy);\n  \t\tthis.rendered = false;\n  \t};\n\n  \t// TODO DRY this out - lot of repeated stuff between this and bind()\n\n  \tSection.prototype.update = function update() {\n  \t\tif (!this.dirty) return;\n  \t\tif (!this.model) return; // TODO can this happen?\n\n  \t\tvar value = this.model.get();\n\n  \t\tif (this.sectionType === null) this.sectionType = getType(value, this.template.i);\n\n  \t\tvar newFragment = undefined;\n\n  \t\tif (this.sectionType === SECTION_EACH) {\n  \t\t\tif (this.fragment) {\n  \t\t\t\tthis.fragment.update();\n  \t\t\t} else {\n  \t\t\t\t// TODO can this happen?\n  \t\t\t\tnewFragment = new RepeatedFragment({\n  \t\t\t\t\towner: this,\n  \t\t\t\t\ttemplate: this.template.f,\n  \t\t\t\t\tindexRef: this.template.i\n  \t\t\t\t}).bind(this.model);\n  \t\t\t}\n  \t\t}\n\n  \t\t// TODO same comment as before - WITH should be IF_WITH\n  \t\telse if (this.sectionType === SECTION_WITH) {\n  \t\t\t\tif (this.fragment) {\n  \t\t\t\t\tthis.fragment.update();\n  \t\t\t\t} else {\n  \t\t\t\t\tnewFragment = new Fragment({\n  \t\t\t\t\t\towner: this,\n  \t\t\t\t\t\ttemplate: this.template.f\n  \t\t\t\t\t}).bind(this.model);\n  \t\t\t\t}\n  \t\t\t} else if (this.sectionType === SECTION_IF_WITH) {\n  \t\t\t\tif (this.fragment) {\n  \t\t\t\t\tif (isEmpty(value)) {\n  \t\t\t\t\t\tif (this.rendered) {\n  \t\t\t\t\t\t\tthis.fragment.unbind().unrender(true);\n  \t\t\t\t\t\t}\n\n  \t\t\t\t\t\tthis.fragment = null;\n  \t\t\t\t\t} else {\n  \t\t\t\t\t\tthis.fragment.update();\n  \t\t\t\t\t}\n  \t\t\t\t} else if (!isEmpty(value)) {\n  \t\t\t\t\tnewFragment = new Fragment({\n  \t\t\t\t\t\towner: this,\n  \t\t\t\t\t\ttemplate: this.template.f\n  \t\t\t\t\t}).bind(this.model);\n  \t\t\t\t}\n  \t\t\t} else {\n  \t\t\t\tvar fragmentShouldExist = this.sectionType === SECTION_UNLESS ? isEmpty(value) : !!value;\n\n  \t\t\t\tif (this.fragment) {\n  \t\t\t\t\tif (fragmentShouldExist) {\n  \t\t\t\t\t\tthis.fragment.update();\n  \t\t\t\t\t} else {\n  \t\t\t\t\t\tif (this.rendered) {\n  \t\t\t\t\t\t\tthis.fragment.unbind().unrender(true);\n  \t\t\t\t\t\t}\n\n  \t\t\t\t\t\tthis.fragment = null;\n  \t\t\t\t\t}\n  \t\t\t\t} else if (fragmentShouldExist) {\n  \t\t\t\t\tnewFragment = new Fragment({\n  \t\t\t\t\t\towner: this,\n  \t\t\t\t\t\ttemplate: this.template.f\n  \t\t\t\t\t}).bind(null);\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\tif (newFragment) {\n  \t\t\tif (this.rendered) {\n  \t\t\t\tvar parentNode = this.parentFragment.findParentNode();\n  \t\t\t\tvar anchor = this.parentFragment.findNextNode(this);\n\n  \t\t\t\tif (anchor) {\n  \t\t\t\t\tvar docFrag = createDocumentFragment();\n  \t\t\t\t\tnewFragment.render(docFrag);\n\n  \t\t\t\t\t// we use anchor.parentNode, not parentNode, because the sibling\n  \t\t\t\t\t// may be temporarily detached as a result of a shuffle\n  \t\t\t\t\tanchor.parentNode.insertBefore(docFrag, anchor);\n  \t\t\t\t} else {\n  \t\t\t\t\tnewFragment.render(parentNode);\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\tthis.fragment = newFragment;\n  \t\t}\n\n  \t\tthis.dirty = false;\n  \t};\n\n  \treturn Section;\n  })(Mustache);\n\n  var elementCache = {};\n\n  var ieBug = undefined;\n  var ieBlacklist = undefined;\n\n  try {\n  \tcreateElement('table').innerHTML = 'foo';\n  } catch (err) {\n  \tieBug = true;\n\n  \tieBlacklist = {\n  \t\tTABLE: ['<table class=\"x\">', '</table>'],\n  \t\tTHEAD: ['<table><thead class=\"x\">', '</thead></table>'],\n  \t\tTBODY: ['<table><tbody class=\"x\">', '</tbody></table>'],\n  \t\tTR: ['<table><tr class=\"x\">', '</tr></table>'],\n  \t\tSELECT: ['<select class=\"x\">', '</select>']\n  \t};\n  }\n\n  function insertHtml (html, node, docFrag) {\n  \tvar nodes = [];\n\n  \t// render 0 and false\n  \tif (html == null || html === '') return nodes;\n\n  \tvar container = undefined;\n  \tvar wrapper = undefined;\n  \tvar selectedOption = undefined;\n\n  \tif (ieBug && (wrapper = ieBlacklist[node.tagName])) {\n  \t\tcontainer = _element('DIV');\n  \t\tcontainer.innerHTML = wrapper[0] + html + wrapper[1];\n  \t\tcontainer = container.querySelector('.x');\n\n  \t\tif (container.tagName === 'SELECT') {\n  \t\t\tselectedOption = container.options[container.selectedIndex];\n  \t\t}\n  \t} else if (node.namespaceURI === svg) {\n  \t\tcontainer = _element('DIV');\n  \t\tcontainer.innerHTML = '<svg class=\"x\">' + html + '</svg>';\n  \t\tcontainer = container.querySelector('.x');\n  \t} else {\n  \t\tcontainer = _element(node.tagName);\n  \t\tcontainer.innerHTML = html;\n\n  \t\tif (container.tagName === 'SELECT') {\n  \t\t\tselectedOption = container.options[container.selectedIndex];\n  \t\t}\n  \t}\n\n  \tvar child = undefined;\n  \twhile (child = container.firstChild) {\n  \t\tnodes.push(child);\n  \t\tdocFrag.appendChild(child);\n  \t}\n\n  \t// This is really annoying. Extracting <option> nodes from the\n  \t// temporary container <select> causes the remaining ones to\n  \t// become selected. So now we have to deselect them. IE8, you\n  \t// amaze me. You really do\n  \t// ...and now Chrome too\n  \tvar i = undefined;\n  \tif (node.tagName === 'SELECT') {\n  \t\ti = nodes.length;\n  \t\twhile (i--) {\n  \t\t\tif (nodes[i] !== selectedOption) {\n  \t\t\t\tnodes[i].selected = false;\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \treturn nodes;\n  }\n\n  function _element(tagName) {\n  \treturn elementCache[tagName] || (elementCache[tagName] = createElement(tagName));\n  }\n\n  var Triple = (function (_Mustache) {\n  \tinherits(Triple, _Mustache);\n\n  \tfunction Triple(options) {\n  \t\tclassCallCheck(this, Triple);\n\n  \t\t_Mustache.call(this, options);\n  \t}\n\n  \tTriple.prototype.detach = function detach() {\n  \t\tvar docFrag = createDocumentFragment();\n  \t\tthis.nodes.forEach(function (node) {\n  \t\t\treturn docFrag.appendChild(node);\n  \t\t});\n  \t\treturn docFrag;\n  \t};\n\n  \tTriple.prototype.find = function find(selector) {\n  \t\tvar len = this.nodes.length;\n  \t\tvar i = undefined;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tvar node = this.nodes[i];\n\n  \t\t\tif (node.nodeType !== 1) continue;\n\n  \t\t\tif (matches(node, selector)) return node;\n\n  \t\t\tvar queryResult = node.querySelector(selector);\n  \t\t\tif (queryResult) return queryResult;\n  \t\t}\n\n  \t\treturn null;\n  \t};\n\n  \tTriple.prototype.findAll = function findAll(selector, query) {\n  \t\tvar len = this.nodes.length;\n  \t\tvar i = undefined;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tvar node = this.nodes[i];\n\n  \t\t\tif (node.nodeType !== 1) continue;\n\n  \t\t\tif (query.test(node)) query.add(node);\n\n  \t\t\tvar queryAllResult = node.querySelectorAll(selector);\n  \t\t\tif (queryAllResult) {\n  \t\t\t\tvar numNodes = queryAllResult.length;\n  \t\t\t\tvar j = undefined;\n\n  \t\t\t\tfor (j = 0; j < numNodes; j += 1) {\n  \t\t\t\t\tquery.add(queryAllResult[j]);\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tTriple.prototype.findComponent = function findComponent() {\n  \t\treturn null;\n  \t};\n\n  \tTriple.prototype.firstNode = function firstNode() {\n  \t\treturn this.nodes[0];\n  \t};\n\n  \tTriple.prototype.render = function render(target) {\n  \t\tvar html = this.model ? this.model.get() : '';\n  \t\tthis.nodes = insertHtml(html, this.parentFragment.findParentNode(), target);\n  \t\tthis.rendered = true;\n  \t};\n\n  \tTriple.prototype.toString = function toString() {\n  \t\treturn this.model && this.model.get() != null ? decodeCharacterReferences('' + this.model.get()) : '';\n  \t};\n\n  \tTriple.prototype.unrender = function unrender() {\n  \t\tif (this.nodes) this.nodes.forEach(function (node) {\n  \t\t\treturn detachNode(node);\n  \t\t});\n  \t\tthis.rendered = false;\n  \t};\n\n  \tTriple.prototype.update = function update() {\n  \t\tif (this.rendered && this.dirty) {\n  \t\t\tthis.unrender();\n  \t\t\tvar docFrag = createDocumentFragment();\n  \t\t\tthis.render(docFrag);\n\n  \t\t\tvar parentNode = this.parentFragment.findParentNode();\n  \t\t\tvar anchor = this.parentFragment.findNextNode(this);\n\n  \t\t\tparentNode.insertBefore(docFrag, anchor);\n\n  \t\t\tthis.dirty = false;\n  \t\t}\n  \t};\n\n  \treturn Triple;\n  })(Mustache);\n\n  var Yielder = (function (_Item) {\n  \tinherits(Yielder, _Item);\n\n  \tfunction Yielder(options) {\n  \t\tclassCallCheck(this, Yielder);\n\n  \t\t_Item.call(this, options);\n\n  \t\tthis.container = options.parentFragment.ractive;\n  \t\tthis.component = this.container.component;\n\n  \t\tthis.containerFragment = options.parentFragment;\n  \t\tthis.parentFragment = this.component.parentFragment;\n\n  \t\t// {{yield}} is equivalent to {{yield content}}\n  \t\tthis.name = options.template.n || '';\n  \t}\n\n  \tYielder.prototype.bind = function bind() {\n  \t\tvar name = this.name;\n\n  \t\t(this.component.yielders[name] || (this.component.yielders[name] = [])).push(this);\n\n  \t\t// TODO don't parse here\n  \t\tvar template = this.container._inlinePartials[name || 'content'];\n\n  \t\tif (typeof template === 'string') {\n  \t\t\ttemplate = parse(template).t;\n  \t\t}\n\n  \t\tif (!template) {\n  \t\t\twarnIfDebug('Could not find template for partial \"' + name + '\"', { ractive: this.ractive });\n  \t\t\ttemplate = [];\n  \t\t}\n\n  \t\tthis.fragment = new Fragment({\n  \t\t\towner: this,\n  \t\t\tractive: this.container.parent,\n  \t\t\ttemplate: template\n  \t\t}).bind();\n  \t};\n\n  \tYielder.prototype.detach = function detach() {\n  \t\treturn this.fragment.detach();\n  \t};\n\n  \tYielder.prototype.find = function find(selector) {\n  \t\treturn this.fragment.find(selector);\n  \t};\n\n  \tYielder.prototype.findAll = function findAll(selector, queryResult) {\n  \t\tthis.fragment.find(selector, queryResult);\n  \t};\n\n  \tYielder.prototype.findComponent = function findComponent(name) {\n  \t\treturn this.fragment.findComponent(name);\n  \t};\n\n  \tYielder.prototype.findAllComponents = function findAllComponents(name, queryResult) {\n  \t\tthis.fragment.findAllComponents(name, queryResult);\n  \t};\n\n  \tYielder.prototype.firstNode = function firstNode() {\n  \t\treturn this.fragment.firstNode();\n  \t};\n\n  \tYielder.prototype.rebind = function rebind() {\n  \t\tthrow new Error('Yielder$rebind is not yet implemented!');\n  \t};\n\n  \tYielder.prototype.render = function render(target) {\n  \t\treturn this.fragment.render(target);\n  \t};\n\n  \tYielder.prototype.setTemplate = function setTemplate(name) {\n  \t\tvar template = this.parentFragment.ractive.partials[name];\n\n  \t\tif (typeof template === 'string') {\n  \t\t\ttemplate = parse(template).t;\n  \t\t}\n\n  \t\tthis.partialTemplate = template || []; // TODO warn on missing partial\n  \t};\n\n  \tYielder.prototype.toString = function toString(escape) {\n  \t\treturn this.fragment.toString(escape);\n  \t};\n\n  \tYielder.prototype.unbind = function unbind() {\n  \t\tthis.fragment.unbind();\n  \t\tremoveFromArray(this.component.yielders[this.name], this);\n  \t};\n\n  \tYielder.prototype.unrender = function unrender(shouldDestroy) {\n  \t\tthis.fragment.unrender(shouldDestroy);\n  \t};\n\n  \treturn Yielder;\n  })(Item);\n\n  function resetStyle(node, style) {\n  \tif (style) {\n  \t\tnode.setAttribute('style', style);\n  \t} else {\n  \t\t// Next line is necessary, to remove empty style attribute!\n  \t\t// See http://stackoverflow.com/a/7167553\n  \t\tnode.getAttribute('style');\n  \t\tnode.removeAttribute('style');\n  \t}\n  }\n\n  function camelCase (hyphenatedStr) {\n  \treturn hyphenatedStr.replace(/-([a-zA-Z])/g, function (match, $1) {\n  \t\treturn $1.toUpperCase();\n  \t});\n  }\n\n  var ___prefix = undefined;\n\n  if (!isClient) {\n  \t___prefix = null;\n  } else {\n  \t(function () {\n  \t\tvar prefixCache = {};\n  \t\tvar testStyle = createElement('div').style;\n\n  \t\t___prefix = function (prop) {\n  \t\t\tprop = camelCase(prop);\n\n  \t\t\tif (!prefixCache[prop]) {\n  \t\t\t\tif (testStyle[prop] !== undefined) {\n  \t\t\t\t\tprefixCache[prop] = prop;\n  \t\t\t\t} else {\n  \t\t\t\t\t// test vendors...\n  \t\t\t\t\tvar capped = prop.charAt(0).toUpperCase() + prop.substring(1);\n\n  \t\t\t\t\tvar i = vendors.length;\n  \t\t\t\t\twhile (i--) {\n  \t\t\t\t\t\tvar vendor = vendors[i];\n  \t\t\t\t\t\tif (testStyle[vendor + capped] !== undefined) {\n  \t\t\t\t\t\t\tprefixCache[prop] = vendor + capped;\n  \t\t\t\t\t\t\tbreak;\n  \t\t\t\t\t\t}\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\treturn prefixCache[prop];\n  \t\t};\n  \t})();\n  }\n\n  var interpolators = {\n  \tnumber: function (from, to) {\n  \t\tvar delta;\n\n  \t\tif (!isNumeric(from) || !isNumeric(to)) {\n  \t\t\treturn null;\n  \t\t}\n\n  \t\tfrom = +from;\n  \t\tto = +to;\n\n  \t\tdelta = to - from;\n\n  \t\tif (!delta) {\n  \t\t\treturn function () {\n  \t\t\t\treturn from;\n  \t\t\t};\n  \t\t}\n\n  \t\treturn function (t) {\n  \t\t\treturn from + t * delta;\n  \t\t};\n  \t},\n\n  \tarray: function (from, to) {\n  \t\tvar intermediate, interpolators, len, i;\n\n  \t\tif (!isArray(from) || !isArray(to)) {\n  \t\t\treturn null;\n  \t\t}\n\n  \t\tintermediate = [];\n  \t\tinterpolators = [];\n\n  \t\ti = len = Math.min(from.length, to.length);\n  \t\twhile (i--) {\n  \t\t\tinterpolators[i] = interpolate(from[i], to[i]);\n  \t\t}\n\n  \t\t// surplus values - don't interpolate, but don't exclude them either\n  \t\tfor (i = len; i < from.length; i += 1) {\n  \t\t\tintermediate[i] = from[i];\n  \t\t}\n\n  \t\tfor (i = len; i < to.length; i += 1) {\n  \t\t\tintermediate[i] = to[i];\n  \t\t}\n\n  \t\treturn function (t) {\n  \t\t\tvar i = len;\n\n  \t\t\twhile (i--) {\n  \t\t\t\tintermediate[i] = interpolators[i](t);\n  \t\t\t}\n\n  \t\t\treturn intermediate;\n  \t\t};\n  \t},\n\n  \tobject: function (from, to) {\n  \t\tvar properties, len, interpolators, intermediate, prop;\n\n  \t\tif (!isObject(from) || !isObject(to)) {\n  \t\t\treturn null;\n  \t\t}\n\n  \t\tproperties = [];\n  \t\tintermediate = {};\n  \t\tinterpolators = {};\n\n  \t\tfor (prop in from) {\n  \t\t\tif (hasOwn.call(from, prop)) {\n  \t\t\t\tif (hasOwn.call(to, prop)) {\n  \t\t\t\t\tproperties.push(prop);\n  \t\t\t\t\tinterpolators[prop] = interpolate(from[prop], to[prop]);\n  \t\t\t\t} else {\n  \t\t\t\t\tintermediate[prop] = from[prop];\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\tfor (prop in to) {\n  \t\t\tif (hasOwn.call(to, prop) && !hasOwn.call(from, prop)) {\n  \t\t\t\tintermediate[prop] = to[prop];\n  \t\t\t}\n  \t\t}\n\n  \t\tlen = properties.length;\n\n  \t\treturn function (t) {\n  \t\t\tvar i = len,\n  \t\t\t    prop;\n\n  \t\t\twhile (i--) {\n  \t\t\t\tprop = properties[i];\n\n  \t\t\t\tintermediate[prop] = interpolators[prop](t);\n  \t\t\t}\n\n  \t\t\treturn intermediate;\n  \t\t};\n  \t}\n  };\n\n  function interpolate(from, to, ractive, type) {\n  \tif (from === to) return null;\n\n  \tif (type) {\n  \t\tvar interpol = findInViewHierarchy('interpolators', ractive, type);\n  \t\tif (interpol) return interpol(from, to) || null;\n\n  \t\tfatal(missingPlugin(type, 'interpolator'));\n  \t}\n\n  \treturn interpolators.number(from, to) || interpolators.array(from, to) || interpolators.object(from, to) || null;\n  }\n\n  var unprefixPattern = new RegExp('^-(?:' + vendors.join('|') + ')-');\n\n  function unprefix (prop) {\n  \treturn prop.replace(unprefixPattern, '');\n  }\n\n  var vendorPattern = new RegExp('^(?:' + vendors.join('|') + ')([A-Z])');\n\n  function hyphenate (str) {\n  \tif (!str) return ''; // edge case\n\n  \tif (vendorPattern.test(str)) str = '-' + str;\n\n  \treturn str.replace(/[A-Z]/g, function (match) {\n  \t\treturn '-' + match.toLowerCase();\n  \t});\n  }\n\n  var createTransitions = undefined;\n\n  if (!isClient) {\n  \tcreateTransitions = null;\n  } else {\n  \t(function () {\n  \t\tvar testStyle = createElement('div').style;\n  \t\tvar linear = function (x) {\n  \t\t\treturn x;\n  \t\t};\n\n  \t\tvar canUseCssTransitions = {};\n  \t\tvar cannotUseCssTransitions = {};\n\n  \t\t// determine some facts about our environment\n  \t\tvar TRANSITION = undefined;\n  \t\tvar TRANSITIONEND = undefined;\n  \t\tvar CSS_TRANSITIONS_ENABLED = undefined;\n  \t\tvar TRANSITION_DURATION = undefined;\n  \t\tvar TRANSITION_PROPERTY = undefined;\n  \t\tvar TRANSITION_TIMING_FUNCTION = undefined;\n\n  \t\tif (testStyle.transition !== undefined) {\n  \t\t\tTRANSITION = 'transition';\n  \t\t\tTRANSITIONEND = 'transitionend';\n  \t\t\tCSS_TRANSITIONS_ENABLED = true;\n  \t\t} else if (testStyle.webkitTransition !== undefined) {\n  \t\t\tTRANSITION = 'webkitTransition';\n  \t\t\tTRANSITIONEND = 'webkitTransitionEnd';\n  \t\t\tCSS_TRANSITIONS_ENABLED = true;\n  \t\t} else {\n  \t\t\tCSS_TRANSITIONS_ENABLED = false;\n  \t\t}\n\n  \t\tif (TRANSITION) {\n  \t\t\tTRANSITION_DURATION = TRANSITION + 'Duration';\n  \t\t\tTRANSITION_PROPERTY = TRANSITION + 'Property';\n  \t\t\tTRANSITION_TIMING_FUNCTION = TRANSITION + 'TimingFunction';\n  \t\t}\n\n  \t\tcreateTransitions = function (t, to, options, changedProperties, resolve) {\n\n  \t\t\t// Wait a beat (otherwise the target styles will be applied immediately)\n  \t\t\t// TODO use a fastdom-style mechanism?\n  \t\t\tsetTimeout(function () {\n  \t\t\t\tvar jsTransitionsComplete = undefined;\n  \t\t\t\tvar cssTransitionsComplete = undefined;\n\n  \t\t\t\tfunction checkComplete() {\n  \t\t\t\t\tif (jsTransitionsComplete && cssTransitionsComplete) {\n  \t\t\t\t\t\t// will changes to events and fire have an unexpected consequence here?\n  \t\t\t\t\t\tt.ractive.fire(t.name + ':end', t.node, t.isIntro);\n  \t\t\t\t\t\tresolve();\n  \t\t\t\t\t}\n  \t\t\t\t}\n\n  \t\t\t\t// this is used to keep track of which elements can use CSS to animate\n  \t\t\t\t// which properties\n  \t\t\t\tvar hashPrefix = (t.node.namespaceURI || '') + t.node.tagName;\n\n  \t\t\t\tt.node.style[TRANSITION_PROPERTY] = changedProperties.map(___prefix).map(hyphenate).join(',');\n  \t\t\t\tt.node.style[TRANSITION_TIMING_FUNCTION] = hyphenate(options.easing || 'linear');\n  \t\t\t\tt.node.style[TRANSITION_DURATION] = options.duration / 1000 + 's';\n\n  \t\t\t\tfunction transitionEndHandler(event) {\n  \t\t\t\t\tvar index = changedProperties.indexOf(camelCase(unprefix(event.propertyName)));\n  \t\t\t\t\tif (index !== -1) {\n  \t\t\t\t\t\tchangedProperties.splice(index, 1);\n  \t\t\t\t\t}\n\n  \t\t\t\t\tif (changedProperties.length) {\n  \t\t\t\t\t\t// still transitioning...\n  \t\t\t\t\t\treturn;\n  \t\t\t\t\t}\n\n  \t\t\t\t\tt.node.removeEventListener(TRANSITIONEND, transitionEndHandler, false);\n\n  \t\t\t\t\tcssTransitionsComplete = true;\n  \t\t\t\t\tcheckComplete();\n  \t\t\t\t}\n\n  \t\t\t\tt.node.addEventListener(TRANSITIONEND, transitionEndHandler, false);\n\n  \t\t\t\tsetTimeout(function () {\n  \t\t\t\t\tvar i = changedProperties.length;\n  \t\t\t\t\tvar hash = undefined;\n  \t\t\t\t\tvar originalValue = undefined;\n  \t\t\t\t\tvar index = undefined;\n  \t\t\t\t\tvar propertiesToTransitionInJs = [];\n  \t\t\t\t\tvar prop = undefined;\n  \t\t\t\t\tvar suffix = undefined;\n  \t\t\t\t\tvar interpolator = undefined;\n\n  \t\t\t\t\twhile (i--) {\n  \t\t\t\t\t\tprop = changedProperties[i];\n  \t\t\t\t\t\thash = hashPrefix + prop;\n\n  \t\t\t\t\t\tif (CSS_TRANSITIONS_ENABLED && !cannotUseCssTransitions[hash]) {\n  \t\t\t\t\t\t\tt.node.style[___prefix(prop)] = to[prop];\n\n  \t\t\t\t\t\t\t// If we're not sure if CSS transitions are supported for\n  \t\t\t\t\t\t\t// this tag/property combo, find out now\n  \t\t\t\t\t\t\tif (!canUseCssTransitions[hash]) {\n  \t\t\t\t\t\t\t\toriginalValue = t.getStyle(prop);\n\n  \t\t\t\t\t\t\t\t// if this property is transitionable in this browser,\n  \t\t\t\t\t\t\t\t// the current style will be different from the target style\n  \t\t\t\t\t\t\t\tcanUseCssTransitions[hash] = t.getStyle(prop) != to[prop];\n  \t\t\t\t\t\t\t\tcannotUseCssTransitions[hash] = !canUseCssTransitions[hash];\n\n  \t\t\t\t\t\t\t\t// Reset, if we're going to use timers after all\n  \t\t\t\t\t\t\t\tif (cannotUseCssTransitions[hash]) {\n  \t\t\t\t\t\t\t\t\tt.node.style[___prefix(prop)] = originalValue;\n  \t\t\t\t\t\t\t\t}\n  \t\t\t\t\t\t\t}\n  \t\t\t\t\t\t}\n\n  \t\t\t\t\t\tif (!CSS_TRANSITIONS_ENABLED || cannotUseCssTransitions[hash]) {\n  \t\t\t\t\t\t\t// we need to fall back to timer-based stuff\n  \t\t\t\t\t\t\tif (originalValue === undefined) {\n  \t\t\t\t\t\t\t\toriginalValue = t.getStyle(prop);\n  \t\t\t\t\t\t\t}\n\n  \t\t\t\t\t\t\t// need to remove this from changedProperties, otherwise transitionEndHandler\n  \t\t\t\t\t\t\t// will get confused\n  \t\t\t\t\t\t\tindex = changedProperties.indexOf(prop);\n  \t\t\t\t\t\t\tif (index === -1) {\n  \t\t\t\t\t\t\t\twarnIfDebug('Something very strange happened with transitions. Please raise an issue at https://github.com/ractivejs/ractive/issues - thanks!', { node: t.node });\n  \t\t\t\t\t\t\t} else {\n  \t\t\t\t\t\t\t\tchangedProperties.splice(index, 1);\n  \t\t\t\t\t\t\t}\n\n  \t\t\t\t\t\t\t// TODO Determine whether this property is animatable at all\n\n  \t\t\t\t\t\t\tsuffix = /[^\\d]*$/.exec(to[prop])[0];\n  \t\t\t\t\t\t\tinterpolator = interpolate(parseFloat(originalValue), parseFloat(to[prop])) || function () {\n  \t\t\t\t\t\t\t\treturn to[prop];\n  \t\t\t\t\t\t\t};\n\n  \t\t\t\t\t\t\t// ...then kick off a timer-based transition\n  \t\t\t\t\t\t\tpropertiesToTransitionInJs.push({\n  \t\t\t\t\t\t\t\tname: ___prefix(prop),\n  \t\t\t\t\t\t\t\tinterpolator: interpolator,\n  \t\t\t\t\t\t\t\tsuffix: suffix\n  \t\t\t\t\t\t\t});\n  \t\t\t\t\t\t}\n  \t\t\t\t\t}\n\n  \t\t\t\t\t// javascript transitions\n  \t\t\t\t\tif (propertiesToTransitionInJs.length) {\n  \t\t\t\t\t\tvar easing = undefined;\n\n  \t\t\t\t\t\tif (typeof options.easing === 'string') {\n  \t\t\t\t\t\t\teasing = t.ractive.easing[options.easing];\n\n  \t\t\t\t\t\t\tif (!easing) {\n  \t\t\t\t\t\t\t\twarnOnceIfDebug(missingPlugin(options.easing, 'easing'));\n  \t\t\t\t\t\t\t\teasing = linear;\n  \t\t\t\t\t\t\t}\n  \t\t\t\t\t\t} else if (typeof options.easing === 'function') {\n  \t\t\t\t\t\t\teasing = options.easing;\n  \t\t\t\t\t\t} else {\n  \t\t\t\t\t\t\teasing = linear;\n  \t\t\t\t\t\t}\n\n  \t\t\t\t\t\tnew Ticker({\n  \t\t\t\t\t\t\tduration: options.duration,\n  \t\t\t\t\t\t\teasing: easing,\n  \t\t\t\t\t\t\tstep: function (pos) {\n  \t\t\t\t\t\t\t\tvar i = propertiesToTransitionInJs.length;\n  \t\t\t\t\t\t\t\twhile (i--) {\n  \t\t\t\t\t\t\t\t\tvar _prop = propertiesToTransitionInJs[i];\n  \t\t\t\t\t\t\t\t\tt.node.style[_prop.name] = _prop.interpolator(pos) + _prop.suffix;\n  \t\t\t\t\t\t\t\t}\n  \t\t\t\t\t\t\t},\n  \t\t\t\t\t\t\tcomplete: function () {\n  \t\t\t\t\t\t\t\tjsTransitionsComplete = true;\n  \t\t\t\t\t\t\t\tcheckComplete();\n  \t\t\t\t\t\t\t}\n  \t\t\t\t\t\t});\n  \t\t\t\t\t} else {\n  \t\t\t\t\t\tjsTransitionsComplete = true;\n  \t\t\t\t\t}\n\n  \t\t\t\t\tif (!changedProperties.length) {\n  \t\t\t\t\t\t// We need to cancel the transitionEndHandler, and deal with\n  \t\t\t\t\t\t// the fact that it will never fire\n  \t\t\t\t\t\tt.node.removeEventListener(TRANSITIONEND, transitionEndHandler, false);\n  \t\t\t\t\t\tcssTransitionsComplete = true;\n  \t\t\t\t\t\tcheckComplete();\n  \t\t\t\t\t}\n  \t\t\t\t}, 0);\n  \t\t\t}, options.delay || 0);\n  \t\t};\n  \t})();\n  }\n\n  var visible = undefined;\n  var hidden = 'hidden';\n\n  if (doc) {\n  \tvar __prefix = undefined;\n\n  \tif (hidden in doc) {\n  \t\t__prefix = '';\n  \t} else {\n  \t\tvar _i = vendors.length;\n  \t\twhile (_i--) {\n  \t\t\tvar vendor = vendors[_i];\n  \t\t\thidden = vendor + 'Hidden';\n\n  \t\t\tif (hidden in doc) {\n  \t\t\t\t__prefix = vendor;\n  \t\t\t\tbreak;\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \tif (__prefix !== undefined) {\n  \t\tdoc.addEventListener(__prefix + 'visibilitychange', onChange);\n  \t\tonChange();\n  \t} else {\n  \t\t// gah, we're in an old browser\n  \t\tif ('onfocusout' in doc) {\n  \t\t\tdoc.addEventListener('focusout', onHide);\n  \t\t\tdoc.addEventListener('focusin', onShow);\n  \t\t} else {\n  \t\t\twin.addEventListener('pagehide', onHide);\n  \t\t\twin.addEventListener('blur', onHide);\n\n  \t\t\twin.addEventListener('pageshow', onShow);\n  \t\t\twin.addEventListener('focus', onShow);\n  \t\t}\n\n  \t\tvisible = true; // until proven otherwise. Not ideal but hey\n  \t}\n  }\n\n  function onChange() {\n  \tvisible = !doc[hidden];\n  }\n\n  function onHide() {\n  \tvisible = false;\n  }\n\n  function onShow() {\n  \tvisible = true;\n  }\n\n  var getComputedStyle = win && (win.getComputedStyle || legacy.getComputedStyle);\n  var resolved = _Promise.resolve();\n\n  var Transition = (function () {\n  \tfunction Transition(owner, template, isIntro) {\n  \t\tclassCallCheck(this, Transition);\n\n  \t\tthis.owner = owner;\n  \t\tthis.isIntro = isIntro;\n  \t\tthis.ractive = owner.ractive;\n\n  \t\tvar ractive = owner.ractive;\n\n  \t\tvar name = template.n || template;\n\n  \t\tif (typeof name !== 'string') {\n  \t\t\tvar fragment = new Fragment({\n  \t\t\t\towner: owner,\n  \t\t\t\ttemplate: name\n  \t\t\t}).bind(); // TODO need a way to capture values without bind()\n\n  \t\t\tname = fragment.toString();\n  \t\t\tfragment.unbind();\n\n  \t\t\tif (name === '') {\n  \t\t\t\t// empty string okay, just no transition\n  \t\t\t\treturn;\n  \t\t\t}\n  \t\t}\n\n  \t\tthis.name = name;\n\n  \t\tif (template.a) {\n  \t\t\tthis.params = template.a;\n  \t\t} else if (template.d) {\n  \t\t\t// TODO is there a way to interpret dynamic arguments without all the\n  \t\t\t// 'dependency thrashing'?\n  \t\t\tvar fragment = new Fragment({\n  \t\t\t\towner: owner,\n  \t\t\t\ttemplate: template.d\n  \t\t\t}).bind();\n\n  \t\t\tthis.params = fragment.getArgsList();\n  \t\t\tfragment.unbind();\n  \t\t}\n\n  \t\tthis._fn = findInViewHierarchy('transitions', ractive, name);\n\n  \t\tif (!this._fn) {\n  \t\t\twarnOnceIfDebug(missingPlugin(name, 'transition'), { ractive: ractive });\n  \t\t}\n  \t}\n\n  \tTransition.prototype.animateStyle = function animateStyle(style, value, options) {\n  \t\tvar _this = this;\n\n  \t\tif (arguments.length === 4) {\n  \t\t\tthrow new Error('t.animateStyle() returns a promise - use .then() instead of passing a callback');\n  \t\t}\n\n  \t\t// Special case - page isn't visible. Don't animate anything, because\n  \t\t// that way you'll never get CSS transitionend events\n  \t\tif (!visible) {\n  \t\t\tthis.setStyle(style, value);\n  \t\t\treturn resolved;\n  \t\t}\n\n  \t\tvar to = undefined;\n\n  \t\tif (typeof style === 'string') {\n  \t\t\tto = {};\n  \t\t\tto[style] = value;\n  \t\t} else {\n  \t\t\tto = style;\n\n  \t\t\t// shuffle arguments\n  \t\t\toptions = value;\n  \t\t}\n\n  \t\t// As of 0.3.9, transition authors should supply an `option` object with\n  \t\t// `duration` and `easing` properties (and optional `delay`), plus a\n  \t\t// callback function that gets called after the animation completes\n\n  \t\t// TODO remove this check in a future version\n  \t\tif (!options) {\n  \t\t\twarnOnceIfDebug('The \"%s\" transition does not supply an options object to `t.animateStyle()`. This will break in a future version of Ractive. For more info see https://github.com/RactiveJS/Ractive/issues/340', this.name);\n  \t\t\toptions = this;\n  \t\t}\n\n  \t\treturn new _Promise(function (fulfil) {\n  \t\t\t// Edge case - if duration is zero, set style synchronously and complete\n  \t\t\tif (!options.duration) {\n  \t\t\t\t_this.setStyle(to);\n  \t\t\t\tfulfil();\n  \t\t\t\treturn;\n  \t\t\t}\n\n  \t\t\t// Get a list of the properties we're animating\n  \t\t\tvar propertyNames = Object.keys(to);\n  \t\t\tvar changedProperties = [];\n\n  \t\t\t// Store the current styles\n  \t\t\tvar computedStyle = getComputedStyle(_this.node);\n\n  \t\t\tvar i = propertyNames.length;\n  \t\t\twhile (i--) {\n  \t\t\t\tvar prop = propertyNames[i];\n  \t\t\t\tvar current = computedStyle[___prefix(prop)];\n\n  \t\t\t\tif (current === '0px') current = 0;\n\n  \t\t\t\t// we need to know if we're actually changing anything\n  \t\t\t\tif (current != to[prop]) {\n  \t\t\t\t\t// use != instead of !==, so we can compare strings with numbers\n  \t\t\t\t\tchangedProperties.push(prop);\n\n  \t\t\t\t\t// make the computed style explicit, so we can animate where\n  \t\t\t\t\t// e.g. height='auto'\n  \t\t\t\t\t_this.node.style[___prefix(prop)] = current;\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\t// If we're not actually changing anything, the transitionend event\n  \t\t\t// will never fire! So we complete early\n  \t\t\tif (!changedProperties.length) {\n  \t\t\t\tfulfil();\n  \t\t\t\treturn;\n  \t\t\t}\n\n  \t\t\tcreateTransitions(_this, to, options, changedProperties, fulfil);\n  \t\t});\n  \t};\n\n  \tTransition.prototype.getStyle = function getStyle(props) {\n  \t\tvar computedStyle = getComputedStyle(this.node);\n\n  \t\tif (typeof props === 'string') {\n  \t\t\tvar value = computedStyle[___prefix(props)];\n  \t\t\treturn value === '0px' ? 0 : value;\n  \t\t}\n\n  \t\tif (!isArray(props)) {\n  \t\t\tthrow new Error('Transition$getStyle must be passed a string, or an array of strings representing CSS properties');\n  \t\t}\n\n  \t\tvar styles = {};\n\n  \t\tvar i = props.length;\n  \t\twhile (i--) {\n  \t\t\tvar prop = props[i];\n  \t\t\tvar value = computedStyle[___prefix(prop)];\n\n  \t\t\tif (value === '0px') value = 0;\n  \t\t\tstyles[prop] = value;\n  \t\t}\n\n  \t\treturn styles;\n  \t};\n\n  \tTransition.prototype.processParams = function processParams(params, defaults) {\n  \t\tif (typeof params === 'number') {\n  \t\t\tparams = { duration: params };\n  \t\t} else if (typeof params === 'string') {\n  \t\t\tif (params === 'slow') {\n  \t\t\t\tparams = { duration: 600 };\n  \t\t\t} else if (params === 'fast') {\n  \t\t\t\tparams = { duration: 200 };\n  \t\t\t} else {\n  \t\t\t\tparams = { duration: 400 };\n  \t\t\t}\n  \t\t} else if (!params) {\n  \t\t\tparams = {};\n  \t\t}\n\n  \t\treturn __extend({}, defaults, params);\n  \t};\n\n  \tTransition.prototype.setStyle = function setStyle(style, value) {\n  \t\tif (typeof style === 'string') {\n  \t\t\tthis.node.style[___prefix(style)] = value;\n  \t\t} else {\n  \t\t\tvar prop = undefined;\n  \t\t\tfor (prop in style) {\n  \t\t\t\tif (style.hasOwnProperty(prop)) {\n  \t\t\t\t\tthis.node.style[___prefix(prop)] = style[prop];\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\treturn this;\n  \t};\n\n  \tTransition.prototype.start = function start() {\n  \t\tvar _this2 = this;\n\n  \t\tvar node = this.node = this.owner.node;\n  \t\tvar originalStyle = node.getAttribute('style');\n\n  \t\tvar completed = undefined;\n\n  \t\t// create t.complete() - we don't want this on the prototype,\n  \t\t// because we don't want `this` silliness when passing it as\n  \t\t// an argument\n  \t\tthis.complete = function (noReset) {\n  \t\t\tif (completed) {\n  \t\t\t\treturn;\n  \t\t\t}\n\n  \t\t\tif (!noReset && _this2.isIntro) {\n  \t\t\t\tresetStyle(node, originalStyle);\n  \t\t\t}\n\n  \t\t\t_this2._manager.remove(_this2);\n\n  \t\t\tcompleted = true;\n  \t\t};\n\n  \t\t// If the transition function doesn't exist, abort\n  \t\tif (!this._fn) {\n  \t\t\tthis.complete();\n  \t\t\treturn;\n  \t\t}\n\n  \t\tthis._fn.apply(this.root, [this].concat(this.params));\n  \t};\n\n  \treturn Transition;\n  })();\n\n  function _updateLiveQueries(element) {\n  \t// Does this need to be added to any live queries?\n  \tvar node = element.node;\n  \tvar instance = element.ractive;\n\n  \tdo {\n  \t\tvar liveQueries = instance._liveQueries;\n\n  \t\tvar i = liveQueries.length;\n  \t\twhile (i--) {\n  \t\t\tvar selector = liveQueries[i];\n  \t\t\tvar query = liveQueries[\"_\" + selector];\n\n  \t\t\tif (query.test(node)) {\n  \t\t\t\tquery.add(node);\n  \t\t\t\t// keep register of applicable selectors, for when we teardown\n  \t\t\t\telement.liveQueries.push(query);\n  \t\t\t}\n  \t\t}\n  \t} while (instance = instance.parent);\n  }\n\n  // TODO element.parent currently undefined\n  function findParentForm(element) {\n  \twhile (element = element.parent) {\n  \t\tif (element.name === 'form') {\n  \t\t\treturn element;\n  \t\t}\n  \t}\n  }\n\n  function warnAboutAmbiguity(description, ractive) {\n  \twarnOnceIfDebug('The ' + description + ' being used for two-way binding is ambiguous, and may cause unexpected results. Consider initialising your data to eliminate the ambiguity', { ractive: ractive });\n  }\n\n  var Binding = (function () {\n  \tfunction Binding(element) {\n  \t\tvar name = arguments.length <= 1 || arguments[1] === undefined ? 'value' : arguments[1];\n  \t\tclassCallCheck(this, Binding);\n\n  \t\tthis.element = element;\n  \t\tthis.ractive = element.ractive;\n  \t\tthis.attribute = element.attributeByName[name];\n\n  \t\tvar interpolator = this.attribute.interpolator;\n  \t\tinterpolator.twowayBinding = this;\n\n  \t\tvar model = interpolator.model;\n\n  \t\t// not bound?\n  \t\tif (!model) {\n  \t\t\t// try to force resolution\n  \t\t\tinterpolator.resolver.forceResolution();\n  \t\t\tmodel = interpolator.model;\n\n  \t\t\twarnAboutAmbiguity('\\'' + interpolator.template.r + '\\' reference', this.ractive);\n  \t\t} else if (model.isUnresolved) {\n  \t\t\t// reference expressions (e.g. foo[bar])\n  \t\t\tmodel.forceResolution();\n  \t\t\twarnAboutAmbiguity('expression', this.ractive);\n  \t\t}\n\n  \t\t// TODO include index/key/keypath refs as read-only\n  \t\telse if (model.isReadonly) {\n  \t\t\t\tvar keypath = model.getKeypath().replace(/^@/, '');\n  \t\t\t\twarnOnceIfDebug('Cannot use two-way binding on <' + element.name + '> element: ' + keypath + ' is read-only. To suppress this warning use <' + element.name + ' twoway=\\'false\\'...>', { ractive: this.ractive });\n  \t\t\t\treturn false;\n  \t\t\t}\n\n  \t\tthis.attribute.isTwoway = true;\n  \t\tthis.model = model;\n\n  \t\t// initialise value, if it's undefined\n  \t\tvar value = model.get();\n\n  \t\tif (value === undefined && this.getInitialValue) {\n  \t\t\tvalue = this.getInitialValue();\n  \t\t\tmodel.set(value);\n  \t\t}\n\n  \t\tvar parentForm = findParentForm(element);\n  \t\tif (parentForm) {\n  \t\t\tthis.resetValue = value;\n  \t\t\tparentForm.formBindings.push(this);\n  \t\t}\n  \t}\n\n  \tBinding.prototype.bind = function bind() {\n  \t\tthis.model.registerTwowayBinding(this);\n  \t};\n\n  \tBinding.prototype.handleChange = function handleChange() {\n  \t\tvar _this = this;\n\n  \t\trunloop.start(this.root);\n  \t\tthis.attribute.locked = true;\n  \t\tthis.model.set(this.getValue());\n  \t\trunloop.scheduleTask(function () {\n  \t\t\treturn _this.attribute.locked = false;\n  \t\t});\n  \t\trunloop.end();\n  \t};\n\n  \tBinding.prototype.rebind = function rebind() {\n  \t\t// TODO what does this work with CheckboxNameBinding et al?\n  \t\tthis.unbind();\n  \t\tthis.model = this.attribute.interpolator.model;\n  \t\tthis.bind();\n  \t};\n\n  \tBinding.prototype.render = function render() {\n  \t\tthis.node = this.element.node;\n  \t\tthis.node._ractive.binding = this;\n  \t\tthis.rendered = true; // TODO is this used anywhere?\n  \t};\n\n  \tBinding.prototype.unbind = function unbind() {\n  \t\tthis.model.unregisterTwowayBinding(this);\n  \t};\n\n  \tBinding.prototype.unrender = function unrender() {\n  \t\t// noop?\n  \t};\n\n  \treturn Binding;\n  })();\n\n  // This is the handler for DOM events that would lead to a change in the model\n  // (i.e. change, sometimes, input, and occasionally click and keyup)\n\n  function handleDomEvent() {\n  \tthis._ractive.binding.handleChange();\n  }\n\n  function handleBlur() {\n  \thandleDomEvent.call(this);\n\n  \tvar value = this._ractive.binding.model.get();\n  \tthis.value = value == undefined ? '' : value;\n  }\n\n  function handleDelay(delay) {\n  \tvar timeout = undefined;\n\n  \treturn function () {\n  \t\tvar _this = this;\n\n  \t\tif (timeout) clearTimeout(timeout);\n\n  \t\ttimeout = setTimeout(function () {\n  \t\t\tvar binding = _this._ractive.binding;\n  \t\t\tif (binding.rendered) handleDomEvent.call(_this);\n  \t\t\ttimeout = null;\n  \t\t}, delay);\n  \t};\n  }\n\n  var GenericBinding = (function (_Binding) {\n  \tinherits(GenericBinding, _Binding);\n\n  \tfunction GenericBinding() {\n  \t\tclassCallCheck(this, GenericBinding);\n\n  \t\t_Binding.apply(this, arguments);\n  \t}\n\n  \tGenericBinding.prototype.getInitialValue = function getInitialValue() {\n  \t\treturn '';\n  \t};\n\n  \tGenericBinding.prototype.getValue = function getValue() {\n  \t\treturn this.node.value;\n  \t};\n\n  \tGenericBinding.prototype.render = function render() {\n  \t\t_Binding.prototype.render.call(this);\n\n  \t\t// any lazy setting for this element overrides the root\n  \t\t// if the value is a number, it's a timeout\n  \t\tvar lazy = this.ractive.lazy;\n  \t\tvar timeout = false;\n\n  \t\t// TODO handle at parse time\n  \t\tif (this.element.template.a && 'lazy' in this.element.template.a) {\n  \t\t\tlazy = this.element.template.a.lazy;\n  \t\t\tif (lazy === 0) lazy = true; // empty attribute\n  \t\t}\n\n  \t\t// TODO handle this at parse time as well?\n  \t\tif (lazy === 'false') lazy = false;\n\n  \t\tif (isNumeric(lazy)) {\n  \t\t\ttimeout = +lazy;\n  \t\t\tlazy = false;\n  \t\t}\n\n  \t\tthis.handler = timeout ? handleDelay(timeout) : handleDomEvent;\n\n  \t\tvar node = this.node;\n\n  \t\tnode.addEventListener('change', handleDomEvent, false);\n\n  \t\tif (!lazy) {\n  \t\t\tnode.addEventListener('input', this.handler, false);\n\n  \t\t\tif (node.attachEvent) {\n  \t\t\t\tnode.addEventListener('keyup', this.handler, false);\n  \t\t\t}\n  \t\t}\n\n  \t\tnode.addEventListener('blur', handleBlur, false);\n  \t};\n\n  \tGenericBinding.prototype.unrender = function unrender() {\n  \t\tvar node = this.element.node;\n  \t\tthis.rendered = false;\n\n  \t\tnode.removeEventListener('change', handleDomEvent, false);\n  \t\tnode.removeEventListener('input', this.handler, false);\n  \t\tnode.removeEventListener('keyup', this.handler, false);\n  \t\tnode.removeEventListener('blur', handleBlur, false);\n  \t};\n\n  \treturn GenericBinding;\n  })(Binding);\n\n  var SingleSelectBinding = (function (_Binding) {\n  \tinherits(SingleSelectBinding, _Binding);\n\n  \tfunction SingleSelectBinding() {\n  \t\tclassCallCheck(this, SingleSelectBinding);\n\n  \t\t_Binding.apply(this, arguments);\n  \t}\n\n  \tSingleSelectBinding.prototype.forceUpdate = function forceUpdate() {\n  \t\tvar _this = this;\n\n  \t\tvar value = this.getValue();\n\n  \t\tif (value !== undefined) {\n  \t\t\tthis.attribute.locked = true;\n  \t\t\trunloop.scheduleTask(function () {\n  \t\t\t\treturn _this.attribute.locked = false;\n  \t\t\t});\n  \t\t\tthis.model.set(value);\n  \t\t}\n  \t};\n\n  \tSingleSelectBinding.prototype.getInitialValue = function getInitialValue() {\n  \t\tif (this.element.getAttribute('value') !== undefined) {\n  \t\t\treturn;\n  \t\t}\n\n  \t\tvar options = this.element.options;\n  \t\tvar len = options.length;\n\n  \t\tif (!len) return;\n\n  \t\tvar value = undefined;\n  \t\tvar optionWasSelected = undefined;\n  \t\tvar i = len;\n\n  \t\t// take the final selected option...\n  \t\twhile (i--) {\n  \t\t\tvar option = options[i];\n\n  \t\t\tif (option.getAttribute('selected')) {\n  \t\t\t\tif (!option.getAttribute('disabled')) {\n  \t\t\t\t\tvalue = option.getAttribute('value');\n  \t\t\t\t}\n\n  \t\t\t\toptionWasSelected = true;\n  \t\t\t\tbreak;\n  \t\t\t}\n  \t\t}\n\n  \t\t// or the first non-disabled option, if none are selected\n  \t\tif (!optionWasSelected) {\n  \t\t\twhile (++i < len) {\n  \t\t\t\tif (!options[i].getAttribute('disabled')) {\n  \t\t\t\t\tvalue = options[i].getAttribute('value');\n  \t\t\t\t\tbreak;\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\t// This is an optimisation (aka hack) that allows us to forgo some\n  \t\t// other more expensive work\n  \t\t// TODO does it still work? seems at odds with new architecture\n  \t\tif (value !== undefined) {\n  \t\t\tthis.element.attributeByName.value.value = value;\n  \t\t}\n\n  \t\treturn value;\n  \t};\n\n  \tSingleSelectBinding.prototype.getValue = function getValue() {\n  \t\tvar options = this.node.options;\n  \t\tvar len = options.length;\n\n  \t\tvar i = undefined;\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tvar option = options[i];\n\n  \t\t\tif (options[i].selected && !options[i].disabled) {\n  \t\t\t\treturn option._ractive ? option._ractive.value : option.value;\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tSingleSelectBinding.prototype.render = function render() {\n  \t\t_Binding.prototype.render.call(this);\n  \t\tthis.node.addEventListener('change', handleDomEvent, false);\n  \t};\n\n  \t// TODO this method is an anomaly... is it necessary?\n\n  \tSingleSelectBinding.prototype.setValue = function setValue(value) {\n  \t\tthis.model.set(value);\n  \t};\n\n  \tSingleSelectBinding.prototype.unrender = function unrender() {\n  \t\tthis.node.removeEventListener('change', handleDomEvent, false);\n  \t};\n\n  \treturn SingleSelectBinding;\n  })(Binding);\n\n  var MultipleSelectBinding = (function (_Binding) {\n  \tinherits(MultipleSelectBinding, _Binding);\n\n  \tfunction MultipleSelectBinding() {\n  \t\tclassCallCheck(this, MultipleSelectBinding);\n\n  \t\t_Binding.apply(this, arguments);\n  \t}\n\n  \tMultipleSelectBinding.prototype.forceUpdate = function forceUpdate() {\n  \t\tvar _this = this;\n\n  \t\tvar value = this.getValue();\n\n  \t\tif (value !== undefined) {\n  \t\t\tthis.attribute.locked = true;\n  \t\t\trunloop.scheduleTask(function () {\n  \t\t\t\treturn _this.attribute.locked = false;\n  \t\t\t});\n  \t\t\tthis.model.set(value);\n  \t\t}\n  \t};\n\n  \tMultipleSelectBinding.prototype.getInitialValue = function getInitialValue() {\n  \t\treturn this.element.options.filter(function (option) {\n  \t\t\treturn option.getAttribute('selected');\n  \t\t}).map(function (option) {\n  \t\t\treturn option.getAttribute('value');\n  \t\t});\n  \t};\n\n  \tMultipleSelectBinding.prototype.getValue = function getValue() {\n  \t\tvar options = this.element.node.options;\n  \t\tvar len = options.length;\n\n  \t\tvar selectedValues = [];\n\n  \t\tfor (var i = 0; i < len; i += 1) {\n  \t\t\tvar option = options[i];\n\n  \t\t\tif (option.selected) {\n  \t\t\t\tvar optionValue = option._ractive ? option._ractive.value : option.value;\n  \t\t\t\tselectedValues.push(optionValue);\n  \t\t\t}\n  \t\t}\n\n  \t\treturn selectedValues;\n  \t};\n\n  \tMultipleSelectBinding.prototype.handleChange = function handleChange() {\n  \t\tvar attribute = this.attribute;\n  \t\tvar previousValue = attribute.getValue();\n\n  \t\tvar value = this.getValue();\n\n  \t\tif (previousValue === undefined || !arrayContentsMatch(value, previousValue)) {\n  \t\t\t_Binding.prototype.handleChange.call(this);\n  \t\t}\n\n  \t\treturn this;\n  \t};\n\n  \tMultipleSelectBinding.prototype.render = function render() {\n  \t\t_Binding.prototype.render.call(this);\n\n  \t\tthis.node.addEventListener('change', handleDomEvent, false);\n\n  \t\tif (this.model.get() === undefined) {\n  \t\t\t// get value from DOM, if possible\n  \t\t\tthis.handleChange();\n  \t\t}\n  \t};\n\n  \tMultipleSelectBinding.prototype.setValue = function setValue() {\n  \t\tthrow new Error('TODO not implemented yet');\n  \t};\n\n  \tMultipleSelectBinding.prototype.unrender = function unrender() {\n  \t\tthis.node.removeEventListener('change', handleDomEvent, false);\n  \t};\n\n  \tMultipleSelectBinding.prototype.updateModel = function updateModel() {\n  \t\tif (this.attribute.value === undefined || !this.attribute.value.length) {\n  \t\t\tthis.keypath.set(this.initialValue);\n  \t\t}\n  \t};\n\n  \treturn MultipleSelectBinding;\n  })(Binding);\n\n  var NumericBinding = (function (_GenericBinding) {\n  \tinherits(NumericBinding, _GenericBinding);\n\n  \tfunction NumericBinding() {\n  \t\tclassCallCheck(this, NumericBinding);\n\n  \t\t_GenericBinding.apply(this, arguments);\n  \t}\n\n  \tNumericBinding.prototype.getInitialValue = function getInitialValue() {\n  \t\treturn undefined;\n  \t};\n\n  \tNumericBinding.prototype.getValue = function getValue() {\n  \t\tvar value = parseFloat(this.node.value);\n  \t\treturn isNaN(value) ? undefined : value;\n  \t};\n\n  \treturn NumericBinding;\n  })(GenericBinding);\n\n  var CheckboxBinding = (function (_Binding) {\n  \tinherits(CheckboxBinding, _Binding);\n\n  \tfunction CheckboxBinding(element) {\n  \t\tclassCallCheck(this, CheckboxBinding);\n\n  \t\t_Binding.call(this, element, 'checked');\n  \t}\n\n  \tCheckboxBinding.prototype.render = function render() {\n  \t\t_Binding.prototype.render.call(this);\n\n  \t\tthis.node.addEventListener('change', handleDomEvent, false);\n\n  \t\tif (this.node.attachEvent) {\n  \t\t\tthis.node.addEventListener('click', handleDomEvent, false);\n  \t\t}\n  \t};\n\n  \tCheckboxBinding.prototype.unrender = function unrender() {\n  \t\tthis.node.removeEventListener('change', handleDomEvent, false);\n  \t\tthis.node.removeEventListener('click', handleDomEvent, false);\n  \t};\n\n  \tCheckboxBinding.prototype.getInitialValue = function getInitialValue() {\n  \t\treturn !!this.element.getAttribute('checked');\n  \t};\n\n  \tCheckboxBinding.prototype.getValue = function getValue() {\n  \t\treturn this.node.checked;\n  \t};\n\n  \treturn CheckboxBinding;\n  })(Binding);\n\n  var siblings = {};\n\n  function getSiblings(hash) {\n  \treturn siblings[hash] || (siblings[hash] = []);\n  }\n\n  var RadioBinding = (function (_Binding) {\n  \tinherits(RadioBinding, _Binding);\n\n  \tfunction RadioBinding(element) {\n  \t\tclassCallCheck(this, RadioBinding);\n\n  \t\t_Binding.call(this, element, 'checked');\n\n  \t\t// TODO this should use getBindingGroup\n  \t\tthis.siblings = getSiblings(this.ractive._guid + this.element.getAttribute('name'));\n  \t\tthis.siblings.push(this);\n  \t}\n\n  \tRadioBinding.prototype.getValue = function getValue() {\n  \t\treturn this.node.checked;\n  \t};\n\n  \tRadioBinding.prototype.handleChange = function handleChange() {\n  \t\trunloop.start(this.root);\n\n  \t\tthis.siblings.forEach(function (binding) {\n  \t\t\tbinding.model.set(binding.getValue());\n  \t\t});\n\n  \t\trunloop.end();\n  \t};\n\n  \tRadioBinding.prototype.render = function render() {\n  \t\t_Binding.prototype.render.call(this);\n\n  \t\tthis.node.addEventListener('change', handleDomEvent, false);\n\n  \t\tif (this.node.attachEvent) {\n  \t\t\tthis.node.addEventListener('click', handleDomEvent, false);\n  \t\t}\n  \t};\n\n  \tRadioBinding.prototype.unbind = function unbind() {\n  \t\tremoveFromArray(this.siblings, this);\n  \t};\n\n  \tRadioBinding.prototype.unrender = function unrender() {\n  \t\tthis.node.removeEventListener('change', handleDomEvent, false);\n  \t\tthis.node.removeEventListener('click', handleDomEvent, false);\n  \t};\n\n  \treturn RadioBinding;\n  })(Binding);\n\n  var groups = {};\n  function getBindingGroup(id, group, model, getValue) {\n  \tvar hash = id + group + model.getKeypath();\n  \treturn groups[hash] || (groups[hash] = new BindingGroup(model, getValue));\n  }\n\n  var BindingGroup = (function () {\n  \tfunction BindingGroup(model, getValue) {\n  \t\tclassCallCheck(this, BindingGroup);\n\n  \t\tthis.model = model;\n  \t\tthis.getValue = getValue;\n\n  \t\tthis.bindings = [];\n  \t}\n\n  \tBindingGroup.prototype.add = function add(binding) {\n  \t\tthis.bindings.push(binding);\n  \t};\n\n  \tBindingGroup.prototype.bind = function bind() {\n  \t\tthis.model.registerTwowayBinding(this);\n  \t\tthis.bound = true;\n  \t};\n\n  \tBindingGroup.prototype.remove = function remove(binding) {\n  \t\tremoveFromArray(this.bindings, binding);\n  \t\tif (!this.bindings.length) {\n  \t\t\tthis.unbind();\n  \t\t}\n  \t};\n\n  \tBindingGroup.prototype.unbind = function unbind() {\n  \t\tthis.model.unregisterTwowayBinding(this);\n  \t\tthis.bound = false;\n  \t};\n\n  \treturn BindingGroup;\n  })();\n\n  function isChecked(binding) {\n  \treturn binding.node.checked;\n  }\n\n  function _getValue(binding) {\n  \treturn binding.element.getAttribute('value');\n  }\n\n  function _getGroupValue() {\n  \treturn this.bindings.filter(isChecked).map(_getValue);\n  }\n\n  var push = [].push;\n\n  var CheckboxNameBinding = (function (_Binding) {\n  \tinherits(CheckboxNameBinding, _Binding);\n\n  \tfunction CheckboxNameBinding(element) {\n  \t\tclassCallCheck(this, CheckboxNameBinding);\n\n  \t\t_Binding.call(this, element, 'name');\n\n  \t\tthis.checkboxName = true; // so that ractive.updateModel() knows what to do with this\n\n  \t\t// Each input has a reference to an array containing it and its\n  \t\t// group, as two-way binding depends on being able to ascertain\n  \t\t// the status of all inputs within the group\n  \t\tthis.group = getBindingGroup(this.ractive._guid, 'checkboxes', this.model, _getGroupValue);\n  \t\tthis.group.add(this);\n\n  \t\tif (this.noInitialValue) {\n  \t\t\tthis.group.noInitialValue = true;\n  \t\t}\n\n  \t\t// If no initial value was set, and this input is checked, we\n  \t\t// update the model\n  \t\tif (this.group.noInitialValue && this.element.getAttribute('checked')) {\n  \t\t\tvar existingValue = this.model.get();\n  \t\t\tvar bindingValue = this.element.getAttribute('value');\n\n  \t\t\tpush.call(existingValue, bindingValue); // to avoid triggering runloop with array adaptor\n  \t\t}\n  \t}\n\n  \tCheckboxNameBinding.prototype.bind = function bind() {\n  \t\tif (!this.group.bound) {\n  \t\t\tthis.group.bind();\n  \t\t}\n  \t};\n\n  \tCheckboxNameBinding.prototype.changed = function changed() {\n  \t\tvar wasChecked = !!this.isChecked;\n  \t\tthis.isChecked = this.node.checked;\n  \t\treturn this.isChecked === wasChecked;\n  \t};\n\n  \tCheckboxNameBinding.prototype.getInitialValue = function getInitialValue() {\n  \t\t// This only gets called once per group (of inputs that\n  \t\t// share a name), because it only gets called if there\n  \t\t// isn't an initial value. By the same token, we can make\n  \t\t// a note of that fact that there was no initial value,\n  \t\t// and populate it using any `checked` attributes that\n  \t\t// exist (which users should avoid, but which we should\n  \t\t// support anyway to avoid breaking expectations)\n  \t\tthis.noInitialValue = true;\n  \t\treturn [];\n  \t};\n\n  \tCheckboxNameBinding.prototype.getValue = function getValue() {\n  \t\treturn this.group.getValue();\n  \t};\n\n  \tCheckboxNameBinding.prototype.handleChange = function handleChange() {\n  \t\tthis.isChecked = this.element.node.checked;\n  \t\t_Binding.prototype.handleChange.call(this);\n  \t};\n\n  \tCheckboxNameBinding.prototype.render = function render() {\n  \t\t_Binding.prototype.render.call(this);\n\n  \t\tvar node = this.node;\n\n  \t\tvar existingValue = this.model.get();\n  \t\tvar bindingValue = this.element.getAttribute('value');\n\n  \t\tif (isArray(existingValue)) {\n  \t\t\tthis.isChecked = arrayContains(existingValue, bindingValue);\n  \t\t} else {\n  \t\t\tthis.isChecked = existingValue == bindingValue;\n  \t\t}\n\n  \t\tnode.name = '{{' + this.model.getKeypath() + '}}';\n  \t\tnode.checked = this.isChecked;\n\n  \t\tnode.addEventListener('change', handleDomEvent, false);\n\n  \t\t// in case of IE emergency, bind to click event as well\n  \t\tif (node.attachEvent) {\n  \t\t\tnode.addEventListener('click', handleDomEvent, false);\n  \t\t}\n  \t};\n\n  \tCheckboxNameBinding.prototype.unbind = function unbind() {\n  \t\tthis.group.remove(this);\n  \t};\n\n  \tCheckboxNameBinding.prototype.unrender = function unrender() {\n  \t\tvar node = this.element.node;\n\n  \t\tnode.removeEventListener('change', handleDomEvent, false);\n  \t\tnode.removeEventListener('click', handleDomEvent, false);\n  \t};\n\n  \treturn CheckboxNameBinding;\n  })(Binding);\n\n  function getGroupValue() {\n  \tvar i = this.bindings.length;\n  \twhile (i--) {\n  \t\tvar binding = this.bindings[i];\n  \t\tif (binding.node.checked) return binding.element.getAttribute('value');\n  \t}\n  }\n\n  var RadioNameBinding = (function (_Binding) {\n  \tinherits(RadioNameBinding, _Binding);\n\n  \tfunction RadioNameBinding(element) {\n  \t\tclassCallCheck(this, RadioNameBinding);\n\n  \t\t_Binding.call(this, element, 'name');\n\n  \t\tthis.group = getBindingGroup(this.ractive._guid, 'radioname', this.model, getGroupValue);\n  \t\tthis.group.add(this);\n  \t}\n\n  \tRadioNameBinding.prototype.bind = function bind() {\n  \t\tvar _this = this;\n\n  \t\tif (!this.group.bound) {\n  \t\t\tthis.group.bind();\n  \t\t}\n\n  \t\t// update name keypath when necessary\n  \t\tthis.nameAttributeBinding = {\n  \t\t\thandleChange: function () {\n  \t\t\t\treturn _this.node.name = '{{' + _this.model.getKeypath() + '}}';\n  \t\t\t}\n  \t\t};\n\n  \t\tthis.model.getKeypathModel().register(this.nameAttributeBinding);\n  \t};\n\n  \tRadioNameBinding.prototype.getInitialValue = function getInitialValue() {\n  \t\tif (this.element.getAttribute('checked')) {\n  \t\t\treturn this.element.getAttribute('value');\n  \t\t}\n  \t};\n\n  \tRadioNameBinding.prototype.getValue = function getValue() {\n  \t\treturn this.element.getAttribute('value');\n  \t};\n\n  \tRadioNameBinding.prototype.handleChange = function handleChange() {\n  \t\t// If this <input> is the one that's checked, then the value of its\n  \t\t// `name` model gets set to its value\n  \t\tif (this.node.checked) {\n  \t\t\t_Binding.prototype.handleChange.call(this);\n  \t\t}\n  \t};\n\n  \tRadioNameBinding.prototype.render = function render() {\n  \t\t_Binding.prototype.render.call(this);\n\n  \t\tvar node = this.node;\n\n  \t\tnode.name = '{{' + this.model.getKeypath() + '}}';\n  \t\tnode.checked = this.model.get() == this.element.getAttribute('value');\n\n  \t\tnode.addEventListener('change', handleDomEvent, false);\n\n  \t\tif (node.attachEvent) {\n  \t\t\tnode.addEventListener('click', handleDomEvent, false);\n  \t\t}\n  \t};\n\n  \tRadioNameBinding.prototype.unbind = function unbind() {\n  \t\tthis.group.remove(this);\n\n  \t\tthis.model.getKeypathModel().unregister(this.nameAttributeBinding);\n  \t};\n\n  \tRadioNameBinding.prototype.unrender = function unrender() {\n  \t\tvar node = this.node;\n\n  \t\tnode.removeEventListener('change', handleDomEvent, false);\n  \t\tnode.removeEventListener('click', handleDomEvent, false);\n  \t};\n\n  \treturn RadioNameBinding;\n  })(Binding);\n\n  var ContentEditableBinding = (function (_Binding) {\n  \tinherits(ContentEditableBinding, _Binding);\n\n  \tfunction ContentEditableBinding() {\n  \t\tclassCallCheck(this, ContentEditableBinding);\n\n  \t\t_Binding.apply(this, arguments);\n  \t}\n\n  \tContentEditableBinding.prototype.getInitialValue = function getInitialValue() {\n  \t\treturn this.element.fragment ? this.element.fragment.toString() : '';\n  \t};\n\n  \tContentEditableBinding.prototype.render = function render() {\n  \t\t_Binding.prototype.render.call(this);\n\n  \t\tvar node = this.node;\n\n  \t\tnode.addEventListener('change', handleDomEvent, false);\n  \t\tnode.addEventListener('blur', handleDomEvent, false);\n\n  \t\tif (!this.ractive.lazy) {\n  \t\t\tnode.addEventListener('input', handleDomEvent, false);\n\n  \t\t\tif (node.attachEvent) {\n  \t\t\t\tnode.addEventListener('keyup', handleDomEvent, false);\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tContentEditableBinding.prototype.unrender = function unrender() {\n  \t\tvar node = this.node;\n\n  \t\tnode.removeEventListener('blur', handleDomEvent, false);\n  \t\tnode.removeEventListener('change', handleDomEvent, false);\n  \t\tnode.removeEventListener('input', handleDomEvent, false);\n  \t\tnode.removeEventListener('keyup', handleDomEvent, false);\n  \t};\n\n  \tContentEditableBinding.prototype.getValue = function getValue() {\n  \t\treturn this.element.node.innerHTML;\n  \t};\n\n  \treturn ContentEditableBinding;\n  })(Binding);\n\n  function isBindable(attribute) {\n  \treturn attribute && attribute.template.length === 1 && attribute.template[0].t === INTERPOLATOR && !attribute.template[0].s;\n  }\n\n  function selectBinding(element) {\n  \tvar attributes = element.attributeByName;\n\n  \t// contenteditable - bind if the contenteditable attribute is true\n  \t// or is bindable and may thus become true...\n  \tif (element.getAttribute('contenteditable') || isBindable(attributes.contenteditable)) {\n  \t\t// ...and this element also has a value attribute to bind\n  \t\treturn isBindable(attributes.value) ? ContentEditableBinding : null;\n  \t}\n\n  \t// <input>\n  \tif (element.name === 'input') {\n  \t\tvar type = element.getAttribute('type');\n\n  \t\tif (type === 'radio' || type === 'checkbox') {\n  \t\t\tvar bindName = isBindable(attributes.name);\n  \t\t\tvar bindChecked = isBindable(attributes.checked);\n\n  \t\t\t// we can either bind the name attribute, or the checked attribute - not both\n  \t\t\tif (bindName && bindChecked) {\n  \t\t\t\twarnIfDebug('A radio input can have two-way binding on its name attribute, or its checked attribute - not both', { ractive: element.root });\n  \t\t\t}\n\n  \t\t\tif (bindName) {\n  \t\t\t\treturn type === 'radio' ? RadioNameBinding : CheckboxNameBinding;\n  \t\t\t}\n\n  \t\t\tif (bindChecked) {\n  \t\t\t\treturn type === 'radio' ? RadioBinding : CheckboxBinding;\n  \t\t\t}\n  \t\t}\n\n  \t\tif (type === 'file' && isBindable(attributes.value)) {\n  \t\t\treturn Binding;\n  \t\t}\n\n  \t\tif (isBindable(attributes.value)) {\n  \t\t\treturn type === 'number' || type === 'range' ? NumericBinding : GenericBinding;\n  \t\t}\n\n  \t\treturn null;\n  \t}\n\n  \t// <select>\n  \tif (element.name === 'select' && isBindable(attributes.value)) {\n  \t\treturn element.getAttribute('multiple') ? MultipleSelectBinding : SingleSelectBinding;\n  \t}\n\n  \t// <textarea>\n  \tif (element.name === 'textarea' && isBindable(attributes.value)) {\n  \t\treturn GenericBinding;\n  \t}\n  }\n\n  var starMaps = {};\n\n  // This function takes a keypath such as 'foo.bar.baz', and returns\n  // all the variants of that keypath that include a wildcard in place\n  // of a key, such as 'foo.bar.*', 'foo.*.baz', 'foo.*.*' and so on.\n  // These are then checked against the dependants map (ractive.viewmodel.depsMap)\n  // to see if any pattern observers are downstream of one or more of\n  // these wildcard keypaths (e.g. 'foo.bar.*.status')\n\n  function getPotentialWildcardMatches(keypath) {\n  \tvar keys, starMap, mapper, i, result, wildcardKeypath;\n\n  \tkeys = keypath.split('.');\n  \tif (!(starMap = starMaps[keys.length])) {\n  \t\tstarMap = getStarMap(keys.length);\n  \t}\n\n  \tresult = [];\n\n  \tmapper = function (star, i) {\n  \t\treturn star ? '*' : keys[i];\n  \t};\n\n  \ti = starMap.length;\n  \twhile (i--) {\n  \t\twildcardKeypath = starMap[i].map(mapper).join('.');\n\n  \t\tif (!result.hasOwnProperty(wildcardKeypath)) {\n  \t\t\tresult.push(wildcardKeypath);\n  \t\t\tresult[wildcardKeypath] = true;\n  \t\t}\n  \t}\n\n  \treturn result;\n  }\n\n  // This function returns all the possible true/false combinations for\n  // a given number - e.g. for two, the possible combinations are\n  // [ true, true ], [ true, false ], [ false, true ], [ false, false ].\n  // It does so by getting all the binary values between 0 and e.g. 11\n  function getStarMap(num) {\n  \tvar ones = '',\n  \t    max,\n  \t    binary,\n  \t    starMap,\n  \t    mapper,\n  \t    i,\n  \t    j,\n  \t    l,\n  \t    map;\n\n  \tif (!starMaps[num]) {\n  \t\tstarMap = [];\n\n  \t\twhile (ones.length < num) {\n  \t\t\tones += 1;\n  \t\t}\n\n  \t\tmax = parseInt(ones, 2);\n\n  \t\tmapper = function (digit) {\n  \t\t\treturn digit === '1';\n  \t\t};\n\n  \t\tfor (i = 0; i <= max; i += 1) {\n  \t\t\tbinary = i.toString(2);\n  \t\t\twhile (binary.length < num) {\n  \t\t\t\tbinary = '0' + binary;\n  \t\t\t}\n\n  \t\t\tmap = [];\n  \t\t\tl = binary.length;\n  \t\t\tfor (j = 0; j < l; j++) {\n  \t\t\t\tmap.push(mapper(binary[j]));\n  \t\t\t}\n  \t\t\tstarMap[i] = map;\n  \t\t}\n\n  \t\tstarMaps[num] = starMap;\n  \t}\n\n  \treturn starMaps[num];\n  }\n\n  function enqueue(ractive, event) {\n  \tif (ractive.event) {\n  \t\tractive._eventQueue.push(ractive.event);\n  \t}\n\n  \tractive.event = event;\n  }\n\n  function dequeue(ractive) {\n  \tif (ractive._eventQueue.length) {\n  \t\tractive.event = ractive._eventQueue.pop();\n  \t} else {\n  \t\tractive.event = null;\n  \t}\n  }\n\n  var wildcardCache = {};\n  function fireEvent(ractive, eventName) {\n  \tvar options = arguments.length <= 2 || arguments[2] === undefined ? {} : arguments[2];\n\n  \tif (!eventName) {\n  \t\treturn;\n  \t}\n\n  \tif (!options.event) {\n  \t\toptions.event = {\n  \t\t\tname: eventName,\n  \t\t\t// until event not included as argument default\n  \t\t\t_noArg: true\n  \t\t};\n  \t} else {\n  \t\toptions.event.name = eventName;\n  \t}\n\n  \tvar eventNames = getWildcardNames(eventName);\n\n  \tfireEventAs(ractive, eventNames, options.event, options.args, true);\n  }\n\n  function getWildcardNames(eventName) {\n  \tif (wildcardCache.hasOwnProperty(eventName)) {\n  \t\treturn wildcardCache[eventName];\n  \t} else {\n  \t\treturn wildcardCache[eventName] = getPotentialWildcardMatches(eventName);\n  \t}\n  }\n\n  function fireEventAs(ractive, eventNames, event, args) {\n  \tvar initialFire = arguments.length <= 4 || arguments[4] === undefined ? false : arguments[4];\n\n  \tvar subscribers,\n  \t    i,\n  \t    bubble = true;\n\n  \tenqueue(ractive, event);\n\n  \tfor (i = eventNames.length; i >= 0; i--) {\n  \t\tsubscribers = ractive._subs[eventNames[i]];\n\n  \t\tif (subscribers) {\n  \t\t\tbubble = notifySubscribers(ractive, subscribers, event, args) && bubble;\n  \t\t}\n  \t}\n\n  \tdequeue(ractive);\n\n  \tif (ractive.parent && bubble) {\n\n  \t\tif (initialFire && ractive.component) {\n  \t\t\tvar fullName = ractive.component.name + '.' + eventNames[eventNames.length - 1];\n  \t\t\teventNames = getWildcardNames(fullName);\n\n  \t\t\tif (event && !event.component) {\n  \t\t\t\tevent.component = ractive;\n  \t\t\t}\n  \t\t}\n\n  \t\tfireEventAs(ractive.parent, eventNames, event, args);\n  \t}\n  }\n\n  function notifySubscribers(ractive, subscribers, event, args) {\n  \tvar originalEvent = null,\n  \t    stopEvent = false;\n\n  \tif (event && !event._noArg) {\n  \t\targs = [event].concat(args);\n  \t}\n\n  \t// subscribers can be modified inflight, e.g. \"once\" functionality\n  \t// so we need to copy to make sure everyone gets called\n  \tsubscribers = subscribers.slice();\n\n  \tfor (var i = 0, len = subscribers.length; i < len; i += 1) {\n  \t\tif (subscribers[i].apply(ractive, args) === false) {\n  \t\t\tstopEvent = true;\n  \t\t}\n  \t}\n\n  \tif (event && !event._noArg && stopEvent && (originalEvent = event.original)) {\n  \t\toriginalEvent.preventDefault && originalEvent.preventDefault();\n  \t\toriginalEvent.stopPropagation && originalEvent.stopPropagation();\n  \t}\n\n  \treturn !stopEvent;\n  }\n\n  var eventPattern = /^event(?:\\.(.+))?$/;\n  var argumentsPattern = /^arguments\\.(\\d*)$/;\n  var dollarArgsPattern = /^\\$(\\d*)$/;\n\n  var EventDirective = (function () {\n  \tfunction EventDirective(owner, event, template) {\n  \t\tclassCallCheck(this, EventDirective);\n\n  \t\tthis.owner = owner;\n  \t\tthis.event = event;\n  \t\tthis.template = template;\n\n  \t\tthis.ractive = owner.parentFragment.ractive;\n  \t\tthis.parentFragment = owner.parentFragment;\n\n  \t\tthis.context = null;\n  \t\tthis.passthru = false;\n\n  \t\t// method calls\n  \t\tthis.method = null;\n  \t\tthis.resolvers = null;\n  \t\tthis.models = null;\n  \t\tthis.argsFn = null;\n\n  \t\t// handler directive\n  \t\tthis.action = null;\n  \t\tthis.args = null;\n  \t}\n\n  \tEventDirective.prototype.bind = function bind() {\n  \t\tvar _this = this;\n\n  \t\tthis.context = this.parentFragment.findContext();\n\n  \t\tvar template = this.template;\n\n  \t\tif (template.m) {\n  \t\t\tthis.method = template.m;\n\n  \t\t\tif (this.passthru = template.g) {\n  \t\t\t\t// on-click=\"foo(...arguments)\"\n  \t\t\t\t// no models or args, just pass thru values\n  \t\t\t} else {\n  \t\t\t\t\tthis.resolvers = [];\n  \t\t\t\t\tthis.models = template.a.r.map(function (ref, i) {\n  \t\t\t\t\t\tif (eventPattern.test(ref)) {\n  \t\t\t\t\t\t\t// on-click=\"foo(event.node)\"\n  \t\t\t\t\t\t\treturn {\n  \t\t\t\t\t\t\t\tevent: true,\n  \t\t\t\t\t\t\t\tkeys: ref.length > 5 ? ref.slice(6).split('.') : [],\n  \t\t\t\t\t\t\t\tunbind: noop\n  \t\t\t\t\t\t\t};\n  \t\t\t\t\t\t}\n\n  \t\t\t\t\t\tvar argMatch = argumentsPattern.exec(ref);\n  \t\t\t\t\t\tif (argMatch) {\n  \t\t\t\t\t\t\t// on-click=\"foo(arguments[0])\"\n  \t\t\t\t\t\t\treturn {\n  \t\t\t\t\t\t\t\targument: true,\n  \t\t\t\t\t\t\t\tindex: argMatch[1]\n  \t\t\t\t\t\t\t};\n  \t\t\t\t\t\t}\n\n  \t\t\t\t\t\tvar dollarMatch = dollarArgsPattern.exec(ref);\n  \t\t\t\t\t\tif (dollarMatch) {\n  \t\t\t\t\t\t\t// on-click=\"foo($1)\"\n  \t\t\t\t\t\t\treturn {\n  \t\t\t\t\t\t\t\targument: true,\n  \t\t\t\t\t\t\t\tindex: dollarMatch[1] - 1\n  \t\t\t\t\t\t\t};\n  \t\t\t\t\t\t}\n\n  \t\t\t\t\t\tvar resolver = undefined;\n\n  \t\t\t\t\t\tvar model = resolveReference(_this.parentFragment, ref);\n  \t\t\t\t\t\tif (!model) {\n  \t\t\t\t\t\t\tresolver = _this.parentFragment.resolve(ref, function (model) {\n  \t\t\t\t\t\t\t\t_this.models[i] = model;\n  \t\t\t\t\t\t\t\tremoveFromArray(_this.resolvers, resolver);\n  \t\t\t\t\t\t\t});\n\n  \t\t\t\t\t\t\t_this.resolvers.push(resolver);\n  \t\t\t\t\t\t}\n\n  \t\t\t\t\t\treturn model;\n  \t\t\t\t\t});\n\n  \t\t\t\t\tthis.argsFn = createFunction(template.a.s, template.a.r.length);\n  \t\t\t\t}\n  \t\t} else {\n  \t\t\t// TODO deprecate this style of directive\n  \t\t\tthis.action = typeof template === 'string' ? // on-click='foo'\n  \t\t\ttemplate : typeof template.n === 'string' ? // on-click='{{dynamic}}'\n  \t\t\ttemplate.n : new Fragment({\n  \t\t\t\towner: this,\n  \t\t\t\ttemplate: template.n\n  \t\t\t});\n\n  \t\t\tthis.args = template.a ? // static arguments\n  \t\t\ttypeof template.a === 'string' ? [template.a] : template.a : template.d ? // dynamic arguments\n  \t\t\tnew Fragment({\n  \t\t\t\towner: this,\n  \t\t\t\ttemplate: template.d\n  \t\t\t}) : []; // no arguments\n  \t\t}\n\n  \t\tif (this.template.n && typeof this.template.n !== 'string') this.action.bind();\n  \t\tif (this.template.d) this.args.bind();\n  \t};\n\n  \tEventDirective.prototype.bubble = function bubble() {\n  \t\tif (!this.dirty) {\n  \t\t\tthis.dirty = true;\n  \t\t\tthis.owner.bubble();\n  \t\t}\n  \t};\n\n  \tEventDirective.prototype.fire = function fire(event, passedArgs) {\n  \t\t// augment event object\n  \t\tif (event) {\n  \t\t\tevent.keypath = this.context.getKeypath();\n  \t\t\tevent.context = this.context.get();\n  \t\t\tevent.index = this.parentFragment.indexRefs;\n\n  \t\t\tif (passedArgs) passedArgs.unshift(event);\n  \t\t}\n\n  \t\tif (this.method) {\n  \t\t\tif (typeof this.ractive[this.method] !== 'function') {\n  \t\t\t\tthrow new Error('Attempted to call a non-existent method (\"' + this.method + '\")');\n  \t\t\t}\n\n  \t\t\tvar args = undefined;\n\n  \t\t\tif (this.passthru) {\n  \t\t\t\targs = passedArgs;\n  \t\t\t} else {\n  \t\t\t\tvar values = this.models.map(function (model) {\n  \t\t\t\t\tif (!model) return undefined;\n\n  \t\t\t\t\tif (model.event) {\n  \t\t\t\t\t\tvar obj = event;\n  \t\t\t\t\t\tvar keys = model.keys.slice();\n\n  \t\t\t\t\t\twhile (keys.length) obj = obj[keys.shift()];\n  \t\t\t\t\t\treturn obj;\n  \t\t\t\t\t}\n\n  \t\t\t\t\tif (model.argument) {\n  \t\t\t\t\t\treturn passedArgs ? passedArgs[model.index] : void 0;\n  \t\t\t\t\t}\n\n  \t\t\t\t\tif (model.wrapper) {\n  \t\t\t\t\t\treturn model.wrapper.value;\n  \t\t\t\t\t}\n\n  \t\t\t\t\treturn model.get();\n  \t\t\t\t});\n\n  \t\t\t\targs = this.argsFn.apply(null, values);\n  \t\t\t}\n\n  \t\t\t// make event available as `this.event`\n  \t\t\tvar ractive = this.ractive;\n  \t\t\tvar oldEvent = ractive.event;\n\n  \t\t\tractive.event = event;\n  \t\t\tractive[this.method].apply(ractive, args);\n  \t\t\tractive.event = oldEvent;\n  \t\t} else {\n  \t\t\tvar action = this.action.toString();\n  \t\t\tvar args = this.template.d ? this.args.getArgsList() : this.args;\n\n  \t\t\tif (event) event.name = action;\n\n  \t\t\tfireEvent(this.ractive, action, {\n  \t\t\t\tevent: event,\n  \t\t\t\targs: args\n  \t\t\t});\n  \t\t}\n  \t};\n\n  \tEventDirective.prototype.rebind = function rebind() {\n  \t\tthrow new Error('EventDirective$rebind not yet implemented!'); // TODO add tests\n  \t};\n\n  \tEventDirective.prototype.render = function render() {\n  \t\tthis.event.listen(this);\n  \t};\n\n  \tEventDirective.prototype.unbind = function unbind() {\n  \t\tvar template = this.template;\n\n  \t\tif (template.m) {\n  \t\t\tthis.resolvers.forEach(_unbind);\n  \t\t\tthis.resolvers = [];\n\n  \t\t\tthis.models.forEach(function (model) {\n  \t\t\t\tif (model) model.unbind();\n  \t\t\t});\n  \t\t} else {\n  \t\t\t// TODO this is brittle and non-explicit, fix it\n  \t\t\tif (this.action.unbind) this.action.unbind();\n  \t\t\tif (this.args.unbind) this.args.unbind();\n  \t\t}\n  \t};\n\n  \tEventDirective.prototype.unrender = function unrender() {\n  \t\tthis.event.unlisten();\n  \t};\n\n  \tEventDirective.prototype.update = function update() {\n  \t\tif (this.method) return; // nothing to do\n\n  \t\t// ugh legacy\n  \t\tif (this.action.update) this.action.update();\n  \t\tif (this.template.d) this.args.update();\n\n  \t\tthis.dirty = false;\n  \t};\n\n  \treturn EventDirective;\n  })();\n\n  var DOMEvent = (function () {\n  \tfunction DOMEvent(name, owner) {\n  \t\tclassCallCheck(this, DOMEvent);\n\n  \t\tif (name.indexOf('*') !== -1) {\n  \t\t\tfatal('Only component proxy-events may contain \"*\" wildcards, <' + owner.name + ' on-' + name + '=\"...\"/> is not valid');\n  \t\t}\n\n  \t\tthis.name = name;\n  \t\tthis.owner = owner;\n  \t\tthis.node = null;\n  \t\tthis.handler = null;\n  \t}\n\n  \tDOMEvent.prototype.listen = function listen(directive) {\n  \t\tvar node = this.node = this.owner.node;\n  \t\tvar name = this.name;\n\n  \t\tif (!('on' + name in node)) {\n  \t\t\tmissingPlugin(name, 'events');\n  \t\t}\n\n  \t\tnode.addEventListener(name, this.handler = function (event) {\n  \t\t\tdirective.fire({\n  \t\t\t\tnode: node,\n  \t\t\t\toriginal: event\n  \t\t\t});\n  \t\t}, false);\n  \t};\n\n  \tDOMEvent.prototype.unlisten = function unlisten() {\n  \t\tthis.node.removeEventListener(this.name, this.handler, false);\n  \t};\n\n  \treturn DOMEvent;\n  })();\n\n  var CustomEvent = (function () {\n  \tfunction CustomEvent(eventPlugin, owner) {\n  \t\tclassCallCheck(this, CustomEvent);\n\n  \t\tthis.eventPlugin = eventPlugin;\n  \t\tthis.owner = owner;\n  \t\tthis.handler = null;\n  \t}\n\n  \tCustomEvent.prototype.listen = function listen(directive) {\n  \t\tvar node = this.owner.node;\n\n  \t\tthis.handler = this.eventPlugin(node, function () {\n  \t\t\tvar event = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];\n\n  \t\t\tevent.node = event.node || node;\n  \t\t\tdirective.fire(event);\n  \t\t});\n  \t};\n\n  \tCustomEvent.prototype.unlisten = function unlisten() {\n  \t\tthis.handler.teardown();\n  \t};\n\n  \treturn CustomEvent;\n  })();\n\n  var missingDecorator = {\n  \tupdate: noop,\n  \tteardown: noop\n  };\n\n  var Decorator = (function () {\n  \tfunction Decorator(owner, template) {\n  \t\tclassCallCheck(this, Decorator);\n\n  \t\tthis.owner = owner;\n  \t\tthis.template = template;\n\n  \t\tthis.parentFragment = owner.parentFragment;\n  \t\tthis.ractive = owner.ractive;\n\n  \t\tthis.dynamicName = typeof template.n === 'object';\n  \t\tthis.dynamicArgs = !!template.d;\n\n  \t\tif (this.dynamicName) {\n  \t\t\tthis.nameFragment = new Fragment({\n  \t\t\t\towner: this,\n  \t\t\t\ttemplate: template.n\n  \t\t\t});\n  \t\t} else {\n  \t\t\tthis.name = template.n || template;\n  \t\t}\n\n  \t\tif (this.dynamicArgs) {\n  \t\t\tthis.argsFragment = new Fragment({\n  \t\t\t\towner: this,\n  \t\t\t\ttemplate: template.d\n  \t\t\t});\n  \t\t} else {\n  \t\t\tthis.args = template.a || [];\n  \t\t}\n\n  \t\tthis.node = null;\n  \t\tthis.intermediary = null;\n  \t}\n\n  \tDecorator.prototype.bind = function bind() {\n  \t\tif (this.dynamicName) {\n  \t\t\tthis.nameFragment.bind();\n  \t\t\tthis.name = this.nameFragment.toString();\n  \t\t}\n\n  \t\tif (this.dynamicArgs) this.argsFragment.bind();\n  \t};\n\n  \tDecorator.prototype.bubble = function bubble() {\n  \t\tif (!this.dirty) {\n  \t\t\tthis.dirty = true;\n  \t\t\tthis.owner.bubble();\n  \t\t}\n  \t};\n\n  \tDecorator.prototype.rebind = function rebind() {\n  \t\tif (this.dynamicName) this.nameFragment.rebind();\n  \t\tif (this.dynamicArgs) this.argsFragment.rebind();\n  \t};\n\n  \tDecorator.prototype.render = function render() {\n  \t\tvar fn = findInViewHierarchy('decorators', this.ractive, this.name);\n\n  \t\tif (!fn) {\n  \t\t\tmissingPlugin(this.name, 'decorators');\n  \t\t\tthis.intermediary = missingDecorator;\n  \t\t\treturn;\n  \t\t}\n\n  \t\tthis.node = this.owner.node;\n\n  \t\tvar args = this.dynamicArgs ? this.argsFragment.getArgsList() : this.args;\n  \t\tthis.intermediary = fn.apply(this.ractive, [this.node].concat(args));\n\n  \t\tif (!this.intermediary || !this.intermediary.teardown) {\n  \t\t\tthrow new Error('The \\'' + this.name + '\\' decorator must return an object with a teardown method');\n  \t\t}\n  \t};\n\n  \tDecorator.prototype.unbind = function unbind() {\n  \t\tif (this.dynamicName) this.nameFragment.unbind();\n  \t\tif (this.dynamicArgs) this.argsFragment.unbind();\n  \t};\n\n  \tDecorator.prototype.unrender = function unrender() {\n  \t\tthis.intermediary.teardown();\n  \t};\n\n  \tDecorator.prototype.update = function update() {\n  \t\tif (this.dynamicName) {\n  \t\t\tvar _name = this.nameFragment.toString();\n\n  \t\t\tif (_name !== this.name) {\n  \t\t\t\tthis.name = _name;\n  \t\t\t\tthis.unrender();\n  \t\t\t\tthis.render();\n  \t\t\t}\n  \t\t} else if (this.intermediary.update) {\n  \t\t\tvar args = this.dynamicArgs ? this.argsFragment.getArgsList() : this.args;\n  \t\t\tthis.intermediary.update.apply(this.ractive, args);\n  \t\t} else {\n  \t\t\tthis.unrender();\n  \t\t\tthis.render();\n  \t\t}\n  \t};\n\n  \treturn Decorator;\n  })();\n\n  var div = doc ? createElement('div') : null;\n\n  var ConditionalAttribute = (function (_Item) {\n  \tinherits(ConditionalAttribute, _Item);\n\n  \tfunction ConditionalAttribute(options) {\n  \t\tclassCallCheck(this, ConditionalAttribute);\n\n  \t\t_Item.call(this, options);\n\n  \t\tthis.attributes = [];\n\n  \t\tthis.owner = options.owner;\n\n  \t\tthis.fragment = new Fragment({\n  \t\t\tractive: this.ractive,\n  \t\t\towner: this,\n  \t\t\ttemplate: [this.template]\n  \t\t});\n\n  \t\tthis.dirty = false;\n  \t}\n\n  \tConditionalAttribute.prototype.bind = function bind() {\n  \t\tthis.fragment.bind();\n  \t};\n\n  \tConditionalAttribute.prototype.bubble = function bubble() {\n  \t\tif (!this.dirty) {\n  \t\t\tthis.dirty = true;\n  \t\t\tthis.owner.bubble();\n  \t\t}\n  \t};\n\n  \tConditionalAttribute.prototype.rebind = function rebind() {\n  \t\tthrow new Error('ConditionalAttribute$rebind is not yet implemented'); // TODO test\n  \t};\n\n  \tConditionalAttribute.prototype.render = function render() {\n  \t\tthis.node = this.owner.node;\n  \t\tthis.isSvg = this.node.namespaceURI === svg;\n\n  \t\tthis.rendered = true;\n  \t\tthis.dirty = true; // TODO this seems hacky, but necessary for tests to pass in browser AND node.js\n  \t\tthis.update();\n  \t};\n\n  \tConditionalAttribute.prototype.toString = function toString() {\n  \t\treturn this.fragment.toString();\n  \t};\n\n  \tConditionalAttribute.prototype.unbind = function unbind() {\n  \t\tthis.fragment.unbind();\n  \t};\n\n  \tConditionalAttribute.prototype.unrender = function unrender() {\n  \t\tthis.rendered = false;\n  \t};\n\n  \tConditionalAttribute.prototype.update = function update() {\n  \t\tvar _this = this;\n\n  \t\tvar str = undefined;\n  \t\tvar attrs = undefined;\n\n  \t\tif (this.dirty) {\n  \t\t\tthis.fragment.update();\n\n  \t\t\tif (this.rendered) {\n  \t\t\t\tstr = this.fragment.toString();\n  \t\t\t\tattrs = parseAttributes(str, this.isSvg);\n\n  \t\t\t\t// any attributes that previously existed but no longer do\n  \t\t\t\t// must be removed\n  \t\t\t\tthis.attributes.filter(function (a) {\n  \t\t\t\t\treturn notIn(attrs, a);\n  \t\t\t\t}).forEach(function (a) {\n  \t\t\t\t\t_this.node.removeAttribute(a.name);\n  \t\t\t\t});\n\n  \t\t\t\tattrs.forEach(function (a) {\n  \t\t\t\t\t_this.node.setAttribute(a.name, a.value);\n  \t\t\t\t});\n\n  \t\t\t\tthis.attributes = attrs;\n  \t\t\t}\n\n  \t\t\tthis.dirty = false;\n  \t\t}\n  \t};\n\n  \treturn ConditionalAttribute;\n  })(Item);\n\n  function parseAttributes(str, isSvg) {\n  \tvar tagName = isSvg ? 'svg' : 'div';\n  \tdiv.innerHTML = '<' + tagName + ' ' + str + '></' + tagName + '>';\n\n  \treturn toArray(div.childNodes[0].attributes);\n  }\n\n  function notIn(haystack, needle) {\n  \tvar i = haystack.length;\n\n  \twhile (i--) {\n  \t\tif (haystack[i].name === needle.name) {\n  \t\t\treturn false;\n  \t\t}\n  \t}\n\n  \treturn true;\n  }\n\n  function getUpdateDelegate(attribute) {\n  \tvar element = attribute.element;\n  \tvar name = attribute.name;\n\n  \tif (name === 'id') return updateId;\n\n  \tif (name === 'value') {\n  \t\t// special case - selects\n  \t\tif (element.name === 'select' && name === 'value') {\n  \t\t\treturn element.getAttribute('multiple') ? updateMultipleSelectValue : updateSelectValue;\n  \t\t}\n\n  \t\tif (element.name === 'textarea') return updateValue;\n\n  \t\t// special case - contenteditable\n  \t\tif (element.getAttribute('contenteditable') != null) return updateContentEditableValue;\n\n  \t\t// special case - <input>\n  \t\tif (element.name === 'input') {\n  \t\t\tvar type = element.getAttribute('type');\n\n  \t\t\t// type='file' value='{{fileList}}'>\n  \t\t\tif (type === 'file') return noop; // read-only\n\n  \t\t\t// type='radio' name='{{twoway}}'\n  \t\t\tif (type === 'radio' && element.binding && element.binding.attribute.name === 'name') return updateRadioValue;\n  \t\t}\n\n  \t\treturn updateValue;\n  \t}\n\n  \tvar node = element.node;\n\n  \t// special case - <input type='radio' name='{{twoway}}' value='foo'>\n  \tif (attribute.isTwoway && name === 'name') {\n  \t\tif (node.type === 'radio') return updateRadioName;\n  \t\tif (node.type === 'checkbox') return updateCheckboxName;\n  \t}\n\n  \t// special case - style attributes in Internet Exploder\n  \tif (name === 'style' && node.style.setAttribute) return updateIEStyleAttribute;\n\n  \t// special case - class names. IE fucks things up, again\n  \tif (name === 'class' && (!node.namespaceURI || node.namespaceURI === _html)) return updateClassName;\n\n  \tif (attribute.useProperty) return updateProperty;\n\n  \tif (attribute.namespace) return updateNamespacedAttribute;\n\n  \treturn updateAttribute;\n  }\n\n  function updateId() {\n  \tvar node = this.node;\n\n  \tvar value = this.getValue();\n\n  \tdelete this.ractive.nodes[node.id];\n  \tthis.ractive.nodes[value] = node;\n\n  \tnode.id = value;\n  }\n\n  function updateMultipleSelectValue() {\n  \tvar value = this.getValue();\n\n  \tif (!isArray(value)) value = [value];\n\n  \tvar options = this.node.options;\n  \tvar i = options.length;\n\n  \twhile (i--) {\n  \t\tvar option = options[i];\n  \t\tvar optionValue = option._ractive ? option._ractive.value : option.value; // options inserted via a triple don't have _ractive\n\n  \t\toption.selected = arrayContains(value, optionValue);\n  \t}\n  }\n\n  function updateSelectValue() {\n  \tvar value = this.getValue();\n\n  \tif (!this.locked) {\n  \t\t// TODO is locked still a thing?\n  \t\tthis.node._ractive.value = value;\n\n  \t\tvar options = this.node.options;\n  \t\tvar i = options.length;\n\n  \t\twhile (i--) {\n  \t\t\tvar option = options[i];\n  \t\t\tvar optionValue = option._ractive ? option._ractive.value : option.value; // options inserted via a triple don't have _ractive\n\n  \t\t\tif (optionValue == value) {\n  \t\t\t\t// double equals as we may be comparing numbers with strings\n  \t\t\t\toption.selected = true;\n  \t\t\t\tbreak;\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \t// if we're still here, it means the new value didn't match any of the options...\n  \t// TODO figure out what to do in this situation\n  }\n\n  function updateContentEditableValue() {\n  \tvar value = this.getValue();\n\n  \tif (!this.locked) {\n  \t\tthis.node.innerHTML = value === undefined ? '' : value;\n  \t}\n  }\n\n  function updateRadioValue() {\n  \tvar node = this.node;\n  \tvar wasChecked = node.checked;\n\n  \tvar value = this.getValue();\n\n  \t//node.value = this.element.getAttribute( 'value' );\n  \tnode.value = this.node._ractive.value = value;\n  \tnode.checked = value === this.element.getAttribute('name');\n\n  \t// This is a special case - if the input was checked, and the value\n  \t// changed so that it's no longer checked, the twoway binding is\n  \t// most likely out of date. To fix it we have to jump through some\n  \t// hoops... this is a little kludgy but it works\n  \tif (wasChecked && !node.checked && this.element.binding && this.element.binding.rendered) {\n  \t\tthis.element.binding.group.model.set(this.element.binding.group.getValue());\n  \t}\n  }\n\n  function updateValue() {\n  \tif (!this.locked) {\n  \t\tvar value = this.getValue();\n\n  \t\tthis.node.value = this.node._ractive.value = value;\n  \t\tthis.node.setAttribute('value', value);\n  \t}\n  }\n\n  function updateRadioName() {\n  \tthis.node.checked = this.getValue() == this.node._ractive.value;\n  }\n\n  function updateCheckboxName() {\n  \tvar element = this.element;\n  \tvar node = this.node;\n\n  \tvar binding = element.binding;\n\n  \tvar value = this.getValue();\n  \tvar valueAttribute = element.getAttribute('value');\n\n  \tif (!isArray(value)) {\n  \t\tbinding.isChecked = node.checked = value == valueAttribute;\n  \t} else {\n  \t\tvar i = value.length;\n  \t\twhile (i--) {\n  \t\t\tif (valueAttribute == value[i]) {\n  \t\t\t\tbinding.isChecked = node.checked = true;\n  \t\t\t\treturn;\n  \t\t\t}\n  \t\t}\n  \t\tbinding.isChecked = node.checked = false;\n  \t}\n  }\n\n  function updateIEStyleAttribute() {\n  \tthis.node.style.setAttribute('cssText', this.getValue() || '');\n  }\n\n  function updateClassName() {\n  \tthis.node.className = safeToStringValue(this.getValue());\n  }\n\n  function updateProperty() {\n  \t// with two-way binding, only update if the change wasn't initiated by the user\n  \t// otherwise the cursor will often be sent to the wrong place\n  \tif (!this.locked) {\n  \t\tthis.node[this.propertyName] = this.getValue();\n  \t}\n  }\n\n  function updateAttribute() {\n  \tthis.node.setAttribute(this.name, safeToStringValue(this.getString()));\n  }\n\n  function updateNamespacedAttribute() {\n  \tthis.node.setAttributeNS(this.namespace, this.name, safeToStringValue(this.getString()));\n  }\n\n  var propertyNames = {\n  \t'accept-charset': 'acceptCharset',\n  \taccesskey: 'accessKey',\n  \tbgcolor: 'bgColor',\n  \t'class': 'className',\n  \tcodebase: 'codeBase',\n  \tcolspan: 'colSpan',\n  \tcontenteditable: 'contentEditable',\n  \tdatetime: 'dateTime',\n  \tdirname: 'dirName',\n  \t'for': 'htmlFor',\n  \t'http-equiv': 'httpEquiv',\n  \tismap: 'isMap',\n  \tmaxlength: 'maxLength',\n  \tnovalidate: 'noValidate',\n  \tpubdate: 'pubDate',\n  \treadonly: 'readOnly',\n  \trowspan: 'rowSpan',\n  \ttabindex: 'tabIndex',\n  \tusemap: 'useMap'\n  };\n\n  function determineNameAndNamespace (attribute, name) {\n  \t// are we dealing with a namespaced attribute, e.g. xlink:href?\n  \tvar colonIndex = name.indexOf(':');\n  \tif (colonIndex !== -1) {\n  \t\t// looks like we are, yes...\n  \t\tvar namespacePrefix = name.substr(0, colonIndex);\n\n  \t\t// ...unless it's a namespace *declaration*, which we ignore (on the assumption\n  \t\t// that only valid namespaces will be used)\n  \t\tif (namespacePrefix !== 'xmlns') {\n  \t\t\tname = name.substring(colonIndex + 1);\n\n  \t\t\tattribute.name = name;\n  \t\t\tattribute.namespace = namespaces[namespacePrefix.toLowerCase()];\n  \t\t\tattribute.namespacePrefix = namespacePrefix;\n\n  \t\t\tif (!attribute.namespace) {\n  \t\t\t\tthrow 'Unknown namespace (\"' + namespacePrefix + '\")';\n  \t\t\t}\n\n  \t\t\treturn;\n  \t\t}\n  \t}\n\n  \tattribute.name = name;\n  }\n\n  var Attribute = (function (_Item) {\n  \tinherits(Attribute, _Item);\n\n  \tfunction Attribute(options) {\n  \t\tclassCallCheck(this, Attribute);\n\n  \t\t_Item.call(this, options);\n\n  \t\tdetermineNameAndNamespace(this, options.name);\n\n  \t\tthis.element = options.element;\n  \t\tthis.parentFragment = options.element.parentFragment; // shared\n  \t\tthis.ractive = this.parentFragment.ractive;\n\n  \t\tthis.rendered = false;\n  \t\tthis.updateDelegate = null;\n  \t\tthis.fragment = null;\n  \t\tthis.value = null;\n\n  \t\tif (!isArray(options.template)) {\n  \t\t\tthis.value = options.template;\n  \t\t\tif (this.value === 0) {\n  \t\t\t\tthis.value = '';\n  \t\t\t}\n  \t\t} else {\n  \t\t\tthis.fragment = new Fragment({\n  \t\t\t\towner: this,\n  \t\t\t\ttemplate: options.template\n  \t\t\t});\n  \t\t}\n\n  \t\tthis.interpolator = this.fragment && this.fragment.items.length === 1 && this.fragment.items[0].type === INTERPOLATOR && this.fragment.items[0];\n  \t}\n\n  \tAttribute.prototype.bind = function bind() {\n  \t\tif (this.fragment) {\n  \t\t\tthis.fragment.bind();\n  \t\t}\n  \t};\n\n  \tAttribute.prototype.bubble = function bubble() {\n  \t\tif (!this.dirty) {\n  \t\t\tthis.element.bubble();\n  \t\t\tthis.dirty = true;\n  \t\t}\n  \t};\n\n  \tAttribute.prototype.getString = function getString() {\n  \t\treturn this.fragment ? this.fragment.toString() : this.value != null ? '' + this.value : '';\n  \t};\n\n  \t// TODO could getValue ever be called for a static attribute,\n  \t// or can we assume that this.fragment exists?\n\n  \tAttribute.prototype.getValue = function getValue() {\n  \t\treturn this.fragment ? this.fragment.valueOf() : booleanAttributes.test(this.name) ? true : this.value;\n  \t};\n\n  \tAttribute.prototype.rebind = function rebind() {\n  \t\tthis.unbind();\n  \t\tthis.bind();\n  \t};\n\n  \tAttribute.prototype.render = function render() {\n  \t\tvar node = this.element.node;\n  \t\tthis.node = node;\n\n  \t\t// should we use direct property access, or setAttribute?\n  \t\tif (!node.namespaceURI || node.namespaceURI === _html) {\n  \t\t\tvar propertyName = propertyNames[this.name] || this.name;\n\n  \t\t\tif (node[propertyName] !== undefined) {\n  \t\t\t\tthis.propertyName = propertyName;\n  \t\t\t}\n\n  \t\t\t// is attribute a boolean attribute or 'value'? If so we're better off doing e.g.\n  \t\t\t// node.selected = true rather than node.setAttribute( 'selected', '' )\n  \t\t\tif (booleanAttributes.test(this.name) || this.isTwoway) {\n  \t\t\t\tthis.useProperty = true;\n  \t\t\t}\n\n  \t\t\tif (propertyName === 'value') {\n  \t\t\t\tnode._ractive.value = this.value;\n  \t\t\t}\n  \t\t}\n\n  \t\tthis.rendered = true;\n  \t\tthis.updateDelegate = getUpdateDelegate(this);\n  \t\tthis.updateDelegate();\n  \t};\n\n  \tAttribute.prototype.toString = function toString() {\n  \t\tvar value = this.getValue();\n\n  \t\t// Special case - select and textarea values (should not be stringified)\n  \t\tif (this.name === 'value' && (this.element.getAttribute('contenteditable') !== undefined || (this.element.name === 'select' || this.element.name === 'textarea'))) {\n  \t\t\treturn;\n  \t\t}\n\n  \t\t// Special case  bound radio `name` attributes\n  \t\tif (this.name === 'name' && this.element.name === 'input' && this.interpolator) {\n  \t\t\treturn 'name=\"{{' + this.interpolator.model.getKeypath() + '}}\"';\n  \t\t}\n\n  \t\tif (booleanAttributes.test(this.name)) return value ? this.name : '';\n  \t\tif (value == null) return '';\n\n  \t\tvar str = safeToStringValue(this.getString()).replace(/&/g, '&amp;').replace(/\"/g, '&quot;').replace(/'/g, '&#39;');\n\n  \t\treturn str ? this.name + '=\"' + str + '\"' : this.name;\n  \t};\n\n  \tAttribute.prototype.unbind = function unbind() {\n  \t\tif (this.fragment) this.fragment.unbind();\n  \t};\n\n  \tAttribute.prototype.update = function update() {\n  \t\tif (this.dirty) {\n  \t\t\tif (this.fragment) this.fragment.update();\n  \t\t\tif (this.rendered) this.updateDelegate();\n  \t\t\tthis.dirty = false;\n  \t\t}\n  \t};\n\n  \treturn Attribute;\n  })(Item);\n\n  function __makeDirty(query) {\n  \tquery.makeDirty();\n  }\n\n  var Element = (function (_Item) {\n  \tinherits(Element, _Item);\n\n  \tfunction Element(options) {\n  \t\tvar _this = this;\n\n  \t\tclassCallCheck(this, Element);\n\n  \t\t_Item.call(this, options);\n\n  \t\tthis.liveQueries = []; // TODO rare case. can we handle differently?\n\n  \t\tthis.name = options.template.e.toLowerCase();\n  \t\tthis.isVoid = voidElementNames.test(this.name);\n\n  \t\t// find parent element\n  \t\tvar fragment = this.parentFragment;\n  \t\twhile (fragment) {\n  \t\t\tif (fragment.owner.type === ELEMENT) {\n  \t\t\t\tthis.parent = fragment.owner;\n  \t\t\t\tbreak;\n  \t\t\t}\n  \t\t\tfragment = fragment.parent;\n  \t\t}\n\n  \t\t// create attributes\n  \t\tthis.attributeByName = {};\n  \t\tthis.attributes = [];\n\n  \t\tif (this.template.a) {\n  \t\t\tObject.keys(this.template.a).forEach(function (name) {\n  \t\t\t\t// TODO process this at parse time\n  \t\t\t\tif (name === 'twoway' || name === 'lazy') return;\n\n  \t\t\t\tvar attribute = new Attribute({\n  \t\t\t\t\tname: name,\n  \t\t\t\t\telement: _this,\n  \t\t\t\t\tparentFragment: _this.parentFragment,\n  \t\t\t\t\ttemplate: _this.template.a[name]\n  \t\t\t\t});\n\n  \t\t\t\t_this.attributeByName[name] = attribute;\n\n  \t\t\t\tif (name !== 'value' && name !== 'type') _this.attributes.push(attribute);\n  \t\t\t});\n\n  \t\t\tif (this.attributeByName.type) this.attributes.unshift(this.attributeByName.type);\n  \t\t\tif (this.attributeByName.value) this.attributes.push(this.attributeByName.value);\n  \t\t}\n\n  \t\t// create conditional attributes\n  \t\tthis.conditionalAttributes = (this.template.m || []).map(function (template) {\n  \t\t\treturn new ConditionalAttribute({\n  \t\t\t\towner: _this,\n  \t\t\t\tparentFragment: _this.parentFragment,\n  \t\t\t\ttemplate: template\n  \t\t\t});\n  \t\t});\n\n  \t\t// create decorator\n  \t\tif (this.template.o) {\n  \t\t\tthis.decorator = new Decorator(this, this.template.o);\n  \t\t}\n\n  \t\t// attach event handlers\n  \t\tthis.eventHandlers = [];\n  \t\tif (this.template.v) {\n  \t\t\tObject.keys(this.template.v).forEach(function (key) {\n  \t\t\t\tvar eventNames = key.split('-');\n  \t\t\t\tvar template = _this.template.v[key];\n\n  \t\t\t\teventNames.forEach(function (eventName) {\n  \t\t\t\t\tvar fn = findInViewHierarchy('events', _this.ractive, eventName);\n  \t\t\t\t\t// we need to pass in \"this\" in order to get\n  \t\t\t\t\t// access to node when it is created.\n  \t\t\t\t\tvar event = fn ? new CustomEvent(fn, _this) : new DOMEvent(eventName, _this);\n  \t\t\t\t\t_this.eventHandlers.push(new EventDirective(_this, event, template));\n  \t\t\t\t});\n  \t\t\t});\n  \t\t}\n\n  \t\t// create children\n  \t\tif (options.template.f) {\n  \t\t\tthis.fragment = new Fragment({\n  \t\t\t\ttemplate: options.template.f,\n  \t\t\t\towner: this,\n  \t\t\t\tcssIds: null\n  \t\t\t});\n  \t\t}\n\n  \t\tthis.binding = null; // filled in later\n  \t}\n\n  \tElement.prototype.bind = function bind() {\n  \t\tthis.attributes.forEach(__bind);\n  \t\tthis.conditionalAttributes.forEach(__bind);\n  \t\tthis.eventHandlers.forEach(__bind);\n\n  \t\tif (this.decorator) this.decorator.bind();\n  \t\tif (this.fragment) this.fragment.bind();\n\n  \t\t// create two-way binding if necessary\n  \t\tif (this.binding = this.createTwowayBinding()) this.binding.bind();\n  \t};\n\n  \tElement.prototype.createTwowayBinding = function createTwowayBinding() {\n  \t\tvar attributes = this.template.a;\n\n  \t\tif (!attributes) return null;\n\n  \t\tvar shouldBind = 'twoway' in attributes ? attributes.twoway === 0 || attributes.twoway === 'true' : // covers `twoway` and `twoway='true'`\n  \t\tthis.ractive.twoway;\n\n  \t\tif (!shouldBind) return null;\n\n  \t\tvar Binding = selectBinding(this);\n\n  \t\tif (!Binding) return null;\n\n  \t\tvar binding = new Binding(this);\n\n  \t\treturn binding && binding.model ? binding : null;\n  \t};\n\n  \tElement.prototype.detach = function detach() {\n  \t\tif (this.decorator) this.decorator.unrender();\n\n  \t\treturn detachNode(this.node);\n  \t};\n\n  \tElement.prototype.find = function find(selector) {\n  \t\tif (matches(this.node, selector)) return this.node;\n  \t\tif (this.fragment) {\n  \t\t\treturn this.fragment.find(selector);\n  \t\t}\n  \t};\n\n  \tElement.prototype.findAll = function findAll(selector, query) {\n  \t\t// Add this node to the query, if applicable, and register the\n  \t\t// query on this element\n  \t\tvar matches = query.test(this.node);\n  \t\tif (matches) {\n  \t\t\tquery.add(this.node);\n  \t\t\tif (query.live) this.liveQueries.push(query);\n  \t\t}\n\n  \t\tif (this.fragment) {\n  \t\t\tthis.fragment.findAll(selector, query);\n  \t\t}\n  \t};\n\n  \tElement.prototype.findComponent = function findComponent(name) {\n  \t\tif (this.fragment) {\n  \t\t\treturn this.fragment.findComponent(name);\n  \t\t}\n  \t};\n\n  \tElement.prototype.findAllComponents = function findAllComponents(name, query) {\n  \t\tif (this.fragment) {\n  \t\t\tthis.fragment.findAllComponents(name, query);\n  \t\t}\n  \t};\n\n  \tElement.prototype.findNextNode = function findNextNode() {\n  \t\treturn null;\n  \t};\n\n  \tElement.prototype.firstNode = function firstNode() {\n  \t\treturn this.node;\n  \t};\n\n  \tElement.prototype.getAttribute = function getAttribute(name) {\n  \t\tvar attribute = this.attributeByName[name];\n  \t\treturn attribute ? attribute.getValue() : undefined;\n  \t};\n\n  \tElement.prototype.rebind = function rebind() {\n  \t\tthis.attributes.forEach(_rebind);\n  \t\tthis.conditionalAttributes.forEach(_rebind);\n  \t\tif (this.decorator) this.decorator.rebind();\n  \t\tif (this.fragment) this.fragment.rebind();\n  \t\tif (this.binding) this.binding.rebind();\n\n  \t\tthis.liveQueries.forEach(__makeDirty);\n  \t};\n\n  \tElement.prototype.render = function render(target) {\n  \t\tvar _this2 = this;\n\n  \t\t// TODO determine correct namespace\n  \t\tthis.namespace = getNamespace(this);\n\n  \t\tvar node = createElement(this.template.e, this.namespace, this.getAttribute('is'));\n  \t\tthis.node = node;\n\n  \t\tvar context = this.parentFragment.findContext();\n\n  \t\tdefineProperty(node, '_ractive', {\n  \t\t\tvalue: {\n  \t\t\t\tproxy: this,\n  \t\t\t\tractive: this.ractive,\n  \t\t\t\tfragment: this.parentFragment,\n  \t\t\t\tcontext: context,\n  \t\t\t\tkeypath: context.getKeypath()\n  \t\t\t}\n  \t\t});\n\n  \t\t// Is this a top-level node of a component? If so, we may need to add\n  \t\t// a data-ractive-css attribute, for CSS encapsulation\n  \t\tif (this.parentFragment.cssIds) {\n  \t\t\tnode.setAttribute('data-ractive-css', this.parentFragment.cssIds.map(function (x) {\n  \t\t\t\treturn '{' + x + '}';\n  \t\t\t}).join(' '));\n  \t\t}\n\n  \t\tif (this.fragment) {\n  \t\t\tthis.fragment.render(node);\n  \t\t}\n\n  \t\tthis.attributes.forEach(__render);\n  \t\tthis.conditionalAttributes.forEach(__render);\n\n  \t\tif (this.decorator) runloop.scheduleTask(function () {\n  \t\t\treturn _this2.decorator.render();\n  \t\t}, true);\n  \t\tif (this.binding) this.binding.render();\n\n  \t\tthis.eventHandlers.forEach(__render);\n\n  \t\t_updateLiveQueries(this);\n\n  \t\t// transitions\n  \t\tvar transitionTemplate = this.template.t0 || this.template.t1;\n  \t\tif (transitionTemplate && this.ractive.transitionsEnabled) {\n  \t\t\tvar transition = new Transition(this, transitionTemplate, true);\n  \t\t\trunloop.registerTransition(transition);\n\n  \t\t\tthis._introTransition = transition; // so we can abort if it gets removed\n  \t\t}\n\n  \t\ttarget.appendChild(node);\n\n  \t\tthis.rendered = true;\n  \t};\n\n  \tElement.prototype.toString = function toString() {\n  \t\tvar tagName = this.template.e;\n\n  \t\tvar attrs = this.attributes.map(stringifyAttribute).join('') + this.conditionalAttributes.map(stringifyAttribute).join('');\n\n  \t\t// Special case - selected options\n  \t\tif (this.name === 'option' && this.isSelected()) {\n  \t\t\tattrs += ' selected';\n  \t\t}\n\n  \t\t// Special case - two-way radio name bindings\n  \t\tif (this.name === 'input' && inputIsCheckedRadio(this)) {\n  \t\t\tattrs += ' checked';\n  \t\t}\n\n  \t\tvar str = '<' + tagName + attrs + '>';\n\n  \t\tif (this.isVoid) return str;\n\n  \t\t// Special case - textarea\n  \t\tif (this.name === 'textarea' && this.getAttribute('value') !== undefined) {\n  \t\t\tstr += escapeHtml(this.getAttribute('value'));\n  \t\t}\n\n  \t\t// Special case - contenteditable\n  \t\telse if (this.getAttribute('contenteditable') !== undefined) {\n  \t\t\t\tstr += this.getAttribute('value') || '';\n  \t\t\t}\n\n  \t\tif (this.fragment) {\n  \t\t\tstr += this.fragment.toString(!/^(?:script|style)$/i.test(this.template.e)); // escape text unless script/style\n  \t\t}\n\n  \t\tstr += '</' + tagName + '>';\n  \t\treturn str;\n  \t};\n\n  \tElement.prototype.unbind = function unbind() {\n  \t\tthis.attributes.forEach(_unbind);\n  \t\tthis.conditionalAttributes.forEach(_unbind);\n\n  \t\tif (this.decorator) this.decorator.unbind();\n  \t\tif (this.fragment) this.fragment.unbind();\n  \t};\n\n  \tElement.prototype.unrender = function unrender(shouldDestroy) {\n  \t\tif (!this.rendered) return;\n  \t\tthis.rendered = false;\n\n  \t\t// unrendering before intro completed? complete it now\n  \t\t// TODO should be an API for aborting transitions\n  \t\tvar transition = this._introTransition;\n  \t\tif (transition) transition.complete();\n\n  \t\t// Detach as soon as we can\n  \t\tif (this.name === 'option') {\n  \t\t\t// <option> elements detach immediately, so that\n  \t\t\t// their parent <select> element syncs correctly, and\n  \t\t\t// since option elements can't have transitions anyway\n  \t\t\tthis.detach();\n  \t\t} else if (shouldDestroy) {\n  \t\t\trunloop.detachWhenReady(this);\n  \t\t}\n\n  \t\tif (this.fragment) this.fragment.unrender();\n\n  \t\tthis.eventHandlers.forEach(_unrender);\n\n  \t\tif (this.binding) this.binding.unrender();\n  \t\tif (!shouldDestroy && this.decorator) this.decorator.unrender();\n\n  \t\t// outro transition\n  \t\tvar transitionTemplate = this.template.t0 || this.template.t2;\n  \t\tif (transitionTemplate && this.ractive.transitionsEnabled) {\n  \t\t\tvar _transition = new Transition(this, transitionTemplate, false);\n  \t\t\trunloop.registerTransition(_transition);\n  \t\t}\n\n  \t\t// special case\n  \t\tvar id = this.attributeByName.id;\n  \t\tif (id) {\n  \t\t\tdelete this.ractive.nodes[id.getValue()];\n  \t\t}\n\n  \t\tremoveFromLiveQueries(this);\n  \t\t// TODO forms are a special case\n  \t};\n\n  \tElement.prototype.update = function update() {\n  \t\tif (this.dirty) {\n  \t\t\tthis.attributes.forEach(__update);\n  \t\t\tthis.conditionalAttributes.forEach(__update);\n  \t\t\tthis.eventHandlers.forEach(__update);\n\n  \t\t\tif (this.decorator) this.decorator.update();\n  \t\t\tif (this.fragment) this.fragment.update();\n\n  \t\t\tthis.dirty = false;\n  \t\t}\n  \t};\n\n  \treturn Element;\n  })(Item);\n\n  function inputIsCheckedRadio(element) {\n  \tvar attributes = element.attributeByName;\n\n  \tvar typeAttribute = attributes.type;\n  \tvar valueAttribute = attributes.value;\n  \tvar nameAttribute = attributes.name;\n\n  \tif (!typeAttribute || typeAttribute.value !== 'radio' || !valueAttribute || !nameAttribute.interpolator) {\n  \t\treturn;\n  \t}\n\n  \tif (valueAttribute.getValue() === nameAttribute.interpolator.model.get()) {\n  \t\treturn true;\n  \t}\n  }\n\n  function stringifyAttribute(attribute) {\n  \tvar str = attribute.toString();\n  \treturn str ? ' ' + str : '';\n  }\n\n  function removeFromLiveQueries(element) {\n  \tvar i = element.liveQueries.length;\n  \twhile (i--) {\n  \t\tvar query = element.liveQueries[i];\n  \t\tquery.remove(element.node);\n  \t}\n  }\n\n  function getNamespace(element) {\n  \t// Use specified namespace...\n  \tvar xmlns = element.getAttribute('xmlns');\n  \tif (xmlns) return xmlns;\n\n  \t// ...or SVG namespace, if this is an <svg> element\n  \tif (element.name === 'svg') return svg;\n\n  \tvar parent = element.parent;\n\n  \tif (parent) {\n  \t\t// ...or HTML, if the parent is a <foreignObject>\n  \t\tif (parent.name === 'foreignobject') return _html;\n\n  \t\t// ...or inherit from the parent node\n  \t\treturn parent.node.namespaceURI;\n  \t}\n\n  \treturn element.ractive.el.namespaceURI;\n  }\n\n  var Input = (function (_Element) {\n  \tinherits(Input, _Element);\n\n  \tfunction Input() {\n  \t\tclassCallCheck(this, Input);\n\n  \t\t_Element.apply(this, arguments);\n  \t}\n\n  \tInput.prototype.render = function render(target) {\n  \t\t_Element.prototype.render.call(this, target);\n  \t\tthis.node.defaultValue = this.node.value;\n  \t};\n\n  \treturn Input;\n  })(Element);\n\n  var Textarea = (function (_Input) {\n  \tinherits(Textarea, _Input);\n\n  \tfunction Textarea(options) {\n  \t\tclassCallCheck(this, Textarea);\n\n  \t\tvar template = options.template;\n\n  \t\tif (template.f && (!template.a || !template.a.value) && isBindable({ template: template.f })) {\n  \t\t\tif (!template.a) template.a = {};\n  \t\t\ttemplate.a.value = template.f;\n  \t\t\tdelete template.f;\n  \t\t}\n\n  \t\t_Input.call(this, options);\n  \t}\n\n  \tTextarea.prototype.bubble = function bubble() {\n  \t\tvar _this = this;\n\n  \t\tif (!this.dirty) {\n  \t\t\tthis.dirty = true;\n\n  \t\t\tif (this.rendered && !this.binding && this.fragment) {\n  \t\t\t\trunloop.scheduleTask(function () {\n  \t\t\t\t\t_this.dirty = false;\n  \t\t\t\t\t_this.node.value = _this.fragment.toString();\n  \t\t\t\t});\n  \t\t\t}\n\n  \t\t\tthis.parentFragment.bubble(); // default behaviour\n  \t\t}\n  \t};\n\n  \treturn Textarea;\n  })(Input);\n\n  function valueContains(selectValue, optionValue) {\n  \tvar i = selectValue.length;\n  \twhile (i--) {\n  \t\tif (selectValue[i] == optionValue) return true;\n  \t}\n  }\n\n  var Select = (function (_Element) {\n  \tinherits(Select, _Element);\n\n  \tfunction Select(options) {\n  \t\tclassCallCheck(this, Select);\n\n  \t\t_Element.call(this, options);\n  \t\tthis.options = [];\n  \t}\n\n  \tSelect.prototype.bubble = function bubble() {\n  \t\tvar _this = this;\n\n  \t\tif (!this.dirty) {\n  \t\t\tthis.dirty = true;\n\n  \t\t\tif (this.rendered) {\n  \t\t\t\trunloop.scheduleTask(function () {\n  \t\t\t\t\t_this.sync();\n  \t\t\t\t\t_this.dirty = false;\n  \t\t\t\t});\n  \t\t\t}\n\n  \t\t\tthis.parentFragment.bubble(); // default behaviour\n  \t\t}\n  \t};\n\n  \tSelect.prototype.render = function render(target) {\n  \t\t_Element.prototype.render.call(this, target);\n  \t\tthis.sync();\n\n  \t\tvar node = this.node;\n\n  \t\tvar i = node.options.length;\n  \t\twhile (i--) {\n  \t\t\tnode.options[i].defaultSelected = node.options[i].selected;\n  \t\t}\n\n  \t\tthis.rendered = true;\n  \t};\n\n  \tSelect.prototype.sync = function sync() {\n  \t\tvar selectNode = this.node;\n\n  \t\tif (!selectNode) return;\n\n  \t\tvar options = toArray(selectNode.options);\n\n  \t\tvar selectValue = this.getAttribute('value');\n  \t\tvar isMultiple = this.getAttribute('multiple');\n\n  \t\t// If the <select> has a specified value, that should override\n  \t\t// these options\n  \t\tif (selectValue !== undefined) {\n  \t\t\tvar optionWasSelected = undefined;\n\n  \t\t\toptions.forEach(function (o) {\n  \t\t\t\tvar optionValue = o._ractive ? o._ractive.value : o.value;\n  \t\t\t\tvar shouldSelect = isMultiple ? valueContains(selectValue, optionValue) : selectValue == optionValue;\n\n  \t\t\t\tif (shouldSelect) {\n  \t\t\t\t\toptionWasSelected = true;\n  \t\t\t\t}\n\n  \t\t\t\to.selected = shouldSelect;\n  \t\t\t});\n\n  \t\t\tif (!optionWasSelected && !isMultiple) {\n  \t\t\t\tif (options[0]) {\n  \t\t\t\t\toptions[0].selected = true;\n  \t\t\t\t}\n\n  \t\t\t\tif (this.binding) {\n  \t\t\t\t\tthis.binding.forceUpdate();\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\t// Otherwise the value should be initialised according to which\n  \t\t// <option> element is selected, if twoway binding is in effect\n  \t\telse if (this.binding) {\n  \t\t\t\tthis.binding.forceUpdate();\n  \t\t\t}\n  \t};\n\n  \tSelect.prototype.update = function update() {\n  \t\t_Element.prototype.update.call(this);\n  \t\tthis.sync();\n  \t};\n\n  \treturn Select;\n  })(Element);\n\n  function findParentSelect(element) {\n  \twhile (element) {\n  \t\tif (element.name === 'select') return element;\n  \t\telement = element.parent;\n  \t}\n  }\n\n  var Option = (function (_Element) {\n  \tinherits(Option, _Element);\n\n  \tfunction Option(options) {\n  \t\tclassCallCheck(this, Option);\n\n  \t\tvar template = options.template;\n  \t\tif (!template.a) template.a = {};\n\n  \t\t// If the value attribute is missing, use the element's content,\n  \t\t// as long as it isn't disabled\n  \t\tif (template.a.value === undefined && !('disabled' in template)) {\n  \t\t\ttemplate.a.value = template.f || '';\n  \t\t}\n\n  \t\t_Element.call(this, options);\n\n  \t\tthis.select = findParentSelect(this.parent);\n  \t}\n\n  \tOption.prototype.bind = function bind() {\n  \t\tif (!this.select) {\n  \t\t\t_Element.prototype.bind.call(this);\n  \t\t\treturn;\n  \t\t}\n\n  \t\t// If the select has a value, it overrides the `selected` attribute on\n  \t\t// this option - so we delete the attribute\n  \t\tvar selectedAttribute = this.attributeByName.selected;\n  \t\tif (selectedAttribute && this.select.getAttribute('value') !== undefined) {\n  \t\t\tvar index = this.attributes.indexOf(selectedAttribute);\n  \t\t\tthis.attributes.splice(index, 1);\n  \t\t\tdelete this.attributeByName.selected;\n  \t\t}\n\n  \t\t_Element.prototype.bind.call(this);\n  \t\tthis.select.options.push(this);\n  \t};\n\n  \tOption.prototype.isSelected = function isSelected() {\n  \t\tvar optionValue = this.getAttribute('value');\n\n  \t\tif (optionValue === undefined || !this.select) {\n  \t\t\treturn false;\n  \t\t}\n\n  \t\tvar selectValue = this.select.getAttribute('value');\n\n  \t\tif (selectValue == optionValue) {\n  \t\t\treturn true;\n  \t\t}\n\n  \t\tif (this.select.getAttribute('multiple') && isArray(selectValue)) {\n  \t\t\tvar i = selectValue.length;\n  \t\t\twhile (i--) {\n  \t\t\t\tif (selectValue[i] == optionValue) {\n  \t\t\t\t\treturn true;\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tOption.prototype.unbind = function unbind() {\n  \t\t_Element.prototype.unbind.call(this);\n\n  \t\tif (this.select) {\n  \t\t\tremoveFromArray(this.select.options, this);\n  \t\t}\n  \t};\n\n  \treturn Option;\n  })(Element);\n\n  var Form = (function (_Element) {\n  \tinherits(Form, _Element);\n\n  \tfunction Form(options) {\n  \t\tclassCallCheck(this, Form);\n\n  \t\t_Element.call(this, options);\n  \t\tthis.formBindings = [];\n  \t}\n\n  \tForm.prototype.render = function render(target) {\n  \t\t_Element.prototype.render.call(this, target);\n  \t\tthis.node.addEventListener('reset', handleReset, false);\n  \t};\n\n  \tForm.prototype.unrender = function unrender() {\n  \t\tthis.node.removeEventListener('reset', handleReset, false);\n  \t};\n\n  \treturn Form;\n  })(Element);\n\n  function handleReset() {\n  \tvar element = this._ractive.proxy;\n\n  \trunloop.start();\n  \telement.formBindings.forEach(_updateModel);\n  \trunloop.end();\n  }\n\n  function _updateModel(binding) {\n  \tbinding.model.set(binding.resetValue);\n  }\n\n  var RactiveEvent = (function () {\n  \tfunction RactiveEvent(ractive, name) {\n  \t\tclassCallCheck(this, RactiveEvent);\n\n  \t\tthis.ractive = ractive;\n  \t\tthis.name = name;\n  \t\tthis.handler = null;\n  \t}\n\n  \tRactiveEvent.prototype.listen = function listen(directive) {\n  \t\tvar ractive = this.ractive;\n\n  \t\tthis.handler = ractive.on(this.name, function () {\n  \t\t\tvar event = undefined;\n\n  \t\t\t// semi-weak test, but what else? tag the event obj ._isEvent ?\n  \t\t\tif (arguments.length && arguments[0] && arguments[0].node) {\n  \t\t\t\tevent = Array.prototype.shift.call(arguments);\n  \t\t\t\tevent.component = ractive;\n  \t\t\t}\n\n  \t\t\tvar args = Array.prototype.slice.call(arguments);\n  \t\t\tdirective.fire(event, args);\n\n  \t\t\t// cancel bubbling\n  \t\t\treturn false;\n  \t\t});\n  \t};\n\n  \tRactiveEvent.prototype.unlisten = function unlisten() {\n  \t\tthis.handler.cancel();\n  \t};\n\n  \treturn RactiveEvent;\n  })();\n\n  // TODO it's unfortunate that this has to run every time a\n  // component is rendered... is there a better way?\n\n  function updateLiveQueries(component) {\n  \t// Does this need to be added to any live queries?\n  \tvar instance = component.ractive;\n\n  \tdo {\n  \t\tvar liveQueries = instance._liveComponentQueries;\n\n  \t\tvar i = liveQueries.length;\n  \t\twhile (i--) {\n  \t\t\tvar _name = liveQueries[i];\n  \t\t\tvar query = liveQueries[\"_\" + _name];\n\n  \t\t\tif (query.test(component)) {\n  \t\t\t\tquery.add(component.instance);\n  \t\t\t\t// keep register of applicable selectors, for when we teardown\n  \t\t\t\tcomponent.liveQueries.push(query);\n  \t\t\t}\n  \t\t}\n  \t} while (instance = instance.parent);\n  }\n\n  var _css;\n  var _update;\n  var styleElement;\n  var head;\n  var styleSheet;\n  var inDom;\n  var _prefix = '/* Ractive.js component styles */\\n';\n  var styles = [];\n  var dirty = false;\n  if (!doc) {\n  \t// TODO handle encapsulated CSS in server-rendered HTML!\n  \t_css = {\n  \t\tadd: noop,\n  \t\tapply: noop\n  \t};\n  } else {\n  \tstyleElement = doc.createElement('style');\n  \tstyleElement.type = 'text/css';\n\n  \thead = doc.getElementsByTagName('head')[0];\n\n  \tinDom = false;\n\n  \t// Internet Exploder won't let you use styleSheet.innerHTML - we have to\n  \t// use styleSheet.cssText instead\n  \tstyleSheet = styleElement.styleSheet;\n\n  \t_update = function () {\n  \t\tvar css = _prefix + styles.map(function (s) {\n  \t\t\treturn '\\n/* {' + s.id + '} */\\n' + s.styles;\n  \t\t}).join('\\n');\n\n  \t\tif (styleSheet) {\n  \t\t\tstyleSheet.cssText = css;\n  \t\t} else {\n  \t\t\tstyleElement.innerHTML = css;\n  \t\t}\n\n  \t\tif (!inDom) {\n  \t\t\thead.appendChild(styleElement);\n  \t\t\tinDom = true;\n  \t\t}\n  \t};\n\n  \t_css = {\n  \t\tadd: function (s) {\n  \t\t\tstyles.push(s);\n  \t\t\tdirty = true;\n  \t\t},\n\n  \t\tapply: function () {\n  \t\t\tif (dirty) {\n  \t\t\t\t_update();\n  \t\t\t\tdirty = false;\n  \t\t\t}\n  \t\t}\n  \t};\n  }\n\n  var _renderHook = new Hook('render');\n  var _completeHook = new Hook('complete');\n  function _render(ractive, target, anchor) {\n  \t// if `noIntro` is `true`, temporarily disable transitions\n  \tvar transitionsEnabled = ractive.transitionsEnabled;\n  \tif (ractive.noIntro) ractive.transitionsEnabled = false;\n\n  \tvar promise = runloop.start(ractive, true);\n  \trunloop.scheduleTask(function () {\n  \t\treturn _renderHook.fire(ractive);\n  \t}, true);\n\n  \tif (ractive.fragment.rendered) {\n  \t\tthrow new Error('You cannot call ractive.render() on an already rendered instance! Call ractive.unrender() first');\n  \t}\n\n  \tanchor = getElement(anchor) || ractive.anchor;\n\n  \tractive.el = target;\n  \tractive.anchor = anchor;\n\n  \t// ensure encapsulated CSS is up-to-date\n  \tif (ractive.cssId) _css.apply();\n\n  \tif (target) {\n  \t\t(target.__ractive_instances__ || (target.__ractive_instances__ = [])).push(ractive);\n\n  \t\tif (anchor) {\n  \t\t\tvar docFrag = doc.createDocumentFragment();\n  \t\t\tractive.fragment.render(docFrag);\n  \t\t\ttarget.insertBefore(docFrag, anchor);\n  \t\t} else {\n  \t\t\tractive.fragment.render(target);\n  \t\t}\n  \t}\n\n  \trunloop.end();\n  \tractive.transitionsEnabled = transitionsEnabled;\n\n  \treturn promise.then(function () {\n  \t\treturn _completeHook.fire(ractive);\n  \t});\n  }\n\n  function getChildQueue(queue, ractive) {\n  \treturn queue[ractive._guid] || (queue[ractive._guid] = []);\n  }\n\n  function _fire(hookQueue, ractive) {\n  \tvar childQueue = getChildQueue(hookQueue.queue, ractive);\n\n  \thookQueue.hook.fire(ractive);\n\n  \t// queue is \"live\" because components can end up being\n  \t// added while hooks fire on parents that modify data values.\n  \twhile (childQueue.length) {\n  \t\t_fire(hookQueue, childQueue.shift());\n  \t}\n\n  \tdelete hookQueue.queue[ractive._guid];\n  }\n\n  var HookQueue = (function () {\n  \tfunction HookQueue(event) {\n  \t\tclassCallCheck(this, HookQueue);\n\n  \t\tthis.hook = new Hook(event);\n  \t\tthis.inProcess = {};\n  \t\tthis.queue = {};\n  \t}\n\n  \tHookQueue.prototype.begin = function begin(ractive) {\n  \t\tthis.inProcess[ractive._guid] = true;\n  \t};\n\n  \tHookQueue.prototype.end = function end(ractive) {\n  \t\tvar parent = ractive.parent;\n\n  \t\t// If this is *isn't* a child of a component that's in process,\n  \t\t// it should call methods or fire at this point\n  \t\tif (!parent || !this.inProcess[parent._guid]) {\n  \t\t\t_fire(this, ractive);\n  \t\t}\n  \t\t// elsewise, handoff to parent to fire when ready\n  \t\telse {\n  \t\t\t\tgetChildQueue(this.queue, parent).push(ractive);\n  \t\t\t}\n\n  \t\tdelete this.inProcess[ractive._guid];\n  \t};\n\n  \treturn HookQueue;\n  })();\n\n  var TEMPLATE_VERSION = 3;\n\n  var templateConfigurator = {\n  \tname: 'template',\n\n  \textend: function (Parent, proto, options) {\n  \t\t// only assign if exists\n  \t\tif ('template' in options) {\n  \t\t\tvar template = options.template;\n\n  \t\t\tif (typeof template === 'function') {\n  \t\t\t\tproto.template = template;\n  \t\t\t} else {\n  \t\t\t\tproto.template = parseIfString(template, proto);\n  \t\t\t}\n  \t\t}\n  \t},\n\n  \tinit: function (Parent, ractive, options) {\n  \t\t// TODO because of prototypal inheritance, we might just be able to use\n  \t\t// ractive.template, and not bother passing through the Parent object.\n  \t\t// At present that breaks the test mocks' expectations\n  \t\tvar template = 'template' in options ? options.template : Parent.prototype.template;\n  \t\ttemplate = template || { v: TEMPLATE_VERSION, t: [] };\n\n  \t\tif (typeof template === 'function') {\n  \t\t\tvar fn = template;\n  \t\t\ttemplate = getDynamicTemplate(ractive, fn);\n\n  \t\t\tractive._config.template = {\n  \t\t\t\tfn: fn,\n  \t\t\t\tresult: template\n  \t\t\t};\n  \t\t}\n\n  \t\ttemplate = parseIfString(template, ractive);\n\n  \t\t// TODO the naming of this is confusing - ractive.template refers to [...],\n  \t\t// but Component.prototype.template refers to {v:1,t:[],p:[]}...\n  \t\t// it's unnecessary, because the developer never needs to access\n  \t\t// ractive.template\n  \t\tractive.template = template.t;\n\n  \t\tif (template.p) {\n  \t\t\textendPartials(ractive.partials, template.p);\n  \t\t}\n  \t},\n\n  \treset: function (ractive) {\n  \t\tvar result = resetValue(ractive);\n\n  \t\tif (result) {\n  \t\t\tvar parsed = parseIfString(result, ractive);\n\n  \t\t\tractive.template = parsed.t;\n  \t\t\textendPartials(ractive.partials, parsed.p, true);\n\n  \t\t\treturn true;\n  \t\t}\n  \t}\n  };\n\n  function resetValue(ractive) {\n  \tvar initial = ractive._config.template;\n\n  \t// If this isn't a dynamic template, there's nothing to do\n  \tif (!initial || !initial.fn) {\n  \t\treturn;\n  \t}\n\n  \tvar result = getDynamicTemplate(ractive, initial.fn);\n\n  \t// TODO deep equality check to prevent unnecessary re-rendering\n  \t// in the case of already-parsed templates\n  \tif (result !== initial.result) {\n  \t\tinitial.result = result;\n  \t\tresult = parseIfString(result, ractive);\n  \t\treturn result;\n  \t}\n  }\n\n  function getDynamicTemplate(ractive, fn) {\n  \tvar helper = createHelper(_parser.getParseOptions(ractive));\n  \treturn fn.call(ractive, helper);\n  }\n\n  function createHelper(parseOptions) {\n  \tvar helper = create(_parser);\n  \thelper.parse = function (template, options) {\n  \t\treturn _parser.parse(template, options || parseOptions);\n  \t};\n  \treturn helper;\n  }\n\n  function parseIfString(template, ractive) {\n  \tif (typeof template === 'string') {\n  \t\t// ID of an element containing the template?\n  \t\tif (template[0] === '#') {\n  \t\t\ttemplate = _parser.fromId(template);\n  \t\t}\n\n  \t\ttemplate = parse(template, _parser.getParseOptions(ractive));\n  \t}\n\n  \t// Check that the template even exists\n  \telse if (template == undefined) {\n  \t\t\tthrow new Error('The template cannot be ' + template + '.');\n  \t\t}\n\n  \t\t// Check the parsed template has a version at all\n  \t\telse if (typeof template.v !== 'number') {\n  \t\t\t\tthrow new Error('The template parser was passed a non-string template, but the template doesn\\'t have a version.  Make sure you\\'re passing in the template you think you are.');\n  \t\t\t}\n\n  \t\t\t// Check we're using the correct version\n  \t\t\telse if (template.v !== TEMPLATE_VERSION) {\n  \t\t\t\t\tthrow new Error('Mismatched template version (expected ' + TEMPLATE_VERSION + ', got ' + template.v + ') Please ensure you are using the latest version of Ractive.js in your build process as well as in your app');\n  \t\t\t\t}\n\n  \treturn template;\n  }\n\n  function extendPartials(existingPartials, newPartials, overwrite) {\n  \tif (!newPartials) return;\n\n  \t// TODO there's an ambiguity here - we need to overwrite in the `reset()`\n  \t// case, but not initially...\n\n  \tfor (var key in newPartials) {\n  \t\tif (overwrite || !existingPartials.hasOwnProperty(key)) {\n  \t\t\texistingPartials[key] = newPartials[key];\n  \t\t}\n  \t}\n  }\n\n  function validate(data) {\n  \t// Warn if userOptions.data is a non-POJO\n  \tif (data && data.constructor !== Object) {\n  \t\tif (typeof data === 'function') {\n  \t\t\t// TODO do we need to support this in the new Ractive() case?\n  \t\t} else if (typeof data !== 'object') {\n  \t\t\t\tfatal('data option must be an object or a function, `' + data + '` is not valid');\n  \t\t\t} else {\n  \t\t\t\twarnIfDebug('If supplied, options.data should be a plain JavaScript object - using a non-POJO as the root object may work, but is discouraged');\n  \t\t\t}\n  \t}\n  }\n\n  var dataConfigurator = {\n  \tname: 'data',\n\n  \textend: function (Parent, proto, options) {\n  \t\tvar key = undefined;\n  \t\tvar value = undefined;\n\n  \t\t// check for non-primitives, which could cause mutation-related bugs\n  \t\tif (options.data && isObject(options.data)) {\n  \t\t\tfor (key in options.data) {\n  \t\t\t\tvalue = options.data[key];\n\n  \t\t\t\tif (value && typeof value === 'object') {\n  \t\t\t\t\tif (isObject(value) || isArray(value)) {\n  \t\t\t\t\t\twarnIfDebug('Passing a `data` option with object and array properties to Ractive.extend() is discouraged, as mutating them is likely to cause bugs. Consider using a data function instead:\\n\\n  // this...\\n  data: function () {\\n    return {\\n      myObject: {}\\n    };\\n  })\\n\\n  // instead of this:\\n  data: {\\n    myObject: {}\\n  }');\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\tproto.data = __combine(proto.data, options.data);\n  \t},\n\n  \tinit: function (Parent, ractive, options) {\n  \t\tvar result = __combine(Parent.prototype.data, options.data);\n\n  \t\tif (typeof result === 'function') result = result.call(ractive);\n\n  \t\t// bind functions to the ractive instance at the top level,\n  \t\t// unless it's a non-POJO (in which case alarm bells should ring)\n  \t\tif (result && result.constructor === Object) {\n  \t\t\tfor (var prop in result) {\n  \t\t\t\tif (typeof result[prop] === 'function') result[prop] = _bind(result[prop], ractive);\n  \t\t\t}\n  \t\t}\n\n  \t\treturn result || {};\n  \t},\n\n  \treset: function (ractive) {\n  \t\tvar result = this.init(ractive.constructor, ractive, ractive.viewmodel);\n  \t\tractive.viewmodel.root.set(result);\n  \t\treturn true;\n  \t}\n  };\n\n  function __combine(parentValue, childValue) {\n  \tvalidate(childValue);\n\n  \tvar parentIsFn = typeof parentValue === 'function';\n  \tvar childIsFn = typeof childValue === 'function';\n\n  \t// Very important, otherwise child instance can become\n  \t// the default data object on Ractive or a component.\n  \t// then ractive.set() ends up setting on the prototype!\n  \tif (!childValue && !parentIsFn) {\n  \t\tchildValue = {};\n  \t}\n\n  \t// Fast path, where we just need to copy properties from\n  \t// parent to child\n  \tif (!parentIsFn && !childIsFn) {\n  \t\treturn fromProperties(childValue, parentValue);\n  \t}\n\n  \treturn function () {\n  \t\tvar child = childIsFn ? callDataFunction(childValue, this) : childValue;\n  \t\tvar parent = parentIsFn ? callDataFunction(parentValue, this) : parentValue;\n\n  \t\treturn fromProperties(child, parent);\n  \t};\n  }\n\n  function callDataFunction(fn, context) {\n  \tvar data = fn.call(context);\n\n  \tif (!data) return;\n\n  \tif (typeof data !== 'object') {\n  \t\tfatal('Data function must return an object');\n  \t}\n\n  \tif (data.constructor !== Object) {\n  \t\twarnOnceIfDebug('Data function returned something other than a plain JavaScript object. This might work, but is strongly discouraged');\n  \t}\n\n  \treturn data;\n  }\n\n  function fromProperties(primary, secondary) {\n  \tif (primary && secondary) {\n  \t\tfor (var key in secondary) {\n  \t\t\tif (!(key in primary)) {\n  \t\t\t\tprimary[key] = secondary[key];\n  \t\t\t}\n  \t\t}\n\n  \t\treturn primary;\n  \t}\n\n  \treturn primary || secondary;\n  }\n\n  var selectorsPattern = /(?:^|\\})?\\s*([^\\{\\}]+)\\s*\\{/g;\n  var commentsPattern = /\\/\\*.*?\\*\\//g;\n  var selectorUnitPattern = /((?:(?:\\[[^\\]+]\\])|(?:[^\\s\\+\\>\\~:]))+)((?::[^\\s\\+\\>\\~\\(]+(?:\\([^\\)]+\\))?)?\\s*[\\s\\+\\>\\~]?)\\s*/g;\n  var mediaQueryPattern = /^@media/;\n  var dataRvcGuidPattern = /\\[data-ractive-css~=\"\\{[a-z0-9-]+\\}\"]/g;\n\n  function trim(str) {\n  \treturn str.trim();\n  }\n\n  function extractString(unit) {\n  \treturn unit.str;\n  }\n\n  function transformSelector(selector, parent) {\n  \tvar selectorUnits = [];\n  \tvar match = undefined;\n\n  \twhile (match = selectorUnitPattern.exec(selector)) {\n  \t\tselectorUnits.push({\n  \t\t\tstr: match[0],\n  \t\t\tbase: match[1],\n  \t\t\tmodifiers: match[2]\n  \t\t});\n  \t}\n\n  \t// For each simple selector within the selector, we need to create a version\n  \t// that a) combines with the id, and b) is inside the id\n  \tvar base = selectorUnits.map(extractString);\n\n  \tvar transformed = [];\n  \tvar i = selectorUnits.length;\n\n  \twhile (i--) {\n  \t\tvar appended = base.slice();\n\n  \t\t// Pseudo-selectors should go after the attribute selector\n  \t\tvar unit = selectorUnits[i];\n  \t\tappended[i] = unit.base + parent + unit.modifiers || '';\n\n  \t\tvar prepended = base.slice();\n  \t\tprepended[i] = parent + ' ' + prepended[i];\n\n  \t\ttransformed.push(appended.join(' '), prepended.join(' '));\n  \t}\n\n  \treturn transformed.join(', ');\n  }\n  function transformCss(css, id) {\n  \tvar dataAttr = '[data-ractive-css~=\"{' + id + '}\"]';\n\n  \tvar transformed = undefined;\n\n  \tif (dataRvcGuidPattern.test(css)) {\n  \t\ttransformed = css.replace(dataRvcGuidPattern, dataAttr);\n  \t} else {\n  \t\ttransformed = css.replace(commentsPattern, '').replace(selectorsPattern, function (match, $1) {\n  \t\t\t// don't transform media queries!\n  \t\t\tif (mediaQueryPattern.test($1)) return match;\n\n  \t\t\tvar selectors = $1.split(',').map(trim);\n  \t\t\tvar transformed = selectors.map(function (selector) {\n  \t\t\t\treturn transformSelector(selector, dataAttr);\n  \t\t\t}).join(', ') + ' ';\n\n  \t\t\treturn match.replace($1, transformed);\n  \t\t});\n  \t}\n\n  \treturn transformed;\n  }\n\n  var _uid = 1;\n\n  var cssConfigurator = {\n  \tname: 'css',\n\n  \textend: function (Parent, proto, options) {\n  \t\tif (options.css) {\n  \t\t\tvar id = _uid++;\n  \t\t\tvar styles = options.noCssTransform ? options.css : transformCss(options.css, id);\n\n  \t\t\tproto.cssId = id;\n  \t\t\t_css.add({ id: id, styles: styles });\n  \t\t}\n  \t},\n\n  \tinit: function () {}\n  };\n\n  var adaptConfigurator = {\n  \textend: function (Parent, proto, options) {\n  \t\tproto.adapt = _combine(proto.adapt, ensureArray(options.adapt));\n  \t},\n\n  \tinit: function () {}\n  };\n\n  function _combine(a, b) {\n  \tvar c = a.slice();\n  \tvar i = b.length;\n\n  \twhile (i--) {\n  \t\tif (! ~c.indexOf(b[i])) {\n  \t\t\tc.push(b[i]);\n  \t\t}\n  \t}\n\n  \treturn c;\n  }\n\n  var _registryNames = ['adaptors', 'components', 'computed', 'decorators', 'easing', 'events', 'interpolators', 'partials', 'transitions'];\n\n  var Registry = (function () {\n  \tfunction Registry(name, useDefaults) {\n  \t\tclassCallCheck(this, Registry);\n\n  \t\tthis.name = name;\n  \t\tthis.useDefaults = useDefaults;\n  \t}\n\n  \tRegistry.prototype.extend = function extend(Parent, proto, options) {\n  \t\tthis.configure(this.useDefaults ? Parent.defaults : Parent, this.useDefaults ? proto : proto.constructor, options);\n  \t};\n\n  \tRegistry.prototype.init = function init() {\n  \t\t// noop\n  \t};\n\n  \tRegistry.prototype.configure = function configure(Parent, target, options) {\n  \t\tvar name = this.name;\n  \t\tvar option = options[name];\n\n  \t\tvar registry = create(Parent[name]);\n\n  \t\tfor (var key in option) {\n  \t\t\tregistry[key] = option[key];\n  \t\t}\n\n  \t\ttarget[name] = registry;\n  \t};\n\n  \tRegistry.prototype.reset = function reset(ractive) {\n  \t\tvar registry = ractive[this.name];\n  \t\tvar changed = false;\n\n  \t\tObject.keys(registry).forEach(function (key) {\n  \t\t\tvar item = registry[key];\n\n  \t\t\tif (item._fn) {\n  \t\t\t\tif (item._fn.isOwner) {\n  \t\t\t\t\tregistry[key] = item._fn;\n  \t\t\t\t} else {\n  \t\t\t\t\tdelete registry[key];\n  \t\t\t\t}\n  \t\t\t\tchanged = true;\n  \t\t\t}\n  \t\t});\n\n  \t\treturn changed;\n  \t};\n\n  \treturn Registry;\n  })();\n\n  var registries = _registryNames.map(function (name) {\n  \treturn new Registry(name, name === 'computed');\n  });\n\n  function getMessage(deprecated, correct, isError) {\n  \treturn 'options.' + deprecated + ' has been deprecated in favour of options.' + correct + '.' + (isError ? ' You cannot specify both options, please use options.' + correct + '.' : '');\n  }\n\n  function deprecateOption(options, deprecatedOption, correct) {\n  \tif (deprecatedOption in options) {\n  \t\tif (!(correct in options)) {\n  \t\t\twarnIfDebug(getMessage(deprecatedOption, correct));\n  \t\t\toptions[correct] = options[deprecatedOption];\n  \t\t} else {\n  \t\t\tthrow new Error(getMessage(deprecatedOption, correct, true));\n  \t\t}\n  \t}\n  }\n  function deprecate(options) {\n  \tdeprecateOption(options, 'beforeInit', 'onconstruct');\n  \tdeprecateOption(options, 'init', 'onrender');\n  \tdeprecateOption(options, 'complete', 'oncomplete');\n  \tdeprecateOption(options, 'eventDefinitions', 'events');\n\n  \t// Using extend with Component instead of options,\n  \t// like Human.extend( Spider ) means adaptors as a registry\n  \t// gets copied to options. So we have to check if actually an array\n  \tif (isArray(options.adaptors)) {\n  \t\tdeprecateOption(options, 'adaptors', 'adapt');\n  \t}\n  }\n\n  function wrap(parent, name, method) {\n  \tif (!/_super/.test(method)) return method;\n\n  \tfunction wrapper() {\n  \t\tvar superMethod = getSuperMethod(wrapper._parent, name);\n  \t\tvar hasSuper = ('_super' in this);\n  \t\tvar oldSuper = this._super;\n\n  \t\tthis._super = superMethod;\n\n  \t\tvar result = method.apply(this, arguments);\n\n  \t\tif (hasSuper) {\n  \t\t\tthis._super = oldSuper;\n  \t\t} else {\n  \t\t\tdelete this._super;\n  \t\t}\n\n  \t\treturn result;\n  \t}\n\n  \twrapper._parent = parent;\n  \twrapper._method = method;\n\n  \treturn wrapper;\n  }\n\n  function getSuperMethod(parent, name) {\n  \tif (name in parent) {\n  \t\tvar _ret = (function () {\n  \t\t\tvar value = parent[name];\n\n  \t\t\treturn {\n  \t\t\t\tv: typeof value === 'function' ? value : function () {\n  \t\t\t\t\treturn value;\n  \t\t\t\t}\n  \t\t\t};\n  \t\t})();\n\n  \t\tif (typeof _ret === 'object') return _ret.v;\n  \t}\n\n  \treturn noop;\n  }\n\n  var custom = {\n  \tadapt: adaptConfigurator,\n  \tcss: cssConfigurator,\n  \tdata: dataConfigurator,\n  \ttemplate: templateConfigurator\n  };\n\n  var defaultKeys = Object.keys(_defaults);\n\n  var isStandardKey = makeObj(defaultKeys.filter(function (key) {\n  \treturn !custom[key];\n  }));\n\n  // blacklisted keys that we don't double extend\n  var isBlacklisted = makeObj(defaultKeys.concat(registries.map(function (r) {\n  \treturn r.name;\n  })));\n\n  var order = [].concat(defaultKeys.filter(function (key) {\n  \treturn !registries[key] && !custom[key];\n  }), registries,\n  //custom.data,\n  custom.template, custom.css);\n\n  var config = {\n  \textend: function (Parent, proto, options) {\n  \t\treturn _configure('extend', Parent, proto, options);\n  \t},\n\n  \tinit: function (Parent, ractive, options) {\n  \t\treturn _configure('init', Parent, ractive, options);\n  \t},\n\n  \treset: function (ractive) {\n  \t\treturn order.filter(function (c) {\n  \t\t\treturn c.reset && c.reset(ractive);\n  \t\t}).map(function (c) {\n  \t\t\treturn c.name;\n  \t\t});\n  \t},\n\n  \t// this defines the order. TODO this isn't used anywhere in the codebase,\n  \t// only in the test suite - should get rid of it\n  \torder: order\n  };\n\n  function _configure(method, Parent, target, options) {\n  \tdeprecate(options);\n\n  \tfor (var key in options) {\n  \t\tif (isStandardKey.hasOwnProperty(key)) {\n  \t\t\tvar value = options[key];\n\n  \t\t\t// warn the developer if they passed a function and ignore its value\n\n  \t\t\t// NOTE: we allow some functions on \"el\" because we duck type element lists\n  \t\t\t// and some libraries or ef'ed-up virtual browsers (phantomJS) return a\n  \t\t\t// function object as the result of querySelector methods\n  \t\t\tif (key !== 'el' && typeof value === 'function') {\n  \t\t\t\twarnIfDebug(key + ' is a Ractive option that does not expect a function and will be ignored', method === 'init' ? target : null);\n  \t\t\t} else {\n  \t\t\t\ttarget[key] = value;\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \tregistries.forEach(function (registry) {\n  \t\tregistry[method](Parent, target, options);\n  \t});\n\n  \tadaptConfigurator[method](Parent, target, options);\n  \ttemplateConfigurator[method](Parent, target, options);\n  \tcssConfigurator[method](Parent, target, options);\n\n  \textendOtherMethods(Parent.prototype, target, options);\n  }\n\n  function extendOtherMethods(parent, target, options) {\n  \tfor (var key in options) {\n  \t\tif (!isBlacklisted[key] && options.hasOwnProperty(key)) {\n  \t\t\tvar member = options[key];\n\n  \t\t\t// if this is a method that overwrites a method, wrap it:\n  \t\t\tif (typeof member === 'function') {\n  \t\t\t\tmember = wrap(parent, key, member);\n  \t\t\t}\n\n  \t\t\ttarget[key] = member;\n  \t\t}\n  \t}\n  }\n\n  function makeObj(array) {\n  \tvar obj = {};\n  \tarray.forEach(function (x) {\n  \t\treturn obj[x] = true;\n  \t});\n  \treturn obj;\n  }\n\n  var configHook = new Hook('config');\n  var initHook = new HookQueue('init');\n  function initialise(ractive, userOptions, options) {\n  \tObject.keys(ractive.viewmodel.computations).forEach(function (key) {\n  \t\tvar computation = ractive.viewmodel.computations[key];\n\n  \t\tif (ractive.viewmodel.value.hasOwnProperty(key)) {\n  \t\t\tcomputation.set(ractive.viewmodel.value[key]);\n  \t\t}\n  \t});\n\n  \t// init config from Parent and options\n  \tconfig.init(ractive.constructor, ractive, userOptions);\n\n  \tconfigHook.fire(ractive);\n  \tinitHook.begin(ractive);\n\n  \tvar fragment = undefined;\n\n  \t// Render virtual DOM\n  \tif (ractive.template) {\n  \t\tvar cssIds = undefined;\n\n  \t\tif (options.cssIds || ractive.cssId) {\n  \t\t\tcssIds = options.cssIds ? options.cssIds.slice() : [];\n\n  \t\t\tif (ractive.cssId) {\n  \t\t\t\tcssIds.push(ractive.cssId);\n  \t\t\t}\n  \t\t}\n\n  \t\tractive.fragment = fragment = new Fragment({\n  \t\t\towner: ractive,\n  \t\t\ttemplate: ractive.template,\n  \t\t\tcssIds: cssIds,\n  \t\t\tindexRefs: options.indexRefs || {},\n  \t\t\tkeyRefs: options.keyRefs || {}\n  \t\t}).bind(ractive.viewmodel);\n  \t}\n\n  \tinitHook.end(ractive);\n\n  \tif (fragment) {\n  \t\t// render automatically ( if `el` is specified )\n  \t\tvar el = getElement(ractive.el);\n  \t\tif (el) {\n  \t\t\tvar promise = ractive.render(el, ractive.append);\n\n  \t\t\tif (Ractive.DEBUG_PROMISES) {\n  \t\t\t\tpromise['catch'](function (err) {\n  \t\t\t\t\twarnOnceIfDebug('Promise debugging is enabled, to help solve errors that happen asynchronously. Some browsers will log unhandled promise rejections, in which case you can safely disable promise debugging:\\n  Ractive.DEBUG_PROMISES = false;');\n  \t\t\t\t\twarnIfDebug('An error happened during rendering', { ractive: ractive });\n  \t\t\t\t\terr.stack && logIfDebug(err.stack);\n\n  \t\t\t\t\tthrow err;\n  \t\t\t\t});\n  \t\t\t}\n  \t\t}\n  \t}\n  }\n\n  var _pattern = /\\$\\{([^\\}]+)\\}/g;\n\n  function createFunctionFromString(ractive, str) {\n  \tvar hasThis = undefined;\n\n  \tvar functionBody = 'return (' + str.replace(_pattern, function (match, keypath) {\n  \t\thasThis = true;\n  \t\treturn '__ractive.get(\"' + keypath + '\")';\n  \t}) + ');';\n\n  \tif (hasThis) functionBody = 'var __ractive = this; ' + functionBody;\n\n  \tvar fn = new Function(functionBody);\n  \treturn hasThis ? fn.bind(ractive) : fn;\n  }\n  function getComputationSignature(ractive, key, signature) {\n  \tvar getter = undefined;\n  \tvar setter = undefined;\n\n  \t// useful for debugging\n  \tvar getterString = undefined;\n  \tvar getterUseStack = undefined;\n  \tvar setterString = undefined;\n\n  \tif (typeof signature === 'function') {\n  \t\tgetter = _bind(signature, ractive);\n  \t\tgetterString = signature.toString();\n  \t\tgetterUseStack = true;\n  \t}\n\n  \tif (typeof signature === 'string') {\n  \t\tgetter = createFunctionFromString(ractive, signature);\n  \t\tgetterString = signature;\n  \t}\n\n  \tif (typeof signature === 'object') {\n  \t\tif (typeof signature.get === 'string') {\n  \t\t\tgetter = createFunctionFromString(ractive, signature.get);\n  \t\t\tgetterString = signature.get;\n  \t\t} else if (typeof signature.get === 'function') {\n  \t\t\tgetter = _bind(signature.get, ractive);\n  \t\t\tgetterString = signature.get.toString();\n  \t\t\tgetterUseStack = true;\n  \t\t} else {\n  \t\t\tfatal('`%s` computation must have a `get()` method', key);\n  \t\t}\n\n  \t\tif (typeof signature.set === 'function') {\n  \t\t\tsetter = _bind(signature.set, ractive);\n  \t\t\tsetterString = signature.set.toString();\n  \t\t}\n  \t}\n\n  \treturn {\n  \t\tgetter: getter,\n  \t\tsetter: setter,\n  \t\tgetterString: getterString,\n  \t\tsetterString: setterString,\n  \t\tgetterUseStack: getterUseStack\n  \t};\n  }\n\n  // TODO this is probably a bit anal, maybe we should leave it out\n  function prettify(fnBody) {\n  \tvar lines = fnBody.replace(/^\\t+/gm, function (tabs) {\n  \t\treturn tabs.split('\\t').join('  ');\n  \t}).split('\\n');\n\n  \tvar minIndent = lines.length < 2 ? 0 : lines.slice(1).reduce(function (prev, line) {\n  \t\treturn Math.min(prev, /^\\s*/.exec(line)[0].length);\n  \t}, Infinity);\n\n  \treturn lines.map(function (line, i) {\n  \t\treturn '    ' + (i ? line.substring(minIndent) : line);\n  \t}).join('\\n');\n  }\n\n  // Ditto. This function truncates the stack to only include app code\n  function truncateStack(stack) {\n  \tif (!stack) return '';\n\n  \tvar lines = stack.split('\\n');\n  \tvar name = Computation.name + '.getValue';\n\n  \tvar truncated = [];\n\n  \tvar len = lines.length;\n  \tfor (var i = 1; i < len; i += 1) {\n  \t\tvar line = lines[i];\n\n  \t\tif (~line.indexOf(name)) {\n  \t\t\treturn truncated.join('\\n');\n  \t\t} else {\n  \t\t\ttruncated.push(line);\n  \t\t}\n  \t}\n  }\n\n  var Computation = (function (_Model) {\n  \tinherits(Computation, _Model);\n\n  \tfunction Computation(viewmodel, signature, key) {\n  \t\tclassCallCheck(this, Computation);\n\n  \t\t_Model.call(this, null, null);\n\n  \t\tthis.root = this.parent = viewmodel;\n  \t\tthis.signature = signature;\n  \t\tthis.key = key; // not actually used, but helps with debugging\n\n  \t\tthis.isReadonly = !this.signature.setter;\n\n  \t\tthis.context = viewmodel.computationContext;\n\n  \t\tthis.dependencies = [];\n\n  \t\tthis.children = [];\n  \t\tthis.childByKey = {};\n\n  \t\tthis.deps = [];\n\n  \t\tthis.boundsSensitive = true;\n  \t\tthis.dirty = true;\n  \t}\n\n  \tComputation.prototype.get = function get(shouldCapture) {\n  \t\tif (shouldCapture) capture(this);\n\n  \t\tif (this.dirty) {\n  \t\t\tthis.value = this.getValue();\n  \t\t\tthis.adapt();\n  \t\t\tthis.dirty = false;\n  \t\t}\n\n  \t\treturn this.value;\n  \t};\n\n  \tComputation.prototype.getValue = function getValue() {\n  \t\tstartCapturing();\n  \t\tvar result = undefined;\n\n  \t\ttry {\n  \t\t\tresult = this.signature.getter.call(this.context);\n  \t\t} catch (err) {\n  \t\t\twarnIfDebug('Failed to compute ' + this.getKeypath() + ': ' + (err.message || err));\n\n  \t\t\t// TODO this is all well and good in Chrome, but...\n  \t\t\t// ...also, should encapsulate this stuff better, and only\n  \t\t\t// show it if Ractive.DEBUG\n  \t\t\tif (console.groupCollapsed) console.groupCollapsed('%cshow details', 'color: rgb(82, 140, 224); font-weight: normal; text-decoration: underline;');\n  \t\t\tvar functionBody = prettify(this.signature.getterString);\n  \t\t\tvar stack = this.signature.getterUseStack ? '\\n\\n' + truncateStack(err.stack) : '';\n  \t\t\tconsole.error(err.name + ': ' + err.message + '\\n\\n' + functionBody + stack);\n  \t\t\tif (console.groupCollapsed) console.groupEnd();\n  \t\t}\n\n  \t\tvar dependencies = stopCapturing();\n  \t\tthis.setDependencies(dependencies);\n\n  \t\treturn result;\n  \t};\n\n  \tComputation.prototype.handleChange = function handleChange() {\n  \t\tthis.dirty = true;\n\n  \t\tthis.deps.forEach(_handleChange);\n  \t\tthis.children.forEach(_handleChange);\n  \t\tthis.clearUnresolveds(); // TODO same question as on Model - necessary for primitives?\n  \t};\n\n  \tComputation.prototype.joinKey = function joinKey(key) {\n  \t\tif (key === undefined || key === '') return this;\n\n  \t\tif (!this.childByKey.hasOwnProperty(key)) {\n  \t\t\tvar child = new ComputationChild(this, key);\n  \t\t\tthis.children.push(child);\n  \t\t\tthis.childByKey[key] = child;\n  \t\t}\n\n  \t\treturn this.childByKey[key];\n  \t};\n\n  \tComputation.prototype.mark = function mark() {\n  \t\tthis.handleChange();\n  \t};\n\n  \tComputation.prototype.set = function set(value) {\n  \t\tif (!this.signature.setter) {\n  \t\t\tthrow new Error('Cannot set read-only computed value \\'' + this.key + '\\'');\n  \t\t}\n\n  \t\tthis.signature.setter(value);\n  \t};\n\n  \tComputation.prototype.setDependencies = function setDependencies(dependencies) {\n  \t\t// unregister any soft dependencies we no longer have\n  \t\tvar i = this.dependencies.length;\n  \t\twhile (i--) {\n  \t\t\tvar model = this.dependencies[i];\n  \t\t\tif (! ~dependencies.indexOf(model)) model.unregister(this);\n  \t\t}\n\n  \t\t// and add any new ones\n  \t\ti = dependencies.length;\n  \t\twhile (i--) {\n  \t\t\tvar model = dependencies[i];\n  \t\t\tif (! ~this.dependencies.indexOf(model)) model.register(this);\n  \t\t}\n\n  \t\tthis.dependencies = dependencies;\n  \t};\n\n  \treturn Computation;\n  })(Model);\n\n  var RootModel = (function (_Model) {\n  \tinherits(RootModel, _Model);\n\n  \tfunction RootModel(options) {\n  \t\tclassCallCheck(this, RootModel);\n\n  \t\t_Model.call(this, null, null);\n\n  \t\t// TODO deprecate this\n  \t\tthis.changes = {};\n\n  \t\tthis.isRoot = true;\n  \t\tthis.root = this;\n  \t\tthis.ractive = options.ractive; // TODO sever this link\n\n  \t\tthis.value = options.data;\n  \t\tthis.adaptors = options.adapt;\n  \t\tthis.adapt();\n\n  \t\tthis.mappings = {};\n\n  \t\tthis.computationContext = options.ractive;\n  \t\tthis.computations = {};\n  \t}\n\n  \tRootModel.prototype.applyChanges = function applyChanges() {\n  \t\tthis._changeHash = {};\n  \t\tthis.flush();\n\n  \t\treturn this._changeHash;\n  \t};\n\n  \tRootModel.prototype.compute = function compute(key, signature) {\n  \t\tvar computation = new Computation(this, signature, key);\n  \t\tthis.computations[key] = computation;\n\n  \t\treturn computation;\n  \t};\n\n  \tRootModel.prototype.get = function get(shouldCapture) {\n  \t\tvar _this = this;\n\n  \t\tif (shouldCapture) capture(this);\n  \t\tvar result = __extend({}, this.value);\n\n  \t\tObject.keys(this.mappings).forEach(function (key) {\n  \t\t\tresult[key] = _this.mappings[key].value;\n  \t\t});\n\n  \t\tObject.keys(this.computations).forEach(function (key) {\n  \t\t\tif (key[0] !== '@') {\n  \t\t\t\t// exclude template expressions\n  \t\t\t\tresult[key] = _this.computations[key].value;\n  \t\t\t}\n  \t\t});\n\n  \t\treturn result;\n  \t};\n\n  \tRootModel.prototype.getKeypath = function getKeypath() {\n  \t\treturn '';\n  \t};\n\n  \tRootModel.prototype.has = function has(key) {\n  \t\treturn key in this.mappings || key in this.computations || _Model.prototype.has.call(this, key);\n  \t};\n\n  \tRootModel.prototype.joinKey = function joinKey(key) {\n  \t\treturn this.mappings.hasOwnProperty(key) ? this.mappings[key] : this.computations.hasOwnProperty(key) ? this.computations[key] : _Model.prototype.joinKey.call(this, key);\n  \t};\n\n  \tRootModel.prototype.map = function map(localKey, origin) {\n  \t\t// TODO remapping\n  \t\tthis.mappings[localKey] = origin;\n  \t};\n\n  \tRootModel.prototype.set = function set(value) {\n  \t\t// TODO wrapping root node is a baaaad idea. We should prevent this\n  \t\tvar wrapper = this.wrapper;\n  \t\tif (wrapper) {\n  \t\t\tvar shouldTeardown = !wrapper.reset || wrapper.reset(value) === false;\n\n  \t\t\tif (shouldTeardown) {\n  \t\t\t\twrapper.teardown();\n  \t\t\t\tthis.wrapper = null;\n  \t\t\t\tthis.value = value;\n  \t\t\t\tthis.adapt();\n  \t\t\t}\n  \t\t} else {\n  \t\t\tthis.value = value;\n  \t\t\tthis.adapt();\n  \t\t}\n\n  \t\tthis.deps.forEach(_handleChange);\n  \t\tthis.children.forEach(_mark);\n  \t\tthis.clearUnresolveds(); // TODO do we need to do this with primitive values? if not, what about e.g. unresolved `length` property of null -> string?\n  \t};\n\n  \tRootModel.prototype.retrieve = function retrieve() {\n  \t\treturn this.value;\n  \t};\n\n  \tRootModel.prototype.update = function update() {\n  \t\t// noop\n  \t};\n\n  \tRootModel.prototype.updateFromBindings = function updateFromBindings(cascade) {\n  \t\tvar _this2 = this;\n\n  \t\t_Model.prototype.updateFromBindings.call(this, cascade);\n\n  \t\tif (cascade) {\n  \t\t\t// TODO computations as well?\n  \t\t\tObject.keys(this.mappings).forEach(function (key) {\n  \t\t\t\tvar model = _this2.mappings[key];\n  \t\t\t\tmodel.updateFromBindings(cascade);\n  \t\t\t});\n  \t\t}\n  \t};\n\n  \treturn RootModel;\n  })(Model);\n\n  function processWrapper (wrapper, array, methodName, newIndices) {\n  \tvar __model = wrapper.__model;\n\n  \tif (newIndices) {\n  \t\t__model.shuffle(newIndices);\n  \t} else {\n  \t\t// If this is a sort or reverse, we just do root.set()...\n  \t\t// TODO use merge logic?\n  \t\t//root.viewmodel.mark( keypath );\n  \t}\n  }\n\n  var mutatorMethods = ['pop', 'push', 'reverse', 'shift', 'sort', 'splice', 'unshift'];\n  var patchedArrayProto = [];\n\n  mutatorMethods.forEach(function (methodName) {\n  \tvar method = function () {\n  \t\tfor (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n  \t\t\targs[_key] = arguments[_key];\n  \t\t}\n\n  \t\tvar newIndices = getNewIndices(this.length, methodName, args);\n\n  \t\t// apply the underlying method\n  \t\tvar result = Array.prototype[methodName].apply(this, arguments);\n\n  \t\t// trigger changes\n  \t\trunloop.start();\n\n  \t\tthis._ractive.setting = true;\n  \t\tvar i = this._ractive.wrappers.length;\n  \t\twhile (i--) {\n  \t\t\tprocessWrapper(this._ractive.wrappers[i], this, methodName, newIndices);\n  \t\t}\n\n  \t\trunloop.end();\n\n  \t\tthis._ractive.setting = false;\n  \t\treturn result;\n  \t};\n\n  \tdefineProperty(patchedArrayProto, methodName, {\n  \t\tvalue: method\n  \t});\n  });\n\n  var patchArrayMethods = undefined;\n  var unpatchArrayMethods = undefined;\n\n  // can we use prototype chain injection?\n  // http://perfectionkills.com/how-ecmascript-5-still-does-not-allow-to-subclass-an-array/#wrappers_prototype_chain_injection\n  if (({}).__proto__) {\n  \t// yes, we can\n  \tpatchArrayMethods = function (array) {\n  \t\treturn array.__proto__ = patchedArrayProto;\n  \t};\n  \tunpatchArrayMethods = function (array) {\n  \t\treturn array.__proto__ = Array.prototype;\n  \t};\n  } else {\n  \t// no, we can't\n  \tpatchArrayMethods = function (array) {\n  \t\tvar i = mutatorMethods.length;\n  \t\twhile (i--) {\n  \t\t\tvar methodName = mutatorMethods[i];\n  \t\t\tdefineProperty(array, methodName, {\n  \t\t\t\tvalue: patchedArrayProto[methodName],\n  \t\t\t\tconfigurable: true\n  \t\t\t});\n  \t\t}\n  \t};\n\n  \tunpatchArrayMethods = function (array) {\n  \t\tvar i = mutatorMethods.length;\n  \t\twhile (i--) {\n  \t\t\tdelete array[mutatorMethods[i]];\n  \t\t}\n  \t};\n  }\n\n  patchArrayMethods.unpatch = unpatchArrayMethods;\n\n  var errorMessage = 'Something went wrong in a rather interesting way';\n\n  var arrayAdaptor = {\n  \tfilter: function (object) {\n  \t\t// wrap the array if a) b) it's an array, and b) either it hasn't been wrapped already,\n  \t\t// or the array didn't trigger the get() itself\n  \t\treturn isArray(object) && (!object._ractive || !object._ractive.setting);\n  \t},\n  \twrap: function (ractive, array, keypath) {\n  \t\treturn new ArrayWrapper(ractive, array, keypath);\n  \t}\n  };\n\n  var ArrayWrapper = (function () {\n  \tfunction ArrayWrapper(ractive, array) {\n  \t\tclassCallCheck(this, ArrayWrapper);\n\n  \t\tthis.root = ractive;\n  \t\tthis.value = array;\n  \t\tthis.__model = null; // filled in later\n\n  \t\t// if this array hasn't already been ractified, ractify it\n  \t\tif (!array._ractive) {\n  \t\t\t// define a non-enumerable _ractive property to store the wrappers\n  \t\t\tdefineProperty(array, '_ractive', {\n  \t\t\t\tvalue: {\n  \t\t\t\t\twrappers: [],\n  \t\t\t\t\tinstances: [],\n  \t\t\t\t\tsetting: false\n  \t\t\t\t},\n  \t\t\t\tconfigurable: true\n  \t\t\t});\n\n  \t\t\tpatchArrayMethods(array);\n  \t\t}\n\n  \t\t// store the ractive instance, so we can handle transitions later\n  \t\tif (!array._ractive.instances[ractive._guid]) {\n  \t\t\tarray._ractive.instances[ractive._guid] = 0;\n  \t\t\tarray._ractive.instances.push(ractive);\n  \t\t}\n\n  \t\tarray._ractive.instances[ractive._guid] += 1;\n  \t\tarray._ractive.wrappers.push(this);\n  \t}\n\n  \tArrayWrapper.prototype.get = function get() {\n  \t\treturn this.value;\n  \t};\n\n  \tArrayWrapper.prototype.teardown = function teardown() {\n  \t\tvar array, storage, wrappers, instances, index;\n\n  \t\tarray = this.value;\n  \t\tstorage = array._ractive;\n  \t\twrappers = storage.wrappers;\n  \t\tinstances = storage.instances;\n\n  \t\t// if teardown() was invoked because we're clearing the cache as a result of\n  \t\t// a change that the array itself triggered, we can save ourselves the teardown\n  \t\t// and immediate setup\n  \t\tif (storage.setting) {\n  \t\t\treturn false; // so that we don't remove it from cached wrappers\n  \t\t}\n\n  \t\tindex = wrappers.indexOf(this);\n  \t\tif (index === -1) {\n  \t\t\tthrow new Error(errorMessage);\n  \t\t}\n\n  \t\twrappers.splice(index, 1);\n\n  \t\t// if nothing else depends on this array, we can revert it to its\n  \t\t// natural state\n  \t\tif (!wrappers.length) {\n  \t\t\tdelete array._ractive;\n  \t\t\tpatchArrayMethods.unpatch(this.value);\n  \t\t} else {\n  \t\t\t// remove ractive instance if possible\n  \t\t\tinstances[this.root._guid] -= 1;\n  \t\t\tif (!instances[this.root._guid]) {\n  \t\t\t\tindex = instances.indexOf(this.root);\n\n  \t\t\t\tif (index === -1) {\n  \t\t\t\t\tthrow new Error(errorMessage);\n  \t\t\t\t}\n\n  \t\t\t\tinstances.splice(index, 1);\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \treturn ArrayWrapper;\n  })();\n\n  var magicAdaptor = undefined;\n\n  try {\n  \tObject.defineProperty({}, 'test', { value: 0 });\n\n  \tmagicAdaptor = {\n  \t\tfilter: function (value) {\n  \t\t\treturn value && typeof value === 'object';\n  \t\t},\n  \t\twrap: function (ractive, value, keypath) {\n  \t\t\treturn new MagicWrapper(ractive, value, keypath);\n  \t\t}\n  \t};\n  } catch (err) {\n  \tmagicAdaptor = false;\n  }\n\n  function createOrWrapDescriptor(originalDescriptor, ractive, keypath) {\n  \tif (originalDescriptor.set && originalDescriptor.set.__magic) {\n  \t\toriginalDescriptor.set.__magic.dependants.push({ ractive: ractive, keypath: keypath });\n  \t\treturn originalDescriptor;\n  \t}\n\n  \tvar setting = undefined;\n\n  \tvar dependants = [{ ractive: ractive, keypath: keypath }];\n\n  \tvar descriptor = {\n  \t\tget: function () {\n  \t\t\treturn 'value' in originalDescriptor ? originalDescriptor.value : originalDescriptor.get();\n  \t\t},\n  \t\tset: function (value) {\n  \t\t\tif (setting) return;\n\n  \t\t\tif ('value' in originalDescriptor) {\n  \t\t\t\toriginalDescriptor.value = value;\n  \t\t\t} else {\n  \t\t\t\toriginalDescriptor.set(value);\n  \t\t\t}\n\n  \t\t\tsetting = true;\n  \t\t\tdependants.forEach(function (_ref) {\n  \t\t\t\tvar ractive = _ref.ractive;\n  \t\t\t\tvar keypath = _ref.keypath;\n\n  \t\t\t\tractive.set(keypath, value);\n  \t\t\t});\n  \t\t\tsetting = false;\n  \t\t},\n  \t\tenumerable: true\n  \t};\n\n  \tdescriptor.set.__magic = { dependants: dependants, originalDescriptor: originalDescriptor };\n\n  \treturn descriptor;\n  }\n\n  function revert(descriptor, ractive, keypath) {\n  \tif (!descriptor.set || !descriptor.set.__magic) return true;\n\n  \tvar dependants = descriptor.set.__magic;\n  \tvar i = dependants.length;\n  \twhile (i--) {\n  \t\tvar dependant = dependants[i];\n  \t\tif (dependant.ractive === ractive && dependant.keypath === keypath) {\n  \t\t\tdependants.splice(i, 1);\n  \t\t\treturn false;\n  \t\t}\n  \t}\n  }\n\n  var MagicWrapper = (function () {\n  \tfunction MagicWrapper(ractive, value, keypath) {\n  \t\tvar _this = this;\n\n  \t\tclassCallCheck(this, MagicWrapper);\n\n  \t\tthis.ractive = ractive;\n  \t\tthis.value = value;\n  \t\tthis.keypath = keypath;\n\n  \t\tthis.originalDescriptors = {};\n\n  \t\t// wrap all properties with getters\n  \t\tObject.keys(value).forEach(function (key) {\n  \t\t\tvar originalDescriptor = Object.getOwnPropertyDescriptor(_this.value, key);\n  \t\t\t_this.originalDescriptors[key] = originalDescriptor;\n\n  \t\t\tvar childKeypath = keypath ? keypath + '.' + key : key;\n\n  \t\t\tvar descriptor = createOrWrapDescriptor(originalDescriptor, ractive, childKeypath);\n\n  \t\t\tObject.defineProperty(_this.value, key, descriptor);\n  \t\t});\n  \t}\n\n  \tMagicWrapper.prototype.get = function get() {\n  \t\treturn this.value;\n  \t};\n\n  \tMagicWrapper.prototype.reset = function reset() {\n  \t\tthrow new Error('TODO magic adaptor reset'); // does this ever happen?\n  \t};\n\n  \tMagicWrapper.prototype.set = function set(key, value) {\n  \t\tthis.value[key] = value;\n  \t};\n\n  \tMagicWrapper.prototype.teardown = function teardown() {\n  \t\tvar _this2 = this;\n\n  \t\tObject.keys(this.value).forEach(function (key) {\n  \t\t\tvar descriptor = Object.getOwnPropertyDescriptor(_this2.value, key);\n  \t\t\tif (!descriptor.set || !descriptor.set.__magic) return;\n\n  \t\t\trevert(descriptor);\n\n  \t\t\tif (descriptor.set.__magic.dependants.length === 1) {\n  \t\t\t\tObject.defineProperty(_this2.value, key, descriptor.set.__magic.originalDescriptor);\n  \t\t\t}\n  \t\t});\n  \t};\n\n  \treturn MagicWrapper;\n  })();\n\n  var MagicArrayWrapper = (function () {\n  \tfunction MagicArrayWrapper(ractive, array, keypath) {\n  \t\tclassCallCheck(this, MagicArrayWrapper);\n\n  \t\tthis.value = array;\n\n  \t\tthis.magic = true;\n\n  \t\tthis.magicWrapper = magicAdaptor.wrap(ractive, array, keypath);\n  \t\tthis.arrayWrapper = arrayAdaptor.wrap(ractive, array, keypath);\n\n  \t\t// ugh, this really is a terrible hack\n  \t\tObject.defineProperty(this, '__model', {\n  \t\t\tget: function () {\n  \t\t\t\treturn this.arrayWrapper.__model;\n  \t\t\t},\n  \t\t\tset: function (model) {\n  \t\t\t\tthis.arrayWrapper.__model = model;\n  \t\t\t}\n  \t\t});\n  \t}\n\n  \tMagicArrayWrapper.prototype.get = function get() {\n  \t\treturn this.value;\n  \t};\n\n  \tMagicArrayWrapper.prototype.teardown = function teardown() {\n  \t\tthis.arrayWrapper.teardown();\n  \t\tthis.magicWrapper.teardown();\n  \t};\n\n  \tMagicArrayWrapper.prototype.reset = function reset(value) {\n  \t\treturn this.magicWrapper.reset(value);\n  \t};\n\n  \treturn MagicArrayWrapper;\n  })();\n\n  var magicArrayAdaptor = {\n  \tfilter: function (object, keypath, ractive) {\n  \t\treturn magicAdaptor.filter(object, keypath, ractive) && arrayAdaptor.filter(object);\n  \t},\n\n  \twrap: function (ractive, array, keypath) {\n  \t\treturn new MagicArrayWrapper(ractive, array, keypath);\n  \t}\n  };\n\n  var constructHook = new Hook('construct');\n\n  var registryNames = ['adaptors', 'components', 'decorators', 'easing', 'events', 'interpolators', 'partials', 'transitions'];\n\n  var uid = 0;\n  function construct(ractive, options) {\n  \tif (Ractive.DEBUG) welcome();\n\n  \tinitialiseProperties(ractive);\n\n  \t// TODO remove this, eventually\n  \tdefineProperty(ractive, 'data', { get: deprecateRactiveData });\n\n  \t// TODO don't allow `onconstruct` with `new Ractive()`, there's no need for it\n  \tconstructHook.fire(ractive, options);\n\n  \t// Add registries\n  \tregistryNames.forEach(function (name) {\n  \t\tractive[name] = __extend(create(ractive.constructor[name] || null), options[name]);\n  \t});\n\n  \t// Create a viewmodel\n  \tvar viewmodel = new RootModel({\n  \t\tadapt: getAdaptors(ractive, ractive.adapt, options),\n  \t\tdata: dataConfigurator.init(ractive.constructor, ractive, options),\n  \t\tractive: ractive\n  \t});\n\n  \tractive.viewmodel = viewmodel;\n\n  \t// Add computed properties\n  \tvar computed = __extend(create(ractive.constructor.prototype.computed), options.computed);\n\n  \tfor (var key in computed) {\n  \t\tvar signature = getComputationSignature(ractive, key, computed[key]);\n  \t\tviewmodel.compute(key, signature);\n  \t}\n  }\n\n  function combine(a, b) {\n  \tvar c = a.slice();\n  \tvar i = b.length;\n\n  \twhile (i--) {\n  \t\tif (! ~c.indexOf(b[i])) {\n  \t\t\tc.push(b[i]);\n  \t\t}\n  \t}\n\n  \treturn c;\n  }\n\n  function getAdaptors(ractive, protoAdapt, options) {\n  \tprotoAdapt = protoAdapt.map(lookup);\n  \tvar adapt = ensureArray(options.adapt).map(lookup);\n\n  \tadapt = combine(protoAdapt, adapt);\n\n  \tvar magic$$ = 'magic' in options ? options.magic : ractive.magic;\n  \tvar modifyArrays = 'modifyArrays' in options ? options.modifyArrays : ractive.modifyArrays;\n\n  \tif (magic$$) {\n  \t\tif (!magic) {\n  \t\t\tthrow new Error('Getters and setters (magic mode) are not supported in this browser');\n  \t\t}\n\n  \t\tif (modifyArrays) {\n  \t\t\tadapt.push(magicArrayAdaptor);\n  \t\t}\n\n  \t\tadapt.push(magicAdaptor);\n  \t}\n\n  \tif (modifyArrays) {\n  \t\tadapt.push(arrayAdaptor);\n  \t}\n\n  \treturn adapt;\n\n  \tfunction lookup(adaptor) {\n  \t\tif (typeof adaptor === 'string') {\n  \t\t\tadaptor = findInViewHierarchy('adaptors', ractive, adaptor);\n\n  \t\t\tif (!adaptor) {\n  \t\t\t\tfatal(missingPlugin(adaptor, 'adaptor'));\n  \t\t\t}\n  \t\t}\n\n  \t\treturn adaptor;\n  \t}\n  }\n\n  function initialiseProperties(ractive) {\n  \t// Generate a unique identifier, for places where you'd use a weak map if it\n  \t// existed\n  \tractive._guid = 'r-' + uid++;\n\n  \t// events\n  \tractive._subs = create(null);\n\n  \t// storage for item configuration from instantiation to reset,\n  \t// like dynamic functions or original values\n  \tractive._config = {};\n\n  \t// nodes registry\n  \tractive.nodes = {};\n\n  \t// events\n  \tractive.event = null;\n  \tractive._eventQueue = [];\n\n  \t// live queries\n  \tractive._liveQueries = [];\n  \tractive._liveComponentQueries = [];\n\n  \t// observers\n  \tractive._observers = [];\n\n  \tif (!ractive.component) {\n  \t\tractive.root = ractive;\n  \t\tractive.parent = ractive.container = null; // TODO container still applicable?\n  \t}\n  }\n\n  function deprecateRactiveData() {\n  \tthrow new Error('Using `ractive.data` is no longer supported - you must use the `ractive.get()` API instead');\n  }\n\n  function removeFromLiveComponentQueries(component) {\n  \tvar instance = component.ractive;\n\n  \twhile (instance) {\n  \t\tvar query = instance._liveComponentQueries['_' + component.name];\n  \t\tif (query) query.remove(component);\n\n  \t\tinstance = instance.parent;\n  \t}\n  }\n\n  function _makeDirty(query) {\n  \tquery.makeDirty();\n  }\n\n  var teardownHook = new Hook('teardown');\n\n  var Component = (function (_Item) {\n  \tinherits(Component, _Item);\n\n  \tfunction Component(options, ComponentConstructor) {\n  \t\tclassCallCheck(this, Component);\n\n  \t\t_Item.call(this, options);\n  \t\tthis.type = COMPONENT; // override ELEMENT from super\n\n  \t\tvar instance = create(ComponentConstructor.prototype);\n\n  \t\tthis.instance = instance;\n  \t\tthis.name = options.template.e;\n  \t\tthis.parentFragment = options.parentFragment;\n  \t\tthis.complexMappings = [];\n\n  \t\tthis.liveQueries = [];\n\n  \t\tif (instance.el) {\n  \t\t\twarnIfDebug('The <' + this.name + '> component has a default \\'el\\' property; it has been disregarded');\n  \t\t}\n\n  \t\tvar partials = options.template.p || {};\n  \t\tif (!('content' in partials)) partials.content = options.template.f || [];\n  \t\tthis._partials = partials; // TEMP\n\n  \t\tthis.yielders = {};\n\n  \t\t// find container\n  \t\tvar fragment = options.parentFragment;\n  \t\tvar container = undefined;\n  \t\twhile (fragment) {\n  \t\t\tif (fragment.owner.type === YIELDER) {\n  \t\t\t\tcontainer = fragment.owner.container;\n  \t\t\t\tbreak;\n  \t\t\t}\n\n  \t\t\tfragment = fragment.parent;\n  \t\t}\n\n  \t\t// add component-instance-specific properties\n  \t\tinstance.parent = this.parentFragment.ractive;\n  \t\tinstance.container = container || null;\n  \t\tinstance.root = instance.parent.root;\n  \t\tinstance.component = this;\n\n  \t\tconstruct(this.instance, { partials: partials });\n\n  \t\t// for hackability, this could be an open option\n  \t\t// for any ractive instance, but for now, just\n  \t\t// for components and just for ractive...\n  \t\tinstance._inlinePartials = partials;\n\n  \t\tthis.eventHandlers = [];\n  \t\tif (this.template.v) this.setupEvents();\n  \t}\n\n  \tComponent.prototype.bind = function bind() {\n  \t\tvar _this = this;\n\n  \t\tvar viewmodel = this.instance.viewmodel;\n  \t\tvar childData = viewmodel.value;\n\n  \t\t// determine mappings\n  \t\tif (this.template.a) {\n  \t\t\tObject.keys(this.template.a).forEach(function (localKey) {\n  \t\t\t\tvar template = _this.template.a[localKey];\n  \t\t\t\tvar model = undefined;\n  \t\t\t\tvar fragment = undefined;\n\n  \t\t\t\tif (template === 0) {\n  \t\t\t\t\t// empty attributes are `true`\n  \t\t\t\t\tviewmodel.joinKey(localKey).set(true);\n  \t\t\t\t} else if (typeof template === 'string') {\n  \t\t\t\t\tvar parsed = parseJSON(template);\n  \t\t\t\t\tviewmodel.joinKey(localKey).set(parsed ? parsed.value : template);\n  \t\t\t\t} else if (isArray(template)) {\n  \t\t\t\t\tif (template.length === 1 && template[0].t === INTERPOLATOR) {\n  \t\t\t\t\t\tmodel = _resolve(_this.parentFragment, template[0]);\n\n  \t\t\t\t\t\tif (!model) {\n  \t\t\t\t\t\t\twarnOnceIfDebug('The ' + localKey + '=\\'{{' + template[0].r + '}}\\' mapping is ambiguous, and may cause unexpected results. Consider initialising your data to eliminate the ambiguity', { ractive: _this.instance }); // TODO add docs page explaining this\n  \t\t\t\t\t\t\t_this.parentFragment.ractive.get(localKey); // side-effect: create mappings as necessary\n  \t\t\t\t\t\t\tmodel = _this.parentFragment.findContext().joinKey(localKey);\n  \t\t\t\t\t\t}\n\n  \t\t\t\t\t\tviewmodel.map(localKey, model);\n\n  \t\t\t\t\t\tif (model.get() === undefined && localKey in childData) {\n  \t\t\t\t\t\t\tmodel.set(childData[localKey]);\n  \t\t\t\t\t\t}\n  \t\t\t\t\t} else {\n  \t\t\t\t\t\tfragment = new Fragment({\n  \t\t\t\t\t\t\towner: _this,\n  \t\t\t\t\t\t\ttemplate: template\n  \t\t\t\t\t\t}).bind();\n\n  \t\t\t\t\t\tmodel = viewmodel.joinKey(localKey);\n  \t\t\t\t\t\tmodel.set(fragment.valueOf());\n\n  \t\t\t\t\t\t// this is a *bit* of a hack\n  \t\t\t\t\t\tfragment.bubble = function () {\n  \t\t\t\t\t\t\tFragment.prototype.bubble.call(fragment);\n  \t\t\t\t\t\t\tmodel.set(fragment.valueOf());\n  \t\t\t\t\t\t};\n\n  \t\t\t\t\t\t_this.complexMappings.push(fragment);\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t\t});\n  \t\t}\n\n  \t\tinitialise(this.instance, {\n  \t\t\tpartials: this._partials\n  \t\t}, {\n  \t\t\tindexRefs: this.instance.isolated ? {} : this.parentFragment.indexRefs,\n  \t\t\tkeyRefs: this.instance.isolated ? {} : this.parentFragment.keyRefs,\n  \t\t\tcssIds: this.parentFragment.cssIds\n  \t\t});\n\n  \t\tthis.eventHandlers.forEach(__bind);\n  \t};\n\n  \tComponent.prototype.bubble = function bubble() {\n  \t\tif (!this.dirty) {\n  \t\t\tthis.dirty = true;\n  \t\t\tthis.parentFragment.bubble();\n  \t\t}\n  \t};\n\n  \tComponent.prototype.checkYielders = function checkYielders() {\n  \t\tvar _this2 = this;\n\n  \t\tObject.keys(this.yielders).forEach(function (name) {\n  \t\t\tif (_this2.yielders[name].length > 1) {\n  \t\t\t\trunloop.end();\n  \t\t\t\tthrow new Error('A component template can only have one {{yield' + (name ? ' ' + name : '') + '}} declaration at a time');\n  \t\t\t}\n  \t\t});\n  \t};\n\n  \tComponent.prototype.detach = function detach() {\n  \t\treturn this.instance.fragment.detach();\n  \t};\n\n  \tComponent.prototype.find = function find(selector) {\n  \t\treturn this.instance.fragment.find(selector);\n  \t};\n\n  \tComponent.prototype.findAll = function findAll(selector, query) {\n  \t\tthis.instance.fragment.findAll(selector, query);\n  \t};\n\n  \tComponent.prototype.findComponent = function findComponent(name) {\n  \t\tif (!name || this.name === name) return this.instance;\n\n  \t\tif (this.instance.fragment) {\n  \t\t\treturn this.instance.fragment.findComponent(name);\n  \t\t}\n  \t};\n\n  \tComponent.prototype.findAllComponents = function findAllComponents(name, query) {\n  \t\tif (query.test(this)) {\n  \t\t\tquery.add(this.instance);\n\n  \t\t\tif (query.live) {\n  \t\t\t\tthis.liveQueries.push(query);\n  \t\t\t}\n  \t\t}\n\n  \t\tthis.instance.fragment.findAllComponents(name, query);\n  \t};\n\n  \tComponent.prototype.firstNode = function firstNode() {\n  \t\treturn this.instance.fragment.firstNode();\n  \t};\n\n  \tComponent.prototype.rebind = function rebind() {\n  \t\tvar _this3 = this;\n\n  \t\tthis.complexMappings.forEach(_rebind);\n\n  \t\tthis.liveQueries.forEach(_makeDirty);\n\n  \t\t// update relevant mappings\n  \t\tvar viewmodel = this.instance.viewmodel;\n  \t\tviewmodel.mappings = {};\n\n  \t\tif (this.template.a) {\n  \t\t\tObject.keys(this.template.a).forEach(function (localKey) {\n  \t\t\t\tvar template = _this3.template.a[localKey];\n  \t\t\t\tvar model = undefined;\n\n  \t\t\t\tif (isArray(template) && template.length === 1 && template[0].t === INTERPOLATOR) {\n  \t\t\t\t\tmodel = _resolve(_this3.parentFragment, template[0]);\n\n  \t\t\t\t\tif (!model) {\n  \t\t\t\t\t\t// TODO is this even possible?\n  \t\t\t\t\t\twarnOnceIfDebug('The ' + localKey + '=\\'{{' + template[0].r + '}}\\' mapping is ambiguous, and may cause unexpected results. Consider initialising your data to eliminate the ambiguity', { ractive: _this3.instance });\n  \t\t\t\t\t\t_this3.parentFragment.ractive.get(localKey); // side-effect: create mappings as necessary\n  \t\t\t\t\t\tmodel = _this3.parentFragment.findContext().joinKey(localKey);\n  \t\t\t\t\t}\n\n  \t\t\t\t\tviewmodel.map(localKey, model);\n  \t\t\t\t}\n  \t\t\t});\n  \t\t}\n\n  \t\tthis.instance.fragment.rebind(viewmodel);\n  \t};\n\n  \tComponent.prototype.render = function render(target) {\n  \t\t_render(this.instance, target, null);\n\n  \t\tthis.checkYielders();\n  \t\tthis.eventHandlers.forEach(__render);\n  \t\tupdateLiveQueries(this);\n\n  \t\tthis.rendered = true;\n  \t};\n\n  \tComponent.prototype.setupEvents = function setupEvents() {\n  \t\tvar _this4 = this;\n\n  \t\tvar handlers = this.eventHandlers;\n\n  \t\tObject.keys(this.template.v).forEach(function (key) {\n  \t\t\tvar eventNames = key.split('-');\n  \t\t\tvar template = _this4.template.v[key];\n\n  \t\t\teventNames.forEach(function (eventName) {\n  \t\t\t\tvar event = new RactiveEvent(_this4.instance, eventName);\n  \t\t\t\thandlers.push(new EventDirective(_this4, event, template));\n  \t\t\t});\n  \t\t});\n  \t};\n\n  \tComponent.prototype.toString = function toString() {\n  \t\treturn this.instance.toHTML();\n  \t};\n\n  \tComponent.prototype.unbind = function unbind() {\n  \t\tthis.complexMappings.forEach(_unbind);\n\n  \t\tvar instance = this.instance;\n  \t\tinstance.viewmodel.teardown();\n  \t\tinstance.fragment.unbind();\n  \t\tinstance._observers.forEach(_cancel);\n\n  \t\tremoveFromLiveComponentQueries(this);\n\n  \t\tif (instance.fragment.rendered && instance.el.__ractive_instances__) {\n  \t\t\tremoveFromArray(instance.el.__ractive_instances__, instance);\n  \t\t}\n\n  \t\tteardownHook.fire(instance);\n  \t};\n\n  \tComponent.prototype.unrender = function unrender(shouldDestroy) {\n  \t\tvar _this5 = this;\n\n  \t\tthis.shouldDestroy = shouldDestroy;\n  \t\tthis.instance.unrender();\n  \t\tthis.eventHandlers.forEach(_unrender);\n  \t\tthis.liveQueries.forEach(function (query) {\n  \t\t\treturn query.remove(_this5.instance);\n  \t\t});\n  \t};\n\n  \tComponent.prototype.update = function update() {\n  \t\tthis.instance.fragment.update();\n  \t\tthis.checkYielders();\n  \t\tthis.eventHandlers.forEach(__update);\n  \t\tthis.dirty = false;\n  \t};\n\n  \treturn Component;\n  })(Item);\n\n  // finds the component constructor in the registry or view hierarchy registries\n\n  function getComponentConstructor(ractive, name) {\n  \tvar instance = findInstance('components', ractive, name);\n  \tvar Component = undefined;\n\n  \tif (instance) {\n  \t\tComponent = instance.components[name];\n\n  \t\t// best test we have for not Ractive.extend\n  \t\tif (!Component._Parent) {\n  \t\t\t// function option, execute and store for reset\n  \t\t\tvar fn = Component.bind(instance);\n  \t\t\tfn.isOwner = instance.components.hasOwnProperty(name);\n  \t\t\tComponent = fn();\n\n  \t\t\tif (!Component) {\n  \t\t\t\twarnIfDebug(noRegistryFunctionReturn, name, 'component', 'component', { ractive: ractive });\n  \t\t\t\treturn;\n  \t\t\t}\n\n  \t\t\tif (typeof Component === 'string') {\n  \t\t\t\t// allow string lookup\n  \t\t\t\tComponent = getComponentConstructor(ractive, Component);\n  \t\t\t}\n\n  \t\t\tComponent._fn = fn;\n  \t\t\tinstance.components[name] = Component;\n  \t\t}\n  \t}\n\n  \treturn Component;\n  }\n\n  var Text = (function (_Item) {\n  \tinherits(Text, _Item);\n\n  \tfunction Text(options) {\n  \t\tclassCallCheck(this, Text);\n\n  \t\t_Item.call(this, options);\n  \t\tthis.type = TEXT;\n  \t}\n\n  \tText.prototype.bind = function bind() {\n  \t\t// noop\n  \t};\n\n  \tText.prototype.detach = function detach() {\n  \t\treturn detachNode(this.node);\n  \t};\n\n  \tText.prototype.firstNode = function firstNode() {\n  \t\treturn this.node;\n  \t};\n\n  \tText.prototype.rebind = function rebind() {\n  \t\t// noop\n  \t};\n\n  \tText.prototype.render = function render(target) {\n  \t\tthis.node = doc.createTextNode(this.template);\n  \t\ttarget.appendChild(this.node);\n  \t\tthis.rendered = true;\n  \t};\n\n  \tText.prototype.toString = function toString(escape) {\n  \t\treturn escape ? escapeHtml(this.template) : this.template;\n  \t};\n\n  \tText.prototype.unbind = function unbind() {\n  \t\t// noop\n  \t};\n\n  \tText.prototype.unrender = function unrender(shouldDestroy) {\n  \t\tif (this.rendered && shouldDestroy) this.detach();\n  \t\tthis.rendered = false;\n  \t};\n\n  \tText.prototype.update = function update() {\n  \t\t// noop\n  \t};\n\n  \tText.prototype.valueOf = function valueOf() {\n  \t\treturn this.template;\n  \t};\n\n  \treturn Text;\n  })(Item);\n\n  var constructors = {};\n  constructors[DOCTYPE] = Doctype;\n  constructors[INTERPOLATOR] = Interpolator;\n  constructors[PARTIAL] = Partial;\n  constructors[SECTION] = Section;\n  constructors[TRIPLE] = Triple;\n  constructors[YIELDER] = Yielder;\n\n  var specialElements = {\n  \tdoctype: Doctype,\n  \tform: Form,\n  \tinput: Input,\n  \toption: Option,\n  \tselect: Select,\n  \ttextarea: Textarea\n  };\n  function createItem(options) {\n  \tif (typeof options.template === 'string') {\n  \t\treturn new Text(options);\n  \t}\n\n  \tif (options.template.t === ELEMENT) {\n  \t\t// could be component or element\n  \t\tvar ComponentConstructor = getComponentConstructor(options.parentFragment.ractive, options.template.e);\n  \t\tif (ComponentConstructor) {\n  \t\t\treturn new Component(options, ComponentConstructor);\n  \t\t}\n\n  \t\tvar tagName = options.template.e.toLowerCase();\n\n  \t\tvar ElementConstructor = specialElements[tagName] || Element;\n  \t\treturn new ElementConstructor(options);\n  \t}\n\n  \tvar Item = constructors[options.template.t];\n\n  \tif (!Item) throw new Error('Unrecognised item type ' + options.template.t);\n\n  \treturn new Item(options);\n  }\n\n  function unrenderAndDestroy(item) {\n  \titem.unrender(true);\n  }\n\n  var Fragment = (function () {\n  \tfunction Fragment(options) {\n  \t\tclassCallCheck(this, Fragment);\n\n  \t\tthis.owner = options.owner; // The item that owns this fragment - an element, section, partial, or attribute\n\n  \t\tthis.isRoot = !options.owner.parentFragment;\n  \t\tthis.parent = this.isRoot ? null : this.owner.parentFragment;\n  \t\tthis.ractive = options.ractive || (this.isRoot ? options.owner : this.parent.ractive);\n\n  \t\tthis.componentParent = this.isRoot && this.ractive.component ? this.ractive.component.parentFragment : null;\n\n  \t\tthis.context = null;\n  \t\tthis.rendered = false;\n  \t\tthis.indexRefs = options.indexRefs || (this.parent ? this.parent.indexRefs : []);\n  \t\tthis.keyRefs = options.keyRefs || (this.parent ? this.parent.keyRefs : {});\n\n  \t\t// encapsulated styles should be inherited until they get applied by an element\n  \t\tthis.cssIds = 'cssIds' in options ? options.cssIds : this.parent ? this.parent.cssIds : null;\n\n  \t\tthis.resolvers = [];\n\n  \t\tthis.dirty = false;\n  \t\tthis.dirtyArgs = this.dirtyValue = true; // TODO getArgsList is nonsense - should deprecate legacy directives style\n\n  \t\tthis.template = options.template || [];\n  \t\tthis.createItems();\n  \t}\n\n  \tFragment.prototype.bind = function bind(context) {\n  \t\tthis.context = context;\n  \t\tthis.items.forEach(__bind);\n  \t\tthis.bound = true;\n\n  \t\t// in rare cases, a forced resolution (or similar) will cause the\n  \t\t// fragment to be dirty before it's even finished binding. In those\n  \t\t// cases we update immediately\n  \t\tif (this.dirty) this.update();\n\n  \t\treturn this;\n  \t};\n\n  \tFragment.prototype.bubble = function bubble() {\n  \t\tthis.dirtyArgs = this.dirtyValue = true;\n\n  \t\tif (!this.dirty) {\n  \t\t\tthis.dirty = true;\n\n  \t\t\tif (this.isRoot) {\n  \t\t\t\t// TODO encapsulate 'is component root, but not overall root' check?\n  \t\t\t\tif (this.ractive.component) {\n  \t\t\t\t\tthis.ractive.component.bubble();\n  \t\t\t\t} else if (this.bound) {\n  \t\t\t\t\trunloop.addFragment(this);\n  \t\t\t\t}\n  \t\t\t} else {\n  \t\t\t\tthis.owner.bubble();\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tFragment.prototype.createItems = function createItems() {\n  \t\tvar _this = this;\n\n  \t\tthis.items = this.template.map(function (template, index) {\n  \t\t\treturn createItem({ parentFragment: _this, template: template, index: index });\n  \t\t});\n  \t};\n\n  \tFragment.prototype.detach = function detach() {\n  \t\tvar docFrag = createDocumentFragment();\n  \t\tthis.items.forEach(function (item) {\n  \t\t\treturn docFrag.appendChild(item.detach());\n  \t\t});\n  \t\treturn docFrag;\n  \t};\n\n  \tFragment.prototype.find = function find(selector) {\n  \t\tvar len = this.items.length;\n  \t\tvar i = undefined;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tvar found = this.items[i].find(selector);\n  \t\t\tif (found) return found;\n  \t\t}\n  \t};\n\n  \tFragment.prototype.findAll = function findAll(selector, query) {\n  \t\tif (this.items) {\n  \t\t\tvar len = this.items.length;\n  \t\t\tvar i = undefined;\n\n  \t\t\tfor (i = 0; i < len; i += 1) {\n  \t\t\t\tvar item = this.items[i];\n\n  \t\t\t\tif (item.findAll) {\n  \t\t\t\t\titem.findAll(selector, query);\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\treturn query;\n  \t};\n\n  \tFragment.prototype.findComponent = function findComponent(name) {\n  \t\tvar len = this.items.length;\n  \t\tvar i = undefined;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tvar found = this.items[i].findComponent(name);\n  \t\t\tif (found) return found;\n  \t\t}\n  \t};\n\n  \tFragment.prototype.findAllComponents = function findAllComponents(name, query) {\n  \t\tif (this.items) {\n  \t\t\tvar len = this.items.length;\n  \t\t\tvar i = undefined;\n\n  \t\t\tfor (i = 0; i < len; i += 1) {\n  \t\t\t\tvar item = this.items[i];\n\n  \t\t\t\tif (item.findAllComponents) {\n  \t\t\t\t\titem.findAllComponents(name, query);\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\treturn query;\n  \t};\n\n  \tFragment.prototype.findContext = function findContext() {\n  \t\tvar fragment = this;\n  \t\twhile (!fragment.context) fragment = fragment.parent;\n  \t\treturn fragment.context;\n  \t};\n\n  \tFragment.prototype.findNextNode = function findNextNode(item) {\n  \t\tvar nextItem = this.items[item.index + 1];\n\n  \t\tif (nextItem) return nextItem.firstNode();\n\n  \t\t// if this is the root fragment, and there are no more items,\n  \t\t// it means we're at the end...\n  \t\tif (this.isRoot) {\n  \t\t\tif (this.ractive.component) {\n  \t\t\t\treturn this.ractive.component.parentFragment.findNextNode(this.ractive.component);\n  \t\t\t}\n\n  \t\t\t// TODO possible edge case with other content\n  \t\t\t// appended to this.ractive.el?\n  \t\t\treturn null;\n  \t\t}\n\n  \t\treturn this.owner.findNextNode(this); // the argument is in case the parent is a RepeatedFragment\n  \t};\n\n  \tFragment.prototype.findParentNode = function findParentNode() {\n  \t\tvar fragment = this;\n\n  \t\tdo {\n  \t\t\tif (fragment.owner.type === ELEMENT) {\n  \t\t\t\treturn fragment.owner.node;\n  \t\t\t}\n\n  \t\t\tif (fragment.isRoot && !fragment.ractive.component) {\n  \t\t\t\t// TODO encapsulate check\n  \t\t\t\treturn fragment.ractive.el;\n  \t\t\t}\n\n  \t\t\tfragment = fragment.componentParent || fragment.parent; // TODO ugh\n  \t\t} while (fragment);\n\n  \t\tthrow new Error('Could not find parent node'); // TODO link to issue tracker\n  \t};\n\n  \tFragment.prototype.findRepeatingFragment = function findRepeatingFragment() {\n  \t\tvar fragment = this;\n  \t\t// TODO better check than fragment.parent.iterations\n  \t\twhile (fragment.parent && !fragment.isIteration) {\n  \t\t\tfragment = fragment.parent || fragment.componentParent;\n  \t\t}\n\n  \t\treturn fragment;\n  \t};\n\n  \tFragment.prototype.firstNode = function firstNode() {\n  \t\treturn this.items[0] ? this.items[0].firstNode() : this.parent.findNextNode(this.owner);\n  \t};\n\n  \t// TODO ideally, this would be deprecated in favour of an\n  \t// expression-like approach\n\n  \tFragment.prototype.getArgsList = function getArgsList() {\n  \t\tif (this.dirtyArgs) {\n  \t\t\tvar values = {};\n  \t\t\tvar source = processItems(this.items, values, this.ractive._guid);\n  \t\t\tvar parsed = parseJSON('[' + source + ']', values);\n\n  \t\t\tthis.argsList = parsed ? parsed.value : [this.toString()];\n\n  \t\t\tthis.dirtyArgs = false;\n  \t\t}\n\n  \t\treturn this.argsList;\n  \t};\n\n  \tFragment.prototype.rebind = function rebind(context) {\n  \t\tthis.context = context;\n\n  \t\tthis.items.forEach(_rebind);\n  \t};\n\n  \tFragment.prototype.render = function render(target) {\n  \t\tif (this.rendered) throw new Error('Fragment is already rendered!');\n  \t\tthis.rendered = true;\n\n  \t\tthis.items.forEach(function (item) {\n  \t\t\treturn item.render(target);\n  \t\t});\n  \t};\n\n  \tFragment.prototype.resetTemplate = function resetTemplate(template) {\n  \t\tvar wasBound = this.bound;\n  \t\tvar wasRendered = this.rendered;\n\n  \t\t// TODO ensure transitions are disabled globally during reset\n\n  \t\tif (wasBound) {\n  \t\t\tif (wasRendered) this.unrender(true);\n  \t\t\tthis.unbind();\n  \t\t}\n\n  \t\tthis.template = template;\n  \t\tthis.createItems();\n\n  \t\tif (wasBound) {\n  \t\t\tthis.bind(this.context);\n\n  \t\t\tif (wasRendered) {\n  \t\t\t\tvar parentNode = this.findParentNode();\n  \t\t\t\tvar anchor = this.parent ? this.parent.findNextNode(this.owner) : null;\n\n  \t\t\t\tif (anchor) {\n  \t\t\t\t\tvar docFrag = createDocumentFragment();\n  \t\t\t\t\tthis.render(docFrag);\n  \t\t\t\t\tparentNode.insertBefore(docFrag, anchor);\n  \t\t\t\t} else {\n  \t\t\t\t\tthis.render(parentNode);\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tFragment.prototype.resolve = function resolve(template, callback) {\n  \t\tif (!this.context) {\n  \t\t\treturn this.parent.resolve(template, callback);\n  \t\t}\n\n  \t\tvar resolver = new ReferenceResolver(this, template, callback);\n  \t\tthis.resolvers.push(resolver);\n\n  \t\treturn resolver; // so we can e.g. force resolution\n  \t};\n\n  \tFragment.prototype.toHtml = function toHtml() {\n  \t\treturn this.toString();\n  \t};\n\n  \tFragment.prototype.toString = function toString(escape) {\n  \t\treturn this.items.map(escape ? toEscapedString : _toString).join('');\n  \t};\n\n  \tFragment.prototype.unbind = function unbind() {\n  \t\tthis.items.forEach(_unbind);\n  \t\tthis.bound = false;\n\n  \t\treturn this;\n  \t};\n\n  \tFragment.prototype.unrender = function unrender(shouldDestroy) {\n  \t\tthis.items.forEach(shouldDestroy ? unrenderAndDestroy : _unrender);\n  \t\tthis.rendered = false;\n  \t};\n\n  \tFragment.prototype.update = function update() {\n  \t\tif (this.dirty) {\n  \t\t\tthis.items.forEach(__update);\n  \t\t\tthis.dirty = false;\n  \t\t}\n  \t};\n\n  \tFragment.prototype.valueOf = function valueOf() {\n  \t\tif (this.items.length === 1) {\n  \t\t\treturn this.items[0].valueOf();\n  \t\t}\n\n  \t\tif (this.dirtyValue) {\n  \t\t\tvar values = {};\n  \t\t\tvar source = processItems(this.items, values, this.ractive._guid);\n  \t\t\tvar parsed = parseJSON(source, values);\n\n  \t\t\tthis.value = parsed ? parsed.value : this.toString();\n\n  \t\t\tthis.dirtyValue = false;\n  \t\t}\n\n  \t\treturn this.value;\n  \t};\n\n  \treturn Fragment;\n  })();\n\n  // TODO should resetTemplate be asynchronous? i.e. should it be a case\n  // of outro, update template, intro? I reckon probably not, since that\n  // could be achieved with unrender-resetTemplate-render. Also, it should\n  // conceptually be similar to resetPartial, which couldn't be async\n\n  function Ractive$resetTemplate(template) {\n  \ttemplateConfigurator.init(null, this, { template: template });\n\n  \tvar transitionsEnabled = this.transitionsEnabled;\n  \tthis.transitionsEnabled = false;\n\n  \t// Is this is a component, we need to set the `shouldDestroy`\n  \t// flag, otherwise it will assume by default that a parent node\n  \t// will be detached, and therefore it doesn't need to bother\n  \t// detaching its own nodes\n  \tvar component = this.component;\n  \tif (component) component.shouldDestroy = true;\n  \tthis.unrender();\n  \tif (component) component.shouldDestroy = false;\n\n  \t// remove existing fragment and create new one\n  \tthis.fragment.unbind();\n  \tthis.fragment = new Fragment({\n  \t\ttemplate: this.template,\n  \t\troot: this,\n  \t\towner: this\n  \t});\n  \tthis.fragment.bind(this.viewmodel);\n\n  \tthis.render(this.el, this.anchor);\n\n  \tthis.transitionsEnabled = transitionsEnabled;\n  }\n\n  function collect(source, name, dest) {\n  \tsource.forEach(function (item) {\n  \t\t// queue to rerender if the item is a partial and the current name matches\n  \t\tif (item.type === PARTIAL && item.name === name) {\n  \t\t\tdest.push(item);\n  \t\t\treturn; // go no further\n  \t\t}\n\n  \t\t// if it has a fragment, process its items\n  \t\tif (item.fragment) {\n  \t\t\tcollect(item.fragment.iterations || item.fragment.items, name, dest);\n  \t\t}\n\n  \t\t// or if it is itself a fragment, process its items\n  \t\telse if (isArray(item.items)) {\n  \t\t\t\tcollect(item.items, name, dest);\n  \t\t\t}\n\n  \t\t\t// or if it is a component, step in and process its items\n  \t\t\telse if (item.type === COMPONENT && item.instance) {\n  \t\t\t\t\t// ...unless the partial is shadowed\n  \t\t\t\t\tif (item.instance.partials[name]) return;\n  \t\t\t\t\tcollect(item.instance.fragment.items, name, dest);\n  \t\t\t\t}\n\n  \t\t// if the item is an element, process its attributes too\n  \t\tif (item.type === ELEMENT) {\n  \t\t\tif (isArray(item.attributes)) {\n  \t\t\t\tcollect(item.attributes, name, dest);\n  \t\t\t}\n\n  \t\t\tif (isArray(item.conditionalAttributes)) {\n  \t\t\t\tcollect(item.conditionalAttributes, name, dest);\n  \t\t\t}\n  \t\t}\n  \t});\n  }\n\n  function _forceResetTemplate(partial) {\n  \tpartial.forceResetTemplate();\n  }\n\n  function resetPartial (name, partial) {\n  \tvar collection = [];\n  \tcollect(this.fragment.items, name, collection);\n\n  \tvar promise = runloop.start(this, true);\n\n  \tthis.partials[name] = partial;\n  \tcollection.forEach(_forceResetTemplate);\n\n  \trunloop.end();\n\n  \treturn promise;\n  }\n\n  var shouldRerender = ['template', 'partials', 'components', 'decorators', 'events'];\n\n  var completeHook = new Hook('complete');\n  var resetHook = new Hook('reset');\n  var renderHook = new Hook('render');\n  var unrenderHook = new Hook('unrender');\n  function Ractive$reset(data) {\n  \tdata = data || {};\n\n  \tif (typeof data !== 'object') {\n  \t\tthrow new Error('The reset method takes either no arguments, or an object containing new data');\n  \t}\n\n  \t// TEMP need to tidy this up\n  \tdata = dataConfigurator.init(this.constructor, this, { data: data });\n\n  \tvar promise = runloop.start(this, true);\n\n  \t// If the root object is wrapped, try and use the wrapper's reset value\n  \tvar wrapper = this.viewmodel.wrapper;\n  \tif (wrapper && wrapper.reset) {\n  \t\tif (wrapper.reset(data) === false) {\n  \t\t\t// reset was rejected, we need to replace the object\n  \t\t\tthis.viewmodel.set(data);\n  \t\t}\n  \t} else {\n  \t\tthis.viewmodel.set(data);\n  \t}\n\n  \t// reset config items and track if need to rerender\n  \tvar changes = config.reset(this);\n  \tvar rerender = undefined;\n\n  \tvar i = changes.length;\n  \twhile (i--) {\n  \t\tif (shouldRerender.indexOf(changes[i]) > -1) {\n  \t\t\trerender = true;\n  \t\t\tbreak;\n  \t\t}\n  \t}\n\n  \tif (rerender) {\n  \t\tunrenderHook.fire(this);\n  \t\tthis.fragment.resetTemplate(this.template);\n  \t\trenderHook.fire(this);\n  \t\tcompleteHook.fire(this);\n  \t}\n\n  \trunloop.end();\n\n  \tresetHook.fire(this, data);\n\n  \treturn promise;\n  }\n\n  function Ractive$render(target, anchor) {\n  \ttarget = getElement(target) || this.el;\n\n  \tif (!this.append && target) {\n  \t\t// Teardown any existing instances *before* trying to set up the new one -\n  \t\t// avoids certain weird bugs\n  \t\tvar others = target.__ractive_instances__;\n  \t\tif (others) others.forEach(_teardown);\n\n  \t\t// make sure we are the only occupants\n  \t\ttarget.innerHTML = ''; // TODO is this quicker than removeChild? Initial research inconclusive\n  \t}\n\n  \treturn _render(this, target, anchor);\n  }\n\n  var _push = makeArrayMethod('push');\n\n  var pop = makeArrayMethod('pop');\n\n  function Ractive$once(eventName, handler) {\n  \tvar listener = this.on(eventName, function () {\n  \t\thandler.apply(this, arguments);\n  \t\tlistener.cancel();\n  \t});\n\n  \t// so we can still do listener.cancel() manually\n  \treturn listener;\n  }\n\n  function notEmptyString (str) {\n    return str !== '';\n  }\n\n  function _trim (str) {\n    return str.trim();\n  }\n\n  function Ractive$on(eventName, callback) {\n  \tvar _this = this;\n\n  \t// allow mutliple listeners to be bound in one go\n  \tif (typeof eventName === 'object') {\n  \t\tvar _ret = (function () {\n  \t\t\tvar listeners = [];\n  \t\t\tvar n = undefined;\n\n  \t\t\tfor (n in eventName) {\n  \t\t\t\tif (eventName.hasOwnProperty(n)) {\n  \t\t\t\t\tlisteners.push(_this.on(n, eventName[n]));\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\treturn {\n  \t\t\t\tv: {\n  \t\t\t\t\tcancel: function () {\n  \t\t\t\t\t\tvar listener = undefined;\n  \t\t\t\t\t\twhile (listener = listeners.pop()) listener.cancel();\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t\t};\n  \t\t})();\n\n  \t\tif (typeof _ret === 'object') return _ret.v;\n  \t}\n\n  \t// Handle multiple space-separated event names\n  \tvar eventNames = eventName.split(' ').map(_trim).filter(notEmptyString);\n\n  \teventNames.forEach(function (eventName) {\n  \t\t(_this._subs[eventName] || (_this._subs[eventName] = [])).push(callback);\n  \t});\n\n  \treturn {\n  \t\tcancel: function () {\n  \t\t\treturn _this.off(eventName, callback);\n  \t\t}\n  \t};\n  }\n\n  function Ractive$off(eventName, callback) {\n  \tvar _this = this;\n\n  \t// if no arguments specified, remove all callbacks\n  \tif (!eventName) {\n  \t\t// TODO use this code instead, once the following issue has been resolved\n  \t\t// in PhantomJS (tests are unpassable otherwise!)\n  \t\t// https://github.com/ariya/phantomjs/issues/11856\n  \t\t// defineProperty( this, '_subs', { value: create( null ), configurable: true });\n  \t\tfor (eventName in this._subs) {\n  \t\t\tdelete this._subs[eventName];\n  \t\t}\n  \t} else {\n  \t\t// Handle multiple space-separated event names\n  \t\tvar eventNames = eventName.split(' ').map(_trim).filter(notEmptyString);\n\n  \t\teventNames.forEach(function (eventName) {\n  \t\t\tvar subscribers = _this._subs[eventName];\n\n  \t\t\t// If we have subscribers for this event...\n  \t\t\tif (subscribers) {\n  \t\t\t\t// ...if a callback was specified, only remove that\n  \t\t\t\tif (callback) {\n  \t\t\t\t\tvar index = subscribers.indexOf(callback);\n  \t\t\t\t\tif (index !== -1) {\n  \t\t\t\t\t\tsubscribers.splice(index, 1);\n  \t\t\t\t\t}\n  \t\t\t\t}\n\n  \t\t\t\t// ...otherwise remove all callbacks\n  \t\t\t\telse {\n  \t\t\t\t\t\t_this._subs[eventName] = [];\n  \t\t\t\t\t}\n  \t\t\t}\n  \t\t});\n  \t}\n\n  \treturn this;\n  }\n\n  var onceOptions = { init: false, once: true };\n  function observeOnce(keypath, callback, options) {\n  \tif (isObject(keypath) || typeof keypath === 'function') {\n  \t\toptions = __extend(callback || {}, onceOptions);\n  \t\treturn this.observe(keypath, options);\n  \t}\n\n  \toptions = __extend(options || {}, onceOptions);\n  \treturn this.observe(keypath, callback, options);\n  }\n\n  function observeList(keypath, callback, options) {\n  \tif (typeof keypath !== 'string') {\n  \t\tthrow new Error('ractive.observeList() must be passed a string as its first argument');\n  \t}\n\n  \tvar model = this.viewmodel.joinAll(splitKeypath(keypath));\n  \tvar observer = new ListObserver(this, model, callback, options || {});\n\n  \t// add observer to the Ractive instance, so it can be\n  \t// cancelled on ractive.teardown()\n  \tthis._observers.push(observer);\n\n  \treturn {\n  \t\tcancel: function () {\n  \t\t\tobserver.cancel();\n  \t\t}\n  \t};\n  }\n\n  function negativeOne() {\n  \treturn -1;\n  }\n\n  var ListObserver = (function () {\n  \tfunction ListObserver(context, model, callback, options) {\n  \t\tclassCallCheck(this, ListObserver);\n\n  \t\tthis.context = context;\n  \t\tthis.model = model;\n  \t\tthis.keypath = model.getKeypath();\n  \t\tthis.callback = callback;\n\n  \t\tthis.pending = null;\n\n  \t\tmodel.register(this);\n\n  \t\tif (options.init !== false) {\n  \t\t\tthis.sliced = [];\n  \t\t\tthis.shuffle([]);\n  \t\t\tthis.handleChange();\n  \t\t} else {\n  \t\t\tthis.sliced = this.slice();\n  \t\t}\n  \t}\n\n  \tListObserver.prototype.handleChange = function handleChange() {\n  \t\tif (this.pending) {\n  \t\t\t// post-shuffle\n  \t\t\tthis.callback(this.pending);\n  \t\t\tthis.pending = null;\n  \t\t} else {\n  \t\t\t// entire array changed\n  \t\t\tthis.shuffle(this.sliced.map(negativeOne));\n  \t\t\tthis.handleChange();\n  \t\t}\n  \t};\n\n  \tListObserver.prototype.shuffle = function shuffle(newIndices) {\n  \t\tvar _this = this;\n\n  \t\tvar newValue = this.slice();\n\n  \t\tvar inserted = [];\n  \t\tvar deleted = [];\n  \t\tvar start = undefined;\n\n  \t\tvar hadIndex = {};\n\n  \t\tnewIndices.forEach(function (newIndex, oldIndex) {\n  \t\t\thadIndex[newIndex] = true;\n\n  \t\t\tif (newIndex !== oldIndex && start === undefined) {\n  \t\t\t\tstart = oldIndex;\n  \t\t\t}\n\n  \t\t\tif (newIndex === -1) {\n  \t\t\t\tdeleted.push(_this.sliced[oldIndex]);\n  \t\t\t}\n  \t\t});\n\n  \t\tif (start === undefined) start = newIndices.length;\n\n  \t\tvar len = newValue.length;\n  \t\tfor (var i = 0; i < len; i += 1) {\n  \t\t\tif (!hadIndex[i]) inserted.push(newValue[i]);\n  \t\t}\n\n  \t\tthis.pending = { inserted: inserted, deleted: deleted, start: start };\n  \t\tthis.sliced = newValue;\n  \t};\n\n  \tListObserver.prototype.slice = function slice() {\n  \t\tvar value = this.model.get();\n  \t\treturn isArray(value) ? value.slice() : [];\n  \t};\n\n  \treturn ListObserver;\n  })();\n\n  function observe(keypath, callback, options) {\n  \tvar _this = this;\n\n  \tvar observers = [];\n  \tvar map = undefined;\n\n  \tif (isObject(keypath)) {\n  \t\tmap = keypath;\n  \t\toptions = callback || {};\n\n  \t\tObject.keys(map).forEach(function (keypath) {\n  \t\t\tvar callback = map[keypath];\n\n  \t\t\tkeypath.split(' ').forEach(function (keypath) {\n  \t\t\t\tobservers.push(createObserver(_this, keypath, callback, options));\n  \t\t\t});\n  \t\t});\n  \t} else {\n  \t\tvar keypaths = undefined;\n\n  \t\tif (typeof keypath === 'function') {\n  \t\t\toptions = callback;\n  \t\t\tcallback = keypath;\n  \t\t\tkeypaths = [''];\n  \t\t} else {\n  \t\t\tkeypaths = keypath.split(' ');\n  \t\t}\n\n  \t\tkeypaths.forEach(function (keypath) {\n  \t\t\tobservers.push(createObserver(_this, keypath, callback, options || {}));\n  \t\t});\n  \t}\n\n  \t// add observers to the Ractive instance, so they can be\n  \t// cancelled on ractive.teardown()\n  \tthis._observers.push.apply(this._observers, observers);\n\n  \treturn {\n  \t\tcancel: function () {\n  \t\t\tobservers.forEach(_cancel);\n  \t\t}\n  \t};\n  }\n\n  function createObserver(ractive, keypath, callback, options) {\n  \tvar viewmodel = ractive.viewmodel;\n\n  \tvar keys = splitKeypath(keypath);\n  \tvar wildcardIndex = keys.indexOf('*');\n\n  \t// normal keypath - no wildcards\n  \tif (! ~wildcardIndex) {\n  \t\tvar key = keys[0];\n\n  \t\tif (!viewmodel.has(key)) {\n  \t\t\t// if this is an inline component, we may need to create an implicit mapping\n  \t\t\tif (ractive.component) {\n  \t\t\t\tvar _model = resolveReference(ractive.component.parentFragment, key);\n  \t\t\t\tif (_model) viewmodel.map(key, _model);\n  \t\t\t}\n  \t\t}\n\n  \t\tvar model = viewmodel.joinAll(keys);\n  \t\treturn new Observer(options.context || ractive, model, callback, options);\n  \t}\n\n  \t// pattern observers - more complex case\n  \tvar baseModel = wildcardIndex === 0 ? viewmodel : viewmodel.joinAll(keys.slice(0, wildcardIndex));\n\n  \treturn new PatternObserver(options.context || ractive, baseModel, keys.splice(wildcardIndex), callback, options);\n  }\n\n  var Observer = (function () {\n  \tfunction Observer(context, model, callback, options) {\n  \t\tclassCallCheck(this, Observer);\n\n  \t\tthis.context = context;\n  \t\tthis.model = model;\n  \t\tthis.keypath = model.getKeypath();\n  \t\tthis.callback = callback;\n\n  \t\tthis.oldValue = undefined;\n  \t\tthis.newValue = model.get();\n\n  \t\tthis.defer = options.defer;\n  \t\tthis.once = options.once;\n  \t\tthis.strict = options.strict;\n\n  \t\tthis.dirty = false;\n\n  \t\tif (options.init !== false) {\n  \t\t\tthis.dispatch();\n  \t\t} else {\n  \t\t\tthis.oldValue = this.newValue;\n  \t\t}\n\n  \t\tmodel.register(this);\n  \t}\n\n  \tObserver.prototype.cancel = function cancel() {\n  \t\tthis.model.unregister(this);\n  \t};\n\n  \tObserver.prototype.dispatch = function dispatch() {\n  \t\tthis.callback.call(this.context, this.newValue, this.oldValue, this.keypath);\n  \t\tthis.oldValue = this.newValue;\n  \t\tthis.dirty = false;\n  \t};\n\n  \tObserver.prototype.handleChange = function handleChange() {\n  \t\tif (!this.dirty) {\n  \t\t\tthis.newValue = this.model.get();\n\n  \t\t\tif (this.strict && this.newValue === this.oldValue) return;\n\n  \t\t\trunloop.addObserver(this, this.defer);\n  \t\t\tthis.dirty = true;\n\n  \t\t\tif (this.once) this.cancel();\n  \t\t}\n  \t};\n\n  \treturn Observer;\n  })();\n\n  var PatternObserver = (function () {\n  \tfunction PatternObserver(context, baseModel, keys, callback, options) {\n  \t\tvar _this2 = this;\n\n  \t\tclassCallCheck(this, PatternObserver);\n\n  \t\tthis.context = context;\n  \t\tthis.baseModel = baseModel;\n  \t\tthis.keys = keys;\n  \t\tthis.callback = callback;\n\n  \t\tvar pattern = keys.join('\\\\.').replace(/\\*/g, '(.+)');\n  \t\tvar baseKeypath = baseModel.getKeypath();\n  \t\tthis.pattern = new RegExp('^' + (baseKeypath ? baseKeypath + '.' : '') + pattern + '$');\n\n  \t\tthis.oldValues = {};\n  \t\tthis.newValues = {};\n\n  \t\tthis.defer = options.defer;\n  \t\tthis.once = options.once;\n  \t\tthis.strict = options.strict;\n\n  \t\tthis.dirty = false;\n\n  \t\tthis.baseModel.findMatches(this.keys).forEach(function (model) {\n  \t\t\t_this2.newValues[model.getKeypath()] = model.get();\n  \t\t});\n\n  \t\tif (options.init !== false) {\n  \t\t\tthis.dispatch();\n  \t\t} else {\n  \t\t\tthis.oldValues = this.newValues;\n  \t\t}\n\n  \t\tbaseModel.register(this);\n  \t}\n\n  \tPatternObserver.prototype.cancel = function cancel() {\n  \t\tthis.baseModel.unregister(this);\n  \t};\n\n  \tPatternObserver.prototype.dispatch = function dispatch() {\n  \t\tvar _this3 = this;\n\n  \t\tObject.keys(this.newValues).forEach(function (keypath) {\n  \t\t\tvar newValue = _this3.newValues[keypath];\n  \t\t\tvar oldValue = _this3.oldValues[keypath];\n\n  \t\t\tif (_this3.strict && newValue === oldValue) return;\n  \t\t\tif (isEqual(newValue, oldValue)) return;\n\n  \t\t\tvar wildcards = _this3.pattern.exec(keypath).slice(1);\n  \t\t\tvar args = [newValue, oldValue, keypath].concat(wildcards);\n\n  \t\t\t_this3.callback.apply(_this3.context, args);\n  \t\t});\n\n  \t\tthis.oldValues = this.newValues;\n  \t\tthis.dirty = false;\n  \t};\n\n  \tPatternObserver.prototype.handleChange = function handleChange() {\n  \t\tvar _this4 = this;\n\n  \t\tif (!this.dirty) {\n  \t\t\tthis.newValues = {};\n\n  \t\t\t// handle case where previously extant keypath no longer exists -\n  \t\t\t// observer should still fire, with undefined as new value\n  \t\t\t// TODO huh. according to the test suite that's not the case...\n  \t\t\t// Object.keys( this.oldValues ).forEach( keypath => {\n  \t\t\t// \tthis.newValues[ keypath ] = undefined;\n  \t\t\t// });\n\n  \t\t\tthis.baseModel.findMatches(this.keys).forEach(function (model) {\n  \t\t\t\tvar keypath = model.getKeypath();\n  \t\t\t\t_this4.newValues[keypath] = model.get();\n  \t\t\t});\n\n  \t\t\trunloop.addObserver(this, this.defer);\n  \t\t\tthis.dirty = true;\n\n  \t\t\tif (this.once) this.cancel();\n  \t\t}\n  \t};\n\n  \treturn PatternObserver;\n  })();\n\n  var comparators = {};\n\n  function getComparator(option) {\n  \tif (!option) return null; // use existing arrays\n  \tif (option === true) return JSON.stringify;\n  \tif (typeof option === 'function') return option;\n\n  \tif (typeof option === 'string') {\n  \t\treturn comparators[option] || (comparators[option] = function (thing) {\n  \t\t\treturn thing[option];\n  \t\t});\n  \t}\n\n  \tthrow new Error('If supplied, options.compare must be a string, function, or `true`'); // TODO link to docs\n  }\n  function Ractive$merge(keypath, array, options) {\n  \tvar model = this.viewmodel.joinAll(splitKeypath(keypath));\n  \tvar promise = runloop.start(this, true);\n  \tvar value = model.get();\n\n  \tif (array === value) {\n  \t\tthrow new Error('You cannot merge an array with itself'); // TODO link to docs\n  \t} else if (!isArray(value) || !isArray(array)) {\n  \t\t\tthrow new Error('You cannot merge an array with a non-array');\n  \t\t}\n\n  \tvar comparator = getComparator(options && options.compare);\n  \tmodel.merge(array, comparator);\n\n  \trunloop.end();\n  \treturn promise;\n  }\n\n  var insertHook = new Hook('insert');\n  function Ractive$insert(target, anchor) {\n  \tif (!this.fragment.rendered) {\n  \t\t// TODO create, and link to, documentation explaining this\n  \t\tthrow new Error('The API has changed - you must call `ractive.render(target[, anchor])` to render your Ractive instance. Once rendered you can use `ractive.insert()`.');\n  \t}\n\n  \ttarget = getElement(target);\n  \tanchor = getElement(anchor) || null;\n\n  \tif (!target) {\n  \t\tthrow new Error('You must specify a valid target to insert into');\n  \t}\n\n  \ttarget.insertBefore(this.detach(), anchor);\n  \tthis.el = target;\n\n  \t(target.__ractive_instances__ || (target.__ractive_instances__ = [])).push(this);\n  \tthis.isDetached = false;\n\n  \tfireInsertHook(this);\n  }\n\n  function fireInsertHook(ractive) {\n  \tinsertHook.fire(ractive);\n\n  \tractive.findAllComponents('*').forEach(function (child) {\n  \t\tfireInsertHook(child.instance);\n  \t});\n  }\n\n  function Ractive$get(keypath) {\n  \tif (!keypath) return this.viewmodel.get(true);\n\n  \tvar keys = splitKeypath(keypath);\n  \tvar key = keys[0];\n\n  \tvar model = undefined;\n\n  \tif (!this.viewmodel.has(key)) {\n  \t\t// if this is an inline component, we may need to create\n  \t\t// an implicit mapping\n  \t\tif (this.component) {\n  \t\t\tmodel = resolveReference(this.component.parentFragment, key);\n\n  \t\t\tif (model) {\n  \t\t\t\tthis.viewmodel.map(key, model);\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \tmodel = this.viewmodel.joinAll(keys);\n  \treturn model.get(true);\n  }\n\n  function Ractive$fire(eventName) {\n  \tfor (var _len = arguments.length, args = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n  \t\targs[_key - 1] = arguments[_key];\n  \t}\n\n  \tfireEvent(this, eventName, { args: args });\n  }\n\n  function Ractive$findParent(selector) {\n\n  \tif (this.parent) {\n  \t\tif (this.parent.component && this.parent.component.name === selector) {\n  \t\t\treturn this.parent;\n  \t\t} else {\n  \t\t\treturn this.parent.findParent(selector);\n  \t\t}\n  \t}\n\n  \treturn null;\n  }\n\n  function Ractive$findContainer(selector) {\n  \tif (this.container) {\n  \t\tif (this.container.component && this.container.component.name === selector) {\n  \t\t\treturn this.container;\n  \t\t} else {\n  \t\t\treturn this.container.findContainer(selector);\n  \t\t}\n  \t}\n\n  \treturn null;\n  }\n\n  function Ractive$findComponent(selector) {\n  \treturn this.fragment.findComponent(selector);\n  }\n\n  function sortByDocumentPosition(node, otherNode) {\n  \tif (node.compareDocumentPosition) {\n  \t\tvar bitmask = node.compareDocumentPosition(otherNode);\n  \t\treturn bitmask & 2 ? 1 : -1;\n  \t}\n\n  \t// In old IE, we can piggy back on the mechanism for\n  \t// comparing component positions\n  \treturn sortByItemPosition(node, otherNode);\n  }\n\n  function sortByItemPosition(a, b) {\n  \tvar ancestryA = getAncestry(a.component || a._ractive.proxy);\n  \tvar ancestryB = getAncestry(b.component || b._ractive.proxy);\n\n  \tvar oldestA = lastItem(ancestryA);\n  \tvar oldestB = lastItem(ancestryB);\n  \tvar mutualAncestor = undefined;\n\n  \t// remove items from the end of both ancestries as long as they are identical\n  \t// - the final one removed is the closest mutual ancestor\n  \twhile (oldestA && oldestA === oldestB) {\n  \t\tancestryA.pop();\n  \t\tancestryB.pop();\n\n  \t\tmutualAncestor = oldestA;\n\n  \t\toldestA = lastItem(ancestryA);\n  \t\toldestB = lastItem(ancestryB);\n  \t}\n\n  \t// now that we have the mutual ancestor, we can find which is earliest\n  \toldestA = oldestA.component || oldestA;\n  \toldestB = oldestB.component || oldestB;\n\n  \tvar fragmentA = oldestA.parentFragment;\n  \tvar fragmentB = oldestB.parentFragment;\n\n  \t// if both items share a parent fragment, our job is easy\n  \tif (fragmentA === fragmentB) {\n  \t\tvar indexA = fragmentA.items.indexOf(oldestA);\n  \t\tvar indexB = fragmentB.items.indexOf(oldestB);\n\n  \t\t// if it's the same index, it means one contains the other,\n  \t\t// so we see which has the longest ancestry\n  \t\treturn indexA - indexB || ancestryA.length - ancestryB.length;\n  \t}\n\n  \t// if mutual ancestor is a section, we first test to see which section\n  \t// fragment comes first\n  \tvar fragments = mutualAncestor.iterations;\n  \tif (fragments) {\n  \t\tvar indexA = fragments.indexOf(fragmentA);\n  \t\tvar indexB = fragments.indexOf(fragmentB);\n\n  \t\treturn indexA - indexB || ancestryA.length - ancestryB.length;\n  \t}\n\n  \tthrow new Error('An unexpected condition was met while comparing the position of two components. Please file an issue at https://github.com/ractivejs/ractive/issues - thanks!');\n  }\n\n  function getParent(item) {\n  \tvar parentFragment = item.parentFragment;\n\n  \tif (parentFragment) return parentFragment.owner;\n\n  \tif (item.component && (parentFragment = item.component.parentFragment)) {\n  \t\treturn parentFragment.owner;\n  \t}\n  }\n\n  function getAncestry(item) {\n  \tvar ancestry = [item];\n  \tvar ancestor = getParent(item);\n\n  \twhile (ancestor) {\n  \t\tancestry.push(ancestor);\n  \t\tancestor = getParent(ancestor);\n  \t}\n\n  \treturn ancestry;\n  }\n\n  var Query = (function () {\n  \tfunction Query(ractive, selector, live, isComponentQuery) {\n  \t\tclassCallCheck(this, Query);\n\n  \t\tthis.ractive = ractive;\n  \t\tthis.selector = selector;\n  \t\tthis.live = live;\n  \t\tthis.isComponentQuery = isComponentQuery;\n\n  \t\tthis.result = [];\n\n  \t\tthis.dirty = true;\n  \t}\n\n  \tQuery.prototype.add = function add(item) {\n  \t\tthis.result.push(item);\n  \t\tthis.makeDirty();\n  \t};\n\n  \tQuery.prototype.cancel = function cancel() {\n  \t\tvar liveQueries = this._root[this.isComponentQuery ? 'liveComponentQueries' : 'liveQueries'];\n  \t\tvar selector = this.selector;\n\n  \t\tvar index = liveQueries.indexOf(selector);\n\n  \t\tif (index !== -1) {\n  \t\t\tliveQueries.splice(index, 1);\n  \t\t\tliveQueries[selector] = null;\n  \t\t}\n  \t};\n\n  \tQuery.prototype.init = function init() {\n  \t\tthis.dirty = false;\n  \t};\n\n  \tQuery.prototype.makeDirty = function makeDirty() {\n  \t\tvar _this = this;\n\n  \t\tif (!this.dirty) {\n  \t\t\tthis.dirty = true;\n\n  \t\t\t// Once the DOM has been updated, ensure the query\n  \t\t\t// is correctly ordered\n  \t\t\trunloop.scheduleTask(function () {\n  \t\t\t\treturn _this.update();\n  \t\t\t});\n  \t\t}\n  \t};\n\n  \tQuery.prototype.remove = function remove(nodeOrComponent) {\n  \t\tvar index = this.result.indexOf(this.isComponentQuery ? nodeOrComponent.instance : nodeOrComponent);\n  \t\tif (index !== -1) this.result.splice(index, 1);\n  \t};\n\n  \tQuery.prototype.update = function update() {\n  \t\tthis.result.sort(this.isComponentQuery ? sortByItemPosition : sortByDocumentPosition);\n  \t\tthis.dirty = false;\n  \t};\n\n  \tQuery.prototype.test = function test(item) {\n  \t\treturn this.isComponentQuery ? !this.selector || item.name === this.selector : item ? matches(item, this.selector) : null;\n  \t};\n\n  \treturn Query;\n  })();\n\n  function Ractive$findAllComponents(selector, options) {\n  \toptions = options || {};\n  \tvar liveQueries = this._liveComponentQueries;\n\n  \t// Shortcut: if we're maintaining a live query with this\n  \t// selector, we don't need to traverse the parallel DOM\n  \tvar query = liveQueries[selector];\n  \tif (query) {\n  \t\t// Either return the exact same query, or (if not live) a snapshot\n  \t\treturn options && options.live ? query : query.slice();\n  \t}\n\n  \tquery = new Query(this, selector, !!options.live, true);\n\n  \t// Add this to the list of live queries Ractive needs to maintain,\n  \t// if applicable\n  \tif (query.live) {\n  \t\tliveQueries.push(selector);\n  \t\tliveQueries['_' + selector] = query;\n  \t}\n\n  \tthis.fragment.findAllComponents(selector, query);\n\n  \tquery.init();\n  \treturn query.result;\n  }\n\n  function Ractive$findAll(selector, options) {\n  \tif (!this.el) return [];\n\n  \toptions = options || {};\n  \tvar liveQueries = this._liveQueries;\n\n  \t// Shortcut: if we're maintaining a live query with this\n  \t// selector, we don't need to traverse the parallel DOM\n  \tvar query = liveQueries[selector];\n  \tif (query) {\n  \t\t// Either return the exact same query, or (if not live) a snapshot\n  \t\treturn options && options.live ? query : query.slice();\n  \t}\n\n  \tquery = new Query(this, selector, !!options.live, false);\n\n  \t// Add this to the list of live queries Ractive needs to maintain,\n  \t// if applicable\n  \tif (query.live) {\n  \t\tliveQueries.push(selector);\n  \t\tliveQueries['_' + selector] = query;\n  \t}\n\n  \tthis.fragment.findAll(selector, query);\n\n  \tquery.init();\n  \treturn query.result;\n  }\n\n  function Ractive$find(selector) {\n  \tif (!this.el) {\n  \t\treturn null;\n  \t}\n\n  \treturn this.fragment.find(selector);\n  }\n\n  var detachHook = new Hook('detach');\n  function Ractive$detach() {\n  \tif (this.isDetached) {\n  \t\treturn this.el;\n  \t}\n\n  \tif (this.el) {\n  \t\tremoveFromArray(this.el.__ractive_instances__, this);\n  \t}\n\n  \tthis.el = this.fragment.detach();\n  \tthis.isDetached = true;\n\n  \tdetachHook.fire(this);\n  \treturn this.el;\n  }\n\n  // These are a subset of the easing equations found at\n  // https://raw.github.com/danro/easing-js - license info\n  // follows:\n\n  // --------------------------------------------------\n  // easing.js v0.5.4\n  // Generic set of easing functions with AMD support\n  // https://github.com/danro/easing-js\n  // This code may be freely distributed under the MIT license\n  // http://danro.mit-license.org/\n  // --------------------------------------------------\n  // All functions adapted from Thomas Fuchs & Jeremy Kahn\n  // Easing Equations (c) 2003 Robert Penner, BSD license\n  // https://raw.github.com/danro/easing-js/master/LICENSE\n  // --------------------------------------------------\n\n  // In that library, the functions named easeIn, easeOut, and\n  // easeInOut below are named easeInCubic, easeOutCubic, and\n  // (you guessed it) easeInOutCubic.\n  //\n  // You can add additional easing functions to this list, and they\n  // will be globally available.\n\n  var easing = {\n  \tlinear: function (pos) {\n  \t\treturn pos;\n  \t},\n  \teaseIn: function (pos) {\n  \t\treturn Math.pow(pos, 3);\n  \t},\n  \teaseOut: function (pos) {\n  \t\treturn Math.pow(pos - 1, 3) + 1;\n  \t},\n  \teaseInOut: function (pos) {\n  \t\tif ((pos /= 0.5) < 1) {\n  \t\t\treturn 0.5 * Math.pow(pos, 3);\n  \t\t}\n  \t\treturn 0.5 * (Math.pow(pos - 2, 3) + 2);\n  \t}\n  };\n\n  var noAnimation = { stop: noop };\n  var linear = easing.linear;\n\n  function getOptions(options, instance) {\n  \toptions = options || {};\n\n  \tvar easing = undefined;\n  \tif (options.easing) {\n  \t\teasing = typeof options.easing === 'function' ? options.easing : instance.easing[options.easing];\n  \t}\n\n  \treturn {\n  \t\teasing: easing || linear,\n  \t\tduration: 'duration' in options ? options.duration : 400,\n  \t\tcomplete: options.complete || noop,\n  \t\tstep: options.step || noop\n  \t};\n  }\n  function Ractive$animate(keypath, to, options) {\n  \tif (typeof keypath === 'object') {\n  \t\tvar keys = Object.keys(keypath);\n\n  \t\tthrow new Error('ractive.animate(...) no longer supports objects. Instead of ractive.animate({\\n  ' + keys.map(function (key) {\n  \t\t\treturn '\\'' + key + '\\': ' + keypath[key];\n  \t\t}).join('\\n  ') + '\\n}, {...}), do\\n\\n' + keys.map(function (key) {\n  \t\t\treturn 'ractive.animate(\\'' + key + '\\', ' + keypath[key] + ', {...});';\n  \t\t}).join('\\n') + '\\n');\n  \t}\n\n  \toptions = getOptions(options);\n\n  \tvar model = this.viewmodel.joinAll(splitKeypath(keypath));\n  \tvar from = model.get();\n\n  \t// don't bother animating values that stay the same\n  \tif (isEqual(from, to)) {\n  \t\toptions.complete(options.to);\n  \t\treturn noAnimation; // TODO should this have .then and .catch methods?\n  \t}\n\n  \tvar interpolator = interpolate(from, to, this, options.interpolator);\n\n  \t// if we can't interpolate the value, set it immediately\n  \tif (!interpolator) {\n  \t\trunloop.start();\n  \t\tmodel.set(to);\n  \t\trunloop.end();\n\n  \t\treturn noAnimation;\n  \t}\n\n  \treturn model.animate(from, to, options, interpolator);\n  }\n\n  function Ractive$add(keypath, d) {\n  \treturn _add(this, keypath, d === undefined ? 1 : +d);\n  }\n\n  var _proto = {\n  \tadd: Ractive$add,\n  \tanimate: Ractive$animate,\n  \tdetach: Ractive$detach,\n  \tfind: Ractive$find,\n  \tfindAll: Ractive$findAll,\n  \tfindAllComponents: Ractive$findAllComponents,\n  \tfindComponent: Ractive$findComponent,\n  \tfindContainer: Ractive$findContainer,\n  \tfindParent: Ractive$findParent,\n  \tfire: Ractive$fire,\n  \tget: Ractive$get,\n  \tinsert: Ractive$insert,\n  \tmerge: Ractive$merge,\n  \tobserve: observe,\n  \tobserveList: observeList,\n  \tobserveOnce: observeOnce,\n  \t// TODO reinstate these\n  \t// observeListOnce,\n  \toff: Ractive$off,\n  \ton: Ractive$on,\n  \tonce: Ractive$once,\n  \tpop: pop,\n  \tpush: _push,\n  \trender: Ractive$render,\n  \treset: Ractive$reset,\n  \tresetPartial: resetPartial,\n  \tresetTemplate: Ractive$resetTemplate,\n  \treverse: reverse,\n  \tset: Ractive$set,\n  \tshift: shift,\n  \tsort: sort,\n  \tsplice: splice,\n  \tsubtract: Ractive$subtract,\n  \tteardown: Ractive$teardown,\n  \ttoggle: Ractive$toggle,\n  \ttoHTML: Ractive$toHTML,\n  \ttoHtml: Ractive$toHTML,\n  \tunrender: Ractive$unrender,\n  \tunshift: unshift,\n  \tupdate: Ractive$update,\n  \tupdateModel: Ractive$updateModel\n  };\n\n  function getNodeInfo (node) {\n  \tif (!node || !node._ractive) return {};\n\n  \tvar storage = node._ractive;\n\n  \treturn {\n  \t\tractive: storage.ractive,\n  \t\tkeypath: storage.context.getKeypath(),\n  \t\tindex: __extend({}, storage.fragment.indexRefs),\n  \t\tkey: __extend({}, storage.fragment.keyRefs)\n  \t};\n  }\n\n  function _wrap (method, superMethod, force) {\n\n  \tif (force || needsSuper(method, superMethod)) {\n\n  \t\treturn function () {\n\n  \t\t\tvar hasSuper = ('_super' in this),\n  \t\t\t    _super = this._super,\n  \t\t\t    result;\n\n  \t\t\tthis._super = superMethod;\n\n  \t\t\tresult = method.apply(this, arguments);\n\n  \t\t\tif (hasSuper) {\n  \t\t\t\tthis._super = _super;\n  \t\t\t}\n\n  \t\t\treturn result;\n  \t\t};\n  \t} else {\n  \t\treturn method;\n  \t}\n  }\n\n  function needsSuper(method, superMethod) {\n  \treturn typeof superMethod === 'function' && /_super/.test(method);\n  }\n\n  function unwrap(Child) {\n  \tvar options = {};\n\n  \twhile (Child) {\n  \t\taddRegistries(Child, options);\n  \t\taddOtherOptions(Child, options);\n\n  \t\tif (Child._Parent !== Ractive) {\n  \t\t\tChild = Child._Parent;\n  \t\t} else {\n  \t\t\tChild = false;\n  \t\t}\n  \t}\n\n  \treturn options;\n  }\n\n  function addRegistries(Child, options) {\n  \tregistries.forEach(function (r) {\n  \t\taddRegistry(r.useDefaults ? Child.prototype : Child, options, r.name);\n  \t});\n  }\n\n  function addRegistry(target, options, name) {\n  \tvar registry,\n  \t    keys = Object.keys(target[name]);\n\n  \tif (!keys.length) {\n  \t\treturn;\n  \t}\n\n  \tif (!(registry = options[name])) {\n  \t\tregistry = options[name] = {};\n  \t}\n\n  \tkeys.filter(function (key) {\n  \t\treturn !(key in registry);\n  \t}).forEach(function (key) {\n  \t\treturn registry[key] = target[name][key];\n  \t});\n  }\n\n  function addOtherOptions(Child, options) {\n  \tObject.keys(Child.prototype).forEach(function (key) {\n  \t\tif (key === 'computed') {\n  \t\t\treturn;\n  \t\t}\n\n  \t\tvar value = Child.prototype[key];\n\n  \t\tif (!(key in options)) {\n  \t\t\toptions[key] = value._method ? value._method : value;\n  \t\t}\n\n  \t\t// is it a wrapped function?\n  \t\telse if (typeof options[key] === 'function' && typeof value === 'function' && options[key]._method) {\n\n  \t\t\t\tvar result = undefined,\n  \t\t\t\t    needsSuper = value._method;\n\n  \t\t\t\tif (needsSuper) {\n  \t\t\t\t\tvalue = value._method;\n  \t\t\t\t}\n\n  \t\t\t\t// rewrap bound directly to parent fn\n  \t\t\t\tresult = _wrap(options[key]._method, value);\n\n  \t\t\t\tif (needsSuper) {\n  \t\t\t\t\tresult._method = result;\n  \t\t\t\t}\n\n  \t\t\t\toptions[key] = result;\n  \t\t\t}\n  \t});\n  }\n\n  function _extend() {\n  \tfor (var _len = arguments.length, options = Array(_len), _key = 0; _key < _len; _key++) {\n  \t\toptions[_key] = arguments[_key];\n  \t}\n\n  \tif (!options.length) {\n  \t\treturn extendOne(this);\n  \t} else {\n  \t\treturn options.reduce(extendOne, this);\n  \t}\n  }\n\n  function extendOne(Parent) {\n  \tvar options = arguments.length <= 1 || arguments[1] === undefined ? {} : arguments[1];\n\n  \tvar Child, proto;\n\n  \t// if we're extending with another Ractive instance...\n  \t//\n  \t//   var Human = Ractive.extend(...), Spider = Ractive.extend(...);\n  \t//   var Spiderman = Human.extend( Spider );\n  \t//\n  \t// ...inherit prototype methods and default options as well\n  \tif (options.prototype instanceof Ractive) {\n  \t\toptions = unwrap(options);\n  \t}\n\n  \tChild = function (options) {\n  \t\tif (!(this instanceof Child)) return new Child(options);\n\n  \t\tconstruct(this, options || {});\n  \t\tinitialise(this, options || {}, {});\n  \t};\n\n  \tproto = create(Parent.prototype);\n  \tproto.constructor = Child;\n\n  \t// Static properties\n  \tdefineProperties(Child, {\n  \t\t// alias prototype as defaults\n  \t\tdefaults: { value: proto },\n\n  \t\t// extendable\n  \t\textend: { value: _extend, writable: true, configurable: true },\n\n  \t\t// Parent - for IE8, can't use Object.getPrototypeOf\n  \t\t_Parent: { value: Parent }\n  \t});\n\n  \t// extend configuration\n  \tconfig.extend(Parent, proto, options);\n\n  \tdataConfigurator.extend(Parent, proto, options);\n\n  \tif (options.computed) {\n  \t\tproto.computed = __extend(create(Parent.prototype.computed), options.computed);\n  \t}\n\n  \tChild.prototype = proto;\n\n  \treturn Child;\n  }\n\n  // Ractive.js makes liberal use of things like Array.prototype.indexOf. In\n  // older browsers, these are made available via a shim - here, we do a quick\n  // pre-flight check to make sure that either a) we're not in a shit browser,\n  // or b) we're using a Ractive-legacy.js build\n  var FUNCTION = 'function';\n\n  if (typeof Date.now !== FUNCTION || typeof String.prototype.trim !== FUNCTION || typeof Object.keys !== FUNCTION || typeof Array.prototype.indexOf !== FUNCTION || typeof Array.prototype.forEach !== FUNCTION || typeof Array.prototype.map !== FUNCTION || typeof Array.prototype.filter !== FUNCTION || win && typeof win.addEventListener !== FUNCTION) {\n  \tthrow new Error('It looks like you\\'re attempting to use Ractive.js in an older browser. You\\'ll need to use one of the \\'legacy builds\\' in order to continue - see http://docs.ractivejs.org/latest/legacy-builds for more information.');\n  }\n  function Ractive(options) {\n  \tif (!(this instanceof Ractive)) return new Ractive(options);\n\n  \tconstruct(this, options || {});\n  \tinitialise(this, options || {}, {});\n  }\n\n  __extend(Ractive.prototype, _proto, _defaults);\n  Ractive.prototype.constructor = Ractive;\n\n  // alias prototype as `defaults`\n  Ractive.defaults = Ractive.prototype;\n\n  // static properties\n  defineProperties(Ractive, {\n\n  \t// debug flag\n  \tDEBUG: { writable: true, value: true },\n  \tDEBUG_PROMISES: { writable: true, value: true },\n\n  \t// static methods:\n  \textend: { value: _extend },\n  \tgetNodeInfo: { value: getNodeInfo },\n  \tparse: { value: parse },\n\n  \t// namespaced constructors\n  \tPromise: { value: _Promise },\n\n  \t// support\n  \tsvg: { value: _svg },\n  \tmagic: { value: magic },\n\n  \t// version\n  \tVERSION: { value: '0.8.0-edge' },\n\n  \t// plugins\n  \tadaptors: { writable: true, value: {} },\n  \tcomponents: { writable: true, value: {} },\n  \tdecorators: { writable: true, value: {} },\n  \teasing: { writable: true, value: easing },\n  \tevents: { writable: true, value: {} },\n  \tinterpolators: { writable: true, value: interpolators },\n  \tpartials: { writable: true, value: {} },\n  \ttransitions: { writable: true, value: {} }\n  });\n\n  return Ractive;\n\n}));"],"names":["model","_this3","parentFragment","findContext","joinKey","localKey","viewmodel","map","this","instance","fragment","rebind","Component","prototype","render","target","_render","checkYielders","eventHandlers","forEach","__render","updateLiveQueries","rendered","setupEvents","_this4","handlers","Object","keys","template","v","key","eventNames","split","eventName","event","RactiveEvent","push","EventDirective","toString","toHTML","unbind","complexMappings","_unbind","teardown","_observers","_cancel","removeFromLiveComponentQueries","el","__ractive_instances__","removeFromArray","teardownHook","fire","unrender","shouldDestroy","_this5","_unrender","liveQueries","query","remove","update","__update","dirty","Item","Text","_Item","options","classCallCheck","call","type","TEXT","inherits","bind","detach","detachNode","node","firstNode","doc","createTextNode","appendChild","escape","escapeHtml","valueOf","constructors","DOCTYPE","Doctype","INTERPOLATOR","Interpolator","PARTIAL","Partial","SECTION","Section","TRIPLE","Triple","YIELDER","Yielder","specialElements","doctype","form","Form","input","Input","option","Option","select","Select","textarea","Textarea","Fragment","owner","isRoot","parent","ractive","componentParent","component","context","indexRefs","keyRefs","cssIds","resolvers","dirtyArgs","dirtyValue","createItems","items","__bind","bound","bubble","runloop","addFragment","_this","index","createItem","docFrag","createDocumentFragment","item","find","selector","len","length","i","undefined","found","findAll","findComponent","name","findAllComponents","findNextNode","nextItem","findParentNode","ELEMENT","Error","findRepeatingFragment","isIteration","getArgsList","values","source","processItems","_guid","parsed","parseJSON","argsList","value","_rebind","resetTemplate","wasBound","wasRendered","parentNode","anchor","insertBefore","resolve","callback","resolver","ReferenceResolver","toHtml","toEscapedString","_toString","join","unrenderAndDestroy","shouldRerender","completeHook","Hook","resetHook","renderHook","unrenderHook","_push","makeArrayMethod","pop","onceOptions","init","once","ListObserver","keypath","getKeypath","pending","register","sliced","shuffle","handleChange","slice","negativeOne","newIndices","newValue","inserted","deleted","start","hadIndex","newIndex","oldIndex","get","isArray","Observer","oldValue","defer","strict","dispatch","cancel","unregister","addObserver","PatternObserver","baseModel","_this2","pattern","replace","baseKeypath","RegExp","oldValues","newValues","findMatches","isEqual","wildcards","exec","args","concat","apply","comparators","insertHook","Query","live","isComponentQuery","result","add","makeDirty","_root","indexOf","splice","scheduleTask","nodeOrComponent","sort","sortByItemPosition","sortByDocumentPosition","test","matches","detachHook","easing","linear","pos","easeIn","Math","pow","easeOut","easeInOut","noAnimation","stop","noop","_proto","Ractive$add","animate","Ractive$animate","Ractive$detach","Ractive$find","Ractive$findAll","Ractive$findAllComponents","Ractive$findComponent","findContainer","Ractive$findContainer","findParent","Ractive$findParent","Ractive$fire","Ractive$get","insert","Ractive$insert","merge","Ractive$merge","observe","observeList","observeOnce","off","Ractive$off","on","Ractive$on","Ractive$once","Ractive$render","reset","Ractive$reset","resetPartial","Ractive$resetTemplate","reverse","set","Ractive$set","shift","subtract","Ractive$subtract","Ractive$teardown","toggle","Ractive$toggle","Ractive$toHTML","Ractive$unrender","unshift","Ractive$update","updateModel","Ractive$updateModel","FUNCTION","Date","now","String","trim","Array","filter","win","addEventListener","__extend","Ractive","_defaults","constructor","defaults","defineProperties","DEBUG","writable","DEBUG_PROMISES","extend","_extend","getNodeInfo","parse","Promise","_Promise","svg","_svg","magic","VERSION","adaptors","components","decorators","events","interpolators","partials","transitions","RadioNameBinding","getValue","element","getAttribute","checked","_Binding","handleDomEvent","attachEvent","group","getKeypathModel","nameAttributeBinding","removeEventListener","Binding","ContentEditableBinding","arguments","getInitialValue","lazy","innerHTML","starMaps","wildcardCache","eventPattern","argumentsPattern","dollarArgsPattern","passthru","method","models","argsFn","action","m","g","a","r","ref","argMatch","argument","dollarMatch","resolveReference","createFunction","s","n","d","passedArgs","obj","wrapper","oldEvent","fireEvent","listen","unlisten","DOMEvent","fatal","handler","directive","missingPlugin","original","CustomEvent","eventPlugin","missingDecorator","Decorator","dynamicName","dynamicArgs","nameFragment","argsFragment","intermediary","fn","findInViewHierarchy","_name","div","createElement","ConditionalAttribute","attributes","isSvg","namespaceURI","str","attrs","parseAttributes","notIn","removeAttribute","setAttribute","propertyNames","accept-charset","accesskey","bgcolor","class","codebase","colspan","contenteditable","datetime","dirname","for","http-equiv","ismap","maxlength","novalidate","pubdate","readonly","rowspan","tabindex","usemap","Attribute","determineNameAndNamespace","updateDelegate","interpolator","getString","booleanAttributes","_html","propertyName","isTwoway","useProperty","_ractive","getUpdateDelegate","safeToStringValue","Element","e","toLowerCase","isVoid","voidElementNames","attributeByName","attribute","conditionalAttributes","o","decorator","f","binding","createTwowayBinding","shouldBind","twoway","selectBinding","__makeDirty","namespace","getNamespace","defineProperty","proxy","x","_updateLiveQueries","transitionTemplate","t0","t1","transitionsEnabled","transition","Transition","registerTransition","_introTransition","tagName","stringifyAttribute","isSelected","inputIsCheckedRadio","complete","detachWhenReady","t2","_transition","id","nodes","removeFromLiveQueries","_Element","defaultValue","_Input","isBindable","sync","defaultSelected","selected","selectNode","toArray","selectValue","isMultiple","optionWasSelected","optionValue","shouldSelect","valueContains","forceUpdate","findParentSelect","selectedAttribute","formBindings","handleReset","_prefix","styles","styleElement","head","getElementsByTagName","inDom","styleSheet","_update","css","cssText","_css","_renderHook","_completeHook","HookQueue","hook","inProcess","queue","begin","end","getChildQueue","_fire","TEMPLATE_VERSION","templateConfigurator","Parent","proto","parseIfString","t","getDynamicTemplate","_config","p","extendPartials","resetValue","dataConfigurator","data","isObject","warnIfDebug","__combine","prop","_bind","root","selectorsPattern","commentsPattern","selectorUnitPattern","mediaQueryPattern","dataRvcGuidPattern","_uid","cssConfigurator","noCssTransform","transformCss","cssId","adaptConfigurator","adapt","_combine","ensureArray","_registryNames","Registry","useDefaults","configure","registry","create","changed","_fn","isOwner","registries","custom","defaultKeys","isStandardKey","makeObj","isBlacklisted","order","config","_configure","c","configHook","initHook","_pattern","Computation","_Model","signature","isReadonly","setter","computationContext","dependencies","children","childByKey","deps","boundsSensitive","shouldCapture","capture","startCapturing","getter","err","message","console","groupCollapsed","functionBody","prettify","getterString","stack","getterUseStack","truncateStack","error","groupEnd","stopCapturing","setDependencies","_handleChange","clearUnresolveds","hasOwnProperty","child","ComputationChild","mark","Model","RootModel","changes","mappings","computations","applyChanges","_changeHash","flush","compute","computation","has","origin","shouldTeardown","_mark","retrieve","updateFromBindings","cascade","mutatorMethods","patchedArrayProto","methodName","_len","_key","getNewIndices","setting","wrappers","processWrapper","patchArrayMethods","unpatchArrayMethods","__proto__","array","configurable","unpatch","errorMessage","arrayAdaptor","object","wrap","ArrayWrapper","__model","instances","storage","magicAdaptor","MagicWrapper","originalDescriptors","originalDescriptor","getOwnPropertyDescriptor","childKeypath","descriptor","createOrWrapDescriptor","__magic","revert","dependants","MagicArrayWrapper","magicWrapper","arrayWrapper","magicArrayAdaptor","constructHook","registryNames","uid","ComponentConstructor","COMPONENT","content","_partials","yielders","container","construct","_inlinePartials","childData","_resolve","warnOnceIfDebug","initialise","isolated","_makeDirty","isStatic","Mustache","htmlEntities","quot","amp","apos","lt","gt","nbsp","iexcl","cent","pound","curren","yen","brvbar","sect","uml","copy","ordf","laquo","not","shy","reg","macr","deg","plusmn","sup2","sup3","acute","micro","para","middot","cedil","sup1","ordm","raquo","frac14","frac12","frac34","iquest","Agrave","Aacute","Acirc","Atilde","Auml","Aring","AElig","Ccedil","Egrave","Eacute","Ecirc","Euml","Igrave","Iacute","Icirc","Iuml","ETH","Ntilde","Ograve","Oacute","Ocirc","Otilde","Ouml","times","Oslash","Ugrave","Uacute","Ucirc","Uuml","Yacute","THORN","szlig","agrave","aacute","acirc","atilde","auml","aring","aelig","ccedil","egrave","eacute","ecirc","euml","igrave","iacute","icirc","iuml","eth","ntilde","ograve","oacute","ocirc","otilde","ouml","divide","oslash","ugrave","uacute","ucirc","uuml","yacute","thorn","yuml","OElig","oelig","Scaron","scaron","Yuml","fnof","circ","tilde","Alpha","Beta","Gamma","Delta","Epsilon","Zeta","Eta","Theta","Iota","Kappa","Lambda","Mu","Nu","Xi","Omicron","Pi","Rho","Sigma","Tau","Upsilon","Phi","Chi","Psi","Omega","alpha","beta","gamma","delta","epsilon","zeta","eta","theta","iota","kappa","lambda","mu","nu","xi","omicron","pi","rho","sigmaf","sigma","tau","upsilon","phi","chi","psi","omega","thetasym","upsih","piv","ensp","emsp","thinsp","zwnj","zwj","lrm","rlm","ndash","mdash","lsquo","rsquo","sbquo","ldquo","rdquo","bdquo","dagger","Dagger","bull","hellip","permil","prime","Prime","lsaquo","rsaquo","oline","frasl","euro","image","weierp","real","trade","alefsym","larr","uarr","rarr","darr","harr","crarr","lArr","uArr","rArr","dArr","hArr","forall","part","exist","empty","nabla","isin","notin","ni","prod","sum","minus","lowast","radic","infin","ang","and","or","cap","cup","int","there4","sim","cong","asymp","ne","equiv","le","ge","sub","sup","nsub","sube","supe","oplus","otimes","perp","sdot","lceil","rceil","lfloor","rfloor","lang","rang","loz","spades","clubs","hearts","diams","controlCharacters","entityPattern","lessThan","greaterThan","_Mustache","string","_parseOptions","_parser","fromId","isHashedId","isParsed","getParseOptions","createHelper","_createHelper","doParse","getPartialTemplate","named","setTemplate","partialTemplate","forceResetTemplate","RepeatedFragment","iterations","indexRef","keyRef","indexByKey","pendingNewIndices","previousIterations","createIteration","refs","getRefs","iteration","_unrenderAndDestroy","updatePostShuffle","wasArray","toRemove","oldKeys","_fragment","newLength","previousNewIndex","reinsertFrom","existingFragment","childNodes","sectionType","getType","isEmpty","SECTION_WITH","SECTION_UNLESS","SECTION_IF","SECTION_IF_WITH","SECTION_EACH","newFragment","fragmentShouldExist","elementCache","ieBug","ieBlacklist","TABLE","THEAD","TBODY","TR","SELECT","nodeType","queryResult","querySelector","queryAllResult","querySelectorAll","numNodes","j","html","insertHtml","decodeCharacterReferences","containerFragment","___prefix","isClient","prefixCache","testStyle","style","camelCase","capped","charAt","toUpperCase","substring","vendors","vendor","number","from","to","isNumeric","intermediate","min","interpolate","properties","hasOwn","unprefixPattern","vendorPattern","createTransitions","canUseCssTransitions","cannotUseCssTransitions","TRANSITION","TRANSITIONEND","CSS_TRANSITIONS_ENABLED","TRANSITION_DURATION","TRANSITION_PROPERTY","TRANSITION_TIMING_FUNCTION","webkitTransition","changedProperties","setTimeout","checkComplete","jsTransitionsComplete","cssTransitionsComplete","isIntro","transitionEndHandler","unprefix","hashPrefix","hyphenate","duration","hash","originalValue","propertiesToTransitionInJs","suffix","getStyle","parseFloat","Ticker","step","_prop","delay","visible","hidden","__prefix","_i","onChange","onHide","onShow","getComputedStyle","legacy","resolved","params","animateStyle","setStyle","fulfil","computedStyle","current","props","processParams","originalStyle","completed","noReset","resetStyle","_manager","twowayBinding","isUnresolved","forceResolution","warnAboutAmbiguity","parentForm","findParentForm","registerTwowayBinding","locked","unregisterTwowayBinding","GenericBinding","timeout","handleDelay","handleBlur","SingleSelectBinding","disabled","setValue","MultipleSelectBinding","selectedValues","previousValue","arrayContentsMatch","initialValue","NumericBinding","_GenericBinding","isNaN","CheckboxBinding","siblings","RadioBinding","getSiblings","groups","BindingGroup","bindings","CheckboxNameBinding","checkboxName","getBindingGroup","_getGroupValue","noInitialValue","existingValue","bindingValue","wasChecked","isChecked","arrayContains","getGroupValue","subscribers","_subs","joinAll","splitKeypath","observer","observers","createObserver","keypaths","wildcardIndex","_model","getComparator","JSON","stringify","thing","promise","comparator","compare","getElement","isDetached","fireInsertHook","otherNode","compareDocumentPosition","bitmask","b","ancestryA","getAncestry","ancestryB","oldestA","lastItem","oldestB","mutualAncestor","fragmentA","fragmentB","indexA","indexB","fragments","getParent","ancestry","ancestor","_liveComponentQueries","_liveQueries","getOptions","_add","_wrap","superMethod","force","needsSuper","hasSuper","_super","unwrap","Child","addRegistries","addOtherOptions","_Parent","addRegistry","_method","reduce","extendOne","computed","namespaces",{"end":{"file":"ractive.runtime.js","comments_before":[],"nlb":false,"endpos":499,"endcol":12,"endline":19,"pos":495,"col":8,"line":19,"value":"html","type":"name"},"start":{"file":"ractive.runtime.js","comments_before":[],"nlb":false,"endpos":499,"endcol":12,"endline":19,"pos":495,"col":8,"line":19,"value":"html","type":"name"},"name":"html"},"mathml","xlink","xml","xmlns","window","document","hasConsole","warn","log","printWarning","welcome","implementation","hasFeature","append","preserveWhitespace","sanitize","stripComments","delimiters","tripleDelimiters","modifyArrays","noIntro","alreadyWarned","welcomeIntro","welcomeMessage","hasGroup","subClass","superClass","TypeError","enumerable","setPrototypeOf","Constructor","deprecations","deprecated","replacement","deprecate","arg","__toString","TransitionManager","intros","outros","totalChildren","outroChildren","detachQueue","decoratorQueue","outrosComplete","addChild","list","addDecorator","decrementOutros","check","decrementTotal","detachNodes","_teardown","_detach","_detachNodes","ready","PENDING","FULFILLED","REJECTED","dispatchHandlers","makeResolver","reject","fulfilledHandlers","rejectedHandlers","state","newState","makeDispatcher","wait","then","onFulfilled","onRejected","promise2","processResolutionHandler","forward","p1result","__resolve","all","promises","processPromise","reason","_div","methodNames","unprefixed","prefixed","__i","makeFunction","changeHook","batch","returnPromise","fulfilPromise","previousBatch","transitionManager","tasks","immediateObservers","deferredObservers","flushChanges","addToArray","registerDecorator","task","postRender","_batch","refPattern","updateHook","arrayProto","_unrenderHook","badArguments","noRegistryFunctionReturn","_teardownHook","_errorMessage","ns","createElementNS","substr","cloneNode","desc","F","Parser","ParseError","leadingWhitespace","lineStart","lines","lineEnds","line","lineEnd","read","leftover","remaining","postProcess","converters","getLinePos","char","columnNum","lineNum","numTabs","annotation","match","character","shortMessage","matchString","matchPattern","allowWhitespace","nextChar","stringMiddlePattern","escapeSequencePattern","lineContinuationPattern","requestAnimationFrame","NUMBER_LITERAL","STRING_LITERAL","REFERENCE","getSingleQuotedString","makeQuotedStringMatcher","getDoubleQuotedString","_numberPattern","identifier","specials","true","false","null","specialsPattern","numberPattern","placeholderPattern","placeholderAtStartPattern","onlyWhitespace","JsonParser","parser","placeholder","special","stringLiteral","readStringLiteral","$1","pair","getKeyValuePair","valueToken","reference","normalise","addUnresolved","attemptResolution","resolveAmbiguousReference","unresolved","KeypathModel","dependant","KeyModel","_stack","captureGroup","lastTime","currTime","timeToCall","max","getTime","performance","tickers","running","tick","elapsed","eased","abort","prefixers","hasProp","originatingModel","indexModels","unresolvedByKey","ticker","adaptor","getPrefixer","applyValue","parentValue","createBranch","previousOriginatingModel","specificKey","hasKey","branch","discard","existingMatches","_loop","member","getIndexModel","fragmentIndex","getKeyModel","keypathModel","oldArray","newArray","oldLength","usedIndices","firstUnusedIndex","_merged","dep","updateKeypathDependants","_updateFromBindings","_updateKeypathDependants","functionCache","ExpressionProxy","__getValue","ReferenceExpressionProxy","base","baseResolver","members","global","factory","exports","module","define","amd","format","logIfDebug","_len2","_key2","warnOnce","_len3","_key3","isFinite","arrayLike","tm","called","resolvePromise","rejectPromise","y","_dispatch","spliceArguments","removeStart","removeEnd","balance","getSpliceEquivalent","touchedFrom","_set","output","getElementById","removeChild","sources","okQuote","literal","done","next","charCodeAt","readNumberLiteral","readKey","token","guid","counter","placeholderId","badReference","localViewmodel","hasContextChain","crossedComponentBoundary","prefixKeypath","prefix","rootKeypath","rootDot","relativeKeypath","repeater","parts","Function","rx","entity","code","parseInt","fromCharCode","validateCode","parseOptions","helper","noThrow","textContent","val","registryName","findInstance","partial","getPartialFromRegistry","findParentPartial","findOwner","findConstructor","hasIndexRef","selectedOption","_element","selectedIndex","firstChild","hyphenatedStr","interpol","description","clearTimeout","_getValue","bindName","bindChecked","getPotentialWildcardMatches","starMap","mapper","wildcardKeypath","getStarMap","star","num","binary","l","ones","digit","enqueue","_eventQueue","dequeue","_noArg","getWildcardNames","fireEventAs","initialFire","notifySubscribers","fullName","originalEvent","stopEvent","preventDefault","stopPropagation","haystack","needle","updateId","updateMultipleSelectValue","updateSelectValue","updateValue","updateContentEditableValue","updateRadioValue","updateRadioName","updateCheckboxName","updateIEStyleAttribute","updateProperty","updateNamespacedAttribute","updateAttribute","updateClassName","valueAttribute","className","setAttributeNS","colonIndex","namespacePrefix","typeAttribute","nameAttribute","_updateModel","hookQueue","childQueue","initial","existingPartials","newPartials","overwrite","validate","childValue","parentIsFn","childIsFn","callDataFunction","fromProperties","primary","secondary","extractString","unit","transformSelector","selectorUnits","modifiers","transformed","appended","prepended","dataAttr","selectors","getMessage","correct","isError","deprecateOption","deprecatedOption","getSuperMethod","_parent","oldSuper","_ret","extendOtherMethods","userOptions","createFunctionFromString","hasThis","getComputationSignature","setterString","fnBody","tabs","minIndent","prev","Infinity","truncated","_ref","initialiseProperties","deprecateRactiveData","getAdaptors","combine","protoAdapt","lookup","magic$$","getComponentConstructor","ElementConstructor","collect","dest","_forceResetTemplate","collection","rerender","others","listener","notEmptyString","_trim","listeners"],"mappings":"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C,OAAQ,IAAKC,MAAO,IAAKC,OAAQ,IAAKC,KAAM,IAAKC,MAAO,IAAKC,MAAO,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,MAAO,IAAKC,KAAM,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,MAAO,IAAKC,KAAM,IAAKC,IAAK,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,MAAO,IAAKC,OAAQ,IAAKC,KAAM,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,MAAO,IAAKC,KAAM,IAAKC,OAAQ,IAAKC,MAAO,IAAKC,KAAM,IAAKC,MAAO,IAAKC,MAAO,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,KAAM,IAAKC,KAAM,IAAKC,KAAM,IAAKC,MAAO,IAAKC,MAAO,IAAKC,KAAM,IAAKC,MAAO,IAAKC,MAAO,IAAKC,QAAS,IAAKC,KAAM,IAAKC,IAAK,IAAKC,MAAO,IAAKC,KAAM,IAAKC,MAAO,IAAKC,OAAQ,IAAKC,GAAI,IAAKC,GAAI,IAAKC,GAAI,IAAKC,QAAS,IAAKC,GAAI,IAAKC,IAAK,IAAKC,MAAO,IAAKC,IAAK,IAAKC,QAAS,IAAKC,IAAK,IAAKC,IAAK,IAAKC,IAAK,IAAKC,MAAO,IAAKC,MAAO,IAAKC,KAAM,IAAKC,MAAO,IAAKC,MAAO,IAAKC,QAAS,IAAKC,KAAM,IAAKC,IAAK,IAAKC,MAAO,IAAKC,KAAM,IAAKC,MAAO,IAAKC,OAAQ,IAAKC,GAAI,IAAKC,GAAI,IAAKC,GAAI,IAAKC,QAAS,IAAKC,GAAI,IAAKC,IAAK,IAAKC,OAAQ,IAAKC,MAAO,IAAKC,IAAK,IAAKC,QAAS,IAAKC,IAAK,IAAKC,IAAK,IAAKC,IAAK,IAAKC,MAAO,IAAKC,SAAU,IAAKC,MAAO,IAAKC,IAAK,IAAKC,KAAM,KAAMC,KAAM,KAAMC,OAAQ,KAAMC,KAAM,KAAMC,IAAK,KAAMC,IAAK,KAAMC,IAAK,KAAMC,MAAO,KAAMC,MAAO,KAAMC,MAAO,KAAMC,MAAO,KAAMC,MAAO,KAAMC,MAAO,KAAMC,MAAO,KAAMC,MAAO,KAAMC,OAAQ,KAAMC,OAAQ,KAAMC,KAAM,KAAMC,OAAQ,KAAMC,OAAQ,KAAMC,MAAO,KAAMC,MAAO,KAAMC,OAAQ,KAAMC,OAAQ,KAAMC,MAAO,KAAMC,MAAO,KAAMC,KAAM,KAAMC,MAAO,KAAMC,OAAQ,KAAMC,KAAM,KAAMC,MAAO,KAAMC,QAAS,KAAMC,KAAM,KAAMC,KAAM,KAAMC,KAAM,KAAMC,KAAM,KAAMC,KAAM,KAAMC,MAAO,KAAMC,KAAM,KAAMC,KAAM,KAAMC,KAAM,KAAMC,KAAM,KAAMC,KAAM,KAAMC,OAAQ,KAAMC,KAAM,KAAMC,MAAO,KAAMC,MAAO,KAAMC,MAAO,KAAMC,KAAM,KAAMC,MAAO,KAAMC,GAAI,KAAMC,KAAM,KAAMC,IAAK,KAAMC,MAAO,KAAMC,OAAQ,KAAMC,MAAO,KAAM7W,KAAM,KAAM8W,MAAO,KAAMC,IAAK,KAAMC,IAAK,KAAMC,GAAI,KAAMC,IAAK,KAAMC,IAAK,KAAMC,MAAO,KAAMC,OAAQ,KAAMC,IAAK,KAAMC,KAAM,KAAMC,MAAO,KAAMC,GAAI,KAAMC,MAAO,KAAMC,GAAI,KAAMC,GAAI,KAAMC,IAAK,KAAMC,IAAK,KAAMC,KAAM,KAAMC,KAAM,KAAMC,KAAM,KAAMC,MAAO,KAAMC,OAAQ,KAAMC,KAAM,KAAMC,KAAM,KAAMC,MAAO,KAAMC,MAAO,KAAMC,OAAQ,KAAMC,OAAQ,KAAMC,KAAM,KAAMC,KAAM,KAAMC,IAAK,KAAMC,OAAQ,KAAMC,MAAO,KAAMC,OAAQ,KAAMC,MAAO,MAC/9FC,IAAqB,KAAM,IAAK,KAAM,IAAK,KAAM,KAAM,KAAM,KAAM,IAAK,KAAM,IAAK,KAAM,IAAK,IAAK,IAAK,IAAK,IAAK,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,IAAK,KAAM,IAAK,KAAM,IAAK,IAAK,IAAK,KACjMC,GAAgB,GAAI9tB,QAAO,0BAA4BrM,OAAOC,KAAKoqB,IAAchhB,KAAK,KAAO,OAAQ,KAuBrG+wB,GAAW,KACXC,GAAc,KACd9P,GAAM,KAkDN3mB,GAAe,SAAW02B,GAG7B,QAAS12B,KACRpB,GAAe1D,KAAM8E,GAErB02B,EAAUxtB,MAAMhO,KAAM+V,WA8CvB,MAnDAjS,IAASgB,EAAc02B,GAQvB12B,EAAazE,UAAU2D,OAAS,WAC/B,MAAOC,IAAWjE,KAAKkE,OAGxBY,EAAazE,UAAU8D,UAAY,WAClC,MAAOnE,MAAKkE,MAGbY,EAAazE,UAAUkb,UAAY,WAClC,MAAOvb,MAAKR,MAAQuc,GAAkB/b,KAAKR,MAAM+M,OAAS,IAG3DzH,EAAazE,UAAUC,OAAS,SAAgBC,GAC/CP,KAAKc,UAAW,EAChBd,KAAKkE,KAAOE,GAAIC,eAAerE,KAAKub,aAEpChb,EAAO+D,YAAYtE,KAAKkE,OAGzBY,EAAazE,UAAUyB,SAAW,SAAkByC,GACnD,GAAIk3B,GAASz7B,KAAKub,WAClB,OAAOhX,GAASC,GAAWi3B,GAAUA,GAGtC32B,EAAazE,UAAUuC,SAAW,SAAkBC,GAC/CA,GAAe7C,KAAKgE,SACxBhE,KAAKc,UAAW,GAGjBgE,EAAazE,UAAU8C,OAAS,WAC3BnD,KAAKqD,QACJrD,KAAKc,WACRd,KAAKkE,KAAK6d,KAAO/hB,KAAKub,aAGvBvb,KAAKqD,OAAQ,IAIfyB,EAAazE,UAAUoE,QAAU,WAChC,MAAOzE,MAAKR,MAAQQ,KAAKR,MAAM+M,MAAQpE,QAGjCrD,GACLwmB,IAECnX,GAAQ,KAERunB,IAAiB,qBAAsB,WAAY,gBAAiB,aAAc,mBAAoB,eAEtGC,IACHC,OAAQA,GAAQC,WAAYA,GAAYC,SAAUA,GAAUC,gBAAiBA,GAAiBC,aAAcC,GAC5G9nB,MAAO+nB,IAiLJl3B,GAAU,SAAWw2B,GAGxB,QAASx2B,KACRtB,GAAe1D,KAAMgF,GAErBw2B,EAAUxtB,MAAMhO,KAAM+V,WA6GvB,MAlHAjS,IAASkB,EAASw2B,GAQlBx2B,EAAQ3E,UAAU0D,KAAO,WACxBy3B,EAAUn7B,UAAU0D,KAAKJ,KAAK3D,KAG9B,IAAIoB,GAAWpB,KAAKoB,SAAS4V,EAAImlB,GAAmBn8B,KAAKuG,QAASvG,KAAKoB,SAAS4V,EAAGhX,KAAKN,iBAAmB,KAAO,IAE9G0B,IACHpB,KAAKo8B,OAAQ,EACbp8B,KAAKq8B,YAAYr8B,KAAKoB,SAAS4V,EAAG5V,IACtBpB,KAAKR,OAAqC,gBAArBQ,MAAKR,MAAM+M,QAAuBvM,KAAKoB,SAAS4V,EAGjFhX,KAAKq8B,YAAYr8B,KAAKR,MAAM+M,OAF5BvM,KAAKq8B,YAAYr8B,KAAKoB,SAAS4V,EAAG5V,GAKnCpB,KAAKE,SAAW,GAAIiG,KACnBC,MAAOpG,KACPoB,SAAUpB,KAAKs8B,kBACbv4B,QAGJiB,EAAQ3E,UAAU2D,OAAS,WAC1B,MAAOhE,MAAKE,SAAS8D,UAGtBgB,EAAQ3E,UAAUyH,KAAO,SAAcC,GACtC,MAAO/H,MAAKE,SAAS4H,KAAKC,IAG3B/C,EAAQ3E,UAAUgI,QAAU,SAAiBN,EAAU9E,GACtDjD,KAAKE,SAASmI,QAAQN,EAAU9E,IAGjC+B,EAAQ3E,UAAUiI,cAAgB,SAAuBC,GACxD,MAAOvI,MAAKE,SAASoI,cAAcC,IAGpCvD,EAAQ3E,UAAUmI,kBAAoB,SAA2BD,EAAMtF,GACtEjD,KAAKE,SAASsI,kBAAkBD,EAAMtF,IAGvC+B,EAAQ3E,UAAU8D,UAAY,WAC7B,MAAOnE,MAAKE,SAASiE,aAGtBa,EAAQ3E,UAAUk8B,mBAAqB,WACtCv8B,KAAKs8B,gBAAkBH,GAAmBn8B,KAAKuG,QAASvG,KAAKuI,KAAMvI,KAAKN,gBAEnEM,KAAKs8B,kBACTrR,EAAgB,wCAA2CjrB,KAAKuI,KAAO,KACvEvI,KAAKs8B,oBAGNt8B,KAAKE,SAASwJ,cAAc1J,KAAKs8B,iBACjCt8B,KAAKqH,UAGNrC,EAAQ3E,UAAUF,OAAS,WAC1Bq7B,EAAUn7B,UAAU2B,OAAO2B,KAAK3D,MAChCw7B,EAAUn7B,UAAU0D,KAAKJ,KAAK3D,MAC9BA,KAAKE,SAASC,UAGf6E,EAAQ3E,UAAUC,OAAS,SAAgBC,GAC1CP,KAAKE,SAASI,OAAOC,IAGtByE,EAAQ3E,UAAUg8B,YAAc,SAAqB9zB,EAAMnH,GAC1DpB,KAAKuI,KAAOA,EAEPnH,GAAyB,OAAbA,IAAmBA,EAAW+6B,GAAmBn8B,KAAKuG,QAASgC,EAAMvI,KAAKN,iBAEtF0B,GACJ6pB,EAAgB,wCAA2C1iB,EAAO,KAGnEvI,KAAKs8B,gBAAkBl7B,OAGxB4D,EAAQ3E,UAAUyB,SAAW,SAAkByC,GAC9C,MAAOvE,MAAKE,SAAS4B,SAASyC,IAG/BS,EAAQ3E,UAAU2B,OAAS,WAC1Bw5B,EAAUn7B,UAAU2B,OAAO2B,KAAK3D,MAChCA,KAAKE,SAAS8B,UAGfgD,EAAQ3E,UAAUuC,SAAW,SAAkBC,GAC9C7C,KAAKE,SAAS0C,SAASC,IAGxBmC,EAAQ3E,UAAU8C,OAAS,WACtBnD,KAAKqD,QACHrD,KAAKo8B,OACLp8B,KAAKR,OAAqC,gBAArBQ,MAAKR,MAAM+M,OAAsBvM,KAAKR,MAAM+M,QAAUvM,KAAKuI,OACnFvI,KAAKq8B,YAAYr8B,KAAKR,MAAM+M,OAC5BvM,KAAKE,SAASwJ,cAAc1J,KAAKs8B,kBAInCt8B,KAAKE,SAASiD,SACdnD,KAAKqD,OAAQ,IAIR2B,GACLsmB,IAkBCkR,GAAmB,WACtB,QAASA,GAAiB/4B,GACzBC,GAAe1D,KAAMw8B,GAErBx8B,KAAKsG,OAAS7C,EAAQ2C,MAAM1G,eAI5BM,KAAKN,eAAiBM,KACtBA,KAAKoG,MAAQ3C,EAAQ2C,MACrBpG,KAAKuG,QAAUvG,KAAKsG,OAAOC,QAE3BvG,KAAK0G,QAAU,KACf1G,KAAKc,UAAW,EAChBd,KAAKy8B,cAELz8B,KAAKoB,SAAWqC,EAAQrC,SAExBpB,KAAK08B,SAAWj5B,EAAQi5B,SACxB18B,KAAK28B,OAASl5B,EAAQk5B,OACtB38B,KAAK48B,WAAa,KAElB58B,KAAK68B,kBAAoB,KACzB78B,KAAK88B,mBAAqB,KAG1B98B,KAAKwM,SAAU,EA+VhB,MA5VAgwB,GAAiBn8B,UAAU0D,KAAO,SAAc2C,GAC/C,GAAIc,GAAQxH,IAEZA,MAAK0G,QAAUA,CACf,IAAI8C,GAAQ9C,EAAQ6F,KAGpB,IAAIvM,KAAKwM,QAAUA,EAAQhD,GAAQ,CAElCxJ,KAAKy8B,aACL,KAAK,GAAIv0B,GAAI,EAAGA,EAAIsB,EAAMvB,OAAQC,GAAK,EACtClI,KAAKy8B,WAAWv0B,GAAKlI,KAAK+8B,gBAAgB70B,EAAGA,OAK1C,IAAI8Z,EAASxY,GAAQ,CAIxB,GAHAxJ,KAAKwM,SAAU,EAGXxM,KAAK08B,SAAU,CAClB,GAAIM,GAAOh9B,KAAK08B,SAASl7B,MAAM,IAC/BxB,MAAK28B,OAASK,EAAK,GACnBh9B,KAAK08B,SAAWM,EAAK,GAGtBh9B,KAAK48B,cACL58B,KAAKy8B,WAAav7B,OAAOC,KAAKqI,GAAOzJ,IAAI,SAAUuB,EAAKmG,GAEvD,MADAD,GAAMo1B,WAAWt7B,GAAOmG,EACjBD,EAAMu1B,gBAAgBz7B,EAAKmG,KAIrC,MAAOzH,OAGRw8B,EAAiBn8B,UAAUgH,OAAS,WACnCrH,KAAKoG,MAAMiB,UAGZm1B,EAAiBn8B,UAAU08B,gBAAkB,SAAyBz7B,EAAKmG,GAC1E,GAAI/H,GAAiBM,KAAKoG,MAAM1G,eAC5BkH,EAAUq2B,GAAQj9B,KAAK28B,OAAQr7B,EAAK5B,EAAekH,SACnDD,EAAYs2B,GAAQj9B,KAAK08B,SAAUj1B,EAAO/H,EAAeiH,WAEzDzG,EAAW,GAAIiG,KAClBC,MAAOpG,KACPoB,SAAUpB,KAAKoB,SACfuF,UAAWA,EACXC,QAASA,GAIV1G,GAASoB,IAAMA,EACfpB,EAASuH,MAAQA,EACjBvH,EAAS6I,aAAc,CAEvB,IAAIvJ,GAAQQ,KAAK0G,QAAQ9G,QAAQ0B,EACjC,OAAOpB,GAAS6D,KAAKvE,IAGtBg9B,EAAiBn8B,UAAU2D,OAAS,WACnC,GAAI2D,GAAUC,IAId,OAHA5H,MAAKy8B,WAAW97B,QAAQ,SAAUT,GACjC,MAAOyH,GAAQrD,YAAYpE,EAAS8D,YAE9B2D,GAGR60B,EAAiBn8B,UAAUyH,KAAO,SAAcC,GAC/C,GAAIC,GAAMhI,KAAKy8B,WAAWx0B,OACtBC,EAAIC,MAER,KAAKD,EAAI,EAAOF,EAAJE,EAASA,GAAK,EAAG,CAC5B,GAAIE,GAAQpI,KAAKy8B,WAAWv0B,GAAGJ,KAAKC,EACpC,IAAIK,EAAO,MAAOA,KAIpBo0B,EAAiBn8B,UAAUgI,QAAU,SAAiBN,EAAU9E,GAC/D,GAAI+E,GAAMhI,KAAKy8B,WAAWx0B,OACtBC,EAAIC,MAER,KAAKD,EAAI,EAAOF,EAAJE,EAASA,GAAK,EACzBlI,KAAKy8B,WAAWv0B,GAAGG,QAAQN,EAAU9E,IAIvCu5B,EAAiBn8B,UAAUiI,cAAgB,SAAuBC,GACjE,GAAIP,GAAMhI,KAAKy8B,WAAWx0B,OACtBC,EAAIC,MAER,KAAKD,EAAI,EAAOF,EAAJE,EAASA,GAAK,EAAG,CAC5B,GAAIE,GAAQpI,KAAKy8B,WAAWv0B,GAAGI,cAAcC,EAC7C,IAAIH,EAAO,MAAOA,KAIpBo0B,EAAiBn8B,UAAUmI,kBAAoB,SAA2BD,EAAMtF,GAC/E,GAAI+E,GAAMhI,KAAKy8B,WAAWx0B,OACtBC,EAAIC,MAER,KAAKD,EAAI,EAAOF,EAAJE,EAASA,GAAK,EACzBlI,KAAKy8B,WAAWv0B,GAAGM,kBAAkBD,EAAMtF,IAI7Cu5B,EAAiBn8B,UAAUoI,aAAe,SAAsBy0B,GAC/D,MAAIA,GAAUz1B,MAAQzH,KAAKy8B,WAAWx0B,OAAS,EACvCjI,KAAKy8B,WAAWS,EAAUz1B,MAAQ,GAAGtD,YAGtCnE,KAAKoG,MAAMqC,gBAGnB+zB,EAAiBn8B,UAAU8D,UAAY,WACtC,MAAOnE,MAAKy8B,WAAW,GAAKz8B,KAAKy8B,WAAW,GAAGt4B,YAAc,MAG9Dq4B,EAAiBn8B,UAAUF,OAAS,SAAgBuG,GACnD1G,KAAK0G,QAAUA,EAGX8F,EAAQ9F,EAAQ6F,QACnBvM,KAAKy8B,WAAW97B,QAAQ,SAAUT,EAAUgI,GAC3ChI,EAASC,OAAOuG,EAAQ9G,QAAQsI,OAKnCs0B,EAAiBn8B,UAAUC,OAAS,SAAgBC,GAG/CP,KAAKy8B,YACRz8B,KAAKy8B,WAAW97B,QAAQ,SAAUT,GACjC,MAAOA,GAASI,OAAOC,KAIzBP,KAAKc,UAAW,GAGjB07B,EAAiBn8B,UAAUsL,QAAU,SAAiBI,GACrD,GAAIoB,GAASnN,IAEb,IAAIA,KAAK68B,kBACR,KAAM,IAAIh0B,OAAM,gCAGjB7I,MAAK68B,kBAAoB9wB,EACzB/L,KAAK88B,mBAAqB98B,KAAKy8B,WAAW5wB,OAE1C,IAAI4wB,KAEJ1wB,GAAWpL,QAAQ,SAAU0L,EAAUC,GACtC,GAAiB,KAAbD,EAAJ,CAEA,GAAInM,GAAWiN,EAAOsvB,WAAWnwB,EACjCmwB,GAAWpwB,GAAYnM,EAEnBmM,IAAaC,IAAUpM,EAASmD,OAAQ,MAG7CrD,KAAKy8B,WAAaA,EAClBz8B,KAAKqH,UAGNm1B,EAAiBn8B,UAAUyB,SAAW,SAAkByC,GACvD,MAAOvE,MAAKy8B,WAAaz8B,KAAKy8B,WAAW18B,IAAIwE,EAAS8F,EAAkBC,GAAWC,KAAK,IAAM,IAG/FiyB,EAAiBn8B,UAAU2B,OAAS,WAEnC,MADAhC,MAAKy8B,WAAW97B,QAAQuB,GACjBlC,MAGRw8B,EAAiBn8B,UAAUuC,SAAW,SAAkBC,GACvD7C,KAAKy8B,WAAW97B,QAAQkC,EAAgBs6B,EAAsBp6B,GAC9D/C,KAAKc,UAAW,GAKjB07B,EAAiBn8B,UAAU8C,OAAS,WACnC,GAAI1D,GAASO,IAIb,IAAIA,KAAK68B,kBAER,WADA78B,MAAKo9B,mBAIN,IAAI5zB,GAAQxJ,KAAK0G,QAAQ6F,MACrB8wB,EAAWr9B,KAAKwM,QAEhB8wB,EAAWn1B,OACXo1B,EAAUp1B,OACVwJ,GAAQ,EACRzJ,EAAIC,MAER,IAAInI,KAAKwM,QAAUA,EAAQhD,GACtB6zB,IACH1rB,GAAQ,EACJ3R,KAAKy8B,WAAWx0B,OAASuB,EAAMvB,SAClCq1B,EAAWt9B,KAAKy8B,WAAW9tB,OAAOnF,EAAMvB,cAGpC,IAAI+Z,EAASxY,KAAW6zB,EAM9B,IALA1rB,GAAQ,EACR2rB,KACAC,KACAr1B,EAAIlI,KAAKy8B,WAAWx0B,OAEbC,KAAK,CACX,GAAIs1B,GAAYx9B,KAAKy8B,WAAWv0B,EAC5Bs1B,GAAUl8B,MAAOkI,GACpB+zB,EAAQC,EAAUl8B,MAAO,GAEzBtB,KAAKy8B,WAAW9tB,OAAOzG,EAAG,GAC1Bo1B,EAAS17B,KAAK47B,IAKb7rB,IACH2rB,EAAWt9B,KAAKy8B,WAChBz8B,KAAKy8B,eAGFa,GACHA,EAAS38B,QAAQ,SAAUT,GAC1BA,EAAS8B,SACT9B,EAAS0C,UAAS,KAKpB5C,KAAKy8B,WAAW97B,QAAQyC,EAGxB,IAAIq6B,GAAYjxB,EAAQhD,GAASA,EAAMvB,OAAS+Z,EAASxY,GAAStI,OAAOC,KAAKqI,GAAOvB,OAAS,EAE1FN,EAAUQ,OACVjI,EAAWiI,MAEf,IAAIs1B,EAAYz9B,KAAKy8B,WAAWx0B,OAAQ,CAIvC,GAHAN,EAAU3H,KAAKc,SAAW8G,KAA2B,KACrDM,EAAIlI,KAAKy8B,WAAWx0B,OAEhBuE,EAAQhD,GACX,KAAOtB,EAAIsB,EAAMvB,QAChB/H,EAAWF,KAAK+8B,gBAAgB70B,EAAGA,GAEnClI,KAAKy8B,WAAW76B,KAAK1B,GACjBF,KAAKc,UAAUZ,EAASI,OAAOqH,GAEnCO,GAAK,MAEI8Z,GAASxY,IACnBtI,OAAOC,KAAKqI,GAAO7I,QAAQ,SAAUW,GAC/Bi8B,GAAaj8B,IAAOi8B,KACxBr9B,EAAWT,EAAOs9B,gBAAgBz7B,EAAK4G,GAEvCzI,EAAOg9B,WAAW76B,KAAK1B,GACnBT,EAAOqB,UAAUZ,EAASI,OAAOqH,GAErCO,GAAK,IAKR,IAAIlI,KAAKc,SAAU,CAClB,GAAI+I,GAAa7J,KAAKsG,OAAOqC,iBACzBmB,EAAS9J,KAAKsG,OAAOmC,aAAazI,KAAKoG,MAE3CyD,GAAWE,aAAapC,EAASmC,MAKpC0yB,EAAiBn8B,UAAU+8B,kBAAoB,WAC9C,GAAIp8B,GAAShB,KAET+L,EAAa/L,KAAK68B,kBAKlBa,EAAmB,GACnBC,EAAe,IAEnB5xB,GAAWpL,QAAQ,SAAU0L,EAAUC,GACtC,GAAIpM,GAAWc,EAAO87B,mBAAmBxwB,EAExB,MAAbD,EACHnM,EAAS8B,SAASY,UAAS,IAE3B1C,EAASuH,MAAQ4E,EACjBnM,EAASC,OAAOa,EAAO0F,QAAQ9G,QAAQyM,IAElB,OAAjBsxB,GAAyBtxB,IAAaqxB,EAAmB,IAC5DC,EAAerxB,IAIjBoxB,EAAmBrxB,GAIpB,IAAI1E,GAAU3H,KAAKc,SAAW8G,KAA2B,KACrDiC,EAAa7J,KAAKc,SAAWd,KAAKsG,OAAOqC,iBAAmB,KAE5DX,EAAMhI,KAAK0G,QAAQ6F,MAAMtE,OACzBC,EAAIC,MAER,KAAKD,EAAI,EAAOF,EAAJE,EAASA,GAAK,EAAG,CAC5B,GAAI01B,GAAmB59B,KAAKy8B,WAAWv0B,EAEnClI,MAAKc,WACJ88B,EACkB,OAAjBD,GAAyBz1B,GAAKy1B,EACjCh2B,EAAQrD,YAAYs5B,EAAiB55B,UAC3B2D,EAAQk2B,WAAW51B,QAC7B4B,EAAWE,aAAapC,EAASi2B,EAAiBz5B,cAGnDnE,KAAKy8B,WAAWv0B,GAAKlI,KAAK+8B,gBAAgB70B,EAAGA,GAC7ClI,KAAKy8B,WAAWv0B,GAAG5H,OAAOqH,KAIvB3H,KAAKc,UACJ88B,IACJ59B,KAAKy8B,WAAWv0B,GAAKlI,KAAK+8B,gBAAgB70B,EAAGA,IAK5ClI,KAAKc,UAAY6G,EAAQk2B,WAAW51B,QACvC4B,EAAWE,aAAapC,EAAS3H,KAAKoG,MAAMqC,gBAG7CzI,KAAKy8B,WAAW97B,QAAQyC,GAExBpD,KAAK68B,kBAAoB,MAGnBL,KAcJt3B,GAAU,SAAWs2B,GAGxB,QAASt2B,GAAQzB,GAChBC,GAAe1D,KAAMkF,GAErBs2B,EAAU73B,KAAK3D,KAAMyD,GAErBzD,KAAK89B,YAAcr6B,EAAQrC,SAASoW,GAAK,KACzCxX,KAAKE,SAAW,KA2NjB,MAnOA4D,IAASoB,EAASs2B,GAWlBt2B,EAAQ7E,UAAU0D,KAAO,WAIxB,GAHAy3B,EAAUn7B,UAAU0D,KAAKJ,KAAK3D,MAG1BA,KAAKR,MAAO,CACf,GAAIgK,GAAQxJ,KAAKR,MAAM8G,OAAStG,KAAKR,MAAM+M,MAAQvM,KAAKR,MAAMgK,MAC1DtJ,EAAWiI,MAIf,IAFKnI,KAAK89B,cAAa99B,KAAK89B,YAAcC,GAAQv0B,EAAOxJ,KAAKoB,SAAS8G,IAEnE81B,GAAQx0B,IAAUxJ,KAAK89B,cAAgBG,GAU1C,YARIj+B,KAAK89B,cAAgBI,KACxBl+B,KAAKE,SAAW,GAAIiG,KACnBC,MAAOpG,KACPoB,SAAUpB,KAAKoB,SAASsb,IACtB3Y,QAOL,IAAI/D,KAAK89B,cAAgBI,GAAgB,MAGxCh+B,GADGF,KAAK89B,cAAgBK,GACb,GAAIh4B,KACdC,MAAOpG,KACPoB,SAAUpB,KAAKoB,SAASsb,IACtB3Y,OAIK/D,KAAK89B,cAAgBG,IAAgBj+B,KAAK89B,cAAgBM,GACtD,GAAIj4B,KACdC,MAAOpG,KACPoB,SAAUpB,KAAKoB,SAASsb,IACtB3Y,KAAK/D,KAAKR,OAEF,GAAIg9B,KACdp2B,MAAOpG,KACPoB,SAAUpB,KAAKoB,SAASsb,EACxBggB,SAAU18B,KAAKoB,SAAS8G,IACtBnE,KAAK/D,KAAKR,OAGfQ,KAAKE,SAAWA,MACNF,MAAK89B,aAAe99B,KAAK89B,cAAgBI,KACnDl+B,KAAKE,SAAW,GAAIiG,KACnBC,MAAOpG,KACPoB,SAAUpB,KAAKoB,SAASsb,IACtB3Y,SAILmB,EAAQ7E,UAAU2D,OAAS,WAC1B,MAAOhE,MAAKE,SAAWF,KAAKE,SAAS8D,SAAW4D,MAGjD1C,EAAQ7E,UAAUyH,KAAO,SAAcC,GACtC,MAAI/H,MAAKE,SACDF,KAAKE,SAAS4H,KAAKC,GAD3B,QAKD7C,EAAQ7E,UAAUgI,QAAU,SAAiBN,EAAU9E,GAClDjD,KAAKE,UACRF,KAAKE,SAASmI,QAAQN,EAAU9E,IAIlCiC,EAAQ7E,UAAUiI,cAAgB,SAAuBC,GACxD,MAAIvI,MAAKE,SACDF,KAAKE,SAASoI,cAAcC,GADpC,QAKDrD,EAAQ7E,UAAUmI,kBAAoB,SAA2BD,EAAMtF,GAClEjD,KAAKE,UACRF,KAAKE,SAASsI,kBAAkBD,EAAMtF,IAIxCiC,EAAQ7E,UAAU8D,UAAY,WAC7B,MAAOnE,MAAKE,UAAYF,KAAKE,SAASiE,aAGvCe,EAAQ7E,UAAUF,OAAS,WAC1Bq7B,EAAUn7B,UAAUF,OAAOwD,KAAK3D,MAE5BA,KAAKE,UACRF,KAAKE,SAASC,OAAOH,KAAK89B,cAAgBK,GAAa,KAAOn+B,KAAKR,QAIrE0F,EAAQ7E,UAAUC,OAAS,SAAgBC,GAC1CP,KAAKc,UAAW,EACZd,KAAKE,UAAUF,KAAKE,SAASI,OAAOC,IAGzC2E,EAAQ7E,UAAUsL,QAAU,SAAiBI,GACxC/L,KAAKE,UAAYF,KAAK89B,cAAgBO,IACzCr+B,KAAKE,SAASyL,QAAQI,IAIxB7G,EAAQ7E,UAAUyB,SAAW,SAAkByC,GAC9C,MAAOvE,MAAKE,SAAWF,KAAKE,SAAS4B,SAASyC,GAAU,IAGzDW,EAAQ7E,UAAU2B,OAAS,WAC1Bw5B,EAAUn7B,UAAU2B,OAAO2B,KAAK3D,MAC5BA,KAAKE,UAAUF,KAAKE,SAAS8B,UAGlCkD,EAAQ7E,UAAUuC,SAAW,SAAkBC,GAC1C7C,KAAKc,UAAYd,KAAKE,UAAUF,KAAKE,SAAS0C,SAASC,GAC3D7C,KAAKc,UAAW,GAKjBoE,EAAQ7E,UAAU8C,OAAS,WAC1B,GAAKnD,KAAKqD,OACLrD,KAAKR,MAAV,CAEA,GAAIgK,GAAQxJ,KAAKR,MAAM+M,KAEE,QAArBvM,KAAK89B,cAAsB99B,KAAK89B,YAAcC,GAAQv0B,EAAOxJ,KAAKoB,SAAS8G,GAE/E,IAAIo2B,GAAcn2B,MAElB,IAAInI,KAAK89B,cAAgBO,GACpBr+B,KAAKE,SACRF,KAAKE,SAASiD,SAGdm7B,EAAc,GAAI9B,KACjBp2B,MAAOpG,KACPoB,SAAUpB,KAAKoB,SAASsb,EACxBggB,SAAU18B,KAAKoB,SAAS8G,IACtBnE,KAAK/D,KAAKR,WAKV,IAAIQ,KAAK89B,cAAgBG,GACxBj+B,KAAKE,SACRF,KAAKE,SAASiD,SAEdm7B,EAAc,GAAIn4B,KACjBC,MAAOpG,KACPoB,SAAUpB,KAAKoB,SAASsb,IACtB3Y,KAAK/D,KAAKR,WAER,IAAIQ,KAAK89B,cAAgBM,GAC3Bp+B,KAAKE,SACJ89B,GAAQx0B,IACPxJ,KAAKc,UACRd,KAAKE,SAAS8B,SAASY,UAAS,GAGjC5C,KAAKE,SAAW,MAEhBF,KAAKE,SAASiD,SAEJ66B,GAAQx0B,KACnB80B,EAAc,GAAIn4B,KACjBC,MAAOpG,KACPoB,SAAUpB,KAAKoB,SAASsb,IACtB3Y,KAAK/D,KAAKR,YAER,CACN,GAAI++B,GAAsBv+B,KAAK89B,cAAgBI,GAAiBF,GAAQx0B,KAAWA,CAE/ExJ,MAAKE,SACJq+B,EACHv+B,KAAKE,SAASiD,UAEVnD,KAAKc,UACRd,KAAKE,SAAS8B,SAASY,UAAS,GAGjC5C,KAAKE,SAAW,MAEPq+B,IACVD,EAAc,GAAIn4B,KACjBC,MAAOpG,KACPoB,SAAUpB,KAAKoB,SAASsb,IACtB3Y,KAAK,OAIX,GAAIu6B,EAAa,CAChB,GAAIt+B,KAAKc,SAAU,CAClB,GAAI+I,GAAa7J,KAAKN,eAAeiJ,iBACjCmB,EAAS9J,KAAKN,eAAe+I,aAAazI,KAE9C,IAAI8J,EAAQ,CACX,GAAInC,GAAUC,IACd02B,GAAYh+B,OAAOqH,GAInBmC,EAAOD,WAAWE,aAAapC,EAASmC,OAExCw0B,GAAYh+B,OAAOuJ,GAIrB7J,KAAKE,SAAWo+B,EAGjBt+B,KAAKqD,OAAQ,IAGP6B,GACLomB,IAECkT,MAEAC,GAAQt2B,OACRu2B,GAAcv2B,MAElB,KACCiR,GAAc,SAASlD,UAAY,MAClC,MAAOuP,IACRgZ,IAAQ,EAERC,IACCC,OAAQ,oBAAqB,YAC7BC,OAAQ,2BAA4B,oBACpCC,OAAQ,2BAA4B,oBACpCC,IAAK,wBAAyB,iBAC9BC,QAAS,qBAAsB,cA+DjC,GAAI35B,IAAS,SAAWo2B,GAGvB,QAASp2B,GAAO3B,GACfC,GAAe1D,KAAMoF,GAErBo2B,EAAU73B,KAAK3D,KAAMyD,GA4FtB,MAjGAK,IAASsB,EAAQo2B,GAQjBp2B,EAAO/E,UAAU2D,OAAS,WACzB,GAAI2D,GAAUC,IAId,OAHA5H,MAAKwe,MAAM7d,QAAQ,SAAUuD,GAC5B,MAAOyD,GAAQrD,YAAYJ,KAErByD,GAGRvC,EAAO/E,UAAUyH,KAAO,SAAcC,GACrC,GAAIC,GAAMhI,KAAKwe,MAAMvW,OACjBC,EAAIC,MAER,KAAKD,EAAI,EAAOF,EAAJE,EAASA,GAAK,EAAG,CAC5B,GAAIhE,GAAOlE,KAAKwe,MAAMtW,EAEtB,IAAsB,IAAlBhE,EAAK86B,SAAT,CAEA,GAAI9vB,GAAQhL,EAAM6D,GAAW,MAAO7D,EAEpC,IAAI+6B,GAAc/6B,EAAKg7B,cAAcn3B,EACrC,IAAIk3B,EAAa,MAAOA,IAGzB,MAAO,OAGR75B,EAAO/E,UAAUgI,QAAU,SAAiBN,EAAU9E,GACrD,GAAI+E,GAAMhI,KAAKwe,MAAMvW,OACjBC,EAAIC,MAER,KAAKD,EAAI,EAAOF,EAAJE,EAASA,GAAK,EAAG,CAC5B,GAAIhE,GAAOlE,KAAKwe,MAAMtW,EAEtB,IAAsB,IAAlBhE,EAAK86B,SAAT,CAEI/7B,EAAMgM,KAAK/K,IAAOjB,EAAMsL,IAAIrK,EAEhC,IAAIi7B,GAAiBj7B,EAAKk7B,iBAAiBr3B,EAC3C,IAAIo3B,EAAgB,CACnB,GAAIE,GAAWF,EAAel3B,OAC1Bq3B,EAAIn3B,MAER,KAAKm3B,EAAI,EAAOD,EAAJC,EAAcA,GAAK,EAC9Br8B,EAAMsL,IAAI4wB,EAAeG,QAM7Bl6B,EAAO/E,UAAUiI,cAAgB,WAChC,MAAO,OAGRlD,EAAO/E,UAAU8D,UAAY,WAC5B,MAAOnE,MAAKwe,MAAM,IAGnBpZ,EAAO/E,UAAUC,OAAS,SAAgBC,GACzC,GAAIg/B,GAAOv/B,KAAKR,MAAQQ,KAAKR,MAAM+M,MAAQ,EAC3CvM,MAAKwe,MAAQghB,GAAWD,EAAMv/B,KAAKN,eAAeiJ,iBAAkBpI,GACpEP,KAAKc,UAAW,GAGjBsE,EAAO/E,UAAUyB,SAAW,WAC3B,MAAO9B,MAAKR,OAA6B,MAApBQ,KAAKR,MAAM+M,MAAgBkzB,GAA0B,GAAKz/B,KAAKR,MAAM+M,OAAS,IAGpGnH,EAAO/E,UAAUuC,SAAW,WACvB5C,KAAKwe,OAAOxe,KAAKwe,MAAM7d,QAAQ,SAAUuD,GAC5C,MAAOD,IAAWC,KAEnBlE,KAAKc,UAAW,GAGjBsE,EAAO/E,UAAU8C,OAAS,WACzB,GAAInD,KAAKc,UAAYd,KAAKqD,MAAO,CAChCrD,KAAK4C,UACL,IAAI+E,GAAUC,IACd5H,MAAKM,OAAOqH,EAEZ,IAAIkC,GAAa7J,KAAKN,eAAeiJ,iBACjCmB,EAAS9J,KAAKN,eAAe+I,aAAazI,KAE9C6J,GAAWE,aAAapC,EAASmC,GAEjC9J,KAAKqD,OAAQ,IAIR+B,GACLkmB,IAEChmB,GAAU,SAAW9B,GAGxB,QAAS8B,GAAQ7B,GAChBC,GAAe1D,KAAMsF,GAErB9B,EAAMG,KAAK3D,KAAMyD,GAEjBzD,KAAK4qB,UAAYnnB,EAAQ/D,eAAe6G,QACxCvG,KAAKyG,UAAYzG,KAAK4qB,UAAUnkB,UAEhCzG,KAAK0/B,kBAAoBj8B,EAAQ/D,eACjCM,KAAKN,eAAiBM,KAAKyG,UAAU/G,eAGrCM,KAAKuI,KAAO9E,EAAQrC,SAASoW,GAAK,GAkFnC,MAhGA1T,IAASwB,EAAS9B,GAiBlB8B,EAAQjF,UAAU0D,KAAO,WACxB,GAAIwE,GAAOvI,KAAKuI,MAEfvI,KAAKyG,UAAUkkB,SAASpiB,KAAUvI,KAAKyG,UAAUkkB,SAASpiB,QAAa3G,KAAK5B,KAG7E,IAAIoB,GAAWpB,KAAK4qB,UAAUE,gBAAgBviB,GAAQ,UAE9B,iBAAbnH,KACVA,EAAW+S,GAAM/S,GAAUogB,GAGvBpgB,IACJ6gB,EAAY,wCAA0C1Z,EAAO,KAAOhC,QAASvG,KAAKuG,UAClFnF,MAGDpB,KAAKE,SAAW,GAAIiG,KACnBC,MAAOpG,KACPuG,QAASvG,KAAK4qB,UAAUtkB,OACxBlF,SAAUA,IACR2C,QAGJuB,EAAQjF,UAAU2D,OAAS,WAC1B,MAAOhE,MAAKE,SAAS8D,UAGtBsB,EAAQjF,UAAUyH,KAAO,SAAcC,GACtC,MAAO/H,MAAKE,SAAS4H,KAAKC,IAG3BzC,EAAQjF,UAAUgI,QAAU,SAAiBN,EAAUk3B,GACtDj/B,KAAKE,SAAS4H,KAAKC,EAAUk3B,IAG9B35B,EAAQjF,UAAUiI,cAAgB,SAAuBC,GACxD,MAAOvI,MAAKE,SAASoI,cAAcC,IAGpCjD,EAAQjF,UAAUmI,kBAAoB,SAA2BD,EAAM02B,GACtEj/B,KAAKE,SAASsI,kBAAkBD,EAAM02B,IAGvC35B,EAAQjF,UAAU8D,UAAY,WAC7B,MAAOnE,MAAKE,SAASiE,aAGtBmB,EAAQjF,UAAUF,OAAS,WAC1B,KAAM,IAAI0I,OAAM,2CAGjBvD,EAAQjF,UAAUC,OAAS,SAAgBC,GAC1C,MAAOP,MAAKE,SAASI,OAAOC,IAG7B+E,EAAQjF,UAAUg8B,YAAc,SAAqB9zB,GACpD,GAAInH,GAAWpB,KAAKN,eAAe6G,QAAQwO,SAASxM,EAE5B,iBAAbnH,KACVA,EAAW+S,GAAM/S,GAAUogB,GAG5BxhB,KAAKs8B,gBAAkBl7B,OAGxBkE,EAAQjF,UAAUyB,SAAW,SAAkByC,GAC9C,MAAOvE,MAAKE,SAAS4B,SAASyC,IAG/Be,EAAQjF,UAAU2B,OAAS,WAC1BhC,KAAKE,SAAS8B,SACdS,EAAgBzC,KAAKyG,UAAUkkB,SAAS3qB,KAAKuI,MAAOvI,OAGrDsF,EAAQjF,UAAUuC,SAAW,SAAkBC,GAC9C7C,KAAKE,SAAS0C,SAASC,IAGjByC,GACLhC,IAmBCq8B,GAAYx3B,MAEXy3B,KAGJ,WACC,GAAIC,MACAC,EAAY1mB,GAAc,OAAO2mB,KAErCJ,IAAY,SAAUxd,GAGrB,GAFAA,EAAO6d,GAAU7d,IAEZ0d,EAAY1d,GAChB,GAAwBha,SAApB23B,EAAU3d,GACb0d,EAAY1d,GAAQA,MAMpB,KAHA,GAAI8d,GAAS9d,EAAK+d,OAAO,GAAGC,cAAgBhe,EAAKie,UAAU,GAEvDl4B,EAAIm4B,GAAQp4B,OACTC,KAAK,CACX,GAAIo4B,GAASD,GAAQn4B,EACrB,IAAmCC,SAA/B23B,EAAUQ,EAASL,GAAuB,CAC7CJ,EAAY1d,GAAQme,EAASL,CAC7B,QAMJ,MAAOJ,GAAY1d,OA3BrBwd,GAAY,IAgCb,IAAI7qB,KACHyrB,OAAQ,SAAUC,EAAMC,GACvB,GAAIzM,EAEJ,OAAK0M,GAAUF,IAAUE,EAAUD,IAInCD,GAAQA,EACRC,GAAMA,EAENzM,EAAQyM,EAAKD,EAERxM,EAME,SAAUxS,GAChB,MAAOgf,GAAOhf,EAAIwS,GANX,WACN,MAAOwM,KAVD,MAmBT9X,MAAO,SAAU8X,EAAMC,GACtB,GAAIE,GAAc7rB,EAAe9M,EAAKE,CAEtC,KAAKsE,EAAQg0B,KAAUh0B,EAAQi0B,GAC9B,MAAO,KAOR,KAJAE,KACA7rB,KAEA5M,EAAIF,EAAMwH,KAAKoxB,IAAIJ,EAAKv4B,OAAQw4B,EAAGx4B,QAC5BC,KACN4M,EAAc5M,GAAK24B,GAAYL,EAAKt4B,GAAIu4B,EAAGv4B,GAI5C,KAAKA,EAAIF,EAAKE,EAAIs4B,EAAKv4B,OAAQC,GAAK,EACnCy4B,EAAaz4B,GAAKs4B,EAAKt4B,EAGxB,KAAKA,EAAIF,EAAKE,EAAIu4B,EAAGx4B,OAAQC,GAAK,EACjCy4B,EAAaz4B,GAAKu4B,EAAGv4B,EAGtB,OAAO,UAAUsZ,GAGhB,IAFA,GAAItZ,GAAIF,EAEDE,KACNy4B,EAAaz4B,GAAK4M,EAAc5M,GAAGsZ,EAGpC,OAAOmf,KAIT5X,OAAQ,SAAUyX,EAAMC,GACvB,GAAIK,GAAY94B,EAAK8M,EAAe6rB,EAAcxe,CAElD,KAAKH,EAASwe,KAAUxe,EAASye,GAChC,MAAO,KAGRK,MACAH,KACA7rB,IAEA,KAAKqN,IAAQqe,GACRO,GAAOp9B,KAAK68B,EAAMre,KACjB4e,GAAOp9B,KAAK88B,EAAIte,IACnB2e,EAAWl/B,KAAKugB,GAChBrN,EAAcqN,GAAQ0e,GAAYL,EAAKre,GAAOse,EAAGte,KAEjDwe,EAAaxe,GAAQqe,EAAKre,GAK7B,KAAKA,IAAQse,GACRM,GAAOp9B,KAAK88B,EAAIte,KAAU4e,GAAOp9B,KAAK68B,EAAMre,KAC/Cwe,EAAaxe,GAAQse,EAAGte,GAM1B,OAFAna,GAAM84B,EAAW74B,OAEV,SAAUuZ,GAIhB,IAHA,GACIW,GADAja,EAAIF,EAGDE,KACNia,EAAO2e,EAAW54B,GAElBy4B,EAAaxe,GAAQrN,EAAcqN,GAAMX,EAG1C,OAAOmf,MAkBNK,GAAkB,GAAIzzB,QAAO,QAAU8yB,GAAQ91B,KAAK,KAAO,MAM3D02B,GAAgB,GAAI1zB,QAAO,OAAS8yB,GAAQ91B,KAAK,KAAO,YAYxD22B,GAAoB/4B,MAEnBy3B,KAGJ,WACC,GAAIE,GAAY1mB,GAAc,OAAO2mB,MACjC1wB,EAAS,SAAUgO,GACtB,MAAOA,IAGJ8jB,KACAC,KAGAC,EAAal5B,OACbm5B,EAAgBn5B,OAChBo5B,EAA0Bp5B,OAC1Bq5B,EAAsBr5B,OACtBs5B,EAAsBt5B,OACtBu5B,EAA6Bv5B,MAEJA,UAAzB23B,EAAUniB,YACb0jB,EAAa,aACbC,EAAgB,gBAChBC,GAA0B,GACep5B,SAA/B23B,EAAU6B,kBACpBN,EAAa,mBACbC,EAAgB,sBAChBC,GAA0B,GAE1BA,GAA0B,EAGvBF,IACHG,EAAsBH,EAAa,WACnCI,EAAsBJ,EAAa,WACnCK,EAA6BL,EAAa,kBAG3CH,GAAoB,SAAU1f,EAAGif,EAAIh9B,EAASm+B,EAAmB53B,GAIhE63B,WAAW,WAIV,QAASC,KACJC,GAAyBC,IAE5BxgB,EAAEjb,QAAQ5D,KAAK6e,EAAEjZ,KAAO,OAAQiZ,EAAEtd,KAAMsd,EAAEygB,SAC1Cj4B,KAYF,QAASk4B,GAAqBxgC,GAC7B,GAAI+F,GAAQm6B,EAAkBlzB,QAAQsxB,GAAUmC,GAASzgC,EAAMga,eACjD,MAAVjU,GACHm6B,EAAkBjzB,OAAOlH,EAAO,GAG7Bm6B,EAAkB35B,SAKtBuZ,EAAEtd,KAAK0R,oBAAoB0rB,EAAeY,GAAsB,GAEhEF,GAAyB,EACzBF,KAjCD,GAAIC,GAAwB55B,OACxB65B,EAAyB75B,OAYzBi6B,GAAc5gB,EAAEtd,KAAKsV,cAAgB,IAAMgI,EAAEtd,KAAK6Z,OAEtDyD,GAAEtd,KAAK67B,MAAM0B,GAAuBG,EAAkB7hC,IAAI4/B,IAAW5/B,IAAIsiC,IAAW93B,KAAK,KACzFiX,EAAEtd,KAAK67B,MAAM2B,GAA8BW,GAAU5+B,EAAQ2L,QAAU,UACvEoS,EAAEtd,KAAK67B,MAAMyB,GAAuB/9B,EAAQ6+B,SAAW,IAAO,IAmB9D9gB,EAAEtd,KAAKoP,iBAAiBguB,EAAeY,GAAsB,GAE7DL,WAAW,WAUV,IATA,GAAI35B,GAAI05B,EAAkB35B,OACtBs6B,EAAOp6B,OACPq6B,EAAgBr6B,OAChBV,EAAQU,OACRs6B,KACAtgB,EAAOha,OACPu6B,EAASv6B,OACTmT,EAAenT,OAEZD,KACNia,EAAOyf,EAAkB15B,GACzBq6B,EAAOH,EAAajgB,EAEhBof,IAA4BH,EAAwBmB,KACvD/gB,EAAEtd,KAAK67B,MAAMJ,GAAUxd,IAASse,EAAGte,GAI9Bgf,EAAqBoB,KACzBC,EAAgBhhB,EAAEmhB,SAASxgB,GAI3Bgf,EAAqBoB,GAAQ/gB,EAAEmhB,SAASxgB,IAASse,EAAGte,GACpDif,EAAwBmB,IAASpB,EAAqBoB,GAGlDnB,EAAwBmB,KAC3B/gB,EAAEtd,KAAK67B,MAAMJ,GAAUxd,IAASqgB,OAK9BjB,GAA2BH,EAAwBmB,MAEjCp6B,SAAlBq6B,IACHA,EAAgBhhB,EAAEmhB,SAASxgB,IAK5B1a,EAAQm6B,EAAkBlzB,QAAQyT,GACpB,KAAV1a,EACHwa,EAAY,oIAAsI/d,KAAMsd,EAAEtd,OAE1J09B,EAAkBjzB,OAAOlH,EAAO,GAKjCi7B,EAAS,UAAU70B,KAAK4yB,EAAGte,IAAO,GAClC7G,EAAeulB,GAAY+B,WAAWJ,GAAgBI,WAAWnC,EAAGte,MAAW,WAC9E,MAAOse,GAAGte,IAIXsgB,EAA2B7gC,MAC1B2G,KAAMo3B,GAAUxd,GAChB7G,aAAcA,EACdonB,OAAQA,IAMX,IAAID,EAA2Bx6B,OAAQ,CACtC,GAAImH,GAASjH,MAEiB,iBAAnB1E,GAAQ2L,QAClBA,EAASoS,EAAEjb,QAAQ6I,OAAO3L,EAAQ2L,QAE7BA,IACJ6b,EAAgB5S,GAAc5U,EAAQ2L,OAAQ,WAC9CA,EAASC,IAGVD,EADoC,kBAAnB3L,GAAQ2L,OAChB3L,EAAQ2L,OAERC,EAGV,GAAIwzB,KACHP,SAAU7+B,EAAQ6+B,SAClBlzB,OAAQA,EACR0zB,KAAM,SAAUxzB,GAEf,IADA,GAAIpH,GAAIu6B,EAA2Bx6B,OAC5BC,KAAK,CACX,GAAI66B,GAAQN,EAA2Bv6B,EACvCsZ,GAAEtd,KAAK67B,MAAMgD,EAAMx6B,MAAQw6B,EAAMznB,aAAahM,GAAOyzB,EAAML,SAG7DvkB,SAAU,WACT4jB,GAAwB,EACxBD,WAIFC,IAAwB,CAGpBH,GAAkB35B,SAGtBuZ,EAAEtd,KAAK0R,oBAAoB0rB,EAAeY,GAAsB,GAChEF,GAAyB,EACzBF,MAEC,IACDr+B,EAAQu/B,OAAS,OA7LtB9B,GAAoB,IAkMrB,IAAI+B,IAAU96B,OACV+6B,GAAS,QAEb,IAAI9+B,GAAK,CACR,GAAI++B,IAAWh7B,MAEf,IAAI+6B,KAAU9+B,IACb++B,GAAW,OAGX,KADA,GAAIC,IAAK/C,GAAQp4B,OACVm7B,MAAM,CACZ,GAAI9C,IAASD,GAAQ+C,GAGrB,IAFAF,GAAS5C,GAAS,SAEd4C,KAAU9+B,IAAK,CAClB++B,GAAW7C,EACX,QAKcn4B,SAAbg7B,IACH/+B,GAAIkP,iBAAiB6vB,GAAW,mBAAoBE,IACpDA,OAGI,cAAgBj/B,KACnBA,GAAIkP,iBAAiB,WAAYgwB,IACjCl/B,GAAIkP,iBAAiB,UAAWiwB,MAEhClwB,GAAIC,iBAAiB,WAAYgwB,IACjCjwB,GAAIC,iBAAiB,OAAQgwB,IAE7BjwB,GAAIC,iBAAiB,WAAYiwB,IACjClwB,GAAIC,iBAAiB,QAASiwB,KAG/BN,IAAU,GAgBZ,GA01FIziB,IACAH,GACAL,GACAC,GACAG,GACAD,GA/1FAqjB,GAAmBnwB,KAAQA,GAAImwB,kBAAoBC,GAAOD,kBAC1DE,GAAWrvB,GAASrK,UAEpB4T,GAAa,WAChB,QAASA,GAAWxX,EAAOhF,EAAU6gC,GACpCv+B,GAAe1D,KAAM4d,GAErB5d,KAAKoG,MAAQA,EACbpG,KAAKiiC,QAAUA,EACfjiC,KAAKuG,QAAUH,EAAMG,OAErB,IAAIA,GAAUH,EAAMG,QAEhBgC,EAAOnH,EAASoW,GAAKpW,CAEzB,IAAoB,gBAATmH,GAAmB,CAC7B,GAAIrI,GAAW,GAAIiG,KAClBC,MAAOA,EACPhF,SAAUmH,IACRxE,MAKH,IAHAwE,EAAOrI,EAAS4B,WAChB5B,EAAS8B,SAEI,KAATuG,EAEH,OAMF,GAFAvI,KAAKuI,KAAOA,EAERnH,EAAS2V,EACZ/W,KAAK2jC,OAASviC,EAAS2V,MACjB,IAAI3V,EAASqW,EAAG,CAGtB,GAAIvX,GAAW,GAAIiG,KAClBC,MAAOA,EACPhF,SAAUA,EAASqW,IACjB1T,MAEH/D,MAAK2jC,OAASzjC,EAAS8I,cACvB9I,EAAS8B,SAGVhC,KAAK2jB,IAAM1K,GAAoB,cAAe1S,EAASgC,GAElDvI,KAAK2jB,KACTsH,EAAgB5S,GAAc9P,EAAM,eAAiBhC,QAASA,IAiLhE,MA7KAqX,GAAWvd,UAAUujC,aAAe,SAAsB7D,EAAOv2B,EAAO/F,GACvE,GAAI+D,GAAQxH,IAEZ,IAAyB,IAArB+V,UAAU9N,OACb,KAAM,IAAIY,OAAM,iFAKjB,KAAKo6B,GAEJ,MADAjjC,MAAK6jC,SAAS9D,EAAOv2B,GACdk6B,EAGR,IAAIjD,GAAKt4B,MAsBT,OApBqB,gBAAV43B,IACVU,KACAA,EAAGV,GAASv2B,IAEZi3B,EAAKV,EAGLt8B,EAAU+F,GAQN/F,IACJwnB,EAAgB,iMAAkMjrB,KAAKuI,MACvN9E,EAAUzD,MAGJ,GAAIqU,IAAS,SAAUyvB,GAE7B,IAAKrgC,EAAQ6+B,SAGZ,MAFA96B,GAAMq8B,SAASpD,OACfqD,IAYD,KAPA,GAAI/pB,GAAgB7Y,OAAOC,KAAKs/B,GAC5BmB,KAGAmC,EAAgBP,GAAiBh8B,EAAMtD,MAEvCgE,EAAI6R,EAAc9R,OACfC,KAAK,CACX,GAAIia,GAAOpI,EAAc7R,GACrB87B,EAAUD,EAAcpE,GAAUxd,GAEtB,SAAZ6hB,IAAmBA,EAAU,GAG7BA,GAAWvD,EAAGte,KAEjByf,EAAkBhgC,KAAKugB,GAIvB3a,EAAMtD,KAAK67B,MAAMJ,GAAUxd,IAAS6hB,GAMtC,MAAKpC,GAAkB35B,WAKvBi5B,IAAkB15B,EAAOi5B,EAAIh9B,EAASm+B,EAAmBkC,OAJxDA,QAQHlmB,EAAWvd,UAAUsiC,SAAW,SAAkBsB,GACjD,GAAIF,GAAgBP,GAAiBxjC,KAAKkE,KAE1C,IAAqB,gBAAV+/B,GAAoB,CAC9B,GAAIz6B,GAAQu6B,EAAcpE,GAAUsE,GACpC,OAAiB,QAAVz6B,EAAkB,EAAIA,EAG9B,IAAKgD,EAAQy3B,GACZ,KAAM,IAAIp7B,OAAM,kGAMjB,KAHA,GAAIkX,MAEA7X,EAAI+7B,EAAMh8B,OACPC,KAAK,CACX,GAAIia,GAAO8hB,EAAM/7B,GACbsB,EAAQu6B,EAAcpE,GAAUxd,GAEtB,SAAV3Y,IAAiBA,EAAQ,GAC7BuW,EAAOoC,GAAQ3Y,EAGhB,MAAOuW,IAGRnC,EAAWvd,UAAU6jC,cAAgB,SAAuBP,EAAQhwB,GAenE,MAdsB,gBAAXgwB,GACVA,GAAWrB,SAAUqB,GACO,gBAAXA,GAEhBA,EADc,SAAXA,GACQrB,SAAU,KACA,SAAXqB,GACCrB,SAAU,MAEVA,SAAU,KAEXqB,IACXA,MAGMpwB,MAAaI,EAAUgwB,IAG/B/lB,EAAWvd,UAAUwjC,SAAW,SAAkB9D,EAAOv2B,GACxD,GAAqB,gBAAVu2B,GACV//B,KAAKkE,KAAK67B,MAAMJ,GAAUI,IAAUv2B,MAC9B,CACN,GAAI2Y,GAAOha,MACX,KAAKga,IAAQ4d,GACRA,EAAMtZ,eAAetE,KACxBniB,KAAKkE,KAAK67B,MAAMJ,GAAUxd,IAAS4d,EAAM5d,IAK5C,MAAOniB,OAGR4d,EAAWvd,UAAU8L,MAAQ,WAC5B,GAAIgB,GAASnN,KAETkE,EAAOlE,KAAKkE,KAAOlE,KAAKoG,MAAMlC,KAC9BigC,EAAgBjgC,EAAKkR,aAAa,SAElCgvB,EAAYj8B,MAoBhB,OAfAnI,MAAKme,SAAW,SAAUkmB,GACrBD,KAICC,GAAWl3B,EAAO80B,SACtBqC,GAAWpgC,EAAMigC,GAGlBh3B,EAAOo3B,SAASrhC,OAAOiK,GAEvBi3B,GAAY,IAIRpkC,KAAK2jB,QAKV3jB,MAAK2jB,IAAI3V,MAAMhO,KAAKqiB,MAAOriB,MAAM+N,OAAO/N,KAAK2jC,aAJ5C3jC,MAAKme,YAOAP,KAsCJ/H,GAAU,WACb,QAASA,GAAQV,GAChB,GAAI5M,GAAOwN,UAAU9N,QAAU,GAAsBE,SAAjB4N,UAAU,GAAmB,QAAUA,UAAU,EACrFrS,IAAe1D,KAAM6V,GAErB7V,KAAKmV,QAAUA,EACfnV,KAAKuG,QAAU4O,EAAQ5O,QACvBvG,KAAKsc,UAAYnH,EAAQkH,gBAAgB9T,EAEzC,IAAI+S,GAAetb,KAAKsc,UAAUhB,YAClCA,GAAakpB,cAAgBxkC,IAE7B,IAAIR,GAAQ8b,EAAa9b,KAGzB,IAAKA,GAME,GAAIA,EAAMilC,aAEhBjlC,EAAMklC,kBACNC,GAAmB,aAAc3kC,KAAKuG,aAIlC,IAAI/G,EAAMqlB,WAAY,CACzB,GAAIvZ,GAAU9L,EAAM+L,aAAa8B,QAAQ,KAAM,GAE/C,OADA4d,GAAgB,kCAAoC9V,EAAQ5M,KAAO,cAAgB+C,EAAU,gDAAkD6J,EAAQ5M,KAAO,uBAA2BhC,QAASvG,KAAKuG,WAChM,OAdR+U,GAAapR,SAASw6B,kBACtBllC,EAAQ8b,EAAa9b,MAErBmlC,GAAmB,IAAOrpB,EAAala,SAAS4V,EAAI,cAAgBhX,KAAKuG,QAc1EvG,MAAKsc,UAAUX,UAAW,EAC1B3b,KAAKR,MAAQA,CAGb,IAAIgK,GAAQhK,EAAM+M,KAEJpE,UAAVqB,GAAuBxJ,KAAKgW,kBAC/BxM,EAAQxJ,KAAKgW,kBACbxW,EAAMwS,IAAIxI,GAGX,IAAIo7B,GAAaC,GAAe1vB,EAC5ByvB,KACH5kC,KAAK6hB,WAAarY,EAClBo7B,EAAWhlB,aAAahe,KAAK5B,OAyC/B,MArCA6V,GAAQxV,UAAU0D,KAAO,WACxB/D,KAAKR,MAAMslC,sBAAsB9kC,OAGlC6V,EAAQxV,UAAUuL,aAAe,WAChC,GAAIpE,GAAQxH,IAEZsH,IAAQ6E,MAAMnM,KAAKqiB,MACnBriB,KAAKsc,UAAUyoB,QAAS,EACxB/kC,KAAKR,MAAMwS,IAAIhS,KAAKkV,YACpB5N,GAAQsH,aAAa,WACpB,MAAOpH,GAAM8U,UAAUyoB,QAAS,IAEjCz9B,GAAQ0Z,OAGTnL,EAAQxV,UAAUF,OAAS,WAE1BH,KAAKgC,SACLhC,KAAKR,MAAQQ,KAAKsc,UAAUhB,aAAa9b,MACzCQ,KAAK+D,QAGN8R,EAAQxV,UAAUC,OAAS,WAC1BN,KAAKkE,KAAOlE,KAAKmV,QAAQjR,KACzBlE,KAAKkE,KAAK2X,SAASc,QAAU3c,KAC7BA,KAAKc,UAAW,GAGjB+U,EAAQxV,UAAU2B,OAAS,WAC1BhC,KAAKR,MAAMwlC,wBAAwBhlC,OAGpC6V,EAAQxV,UAAUuC,SAAW,aAItBiT,KAiCJovB,GAAiB,SAAW3vB,GAG/B,QAAS2vB,KACRvhC,GAAe1D,KAAMilC,GAErB3vB,EAAStH,MAAMhO,KAAM+V,WA4DtB,MAjEAjS,IAASmhC,EAAgB3vB,GAQzB2vB,EAAe5kC,UAAU2V,gBAAkB,WAC1C,MAAO,IAGRivB,EAAe5kC,UAAU6U,SAAW,WACnC,MAAOlV,MAAKkE,KAAKsF,OAGlBy7B,EAAe5kC,UAAUC,OAAS,WACjCgV,EAASjV,UAAUC,OAAOqD,KAAK3D,KAI/B,IAAIiW,GAAOjW,KAAKuG,QAAQ0P,KACpBivB,GAAU,CAGVllC,MAAKmV,QAAQ/T,SAAS2V,GAAK,QAAU/W,MAAKmV,QAAQ/T,SAAS2V,IAC9Dd,EAAOjW,KAAKmV,QAAQ/T,SAAS2V,EAAEd,KAClB,IAATA,IAAYA,GAAO,IAIX,UAATA,IAAkBA,GAAO,GAEzByqB,EAAUzqB,KACbivB,GAAWjvB,EACXA,GAAO,GAGRjW,KAAKmY,QAAU+sB,EAAUC,GAAYD,GAAW3vB,EAEhD,IAAIrR,GAAOlE,KAAKkE,IAEhBA,GAAKoP,iBAAiB,SAAUiC,IAAgB,GAE3CU,IACJ/R,EAAKoP,iBAAiB,QAAStT,KAAKmY,SAAS,GAEzCjU,EAAKsR,aACRtR,EAAKoP,iBAAiB,QAAStT,KAAKmY,SAAS,IAI/CjU,EAAKoP,iBAAiB,OAAQ8xB,IAAY,IAG3CH,EAAe5kC,UAAUuC,SAAW,WACnC,GAAIsB,GAAOlE,KAAKmV,QAAQjR,IACxBlE,MAAKc,UAAW,EAEhBoD,EAAK0R,oBAAoB,SAAUL,IAAgB,GACnDrR,EAAK0R,oBAAoB,QAAS5V,KAAKmY,SAAS,GAChDjU,EAAK0R,oBAAoB,QAAS5V,KAAKmY,SAAS,GAChDjU,EAAK0R,oBAAoB,OAAQwvB,IAAY,IAGvCH,GACLpvB,IAECwvB,GAAsB,SAAW/vB,GAGpC,QAAS+vB,KACR3hC,GAAe1D,KAAMqlC,GAErB/vB,EAAStH,MAAMhO,KAAM+V,WA8FtB,MAnGAjS,IAASuhC,EAAqB/vB,GAQ9B+vB,EAAoBhlC,UAAUof,YAAc,WAC3C,GAAIjY,GAAQxH,KAERwJ,EAAQxJ,KAAKkV,UAEH/M,UAAVqB,IACHxJ,KAAKsc,UAAUyoB,QAAS,EACxBz9B,GAAQsH,aAAa,WACpB,MAAOpH,GAAM8U,UAAUyoB,QAAS,IAEjC/kC,KAAKR,MAAMwS,IAAIxI,KAIjB67B,EAAoBhlC,UAAU2V,gBAAkB,WAC/C,GAA2C7N,SAAvCnI,KAAKmV,QAAQC,aAAa,SAA9B,CAIA,GAAI3R,GAAUzD,KAAKmV,QAAQ1R,QACvBuE,EAAMvE,EAAQwE,MAElB,IAAKD,EAAL,CAOA,IALA,GAAIwB,GAAQrB,OACRkX,EAAoBlX,OACpBD,EAAIF,EAGDE,KAAK,CACX,GAAIrC,GAASpC,EAAQyE,EAErB,IAAIrC,EAAOuP,aAAa,YAAa,CAC/BvP,EAAOuP,aAAa,cACxB5L,EAAQ3D,EAAOuP,aAAa,UAG7BiK,GAAoB,CACpB,QAKF,IAAKA,EACJ,OAASnX,EAAIF,GACZ,IAAKvE,EAAQyE,GAAGkN,aAAa,YAAa,CACzC5L,EAAQ/F,EAAQyE,GAAGkN,aAAa,QAChC,OAYH,MAJcjN,UAAVqB,IACHxJ,KAAKmV,QAAQkH,gBAAgB7S,MAAMA,MAAQA,GAGrCA,KAGR67B,EAAoBhlC,UAAU6U,SAAW,WACxC,GAAIzR,GAAUzD,KAAKkE,KAAKT,QACpBuE,EAAMvE,EAAQwE,OAEdC,EAAIC,MACR,KAAKD,EAAI,EAAOF,EAAJE,EAASA,GAAK,EAAG,CAC5B,GAAIrC,GAASpC,EAAQyE,EAErB,IAAIzE,EAAQyE,GAAG8W,WAAavb,EAAQyE,GAAGo9B,SACtC,MAAOz/B,GAAOgW,SAAWhW,EAAOgW,SAASrS,MAAQ3D,EAAO2D,QAK3D67B,EAAoBhlC,UAAUC,OAAS,WACtCgV,EAASjV,UAAUC,OAAOqD,KAAK3D,MAC/BA,KAAKkE,KAAKoP,iBAAiB,SAAUiC,IAAgB,IAKtD8vB,EAAoBhlC,UAAUklC,SAAW,SAAkB/7B,GAC1DxJ,KAAKR,MAAMwS,IAAIxI,IAGhB67B,EAAoBhlC,UAAUuC,SAAW,WACxC5C,KAAKkE,KAAK0R,oBAAoB,SAAUL,IAAgB,IAGlD8vB,GACLxvB,IAEC2vB,GAAwB,SAAWlwB,GAGtC,QAASkwB,KACR9hC,GAAe1D,KAAMwlC,GAErBlwB,EAAStH,MAAMhO,KAAM+V,WAiFtB,MAtFAjS,IAAS0hC,EAAuBlwB,GAQhCkwB,EAAsBnlC,UAAUof,YAAc,WAC7C,GAAIjY,GAAQxH,KAERwJ,EAAQxJ,KAAKkV,UAEH/M,UAAVqB,IACHxJ,KAAKsc,UAAUyoB,QAAS,EACxBz9B,GAAQsH,aAAa,WACpB,MAAOpH,GAAM8U,UAAUyoB,QAAS,IAEjC/kC,KAAKR,MAAMwS,IAAIxI,KAIjBg8B,EAAsBnlC,UAAU2V,gBAAkB,WACjD,MAAOhW,MAAKmV,QAAQ1R,QAAQ2P,OAAO,SAAUvN,GAC5C,MAAOA,GAAOuP,aAAa,cACzBrV,IAAI,SAAU8F,GAChB,MAAOA,GAAOuP,aAAa,YAI7BowB,EAAsBnlC,UAAU6U,SAAW,WAM1C,IAAK,GALDzR,GAAUzD,KAAKmV,QAAQjR,KAAKT,QAC5BuE,EAAMvE,EAAQwE,OAEdw9B,KAEKv9B,EAAI,EAAOF,EAAJE,EAASA,GAAK,EAAG,CAChC,GAAIrC,GAASpC,EAAQyE,EAErB,IAAIrC,EAAOmZ,SAAU,CACpB,GAAIM,GAAczZ,EAAOgW,SAAWhW,EAAOgW,SAASrS,MAAQ3D,EAAO2D,KACnEi8B,GAAe7jC,KAAK0d,IAItB,MAAOmmB,IAGRD,EAAsBnlC,UAAUuL,aAAe,WAC9C,GAAI0Q,GAAYtc,KAAKsc,UACjBopB,EAAgBppB,EAAUpH,WAE1B1L,EAAQxJ,KAAKkV,UAMjB,OAJsB/M,UAAlBu9B,GAAgCC,EAAmBn8B,EAAOk8B,IAC7DpwB,EAASjV,UAAUuL,aAAajI,KAAK3D,MAG/BA,MAGRwlC,EAAsBnlC,UAAUC,OAAS,WACxCgV,EAASjV,UAAUC,OAAOqD,KAAK3D,MAE/BA,KAAKkE,KAAKoP,iBAAiB,SAAUiC,IAAgB,GAE5BpN,SAArBnI,KAAKR,MAAM+M,OAEdvM,KAAK4L,gBAIP45B,EAAsBnlC,UAAUklC,SAAW,WAC1C,KAAM,IAAI18B,OAAM,6BAGjB28B,EAAsBnlC,UAAUuC,SAAW,WAC1C5C,KAAKkE,KAAK0R,oBAAoB,SAAUL,IAAgB,IAGzDiwB,EAAsBnlC,UAAUuS,YAAc,WAChBzK,SAAzBnI,KAAKsc,UAAU9S,OAAwBxJ,KAAKsc,UAAU9S,MAAMvB,QAC/DjI,KAAKsL,QAAQ0G,IAAIhS,KAAK4lC,eAIjBJ,GACL3vB,IAECgwB,GAAiB,SAAWC,GAG/B,QAASD,KACRniC,GAAe1D,KAAM6lC,GAErBC,EAAgB93B,MAAMhO,KAAM+V,WAY7B,MAjBAjS,IAAS+hC,EAAgBC,GAQzBD,EAAexlC,UAAU2V,gBAAkB,WAC1C,MAAO7N,SAGR09B,EAAexlC,UAAU6U,SAAW,WACnC,GAAI1L,GAAQo5B,WAAW5iC,KAAKkE,KAAKsF,MACjC,OAAOu8B,OAAMv8B,GAASrB,OAAYqB,GAG5Bq8B,GACLZ,IAECe,GAAkB,SAAW1wB,GAGhC,QAAS0wB,GAAgB7wB,GACxBzR,GAAe1D,KAAMgmC,GAErB1wB,EAAS3R,KAAK3D,KAAMmV,EAAS,WA0B9B,MA/BArR,IAASkiC,EAAiB1wB,GAQ1B0wB,EAAgB3lC,UAAUC,OAAS,WAClCgV,EAASjV,UAAUC,OAAOqD,KAAK3D,MAE/BA,KAAKkE,KAAKoP,iBAAiB,SAAUiC,IAAgB,GAEjDvV,KAAKkE,KAAKsR,aACbxV,KAAKkE,KAAKoP,iBAAiB,QAASiC,IAAgB,IAItDywB,EAAgB3lC,UAAUuC,SAAW,WACpC5C,KAAKkE,KAAK0R,oBAAoB,SAAUL,IAAgB,GACxDvV,KAAKkE,KAAK0R,oBAAoB,QAASL,IAAgB,IAGxDywB,EAAgB3lC,UAAU2V,gBAAkB,WAC3C,QAAShW,KAAKmV,QAAQC,aAAa,YAGpC4wB,EAAgB3lC,UAAU6U,SAAW,WACpC,MAAOlV,MAAKkE,KAAKmR,SAGX2wB,GACLnwB,IAECowB,MAMAC,GAAe,SAAW5wB,GAG7B,QAAS4wB,GAAa/wB,GACrBzR,GAAe1D,KAAMkmC,GAErB5wB,EAAS3R,KAAK3D,KAAMmV,EAAS,WAG7BnV,KAAKimC,SAAWE,GAAYnmC,KAAKuG,QAAQ6C,MAAQpJ,KAAKmV,QAAQC,aAAa,SAC3EpV,KAAKimC,SAASrkC,KAAK5B,MAoCpB,MA7CA8D,IAASoiC,EAAc5wB,GAYvB4wB,EAAa7lC,UAAU6U,SAAW,WACjC,MAAOlV,MAAKkE,KAAKmR,SAGlB6wB,EAAa7lC,UAAUuL,aAAe,WACrCtE,GAAQ6E,MAAMnM,KAAKqiB,MAEnBriB,KAAKimC,SAAStlC,QAAQ,SAAUgc,GAC/BA,EAAQnd,MAAMwS,IAAI2K,EAAQzH,cAG3B5N,GAAQ0Z,OAGTklB,EAAa7lC,UAAUC,OAAS,WAC/BgV,EAASjV,UAAUC,OAAOqD,KAAK3D,MAE/BA,KAAKkE,KAAKoP,iBAAiB,SAAUiC,IAAgB,GAEjDvV,KAAKkE,KAAKsR,aACbxV,KAAKkE,KAAKoP,iBAAiB,QAASiC,IAAgB,IAItD2wB,EAAa7lC,UAAU2B,OAAS,WAC/BS,EAAgBzC,KAAKimC,SAAUjmC,OAGhCkmC,EAAa7lC,UAAUuC,SAAW,WACjC5C,KAAKkE,KAAK0R,oBAAoB,SAAUL,IAAgB,GACxDvV,KAAKkE,KAAK0R,oBAAoB,QAASL,IAAgB,IAGjD2wB,GACLrwB,IAECuwB,MAMAC,GAAe,WAClB,QAASA,GAAa7mC,EAAO0V,GAC5BxR,GAAe1D,KAAMqmC,GAErBrmC,KAAKR,MAAQA,EACbQ,KAAKkV,SAAWA,EAEhBlV,KAAKsmC,YAwBN,MArBAD,GAAahmC,UAAUkO,IAAM,SAAaoO,GACzC3c,KAAKsmC,SAAS1kC,KAAK+a,IAGpB0pB,EAAahmC,UAAU0D,KAAO,WAC7B/D,KAAKR,MAAMslC,sBAAsB9kC,MACjCA,KAAKoH,OAAQ,GAGdi/B,EAAahmC,UAAU6C,OAAS,SAAgByZ,GAC/Cla,EAAgBzC,KAAKsmC,SAAU3pB,GAC1B3c,KAAKsmC,SAASr+B,QAClBjI,KAAKgC,UAIPqkC,EAAahmC,UAAU2B,OAAS,WAC/BhC,KAAKR,MAAMwlC,wBAAwBhlC,MACnCA,KAAKoH,OAAQ,GAGPi/B,KAeJzkC,MAAUA,KAEV2kC,GAAsB,SAAWjxB,GAGpC,QAASixB,GAAoBpxB,GAmB5B,GAlBAzR,GAAe1D,KAAMumC,GAErBjxB,EAAS3R,KAAK3D,KAAMmV,EAAS,QAE7BnV,KAAKwmC,cAAe,EAKpBxmC,KAAKyV,MAAQgxB,GAAgBzmC,KAAKuG,QAAQ6C,MAAO,aAAcpJ,KAAKR,MAAOknC,IAC3E1mC,KAAKyV,MAAMlH,IAAIvO,MAEXA,KAAK2mC,iBACR3mC,KAAKyV,MAAMkxB,gBAAiB,GAKzB3mC,KAAKyV,MAAMkxB,gBAAkB3mC,KAAKmV,QAAQC,aAAa,WAAY,CACtE,GAAIwxB,GAAgB5mC,KAAKR,MAAM+M,MAC3Bs6B,EAAe7mC,KAAKmV,QAAQC,aAAa,QAE7CxT,IAAK+B,KAAKijC,EAAeC,IAyE3B,MAlGA/iC,IAASyiC,EAAqBjxB,GA6B9BixB,EAAoBlmC,UAAU0D,KAAO,WAC/B/D,KAAKyV,MAAMrO,OACfpH,KAAKyV,MAAM1R,QAIbwiC,EAAoBlmC,UAAUqjB,QAAU,WACvC,GAAIojB,KAAe9mC,KAAK+mC,SAExB,OADA/mC,MAAK+mC,UAAY/mC,KAAKkE,KAAKmR,QACpBrV,KAAK+mC,YAAcD,GAG3BP,EAAoBlmC,UAAU2V,gBAAkB,WAS/C,MADAhW,MAAK2mC,gBAAiB,MAIvBJ,EAAoBlmC,UAAU6U,SAAW,WACxC,MAAOlV,MAAKyV,MAAMP,YAGnBqxB,EAAoBlmC,UAAUuL,aAAe,WAC5C5L,KAAK+mC,UAAY/mC,KAAKmV,QAAQjR,KAAKmR,QACnCC,EAASjV,UAAUuL,aAAajI,KAAK3D,OAGtCumC,EAAoBlmC,UAAUC,OAAS,WACtCgV,EAASjV,UAAUC,OAAOqD,KAAK3D,KAE/B,IAAIkE,GAAOlE,KAAKkE,KAEZ0iC,EAAgB5mC,KAAKR,MAAM+M,MAC3Bs6B,EAAe7mC,KAAKmV,QAAQC,aAAa,QAEzC5I,GAAQo6B,GACX5mC,KAAK+mC,UAAYC,EAAcJ,EAAeC,GAE9C7mC,KAAK+mC,UAAYH,GAAiBC,EAGnC3iC,EAAKqE,KAAO,KAAOvI,KAAKR,MAAM+L,aAAe,KAC7CrH,EAAKmR,QAAUrV,KAAK+mC,UAEpB7iC,EAAKoP,iBAAiB,SAAUiC,IAAgB,GAG5CrR,EAAKsR,aACRtR,EAAKoP,iBAAiB,QAASiC,IAAgB,IAIjDgxB,EAAoBlmC,UAAU2B,OAAS,WACtChC,KAAKyV,MAAMvS,OAAOlD,OAGnBumC,EAAoBlmC,UAAUuC,SAAW,WACxC,GAAIsB,GAAOlE,KAAKmV,QAAQjR,IAExBA,GAAK0R,oBAAoB,SAAUL,IAAgB,GACnDrR,EAAK0R,oBAAoB,QAASL,IAAgB,IAG5CgxB,GACL1wB,IAUCZ,GAAmB,SAAWK,GAGjC,QAASL,GAAiBE,GACzBzR,GAAe1D,KAAMiV,GAErBK,EAAS3R,KAAK3D,KAAMmV,EAAS,QAE7BnV,KAAKyV,MAAQgxB,GAAgBzmC,KAAKuG,QAAQ6C,MAAO,YAAapJ,KAAKR,MAAOynC,IAC1EjnC,KAAKyV,MAAMlH,IAAIvO,MAkEhB,MA1EA8D,IAASmR,EAAkBK,GAW3BL,EAAiB5U,UAAU0D,KAAO,WACjC,GAAIyD,GAAQxH,IAEPA,MAAKyV,MAAMrO,OACfpH,KAAKyV,MAAM1R,OAIZ/D,KAAK2V,sBACJ/J,aAAc,WACb,MAAOpE,GAAMtD,KAAKqE,KAAO,KAAOf,EAAMhI,MAAM+L,aAAe,OAI7DvL,KAAKR,MAAMkW,kBAAkBjK,SAASzL,KAAK2V,uBAG5CV,EAAiB5U,UAAU2V,gBAAkB,WAC5C,MAAIhW,MAAKmV,QAAQC,aAAa,WACtBpV,KAAKmV,QAAQC,aAAa,SADlC;EAKDH,EAAiB5U,UAAU6U,SAAW,WACrC,MAAOlV,MAAKmV,QAAQC,aAAa,UAGlCH,EAAiB5U,UAAUuL,aAAe,WAGrC5L,KAAKkE,KAAKmR,SACbC,EAASjV,UAAUuL,aAAajI,KAAK3D,OAIvCiV,EAAiB5U,UAAUC,OAAS,WACnCgV,EAASjV,UAAUC,OAAOqD,KAAK3D,KAE/B,IAAIkE,GAAOlE,KAAKkE,IAEhBA,GAAKqE,KAAO,KAAOvI,KAAKR,MAAM+L,aAAe,KAC7CrH,EAAKmR,QAAUrV,KAAKR,MAAM+M,OAASvM,KAAKmV,QAAQC,aAAa,SAE7DlR,EAAKoP,iBAAiB,SAAUiC,IAAgB,GAE5CrR,EAAKsR,aACRtR,EAAKoP,iBAAiB,QAASiC,IAAgB,IAIjDN,EAAiB5U,UAAU2B,OAAS,WACnChC,KAAKyV,MAAMvS,OAAOlD,MAElBA,KAAKR,MAAMkW,kBAAkB3I,WAAW/M,KAAK2V,uBAG9CV,EAAiB5U,UAAUuC,SAAW,WACrC,GAAIsB,GAAOlE,KAAKkE,IAEhBA,GAAK0R,oBAAoB,SAAUL,IAAgB,GACnDrR,EAAK0R,oBAAoB,QAASL,IAAgB,IAG5CN,GACLY,IAECC,GAAyB,SAAWR,GAGvC,QAASQ,KACRpS,GAAe1D,KAAM8V,GAErBR,EAAStH,MAAMhO,KAAM+V,WAqCtB,MA1CAjS,IAASgS,EAAwBR,GAQjCQ,EAAuBzV,UAAU2V,gBAAkB,WAClD,MAAOhW,MAAKmV,QAAQjV,SAAWF,KAAKmV,QAAQjV,SAAS4B,WAAa,IAGnEgU,EAAuBzV,UAAUC,OAAS,WACzCgV,EAASjV,UAAUC,OAAOqD,KAAK3D,KAE/B,IAAIkE,GAAOlE,KAAKkE,IAEhBA,GAAKoP,iBAAiB,SAAUiC,IAAgB,GAChDrR,EAAKoP,iBAAiB,OAAQiC,IAAgB,GAEzCvV,KAAKuG,QAAQ0P,OACjB/R,EAAKoP,iBAAiB,QAASiC,IAAgB,GAE3CrR,EAAKsR,aACRtR,EAAKoP,iBAAiB,QAASiC,IAAgB,KAKlDO,EAAuBzV,UAAUuC,SAAW,WAC3C,GAAIsB,GAAOlE,KAAKkE,IAEhBA,GAAK0R,oBAAoB,OAAQL,IAAgB,GACjDrR,EAAK0R,oBAAoB,SAAUL,IAAgB,GACnDrR,EAAK0R,oBAAoB,QAASL,IAAgB,GAClDrR,EAAK0R,oBAAoB,QAASL,IAAgB,IAGnDO,EAAuBzV,UAAU6U,SAAW,WAC3C,MAAOlV,MAAKmV,QAAQjR,KAAKgS,WAGnBJ,GACLD,IA4DCM,MAoGAC,MA2FAC,GAAe,qBACfC,GAAmB,qBACnBC,GAAoB,YAEpB1U,GAAiB,WACpB,QAASA,GAAeuE,EAAO1E,EAAON,GACrCsC,GAAe1D,KAAM6B,GAErB7B,KAAKoG,MAAQA,EACbpG,KAAK0B,MAAQA,EACb1B,KAAKoB,SAAWA,EAEhBpB,KAAKuG,QAAUH,EAAM1G,eAAe6G,QACpCvG,KAAKN,eAAiB0G,EAAM1G,eAE5BM,KAAK0G,QAAU,KACf1G,KAAKwW,UAAW,EAGhBxW,KAAKyW,OAAS,KACdzW,KAAK8G,UAAY,KACjB9G,KAAK0W,OAAS,KACd1W,KAAK2W,OAAS,KAGd3W,KAAK4W,OAAS,KACd5W,KAAK8N,KAAO,KAmMb,MAhMAjM,GAAexB,UAAU0D,KAAO,WAC/B,GAAIyD,GAAQxH,IAEZA,MAAK0G,QAAU1G,KAAKN,eAAeC,aAEnC,IAAIyB,GAAWpB,KAAKoB,QAEhBA,GAASyV,GACZ7W,KAAKyW,OAASrV,EAASyV,GAEnB7W,KAAKwW,SAAWpV,EAAS0V,KAI3B9W,KAAK8G,aACL9G,KAAK0W,OAAStV,EAAS2V,EAAEC,EAAEjX,IAAI,SAAUkX,EAAK/O,GAC7C,GAAImO,GAAapH,KAAKgI,GAErB,OACCvV,OAAO,EACPP,KAAM8V,EAAIhP,OAAS,EAAIgP,EAAIpL,MAAM,GAAGrK,MAAM,QAC1CQ,OAAQ8N,EAIV,IAAIoH,GAAWZ,GAAiBzI,KAAKoJ,EACrC,IAAIC,EAEH,OACCC,UAAU,EACV1P,MAAOyP,EAAS,GAIlB,IAAIE,GAAcb,GAAkB1I,KAAKoJ,EACzC,IAAIG,EAEH,OACCD,UAAU,EACV1P,MAAO2P,EAAY,GAAK,EAI1B,IAAIlN,GAAW/B,OAEX3I,EAAQ6X,GAAiB7P,EAAM9H,eAAgBuX,EAUnD,OATKzX,KACJ0K,EAAW1C,EAAM9H,eAAesK,QAAQiN,EAAK,SAAUzX,GACtDgI,EAAMkP,OAAOxO,GAAK1I,EAClBiD,EAAgB+E,EAAMV,UAAWoD,KAGlC1C,EAAMV,UAAUlF,KAAKsI,IAGf1K,IAGRQ,KAAK2W,OAASW,GAAelW,EAAS2V,EAAEQ,EAAGnW,EAAS2V,EAAEC,EAAE/O,WAI1DjI,KAAK4W,OAA6B,gBAAbxV,GACrBA,EAAiC,gBAAfA,GAASoW,EAC3BpW,EAASoW,EAAI,GAAIrR,KAChBC,MAAOpG,KACPoB,SAAUA,EAASoW,IAGpBxX,KAAK8N,KAAO1M,EAAS2V,EACC,gBAAf3V,GAAS2V,GAAkB3V,EAAS2V,GAAK3V,EAAS2V,EAAI3V,EAASqW,EACtE,GAAItR,KACHC,MAAOpG,KACPoB,SAAUA,EAASqW,QAIjBzX,KAAKoB,SAASoW,GAAgC,gBAApBxX,MAAKoB,SAASoW,GAAgBxX,KAAK4W,OAAO7S,OACpE/D,KAAKoB,SAASqW,GAAGzX,KAAK8N,KAAK/J,QAGhClC,EAAexB,UAAUgH,OAAS,WAC5BrH,KAAKqD,QACTrD,KAAKqD,OAAQ,EACbrD,KAAKoG,MAAMiB,WAIbxF,EAAexB,UAAUsC,KAAO,SAAcjB,EAAOgW,GAUpD,GARIhW,IACHA,EAAM4J,QAAUtL,KAAK0G,QAAQ6E,aAC7B7J,EAAMgF,QAAU1G,KAAK0G,QAAQ6F,MAC7B7K,EAAM+F,MAAQzH,KAAKN,eAAeiH,UAE9B+Q,GAAYA,EAAWhF,QAAQhR,IAGhC1B,KAAKyW,OAAQ,CAChB,GAAyC,kBAA9BzW,MAAKuG,QAAQvG,KAAKyW,QAC5B,KAAM,IAAI5N,OAAM,6CAA+C7I,KAAKyW,OAAS,KAG9E,IAAI3I,GAAO3F,MAEX,IAAInI,KAAKwW,SACR1I,EAAO4J,MACD,CACN,GAAIzO,GAASjJ,KAAK0W,OAAO3W,IAAI,SAAUP,GACtC,IAAKA,EAAO,MAAO2I,OAEnB,IAAI3I,EAAMkC,MAAO,CAIhB,IAHA,GAAIiW,GAAMjW,EACNP,EAAO3B,EAAM2B,KAAK0K,QAEf1K,EAAK8G,QAAQ0P,EAAMA,EAAIxW,EAAK+Q,QACnC,OAAOyF,GAGR,MAAInY,GAAM2X,SACFO,EAAaA,EAAWlY,EAAMiI,OAAS,OAG3CjI,EAAMoY,QACFpY,EAAMoY,QAAQpO,MAGfhK,EAAM+M,OAGduB,GAAO9N,KAAK2W,OAAO3I,MAAM,KAAM/E,GAIhC,GAAI1C,GAAUvG,KAAKuG,QACfsR,EAAWtR,EAAQ7E,KAEvB6E,GAAQ7E,MAAQA,EAChB6E,EAAQvG,KAAKyW,QAAQzI,MAAMzH,EAASuH,GACpCvH,EAAQ7E,MAAQmW,MACV,CACN,GAAIjB,GAAS5W,KAAK4W,OAAO9U,WACrBgM,EAAO9N,KAAKoB,SAASqW,EAAIzX,KAAK8N,KAAK9E,cAAgBhJ,KAAK8N,IAExDpM,KAAOA,EAAM6G,KAAOqO,GAExBkB,GAAU9X,KAAKuG,QAASqQ,GACvBlV,MAAOA,EACPoM,KAAMA,MAKTjM,EAAexB,UAAUF,OAAS,WACjC,KAAM,IAAI0I,OAAM,+CAGjBhH,EAAexB,UAAUC,OAAS,WACjCN,KAAK0B,MAAMqW,OAAO/X,OAGnB6B,EAAexB,UAAU2B,OAAS,WACjC,GAAIZ,GAAWpB,KAAKoB,QAEhBA,GAASyV,GACZ7W,KAAK8G,UAAUnG,QAAQuB,GACvBlC,KAAK8G,aAEL9G,KAAK0W,OAAO/V,QAAQ,SAAUnB,GACzBA,GAAOA,EAAMwC,aAIdhC,KAAK4W,OAAO5U,QAAQhC,KAAK4W,OAAO5U,SAChChC,KAAK8N,KAAK9L,QAAQhC,KAAK8N,KAAK9L,WAIlCH,EAAexB,UAAUuC,SAAW,WACnC5C,KAAK0B,MAAMsW,YAGZnW,EAAexB,UAAU8C,OAAS,WAC7BnD,KAAKyW,SAGLzW,KAAK4W,OAAOzT,QAAQnD,KAAK4W,OAAOzT,SAChCnD,KAAKoB,SAASqW,GAAGzX,KAAK8N,KAAK3K,SAE/BnD,KAAKqD,OAAQ,IAGPxB,KAGJoW,GAAW,WACd,QAASA,GAAS1P,EAAMnC,GACvB1C,GAAe1D,KAAMiY,GAEK,KAAtB1P,EAAKmG,QAAQ,MAChBwJ,EAAM,2DAA6D9R,EAAMmC,KAAO,OAASA,EAAO,yBAGjGvI,KAAKuI,KAAOA,EACZvI,KAAKoG,MAAQA,EACbpG,KAAKkE,KAAO,KACZlE,KAAKmY,QAAU,KAuBhB,MApBAF,GAAS5X,UAAU0X,OAAS,SAAgBK,GAC3C,GAAIlU,GAAOlE,KAAKkE,KAAOlE,KAAKoG,MAAMlC,KAC9BqE,EAAOvI,KAAKuI,IAEV,MAAOA,IAAQrE,IACpBmU,GAAc9P,EAAM,UAGrBrE,EAAKoP,iBAAiB/K,EAAMvI,KAAKmY,QAAU,SAAUzW,GACpD0W,EAAUzV,MACTuB,KAAMA,EACNoU,SAAU5W,MAET,IAGJuW,EAAS5X,UAAU2X,SAAW,WAC7BhY,KAAKkE,KAAK0R,oBAAoB5V,KAAKuI,KAAMvI,KAAKmY,SAAS,IAGjDF,KAGJM,GAAc,WACjB,QAASA,GAAYC,EAAapS,GACjC1C,GAAe1D,KAAMuY,GAErBvY,KAAKwY,YAAcA,EACnBxY,KAAKoG,MAAQA,EACbpG,KAAKmY,QAAU,KAkBhB,MAfAI,GAAYlY,UAAU0X,OAAS,SAAgBK,GAC9C,GAAIlU,GAAOlE,KAAKoG,MAAMlC,IAEtBlE,MAAKmY,QAAUnY,KAAKwY,YAAYtU,EAAM,WACrC,GAAIxC,GAAQqU,UAAU9N,QAAU,GAAsBE,SAAjB4N,UAAU,MAAwBA,UAAU,EAEjFrU,GAAMwC,KAAOxC,EAAMwC,MAAQA,EAC3BkU,EAAUzV,KAAKjB,MAIjB6W,EAAYlY,UAAU2X,SAAW,WAChChY,KAAKmY,QAAQhW,YAGPoW,KAGJE,IACHtV,OAAQ2M,EACR3N,SAAU2N,GAGP4I,GAAY,WACf,QAASA,GAAUtS,EAAOhF,GACzBsC,GAAe1D,KAAM0Y,GAErB1Y,KAAKoG,MAAQA,EACbpG,KAAKoB,SAAWA,EAEhBpB,KAAKN,eAAiB0G,EAAM1G,eAC5BM,KAAKuG,QAAUH,EAAMG,QAErBvG,KAAK2Y,YAAoC,gBAAfvX,GAASoW,EACnCxX,KAAK4Y,cAAgBxX,EAASqW,EAE1BzX,KAAK2Y,YACR3Y,KAAK6Y,aAAe,GAAI1S,KACvBC,MAAOpG,KACPoB,SAAUA,EAASoW,IAGpBxX,KAAKuI,KAAOnH,EAASoW,GAAKpW,EAGvBpB,KAAK4Y,YACR5Y,KAAK8Y,aAAe,GAAI3S,KACvBC,MAAOpG,KACPoB,SAAUA,EAASqW,IAGpBzX,KAAK8N,KAAO1M,EAAS2V,MAGtB/W,KAAKkE,KAAO,KACZlE,KAAK+Y,aAAe,KAsErB,MAnEAL,GAAUrY,UAAU0D,KAAO,WACtB/D,KAAK2Y,cACR3Y,KAAK6Y,aAAa9U,OAClB/D,KAAKuI,KAAOvI,KAAK6Y,aAAa/W,YAG3B9B,KAAK4Y,aAAa5Y,KAAK8Y,aAAa/U,QAGzC2U,EAAUrY,UAAUgH,OAAS,WACvBrH,KAAKqD,QACTrD,KAAKqD,OAAQ,EACbrD,KAAKoG,MAAMiB,WAIbqR,EAAUrY,UAAUF,OAAS,WACxBH,KAAK2Y,aAAa3Y,KAAK6Y,aAAa1Y,SACpCH,KAAK4Y,aAAa5Y,KAAK8Y,aAAa3Y,UAGzCuY,EAAUrY,UAAUC,OAAS,WAC5B,GAAI0Y,GAAKC,GAAoB,aAAcjZ,KAAKuG,QAASvG,KAAKuI,KAE9D,KAAKyQ,EAGJ,MAFAX,IAAcrY,KAAKuI,KAAM,mBACzBvI,KAAK+Y,aAAeN,GAIrBzY,MAAKkE,KAAOlE,KAAKoG,MAAMlC,IAEvB,IAAI4J,GAAO9N,KAAK4Y,YAAc5Y,KAAK8Y,aAAa9P,cAAgBhJ,KAAK8N,IAGrE,IAFA9N,KAAK+Y,aAAeC,EAAGhL,MAAMhO,KAAKuG,SAAUvG,KAAKkE,MAAM6J,OAAOD,KAEzD9N,KAAK+Y,eAAiB/Y,KAAK+Y,aAAa5W,SAC5C,KAAM,IAAI0G,OAAM,QAAW7I,KAAKuI,KAAO,6DAIzCmQ,EAAUrY,UAAU2B,OAAS,WACxBhC,KAAK2Y,aAAa3Y,KAAK6Y,aAAa7W,SACpChC,KAAK4Y,aAAa5Y,KAAK8Y,aAAa9W,UAGzC0W,EAAUrY,UAAUuC,SAAW,WAC9B5C,KAAK+Y,aAAa5W,YAGnBuW,EAAUrY,UAAU8C,OAAS,WAC5B,GAAInD,KAAK2Y,YAAa,CACrB,GAAIO,GAAQlZ,KAAK6Y,aAAa/W,UAE1BoX,KAAUlZ,KAAKuI,OAClBvI,KAAKuI,KAAO2Q,EACZlZ,KAAK4C,WACL5C,KAAKM,cAEA,IAAIN,KAAK+Y,aAAa5V,OAAQ,CACpC,GAAI2K,GAAO9N,KAAK4Y,YAAc5Y,KAAK8Y,aAAa9P,cAAgBhJ,KAAK8N,IACrE9N,MAAK+Y,aAAa5V,OAAO6K,MAAMhO,KAAKuG,QAASuH,OAE7C9N,MAAK4C,WACL5C,KAAKM,UAIAoY,KAGJS,GAAM/U,GAAMgV,GAAc,OAAS,KAEnCC,GAAuB,SAAW7V,GAGrC,QAAS6V,GAAqB5V,GAC7BC,GAAe1D,KAAMqZ,GAErB7V,EAAMG,KAAK3D,KAAMyD,GAEjBzD,KAAKsZ,cAELtZ,KAAKoG,MAAQ3C,EAAQ2C,MAErBpG,KAAKE,SAAW,GAAIiG,KACnBI,QAASvG,KAAKuG,QACdH,MAAOpG,KACPoB,UAAWpB,KAAKoB,YAGjBpB,KAAKqD,OAAQ,EAuEd,MAxFAS,IAASuV,EAAsB7V,GAoB/B6V,EAAqBhZ,UAAU0D,KAAO,WACrC/D,KAAKE,SAAS6D,QAGfsV,EAAqBhZ,UAAUgH,OAAS,WAClCrH,KAAKqD,QACTrD,KAAKqD,OAAQ,EACbrD,KAAKoG,MAAMiB,WAIbgS,EAAqBhZ,UAAUF,OAAS,WACvC,KAAM,IAAI0I,OAAM,uDAGjBwQ,EAAqBhZ,UAAUC,OAAS,WACvCN,KAAKkE,KAAOlE,KAAKoG,MAAMlC,KACvBlE,KAAKuZ,MAAQvZ,KAAKkE,KAAKsV,eAAiBlF,GAExCtU,KAAKc,UAAW,EAChBd,KAAKqD,OAAQ,EACbrD,KAAKmD,UAGNkW,EAAqBhZ,UAAUyB,SAAW,WACzC,MAAO9B,MAAKE,SAAS4B,YAGtBuX,EAAqBhZ,UAAU2B,OAAS,WACvChC,KAAKE,SAAS8B,UAGfqX,EAAqBhZ,UAAUuC,SAAW,WACzC5C,KAAKc,UAAW,GAGjBuY,EAAqBhZ,UAAU8C,OAAS,WACvC,GAAIqE,GAAQxH,KAERyZ,EAAMtR,OACNuR,EAAQvR,MAERnI,MAAKqD,QACRrD,KAAKE,SAASiD,SAEVnD,KAAKc,WACR2Y,EAAMzZ,KAAKE,SAAS4B,WACpB4X,EAAQC,GAAgBF,EAAKzZ,KAAKuZ,OAIlCvZ,KAAKsZ,WAAWlG,OAAO,SAAU2D,GAChC,MAAO6C,IAAMF,EAAO3C,KAClBpW,QAAQ,SAAUoW,GACpBvP,EAAMtD,KAAK2V,gBAAgB9C,EAAExO,QAG9BmR,EAAM/Y,QAAQ,SAAUoW,GACvBvP,EAAMtD,KAAK4V,aAAa/C,EAAExO,KAAMwO,EAAEvN,SAGnCxJ,KAAKsZ,WAAaI,GAGnB1Z,KAAKqD,OAAQ,IAIRgW,GACL/V,IAqNCyW,IACHC,iBAAkB,gBAClBC,UAAW,YACXC,QAAS,UACTC,QAAS,YACTC,SAAU,WACVC,QAAS,UACTC,gBAAiB,kBACjBC,SAAU,WACVC,QAAS,UACTC,MAAO,UACPC,aAAc,YACdC,MAAO,QACPC,UAAW,YACXC,WAAY,aACZC,QAAS,UACTC,SAAU,WACVC,QAAS,UACTC,SAAU,WACVC,OAAQ,UA8BLC,GAAY,SAAW3X,GAG1B,QAAS2X,GAAU1X,GAClBC,GAAe1D,KAAMmb,GAErB3X,EAAMG,KAAK3D,KAAMyD,GAEjB2X,GAA0Bpb,KAAMyD,EAAQ8E,MAExCvI,KAAKmV,QAAU1R,EAAQ0R,QACvBnV,KAAKN,eAAiB+D,EAAQ0R,QAAQzV,eACtCM,KAAKuG,QAAUvG,KAAKN,eAAe6G,QAEnCvG,KAAKc,UAAW,EAChBd,KAAKqb,eAAiB,KACtBrb,KAAKE,SAAW,KAChBF,KAAKwJ,MAAQ,KAERgD,EAAQ/I,EAAQrC,UAMpBpB,KAAKE,SAAW,GAAIiG,KACnBC,MAAOpG,KACPoB,SAAUqC,EAAQrC,YAPnBpB,KAAKwJ,MAAQ/F,EAAQrC,SACF,IAAfpB,KAAKwJ,QACRxJ,KAAKwJ,MAAQ,KASfxJ,KAAKsb,aAAetb,KAAKE,UAA2C,IAA/BF,KAAKE,SAASgH,MAAMe,QAAgBjI,KAAKE,SAASgH,MAAM,GAAGtD,OAASiB,IAAgB7E,KAAKE,SAASgH,MAAM,GA6F9I,MA3HApD,IAASqX,EAAW3X,GAiCpB2X,EAAU9a,UAAU0D,KAAO,WACtB/D,KAAKE,UACRF,KAAKE,SAAS6D,QAIhBoX,EAAU9a,UAAUgH,OAAS,WACvBrH,KAAKqD,QACTrD,KAAKmV,QAAQ9N,SACbrH,KAAKqD,OAAQ,IAIf8X,EAAU9a,UAAUkb,UAAY,WAC/B,MAAOvb,MAAKE,SAAWF,KAAKE,SAAS4B,WAA2B,MAAd9B,KAAKwJ,MAAgB,GAAKxJ,KAAKwJ,MAAQ,IAM1F2R,EAAU9a,UAAU6U,SAAW,WAC9B,MAAOlV,MAAKE,SAAWF,KAAKE,SAASuE,UAAY+W,GAAkBvM,KAAKjP,KAAKuI,OAAQ,EAAOvI,KAAKwJ,OAGlG2R,EAAU9a,UAAUF,OAAS,WAC5BH,KAAKgC,SACLhC,KAAK+D,QAGNoX,EAAU9a,UAAUC,OAAS,WAC5B,GAAI4D,GAAOlE,KAAKmV,QAAQjR,IAIxB,IAHAlE,KAAKkE,KAAOA,GAGPA,EAAKsV,cAAgBtV,EAAKsV,eAAiBiC,GAAO,CACtD,GAAIC,GAAe3B,GAAc/Z,KAAKuI,OAASvI,KAAKuI,IAEzBJ,UAAvBjE,EAAKwX,KACR1b,KAAK0b,aAAeA,IAKjBF,GAAkBvM,KAAKjP,KAAKuI,OAASvI,KAAK2b,YAC7C3b,KAAK4b,aAAc,GAGC,UAAjBF,IACHxX,EAAK2X,SAASrS,MAAQxJ,KAAKwJ,OAI7BxJ,KAAKc,UAAW,EAChBd,KAAKqb,eAAiBS,GAAkB9b,MACxCA,KAAKqb,kBAGNF,EAAU9a,UAAUyB,SAAW,WAC9B,GAAI0H,GAAQxJ,KAAKkV,UAGjB,IAAkB,UAAdlV,KAAKuI,MAAsEJ,SAAjDnI,KAAKmV,QAAQC,aAAa,oBAA2D,WAAtBpV,KAAKmV,QAAQ5M,MAA2C,aAAtBvI,KAAKmV,QAAQ5M,KAA5I,CAKA,GAAkB,SAAdvI,KAAKuI,MAAyC,UAAtBvI,KAAKmV,QAAQ5M,MAAoBvI,KAAKsb,aACjE,MAAO,WAAatb,KAAKsb,aAAa9b,MAAM+L,aAAe,KAG5D,IAAIiQ,GAAkBvM,KAAKjP,KAAKuI,MAAO,MAAOiB,GAAQxJ,KAAKuI,KAAO,EAClE,IAAa,MAATiB,EAAe,MAAO,EAE1B,IAAIiQ,GAAMsC,GAAkB/b,KAAKub,aAAalO,QAAQ,KAAM,SAASA,QAAQ,KAAM,UAAUA,QAAQ,KAAM,QAE3G,OAAOoM,GAAMzZ,KAAKuI,KAAO,KAAOkR,EAAM,IAAMzZ,KAAKuI,OAGlD4S,EAAU9a,UAAU2B,OAAS,WACxBhC,KAAKE,UAAUF,KAAKE,SAAS8B,UAGlCmZ,EAAU9a,UAAU8C,OAAS,WACxBnD,KAAKqD,QACJrD,KAAKE,UAAUF,KAAKE,SAASiD,SAC7BnD,KAAKc,UAAUd,KAAKqb,iBACxBrb,KAAKqD,OAAQ,IAIR8X,GACL7X,IAMC0Y,GAAU,SAAWxY,GAGxB,QAASwY,GAAQvY,GAChB,GAAI+D,GAAQxH,IAEZ0D,IAAe1D,KAAMgc,GAErBxY,EAAMG,KAAK3D,KAAMyD,GAEjBzD,KAAKgD,eAELhD,KAAKuI,KAAO9E,EAAQrC,SAAS6a,EAAEC,cAC/Blc,KAAKmc,OAASC,GAAiBnN,KAAKjP,KAAKuI,KAIzC,KADA,GAAIrI,GAAWF,KAAKN,eACbQ,GAAU,CAChB,GAAIA,EAASkG,MAAMxC,OAASgF,GAAS,CACpC5I,KAAKsG,OAASpG,EAASkG,KACvB,OAEDlG,EAAWA,EAASoG,OAIrBtG,KAAKqc,mBACLrc,KAAKsZ,cAEDtZ,KAAKoB,SAAS2V,IACjB7V,OAAOC,KAAKnB,KAAKoB,SAAS2V,GAAGpW,QAAQ,SAAU4H,GAE9C,GAAa,WAATA,GAA8B,SAATA,EAAzB,CAEA,GAAI+T,GAAY,GAAInB,KACnB5S,KAAMA,EACN4M,QAAS3N,EACT9H,eAAgB8H,EAAM9H,eACtB0B,SAAUoG,EAAMpG,SAAS2V,EAAExO,IAG5Bf,GAAM6U,gBAAgB9T,GAAQ+T,EAEjB,UAAT/T,GAA6B,SAATA,GAAiBf,EAAM8R,WAAW1X,KAAK0a,MAG5Dtc,KAAKqc,gBAAgBzY,MAAM5D,KAAKsZ,WAAW5G,QAAQ1S,KAAKqc,gBAAgBzY,MACxE5D,KAAKqc,gBAAgB7S,OAAOxJ,KAAKsZ,WAAW1X,KAAK5B,KAAKqc,gBAAgB7S,QAI3ExJ,KAAKuc,uBAAyBvc,KAAKoB,SAASyV,OAAS9W,IAAI,SAAUqB,GAClE,MAAO,IAAIiY,KACVjT,MAAOoB,EACP9H,eAAgB8H,EAAM9H,eACtB0B,SAAUA,MAKRpB,KAAKoB,SAASob,IACjBxc,KAAKyc,UAAY,GAAI/D,IAAU1Y,KAAMA,KAAKoB,SAASob,IAIpDxc,KAAKU,iBACDV,KAAKoB,SAASC,GACjBH,OAAOC,KAAKnB,KAAKoB,SAASC,GAAGV,QAAQ,SAAUW,GAC9C,GAAIC,GAAaD,EAAIE,MAAM,KACvBJ,EAAWoG,EAAMpG,SAASC,EAAEC,EAEhCC,GAAWZ,QAAQ,SAAUc,GAC5B,GAAIuX,GAAKC,GAAoB,SAAUzR,EAAMjB,QAAS9E,GAGlDC,EAAQsX,EAAK,GAAIT,IAAYS,EAAIxR,GAAS,GAAIyQ,IAASxW,EAAW+F,EACtEA,GAAM9G,cAAckB,KAAK,GAAIC,IAAe2F,EAAO9F,EAAON,QAMzDqC,EAAQrC,SAASsb,IACpB1c,KAAKE,SAAW,GAAIiG,KACnB/E,SAAUqC,EAAQrC,SAASsb,EAC3BtW,MAAOpG,KACP6G,OAAQ,QAIV7G,KAAK2c,QAAU,KAgQhB,MAzVA7Y,IAASkY,EAASxY,GA4FlBwY,EAAQ3b,UAAU0D,KAAO,WACxB/D,KAAKsZ,WAAW3Y,QAAQwG,GACxBnH,KAAKuc,sBAAsB5b,QAAQwG,GACnCnH,KAAKU,cAAcC,QAAQwG,GAEvBnH,KAAKyc,WAAWzc,KAAKyc,UAAU1Y,OAC/B/D,KAAKE,UAAUF,KAAKE,SAAS6D,QAG7B/D,KAAK2c,QAAU3c,KAAK4c,wBAAuB5c,KAAK2c,QAAQ5Y,QAG7DiY,EAAQ3b,UAAUuc,oBAAsB,WACvC,GAAItD,GAAatZ,KAAKoB,SAAS2V,CAE/B,KAAKuC,EAAY,MAAO,KAExB,IAAIuD,GAAa,UAAYvD,GAAmC,IAAtBA,EAAWwD,QAAsC,SAAtBxD,EAAWwD,OAChF9c,KAAKuG,QAAQuW,MAEb,KAAKD,EAAY,MAAO,KAExB,IAAIhH,GAAUkH,GAAc/c,KAE5B,KAAK6V,EAAS,MAAO,KAErB,IAAI8G,GAAU,GAAI9G,GAAQ7V,KAE1B,OAAO2c,IAAWA,EAAQnd,MAAQmd,EAAU,MAG7CX,EAAQ3b,UAAU2D,OAAS,WAG1B,MAFIhE,MAAKyc,WAAWzc,KAAKyc,UAAU7Z,WAE5BqB,GAAWjE,KAAKkE,OAGxB8X,EAAQ3b,UAAUyH,KAAO,SAAcC,GACtC,MAAImH,IAAQlP,KAAKkE,KAAM6D,GAAkB/H,KAAKkE,KAC1ClE,KAAKE,SACDF,KAAKE,SAAS4H,KAAKC,GAD3B,QAKDiU,EAAQ3b,UAAUgI,QAAU,SAAiBN,EAAU9E,GAGtD,GAAIiM,GAAUjM,EAAMgM,KAAKjP,KAAKkE,KAC1BgL,KACHjM,EAAMsL,IAAIvO,KAAKkE,MACXjB,EAAMmL,MAAMpO,KAAKgD,YAAYpB,KAAKqB,IAGnCjD,KAAKE,UACRF,KAAKE,SAASmI,QAAQN,EAAU9E,IAIlC+Y,EAAQ3b,UAAUiI,cAAgB,SAAuBC,GACxD,MAAIvI,MAAKE,SACDF,KAAKE,SAASoI,cAAcC,GADpC,QAKDyT,EAAQ3b,UAAUmI,kBAAoB,SAA2BD,EAAMtF,GAClEjD,KAAKE,UACRF,KAAKE,SAASsI,kBAAkBD,EAAMtF,IAIxC+Y,EAAQ3b,UAAUoI,aAAe,WAChC,MAAO,OAGRuT,EAAQ3b,UAAU8D,UAAY,WAC7B,MAAOnE,MAAKkE,MAGb8X,EAAQ3b,UAAU+U,aAAe,SAAsB7M,GACtD,GAAI+T,GAAYtc,KAAKqc,gBAAgB9T,EACrC,OAAO+T,GAAYA,EAAUpH,WAAa/M,QAG3C6T,EAAQ3b,UAAUF,OAAS,WAC1BH,KAAKsZ,WAAW3Y,QAAQ8I,GACxBzJ,KAAKuc,sBAAsB5b,QAAQ8I,GAC/BzJ,KAAKyc,WAAWzc,KAAKyc,UAAUtc,SAC/BH,KAAKE,UAAUF,KAAKE,SAASC,SAC7BH,KAAK2c,SAAS3c,KAAK2c,QAAQxc,SAE/BH,KAAKgD,YAAYrC,QAAQqc,KAG1BhB,EAAQ3b,UAAUC,OAAS,SAAgBC,GAC1C,GAAI4M,GAASnN,IAGbA,MAAKid,UAAYC,GAAald,KAE9B,IAAIkE,GAAOkV,GAAcpZ,KAAKoB,SAAS6a,EAAGjc,KAAKid,UAAWjd,KAAKoV,aAAa,MAC5EpV,MAAKkE,KAAOA,CAEZ,IAAIwC,GAAU1G,KAAKN,eAAeC,aAElCwd,IAAejZ,EAAM,YACpBsF,OACC4T,MAAOpd,KACPuG,QAASvG,KAAKuG,QACdrG,SAAUF,KAAKN,eACfgH,QAASA,EACT4E,QAAS5E,EAAQ6E,gBAMfvL,KAAKN,eAAemH,QACvB3C,EAAK4V,aAAa,mBAAoB9Z,KAAKN,eAAemH,OAAO9G,IAAI,SAAUsd,GAC9E,MAAO,IAAMA,EAAI,MACf9S,KAAK,MAGLvK,KAAKE,UACRF,KAAKE,SAASI,OAAO4D,GAGtBlE,KAAKsZ,WAAW3Y,QAAQC,GACxBZ,KAAKuc,sBAAsB5b,QAAQC,GAE/BZ,KAAKyc,WAAWnV,GAAQsH,aAAa,WACxC,MAAOzB,GAAOsP,UAAUnc,WACtB,GACCN,KAAK2c,SAAS3c,KAAK2c,QAAQrc,SAE/BN,KAAKU,cAAcC,QAAQC,GAE3B0c,GAAmBtd,KAGnB,IAAIud,GAAqBvd,KAAKoB,SAASoc,IAAMxd,KAAKoB,SAASqc,EAC3D,IAAIF,GAAsBvd,KAAKuG,QAAQmX,mBAAoB,CAC1D,GAAIC,GAAa,GAAIC,IAAW5d,KAAMud,GAAoB,EAC1DjW,IAAQuW,mBAAmBF,GAE3B3d,KAAK8d,iBAAmBH,EAGzBpd,EAAO+D,YAAYJ,GAEnBlE,KAAKc,UAAW,GAGjBkb,EAAQ3b,UAAUyB,SAAW,WAC5B,GAAIic,GAAU/d,KAAKoB,SAAS6a,EAExBvC,EAAQ1Z,KAAKsZ,WAAWvZ,IAAIie,IAAoBzT,KAAK,IAAMvK,KAAKuc,sBAAsBxc,IAAIie,IAAoBzT,KAAK,GAGrG,YAAdvK,KAAKuI,MAAqBvI,KAAKie,eAClCvE,GAAS,aAIQ,UAAd1Z,KAAKuI,MAAoB2V,GAAoBle,QAChD0Z,GAAS,WAGV,IAAID,GAAM,IAAMsE,EAAUrE,EAAQ,GAElC,OAAI1Z,MAAKmc,OAAe1C,GAGN,aAAdzZ,KAAKuI,MAAsDJ,SAA/BnI,KAAKoV,aAAa,SACjDqE,GAAOjV,GAAWxE,KAAKoV,aAAa,UAIajN,SAAzCnI,KAAKoV,aAAa,qBACzBqE,GAAOzZ,KAAKoV,aAAa,UAAY,IAGnCpV,KAAKE,WACRuZ,GAAOzZ,KAAKE,SAAS4B,UAAU,sBAAsBmN,KAAKjP,KAAKoB,SAAS6a,KAGzExC,GAAO,KAAOsE,EAAU,MAIzB/B,EAAQ3b,UAAU2B,OAAS,WAC1BhC,KAAKsZ,WAAW3Y,QAAQuB,GACxBlC,KAAKuc,sBAAsB5b,QAAQuB,GAE/BlC,KAAKyc,WAAWzc,KAAKyc,UAAUza,SAC/BhC,KAAKE,UAAUF,KAAKE,SAAS8B,UAGlCga,EAAQ3b,UAAUuC,SAAW,SAAkBC,GAC9C,GAAK7C,KAAKc,SAAV,CACAd,KAAKc,UAAW,CAIhB,IAAI6c,GAAa3d,KAAK8d,gBAClBH,IAAYA,EAAWQ,WAGT,WAAdne,KAAKuI,KAIRvI,KAAKgE,SACKnB,GACVyE,GAAQ8W,gBAAgBpe,MAGrBA,KAAKE,UAAUF,KAAKE,SAAS0C,WAEjC5C,KAAKU,cAAcC,QAAQoC,GAEvB/C,KAAK2c,SAAS3c,KAAK2c,QAAQ/Z,YAC1BC,GAAiB7C,KAAKyc,WAAWzc,KAAKyc,UAAU7Z,UAGrD,IAAI2a,GAAqBvd,KAAKoB,SAASoc,IAAMxd,KAAKoB,SAASid,EAC3D,IAAId,GAAsBvd,KAAKuG,QAAQmX,mBAAoB,CAC1D,GAAIY,GAAc,GAAIV,IAAW5d,KAAMud,GAAoB,EAC3DjW,IAAQuW,mBAAmBS,GAI5B,GAAIC,GAAKve,KAAKqc,gBAAgBkC,EAC1BA,UACIve,MAAKuG,QAAQiY,MAAMD,EAAGrJ,YAG9BuJ,GAAsBze,QAIvBgc,EAAQ3b,UAAU8C,OAAS,WACtBnD,KAAKqD,QACRrD,KAAKsZ,WAAW3Y,QAAQyC,GACxBpD,KAAKuc,sBAAsB5b,QAAQyC,GACnCpD,KAAKU,cAAcC,QAAQyC,GAEvBpD,KAAKyc,WAAWzc,KAAKyc,UAAUtZ,SAC/BnD,KAAKE,UAAUF,KAAKE,SAASiD,SAEjCnD,KAAKqD,OAAQ,IAIR2Y,GACL1Y,IAoDCsC,GAAQ,SAAW8Y,GAGtB,QAAS9Y,KACRlC,GAAe1D,KAAM4F,GAErB8Y,EAAS1Q,MAAMhO,KAAM+V,WAQtB,MAbAjS,IAAS8B,EAAO8Y,GAQhB9Y,EAAMvF,UAAUC,OAAS,SAAgBC,GACxCme,EAASre,UAAUC,OAAOqD,KAAK3D,KAAMO,GACrCP,KAAKkE,KAAKya,aAAe3e,KAAKkE,KAAKsF,OAG7B5D,GACLoW,IAEC9V,GAAW,SAAW0Y,GAGzB,QAAS1Y,GAASzC,GACjBC,GAAe1D,KAAMkG,EAErB,IAAI9E,GAAWqC,EAAQrC,UAEnBA,EAASsb,GAAOtb,EAAS2V,GAAM3V,EAAS2V,EAAEvN,QAAUqV,IAAazd,SAAUA,EAASsb,MAClFtb,EAAS2V,IAAG3V,EAAS2V,MAC1B3V,EAAS2V,EAAEvN,MAAQpI,EAASsb,QACrBtb,GAASsb,GAGjBkC,EAAOjb,KAAK3D,KAAMyD,GAoBnB,MAjCAK,IAASoC,EAAU0Y,GAgBnB1Y,EAAS7F,UAAUgH,OAAS,WAC3B,GAAIG,GAAQxH,IAEPA,MAAKqD,QACTrD,KAAKqD,OAAQ,EAETrD,KAAKc,WAAad,KAAK2c,SAAW3c,KAAKE,UAC1CoH,GAAQsH,aAAa,WACpBpH,EAAMnE,OAAQ,EACdmE,EAAMtD,KAAKsF,MAAQhC,EAAMtH,SAAS4B,aAIpC9B,KAAKN,eAAe2H,WAIfnB,GACLN,IASCI,GAAS,SAAW0Y,GAGvB,QAAS1Y,GAAOvC,GACfC,GAAe1D,KAAMgG,GAErB0Y,EAAS/a,KAAK3D,KAAMyD,GACpBzD,KAAKyD,WAmFN,MAzFAK,IAASkC,EAAQ0Y,GASjB1Y,EAAO3F,UAAUgH,OAAS,WACzB,GAAIG,GAAQxH,IAEPA,MAAKqD,QACTrD,KAAKqD,OAAQ,EAETrD,KAAKc,UACRwG,GAAQsH,aAAa,WACpBpH,EAAMsX,OACNtX,EAAMnE,OAAQ,IAIhBrD,KAAKN,eAAe2H,WAItBrB,EAAO3F,UAAUC,OAAS,SAAgBC,GACzCme,EAASre,UAAUC,OAAOqD,KAAK3D,KAAMO,GACrCP,KAAK8e,MAKL,KAHA,GAAI5a,GAAOlE,KAAKkE,KAEZgE,EAAIhE,EAAKT,QAAQwE,OACdC,KACNhE,EAAKT,QAAQyE,GAAG6W,gBAAkB7a,EAAKT,QAAQyE,GAAG8W,QAGnDhf,MAAKc,UAAW,GAGjBkF,EAAO3F,UAAUye,KAAO,WACvB,GAAIG,GAAajf,KAAKkE,IAEtB,IAAK+a,EAAL,CAEA,GAAIxb,GAAUyb,EAAQD,EAAWxb,SAE7B0b,EAAcnf,KAAKoV,aAAa,SAChCgK,EAAapf,KAAKoV,aAAa,WAInC,IAAoBjN,SAAhBgX,EAA2B,CAC9B,GAAIE,GAAoBlX,MAExB1E,GAAQ9C,QAAQ,SAAU6b,GACzB,GAAI8C,GAAc9C,EAAEX,SAAWW,EAAEX,SAASrS,MAAQgT,EAAEhT,MAChD+V,EAAeH,EAAaI,GAAcL,EAAaG,GAAeH,GAAeG,CAErFC,KACHF,GAAoB,GAGrB7C,EAAEwC,SAAWO,IAGTF,GAAsBD,IACtB3b,EAAQ,KACXA,EAAQ,GAAGub,UAAW,GAGnBhf,KAAK2c,SACR3c,KAAK2c,QAAQ8C,mBAOPzf,MAAK2c,SACZ3c,KAAK2c,QAAQ8C,gBAIhBzZ,EAAO3F,UAAU8C,OAAS,WACzBub,EAASre,UAAU8C,OAAOQ,KAAK3D,MAC/BA,KAAK8e,QAGC9Y,GACLgW,IASClW,GAAS,SAAW4Y,GAGvB,QAAS5Y,GAAOrC,GACfC,GAAe1D,KAAM8F,EAErB,IAAI1E,GAAWqC,EAAQrC,QAClBA,GAAS2V,IAAG3V,EAAS2V,MAID5O,SAArB/G,EAAS2V,EAAEvN,OAAyB,YAAcpI,KACrDA,EAAS2V,EAAEvN,MAAQpI,EAASsb,GAAK,IAGlCgC,EAAS/a,KAAK3D,KAAMyD,GAEpBzD,KAAK+F,OAAS2Z,GAAiB1f,KAAKsG,QAqDrC,MArEAxC,IAASgC,EAAQ4Y,GAmBjB5Y,EAAOzF,UAAU0D,KAAO,WACvB,IAAK/D,KAAK+F,OAET,WADA2Y,GAASre,UAAU0D,KAAKJ,KAAK3D,KAM9B,IAAI2f,GAAoB3f,KAAKqc,gBAAgB2C,QAC7C,IAAIW,GAA2DxX,SAAtCnI,KAAK+F,OAAOqP,aAAa,SAAwB,CACzE,GAAI3N,GAAQzH,KAAKsZ,WAAW5K,QAAQiR,EACpC3f,MAAKsZ,WAAW3K,OAAOlH,EAAO,SACvBzH,MAAKqc,gBAAgB2C,SAG7BN,EAASre,UAAU0D,KAAKJ,KAAK3D,MAC7BA,KAAK+F,OAAOtC,QAAQ7B,KAAK5B,OAG1B8F,EAAOzF,UAAU4d,WAAa,WAC7B,GAAIqB,GAActf,KAAKoV,aAAa,QAEpC,IAAoBjN,SAAhBmX,IAA8Btf,KAAK+F,OACtC,OAAO,CAGR,IAAIoZ,GAAcnf,KAAK+F,OAAOqP,aAAa,QAE3C,IAAI+J,GAAeG,EAClB,OAAO,CAGR,IAAItf,KAAK+F,OAAOqP,aAAa,aAAe5I,EAAQ2S,GAEnD,IADA,GAAIjX,GAAIiX,EAAYlX,OACbC,KACN,GAAIiX,EAAYjX,IAAMoX,EACrB,OAAO,GAMXxZ,EAAOzF,UAAU2B,OAAS,WACzB0c,EAASre,UAAU2B,OAAO2B,KAAK3D,MAE3BA,KAAK+F,QACRtD,EAAgBzC,KAAK+F,OAAOtC,QAASzD,OAIhC8F,GACLkW,IAECtW,GAAO,SAAWgZ,GAGrB,QAAShZ,GAAKjC,GACbC,GAAe1D,KAAM0F,GAErBgZ,EAAS/a,KAAK3D,KAAMyD,GACpBzD,KAAK4f,gBAYN,MAlBA9b,IAAS4B,EAAMgZ,GASfhZ,EAAKrF,UAAUC,OAAS,SAAgBC,GACvCme,EAASre,UAAUC,OAAOqD,KAAK3D,KAAMO,GACrCP,KAAKkE,KAAKoP,iBAAiB,QAASuM,IAAa,IAGlDna,EAAKrF,UAAUuC,SAAW,WACzB5C,KAAKkE,KAAK0R,oBAAoB,QAASiK,IAAa,IAG9Cna,GACLsW,IAcCra,GAAe,WAClB,QAASA,GAAa4E,EAASgC,GAC9B7E,GAAe1D,KAAM2B,GAErB3B,KAAKuG,QAAUA,EACfvG,KAAKuI,KAAOA,EACZvI,KAAKmY,QAAU,KA2BhB,MAxBAxW,GAAatB,UAAU0X,OAAS,SAAgBK,GAC/C,GAAI7R,GAAUvG,KAAKuG,OAEnBvG,MAAKmY,QAAU5R,EAAQgL,GAAGvR,KAAKuI,KAAM,WACpC,GAAI7G,GAAQyG,MAGR4N,WAAU9N,QAAU8N,UAAU,IAAMA,UAAU,GAAG7R,OACpDxC,EAAQyR,MAAM9S,UAAU6R,MAAMvO,KAAKoS,WACnCrU,EAAM+E,UAAYF,EAGnB,IAAIuH,GAAOqF,MAAM9S,UAAUwL,MAAMlI,KAAKoS,UAItC,OAHAqC,GAAUzV,KAAKjB,EAAOoM,IAGf,KAITnM,EAAatB,UAAU2X,SAAW,WACjChY,KAAKmY,QAAQrL,UAGPnL,KAiCJme,GAAU,sCACVC,MACA1c,IAAQ,CACPe,KAOJ4b,GAAe5b,GAAIgV,cAAc,SACjC4G,GAAapc,KAAO,WAEpBqc,GAAO7b,GAAI8b,qBAAqB,QAAQ,GAExCC,IAAQ,EAIRC,GAAaJ,GAAaI,WAE1BC,GAAU,WACT,GAAIC,GAAMR,GAAUC,GAAOhgB,IAAI,SAAUwX,GACxC,MAAO,SAAWA,EAAEgH,GAAK,SAAWhH,EAAEwI,SACpCxV,KAAK,KAEJ6V,IACHA,GAAWG,QAAUD,EAErBN,GAAa9J,UAAYoK,EAGrBH,KACJF,GAAK3b,YAAY0b,IACjBG,IAAQ,IAIVK,IACCjS,IAAK,SAAUgJ,GACdwI,GAAOne,KAAK2V,GACZlU,IAAQ,GAGT2K,MAAO,WACF3K,KACHgd,KACAhd,IAAQ,MA1CXmd,IACCjS,IAAKuB,EACL9B,MAAO8B,EA8CT,IAAI2Q,IAAc,GAAI9V,IAAK,UACvB+V,GAAgB,GAAI/V,IAAK,YA6DzBgW,GAAY,WACf,QAASA,GAAUjf,GAClBgC,GAAe1D,KAAM2gB,GAErB3gB,KAAK4gB,KAAO,GAAIjW,IAAKjJ,GACrB1B,KAAK6gB,aACL7gB,KAAK8gB,SAuBN,MApBAH,GAAUtgB,UAAU0gB,MAAQ,SAAexa,GAC1CvG,KAAK6gB,UAAUta,EAAQ6C,QAAS,GAGjCuX,EAAUtgB,UAAU2gB,IAAM,SAAaza,GACtC,GAAID,GAASC,EAAQD,MAIhBA,IAAWtG,KAAK6gB,UAAUva,EAAO8C,OAKpC6X,GAAcjhB,KAAK8gB,MAAOxa,GAAQ1E,KAAK2E,GAJxC2a,GAAMlhB,KAAMuG,SAONvG,MAAK6gB,UAAUta,EAAQ6C,QAGxBuX,KAGJQ,GAAmB,EAEnBC,IACH7Y,KAAM,WAENyL,OAAQ,SAAUqN,EAAQC,EAAO7d,GAEhC,GAAI,YAAcA,GAAS,CAC1B,GAAIrC,GAAWqC,EAAQrC,QAEC,mBAAbA,GACVkgB,EAAMlgB,SAAWA,EAEjBkgB,EAAMlgB,SAAWmgB,GAAcngB,EAAUkgB,KAK5CnW,KAAM,SAAUkW,EAAQ9a,EAAS9C,GAIhC,GAAIrC,GAAW,YAAcqC,GAAUA,EAAQrC,SAAWigB,EAAOhhB,UAAUe,QAG3E,IAFAA,EAAWA,IAAcC,EAAG8f,GAAkBK,MAEtB,kBAAbpgB,GAAyB,CACnC,GAAI4X,GAAK5X,CACTA,GAAWqgB,GAAmBlb,EAASyS,GAEvCzS,EAAQmb,QAAQtgB,UACf4X,GAAIA,EACJ1K,OAAQlN,GAIVA,EAAWmgB,GAAcngB,EAAUmF,GAMnCA,EAAQnF,SAAWA,EAASogB,EAExBpgB,EAASugB,GACZC,GAAerb,EAAQwO,SAAU3T,EAASugB,IAI5ChQ,MAAO,SAAUpL,GAChB,GAAI+H,GAASuT,GAAWtb,EAExB,IAAI+H,EAAQ,CACX,GAAIjF,GAASkY,GAAcjT,EAAQ/H,EAKnC,OAHAA,GAAQnF,SAAWiI,EAAOmY,EAC1BI,GAAerb,EAAQwO,SAAU1L,EAAOsY,GAAG,IAEpC,KA2FNG,IACHvZ,KAAM,OAENyL,OAAQ,SAAUqN,EAAQC,EAAO7d,GAChC,GAAInC,GAAM6G,OACNqB,EAAQrB,MAGZ,IAAI1E,EAAQse,MAAQC,EAASve,EAAQse,MACpC,IAAKzgB,IAAOmC,GAAQse,KACnBvY,EAAQ/F,EAAQse,KAAKzgB,GAEjBkI,GAA0B,gBAAVA,KACfwY,EAASxY,IAAUgD,EAAQhD,KAC9ByY,EAAY,mUAMhBX,GAAMS,KAAOG,GAAUZ,EAAMS,KAAMte,EAAQse,OAG5C5W,KAAM,SAAUkW,EAAQ9a,EAAS9C,GAChC,GAAI6K,GAAS4T,GAAUb,EAAOhhB,UAAU0hB,KAAMte,EAAQse,KAMtD,IAJsB,kBAAXzT,KAAuBA,EAASA,EAAO3K,KAAK4C,IAInD+H,GAAUA,EAAOoF,cAAgBxS,OACpC,IAAK,GAAIihB,KAAQ7T,GACY,kBAAjBA,GAAO6T,KAAsB7T,EAAO6T,GAAQC,EAAM9T,EAAO6T,GAAO5b,GAI7E,OAAO+H,QAGRqD,MAAO,SAAUpL,GAChB,GAAI+H,GAAStO,KAAKmL,KAAK5E,EAAQmN,YAAanN,EAASA,EAAQzG,UAE7D,OADAyG,GAAQzG,UAAUuiB,KAAKrQ,IAAI1D,IACpB,IA6DLgU,GAAmB,+BACnBC,GAAkB,eAClBC,GAAsB,gGACtBC,GAAoB,UACpBC,GAAqB,yCAoErBC,GAAO,EAEPC,IACHra,KAAM,MAENyL,OAAQ,SAAUqN,EAAQC,EAAO7d,GAChC,GAAIA,EAAQ6c,IAAK,CAChB,GAAI/B,GAAKoE,KACL5C,EAAStc,EAAQof,eAAiBpf,EAAQ6c,IAAMwC,GAAarf,EAAQ6c,IAAK/B,EAE9E+C,GAAMyB,MAAQxE,EACdiC,GAAKjS,KAAMgQ,GAAIA,EAAIwB,OAAQA,MAI7B5U,KAAM,cAGH6X,IACHhP,OAAQ,SAAUqN,EAAQC,EAAO7d,GAChC6d,EAAM2B,MAAQC,GAAS5B,EAAM2B,MAAOE,EAAY1f,EAAQwf,SAGzD9X,KAAM,cAgBHiY,IAAkB,WAAY,aAAc,WAAY,aAAc,SAAU,SAAU,gBAAiB,WAAY,eAEvHC,GAAW,WACd,QAASA,GAAS9a,EAAM+a,GACvB5f,GAAe1D,KAAMqjB,GAErBrjB,KAAKuI,KAAOA,EACZvI,KAAKsjB,YAAcA,EA4CpB,MAzCAD,GAAShjB,UAAU2T,OAAS,SAAgBqN,EAAQC,EAAO7d,GAC1DzD,KAAKujB,UAAUvjB,KAAKsjB,YAAcjC,EAAO1N,SAAW0N,EAAQrhB,KAAKsjB,YAAchC,EAAQA,EAAM5N,YAAajQ,IAG3G4f,EAAShjB,UAAU8K,KAAO,aAI1BkY,EAAShjB,UAAUkjB,UAAY,SAAmBlC,EAAQ9gB,EAAQkD,GACjE,GAAI8E,GAAOvI,KAAKuI,KACZ1C,EAASpC,EAAQ8E,GAEjBib,EAAWC,GAAOpC,EAAO9Y,GAE7B,KAAK,GAAIjH,KAAOuE,GACf2d,EAASliB,GAAOuE,EAAOvE,EAGxBf,GAAOgI,GAAQib,GAGhBH,EAAShjB,UAAUsR,MAAQ,SAAepL,GACzC,GAAIid,GAAWjd,EAAQvG,KAAKuI,MACxBmb,GAAU,CAed,OAbAxiB,QAAOC,KAAKqiB,GAAU7iB,QAAQ,SAAUW,GACvC,GAAIuG,GAAO2b,EAASliB,EAEhBuG,GAAK8b,MACJ9b,EAAK8b,IAAIC,QACZJ,EAASliB,GAAOuG,EAAK8b,UAEdH,GAASliB,GAEjBoiB,GAAU,KAILA,GAGDL,KAGJQ,GAAaT,GAAerjB,IAAI,SAAUwI,GAC7C,MAAO,IAAI8a,IAAS9a,EAAe,aAATA,KA4EvBub,IACHb,MAAOD,GACP1C,IAAKsC,GACLb,KAAMD,GACN1gB,SAAUggB,IAGP2C,GAAc7iB,OAAOC,KAAKsS,IAE1BuQ,GAAgBC,GAAQF,GAAY3Q,OAAO,SAAU9R,GACxD,OAAQwiB,GAAOxiB,MAIZ4iB,GAAgBD,GAAQF,GAAYhW,OAAO8V,GAAW9jB,IAAI,SAAUiX,GACvE,MAAOA,GAAEzO,SAGN4b,MAAWpW,OAAOgW,GAAY3Q,OAAO,SAAU9R,GAClD,OAAQuiB,GAAWviB,KAASwiB,GAAOxiB,KAChCuiB,GAEJC,GAAO1iB,SAAU0iB,GAAOxD,KAEpB8D,IACHpQ,OAAQ,SAAUqN,EAAQC,EAAO7d,GAChC,MAAO4gB,IAAW,SAAUhD,EAAQC,EAAO7d,IAG5C0H,KAAM,SAAUkW,EAAQ9a,EAAS9C,GAChC,MAAO4gB,IAAW,OAAQhD,EAAQ9a,EAAS9C,IAG5CkO,MAAO,SAAUpL,GAChB,MAAO4d,IAAM/Q,OAAO,SAAUkR,GAC7B,MAAOA,GAAE3S,OAAS2S,EAAE3S,MAAMpL,KACxBxG,IAAI,SAAUukB,GAChB,MAAOA,GAAE/b,QAMX4b,MAAOA,IAyDJI,GAAa,GAAI5Z,IAAK,UACtB6Z,GAAW,GAAI7D,IAAU,QA4DzB8D,GAAW,kBAkGXC,GAAc,SAAWC,GAG5B,QAASD,GAAY5kB,EAAW8kB,EAAWtjB,GAC1CoC,GAAe1D,KAAM0kB,GAErBC,EAAOhhB,KAAK3D,KAAM,KAAM,MAExBA,KAAKqiB,KAAOriB,KAAKsG,OAASxG,EAC1BE,KAAK4kB,UAAYA,EACjB5kB,KAAKsB,IAAMA,EAEXtB,KAAK6kB,YAAc7kB,KAAK4kB,UAAUE,OAElC9kB,KAAK0G,QAAU5G,EAAUilB,mBAEzB/kB,KAAKglB,gBAELhlB,KAAKilB,YACLjlB,KAAKklB,cAELllB,KAAKmlB,QAELnlB,KAAKolB,iBAAkB,EACvBplB,KAAKqD,OAAQ,EA0Fd,MAjHAS,IAAS4gB,EAAaC,GA0BtBD,EAAYrkB,UAAUkM,IAAM,SAAa8Y,GASxC,MARIA,IAAeC,GAAQtlB,MAEvBA,KAAKqD,QACRrD,KAAKwJ,MAAQxJ,KAAKkV,WAClBlV,KAAKijB,QACLjjB,KAAKqD,OAAQ,GAGPrD,KAAKwJ,OAGbkb,EAAYrkB,UAAU6U,SAAW,WAChCqQ,IACA,IAAIjX,GAASnG,MAEb,KACCmG,EAAStO,KAAK4kB,UAAUY,OAAO7hB,KAAK3D,KAAK0G,SACxC,MAAO+e,GACRxD,EAAY,qBAAuBjiB,KAAKuL,aAAe,MAAQka,EAAIC,SAAWD,IAK1EE,QAAQC,gBAAgBD,QAAQC,eAAe,iBAAkB,6EACrE,IAAIC,GAAeC,GAAS9lB,KAAK4kB,UAAUmB,cACvCC,EAAQhmB,KAAK4kB,UAAUqB,eAAiB,OAASC,GAAcT,EAAIO,OAAS,EAChFL,SAAQQ,MAAMV,EAAIld,KAAO,KAAOkd,EAAIC,QAAU,OAASG,EAAeG,GAClEL,QAAQC,gBAAgBD,QAAQS,WAGrC,GAAIpB,GAAeqB,IAGnB,OAFArmB,MAAKsmB,gBAAgBtB,GAEd1W,GAGRoW,EAAYrkB,UAAUuL,aAAe,WACpC5L,KAAKqD,OAAQ,EAEbrD,KAAKmlB,KAAKxkB,QAAQ4lB,GAClBvmB,KAAKilB,SAAStkB,QAAQ4lB,GACtBvmB,KAAKwmB,oBAGN9B,EAAYrkB,UAAUT,QAAU,SAAiB0B,GAChD,GAAY6G,SAAR7G,GAA6B,KAARA,EAAY,MAAOtB,KAE5C,KAAKA,KAAKklB,WAAWuB,eAAenlB,GAAM,CACzC,GAAIolB,GAAQ,GAAIC,IAAiB3mB,KAAMsB,EACvCtB,MAAKilB,SAASrjB,KAAK8kB,GACnB1mB,KAAKklB,WAAW5jB,GAAOolB,EAGxB,MAAO1mB,MAAKklB,WAAW5jB,IAGxBojB,EAAYrkB,UAAUumB,KAAO,WAC5B5mB,KAAK4L,gBAGN8Y,EAAYrkB,UAAU2R,IAAM,SAAaxI,GACxC,IAAKxJ,KAAK4kB,UAAUE,OACnB,KAAM,IAAIjc,OAAM,wCAA2C7I,KAAKsB,IAAM,IAGvEtB,MAAK4kB,UAAUE,OAAOtb,IAGvBkb,EAAYrkB,UAAUimB,gBAAkB,SAAyBtB,GAGhE,IADA,GAAI9c,GAAIlI,KAAKglB,aAAa/c,OACnBC,KAAK,CACX,GAAI1I,GAAQQ,KAAKglB,aAAa9c,IACvB8c,EAAatW,QAAQlP,IAAQA,EAAMuN,WAAW/M,MAKtD,IADAkI,EAAI8c,EAAa/c,OACVC,KAAK,CACX,GAAI1I,GAAQwlB,EAAa9c,IAClBlI,KAAKglB,aAAatW,QAAQlP,IAAQA,EAAMiM,SAASzL,MAGzDA,KAAKglB,aAAeA,GAGdN,GACLmC,IAECC,GAAY,SAAWnC,GAG1B,QAASmC,GAAUrjB,GAClBC,GAAe1D,KAAM8mB,GAErBnC,EAAOhhB,KAAK3D,KAAM,KAAM,MAGxBA,KAAK+mB,WAEL/mB,KAAKqG,QAAS,EACdrG,KAAKqiB,KAAOriB,KACZA,KAAKuG,QAAU9C,EAAQ8C,QAEvBvG,KAAKwJ,MAAQ/F,EAAQse,KACrB/hB,KAAK0U,SAAWjR,EAAQwf,MACxBjjB,KAAKijB,QAELjjB,KAAKgnB,YAELhnB,KAAK+kB,mBAAqBthB,EAAQ8C,QAClCvG,KAAKinB,gBAkGN,MAvHAnjB,IAASgjB,EAAWnC,GAwBpBmC,EAAUzmB,UAAU6mB,aAAe,WAIlC,MAHAlnB,MAAKmnB,eACLnnB,KAAKonB,QAEEpnB,KAAKmnB,aAGbL,EAAUzmB,UAAUgnB,QAAU,SAAiB/lB,EAAKsjB,GACnD,GAAI0C,GAAc,GAAI5C,IAAY1kB,KAAM4kB,EAAWtjB,EAGnD,OAFAtB,MAAKinB,aAAa3lB,GAAOgmB,EAElBA,GAGRR,EAAUzmB,UAAUkM,IAAM,SAAa8Y,GACtC,GAAI7d,GAAQxH,IAERqlB,IAAeC,GAAQtlB,KAC3B,IAAIsO,GAASiF,MAAavT,KAAKwJ,MAa/B,OAXAtI,QAAOC,KAAKnB,KAAKgnB,UAAUrmB,QAAQ,SAAUW,GAC5CgN,EAAOhN,GAAOkG,EAAMwf,SAAS1lB,GAAKkI,QAGnCtI,OAAOC,KAAKnB,KAAKinB,cAActmB,QAAQ,SAAUW,GACjC,MAAXA,EAAI,KAEPgN,EAAOhN,GAAOkG,EAAMyf,aAAa3lB,GAAKkI,SAIjC8E,GAGRwY,EAAUzmB,UAAUkL,WAAa,WAChC,MAAO,IAGRub,EAAUzmB,UAAUknB,IAAM,SAAajmB,GACtC,MAAOA,KAAOtB,MAAKgnB,UAAY1lB,IAAOtB,MAAKinB,cAAgBtC,EAAOtkB,UAAUknB,IAAI5jB,KAAK3D,KAAMsB,IAG5FwlB,EAAUzmB,UAAUT,QAAU,SAAiB0B,GAC9C,MAAOtB,MAAKgnB,SAASP,eAAenlB,GAAOtB,KAAKgnB,SAAS1lB,GAAOtB,KAAKinB,aAAaR,eAAenlB,GAAOtB,KAAKinB,aAAa3lB,GAAOqjB,EAAOtkB,UAAUT,QAAQ+D,KAAK3D,KAAMsB,IAGtKwlB,EAAUzmB,UAAUN,IAAM,SAAaF,EAAU2nB,GAEhDxnB,KAAKgnB,SAASnnB,GAAY2nB,GAG3BV,EAAUzmB,UAAU2R,IAAM,SAAaxI,GAEtC,GAAIoO,GAAU5X,KAAK4X,OACnB,IAAIA,EAAS,CACZ,GAAI6P,IAAkB7P,EAAQjG,OAASiG,EAAQjG,MAAMnI,MAAW,CAE5Die,KACH7P,EAAQzV,WACRnC,KAAK4X,QAAU,KACf5X,KAAKwJ,MAAQA,EACbxJ,KAAKijB,aAGNjjB,MAAKwJ,MAAQA,EACbxJ,KAAKijB,OAGNjjB,MAAKmlB,KAAKxkB,QAAQ4lB,GAClBvmB,KAAKilB,SAAStkB,QAAQ+mB,GACtB1nB,KAAKwmB,oBAGNM,EAAUzmB,UAAUsnB,SAAW,WAC9B,MAAO3nB,MAAKwJ,OAGbsd,EAAUzmB,UAAU8C,OAAS,aAI7B2jB,EAAUzmB,UAAUunB,mBAAqB,SAA4BC,GACpE,GAAI1a,GAASnN,IAEb2kB,GAAOtkB,UAAUunB,mBAAmBjkB,KAAK3D,KAAM6nB,GAE3CA,GAEH3mB,OAAOC,KAAKnB,KAAKgnB,UAAUrmB,QAAQ,SAAUW,GAC5C,GAAI9B,GAAQ2N,EAAO6Z,SAAS1lB,EAC5B9B,GAAMooB,mBAAmBC,MAKrBf,GACLD,IAcCiB,IAAkB,MAAO,OAAQ,UAAW,QAAS,OAAQ,SAAU,WACvEC,KAEJD,IAAennB,QAAQ,SAAUqnB,GAChC,GAAIvR,GAAS,WACZ,IAAK,GAAIwR,GAAOlS,UAAU9N,OAAQ6F,EAAOqF,MAAM8U,GAAOC,EAAO,EAAUD,EAAPC,EAAaA,IAC5Epa,EAAKoa,GAAQnS,UAAUmS,EAGxB,IAAInc,GAAaoc,EAAcnoB,KAAKiI,OAAQ+f,EAAYla,GAGpDQ,EAAS6E,MAAM9S,UAAU2nB,GAAYha,MAAMhO,KAAM+V,UAGrDzO,IAAQ6E,QAERnM,KAAK6b,SAASuM,SAAU,CAExB,KADA,GAAIlgB,GAAIlI,KAAK6b,SAASwM,SAASpgB,OACxBC,KACNogB,GAAetoB,KAAK6b,SAASwM,SAASngB,GAAIlI,KAAMgoB,EAAYjc,EAM7D,OAHAzE,IAAQ0Z,MAERhhB,KAAK6b,SAASuM,SAAU,EACjB9Z,EAGR6O,IAAe4K,GAAmBC,GACjCxe,MAAOiN,KAIT,IAAI8R,IAAoBpgB,OACpBqgB,GAAsBrgB,YAIjBsgB,WAERF,GAAoB,SAAUG,GAC7B,MAAOA,GAAMD,UAAYV,IAE1BS,GAAsB,SAAUE,GAC/B,MAAOA,GAAMD,UAAYtV,MAAM9S,aAIhCkoB,GAAoB,SAAUG,GAE7B,IADA,GAAIxgB,GAAI4f,GAAe7f,OAChBC,KAAK,CACX,GAAI8f,GAAaF,GAAe5f,EAChCiV,IAAeuL,EAAOV,GACrBxe,MAAOue,GAAkBC,GACzBW,cAAc,MAKjBH,GAAsB,SAAUE,GAE/B,IADA,GAAIxgB,GAAI4f,GAAe7f,OAChBC,WACCwgB,GAAMZ,GAAe5f,MAK/BqgB,GAAkBK,QAAUJ,EAE5B,IAAIK,IAAe,mDAEfC,IACH1V,OAAQ,SAAU2V,GAGjB,MAAOvc,GAAQuc,MAAaA,EAAOlN,WAAakN,EAAOlN,SAASuM,UAEjEY,KAAM,SAAUziB,EAASmiB,EAAOpd,GAC/B,MAAO,IAAI2d,IAAa1iB,EAASmiB,EAAOpd,KAItC2d,GAAe,WAClB,QAASA,GAAa1iB,EAASmiB,GAC9BhlB,GAAe1D,KAAMipB,GAErBjpB,KAAKqiB,KAAO9b,EACZvG,KAAKwJ,MAAQkf,EACb1oB,KAAKkpB,QAAU,KAGVR,EAAM7M,WAEVsB,GAAeuL,EAAO,YACrBlf,OACC6e,YACAc,aACAf,SAAS,GAEVO,cAAc,IAGfJ,GAAkBG,IAIdA,EAAM7M,SAASsN,UAAU5iB,EAAQ6C,SACrCsf,EAAM7M,SAASsN,UAAU5iB,EAAQ6C,OAAS,EAC1Csf,EAAM7M,SAASsN,UAAUvnB,KAAK2E,IAG/BmiB,EAAM7M,SAASsN,UAAU5iB,EAAQ6C,QAAU,EAC3Csf,EAAM7M,SAASwM,SAASzmB,KAAK5B,MAiD9B,MA9CAipB,GAAa5oB,UAAUkM,IAAM,WAC5B,MAAOvM,MAAKwJ,OAGbyf,EAAa5oB,UAAU8B,SAAW,WACjC,GAAIumB,GAAOU,EAASf,EAAUc,EAAW1hB,CAUzC,IARAihB,EAAQ1oB,KAAKwJ,MACb4f,EAAUV,EAAM7M,SAChBwM,EAAWe,EAAQf,SACnBc,EAAYC,EAAQD,UAKhBC,EAAQhB,QACX,OAAO,CAIR,IADA3gB,EAAQ4gB,EAAS3Z,QAAQ1O,MACX,KAAVyH,EACH,KAAM,IAAIoB,OAAMggB,GAOjB,IAJAR,EAAS1Z,OAAOlH,EAAO,GAIlB4gB,EAASpgB,QAMb,GADAkhB,EAAUnpB,KAAKqiB,KAAKjZ,QAAU,GACzB+f,EAAUnpB,KAAKqiB,KAAKjZ,OAAQ,CAGhC,GAFA3B,EAAQ0hB,EAAUza,QAAQ1O,KAAKqiB,MAEjB,KAAV5a,EACH,KAAM,IAAIoB,OAAMggB,GAGjBM,GAAUxa,OAAOlH,EAAO,eAZlBihB,GAAM7M,SACb0M,GAAkBK,QAAQ5oB,KAAKwJ,QAgB1Byf,KAGJI,GAAelhB,MAEnB,KACCjH,OAAOic,kBAAmB,QAAU3T,MAAO,IAE3C6f,IACCjW,OAAQ,SAAU5J,GACjB,MAAOA,IAA0B,gBAAVA,IAExBwf,KAAM,SAAUziB,EAASiD,EAAO8B,GAC/B,MAAO,IAAIge,IAAa/iB,EAASiD,EAAO8B,KAGzC,MAAOma,IACR4D,IAAe,EAyDhB,GAAIC,IAAe,WAClB,QAASA,GAAa/iB,EAASiD,EAAO8B,GACrC,GAAI9D,GAAQxH,IAEZ0D,IAAe1D,KAAMspB,GAErBtpB,KAAKuG,QAAUA,EACfvG,KAAKwJ,MAAQA,EACbxJ,KAAKsL,QAAUA,EAEftL,KAAKupB,uBAGLroB,OAAOC,KAAKqI,GAAO7I,QAAQ,SAAUW,GACpC,GAAIkoB,GAAqBtoB,OAAOuoB,yBAAyBjiB,EAAMgC,MAAOlI,EACtEkG,GAAM+hB,oBAAoBjoB,GAAOkoB,CAEjC,IAAIE,GAAepe,EAAUA,EAAU,IAAMhK,EAAMA,EAE/CqoB,EAAaC,GAAuBJ,EAAoBjjB,EAASmjB,EAErExoB,QAAOic,eAAe3V,EAAMgC,MAAOlI,EAAKqoB,KA+B1C,MA3BAL,GAAajpB,UAAUkM,IAAM,WAC5B,MAAOvM,MAAKwJ,OAGb8f,EAAajpB,UAAUsR,MAAQ,WAC9B,KAAM,IAAI9I,OAAM,6BAGjBygB,EAAajpB,UAAU2R,IAAM,SAAa1Q,EAAKkI,GAC9CxJ,KAAKwJ,MAAMlI,GAAOkI,GAGnB8f,EAAajpB,UAAU8B,SAAW,WACjC,GAAIgL,GAASnN,IAEbkB,QAAOC,KAAKnB,KAAKwJ,OAAO7I,QAAQ,SAAUW,GACzC,GAAIqoB,GAAazoB,OAAOuoB,yBAAyBtc,EAAO3D,MAAOlI,EAC1DqoB,GAAW3X,KAAQ2X,EAAW3X,IAAI6X,UAEvCC,GAAOH,GAE0C,IAA7CA,EAAW3X,IAAI6X,QAAQE,WAAW9hB,QACrC/G,OAAOic,eAAehQ,EAAO3D,MAAOlI,EAAKqoB,EAAW3X,IAAI6X,QAAQL,wBAK5DF,KAGJU,GAAoB,WACvB,QAASA,GAAkBzjB,EAASmiB,EAAOpd,GAC1C5H,GAAe1D,KAAMgqB,GAErBhqB,KAAKwJ,MAAQkf,EAEb1oB,KAAKwU,OAAQ,EAEbxU,KAAKiqB,aAAeZ,GAAaL,KAAKziB,EAASmiB,EAAOpd,GACtDtL,KAAKkqB,aAAepB,GAAaE,KAAKziB,EAASmiB,EAAOpd,GAGtDpK,OAAOic,eAAend,KAAM,WAC3BuM,IAAK,WACJ,MAAOvM,MAAKkqB,aAAahB,SAE1BlX,IAAK,SAAUxS,GACdQ,KAAKkqB,aAAahB,QAAU1pB,KAkB/B,MAbAwqB,GAAkB3pB,UAAUkM,IAAM,WACjC,MAAOvM,MAAKwJ,OAGbwgB,EAAkB3pB,UAAU8B,SAAW,WACtCnC,KAAKkqB,aAAa/nB,WAClBnC,KAAKiqB,aAAa9nB,YAGnB6nB,EAAkB3pB,UAAUsR,MAAQ,SAAenI,GAClD,MAAOxJ,MAAKiqB,aAAatY,MAAMnI,IAGzBwgB,KAGJG,IACH/W,OAAQ,SAAU2V,EAAQzd,EAAS/E,GAClC,MAAO8iB,IAAajW,OAAO2V,EAAQzd,EAAS/E,IAAYuiB,GAAa1V,OAAO2V,IAG7EC,KAAM,SAAUziB,EAASmiB,EAAOpd,GAC/B,MAAO,IAAI0e,IAAkBzjB,EAASmiB,EAAOpd,KAI3C8e,GAAgB,GAAIzf,IAAK,aAEzB0f,IAAiB,WAAY,aAAc,aAAc,SAAU,SAAU,gBAAiB,WAAY,eAE1GC,GAAM,EA2IN5nB,GAAe,GAAIiI,IAAK,YAExBvK,GAAY,SAAWoD,GAG1B,QAASpD,GAAUqD,EAAS8mB,GAC3B7mB,GAAe1D,KAAMI,GAErBoD,EAAMG,KAAK3D,KAAMyD,GACjBzD,KAAK4D,KAAO4mB,EAEZ,IAAIvqB,GAAWwjB,GAAO8G,EAAqBlqB,UAE3CL,MAAKC,SAAWA,EAChBD,KAAKuI,KAAO9E,EAAQrC,SAAS6a,EAC7Bjc,KAAKN,eAAiB+D,EAAQ/D,eAC9BM,KAAKiC,mBAELjC,KAAKgD,eAED/C,EAASsC,IACZ0f,EAAY,QAAUjiB,KAAKuI,KAAO,mEAGnC,IAAIwM,GAAWtR,EAAQrC,SAASugB,KAC1B,YAAa5M,KAAWA,EAAS0V,QAAUhnB,EAAQrC,SAASsb,OAClE1c,KAAK0qB,UAAY3V,EAEjB/U,KAAK2qB,WAKL,KAFA,GAAIzqB,GAAWuD,EAAQ/D,eACnBkrB,EAAYziB,OACTjI,GAAU,CAChB,GAAIA,EAASkG,MAAMxC,OAASyB,GAAS,CACpCulB,EAAY1qB,EAASkG,MAAMwkB,SAC3B,OAGD1qB,EAAWA,EAASoG,OAIrBrG,EAASqG,OAAStG,KAAKN,eAAe6G,QACtCtG,EAAS2qB,UAAYA,GAAa,KAClC3qB,EAASoiB,KAAOpiB,EAASqG,OAAO+b,KAChCpiB,EAASwG,UAAYzG,KAErB6qB,GAAU7qB,KAAKC,UAAY8U,SAAUA,IAKrC9U,EAAS6qB,gBAAkB/V,EAE3B/U,KAAKU,iBACDV,KAAKoB,SAASC,GAAGrB,KAAKe,cA8N3B,MAnRA+C,IAAS1D,EAAWoD,GAwDpBpD,EAAUC,UAAU0D,KAAO,WAC1B,GAAIyD,GAAQxH,KAERF,EAAYE,KAAKC,SAASH,UAC1BirB,EAAYjrB,EAAU0J,KAGtBxJ,MAAKoB,SAAS2V,GACjB7V,OAAOC,KAAKnB,KAAKoB,SAAS2V,GAAGpW,QAAQ,SAAUd,GAC9C,GAAIuB,GAAWoG,EAAMpG,SAAS2V,EAAElX,GAC5BL,EAAQ2I,OACRjI,EAAWiI,MAEf,IAAiB,IAAb/G,EAEHtB,EAAUF,QAAQC,GAAUmS,KAAI,OAC1B,IAAwB,gBAAb5Q,GAAuB,CACxC,GAAIiI,GAASC,GAAUlI,EACvBtB,GAAUF,QAAQC,GAAUmS,IAAI3I,EAASA,EAAOG,MAAQpI,OAC9CoL,GAAQpL,KACM,IAApBA,EAAS6G,QAAgB7G,EAAS,GAAGogB,IAAM3c,IAC9CrF,EAAQwrB,GAASxjB,EAAM9H,eAAgB0B,EAAS,IAE3C5B,IACJyrB,EAAgB,OAASprB,EAAW,OAAUuB,EAAS,GAAG4V,EAAI,0HAA6HzQ,QAASiB,EAAMvH,WAC1MuH,EAAM9H,eAAe6G,QAAQgG,IAAI1M,GACjCL,EAAQgI,EAAM9H,eAAeC,cAAcC,QAAQC,IAGpDC,EAAUC,IAAIF,EAAUL,GAEJ2I,SAAhB3I,EAAM+M,OAAuB1M,IAAYkrB,IAC5CvrB,EAAMwS,IAAI+Y,EAAUlrB,MAGrBK,EAAW,GAAIiG,KACdC,MAAOoB,EACPpG,SAAUA,IACR2C,OAEHvE,EAAQM,EAAUF,QAAQC,GAC1BL,EAAMwS,IAAI9R,EAASuE,WAGnBvE,EAASmH,OAAS,WACjBlB,GAAS9F,UAAUgH,OAAO1D,KAAKzD,GAC/BV,EAAMwS,IAAI9R,EAASuE,YAGpB+C,EAAMvF,gBAAgBL,KAAK1B,OAM/BgrB,GAAWlrB,KAAKC,UACf8U,SAAU/U,KAAK0qB,YAEf/jB,UAAW3G,KAAKC,SAASkrB,YAAgBnrB,KAAKN,eAAeiH,UAC7DC,QAAS5G,KAAKC,SAASkrB,YAAgBnrB,KAAKN,eAAekH,QAC3DC,OAAQ7G,KAAKN,eAAemH,SAG7B7G,KAAKU,cAAcC,QAAQwG,IAG5B/G,EAAUC,UAAUgH,OAAS,WACvBrH,KAAKqD,QACTrD,KAAKqD,OAAQ,EACbrD,KAAKN,eAAe2H,WAItBjH,EAAUC,UAAUI,cAAgB,WACnC,GAAI0M,GAASnN,IAEbkB,QAAOC,KAAKnB,KAAK2qB,UAAUhqB,QAAQ,SAAU4H,GAC5C,GAAI4E,EAAOwd,SAASpiB,GAAMN,OAAS,EAElC,KADAX,IAAQ0Z,MACF,GAAInY,OAAM,kDAAoDN,EAAO,IAAMA,EAAO,IAAM,+BAKjGnI,EAAUC,UAAU2D,OAAS,WAC5B,MAAOhE,MAAKC,SAASC,SAAS8D,UAG/B5D,EAAUC,UAAUyH,KAAO,SAAcC,GACxC,MAAO/H,MAAKC,SAASC,SAAS4H,KAAKC,IAGpC3H,EAAUC,UAAUgI,QAAU,SAAiBN,EAAU9E,GACxDjD,KAAKC,SAASC,SAASmI,QAAQN,EAAU9E,IAG1C7C,EAAUC,UAAUiI,cAAgB,SAAuBC,GAC1D,MAAKA,IAAQvI,KAAKuI,OAASA,EAEvBvI,KAAKC,SAASC,SACVF,KAAKC,SAASC,SAASoI,cAAcC,GAD7C,OAFwCvI,KAAKC,UAO9CG,EAAUC,UAAUmI,kBAAoB,SAA2BD,EAAMtF,GACpEA,EAAMgM,KAAKjP,QACdiD,EAAMsL,IAAIvO,KAAKC,UAEXgD,EAAMmL,MACTpO,KAAKgD,YAAYpB,KAAKqB,IAIxBjD,KAAKC,SAASC,SAASsI,kBAAkBD,EAAMtF,IAGhD7C,EAAUC,UAAU8D,UAAY,WAC/B,MAAOnE,MAAKC,SAASC,SAASiE,aAG/B/D,EAAUC,UAAUF,OAAS,WAC5B,GAAIV,GAASO,IAEbA,MAAKiC,gBAAgBtB,QAAQ8I,GAE7BzJ,KAAKgD,YAAYrC,QAAQyqB,GAGzB,IAAItrB,GAAYE,KAAKC,SAASH,SAC9BA,GAAUknB,YAENhnB,KAAKoB,SAAS2V,GACjB7V,OAAOC,KAAKnB,KAAKoB,SAAS2V,GAAGpW,QAAQ,SAAUd,GAC9C,GAAIuB,GAAW3B,EAAO2B,SAAS2V,EAAElX,GAC7BL,EAAQ2I,MAERqE,GAAQpL,IAAiC,IAApBA,EAAS6G,QAAgB7G,EAAS,GAAGogB,IAAM3c,KACnErF,EAAQwrB,GAASvrB,EAAOC,eAAgB0B,EAAS,IAE5C5B,IAEJyrB,EAAgB,OAASprB,EAAW,OAAUuB,EAAS,GAAG4V,EAAI,0HAA6HzQ,QAAS9G,EAAOQ,WAC3MR,EAAOC,eAAe6G,QAAQgG,IAAI1M;AAClCL,EAAQC,EAAOC,eAAeC,cAAcC,QAAQC,IAGrDC,EAAUC,IAAIF,EAAUL,MAK3BQ,KAAKC,SAASC,SAASC,OAAOL,IAG/BM,EAAUC,UAAUC,OAAS,SAAgBC,GAC5CC,GAAQR,KAAKC,SAAUM,EAAQ,MAE/BP,KAAKS,gBACLT,KAAKU,cAAcC,QAAQC,GAC3BC,GAAkBb,MAElBA,KAAKc,UAAW,GAGjBV,EAAUC,UAAUU,YAAc,WACjC,GAAIC,GAAShB,KAETiB,EAAWjB,KAAKU,aAEpBQ,QAAOC,KAAKnB,KAAKoB,SAASC,GAAGV,QAAQ,SAAUW,GAC9C,GAAIC,GAAaD,EAAIE,MAAM,KACvBJ,EAAWJ,EAAOI,SAASC,EAAEC,EAEjCC,GAAWZ,QAAQ,SAAUc,GAC5B,GAAIC,GAAQ,GAAIC,IAAaX,EAAOf,SAAUwB,EAC9CR,GAASW,KAAK,GAAIC,IAAeb,EAAQU,EAAON,SAKnDhB,EAAUC,UAAUyB,SAAW,WAC9B,MAAO9B,MAAKC,SAAS8B,UAGtB3B,EAAUC,UAAU2B,OAAS,WAC5BhC,KAAKiC,gBAAgBtB,QAAQuB,EAE7B,IAAIjC,GAAWD,KAAKC,QACpBA,GAASH,UAAUqC,WACnBlC,EAASC,SAAS8B,SAClB/B,EAASmC,WAAWzB,QAAQ0B,GAE5BC,GAA+BtC,MAE3BC,EAASC,SAASY,UAAYb,EAASsC,GAAGC,uBAC7CC,EAAgBxC,EAASsC,GAAGC,sBAAuBvC,GAGpDyC,GAAaC,KAAK1C,IAGnBG,EAAUC,UAAUuC,SAAW,SAAkBC,GAChD,GAAIC,GAAS9C,IAEbA,MAAK6C,cAAgBA,EACrB7C,KAAKC,SAAS2C,WACd5C,KAAKU,cAAcC,QAAQoC,GAC3B/C,KAAKgD,YAAYrC,QAAQ,SAAUsC,GAClC,MAAOA,GAAMC,OAAOJ,EAAO7C,aAI7BG,EAAUC,UAAU8C,OAAS,WAC5BnD,KAAKC,SAASC,SAASiD,SACvBnD,KAAKS,gBACLT,KAAKU,cAAcC,QAAQyC,GAC3BpD,KAAKqD,OAAQ,GAGPjD,GACLkD,IAoCCC,GAAO,SAAWC,GAGrB,QAASD,GAAKE,GACbC,GAAe1D,KAAMuD,GAErBC,EAAMG,KAAK3D,KAAMyD,GACjBzD,KAAK4D,KAAOC,GA8Cb,MApDAC,IAASP,EAAMC,GASfD,EAAKlD,UAAU0D,KAAO,aAItBR,EAAKlD,UAAU2D,OAAS,WACvB,MAAOC,IAAWjE,KAAKkE,OAGxBX,EAAKlD,UAAU8D,UAAY,WAC1B,MAAOnE,MAAKkE,MAGbX,EAAKlD,UAAUF,OAAS,aAIxBoD,EAAKlD,UAAUC,OAAS,SAAgBC,GACvCP,KAAKkE,KAAOE,GAAIC,eAAerE,KAAKoB,UACpCb,EAAO+D,YAAYtE,KAAKkE,MACxBlE,KAAKc,UAAW,GAGjByC,EAAKlD,UAAUyB,SAAW,SAAkByC,GAC3C,MAAOA,GAASC,GAAWxE,KAAKoB,UAAYpB,KAAKoB,UAGlDmC,EAAKlD,UAAU2B,OAAS,aAIxBuB,EAAKlD,UAAUuC,SAAW,SAAkBC,GACvC7C,KAAKc,UAAY+B,GAAe7C,KAAKgE,SACzChE,KAAKc,UAAW,GAGjByC,EAAKlD,UAAU8C,OAAS,aAIxBI,EAAKlD,UAAUoE,QAAU,WACxB,MAAOzE,MAAKoB,UAGNmC,GACLD,IAECoB,KACJA,IAAaC,IAAWC,GACxBF,GAAaG,IAAgBC,GAC7BJ,GAAaK,IAAWC,GACxBN,GAAaO,IAAWC,GACxBR,GAAaS,IAAUC,GACvBV,GAAaW,IAAWC,EAExB,IAAIC,KACHC,QAASZ,GACTa,KAAMC,GACNC,MAAOC,GACPC,OAAQC,GACRC,OAAQC,GACRC,SAAUC,IA+BPC,GAAW,WACd,QAASA,GAAS1C,GACjBC,GAAe1D,KAAMmG,GAErBnG,KAAKoG,MAAQ3C,EAAQ2C,MAErBpG,KAAKqG,QAAU5C,EAAQ2C,MAAM1G,eAC7BM,KAAKsG,OAAStG,KAAKqG,OAAS,KAAOrG,KAAKoG,MAAM1G,eAC9CM,KAAKuG,QAAU9C,EAAQ8C,UAAYvG,KAAKqG,OAAS5C,EAAQ2C,MAAQpG,KAAKsG,OAAOC,SAE7EvG,KAAKwG,gBAAkBxG,KAAKqG,QAAUrG,KAAKuG,QAAQE,UAAYzG,KAAKuG,QAAQE,UAAU/G,eAAiB,KAEvGM,KAAK0G,QAAU,KACf1G,KAAKc,UAAW,EAChBd,KAAK2G,UAAYlD,EAAQkD,YAAc3G,KAAKsG,OAAStG,KAAKsG,OAAOK,cACjE3G,KAAK4G,QAAUnD,EAAQmD,UAAY5G,KAAKsG,OAAStG,KAAKsG,OAAOM,YAG7D5G,KAAK6G,OAAS,UAAYpD,GAAUA,EAAQoD,OAAS7G,KAAKsG,OAAStG,KAAKsG,OAAOO,OAAS,KAExF7G,KAAK8G,aAEL9G,KAAKqD,OAAQ,EACbrD,KAAK+G,UAAY/G,KAAKgH,YAAa,EAEnChH,KAAKoB,SAAWqC,EAAQrC,aACxBpB,KAAKiH,cA4RN,MAzRAd,GAAS9F,UAAU0D,KAAO,SAAc2C,GAUvC,MATA1G,MAAK0G,QAAUA,EACf1G,KAAKkH,MAAMvG,QAAQwG,GACnBnH,KAAKoH,OAAQ,EAKTpH,KAAKqD,OAAOrD,KAAKmD,SAEdnD,MAGRmG,EAAS9F,UAAUgH,OAAS,WAC3BrH,KAAK+G,UAAY/G,KAAKgH,YAAa,EAE9BhH,KAAKqD,QACTrD,KAAKqD,OAAQ,EAETrD,KAAKqG,OAEJrG,KAAKuG,QAAQE,UAChBzG,KAAKuG,QAAQE,UAAUY,SACbrH,KAAKoH,OACfE,GAAQC,YAAYvH,MAGrBA,KAAKoG,MAAMiB,WAKdlB,EAAS9F,UAAU4G,YAAc,WAChC,GAAIO,GAAQxH,IAEZA,MAAKkH,MAAQlH,KAAKoB,SAASrB,IAAI,SAAUqB,EAAUqG,GAClD,MAAOC,KAAahI,eAAgB8H,EAAOpG,SAAUA,EAAUqG,MAAOA,OAIxEtB,EAAS9F,UAAU2D,OAAS,WAC3B,GAAI2D,GAAUC,IAId,OAHA5H,MAAKkH,MAAMvG,QAAQ,SAAUkH,GAC5B,MAAOF,GAAQrD,YAAYuD,EAAK7D,YAE1B2D,GAGRxB,EAAS9F,UAAUyH,KAAO,SAAcC,GACvC,GAAIC,GAAMhI,KAAKkH,MAAMe,OACjBC,EAAIC,MAER,KAAKD,EAAI,EAAOF,EAAJE,EAASA,GAAK,EAAG,CAC5B,GAAIE,GAAQpI,KAAKkH,MAAMgB,GAAGJ,KAAKC,EAC/B,IAAIK,EAAO,MAAOA,KAIpBjC,EAAS9F,UAAUgI,QAAU,SAAiBN,EAAU9E,GACvD,GAAIjD,KAAKkH,MAAO,CACf,GAAIc,GAAMhI,KAAKkH,MAAMe,OACjBC,EAAIC,MAER,KAAKD,EAAI,EAAOF,EAAJE,EAASA,GAAK,EAAG,CAC5B,GAAIL,GAAO7H,KAAKkH,MAAMgB,EAElBL,GAAKQ,SACRR,EAAKQ,QAAQN,EAAU9E,IAK1B,MAAOA,IAGRkD,EAAS9F,UAAUiI,cAAgB,SAAuBC,GACzD,GAAIP,GAAMhI,KAAKkH,MAAMe,OACjBC,EAAIC,MAER,KAAKD,EAAI,EAAOF,EAAJE,EAASA,GAAK,EAAG,CAC5B,GAAIE,GAAQpI,KAAKkH,MAAMgB,GAAGI,cAAcC,EACxC,IAAIH,EAAO,MAAOA,KAIpBjC,EAAS9F,UAAUmI,kBAAoB,SAA2BD,EAAMtF,GACvE,GAAIjD,KAAKkH,MAAO,CACf,GAAIc,GAAMhI,KAAKkH,MAAMe,OACjBC,EAAIC,MAER,KAAKD,EAAI,EAAOF,EAAJE,EAASA,GAAK,EAAG,CAC5B,GAAIL,GAAO7H,KAAKkH,MAAMgB,EAElBL,GAAKW,mBACRX,EAAKW,kBAAkBD,EAAMtF,IAKhC,MAAOA,IAGRkD,EAAS9F,UAAUV,YAAc,WAEhC,IADA,GAAIO,GAAWF,MACPE,EAASwG,SAASxG,EAAWA,EAASoG,MAC9C,OAAOpG,GAASwG,SAGjBP,EAAS9F,UAAUoI,aAAe,SAAsBZ,GACvD,GAAIa,GAAW1I,KAAKkH,MAAMW,EAAKJ,MAAQ,EAEvC,OAAIiB,GAAiBA,EAASvE,YAI1BnE,KAAKqG,OACJrG,KAAKuG,QAAQE,UACTzG,KAAKuG,QAAQE,UAAU/G,eAAe+I,aAAazI,KAAKuG,QAAQE,WAKjE,KAGDzG,KAAKoG,MAAMqC,aAAazI,OAGhCmG,EAAS9F,UAAUsI,eAAiB,WACnC,GAAIzI,GAAWF,IAEf,GAAG,CACF,GAAIE,EAASkG,MAAMxC,OAASgF,GAC3B,MAAO1I,GAASkG,MAAMlC,IAGvB,IAAIhE,EAASmG,SAAWnG,EAASqG,QAAQE,UAExC,MAAOvG,GAASqG,QAAQhE,EAGzBrC,GAAWA,EAASsG,iBAAmBtG,EAASoG,aACxCpG,EAET,MAAM,IAAI2I,OAAM,+BAGjB1C,EAAS9F,UAAUyI,sBAAwB,WAG1C,IAFA,GAAI5I,GAAWF,KAERE,EAASoG,SAAWpG,EAAS6I,aACnC7I,EAAWA,EAASoG,QAAUpG,EAASsG,eAGxC,OAAOtG,IAGRiG,EAAS9F,UAAU8D,UAAY,WAC9B,MAAOnE,MAAKkH,MAAM,GAAKlH,KAAKkH,MAAM,GAAG/C,YAAcnE,KAAKsG,OAAOmC,aAAazI,KAAKoG,QAMlFD,EAAS9F,UAAU2I,YAAc,WAChC,GAAIhJ,KAAK+G,UAAW,CACnB,GAAIkC,MACAC,EAASC,GAAanJ,KAAKkH,MAAO+B,EAAQjJ,KAAKuG,QAAQ6C,OACvDC,EAASC,GAAU,IAAMJ,EAAS,IAAKD,EAE3CjJ,MAAKuJ,SAAWF,EAASA,EAAOG,OAASxJ,KAAK8B,YAE9C9B,KAAK+G,WAAY,EAGlB,MAAO/G,MAAKuJ,UAGbpD,EAAS9F,UAAUF,OAAS,SAAgBuG,GAC3C1G,KAAK0G,QAAUA,EAEf1G,KAAKkH,MAAMvG,QAAQ8I,IAGpBtD,EAAS9F,UAAUC,OAAS,SAAgBC,GAC3C,GAAIP,KAAKc,SAAU,KAAM,IAAI+H,OAAM,gCACnC7I,MAAKc,UAAW,EAEhBd,KAAKkH,MAAMvG,QAAQ,SAAUkH,GAC5B,MAAOA,GAAKvH,OAAOC,MAIrB4F,EAAS9F,UAAUqJ,cAAgB,SAAuBtI,GACzD,GAAIuI,GAAW3J,KAAKoH,MAChBwC,EAAc5J,KAAKc,QAYvB,IARI6I,IACCC,GAAa5J,KAAK4C,UAAS,GAC/B5C,KAAKgC,UAGNhC,KAAKoB,SAAWA,EAChBpB,KAAKiH,cAED0C,IACH3J,KAAK+D,KAAK/D,KAAK0G,SAEXkD,GAAa,CAChB,GAAIC,GAAa7J,KAAK2I,iBAClBmB,EAAS9J,KAAKsG,OAAStG,KAAKsG,OAAOmC,aAAazI,KAAKoG,OAAS,IAElE,IAAI0D,EAAQ,CACX,GAAInC,GAAUC,IACd5H,MAAKM,OAAOqH,GACZkC,EAAWE,aAAapC,EAASmC,OAEjC9J,MAAKM,OAAOuJ,KAMhB1D,EAAS9F,UAAU2J,QAAU,SAAiB5I,EAAU6I,GACvD,IAAKjK,KAAK0G,QACT,MAAO1G,MAAKsG,OAAO0D,QAAQ5I,EAAU6I,EAGtC,IAAIC,GAAW,GAAIC,IAAkBnK,KAAMoB,EAAU6I,EAGrD,OAFAjK,MAAK8G,UAAUlF,KAAKsI,GAEbA,GAGR/D,EAAS9F,UAAU+J,OAAS,WAC3B,MAAOpK,MAAK8B,YAGbqE,EAAS9F,UAAUyB,SAAW,SAAkByC,GAC/C,MAAOvE,MAAKkH,MAAMnH,IAAIwE,EAAS8F,EAAkBC,GAAWC,KAAK,KAGlEpE,EAAS9F,UAAU2B,OAAS,WAI3B,MAHAhC,MAAKkH,MAAMvG,QAAQuB,GACnBlC,KAAKoH,OAAQ,EAENpH,MAGRmG,EAAS9F,UAAUuC,SAAW,SAAkBC,GAC/C7C,KAAKkH,MAAMvG,QAAQkC,EAAgB2H,GAAqBzH,GACxD/C,KAAKc,UAAW,GAGjBqF,EAAS9F,UAAU8C,OAAS,WACvBnD,KAAKqD,QACRrD,KAAKkH,MAAMvG,QAAQyC,GACnBpD,KAAKqD,OAAQ,IAIf8C,EAAS9F,UAAUoE,QAAU,WAC5B,GAA0B,IAAtBzE,KAAKkH,MAAMe,OACd,MAAOjI,MAAKkH,MAAM,GAAGzC,SAGtB,IAAIzE,KAAKgH,WAAY,CACpB,GAAIiC,MACAC,EAASC,GAAanJ,KAAKkH,MAAO+B,EAAQjJ,KAAKuG,QAAQ6C,OACvDC,EAASC,GAAUJ,EAAQD,EAE/BjJ,MAAKwJ,MAAQH,EAASA,EAAOG,MAAQxJ,KAAK8B,WAE1C9B,KAAKgH,YAAa,EAGnB,MAAOhH,MAAKwJ,OAGNrD,KA6FJsE,IAAkB,WAAY,WAAY,aAAc,aAAc,UAEtEC,GAAe,GAAIC,IAAK,YACxBC,GAAY,GAAID,IAAK,SACrBE,GAAa,GAAIF,IAAK,UACtBG,GAAe,GAAIH,IAAK,YAkExBI,GAAQC,EAAgB,QAExBC,GAAMD,EAAgB,OAsGtBE,IAAgBC,MAAM,EAAOC,MAAM,GAkCnCC,GAAe,WAClB,QAASA,GAAa3E,EAASlH,EAAOyK,EAAUxG,GAC/CC,GAAe1D,KAAMqL,GAErBrL,KAAK0G,QAAUA,EACf1G,KAAKR,MAAQA,EACbQ,KAAKsL,QAAU9L,EAAM+L,aACrBvL,KAAKiK,SAAWA,EAEhBjK,KAAKwL,QAAU,KAEfhM,EAAMiM,SAASzL,MAEXyD,EAAQ0H,QAAS,GACpBnL,KAAK0L,UACL1L,KAAK2L,YACL3L,KAAK4L,gBAEL5L,KAAK0L,OAAS1L,KAAK6L,QAuDrB,MAnDAR,GAAahL,UAAUuL,aAAe,WACjC5L,KAAKwL,SAERxL,KAAKiK,SAASjK,KAAKwL,SACnBxL,KAAKwL,QAAU,OAGfxL,KAAK2L,QAAQ3L,KAAK0L,OAAO3L,IAAI+L,KAC7B9L,KAAK4L,iBAIPP,EAAahL,UAAUsL,QAAU,SAAiBI,GACjD,GAAIvE,GAAQxH,KAERgM,EAAWhM,KAAK6L,QAEhBI,KACAC,KACAC,EAAQhE,OAERiE,IAEJL,GAAWpL,QAAQ,SAAU0L,EAAUC,GACtCF,EAASC,IAAY,EAEjBA,IAAaC,GAAsBnE,SAAVgE,IAC5BA,EAAQG,GAGQ,KAAbD,GACHH,EAAQtK,KAAK4F,EAAMkE,OAAOY,MAIdnE,SAAVgE,IAAqBA,EAAQJ,EAAW9D,OAG5C,KAAK,GADDD,GAAMgE,EAAS/D,OACVC,EAAI,EAAOF,EAAJE,EAASA,GAAK,EACxBkE,EAASlE,IAAI+D,EAASrK,KAAKoK,EAAS9D,GAG1ClI,MAAKwL,SAAYS,SAAUA,EAAUC,QAASA,EAASC,MAAOA,GAC9DnM,KAAK0L,OAASM,GAGfX,EAAahL,UAAUwL,MAAQ,WAC9B,GAAIrC,GAAQxJ,KAAKR,MAAM+M,KACvB,OAAOC,GAAQhD,GAASA,EAAMqC,YAGxBR,KA2EJoB,GAAW,WACd,QAASA,GAAS/F,EAASlH,EAAOyK,EAAUxG,GAC3CC,GAAe1D,KAAMyM,GAErBzM,KAAK0G,QAAUA,EACf1G,KAAKR,MAAQA,EACbQ,KAAKsL,QAAU9L,EAAM+L,aACrBvL,KAAKiK,SAAWA,EAEhBjK,KAAK0M,SAAWvE,OAChBnI,KAAKgM,SAAWxM,EAAM+M,MAEtBvM,KAAK2M,MAAQlJ,EAAQkJ,MACrB3M,KAAKoL,KAAO3H,EAAQ2H,KACpBpL,KAAK4M,OAASnJ,EAAQmJ,OAEtB5M,KAAKqD,OAAQ,EAETI,EAAQ0H,QAAS,EACpBnL,KAAK6M,WAEL7M,KAAK0M,SAAW1M,KAAKgM,SAGtBxM,EAAMiM,SAASzL,MA0BhB,MAvBAyM,GAASpM,UAAUyM,OAAS,WAC3B9M,KAAKR,MAAMuN,WAAW/M,OAGvByM,EAASpM,UAAUwM,SAAW,WAC7B7M,KAAKiK,SAAStG,KAAK3D,KAAK0G,QAAS1G,KAAKgM,SAAUhM,KAAK0M,SAAU1M,KAAKsL,SACpEtL,KAAK0M,SAAW1M,KAAKgM,SACrBhM,KAAKqD,OAAQ,GAGdoJ,EAASpM,UAAUuL,aAAe,WACjC,IAAK5L,KAAKqD,MAAO,CAGhB,GAFArD,KAAKgM,SAAWhM,KAAKR,MAAM+M,MAEvBvM,KAAK4M,QAAU5M,KAAKgM,WAAahM,KAAK0M,SAAU,MAEpDpF,IAAQ0F,YAAYhN,KAAMA,KAAK2M,OAC/B3M,KAAKqD,OAAQ,EAETrD,KAAKoL,MAAMpL,KAAK8M,WAIfL,KAGJQ,GAAkB,WACrB,QAASA,GAAgBvG,EAASwG,EAAW/L,EAAM8I,EAAUxG,GAC5D,GAAI0J,GAASnN,IAEb0D,IAAe1D,KAAMiN,GAErBjN,KAAK0G,QAAUA,EACf1G,KAAKkN,UAAYA,EACjBlN,KAAKmB,KAAOA,EACZnB,KAAKiK,SAAWA,CAEhB,IAAImD,GAAUjM,EAAKoJ,KAAK,OAAO8C,QAAQ,MAAO,QAC1CC,EAAcJ,EAAU3B,YAC5BvL,MAAKoN,QAAU,GAAIG,QAAO,KAAOD,EAAcA,EAAc,IAAM,IAAMF,EAAU,KAEnFpN,KAAKwN,aACLxN,KAAKyN,aAELzN,KAAK2M,MAAQlJ,EAAQkJ,MACrB3M,KAAKoL,KAAO3H,EAAQ2H,KACpBpL,KAAK4M,OAASnJ,EAAQmJ,OAEtB5M,KAAKqD,OAAQ,EAEbrD,KAAKkN,UAAUQ,YAAY1N,KAAKmB,MAAMR,QAAQ,SAAUnB,GACvD2N,EAAOM,UAAUjO,EAAM+L,cAAgB/L,EAAM+M,QAG1C9I,EAAQ0H,QAAS,EACpBnL,KAAK6M,WAEL7M,KAAKwN,UAAYxN,KAAKyN,UAGvBP,EAAUzB,SAASzL,MAoDpB,MAjDAiN,GAAgB5M,UAAUyM,OAAS,WAClC9M,KAAKkN,UAAUH,WAAW/M,OAG3BiN,EAAgB5M,UAAUwM,SAAW,WACpC,GAAIpN,GAASO,IAEbkB,QAAOC,KAAKnB,KAAKyN,WAAW9M,QAAQ,SAAU2K,GAC7C,GAAIU,GAAWvM,EAAOgO,UAAUnC,GAC5BoB,EAAWjN,EAAO+N,UAAUlC,EAEhC,MAAI7L,EAAOmN,QAAUZ,IAAaU,GAC9BiB,EAAQ3B,EAAUU,IAAtB,CAEA,GAAIkB,GAAYnO,EAAO2N,QAAQS,KAAKvC,GAASO,MAAM,GAC/CiC,GAAQ9B,EAAUU,EAAUpB,GAASyC,OAAOH,EAEhDnO,GAAOwK,SAAS+D,MAAMvO,EAAOiH,QAASoH,MAGvC9N,KAAKwN,UAAYxN,KAAKyN,UACtBzN,KAAKqD,OAAQ,GAGd4J,EAAgB5M,UAAUuL,aAAe,WACxC,GAAI5K,GAAShB,IAERA,MAAKqD,QACTrD,KAAKyN,aASLzN,KAAKkN,UAAUQ,YAAY1N,KAAKmB,MAAMR,QAAQ,SAAUnB,GACvD,GAAI8L,GAAU9L,EAAM+L,YACpBvK,GAAOyM,UAAUnC,GAAW9L,EAAM+M,QAGnCjF,GAAQ0F,YAAYhN,KAAMA,KAAK2M,OAC/B3M,KAAKqD,OAAQ,EAETrD,KAAKoL,MAAMpL,KAAK8M,WAIfG,KAGJgB,MAiCAC,GAAa,GAAIvD,IAAK,UA+KtBwD,GAAQ,WACX,QAASA,GAAM5H,EAASwB,EAAUqG,EAAMC,GACvC3K,GAAe1D,KAAMmO,GAErBnO,KAAKuG,QAAUA,EACfvG,KAAK+H,SAAWA,EAChB/H,KAAKoO,KAAOA,EACZpO,KAAKqO,iBAAmBA,EAExBrO,KAAKsO,UAELtO,KAAKqD,OAAQ,EAoDd,MAjDA8K,GAAM9N,UAAUkO,IAAM,SAAa1G,GAClC7H,KAAKsO,OAAO1M,KAAKiG,GACjB7H,KAAKwO,aAGNL,EAAM9N,UAAUyM,OAAS,WACxB,GAAI9J,GAAchD,KAAKyO,MAAMzO,KAAKqO,iBAAmB,uBAAyB,eAC1EtG,EAAW/H,KAAK+H,SAEhBN,EAAQzE,EAAY0L,QAAQ3G,EAElB,MAAVN,IACHzE,EAAY2L,OAAOlH,EAAO,GAC1BzE,EAAY+E,GAAY,OAI1BoG,EAAM9N,UAAU8K,KAAO,WACtBnL,KAAKqD,OAAQ,GAGd8K,EAAM9N,UAAUmO,UAAY,WAC3B,GAAIhH,GAAQxH,IAEPA,MAAKqD,QACTrD,KAAKqD,OAAQ,EAIbiE,GAAQsH,aAAa,WACpB,MAAOpH,GAAMrE,aAKhBgL,EAAM9N,UAAU6C,OAAS,SAAgB2L,GACxC,GAAIpH,GAAQzH,KAAKsO,OAAOI,QAAQ1O,KAAKqO,iBAAmBQ,EAAgB5O,SAAW4O,EACrE,MAAVpH,GAAczH,KAAKsO,OAAOK,OAAOlH,EAAO,IAG7C0G,EAAM9N,UAAU8C,OAAS,WACxBnD,KAAKsO,OAAOQ,KAAK9O,KAAKqO,iBAAmBU,GAAqBC,IAC9DhP,KAAKqD,OAAQ,GAGd8K,EAAM9N,UAAU4O,KAAO,SAAcpH,GACpC,MAAO7H,MAAKqO,kBAAoBrO,KAAK+H,UAAYF,EAAKU,OAASvI,KAAK+H,SAAWF,EAAOqH,GAAQrH,EAAM7H,KAAK+H,UAAY,MAG/GoG,KAmEJgB,GAAa,GAAIxE,IAAK,UAwCtByE,IACHC,OAAQ,SAAUC,GACjB,MAAOA,IAERC,OAAQ,SAAUD,GACjB,MAAOE,MAAKC,IAAIH,EAAK,IAEtBI,QAAS,SAAUJ,GAClB,MAAOE,MAAKC,IAAIH,EAAM,EAAG,GAAK,GAE/BK,UAAW,SAAUL,GACpB,OAAKA,GAAO,IAAO,EACX,GAAME,KAAKC,IAAIH,EAAK,GAErB,IAAOE,KAAKC,IAAIH,EAAM,EAAG,GAAK,KAInCM,IAAgBC,KAAMC,GACtBT,GAASD,GAAOC,OAyDhBU,IACHxB,IAAKyB,GACLC,QAASC,GACTlM,OAAQmM,GACRrI,KAAMsI,GACN/H,QAASgI,GACT7H,kBAAmB8H,GACnBhI,cAAeiI,GACfC,cAAeC,GACfC,WAAYC,GACZhO,KAAMiO,GACNrE,IAAKsE,GACLC,OAAQC,GACRC,MAAOC,GACPC,QAASA,GACTC,YAAaA,GACbC,YAAaA,GAGbC,IAAKC,GACLC,GAAIC,GACJpG,KAAMqG,GACNxG,IAAKA,GACLrJ,KAAMmJ,GACNzK,OAAQoR,GACRC,MAAOC,GACPC,aAAcA,GACdnI,cAAeoI,GACfC,QAASA,GACTC,IAAKC,GACLC,MAAOA,GACPpD,KAAMA,GACNH,OAAQA,GACRwD,SAAUC,EACVjQ,SAAUkQ,EACVC,OAAQC,EACRxQ,OAAQyQ,EACRpI,OAAQoI,EACR5P,SAAU6P,EACVC,QAASA,GACTvP,OAAQwP,EACRC,YAAaC,GA4LVC,GAAW,UAEf,UAAWC,MAAKC,MAAQF,UAAmBG,QAAO5S,UAAU6S,OAASJ,UAAmB5R,QAAOC,OAAS2R,UAAmBK,OAAM9S,UAAUqO,UAAYoE,UAAmBK,OAAM9S,UAAUM,UAAYmS,UAAmBK,OAAM9S,UAAUN,MAAQ+S,UAAmBK,OAAM9S,UAAU+S,SAAWN,IAAYO,UAAcA,IAAIC,mBAAqBR,GACjV,KAAM,IAAIjK,OAAM,uNAgDjB,OAvCA0K,IAASC,GAAQnT,UAAW0P,GAAQ0D,IACpCD,GAAQnT,UAAUqT,YAAcF,GAGhCA,GAAQG,SAAWH,GAAQnT,UAG3BuT,GAAiBJ,IAGhBK,OAASC,UAAU,EAAMtK,OAAO,GAChCuK,gBAAkBD,UAAU,EAAMtK,OAAO,GAGzCwK,QAAUxK,MAAOyK,IACjBC,aAAe1K,MAAO0K,IACtBC,OAAS3K,MAAO2K,IAGhBC,SAAW5K,MAAO6K,IAGlBC,KAAO9K,MAAO+K,IACdC,OAAShL,MAAOgL,IAGhBC,SAAWjL,MAAO,cAGlBkL,UAAYZ,UAAU,EAAMtK,UAC5BmL,YAAcb,UAAU,EAAMtK,UAC9BoL,YAAcd,UAAU,EAAMtK,UAC9B4F,QAAU0E,UAAU,EAAMtK,MAAO4F,IACjCyF,QAAUf,UAAU,EAAMtK,UAC1BsL,eAAiBhB,UAAU,EAAMtK,MAAOsL,IACxCC,UAAYjB,UAAU,EAAMtK,UAC5BwL,aAAelB,UAAU,EAAMtK,YAGzBgK"}