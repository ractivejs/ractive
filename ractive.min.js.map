{"version":3,"file":"ractive.min.js","sources":["ractive.js"],"sourcesContent":["/*\n\tRactive.js v0.8.0-edge\n\tFri Oct 09 2015 19:28:58 GMT+0000 (UTC) - commit 1fea89788b14c26ed5031621fa0705712afd9fbd\n\n\thttp://ractivejs.org\n\thttp://twitter.com/RactiveJS\n\n\tReleased under the MIT License.\n*/\n\n\n(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n  typeof define === 'function' && define.amd ? define(factory) :\n  global.Ractive = factory();\n}(this, function () { 'use strict';\n\nvar inherits = function (subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass);\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      enumerable: false,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n};\n\nvar classCallCheck = function (instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n};\n\n  /*global console, navigator */\n\n  var win = typeof window !== 'undefined' ? window : null;\n  var doc = win ? document : null;\n\n  var isClient = !!doc;\n  var isJsdom = typeof navigator !== 'undefined' && /jsDom/.test(navigator.appName);\n  var hasConsole = typeof console !== 'undefined' && typeof console.warn === 'function' && typeof console.warn.apply === 'function';\n\n  var magicSupported = undefined;\n  try {\n  \tObject.defineProperty({}, 'test', { value: 0 });\n  \tmagicSupported = true;\n  } catch (e) {\n  \tmagicSupported = false;\n  }\n\n  var svg = doc ? doc.implementation.hasFeature('http://www.w3.org/TR/SVG11/feature#BasicStructure', '1.1') : false;\n\n  var vendors = ['o', 'ms', 'moz', 'webkit'];\n\n  var defaults = {\n  \t// render placement:\n  \tel: void 0,\n  \tappend: false,\n\n  \t// template:\n  \ttemplate: null,\n\n  \t// parse:     // TODO static delimiters?\n  \tpreserveWhitespace: false,\n  \tsanitize: false,\n  \tstripComments: true,\n  \tdelimiters: ['{{', '}}'],\n  \ttripleDelimiters: ['{{{', '}}}'],\n  \tinterpolate: false,\n\n  \t// data & binding:\n  \tdata: {},\n  \tcomputed: {},\n  \tmagic: false,\n  \tmodifyArrays: true,\n  \tadapt: [],\n  \tisolated: false,\n  \ttwoway: true,\n  \tlazy: false,\n\n  \t// transitions:\n  \tnoIntro: false,\n  \ttransitionsEnabled: true,\n  \tcomplete: void 0,\n\n  \t// css:\n  \tcss: null,\n  \tnoCssTransform: false\n  };\n\n  var refPattern = /\\[\\s*(\\*|[0-9]|[1-9][0-9]+)\\s*\\]/g;\n\n  function normalise(ref) {\n  \treturn ref ? ref.replace(refPattern, '.$1') : '';\n  }\n\n  function splitKeypath(keypath) {\n  \tvar parts = normalise(keypath).replace('\\\\.', '$').split('.');\n  \tfor (var i = parts.length - 1; i >= 0; i--) {\n  \t\tparts[i] = parts[i].replace('$', '\\\\.');\n  \t}\n  \treturn parts;\n  }\n\n  function noop () {}\n\n  var alreadyWarned = {};\n  var log;\n  var printWarning;\n  var welcome;\n  if (hasConsole) {\n  \t(function () {\n  \t\tvar welcomeIntro = ['%cRactive.js %c0.8.0-edge %cin debug mode, %cmore...', 'color: rgb(114, 157, 52); font-weight: normal;', 'color: rgb(85, 85, 85); font-weight: normal;', 'color: rgb(85, 85, 85); font-weight: normal;', 'color: rgb(82, 140, 224); font-weight: normal; text-decoration: underline;'];\n  \t\tvar welcomeMessage = 'You\\'re running Ractive 0.8.0-edge in debug mode - messages will be printed to the console to help you fix problems and optimise your application.\\n\\nTo disable debug mode, add this line at the start of your app:\\n  Ractive.DEBUG = false;\\n\\nTo disable debug mode when your app is minified, add this snippet:\\n  Ractive.DEBUG = /unminified/.test(function(){/*unminified*/});\\n\\nGet help and support:\\n  http://docs.ractivejs.org\\n  http://stackoverflow.com/questions/tagged/ractivejs\\n  http://groups.google.com/forum/#!forum/ractive-js\\n  http://twitter.com/ractivejs\\n\\nFound a bug? Raise an issue:\\n  https://github.com/ractivejs/ractive/issues\\n\\n';\n\n  \t\twelcome = function () {\n  \t\t\tvar hasGroup = !!console.groupCollapsed;\n  \t\t\tconsole[hasGroup ? 'groupCollapsed' : 'log'].apply(console, welcomeIntro);\n  \t\t\tconsole.log(welcomeMessage);\n  \t\t\tif (hasGroup) {\n  \t\t\t\tconsole.groupEnd(welcomeIntro);\n  \t\t\t}\n\n  \t\t\twelcome = noop;\n  \t\t};\n\n  \t\tprintWarning = function (message, args) {\n  \t\t\twelcome();\n\n  \t\t\t// extract information about the instance this message pertains to, if applicable\n  \t\t\tif (typeof args[args.length - 1] === 'object') {\n  \t\t\t\tvar options = args.pop();\n  \t\t\t\tvar ractive = options ? options.ractive : null;\n\n  \t\t\t\tif (ractive) {\n  \t\t\t\t\t// if this is an instance of a component that we know the name of, add\n  \t\t\t\t\t// it to the message\n  \t\t\t\t\tvar _name = undefined;\n  \t\t\t\t\tif (ractive.component && (_name = ractive.component.name)) {\n  \t\t\t\t\t\tmessage = '<' + _name + '> ' + message;\n  \t\t\t\t\t}\n\n  \t\t\t\t\tvar node = undefined;\n  \t\t\t\t\tif (node = options.node || ractive.fragment && ractive.fragment.rendered && ractive.find('*')) {\n  \t\t\t\t\t\targs.push(node);\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\tconsole.warn.apply(console, ['%cRactive.js: %c' + message, 'color: rgb(114, 157, 52);', 'color: rgb(85, 85, 85);'].concat(args));\n  \t\t};\n\n  \t\tlog = function () {\n  \t\t\tconsole.log.apply(console, arguments);\n  \t\t};\n  \t})();\n  } else {\n  \tprintWarning = log = welcome = noop;\n  }\n\n  function format(message, args) {\n  \treturn message.replace(/%s/g, function () {\n  \t\treturn args.shift();\n  \t});\n  }\n\n  function fatal(message) {\n  \tfor (var _len = arguments.length, args = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n  \t\targs[_key - 1] = arguments[_key];\n  \t}\n\n  \tmessage = format(message, args);\n  \tthrow new Error(message);\n  }\n\n  function logIfDebug() {\n  \tif (Ractive.DEBUG) {\n  \t\tlog.apply(null, arguments);\n  \t}\n  }\n\n  function warn(message) {\n  \tfor (var _len2 = arguments.length, args = Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {\n  \t\targs[_key2 - 1] = arguments[_key2];\n  \t}\n\n  \tmessage = format(message, args);\n  \tprintWarning(message, args);\n  }\n\n  function warnOnce(message) {\n  \tfor (var _len3 = arguments.length, args = Array(_len3 > 1 ? _len3 - 1 : 0), _key3 = 1; _key3 < _len3; _key3++) {\n  \t\targs[_key3 - 1] = arguments[_key3];\n  \t}\n\n  \tmessage = format(message, args);\n\n  \tif (alreadyWarned[message]) {\n  \t\treturn;\n  \t}\n\n  \talreadyWarned[message] = true;\n  \tprintWarning(message, args);\n  }\n\n  function warnIfDebug() {\n  \tif (Ractive.DEBUG) {\n  \t\twarn.apply(null, arguments);\n  \t}\n  }\n\n  function warnOnceIfDebug() {\n  \tif (Ractive.DEBUG) {\n  \t\twarnOnce.apply(null, arguments);\n  \t}\n  }\n\n  // TODO: deprecate in future release\n  var deprecations = {\n  \tconstruct: {\n  \t\tdeprecated: 'beforeInit',\n  \t\treplacement: 'onconstruct'\n  \t},\n  \trender: {\n  \t\tdeprecated: 'init',\n  \t\tmessage: 'The \"init\" method has been deprecated ' + 'and will likely be removed in a future release. ' + 'You can either use the \"oninit\" method which will fire ' + 'only once prior to, and regardless of, any eventual ractive ' + 'instance being rendered, or if you need to access the ' + 'rendered DOM, use \"onrender\" instead. ' + 'See http://docs.ractivejs.org/latest/migrating for more information.'\n  \t},\n  \tcomplete: {\n  \t\tdeprecated: 'complete',\n  \t\treplacement: 'oncomplete'\n  \t}\n  };\n\n  var Hook = (function () {\n  \tfunction Hook(event) {\n  \t\tclassCallCheck(this, Hook);\n\n  \t\tthis.event = event;\n  \t\tthis.method = 'on' + event;\n  \t\tthis.deprecate = deprecations[event];\n  \t}\n\n  \tHook.prototype.call = function call(method, ractive, arg) {\n  \t\tif (ractive[method]) {\n  \t\t\targ ? ractive[method](arg) : ractive[method]();\n  \t\t\treturn true;\n  \t\t}\n  \t};\n\n  \tHook.prototype.fire = function fire(ractive, arg) {\n  \t\tthis.call(this.method, ractive, arg);\n\n  \t\t// handle deprecations\n  \t\tif (!ractive[this.method] && this.deprecate && this.call(this.deprecate.deprecated, ractive, arg)) {\n  \t\t\tif (this.deprecate.message) {\n  \t\t\t\twarnIfDebug(this.deprecate.message);\n  \t\t\t} else {\n  \t\t\t\twarnIfDebug('The method \"%s\" has been deprecated in favor of \"%s\" and will likely be removed in a future release. See http://docs.ractivejs.org/latest/migrating for more information.', this.deprecate.deprecated, this.deprecate.replacement);\n  \t\t\t}\n  \t\t}\n\n  \t\t// TODO should probably use internal method, in case ractive.fire was overwritten\n  \t\targ ? ractive.fire(this.event, arg) : ractive.fire(this.event);\n  \t};\n\n  \treturn Hook;\n  })();\n\n  var toString = Object.prototype.toString;\n  // thanks, http://perfectionkills.com/instanceof-considered-harmful-or-how-to-write-a-robust-isarray/\n\n  function isArray(thing) {\n  \treturn toString.call(thing) === '[object Array]';\n  }\n\n  function isEqual(a, b) {\n  \tif (a === null && b === null) {\n  \t\treturn true;\n  \t}\n\n  \tif (typeof a === 'object' || typeof b === 'object') {\n  \t\treturn false;\n  \t}\n\n  \treturn a === b;\n  }\n\n  // http://stackoverflow.com/questions/18082/validate-numbers-in-javascript-isnumeric\n\n  function isNumeric(thing) {\n  \treturn !isNaN(parseFloat(thing)) && isFinite(thing);\n  }\n\n  function isObject(thing) {\n  \treturn thing && toString.call(thing) === '[object Object]';\n  }\n\n  function addToArray(array, value) {\n  \tvar index = array.indexOf(value);\n\n  \tif (index === -1) {\n  \t\tarray.push(value);\n  \t}\n  }\n\n  function arrayContains(array, value) {\n  \tfor (var i = 0, c = array.length; i < c; i++) {\n  \t\tif (array[i] == value) {\n  \t\t\treturn true;\n  \t\t}\n  \t}\n\n  \treturn false;\n  }\n\n  function arrayContentsMatch(a, b) {\n  \tvar i;\n\n  \tif (!isArray(a) || !isArray(b)) {\n  \t\treturn false;\n  \t}\n\n  \tif (a.length !== b.length) {\n  \t\treturn false;\n  \t}\n\n  \ti = a.length;\n  \twhile (i--) {\n  \t\tif (a[i] !== b[i]) {\n  \t\t\treturn false;\n  \t\t}\n  \t}\n\n  \treturn true;\n  }\n\n  function ensureArray(x) {\n  \tif (typeof x === 'string') {\n  \t\treturn [x];\n  \t}\n\n  \tif (x === undefined) {\n  \t\treturn [];\n  \t}\n\n  \treturn x;\n  }\n\n  function lastItem(array) {\n  \treturn array[array.length - 1];\n  }\n\n  function removeFromArray(array, member) {\n  \tif (!array) {\n  \t\treturn;\n  \t}\n\n  \tvar index = array.indexOf(member);\n\n  \tif (index !== -1) {\n  \t\tarray.splice(index, 1);\n  \t}\n  }\n\n  function toArray(arrayLike) {\n  \tvar array = [],\n  \t    i = arrayLike.length;\n  \twhile (i--) {\n  \t\tarray[i] = arrayLike[i];\n  \t}\n\n  \treturn array;\n  }\n\n  var _Promise;\n  var PENDING = {};\n  var FULFILLED = {};\n  var REJECTED = {};\n  if (typeof Promise === 'function') {\n  \t// use native Promise\n  \t_Promise = Promise;\n  } else {\n  \t_Promise = function (callback) {\n  \t\tvar fulfilledHandlers = [],\n  \t\t    rejectedHandlers = [],\n  \t\t    state = PENDING,\n  \t\t    result,\n  \t\t    dispatchHandlers,\n  \t\t    makeResolver,\n  \t\t    fulfil,\n  \t\t    reject,\n  \t\t    promise;\n\n  \t\tmakeResolver = function (newState) {\n  \t\t\treturn function (value) {\n  \t\t\t\tif (state !== PENDING) {\n  \t\t\t\t\treturn;\n  \t\t\t\t}\n\n  \t\t\t\tresult = value;\n  \t\t\t\tstate = newState;\n\n  \t\t\t\tdispatchHandlers = makeDispatcher(state === FULFILLED ? fulfilledHandlers : rejectedHandlers, result);\n\n  \t\t\t\t// dispatch onFulfilled and onRejected handlers asynchronously\n  \t\t\t\twait(dispatchHandlers);\n  \t\t\t};\n  \t\t};\n\n  \t\tfulfil = makeResolver(FULFILLED);\n  \t\treject = makeResolver(REJECTED);\n\n  \t\ttry {\n  \t\t\tcallback(fulfil, reject);\n  \t\t} catch (err) {\n  \t\t\treject(err);\n  \t\t}\n\n  \t\tpromise = {\n  \t\t\t// `then()` returns a Promise - 2.2.7\n  \t\t\tthen: function (onFulfilled, onRejected) {\n  \t\t\t\tvar promise2 = new _Promise(function (fulfil, reject) {\n\n  \t\t\t\t\tvar processResolutionHandler = function (handler, handlers, forward) {\n\n  \t\t\t\t\t\t// 2.2.1.1\n  \t\t\t\t\t\tif (typeof handler === 'function') {\n  \t\t\t\t\t\t\thandlers.push(function (p1result) {\n  \t\t\t\t\t\t\t\tvar x;\n\n  \t\t\t\t\t\t\t\ttry {\n  \t\t\t\t\t\t\t\t\tx = handler(p1result);\n  \t\t\t\t\t\t\t\t\tresolve(promise2, x, fulfil, reject);\n  \t\t\t\t\t\t\t\t} catch (err) {\n  \t\t\t\t\t\t\t\t\treject(err);\n  \t\t\t\t\t\t\t\t}\n  \t\t\t\t\t\t\t});\n  \t\t\t\t\t\t} else {\n  \t\t\t\t\t\t\t// Forward the result of promise1 to promise2, if resolution handlers\n  \t\t\t\t\t\t\t// are not given\n  \t\t\t\t\t\t\thandlers.push(forward);\n  \t\t\t\t\t\t}\n  \t\t\t\t\t};\n\n  \t\t\t\t\t// 2.2\n  \t\t\t\t\tprocessResolutionHandler(onFulfilled, fulfilledHandlers, fulfil);\n  \t\t\t\t\tprocessResolutionHandler(onRejected, rejectedHandlers, reject);\n\n  \t\t\t\t\tif (state !== PENDING) {\n  \t\t\t\t\t\t// If the promise has resolved already, dispatch the appropriate handlers asynchronously\n  \t\t\t\t\t\twait(dispatchHandlers);\n  \t\t\t\t\t}\n  \t\t\t\t});\n\n  \t\t\t\treturn promise2;\n  \t\t\t}\n  \t\t};\n\n  \t\tpromise['catch'] = function (onRejected) {\n  \t\t\treturn this.then(null, onRejected);\n  \t\t};\n\n  \t\treturn promise;\n  \t};\n\n  \t_Promise.all = function (promises) {\n  \t\treturn new _Promise(function (fulfil, reject) {\n  \t\t\tvar result = [],\n  \t\t\t    pending,\n  \t\t\t    i,\n  \t\t\t    processPromise;\n\n  \t\t\tif (!promises.length) {\n  \t\t\t\tfulfil(result);\n  \t\t\t\treturn;\n  \t\t\t}\n\n  \t\t\tprocessPromise = function (promise, i) {\n  \t\t\t\tif (promise && typeof promise.then === 'function') {\n  \t\t\t\t\tpromise.then(function (value) {\n  \t\t\t\t\t\tresult[i] = value;\n  \t\t\t\t\t\t--pending || fulfil(result);\n  \t\t\t\t\t}, reject);\n  \t\t\t\t} else {\n  \t\t\t\t\tresult[i] = promise;\n  \t\t\t\t\t--pending || fulfil(result);\n  \t\t\t\t}\n  \t\t\t};\n\n  \t\t\tpending = i = promises.length;\n  \t\t\twhile (i--) {\n  \t\t\t\tprocessPromise(promises[i], i);\n  \t\t\t}\n  \t\t});\n  \t};\n\n  \t_Promise.resolve = function (value) {\n  \t\treturn new _Promise(function (fulfil) {\n  \t\t\tfulfil(value);\n  \t\t});\n  \t};\n\n  \t_Promise.reject = function (reason) {\n  \t\treturn new _Promise(function (fulfil, reject) {\n  \t\t\treject(reason);\n  \t\t});\n  \t};\n  }\n\n  var Promise$1 = _Promise;\n\n  // TODO use MutationObservers or something to simulate setImmediate\n  function wait(callback) {\n  \tsetTimeout(callback, 0);\n  }\n\n  function makeDispatcher(handlers, result) {\n  \treturn function () {\n  \t\tvar handler;\n\n  \t\twhile (handler = handlers.shift()) {\n  \t\t\thandler(result);\n  \t\t}\n  \t};\n  }\n\n  function resolve(promise, x, fulfil, reject) {\n  \t// Promise Resolution Procedure\n  \tvar then;\n\n  \t// 2.3.1\n  \tif (x === promise) {\n  \t\tthrow new TypeError('A promise\\'s fulfillment handler cannot return the same promise');\n  \t}\n\n  \t// 2.3.2\n  \tif (x instanceof _Promise) {\n  \t\tx.then(fulfil, reject);\n  \t}\n\n  \t// 2.3.3\n  \telse if (x && (typeof x === 'object' || typeof x === 'function')) {\n  \t\t\ttry {\n  \t\t\t\tthen = x.then; // 2.3.3.1\n  \t\t\t} catch (e) {\n  \t\t\t\treject(e); // 2.3.3.2\n  \t\t\t\treturn;\n  \t\t\t}\n\n  \t\t\t// 2.3.3.3\n  \t\t\tif (typeof then === 'function') {\n  \t\t\t\tvar called, resolvePromise, rejectPromise;\n\n  \t\t\t\tresolvePromise = function (y) {\n  \t\t\t\t\tif (called) {\n  \t\t\t\t\t\treturn;\n  \t\t\t\t\t}\n  \t\t\t\t\tcalled = true;\n  \t\t\t\t\tresolve(promise, y, fulfil, reject);\n  \t\t\t\t};\n\n  \t\t\t\trejectPromise = function (r) {\n  \t\t\t\t\tif (called) {\n  \t\t\t\t\t\treturn;\n  \t\t\t\t\t}\n  \t\t\t\t\tcalled = true;\n  \t\t\t\t\treject(r);\n  \t\t\t\t};\n\n  \t\t\t\ttry {\n  \t\t\t\t\tthen.call(x, resolvePromise, rejectPromise);\n  \t\t\t\t} catch (e) {\n  \t\t\t\t\tif (!called) {\n  \t\t\t\t\t\t// 2.3.3.3.4.1\n  \t\t\t\t\t\treject(e); // 2.3.3.3.4.2\n  \t\t\t\t\t\tcalled = true;\n  \t\t\t\t\t\treturn;\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t\t} else {\n  \t\t\t\tfulfil(x);\n  \t\t\t}\n  \t\t} else {\n  \t\t\tfulfil(x);\n  \t\t}\n  }\n\n  function _bind(x) {\n    x.bind();\n  }\n\n  function cancel(x) {\n    x.cancel();\n  }\n\n  function _handleChange(x) {\n    x.handleChange();\n  }\n\n  function _mark(x) {\n    x.mark();\n  }\n\n  function _render(x) {\n    x.render();\n  }\n\n  function _rebind(x) {\n    x.rebind();\n  }\n\n  function teardown(x) {\n    x.teardown();\n  }\n\n  function _unbind(x) {\n    x.unbind();\n  }\n\n  function _unrender(x) {\n    x.unrender();\n  }\n\n  function unrenderAndDestroy$1(x) {\n    x.unrender(true);\n  }\n\n  function _update(x) {\n    x.update();\n  }\n\n  function _toString(x) {\n    return x.toString();\n  }\n\n  function toEscapedString(x) {\n    return x.toString(true);\n  }\n\n  var TransitionManager = (function () {\n  \tfunction TransitionManager(callback, parent) {\n  \t\tclassCallCheck(this, TransitionManager);\n\n  \t\tthis.callback = callback;\n  \t\tthis.parent = parent;\n\n  \t\tthis.intros = [];\n  \t\tthis.outros = [];\n\n  \t\tthis.children = [];\n  \t\tthis.totalChildren = this.outroChildren = 0;\n\n  \t\tthis.detachQueue = [];\n  \t\tthis.decoratorQueue = [];\n  \t\tthis.outrosComplete = false;\n\n  \t\tif (parent) {\n  \t\t\tparent.addChild(this);\n  \t\t}\n  \t}\n\n  \tTransitionManager.prototype.add = function add(transition) {\n  \t\tvar list = transition.isIntro ? this.intros : this.outros;\n  \t\tlist.push(transition);\n  \t};\n\n  \tTransitionManager.prototype.addChild = function addChild(child) {\n  \t\tthis.children.push(child);\n\n  \t\tthis.totalChildren += 1;\n  \t\tthis.outroChildren += 1;\n  \t};\n\n  \t// TODO can we move decorator stuff to element detach() methods?\n\n  \tTransitionManager.prototype.addDecorator = function addDecorator(decorator) {\n  \t\tthis.decoratorQueue.push(decorator);\n  \t};\n\n  \tTransitionManager.prototype.decrementOutros = function decrementOutros() {\n  \t\tthis.outroChildren -= 1;\n  \t\tcheck(this);\n  \t};\n\n  \tTransitionManager.prototype.decrementTotal = function decrementTotal() {\n  \t\tthis.totalChildren -= 1;\n  \t\tcheck(this);\n  \t};\n\n  \tTransitionManager.prototype.detachNodes = function detachNodes() {\n  \t\tthis.decoratorQueue.forEach(teardown);\n  \t\tthis.detachQueue.forEach(detach);\n  \t\tthis.children.forEach(_detachNodes);\n  \t};\n\n  \tTransitionManager.prototype.init = function init() {\n  \t\tthis.ready = true;\n  \t\tcheck(this);\n  \t};\n\n  \tTransitionManager.prototype.remove = function remove(transition) {\n  \t\tvar list = transition.isIntro ? this.intros : this.outros;\n  \t\tremoveFromArray(list, transition);\n  \t\tcheck(this);\n  \t};\n\n  \tTransitionManager.prototype.start = function start() {\n  \t\tthis.intros.concat(this.outros).forEach(function (t) {\n  \t\t\treturn t.start();\n  \t\t});\n  \t};\n\n  \treturn TransitionManager;\n  })();\n\n  function detach(element) {\n  \telement.detach();\n  }\n\n  function _detachNodes(tm) {\n  \t// _ to avoid transpiler quirk\n  \ttm.detachNodes();\n  }\n\n  function check(tm) {\n  \tif (!tm.ready || tm.outros.length || tm.outroChildren) return;\n\n  \t// If all outros are complete, and we haven't already done this,\n  \t// we notify the parent if there is one, otherwise\n  \t// start detaching nodes\n  \tif (!tm.outrosComplete) {\n  \t\tif (tm.parent) {\n  \t\t\ttm.parent.decrementOutros(tm);\n  \t\t} else {\n  \t\t\ttm.detachNodes();\n  \t\t}\n\n  \t\ttm.outrosComplete = true;\n  \t}\n\n  \t// Once everything is done, we can notify parent transition\n  \t// manager and call the callback\n  \tif (!tm.intros.length && !tm.totalChildren) {\n  \t\tif (typeof tm.callback === 'function') {\n  \t\t\ttm.callback();\n  \t\t}\n\n  \t\tif (tm.parent) {\n  \t\t\ttm.parent.decrementTotal();\n  \t\t}\n  \t}\n  }\n\n  var changeHook = new Hook('change');\n\n  var batch = undefined;\n\n  var runloop = {\n  \tstart: function (instance, returnPromise) {\n  \t\tvar promise, fulfilPromise;\n\n  \t\tif (returnPromise) {\n  \t\t\tpromise = new Promise$1(function (f) {\n  \t\t\t\treturn fulfilPromise = f;\n  \t\t\t});\n  \t\t}\n\n  \t\tbatch = {\n  \t\t\tpreviousBatch: batch,\n  \t\t\ttransitionManager: new TransitionManager(fulfilPromise, batch && batch.transitionManager),\n  \t\t\tfragments: [],\n  \t\t\ttasks: [],\n  \t\t\timmediateObservers: [],\n  \t\t\tdeferredObservers: [],\n  \t\t\tinstance: instance\n  \t\t};\n\n  \t\treturn promise;\n  \t},\n\n  \tend: function () {\n  \t\tflushChanges();\n\n  \t\tbatch.transitionManager.init();\n  \t\tbatch = batch.previousBatch;\n  \t},\n\n  \taddFragment: function (fragment) {\n  \t\taddToArray(batch.fragments, fragment);\n  \t},\n\n  \taddObserver: function (observer, defer) {\n  \t\taddToArray(defer ? batch.deferredObservers : batch.immediateObservers, observer);\n  \t},\n\n  \tregisterTransition: function (transition) {\n  \t\ttransition._manager = batch.transitionManager;\n  \t\tbatch.transitionManager.add(transition);\n  \t},\n\n  \tregisterDecorator: function (decorator) {\n  \t\tbatch.transitionManager.addDecorator(decorator);\n  \t},\n\n  \t// synchronise node detachments with transition ends\n  \tdetachWhenReady: function (thing) {\n  \t\tbatch.transitionManager.detachQueue.push(thing);\n  \t},\n\n  \tscheduleTask: function (task, postRender) {\n  \t\tvar _batch;\n\n  \t\tif (!batch) {\n  \t\t\ttask();\n  \t\t} else {\n  \t\t\t_batch = batch;\n  \t\t\twhile (postRender && _batch.previousBatch) {\n  \t\t\t\t// this can't happen until the DOM has been fully updated\n  \t\t\t\t// otherwise in some situations (with components inside elements)\n  \t\t\t\t// transitions and decorators will initialise prematurely\n  \t\t\t\t_batch = _batch.previousBatch;\n  \t\t\t}\n\n  \t\t\t_batch.tasks.push(task);\n  \t\t}\n  \t}\n  };\n\n  function dispatch(observer) {\n  \tobserver.dispatch();\n  }\n\n  function flushChanges() {\n  \tbatch.immediateObservers.forEach(dispatch);\n\n  \t// Now that changes have been fully propagated, we can update the DOM\n  \t// and complete other tasks\n  \tvar i = batch.fragments.length;\n  \tvar fragment = undefined;\n\n  \twhile (i--) {\n  \t\tfragment = batch.fragments[i];\n\n  \t\t// TODO deprecate this. It's annoying and serves no useful function\n  \t\tvar ractive = fragment.ractive;\n  \t\tchangeHook.fire(ractive, ractive.viewmodel.changes);\n  \t\tractive.viewmodel.changes = {};\n\n  \t\tfragment.update();\n  \t}\n  \tbatch.fragments.length = 0;\n\n  \tbatch.transitionManager.start();\n\n  \tbatch.deferredObservers.forEach(dispatch);\n\n  \tvar tasks = batch.tasks;\n  \tbatch.tasks = [];\n\n  \tfor (i = 0; i < tasks.length; i += 1) {\n  \t\ttasks[i]();\n  \t}\n\n  \t// If updating the view caused some model blowback - e.g. a triple\n  \t// containing <option> elements caused the binding on the <select>\n  \t// to update - then we start over\n  \tif (batch.fragments.length) return flushChanges();\n  }\n\n  function Ractive$updateModel(keypath, cascade) {\n  \tvar promise = runloop.start(this, true);\n\n  \tif (!keypath) {\n  \t\tthis.viewmodel.updateFromBindings(true);\n  \t} else {\n  \t\tthis.viewmodel.joinAll(splitKeypath(keypath)).updateFromBindings(cascade !== false);\n  \t}\n\n  \trunloop.end();\n\n  \treturn promise;\n  }\n\n  var updateHook = new Hook('update');\n  function Ractive$update(keypath) {\n  \tvar model = keypath ? this.viewmodel.joinAll(splitKeypath(keypath)) : this.viewmodel;\n\n  \tvar promise = runloop.start(this, true);\n  \tmodel.mark();\n  \trunloop.end();\n\n  \tupdateHook.fire(this, model);\n\n  \treturn promise;\n  }\n\n  // This function takes an array, the name of a mutator method, and the\n  // arguments to call that mutator method with, and returns an array that\n  // maps the old indices to their new indices.\n\n  // So if you had something like this...\n  //\n  //     array = [ 'a', 'b', 'c', 'd' ];\n  //     array.push( 'e' );\n  //\n  // ...you'd get `[ 0, 1, 2, 3 ]` - in other words, none of the old indices\n  // have changed. If you then did this...\n  //\n  //     array.unshift( 'z' );\n  //\n  // ...the indices would be `[ 1, 2, 3, 4, 5 ]` - every item has been moved\n  // one higher to make room for the 'z'. If you removed an item, the new index\n  // would be -1...\n  //\n  //     array.splice( 2, 2 );\n  //\n  // ...this would result in [ 0, 1, -1, -1, 2, 3 ].\n  //\n  // This information is used to enable fast, non-destructive shuffling of list\n  // sections when you do e.g. `ractive.splice( 'items', 2, 2 );\n\n  function getNewIndices(length, methodName, args) {\n  \tvar spliceArguments,\n  \t    newIndices = [],\n  \t    removeStart,\n  \t    removeEnd,\n  \t    balance,\n  \t    i;\n\n  \tspliceArguments = getSpliceEquivalent(length, methodName, args);\n\n  \tif (!spliceArguments) {\n  \t\treturn null; // TODO support reverse and sort?\n  \t}\n\n  \tbalance = spliceArguments.length - 2 - spliceArguments[1];\n\n  \tremoveStart = Math.min(length, spliceArguments[0]);\n  \tremoveEnd = removeStart + spliceArguments[1];\n\n  \tfor (i = 0; i < removeStart; i += 1) {\n  \t\tnewIndices.push(i);\n  \t}\n\n  \tfor (; i < removeEnd; i += 1) {\n  \t\tnewIndices.push(-1);\n  \t}\n\n  \tfor (; i < length; i += 1) {\n  \t\tnewIndices.push(i + balance);\n  \t}\n\n  \t// there is a net shift for the rest of the array starting with index + balance\n  \tif (balance !== 0) {\n  \t\tnewIndices.touchedFrom = spliceArguments[0];\n  \t} else {\n  \t\tnewIndices.touchedFrom = length;\n  \t}\n\n  \treturn newIndices;\n  }\n\n  // The pop, push, shift an unshift methods can all be represented\n  // as an equivalent splice\n  function getSpliceEquivalent(length, methodName, args) {\n  \tswitch (methodName) {\n  \t\tcase 'splice':\n  \t\t\tif (args[0] !== undefined && args[0] < 0) {\n  \t\t\t\targs[0] = length + Math.max(args[0], -length);\n  \t\t\t}\n\n  \t\t\twhile (args.length < 2) {\n  \t\t\t\targs.push(length - args[0]);\n  \t\t\t}\n\n  \t\t\t// ensure we only remove elements that exist\n  \t\t\targs[1] = Math.min(args[1], length - args[0]);\n\n  \t\t\treturn args;\n\n  \t\tcase 'sort':\n  \t\tcase 'reverse':\n  \t\t\treturn null;\n\n  \t\tcase 'pop':\n  \t\t\tif (length) {\n  \t\t\t\treturn [length - 1, 1];\n  \t\t\t}\n  \t\t\treturn [0, 0];\n\n  \t\tcase 'push':\n  \t\t\treturn [length, 0].concat(args);\n\n  \t\tcase 'shift':\n  \t\t\treturn [0, length ? 1 : 0];\n\n  \t\tcase 'unshift':\n  \t\t\treturn [0, 0].concat(args);\n  \t}\n  }\n\n  var arrayProto = Array.prototype;\n\n  function makeArrayMethod (methodName) {\n  \treturn function (keypath) {\n  \t\tvar model = this.viewmodel.joinAll(splitKeypath(keypath));\n  \t\tvar array = model.get();\n\n  \t\tif (!isArray(array)) {\n  \t\t\tthrow new Error('shuffle array method ' + methodName + ' called on non-array at ' + keypath.getKeypath());\n  \t\t}\n\n  \t\tfor (var _len = arguments.length, args = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n  \t\t\targs[_key - 1] = arguments[_key];\n  \t\t}\n\n  \t\tvar newIndices = getNewIndices(array.length, methodName, args);\n  \t\tvar result = arrayProto[methodName].apply(array, args);\n\n  \t\tvar promise = runloop.start(this, true).then(function () {\n  \t\t\treturn result;\n  \t\t});\n\n  \t\tif (newIndices) {\n  \t\t\tmodel.shuffle(newIndices);\n  \t\t} else {\n  \t\t\tmodel.set(result);\n  \t\t}\n\n  \t\trunloop.end();\n\n  \t\treturn promise;\n  \t};\n  }\n\n  var unshift = makeArrayMethod('unshift');\n\n  var unrenderHook$1 = new Hook('unrender');\n  function Ractive$unrender() {\n  \tif (!this.fragment.rendered) {\n  \t\twarnIfDebug('ractive.unrender() was called on a Ractive instance that was not rendered');\n  \t\treturn Promise$1.resolve();\n  \t}\n\n  \tvar promise = runloop.start(this, true);\n\n  \t// If this is a component, and the component isn't marked for destruction,\n  \t// don't detach nodes from the DOM unnecessarily\n  \tvar shouldDestroy = !this.component || this.component.shouldDestroy || this.shouldDestroy;\n  \tthis.fragment.unrender(shouldDestroy);\n\n  \tremoveFromArray(this.el.__ractive_instances__, this);\n\n  \tunrenderHook$1.fire(this);\n\n  \trunloop.end();\n  \treturn promise;\n  }\n\n  function Ractive$toHTML() {\n  \treturn this.fragment.toString(true);\n  }\n\n  // Error messages that are used (or could be) in multiple places\n  var badArguments = 'Bad arguments';\n  var noRegistryFunctionReturn = 'A function was specified for \"%s\" %s, but no %s was returned';\n  var missingPlugin = function (name, type) {\n    return 'Missing \"' + name + '\" ' + type + ' plugin. You may need to download a plugin via http://docs.ractivejs.org/latest/plugins#' + type + 's';\n  };\n\n  function Ractive$toggle(keypath) {\n  \tif (typeof keypath !== 'string') {\n  \t\tthrow new TypeError(badArguments);\n  \t}\n\n  \tvar changes = undefined;\n\n  \tif (/\\*/.test(keypath)) {\n  \t\tchanges = {};\n\n  \t\tthis.viewmodel.findMatches(splitKeypath(keypath)).forEach(function (model) {\n  \t\t\tchanges[model.getKeypath()] = !model.get();\n  \t\t});\n\n  \t\treturn this.set(changes);\n  \t}\n\n  \treturn this.set(keypath, !this.get(keypath));\n  }\n\n  var teardownHook = new Hook('teardown');\n\n  // Teardown. This goes through the root fragment and all its children, removing observers\n  // and generally cleaning up after itself\n\n  function Ractive$teardown() {\n  \tthis.fragment.unbind();\n  \tthis.viewmodel.teardown();\n\n  \tthis._observers.forEach(cancel);\n\n  \tif (this.fragment.rendered && this.el.__ractive_instances__) {\n  \t\tremoveFromArray(this.el.__ractive_instances__, this);\n  \t}\n\n  \tthis.shouldDestroy = true;\n  \tvar promise = this.fragment.rendered ? this.unrender() : Promise$1.resolve();\n\n  \tteardownHook.fire(this);\n\n  \treturn promise;\n  }\n\n  var errorMessage$1 = 'Cannot add to a non-numeric value';\n  function add(ractive, keypath, d) {\n  \tif (typeof keypath !== 'string' || !isNumeric(d)) {\n  \t\tthrow new Error('Bad arguments');\n  \t}\n\n  \tvar changes = undefined;\n\n  \tif (/\\*/.test(keypath)) {\n  \t\tchanges = {};\n\n  \t\tractive.viewmodel.findMatches(splitKeypath(keypath)).forEach(function (model) {\n  \t\t\tvar value = model.get();\n\n  \t\t\tif (!isNumeric(value)) throw new Error(errorMessage$1);\n\n  \t\t\tchanges[model.getKeypath()] = value + d;\n  \t\t});\n\n  \t\treturn ractive.set(changes);\n  \t}\n\n  \tvar value = ractive.get(keypath);\n\n  \tif (!isNumeric(value)) {\n  \t\tthrow new Error(errorMessage$1);\n  \t}\n\n  \treturn ractive.set(keypath, +value + d);\n  }\n\n  function Ractive$subtract(keypath, d) {\n  \treturn add(this, keypath, d === undefined ? -1 : -d);\n  }\n\n  var splice = makeArrayMethod('splice');\n\n  var sort = makeArrayMethod('sort');\n\n  var shift = makeArrayMethod('shift');\n\n  function bind(fn, context) {\n  \tif (!/this/.test(fn.toString())) return fn;\n\n  \tvar bound = fn.bind(context);\n  \tfor (var prop in fn) {\n  \t\tbound[prop] = fn[prop];\n  \t}return bound;\n  }\n\n  function Ractive$set(keypath, value) {\n  \tvar promise = runloop.start(this, true);\n\n  \t// Set multiple keypaths in one go\n  \tif (isObject(keypath)) {\n  \t\tvar map = keypath;\n\n  \t\tfor (keypath in map) {\n  \t\t\tif (map.hasOwnProperty(keypath)) {\n  \t\t\t\tset(this, keypath, map[keypath]);\n  \t\t\t}\n  \t\t}\n  \t}\n  \t// Set a single keypath\n  \telse {\n  \t\t\tset(this, keypath, value);\n  \t\t}\n\n  \trunloop.end();\n\n  \treturn promise;\n  }\n\n  function set(ractive, keypath, value) {\n  \tif (typeof value === 'function') value = bind(value, ractive);\n\n  \tif (/\\*/.test(keypath)) {\n  \t\tractive.viewmodel.findMatches(splitKeypath(keypath)).forEach(function (model) {\n  \t\t\tmodel.set(value);\n  \t\t});\n  \t} else {\n  \t\tvar model = ractive.viewmodel.joinAll(splitKeypath(keypath));\n  \t\tmodel.set(value);\n  \t}\n  }\n\n  var reverse = makeArrayMethod('reverse');\n\n  var TEMPLATE_VERSION = 3;\n\n  var html = 'http://www.w3.org/1999/xhtml';\n  var mathml = 'http://www.w3.org/1998/Math/MathML';\n  var svg$1 = 'http://www.w3.org/2000/svg';\n  var xlink = 'http://www.w3.org/1999/xlink';\n  var xml = 'http://www.w3.org/XML/1998/namespace';\n  var xmlns = 'http://www.w3.org/2000/xmlns/';\n\n\n  var namespaces = {\n  \thtml: html,\n  \tmathml: mathml,\n  \tsvg: svg$1,\n  \txlink: xlink,\n  \txml: xml,\n  \txmlns: xmlns\n  };\n\n  var createElement;\n  var matches;\n  var div;\n  var methodNames;\n  var unprefixed;\n  var prefixed;\n  var i$1;\n  var j$1;\n  var makeFunction;\n  // Test for SVG support\n  if (!svg) {\n  \tcreateElement = function (type, ns, extend) {\n  \t\tif (ns && ns !== html) {\n  \t\t\tthrow 'This browser does not support namespaces other than http://www.w3.org/1999/xhtml. The most likely cause of this error is that you\\'re trying to render SVG in an older browser. See http://docs.ractivejs.org/latest/svg-and-older-browsers for more information';\n  \t\t}\n\n  \t\treturn extend ? doc.createElement(type, extend) : doc.createElement(type);\n  \t};\n  } else {\n  \tcreateElement = function (type, ns, extend) {\n  \t\tif (!ns || ns === html) {\n  \t\t\treturn extend ? doc.createElement(type, extend) : doc.createElement(type);\n  \t\t}\n\n  \t\treturn extend ? doc.createElementNS(ns, type, extend) : doc.createElementNS(ns, type);\n  \t};\n  }\n\n  function createDocumentFragment() {\n  \treturn doc.createDocumentFragment();\n  }\n\n  function getElement(input) {\n  \tvar output;\n\n  \tif (!input || typeof input === 'boolean') {\n  \t\treturn;\n  \t}\n\n  \tif (!win || !doc || !input) {\n  \t\treturn null;\n  \t}\n\n  \t// We already have a DOM node - no work to do. (Duck typing alert!)\n  \tif (input.nodeType) {\n  \t\treturn input;\n  \t}\n\n  \t// Get node from string\n  \tif (typeof input === 'string') {\n  \t\t// try ID first\n  \t\toutput = doc.getElementById(input);\n\n  \t\t// then as selector, if possible\n  \t\tif (!output && doc.querySelector) {\n  \t\t\toutput = doc.querySelector(input);\n  \t\t}\n\n  \t\t// did it work?\n  \t\tif (output && output.nodeType) {\n  \t\t\treturn output;\n  \t\t}\n  \t}\n\n  \t// If we've been given a collection (jQuery, Zepto etc), extract the first item\n  \tif (input[0] && input[0].nodeType) {\n  \t\treturn input[0];\n  \t}\n\n  \treturn null;\n  }\n\n  if (!isClient) {\n  \tmatches = null;\n  } else {\n  \tdiv = createElement('div');\n  \tmethodNames = ['matches', 'matchesSelector'];\n\n  \tmakeFunction = function (methodName) {\n  \t\treturn function (node, selector) {\n  \t\t\treturn node[methodName](selector);\n  \t\t};\n  \t};\n\n  \ti$1 = methodNames.length;\n\n  \twhile (i$1-- && !matches) {\n  \t\tunprefixed = methodNames[i$1];\n\n  \t\tif (div[unprefixed]) {\n  \t\t\tmatches = makeFunction(unprefixed);\n  \t\t} else {\n  \t\t\tj$1 = vendors.length;\n  \t\t\twhile (j$1--) {\n  \t\t\t\tprefixed = vendors[i$1] + unprefixed.substr(0, 1).toUpperCase() + unprefixed.substring(1);\n\n  \t\t\t\tif (div[prefixed]) {\n  \t\t\t\t\tmatches = makeFunction(prefixed);\n  \t\t\t\t\tbreak;\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \t// IE8...\n  \tif (!matches) {\n  \t\tmatches = function (node, selector) {\n  \t\t\tvar nodes, parentNode, i$1;\n\n  \t\t\tparentNode = node.parentNode;\n\n  \t\t\tif (!parentNode) {\n  \t\t\t\t// empty dummy <div>\n  \t\t\t\tdiv.innerHTML = '';\n\n  \t\t\t\tparentNode = div;\n  \t\t\t\tnode = node.cloneNode();\n\n  \t\t\t\tdiv.appendChild(node);\n  \t\t\t}\n\n  \t\t\tnodes = parentNode.querySelectorAll(selector);\n\n  \t\t\ti$1 = nodes.length;\n  \t\t\twhile (i$1--) {\n  \t\t\t\tif (nodes[i$1] === node) {\n  \t\t\t\t\treturn true;\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\treturn false;\n  \t\t};\n  \t}\n  }\n\n  function detachNode(node) {\n  \tif (node && typeof node.parentNode !== 'unknown' && node.parentNode) {\n  \t\tnode.parentNode.removeChild(node);\n  \t}\n\n  \treturn node;\n  }\n\n  function safeToStringValue(value) {\n  \treturn value == null || !value.toString ? '' : '' + value;\n  }\n\n  var legacy = null;\n\n  var create;\n  var defineProperty;\n  var defineProperties;\n  try {\n  \tObject.defineProperty({}, 'test', { value: 0 });\n\n  \tif (doc) {\n  \t\tObject.defineProperty(createElement('div'), 'test', { value: 0 });\n  \t}\n\n  \tdefineProperty = Object.defineProperty;\n  } catch (err) {\n  \t// Object.defineProperty doesn't exist, or we're in IE8 where you can\n  \t// only use it with DOM objects (what were you smoking, MSFT?)\n  \tdefineProperty = function (obj, prop, desc) {\n  \t\tobj[prop] = desc.value;\n  \t};\n  }\n\n  try {\n  \ttry {\n  \t\tObject.defineProperties({}, { test: { value: 0 } });\n  \t} catch (err) {\n  \t\t// TODO how do we account for this? noMagic = true;\n  \t\tthrow err;\n  \t}\n\n  \tif (doc) {\n  \t\tObject.defineProperties(createElement('div'), { test: { value: 0 } });\n  \t}\n\n  \tdefineProperties = Object.defineProperties;\n  } catch (err) {\n  \tdefineProperties = function (obj, props) {\n  \t\tvar prop;\n\n  \t\tfor (prop in props) {\n  \t\t\tif (props.hasOwnProperty(prop)) {\n  \t\t\t\tdefineProperty(obj, prop, props[prop]);\n  \t\t\t}\n  \t\t}\n  \t};\n  }\n\n  try {\n  \tObject.create(null);\n\n  \tcreate = Object.create;\n  } catch (err) {\n  \t// sigh\n  \tcreate = (function () {\n  \t\tvar F = function () {};\n\n  \t\treturn function (proto, props) {\n  \t\t\tvar obj;\n\n  \t\t\tif (proto === null) {\n  \t\t\t\treturn {};\n  \t\t\t}\n\n  \t\t\tF.prototype = proto;\n  \t\t\tobj = new F();\n\n  \t\t\tif (props) {\n  \t\t\t\tObject.defineProperties(obj, props);\n  \t\t\t}\n\n  \t\t\treturn obj;\n  \t\t};\n  \t})();\n  }\n\n  function extend(target) {\n  \tvar prop, source;\n\n  \tfor (var _len = arguments.length, sources = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n  \t\tsources[_key - 1] = arguments[_key];\n  \t}\n\n  \twhile (source = sources.shift()) {\n  \t\tfor (prop in source) {\n  \t\t\tif (hasOwn.call(source, prop)) {\n  \t\t\t\ttarget[prop] = source[prop];\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \treturn target;\n  }\n\n  var hasOwn = Object.prototype.hasOwnProperty;\n\n  var TEXT = 1;\n  var INTERPOLATOR = 2;\n  var TRIPLE = 3;\n  var SECTION = 4;\n  var INVERTED = 5;\n  var CLOSING = 6;\n  var ELEMENT = 7;\n  var PARTIAL = 8;\n  var COMMENT = 9;\n  var DELIMCHANGE = 10;\n  var CLOSING_TAG = 14;\n  var COMPONENT = 15;\n  var YIELDER = 16;\n  var INLINE_PARTIAL = 17;\n  var DOCTYPE = 18;\n\n  var NUMBER_LITERAL = 20;\n  var STRING_LITERAL = 21;\n  var ARRAY_LITERAL = 22;\n  var OBJECT_LITERAL = 23;\n  var BOOLEAN_LITERAL = 24;\n  var REGEXP_LITERAL = 25;\n\n  var GLOBAL = 26;\n  var KEY_VALUE_PAIR = 27;\n\n  var REFERENCE = 30;\n  var REFINEMENT = 31;\n  var MEMBER = 32;\n  var PREFIX_OPERATOR = 33;\n  var BRACKETED = 34;\n  var CONDITIONAL = 35;\n  var INFIX_OPERATOR = 36;\n\n  var INVOCATION = 40;\n\n  var SECTION_IF = 50;\n  var SECTION_UNLESS = 51;\n  var SECTION_EACH = 52;\n  var SECTION_WITH = 53;\n  var SECTION_IF_WITH = 54;\n\n  var ELSE = 60;\n  var ELSEIF = 61;\n\n  function readComment(parser, tag) {\n  \tvar index;\n\n  \tif (!parser.matchString('!')) {\n  \t\treturn null;\n  \t}\n\n  \tindex = parser.remaining().indexOf(tag.close);\n\n  \tif (index !== -1) {\n  \t\tparser.pos += index + tag.close.length;\n  \t\treturn { t: COMMENT };\n  \t}\n  }\n\n  var expectedExpression = 'Expected a JavaScript expression';\n  var expectedParen = 'Expected closing paren';\n\n  // bulletproof number regex from https://gist.github.com/Rich-Harris/7544330\n  var numberPattern$1 = /^(?:[+-]?)0*(?:(?:(?:[1-9]\\d*)?\\.\\d+)|(?:(?:0|[1-9]\\d*)\\.)|(?:0|[1-9]\\d*))(?:[eE][+-]?\\d+)?/;\n  function readNumberLiteral$1(parser) {\n  \tvar result;\n\n  \tif (result = parser.matchPattern(numberPattern$1)) {\n  \t\treturn {\n  \t\t\tt: NUMBER_LITERAL,\n  \t\t\tv: result\n  \t\t};\n  \t}\n\n  \treturn null;\n  }\n\n  function readBooleanLiteral(parser) {\n  \tvar remaining = parser.remaining();\n\n  \tif (remaining.substr(0, 4) === 'true') {\n  \t\tparser.pos += 4;\n  \t\treturn {\n  \t\t\tt: BOOLEAN_LITERAL,\n  \t\t\tv: 'true'\n  \t\t};\n  \t}\n\n  \tif (remaining.substr(0, 5) === 'false') {\n  \t\tparser.pos += 5;\n  \t\treturn {\n  \t\t\tt: BOOLEAN_LITERAL,\n  \t\t\tv: 'false'\n  \t\t};\n  \t}\n\n  \treturn null;\n  }\n\n  var stringMiddlePattern;\n  var escapeSequencePattern;\n  var lineContinuationPattern;\n  // Match one or more characters until: \", ', \\, or EOL/EOF.\n  // EOL/EOF is written as (?!.) (meaning there's no non-newline char next).\n  stringMiddlePattern = /^(?=.)[^\"'\\\\]+?(?:(?!.)|(?=[\"'\\\\]))/;\n\n  // Match one escape sequence, including the backslash.\n  escapeSequencePattern = /^\\\\(?:['\"\\\\bfnrt]|0(?![0-9])|x[0-9a-fA-F]{2}|u[0-9a-fA-F]{4}|(?=.)[^ux0-9])/;\n\n  // Match one ES5 line continuation (backslash + line terminator).\n  lineContinuationPattern = /^\\\\(?:\\r\\n|[\\u000A\\u000D\\u2028\\u2029])/;\n\n  // Helper for defining getDoubleQuotedString and getSingleQuotedString.\n  function makeQuotedStringMatcher (okQuote) {\n  \treturn function (parser) {\n  \t\tvar literal = '\"';\n  \t\tvar done = false;\n  \t\tvar next = undefined;\n\n  \t\twhile (!done) {\n  \t\t\tnext = parser.matchPattern(stringMiddlePattern) || parser.matchPattern(escapeSequencePattern) || parser.matchString(okQuote);\n  \t\t\tif (next) {\n  \t\t\t\tif (next === '\"') {\n  \t\t\t\t\tliteral += '\\\\\"';\n  \t\t\t\t} else if (next === '\\\\\\'') {\n  \t\t\t\t\tliteral += '\\'';\n  \t\t\t\t} else {\n  \t\t\t\t\tliteral += next;\n  \t\t\t\t}\n  \t\t\t} else {\n  \t\t\t\tnext = parser.matchPattern(lineContinuationPattern);\n  \t\t\t\tif (next) {\n  \t\t\t\t\t// convert \\(newline-like) into a \\u escape, which is allowed in JSON\n  \t\t\t\t\tliteral += '\\\\u' + ('000' + next.charCodeAt(1).toString(16)).slice(-4);\n  \t\t\t\t} else {\n  \t\t\t\t\tdone = true;\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\tliteral += '\"';\n\n  \t\t// use JSON.parse to interpret escapes\n  \t\treturn JSON.parse(literal);\n  \t};\n  }\n\n  var getSingleQuotedString = makeQuotedStringMatcher('\"');\n  var getDoubleQuotedString = makeQuotedStringMatcher('\\'');\n\n  function readStringLiteral (parser) {\n  \tvar start, string;\n\n  \tstart = parser.pos;\n\n  \tif (parser.matchString('\"')) {\n  \t\tstring = getDoubleQuotedString(parser);\n\n  \t\tif (!parser.matchString('\"')) {\n  \t\t\tparser.pos = start;\n  \t\t\treturn null;\n  \t\t}\n\n  \t\treturn {\n  \t\t\tt: STRING_LITERAL,\n  \t\t\tv: string\n  \t\t};\n  \t}\n\n  \tif (parser.matchString('\\'')) {\n  \t\tstring = getSingleQuotedString(parser);\n\n  \t\tif (!parser.matchString('\\'')) {\n  \t\t\tparser.pos = start;\n  \t\t\treturn null;\n  \t\t}\n\n  \t\treturn {\n  \t\t\tt: STRING_LITERAL,\n  \t\t\tv: string\n  \t\t};\n  \t}\n\n  \treturn null;\n  }\n\n  var namePattern$1 = /^[a-zA-Z_$][a-zA-Z_$0-9]*/;\n\n  var identifier = /^[a-zA-Z_$][a-zA-Z_$0-9]*$/;\n\n  // http://mathiasbynens.be/notes/javascript-properties\n  // can be any name, string literal, or number literal\n\n  function readKey(parser) {\n  \tvar token;\n\n  \tif (token = readStringLiteral(parser)) {\n  \t\treturn identifier.test(token.v) ? token.v : '\"' + token.v.replace(/\"/g, '\\\\\"') + '\"';\n  \t}\n\n  \tif (token = readNumberLiteral$1(parser)) {\n  \t\treturn token.v;\n  \t}\n\n  \tif (token = parser.matchPattern(namePattern$1)) {\n  \t\treturn token;\n  \t}\n\n  \treturn null;\n  }\n\n  function readKeyValuePair(parser) {\n  \tvar start, key, value;\n\n  \tstart = parser.pos;\n\n  \t// allow whitespace between '{' and key\n  \tparser.allowWhitespace();\n\n  \tvar refKey = parser.nextChar() !== '\\'' && parser.nextChar() !== '\"';\n\n  \tkey = readKey(parser);\n  \tif (key === null) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \t// allow whitespace between key and ':'\n  \tparser.allowWhitespace();\n\n  \t// es2015 shorthand property\n  \tif (refKey && (parser.nextChar() === ',' || parser.nextChar() === '}')) {\n  \t\tif (!namePattern$1.test(key)) {\n  \t\t\tparser.error('Expected a valid reference, but found \\'' + key + '\\' instead.');\n  \t\t}\n\n  \t\treturn {\n  \t\t\tt: KEY_VALUE_PAIR,\n  \t\t\tk: key,\n  \t\t\tv: {\n  \t\t\t\tt: REFERENCE,\n  \t\t\t\tn: key\n  \t\t\t}\n  \t\t};\n  \t}\n\n  \t// next character must be ':'\n  \tif (!parser.matchString(':')) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \t// allow whitespace between ':' and value\n  \tparser.allowWhitespace();\n\n  \t// next expression must be a, well... expression\n  \tvalue = readExpression(parser);\n  \tif (value === null) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \treturn {\n  \t\tt: KEY_VALUE_PAIR,\n  \t\tk: key,\n  \t\tv: value\n  \t};\n  }\n\n  function readKeyValuePairs(parser) {\n  \tvar start, pairs, pair, keyValuePairs;\n\n  \tstart = parser.pos;\n\n  \tpair = readKeyValuePair(parser);\n  \tif (pair === null) {\n  \t\treturn null;\n  \t}\n\n  \tpairs = [pair];\n\n  \tif (parser.matchString(',')) {\n  \t\tkeyValuePairs = readKeyValuePairs(parser);\n\n  \t\tif (!keyValuePairs) {\n  \t\t\tparser.pos = start;\n  \t\t\treturn null;\n  \t\t}\n\n  \t\treturn pairs.concat(keyValuePairs);\n  \t}\n\n  \treturn pairs;\n  }\n\n  function readObjectLiteral (parser) {\n  \tvar start, keyValuePairs;\n\n  \tstart = parser.pos;\n\n  \t// allow whitespace\n  \tparser.allowWhitespace();\n\n  \tif (!parser.matchString('{')) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \tkeyValuePairs = readKeyValuePairs(parser);\n\n  \t// allow whitespace between final value and '}'\n  \tparser.allowWhitespace();\n\n  \tif (!parser.matchString('}')) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \treturn {\n  \t\tt: OBJECT_LITERAL,\n  \t\tm: keyValuePairs\n  \t};\n  }\n\n  function readExpressionList(parser) {\n  \tparser.allowWhitespace();\n\n  \tvar expr = readExpression(parser);\n\n  \tif (expr === null) return null;\n\n  \tvar expressions = [expr];\n\n  \t// allow whitespace between expression and ','\n  \tparser.allowWhitespace();\n\n  \tif (parser.matchString(',')) {\n  \t\tvar next = readExpressionList(parser);\n  \t\tif (next === null) parser.error(expectedExpression);\n\n  \t\texpressions.push.apply(expressions, next);\n  \t}\n\n  \treturn expressions;\n  }\n\n  function readArrayLiteral (parser) {\n  \tvar start, expressionList;\n\n  \tstart = parser.pos;\n\n  \t// allow whitespace before '['\n  \tparser.allowWhitespace();\n\n  \tif (!parser.matchString('[')) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \texpressionList = readExpressionList(parser);\n\n  \tif (!parser.matchString(']')) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \treturn {\n  \t\tt: ARRAY_LITERAL,\n  \t\tm: expressionList\n  \t};\n  }\n\n  var regexpPattern = /^(\\/(?:[^\\n\\r\\u2028\\u2029/\\\\[]|\\\\.|\\[(?:[^\\n\\r\\u2028\\u2029\\]\\\\]|\\\\.)*])+\\/(?:([gimuy])(?![a-z]*\\2))*(?![a-zA-Z_$0-9]))/;\n  function readNumberLiteral(parser) {\n  \tvar result;\n\n  \tif (result = parser.matchPattern(regexpPattern)) {\n  \t\treturn {\n  \t\t\tt: REGEXP_LITERAL,\n  \t\t\tv: result\n  \t\t};\n  \t}\n\n  \treturn null;\n  }\n\n  function readLiteral(parser) {\n  \treturn readNumberLiteral$1(parser) || readBooleanLiteral(parser) || readStringLiteral(parser) || readObjectLiteral(parser) || readArrayLiteral(parser) || readNumberLiteral(parser);\n  }\n\n  var prefixPattern = /^(?:~\\/|(?:\\.\\.\\/)+|\\.\\/(?:\\.\\.\\/)*|\\.)/;\n  var globals;\n  var keywords;\n  // if a reference is a browser global, we don't deference it later, so it needs special treatment\n  globals = /^(?:Array|console|Date|RegExp|decodeURIComponent|decodeURI|encodeURIComponent|encodeURI|isFinite|isNaN|parseFloat|parseInt|JSON|Math|NaN|undefined|null)\\b/;\n\n  // keywords are not valid references, with the exception of `this`\n  keywords = /^(?:break|case|catch|continue|debugger|default|delete|do|else|finally|for|function|if|in|instanceof|new|return|switch|throw|try|typeof|var|void|while|with)$/;\n\n  var legalReference = /^(?:[a-zA-Z$_0-9]|\\\\\\.)+(?:(?:\\.(?:[a-zA-Z$_0-9]|\\\\\\.)+)|(?:\\[[0-9]+\\]))*/;\n  var relaxedName = /^[a-zA-Z_$][-\\/a-zA-Z_$0-9]*/;\n  function readReference(parser) {\n  \tvar startPos, prefix, name, global, reference, lastDotIndex;\n\n  \tstartPos = parser.pos;\n\n  \tname = parser.matchPattern(/^@(?:keypath|index|key)/);\n\n  \tif (!name) {\n  \t\tprefix = parser.matchPattern(prefixPattern) || '';\n  \t\tname = !prefix && parser.relaxedNames && parser.matchPattern(relaxedName) || parser.matchPattern(legalReference);\n\n  \t\tif (!name && prefix === '.') {\n  \t\t\tprefix = '';\n  \t\t\tname = '.';\n  \t\t}\n  \t}\n\n  \tif (!name) {\n  \t\treturn null;\n  \t}\n\n  \t// bug out if it's a keyword (exception for ancestor/restricted refs - see https://github.com/ractivejs/ractive/issues/1497)\n  \tif (!prefix && !parser.relaxedNames && keywords.test(name)) {\n  \t\tparser.pos = startPos;\n  \t\treturn null;\n  \t}\n\n  \t// if this is a browser global, stop here\n  \tif (!prefix && globals.test(name)) {\n  \t\tglobal = globals.exec(name)[0];\n  \t\tparser.pos = startPos + global.length;\n\n  \t\treturn {\n  \t\t\tt: GLOBAL,\n  \t\t\tv: global\n  \t\t};\n  \t}\n\n  \treference = (prefix || '') + normalise(name);\n\n  \tif (parser.matchString('(')) {\n  \t\t// if this is a method invocation (as opposed to a function) we need\n  \t\t// to strip the method name from the reference combo, else the context\n  \t\t// will be wrong\n  \t\tlastDotIndex = reference.lastIndexOf('.');\n  \t\tif (lastDotIndex !== -1) {\n  \t\t\treference = reference.substr(0, lastDotIndex);\n  \t\t\tparser.pos = startPos + reference.length;\n  \t\t} else {\n  \t\t\tparser.pos -= 1;\n  \t\t}\n  \t}\n\n  \treturn {\n  \t\tt: REFERENCE,\n  \t\tn: reference.replace(/^this\\./, './').replace(/^this$/, '.')\n  \t};\n  }\n\n  function readBracketedExpression(parser) {\n  \tif (!parser.matchString('(')) return null;\n\n  \tparser.allowWhitespace();\n\n  \tvar expr = readExpression(parser);\n\n  \tif (!expr) parser.error(expectedExpression);\n\n  \tparser.allowWhitespace();\n\n  \tif (!parser.matchString(')')) parser.error(expectedParen);\n\n  \treturn {\n  \t\tt: BRACKETED,\n  \t\tx: expr\n  \t};\n  }\n\n  function readPrimary (parser) {\n  \treturn readLiteral(parser) || readReference(parser) || readBracketedExpression(parser);\n  }\n\n  function readRefinement(parser) {\n  \t// some things call for strict refinement (partial names), meaning no space between reference and refinement\n  \tif (!parser.strictRefinement) {\n  \t\tparser.allowWhitespace();\n  \t}\n\n  \t// \".\" name\n  \tif (parser.matchString('.')) {\n  \t\tparser.allowWhitespace();\n\n  \t\tvar _name = parser.matchPattern(namePattern$1);\n  \t\tif (_name) {\n  \t\t\treturn {\n  \t\t\t\tt: REFINEMENT,\n  \t\t\t\tn: _name\n  \t\t\t};\n  \t\t}\n\n  \t\tparser.error('Expected a property name');\n  \t}\n\n  \t// \"[\" expression \"]\"\n  \tif (parser.matchString('[')) {\n  \t\tparser.allowWhitespace();\n\n  \t\tvar expr = readExpression(parser);\n  \t\tif (!expr) parser.error(expectedExpression);\n\n  \t\tparser.allowWhitespace();\n\n  \t\tif (!parser.matchString(']')) parser.error('Expected \\']\\'');\n\n  \t\treturn {\n  \t\t\tt: REFINEMENT,\n  \t\t\tx: expr\n  \t\t};\n  \t}\n\n  \treturn null;\n  }\n\n  function readMemberOrInvocation (parser) {\n  \tvar expression = readPrimary(parser);\n\n  \tif (!expression) return null;\n\n  \twhile (expression) {\n  \t\tvar refinement = readRefinement(parser);\n  \t\tif (refinement) {\n  \t\t\texpression = {\n  \t\t\t\tt: MEMBER,\n  \t\t\t\tx: expression,\n  \t\t\t\tr: refinement\n  \t\t\t};\n  \t\t} else if (parser.matchString('(')) {\n  \t\t\tparser.allowWhitespace();\n  \t\t\tvar expressionList = readExpressionList(parser);\n\n  \t\t\tparser.allowWhitespace();\n\n  \t\t\tif (!parser.matchString(')')) {\n  \t\t\t\tparser.error(expectedParen);\n  \t\t\t}\n\n  \t\t\texpression = {\n  \t\t\t\tt: INVOCATION,\n  \t\t\t\tx: expression\n  \t\t\t};\n\n  \t\t\tif (expressionList) expression.o = expressionList;\n  \t\t} else {\n  \t\t\tbreak;\n  \t\t}\n  \t}\n\n  \treturn expression;\n  }\n\n  var readTypeOf;\n  var makePrefixSequenceMatcher;\n  makePrefixSequenceMatcher = function (symbol, fallthrough) {\n  \treturn function (parser) {\n  \t\tvar expression;\n\n  \t\tif (expression = fallthrough(parser)) {\n  \t\t\treturn expression;\n  \t\t}\n\n  \t\tif (!parser.matchString(symbol)) {\n  \t\t\treturn null;\n  \t\t}\n\n  \t\tparser.allowWhitespace();\n\n  \t\texpression = readExpression(parser);\n  \t\tif (!expression) {\n  \t\t\tparser.error(expectedExpression);\n  \t\t}\n\n  \t\treturn {\n  \t\t\ts: symbol,\n  \t\t\to: expression,\n  \t\t\tt: PREFIX_OPERATOR\n  \t\t};\n  \t};\n  };\n\n  // create all prefix sequence matchers, return readTypeOf\n  (function () {\n  \tvar i, len, matcher, prefixOperators, fallthrough;\n\n  \tprefixOperators = '! ~ + - typeof'.split(' ');\n\n  \tfallthrough = readMemberOrInvocation;\n  \tfor (i = 0, len = prefixOperators.length; i < len; i += 1) {\n  \t\tmatcher = makePrefixSequenceMatcher(prefixOperators[i], fallthrough);\n  \t\tfallthrough = matcher;\n  \t}\n\n  \t// typeof operator is higher precedence than multiplication, so provides the\n  \t// fallthrough for the multiplication sequence matcher we're about to create\n  \t// (we're skipping void and delete)\n  \treadTypeOf = fallthrough;\n  })();\n\n  var readTypeof = readTypeOf;\n\n  var readLogicalOr;\n  var makeInfixSequenceMatcher;\n  makeInfixSequenceMatcher = function (symbol, fallthrough) {\n  \treturn function (parser) {\n  \t\tvar start, left, right;\n\n  \t\tleft = fallthrough(parser);\n  \t\tif (!left) {\n  \t\t\treturn null;\n  \t\t}\n\n  \t\t// Loop to handle left-recursion in a case like `a * b * c` and produce\n  \t\t// left association, i.e. `(a * b) * c`.  The matcher can't call itself\n  \t\t// to parse `left` because that would be infinite regress.\n  \t\twhile (true) {\n  \t\t\tstart = parser.pos;\n\n  \t\t\tparser.allowWhitespace();\n\n  \t\t\tif (!parser.matchString(symbol)) {\n  \t\t\t\tparser.pos = start;\n  \t\t\t\treturn left;\n  \t\t\t}\n\n  \t\t\t// special case - in operator must not be followed by [a-zA-Z_$0-9]\n  \t\t\tif (symbol === 'in' && /[a-zA-Z_$0-9]/.test(parser.remaining().charAt(0))) {\n  \t\t\t\tparser.pos = start;\n  \t\t\t\treturn left;\n  \t\t\t}\n\n  \t\t\tparser.allowWhitespace();\n\n  \t\t\t// right operand must also consist of only higher-precedence operators\n  \t\t\tright = fallthrough(parser);\n  \t\t\tif (!right) {\n  \t\t\t\tparser.pos = start;\n  \t\t\t\treturn left;\n  \t\t\t}\n\n  \t\t\tleft = {\n  \t\t\t\tt: INFIX_OPERATOR,\n  \t\t\t\ts: symbol,\n  \t\t\t\to: [left, right]\n  \t\t\t};\n\n  \t\t\t// Loop back around.  If we don't see another occurrence of the symbol,\n  \t\t\t// we'll return left.\n  \t\t}\n  \t};\n  };\n\n  // create all infix sequence matchers, and return readLogicalOr\n  (function () {\n  \tvar i, len, matcher, infixOperators, fallthrough;\n\n  \t// All the infix operators on order of precedence (source: https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Operators/Operator_Precedence)\n  \t// Each sequence matcher will initially fall through to its higher precedence\n  \t// neighbour, and only attempt to match if one of the higher precedence operators\n  \t// (or, ultimately, a literal, reference, or bracketed expression) already matched\n  \tinfixOperators = '* / % + - << >> >>> < <= > >= in instanceof == != === !== & ^ | && ||'.split(' ');\n\n  \t// A typeof operator is higher precedence than multiplication\n  \tfallthrough = readTypeof;\n  \tfor (i = 0, len = infixOperators.length; i < len; i += 1) {\n  \t\tmatcher = makeInfixSequenceMatcher(infixOperators[i], fallthrough);\n  \t\tfallthrough = matcher;\n  \t}\n\n  \t// Logical OR is the fallthrough for the conditional matcher\n  \treadLogicalOr = fallthrough;\n  })();\n\n  var readLogicalOr$1 = readLogicalOr;\n\n  // The conditional operator is the lowest precedence operator, so we start here\n\n  function getConditional(parser) {\n  \tvar start, expression, ifTrue, ifFalse;\n\n  \texpression = readLogicalOr$1(parser);\n  \tif (!expression) {\n  \t\treturn null;\n  \t}\n\n  \tstart = parser.pos;\n\n  \tparser.allowWhitespace();\n\n  \tif (!parser.matchString('?')) {\n  \t\tparser.pos = start;\n  \t\treturn expression;\n  \t}\n\n  \tparser.allowWhitespace();\n\n  \tifTrue = readExpression(parser);\n  \tif (!ifTrue) {\n  \t\tparser.error(expectedExpression);\n  \t}\n\n  \tparser.allowWhitespace();\n\n  \tif (!parser.matchString(':')) {\n  \t\tparser.error('Expected \":\"');\n  \t}\n\n  \tparser.allowWhitespace();\n\n  \tifFalse = readExpression(parser);\n  \tif (!ifFalse) {\n  \t\tparser.error(expectedExpression);\n  \t}\n\n  \treturn {\n  \t\tt: CONDITIONAL,\n  \t\to: [expression, ifTrue, ifFalse]\n  \t};\n  }\n\n  function readExpression(parser) {\n  \t// The conditional operator is the lowest precedence operator (except yield,\n  \t// assignment operators, and commas, none of which are supported), so we\n  \t// start there. If it doesn't match, it 'falls through' to progressively\n  \t// higher precedence operators, until it eventually matches (or fails to\n  \t// match) a 'primary' - a literal or a reference. This way, the abstract syntax\n  \t// tree has everything in its proper place, i.e. 2 + 3 * 4 === 14, not 20.\n  \treturn getConditional(parser);\n  }\n\n  function readExpressionOrReference(parser, expectedFollowers) {\n  \tvar start, expression, i;\n\n  \tstart = parser.pos;\n  \texpression = readExpression(parser);\n\n  \tif (!expression) {\n  \t\treturn null;\n  \t}\n\n  \tfor (i = 0; i < expectedFollowers.length; i += 1) {\n  \t\tif (parser.remaining().substr(0, expectedFollowers[i].length) === expectedFollowers[i]) {\n  \t\t\treturn expression;\n  \t\t}\n  \t}\n\n  \tparser.pos = start;\n  \treturn readReference(parser);\n  }\n\n  function flattenExpression(expression) {\n  \tvar refs;\n\n  \textractRefs(expression, refs = []);\n\n  \treturn {\n  \t\tr: refs,\n  \t\ts: stringify(expression)\n  \t};\n\n  \tfunction stringify(node) {\n  \t\tswitch (node.t) {\n  \t\t\tcase BOOLEAN_LITERAL:\n  \t\t\tcase GLOBAL:\n  \t\t\tcase NUMBER_LITERAL:\n  \t\t\tcase REGEXP_LITERAL:\n  \t\t\t\treturn node.v;\n\n  \t\t\tcase STRING_LITERAL:\n  \t\t\t\treturn JSON.stringify(String(node.v));\n\n  \t\t\tcase ARRAY_LITERAL:\n  \t\t\t\treturn '[' + (node.m ? node.m.map(stringify).join(',') : '') + ']';\n\n  \t\t\tcase OBJECT_LITERAL:\n  \t\t\t\treturn '{' + (node.m ? node.m.map(stringify).join(',') : '') + '}';\n\n  \t\t\tcase KEY_VALUE_PAIR:\n  \t\t\t\treturn node.k + ':' + stringify(node.v);\n\n  \t\t\tcase PREFIX_OPERATOR:\n  \t\t\t\treturn (node.s === 'typeof' ? 'typeof ' : node.s) + stringify(node.o);\n\n  \t\t\tcase INFIX_OPERATOR:\n  \t\t\t\treturn stringify(node.o[0]) + (node.s.substr(0, 2) === 'in' ? ' ' + node.s + ' ' : node.s) + stringify(node.o[1]);\n\n  \t\t\tcase INVOCATION:\n  \t\t\t\treturn stringify(node.x) + '(' + (node.o ? node.o.map(stringify).join(',') : '') + ')';\n\n  \t\t\tcase BRACKETED:\n  \t\t\t\treturn '(' + stringify(node.x) + ')';\n\n  \t\t\tcase MEMBER:\n  \t\t\t\treturn stringify(node.x) + stringify(node.r);\n\n  \t\t\tcase REFINEMENT:\n  \t\t\t\treturn node.n ? '.' + node.n : '[' + stringify(node.x) + ']';\n\n  \t\t\tcase CONDITIONAL:\n  \t\t\t\treturn stringify(node.o[0]) + '?' + stringify(node.o[1]) + ':' + stringify(node.o[2]);\n\n  \t\t\tcase REFERENCE:\n  \t\t\t\treturn '_' + refs.indexOf(node.n);\n\n  \t\t\tdefault:\n  \t\t\t\tthrow new Error('Expected legal JavaScript');\n  \t\t}\n  \t}\n  }\n\n  // TODO maybe refactor this?\n  function extractRefs(node, refs) {\n  \tvar i, list;\n\n  \tif (node.t === REFERENCE) {\n  \t\tif (refs.indexOf(node.n) === -1) {\n  \t\t\trefs.unshift(node.n);\n  \t\t}\n  \t}\n\n  \tlist = node.o || node.m;\n  \tif (list) {\n  \t\tif (isObject(list)) {\n  \t\t\textractRefs(list, refs);\n  \t\t} else {\n  \t\t\ti = list.length;\n  \t\t\twhile (i--) {\n  \t\t\t\textractRefs(list[i], refs);\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \tif (node.x) {\n  \t\textractRefs(node.x, refs);\n  \t}\n\n  \tif (node.r) {\n  \t\textractRefs(node.r, refs);\n  \t}\n\n  \tif (node.v) {\n  \t\textractRefs(node.v, refs);\n  \t}\n  }\n\n  var arrayMemberPattern = /^[0-9][1-9]*$/;\n  function refineExpression(expression, mustache) {\n  \tvar referenceExpression;\n\n  \tif (expression) {\n  \t\twhile (expression.t === BRACKETED && expression.x) {\n  \t\t\texpression = expression.x;\n  \t\t}\n\n  \t\t// special case - integers should be treated as array members references,\n  \t\t// rather than as expressions in their own right\n  \t\tif (expression.t === REFERENCE) {\n  \t\t\tmustache.r = expression.n;\n  \t\t} else {\n  \t\t\tif (expression.t === NUMBER_LITERAL && arrayMemberPattern.test(expression.v)) {\n  \t\t\t\tmustache.r = expression.v;\n  \t\t\t} else if (referenceExpression = getReferenceExpression(expression)) {\n  \t\t\t\tmustache.rx = referenceExpression;\n  \t\t\t} else {\n  \t\t\t\tmustache.x = flattenExpression(expression);\n  \t\t\t}\n  \t\t}\n\n  \t\treturn mustache;\n  \t}\n  }\n\n  // TODO refactor this! it's bewildering\n  function getReferenceExpression(expression) {\n  \tvar members = [],\n  \t    refinement;\n\n  \twhile (expression.t === MEMBER && expression.r.t === REFINEMENT) {\n  \t\trefinement = expression.r;\n\n  \t\tif (refinement.x) {\n  \t\t\tif (refinement.x.t === REFERENCE) {\n  \t\t\t\tmembers.unshift(refinement.x);\n  \t\t\t} else {\n  \t\t\t\tmembers.unshift(flattenExpression(refinement.x));\n  \t\t\t}\n  \t\t} else {\n  \t\t\tmembers.unshift(refinement.n);\n  \t\t}\n\n  \t\texpression = expression.x;\n  \t}\n\n  \tif (expression.t !== REFERENCE) {\n  \t\treturn null;\n  \t}\n\n  \treturn {\n  \t\tr: expression.n,\n  \t\tm: members\n  \t};\n  }\n\n  function readInterpolator(parser, tag) {\n  \tvar start, expression, interpolator, err;\n\n  \tstart = parser.pos;\n\n  \t// TODO would be good for perf if we could do away with the try-catch\n  \ttry {\n  \t\texpression = readExpressionOrReference(parser, [tag.close]);\n  \t} catch (e) {\n  \t\terr = e;\n  \t}\n\n  \tif (!expression) {\n  \t\tif (parser.str.charAt(start) === '!') {\n  \t\t\t// special case - comment\n  \t\t\tparser.pos = start;\n  \t\t\treturn null;\n  \t\t}\n\n  \t\tif (err) {\n  \t\t\tthrow err;\n  \t\t}\n  \t}\n\n  \tif (!parser.matchString(tag.close)) {\n  \t\tparser.error('Expected closing delimiter \\'' + tag.close + '\\' after reference');\n\n  \t\tif (!expression) {\n  \t\t\t// special case - comment\n  \t\t\tif (parser.nextChar() === '!') {\n  \t\t\t\treturn null;\n  \t\t\t}\n\n  \t\t\tparser.error('Expected expression or legal reference');\n  \t\t}\n  \t}\n\n  \tinterpolator = { t: INTERPOLATOR };\n  \trefineExpression(expression, interpolator); // TODO handle this differently - it's mysterious\n\n  \treturn interpolator;\n  }\n\n  var yieldPattern = /^yield\\s*/;\n  function readYielder(parser, tag) {\n  \tif (!parser.matchPattern(yieldPattern)) return null;\n\n  \tvar name = parser.matchPattern(/^[a-zA-Z_$][a-zA-Z_$0-9\\-]*/);\n\n  \tparser.allowWhitespace();\n\n  \tif (!parser.matchString(tag.close)) {\n  \t\tparser.error(\"expected legal partial name\");\n  \t}\n\n  \tvar yielder = { t: YIELDER };\n  \tif (name) yielder.n = name;\n\n  \treturn yielder;\n  }\n\n  var handlebarsBlockCodes = {\n  \t'each': SECTION_EACH,\n  \t'if': SECTION_IF,\n  \t'if-with': SECTION_IF_WITH,\n  \t'with': SECTION_WITH,\n  \t'unless': SECTION_UNLESS\n  };\n\n  function readClosing(parser, tag) {\n  \tvar start, remaining, index, closing;\n\n  \tstart = parser.pos;\n\n  \tif (!parser.matchString(tag.open)) {\n  \t\treturn null;\n  \t}\n\n  \tparser.allowWhitespace();\n\n  \tif (!parser.matchString('/')) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \tparser.allowWhitespace();\n\n  \tremaining = parser.remaining();\n  \tindex = remaining.indexOf(tag.close);\n\n  \tif (index !== -1) {\n  \t\tclosing = {\n  \t\t\tt: CLOSING,\n  \t\t\tr: remaining.substr(0, index).split(' ')[0]\n  \t\t};\n\n  \t\tparser.pos += index;\n\n  \t\tif (!parser.matchString(tag.close)) {\n  \t\t\tparser.error('Expected closing delimiter \\'' + tag.close + '\\'');\n  \t\t}\n\n  \t\treturn closing;\n  \t}\n\n  \tparser.pos = start;\n  \treturn null;\n  }\n\n  var elsePattern = /^\\s*else\\s*/;\n  function readElse(parser, tag) {\n  \tvar start = parser.pos;\n\n  \tif (!parser.matchString(tag.open)) {\n  \t\treturn null;\n  \t}\n\n  \tif (!parser.matchPattern(elsePattern)) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \tif (!parser.matchString(tag.close)) {\n  \t\tparser.error(\"Expected closing delimiter '\" + tag.close + \"'\");\n  \t}\n\n  \treturn {\n  \t\tt: ELSE\n  \t};\n  }\n\n  var elsePattern$1 = /^\\s*elseif\\s+/;\n  function readElseIf(parser, tag) {\n  \tvar start = parser.pos;\n\n  \tif (!parser.matchString(tag.open)) {\n  \t\treturn null;\n  \t}\n\n  \tif (!parser.matchPattern(elsePattern$1)) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \tvar expression = readExpression(parser);\n\n  \tif (!parser.matchString(tag.close)) {\n  \t\tparser.error('Expected closing delimiter \\'' + tag.close + '\\'');\n  \t}\n\n  \treturn {\n  \t\tt: ELSEIF,\n  \t\tx: expression\n  \t};\n  }\n\n  var indexRefPattern = /^\\s*:\\s*([a-zA-Z_$][a-zA-Z_$0-9]*)/;\n  var keyIndexRefPattern = /^\\s*,\\s*([a-zA-Z_$][a-zA-Z_$0-9]*)/;\n  var handlebarsBlockPattern = new RegExp('^(' + Object.keys(handlebarsBlockCodes).join('|') + ')\\\\b');\n  function readSection(parser, tag) {\n  \tvar start, expression, section, child, children, hasElse, block, unlessBlock, conditions, closed, i, expectedClose;\n\n  \tstart = parser.pos;\n\n  \tif (parser.matchString('^')) {\n  \t\tsection = { t: SECTION, f: [], n: SECTION_UNLESS };\n  \t} else if (parser.matchString('#')) {\n  \t\tsection = { t: SECTION, f: [] };\n\n  \t\tif (parser.matchString('partial')) {\n  \t\t\tparser.pos = start - parser.standardDelimiters[0].length;\n  \t\t\tparser.error('Partial definitions can only be at the top level of the template, or immediately inside components');\n  \t\t}\n\n  \t\tif (block = parser.matchPattern(handlebarsBlockPattern)) {\n  \t\t\texpectedClose = block;\n  \t\t\tsection.n = handlebarsBlockCodes[block];\n  \t\t}\n  \t} else {\n  \t\treturn null;\n  \t}\n\n  \tparser.allowWhitespace();\n\n  \texpression = readExpression(parser);\n\n  \tif (!expression) {\n  \t\tparser.error('Expected expression');\n  \t}\n\n  \t// optional index and key references\n  \tif (i = parser.matchPattern(indexRefPattern)) {\n  \t\tvar extra = undefined;\n\n  \t\tif (extra = parser.matchPattern(keyIndexRefPattern)) {\n  \t\t\tsection.i = i + ',' + extra;\n  \t\t} else {\n  \t\t\tsection.i = i;\n  \t\t}\n  \t}\n\n  \tparser.allowWhitespace();\n\n  \tif (!parser.matchString(tag.close)) {\n  \t\tparser.error('Expected closing delimiter \\'' + tag.close + '\\'');\n  \t}\n\n  \tparser.sectionDepth += 1;\n  \tchildren = section.f;\n\n  \tconditions = [];\n\n  \tdo {\n  \t\tif (child = readClosing(parser, tag)) {\n  \t\t\tif (expectedClose && child.r !== expectedClose) {\n  \t\t\t\tparser.error('Expected ' + tag.open + '/' + expectedClose + tag.close);\n  \t\t\t}\n\n  \t\t\tparser.sectionDepth -= 1;\n  \t\t\tclosed = true;\n  \t\t} else if (child = readElseIf(parser, tag)) {\n  \t\t\tif (section.n === SECTION_UNLESS) {\n  \t\t\t\tparser.error('{{else}} not allowed in {{#unless}}');\n  \t\t\t}\n\n  \t\t\tif (hasElse) {\n  \t\t\t\tparser.error('illegal {{elseif...}} after {{else}}');\n  \t\t\t}\n\n  \t\t\tif (!unlessBlock) {\n  \t\t\t\tunlessBlock = createUnlessBlock(expression);\n  \t\t\t}\n\n  \t\t\tunlessBlock.f.push({\n  \t\t\t\tt: SECTION,\n  \t\t\t\tn: SECTION_IF,\n  \t\t\t\tx: flattenExpression(combine$2(conditions.concat(child.x))),\n  \t\t\t\tf: children = []\n  \t\t\t});\n\n  \t\t\tconditions.push(invert(child.x));\n  \t\t} else if (child = readElse(parser, tag)) {\n  \t\t\tif (section.n === SECTION_UNLESS) {\n  \t\t\t\tparser.error('{{else}} not allowed in {{#unless}}');\n  \t\t\t}\n\n  \t\t\tif (hasElse) {\n  \t\t\t\tparser.error('there can only be one {{else}} block, at the end of a section');\n  \t\t\t}\n\n  \t\t\thasElse = true;\n\n  \t\t\t// use an unless block if there's no elseif\n  \t\t\tif (!unlessBlock) {\n  \t\t\t\tunlessBlock = createUnlessBlock(expression);\n  \t\t\t\tchildren = unlessBlock.f;\n  \t\t\t} else {\n  \t\t\t\tunlessBlock.f.push({\n  \t\t\t\t\tt: SECTION,\n  \t\t\t\t\tn: SECTION_IF,\n  \t\t\t\t\tx: flattenExpression(combine$2(conditions)),\n  \t\t\t\t\tf: children = []\n  \t\t\t\t});\n  \t\t\t}\n  \t\t} else {\n  \t\t\tchild = parser.read(READERS);\n\n  \t\t\tif (!child) {\n  \t\t\t\tbreak;\n  \t\t\t}\n\n  \t\t\tchildren.push(child);\n  \t\t}\n  \t} while (!closed);\n\n  \tif (unlessBlock) {\n  \t\t// special case - `with` should become `if-with` (TODO is this right?\n  \t\t// seems to me that `with` ought to behave consistently, regardless\n  \t\t// of the presence/absence of `else`. In other words should always\n  \t\t// be `if-with`\n  \t\tif (section.n === SECTION_WITH) {\n  \t\t\tsection.n = SECTION_IF_WITH;\n  \t\t}\n\n  \t\tsection.l = unlessBlock;\n  \t}\n\n  \trefineExpression(expression, section);\n\n  \t// TODO if a section is empty it should be discarded. Don't do\n  \t// that here though - we need to clean everything up first, as\n  \t// it may contain removeable whitespace. As a temporary measure,\n  \t// to pass the existing tests, remove empty `f` arrays\n  \tif (!section.f.length) {\n  \t\tdelete section.f;\n  \t}\n\n  \treturn section;\n  }\n\n  function createUnlessBlock(expression) {\n  \tvar unlessBlock = {\n  \t\tt: SECTION,\n  \t\tn: SECTION_UNLESS,\n  \t\tf: []\n  \t};\n\n  \trefineExpression(expression, unlessBlock);\n  \treturn unlessBlock;\n  }\n\n  function invert(expression) {\n  \tif (expression.t === PREFIX_OPERATOR && expression.s === '!') {\n  \t\treturn expression.o;\n  \t}\n\n  \treturn {\n  \t\tt: PREFIX_OPERATOR,\n  \t\ts: '!',\n  \t\to: parensIfNecessary(expression)\n  \t};\n  }\n\n  function combine$2(expressions) {\n  \tif (expressions.length === 1) {\n  \t\treturn expressions[0];\n  \t}\n\n  \treturn {\n  \t\tt: INFIX_OPERATOR,\n  \t\ts: '&&',\n  \t\to: [parensIfNecessary(expressions[0]), parensIfNecessary(combine$2(expressions.slice(1)))]\n  \t};\n  }\n\n  function parensIfNecessary(expression) {\n  \t// TODO only wrap if necessary\n  \treturn {\n  \t\tt: BRACKETED,\n  \t\tx: expression\n  \t};\n  }\n\n  function readUnescaped(parser, tag) {\n  \tvar expression, triple;\n\n  \tif (!parser.matchString('&')) {\n  \t\treturn null;\n  \t}\n\n  \tparser.allowWhitespace();\n\n  \texpression = readExpression(parser);\n\n  \tif (!expression) {\n  \t\treturn null;\n  \t}\n\n  \tif (!parser.matchString(tag.close)) {\n  \t\tparser.error('Expected closing delimiter \\'' + tag.close + '\\'');\n  \t}\n\n  \ttriple = { t: TRIPLE };\n  \trefineExpression(expression, triple); // TODO handle this differently - it's mysterious\n\n  \treturn triple;\n  }\n\n  function readPartial(parser, tag) {\n  \tif (!parser.matchString('>')) return null;\n\n  \tparser.allowWhitespace();\n\n  \t// Partial names can include hyphens, so we can't use readExpression\n  \t// blindly. Instead, we use the `relaxedNames` flag to indicate that\n  \t// `foo-bar` should be read as a single name, rather than 'subtract\n  \t// bar from foo'\n  \tparser.relaxedNames = parser.strictRefinement = true;\n  \tvar expression = readExpression(parser);\n  \tparser.relaxedNames = parser.strictRefinement = false;\n\n  \tparser.allowWhitespace();\n  \tvar context = readExpression(parser);\n  \tparser.allowWhitespace();\n\n  \tif (!expression) return null;\n\n  \tvar partial = { t: PARTIAL };\n  \trefineExpression(expression, partial); // TODO...\n\n  \tparser.allowWhitespace();\n\n  \t// if we have another expression - e.g. `{{>foo bar}}` - then\n  \t// we turn it into `{{#with bar}}{{>foo}}{{/with}}`\n  \tif (context) {\n  \t\tpartial = {\n  \t\t\tt: SECTION,\n  \t\t\tn: SECTION_WITH,\n  \t\t\tf: [partial]\n  \t\t};\n\n  \t\trefineExpression(context, partial);\n  \t}\n\n  \tif (!parser.matchString(tag.close)) {\n  \t\tparser.error('Expected closing delimiter \\'' + tag.close + '\\'');\n  \t}\n\n  \treturn partial;\n  }\n\n  function readTriple(parser, tag) {\n  \tvar expression = readExpression(parser),\n  \t    triple;\n\n  \tif (!expression) {\n  \t\treturn null;\n  \t}\n\n  \tif (!parser.matchString(tag.close)) {\n  \t\tparser.error('Expected closing delimiter \\'' + tag.close + '\\'');\n  \t}\n\n  \ttriple = { t: TRIPLE };\n  \trefineExpression(expression, triple); // TODO handle this differently - it's mysterious\n\n  \treturn triple;\n  }\n\n  function getLowestIndex (haystack, needles) {\n  \tvar i, index, lowest;\n\n  \ti = needles.length;\n  \twhile (i--) {\n  \t\tindex = haystack.indexOf(needles[i]);\n\n  \t\t// short circuit\n  \t\tif (!index) {\n  \t\t\treturn 0;\n  \t\t}\n\n  \t\tif (index === -1) {\n  \t\t\tcontinue;\n  \t\t}\n\n  \t\tif (!lowest || index < lowest) {\n  \t\t\tlowest = index;\n  \t\t}\n  \t}\n\n  \treturn lowest || -1;\n  }\n\n  // https://github.com/kangax/html-minifier/issues/63#issuecomment-37763316\n  var booleanAttributes = /^(allowFullscreen|async|autofocus|autoplay|checked|compact|controls|declare|default|defaultChecked|defaultMuted|defaultSelected|defer|disabled|enabled|formNoValidate|hidden|indeterminate|inert|isMap|itemScope|loop|multiple|muted|noHref|noResize|noShade|noValidate|noWrap|open|pauseOnExit|readOnly|required|reversed|scoped|seamless|selected|sortable|translate|trueSpeed|typeMustMatch|visible)$/i;\n  var voidElementNames = /^(?:area|base|br|col|command|doctype|embed|hr|img|input|keygen|link|meta|param|source|track|wbr)$/i;\n\n  var htmlEntities = { quot: 34, amp: 38, apos: 39, lt: 60, gt: 62, nbsp: 160, iexcl: 161, cent: 162, pound: 163, curren: 164, yen: 165, brvbar: 166, sect: 167, uml: 168, copy: 169, ordf: 170, laquo: 171, not: 172, shy: 173, reg: 174, macr: 175, deg: 176, plusmn: 177, sup2: 178, sup3: 179, acute: 180, micro: 181, para: 182, middot: 183, cedil: 184, sup1: 185, ordm: 186, raquo: 187, frac14: 188, frac12: 189, frac34: 190, iquest: 191, Agrave: 192, Aacute: 193, Acirc: 194, Atilde: 195, Auml: 196, Aring: 197, AElig: 198, Ccedil: 199, Egrave: 200, Eacute: 201, Ecirc: 202, Euml: 203, Igrave: 204, Iacute: 205, Icirc: 206, Iuml: 207, ETH: 208, Ntilde: 209, Ograve: 210, Oacute: 211, Ocirc: 212, Otilde: 213, Ouml: 214, times: 215, Oslash: 216, Ugrave: 217, Uacute: 218, Ucirc: 219, Uuml: 220, Yacute: 221, THORN: 222, szlig: 223, agrave: 224, aacute: 225, acirc: 226, atilde: 227, auml: 228, aring: 229, aelig: 230, ccedil: 231, egrave: 232, eacute: 233, ecirc: 234, euml: 235, igrave: 236, iacute: 237, icirc: 238, iuml: 239, eth: 240, ntilde: 241, ograve: 242, oacute: 243, ocirc: 244, otilde: 245, ouml: 246, divide: 247, oslash: 248, ugrave: 249, uacute: 250, ucirc: 251, uuml: 252, yacute: 253, thorn: 254, yuml: 255, OElig: 338, oelig: 339, Scaron: 352, scaron: 353, Yuml: 376, fnof: 402, circ: 710, tilde: 732, Alpha: 913, Beta: 914, Gamma: 915, Delta: 916, Epsilon: 917, Zeta: 918, Eta: 919, Theta: 920, Iota: 921, Kappa: 922, Lambda: 923, Mu: 924, Nu: 925, Xi: 926, Omicron: 927, Pi: 928, Rho: 929, Sigma: 931, Tau: 932, Upsilon: 933, Phi: 934, Chi: 935, Psi: 936, Omega: 937, alpha: 945, beta: 946, gamma: 947, delta: 948, epsilon: 949, zeta: 950, eta: 951, theta: 952, iota: 953, kappa: 954, lambda: 955, mu: 956, nu: 957, xi: 958, omicron: 959, pi: 960, rho: 961, sigmaf: 962, sigma: 963, tau: 964, upsilon: 965, phi: 966, chi: 967, psi: 968, omega: 969, thetasym: 977, upsih: 978, piv: 982, ensp: 8194, emsp: 8195, thinsp: 8201, zwnj: 8204, zwj: 8205, lrm: 8206, rlm: 8207, ndash: 8211, mdash: 8212, lsquo: 8216, rsquo: 8217, sbquo: 8218, ldquo: 8220, rdquo: 8221, bdquo: 8222, dagger: 8224, Dagger: 8225, bull: 8226, hellip: 8230, permil: 8240, prime: 8242, Prime: 8243, lsaquo: 8249, rsaquo: 8250, oline: 8254, frasl: 8260, euro: 8364, image: 8465, weierp: 8472, real: 8476, trade: 8482, alefsym: 8501, larr: 8592, uarr: 8593, rarr: 8594, darr: 8595, harr: 8596, crarr: 8629, lArr: 8656, uArr: 8657, rArr: 8658, dArr: 8659, hArr: 8660, forall: 8704, part: 8706, exist: 8707, empty: 8709, nabla: 8711, isin: 8712, notin: 8713, ni: 8715, prod: 8719, sum: 8721, minus: 8722, lowast: 8727, radic: 8730, prop: 8733, infin: 8734, ang: 8736, and: 8743, or: 8744, cap: 8745, cup: 8746, 'int': 8747, there4: 8756, sim: 8764, cong: 8773, asymp: 8776, ne: 8800, equiv: 8801, le: 8804, ge: 8805, sub: 8834, sup: 8835, nsub: 8836, sube: 8838, supe: 8839, oplus: 8853, otimes: 8855, perp: 8869, sdot: 8901, lceil: 8968, rceil: 8969, lfloor: 8970, rfloor: 8971, lang: 9001, rang: 9002, loz: 9674, spades: 9824, clubs: 9827, hearts: 9829, diams: 9830 };\n  var controlCharacters = [8364, 129, 8218, 402, 8222, 8230, 8224, 8225, 710, 8240, 352, 8249, 338, 141, 381, 143, 144, 8216, 8217, 8220, 8221, 8226, 8211, 8212, 732, 8482, 353, 8250, 339, 157, 382, 376];\n  var entityPattern = new RegExp('&(#?(?:x[\\\\w\\\\d]+|\\\\d+|' + Object.keys(htmlEntities).join('|') + '));?', 'g');\n\n  function decodeCharacterReferences(html) {\n  \treturn html.replace(entityPattern, function (match, entity) {\n  \t\tvar code;\n\n  \t\t// Handle named entities\n  \t\tif (entity[0] !== '#') {\n  \t\t\tcode = htmlEntities[entity];\n  \t\t} else if (entity[1] === 'x') {\n  \t\t\tcode = parseInt(entity.substring(2), 16);\n  \t\t} else {\n  \t\t\tcode = parseInt(entity.substring(1), 10);\n  \t\t}\n\n  \t\tif (!code) {\n  \t\t\treturn match;\n  \t\t}\n\n  \t\treturn String.fromCharCode(validateCode(code));\n  \t});\n  }\n\n  var lessThan = /</g;\n  var greaterThan = />/g;\n  var amp = /&/g;\n\n  function escapeHtml(str) {\n  \treturn str.replace(amp, '&amp;').replace(lessThan, '&lt;').replace(greaterThan, '&gt;');\n  }\n\n  // some code points are verboten. If we were inserting HTML, the browser would replace the illegal\n  // code points with alternatives in some cases - since we're bypassing that mechanism, we need\n  // to replace them ourselves\n  //\n  // Source: http://en.wikipedia.org/wiki/Character_encodings_in_HTML#Illegal_characters\n  function validateCode(code) {\n  \tif (!code) {\n  \t\treturn 65533;\n  \t}\n\n  \t// line feed becomes generic whitespace\n  \tif (code === 10) {\n  \t\treturn 32;\n  \t}\n\n  \t// ASCII range. (Why someone would use HTML entities for ASCII characters I don't know, but...)\n  \tif (code < 128) {\n  \t\treturn code;\n  \t}\n\n  \t// code points 128-159 are dealt with leniently by browsers, but they're incorrect. We need\n  \t// to correct the mistake or we'll end up with missing  signs and so on\n  \tif (code <= 159) {\n  \t\treturn controlCharacters[code - 128];\n  \t}\n\n  \t// basic multilingual plane\n  \tif (code < 55296) {\n  \t\treturn code;\n  \t}\n\n  \t// UTF-16 surrogate halves\n  \tif (code <= 57343) {\n  \t\treturn 65533;\n  \t}\n\n  \t// rest of the basic multilingual plane\n  \tif (code <= 65535) {\n  \t\treturn code;\n  \t}\n\n  \treturn 65533;\n  }\n\n  function readText(parser) {\n  \tvar index, remaining, disallowed, barrier;\n\n  \tremaining = parser.remaining();\n\n  \tbarrier = parser.inside ? '</' + parser.inside : '<';\n\n  \tif (parser.inside && !parser.interpolate[parser.inside]) {\n  \t\tindex = remaining.indexOf(barrier);\n  \t} else {\n  \t\tdisallowed = parser.tags.map(function (t) {\n  \t\t\treturn t.open;\n  \t\t});\n  \t\tdisallowed = disallowed.concat(parser.tags.map(function (t) {\n  \t\t\treturn '\\\\' + t.open;\n  \t\t}));\n\n  \t\t// http://developers.whatwg.org/syntax.html#syntax-attributes\n  \t\tif (parser.inAttribute === true) {\n  \t\t\t// we're inside an unquoted attribute value\n  \t\t\tdisallowed.push('\"', '\\'', '=', '<', '>', '`');\n  \t\t} else if (parser.inAttribute) {\n  \t\t\t// quoted attribute value\n  \t\t\tdisallowed.push(parser.inAttribute);\n  \t\t} else {\n  \t\t\tdisallowed.push(barrier);\n  \t\t}\n\n  \t\tindex = getLowestIndex(remaining, disallowed);\n  \t}\n\n  \tif (!index) {\n  \t\treturn null;\n  \t}\n\n  \tif (index === -1) {\n  \t\tindex = remaining.length;\n  \t}\n\n  \tparser.pos += index;\n\n  \treturn parser.inside ? remaining.substr(0, index) : decodeCharacterReferences(remaining.substr(0, index));\n  }\n\n  var leadingLinebreak = /^\\s*\\r?\\n/;\n  var trailingLinebreak = /\\r?\\n\\s*$/;\n  function stripStandalones (items) {\n  \tvar i, current, backOne, backTwo, lastSectionItem;\n\n  \tfor (i = 1; i < items.length; i += 1) {\n  \t\tcurrent = items[i];\n  \t\tbackOne = items[i - 1];\n  \t\tbackTwo = items[i - 2];\n\n  \t\t// if we're at the end of a [text][comment][text] sequence...\n  \t\tif (isString(current) && isComment(backOne) && isString(backTwo)) {\n\n  \t\t\t// ... and the comment is a standalone (i.e. line breaks either side)...\n  \t\t\tif (trailingLinebreak.test(backTwo) && leadingLinebreak.test(current)) {\n\n  \t\t\t\t// ... then we want to remove the whitespace after the first line break\n  \t\t\t\titems[i - 2] = backTwo.replace(trailingLinebreak, '\\n');\n\n  \t\t\t\t// and the leading line break of the second text token\n  \t\t\t\titems[i] = current.replace(leadingLinebreak, '');\n  \t\t\t}\n  \t\t}\n\n  \t\t// if the current item is a section, and it is preceded by a linebreak, and\n  \t\t// its first item is a linebreak...\n  \t\tif (isSection(current) && isString(backOne)) {\n  \t\t\tif (trailingLinebreak.test(backOne) && isString(current.f[0]) && leadingLinebreak.test(current.f[0])) {\n  \t\t\t\titems[i - 1] = backOne.replace(trailingLinebreak, '\\n');\n  \t\t\t\tcurrent.f[0] = current.f[0].replace(leadingLinebreak, '');\n  \t\t\t}\n  \t\t}\n\n  \t\t// if the last item was a section, and it is followed by a linebreak, and\n  \t\t// its last item is a linebreak...\n  \t\tif (isString(current) && isSection(backOne)) {\n  \t\t\tlastSectionItem = lastItem(backOne.f);\n\n  \t\t\tif (isString(lastSectionItem) && trailingLinebreak.test(lastSectionItem) && leadingLinebreak.test(current)) {\n  \t\t\t\tbackOne.f[backOne.f.length - 1] = lastSectionItem.replace(trailingLinebreak, '\\n');\n  \t\t\t\titems[i] = current.replace(leadingLinebreak, '');\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \treturn items;\n  }\n\n  function isString(item) {\n  \treturn typeof item === 'string';\n  }\n\n  function isComment(item) {\n  \treturn item.t === COMMENT || item.t === DELIMCHANGE;\n  }\n\n  function isSection(item) {\n  \treturn (item.t === SECTION || item.t === INVERTED) && item.f;\n  }\n\n  function trimWhitespace (items, leadingPattern, trailingPattern) {\n  \tvar item;\n\n  \tif (leadingPattern) {\n  \t\titem = items[0];\n  \t\tif (typeof item === 'string') {\n  \t\t\titem = item.replace(leadingPattern, '');\n\n  \t\t\tif (!item) {\n  \t\t\t\titems.shift();\n  \t\t\t} else {\n  \t\t\t\titems[0] = item;\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \tif (trailingPattern) {\n  \t\titem = lastItem(items);\n  \t\tif (typeof item === 'string') {\n  \t\t\titem = item.replace(trailingPattern, '');\n\n  \t\t\tif (!item) {\n  \t\t\t\titems.pop();\n  \t\t\t} else {\n  \t\t\t\titems[items.length - 1] = item;\n  \t\t\t}\n  \t\t}\n  \t}\n  }\n\n  var contiguousWhitespace = /[ \\t\\f\\r\\n]+/g;\n  var preserveWhitespaceElements = /^(?:pre|script|style|textarea)$/i;\n  var leadingWhitespace$1 = /^[ \\t\\f\\r\\n]+/;\n  var trailingWhitespace = /[ \\t\\f\\r\\n]+$/;\n  var leadingNewLine = /^(?:\\r\\n|\\r|\\n)/;\n  var trailingNewLine = /(?:\\r\\n|\\r|\\n)$/;\n  function cleanup(items, stripComments, preserveWhitespace, removeLeadingWhitespace, removeTrailingWhitespace) {\n  \tvar i, item, previousItem, nextItem, preserveWhitespaceInsideFragment, removeLeadingWhitespaceInsideFragment, removeTrailingWhitespaceInsideFragment, key;\n\n  \t// First pass - remove standalones and comments etc\n  \tstripStandalones(items);\n\n  \ti = items.length;\n  \twhile (i--) {\n  \t\titem = items[i];\n\n  \t\t// Remove delimiter changes, unsafe elements etc\n  \t\tif (item.exclude) {\n  \t\t\titems.splice(i, 1);\n  \t\t}\n\n  \t\t// Remove comments, unless we want to keep them\n  \t\telse if (stripComments && item.t === COMMENT) {\n  \t\t\t\titems.splice(i, 1);\n  \t\t\t}\n  \t}\n\n  \t// If necessary, remove leading and trailing whitespace\n  \ttrimWhitespace(items, removeLeadingWhitespace ? leadingWhitespace$1 : null, removeTrailingWhitespace ? trailingWhitespace : null);\n\n  \ti = items.length;\n  \twhile (i--) {\n  \t\titem = items[i];\n\n  \t\t// Recurse\n  \t\tif (item.f) {\n  \t\t\tvar isPreserveWhitespaceElement = item.t === ELEMENT && preserveWhitespaceElements.test(item.e);\n  \t\t\tpreserveWhitespaceInsideFragment = preserveWhitespace || isPreserveWhitespaceElement;\n\n  \t\t\tif (!preserveWhitespace && isPreserveWhitespaceElement) {\n  \t\t\t\ttrimWhitespace(item.f, leadingNewLine, trailingNewLine);\n  \t\t\t}\n\n  \t\t\tif (!preserveWhitespaceInsideFragment) {\n  \t\t\t\tpreviousItem = items[i - 1];\n  \t\t\t\tnextItem = items[i + 1];\n\n  \t\t\t\t// if the previous item was a text item with trailing whitespace,\n  \t\t\t\t// remove leading whitespace inside the fragment\n  \t\t\t\tif (!previousItem || typeof previousItem === 'string' && trailingWhitespace.test(previousItem)) {\n  \t\t\t\t\tremoveLeadingWhitespaceInsideFragment = true;\n  \t\t\t\t}\n\n  \t\t\t\t// and vice versa\n  \t\t\t\tif (!nextItem || typeof nextItem === 'string' && leadingWhitespace$1.test(nextItem)) {\n  \t\t\t\t\tremoveTrailingWhitespaceInsideFragment = true;\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\tcleanup(item.f, stripComments, preserveWhitespaceInsideFragment, removeLeadingWhitespaceInsideFragment, removeTrailingWhitespaceInsideFragment);\n  \t\t}\n\n  \t\t// Split if-else blocks into two (an if, and an unless)\n  \t\tif (item.l) {\n  \t\t\tcleanup(item.l.f, stripComments, preserveWhitespace, removeLeadingWhitespaceInsideFragment, removeTrailingWhitespaceInsideFragment);\n\n  \t\t\titems.splice(i + 1, 0, item.l);\n  \t\t\tdelete item.l; // TODO would be nice if there was a way around this\n  \t\t}\n\n  \t\t// Clean up element attributes\n  \t\tif (item.a) {\n  \t\t\tfor (key in item.a) {\n  \t\t\t\tif (item.a.hasOwnProperty(key) && typeof item.a[key] !== 'string') {\n  \t\t\t\t\tcleanup(item.a[key], stripComments, preserveWhitespace, removeLeadingWhitespaceInsideFragment, removeTrailingWhitespaceInsideFragment);\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\t// Clean up conditional attributes\n  \t\tif (item.m) {\n  \t\t\tcleanup(item.m, stripComments, preserveWhitespace, removeLeadingWhitespaceInsideFragment, removeTrailingWhitespaceInsideFragment);\n  \t\t}\n\n  \t\t// Clean up event handlers\n  \t\tif (item.v) {\n  \t\t\tfor (key in item.v) {\n  \t\t\t\tif (item.v.hasOwnProperty(key)) {\n  \t\t\t\t\t// clean up names\n  \t\t\t\t\tif (isArray(item.v[key].n)) {\n  \t\t\t\t\t\tcleanup(item.v[key].n, stripComments, preserveWhitespace, removeLeadingWhitespaceInsideFragment, removeTrailingWhitespaceInsideFragment);\n  \t\t\t\t\t}\n\n  \t\t\t\t\t// clean up params\n  \t\t\t\t\tif (isArray(item.v[key].d)) {\n  \t\t\t\t\t\tcleanup(item.v[key].d, stripComments, preserveWhitespace, removeLeadingWhitespaceInsideFragment, removeTrailingWhitespaceInsideFragment);\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \t// final pass - fuse text nodes together\n  \ti = items.length;\n  \twhile (i--) {\n  \t\tif (typeof items[i] === 'string') {\n  \t\t\tif (typeof items[i + 1] === 'string') {\n  \t\t\t\titems[i] = items[i] + items[i + 1];\n  \t\t\t\titems.splice(i + 1, 1);\n  \t\t\t}\n\n  \t\t\tif (!preserveWhitespace) {\n  \t\t\t\titems[i] = items[i].replace(contiguousWhitespace, ' ');\n  \t\t\t}\n\n  \t\t\tif (items[i] === '') {\n  \t\t\t\titems.splice(i, 1);\n  \t\t\t}\n  \t\t}\n  \t}\n  }\n\n  var delimiterChangePattern = /^[^\\s=]+/;\n  var whitespacePattern = /^\\s+/;\n  function readDelimiterChange(parser) {\n  \tvar start, opening, closing;\n\n  \tif (!parser.matchString('=')) {\n  \t\treturn null;\n  \t}\n\n  \tstart = parser.pos;\n\n  \t// allow whitespace before new opening delimiter\n  \tparser.allowWhitespace();\n\n  \topening = parser.matchPattern(delimiterChangePattern);\n  \tif (!opening) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \t// allow whitespace (in fact, it's necessary...)\n  \tif (!parser.matchPattern(whitespacePattern)) {\n  \t\treturn null;\n  \t}\n\n  \tclosing = parser.matchPattern(delimiterChangePattern);\n  \tif (!closing) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \t// allow whitespace before closing '='\n  \tparser.allowWhitespace();\n\n  \tif (!parser.matchString('=')) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \treturn [opening, closing];\n  }\n\n  var delimiterChangeToken = { t: DELIMCHANGE, exclude: true };\n  function readMustache(parser) {\n  \tvar mustache, i;\n\n  \t// If we're inside a <script> or <style> tag, and we're not\n  \t// interpolating, bug out\n  \tif (parser.interpolate[parser.inside] === false) {\n  \t\treturn null;\n  \t}\n\n  \tfor (i = 0; i < parser.tags.length; i += 1) {\n  \t\tif (mustache = readMustacheOfType(parser, parser.tags[i])) {\n  \t\t\treturn mustache;\n  \t\t}\n  \t}\n  }\n\n  function readMustacheOfType(parser, tag) {\n  \tvar start, mustache, reader, i;\n\n  \tstart = parser.pos;\n\n  \tif (parser.matchString('\\\\' + tag.open)) {\n  \t\tif (start === 0 || parser.str[start - 1] !== '\\\\') {\n  \t\t\treturn tag.open;\n  \t\t}\n  \t} else if (!parser.matchString(tag.open)) {\n  \t\treturn null;\n  \t}\n\n  \t// delimiter change?\n  \tif (mustache = readDelimiterChange(parser)) {\n  \t\t// find closing delimiter or abort...\n  \t\tif (!parser.matchString(tag.close)) {\n  \t\t\treturn null;\n  \t\t}\n\n  \t\t// ...then make the switch\n  \t\ttag.open = mustache[0];\n  \t\ttag.close = mustache[1];\n  \t\tparser.sortMustacheTags();\n\n  \t\treturn delimiterChangeToken;\n  \t}\n\n  \tparser.allowWhitespace();\n\n  \t// illegal section closer\n  \tif (parser.matchString('/')) {\n  \t\tparser.pos -= 1;\n  \t\tvar rewind = parser.pos;\n  \t\tif (!readNumberLiteral(parser)) {\n  \t\t\tparser.pos = rewind - tag.close.length;\n  \t\t\tparser.error('Attempted to close a section that wasn\\'t open');\n  \t\t} else {\n  \t\t\tparser.pos = rewind;\n  \t\t}\n  \t}\n\n  \tfor (i = 0; i < tag.readers.length; i += 1) {\n  \t\treader = tag.readers[i];\n\n  \t\tif (mustache = reader(parser, tag)) {\n  \t\t\tif (tag.isStatic) {\n  \t\t\t\tmustache.s = true; // TODO make this `1` instead - more compact\n  \t\t\t}\n\n  \t\t\tif (parser.includeLinePositions) {\n  \t\t\t\tmustache.p = parser.getLinePos(start);\n  \t\t\t}\n\n  \t\t\treturn mustache;\n  \t\t}\n  \t}\n\n  \tparser.pos = start;\n  \treturn null;\n  }\n\n  var closingTagPattern = /^([a-zA-Z]{1,}:?[a-zA-Z0-9\\-]*)\\s*\\>/;\n  function readClosingTag(parser) {\n  \tvar start, tag;\n\n  \tstart = parser.pos;\n\n  \t// are we looking at a closing tag?\n  \tif (!parser.matchString('</')) {\n  \t\treturn null;\n  \t}\n\n  \tif (tag = parser.matchPattern(closingTagPattern)) {\n  \t\tif (parser.inside && tag !== parser.inside) {\n  \t\t\tparser.pos = start;\n  \t\t\treturn null;\n  \t\t}\n\n  \t\treturn {\n  \t\t\tt: CLOSING_TAG,\n  \t\t\te: tag\n  \t\t};\n  \t}\n\n  \t// We have an illegal closing tag, report it\n  \tparser.pos -= 2;\n  \tparser.error('Illegal closing tag');\n  }\n\n  var attributeNamePattern = /^[^\\s\"'>\\/=]+/;\n  var unquotedAttributeValueTextPattern = /^[^\\s\"'=<>`]+/;\n  function readAttribute(parser) {\n  \tvar attr, name, value;\n\n  \tparser.allowWhitespace();\n\n  \tname = parser.matchPattern(attributeNamePattern);\n  \tif (!name) {\n  \t\treturn null;\n  \t}\n\n  \tattr = { name: name };\n\n  \tvalue = readAttributeValue(parser);\n  \tif (value != null) {\n  \t\t// not null/undefined\n  \t\tattr.value = value;\n  \t}\n\n  \treturn attr;\n  }\n\n  function readAttributeValue(parser) {\n  \tvar start, valueStart, startDepth, value;\n\n  \tstart = parser.pos;\n\n  \t// next character must be `=`, `/`, `>` or whitespace\n  \tif (!/[=\\/>\\s]/.test(parser.nextChar())) {\n  \t\tparser.error('Expected `=`, `/`, `>` or whitespace');\n  \t}\n\n  \tparser.allowWhitespace();\n\n  \tif (!parser.matchString('=')) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \tparser.allowWhitespace();\n\n  \tvalueStart = parser.pos;\n  \tstartDepth = parser.sectionDepth;\n\n  \tvalue = readQuotedAttributeValue(parser, '\\'') || readQuotedAttributeValue(parser, '\"') || readUnquotedAttributeValue(parser);\n\n  \tif (value === null) {\n  \t\tparser.error('Expected valid attribute value');\n  \t}\n\n  \tif (parser.sectionDepth !== startDepth) {\n  \t\tparser.pos = valueStart;\n  \t\tparser.error('An attribute value must contain as many opening section tags as closing section tags');\n  \t}\n\n  \tif (!value.length) {\n  \t\treturn '';\n  \t}\n\n  \tif (value.length === 1 && typeof value[0] === 'string') {\n  \t\treturn decodeCharacterReferences(value[0]);\n  \t}\n\n  \treturn value;\n  }\n\n  function readUnquotedAttributeValueToken(parser) {\n  \tvar start, text, haystack, needles, index;\n\n  \tstart = parser.pos;\n\n  \ttext = parser.matchPattern(unquotedAttributeValueTextPattern);\n\n  \tif (!text) {\n  \t\treturn null;\n  \t}\n\n  \thaystack = text;\n  \tneedles = parser.tags.map(function (t) {\n  \t\treturn t.open;\n  \t}); // TODO refactor... we do this in readText.js as well\n\n  \tif ((index = getLowestIndex(haystack, needles)) !== -1) {\n  \t\ttext = text.substr(0, index);\n  \t\tparser.pos = start + text.length;\n  \t}\n\n  \treturn text;\n  }\n\n  function readUnquotedAttributeValue(parser) {\n  \tvar tokens, token;\n\n  \tparser.inAttribute = true;\n\n  \ttokens = [];\n\n  \ttoken = readMustache(parser) || readUnquotedAttributeValueToken(parser);\n  \twhile (token !== null) {\n  \t\ttokens.push(token);\n  \t\ttoken = readMustache(parser) || readUnquotedAttributeValueToken(parser);\n  \t}\n\n  \tif (!tokens.length) {\n  \t\treturn null;\n  \t}\n\n  \tparser.inAttribute = false;\n  \treturn tokens;\n  }\n\n  function readQuotedAttributeValue(parser, quoteMark) {\n  \tvar start, tokens, token;\n\n  \tstart = parser.pos;\n\n  \tif (!parser.matchString(quoteMark)) {\n  \t\treturn null;\n  \t}\n\n  \tparser.inAttribute = quoteMark;\n\n  \ttokens = [];\n\n  \ttoken = readMustache(parser) || readQuotedStringToken(parser, quoteMark);\n  \twhile (token !== null) {\n  \t\ttokens.push(token);\n  \t\ttoken = readMustache(parser) || readQuotedStringToken(parser, quoteMark);\n  \t}\n\n  \tif (!parser.matchString(quoteMark)) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \tparser.inAttribute = false;\n\n  \treturn tokens;\n  }\n\n  function readQuotedStringToken(parser, quoteMark) {\n  \tvar haystack = parser.remaining();\n\n  \tvar needles = parser.tags.map(function (t) {\n  \t\treturn t.open;\n  \t}); // TODO refactor... we do this in readText.js as well\n  \tneedles.push(quoteMark);\n\n  \tvar index = getLowestIndex(haystack, needles);\n\n  \tif (index === -1) {\n  \t\tparser.error('Quoted attribute value must have a closing quote');\n  \t}\n\n  \tif (!index) {\n  \t\treturn null;\n  \t}\n\n  \tparser.pos += index;\n  \treturn haystack.substr(0, index);\n  }\n\n  var Parser;\n  var ParseError;\n  var leadingWhitespace = /^\\s+/;\n  ParseError = function (message) {\n  \tthis.name = 'ParseError';\n  \tthis.message = message;\n  \ttry {\n  \t\tthrow new Error(message);\n  \t} catch (e) {\n  \t\tthis.stack = e.stack;\n  \t}\n  };\n\n  ParseError.prototype = Error.prototype;\n\n  Parser = function (str, options) {\n  \tvar items,\n  \t    item,\n  \t    lineStart = 0;\n\n  \tthis.str = str;\n  \tthis.options = options || {};\n  \tthis.pos = 0;\n\n  \tthis.lines = this.str.split('\\n');\n  \tthis.lineEnds = this.lines.map(function (line) {\n  \t\tvar lineEnd = lineStart + line.length + 1; // +1 for the newline\n\n  \t\tlineStart = lineEnd;\n  \t\treturn lineEnd;\n  \t}, 0);\n\n  \t// Custom init logic\n  \tif (this.init) this.init(str, options);\n\n  \titems = [];\n\n  \twhile (this.pos < this.str.length && (item = this.read())) {\n  \t\titems.push(item);\n  \t}\n\n  \tthis.leftover = this.remaining();\n  \tthis.result = this.postProcess ? this.postProcess(items, options) : items;\n  };\n\n  Parser.prototype = {\n  \tread: function (converters) {\n  \t\tvar pos, i, len, item;\n\n  \t\tif (!converters) converters = this.converters;\n\n  \t\tpos = this.pos;\n\n  \t\tlen = converters.length;\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tthis.pos = pos; // reset for each attempt\n\n  \t\t\tif (item = converters[i](this)) {\n  \t\t\t\treturn item;\n  \t\t\t}\n  \t\t}\n\n  \t\treturn null;\n  \t},\n\n  \tgetLinePos: function (char) {\n  \t\tvar lineNum = 0,\n  \t\t    lineStart = 0,\n  \t\t    columnNum;\n\n  \t\twhile (char >= this.lineEnds[lineNum]) {\n  \t\t\tlineStart = this.lineEnds[lineNum];\n  \t\t\tlineNum += 1;\n  \t\t}\n\n  \t\tcolumnNum = char - lineStart;\n  \t\treturn [lineNum + 1, columnNum + 1, char]; // line/col should be one-based, not zero-based!\n  \t},\n\n  \terror: function (message) {\n  \t\tvar pos = this.getLinePos(this.pos);\n  \t\tvar lineNum = pos[0];\n  \t\tvar columnNum = pos[1];\n\n  \t\tvar line = this.lines[pos[0] - 1];\n  \t\tvar numTabs = 0;\n  \t\tvar annotation = line.replace(/\\t/g, function (match, char) {\n  \t\t\tif (char < pos[1]) {\n  \t\t\t\tnumTabs += 1;\n  \t\t\t}\n\n  \t\t\treturn '  ';\n  \t\t}) + '\\n' + new Array(pos[1] + numTabs).join(' ') + '^----';\n\n  \t\tvar error = new ParseError(message + ' at line ' + lineNum + ' character ' + columnNum + ':\\n' + annotation);\n\n  \t\terror.line = pos[0];\n  \t\terror.character = pos[1];\n  \t\terror.shortMessage = message;\n\n  \t\tthrow error;\n  \t},\n\n  \tmatchString: function (string) {\n  \t\tif (this.str.substr(this.pos, string.length) === string) {\n  \t\t\tthis.pos += string.length;\n  \t\t\treturn string;\n  \t\t}\n  \t},\n\n  \tmatchPattern: function (pattern) {\n  \t\tvar match;\n\n  \t\tif (match = pattern.exec(this.remaining())) {\n  \t\t\tthis.pos += match[0].length;\n  \t\t\treturn match[1] || match[0];\n  \t\t}\n  \t},\n\n  \tallowWhitespace: function () {\n  \t\tthis.matchPattern(leadingWhitespace);\n  \t},\n\n  \tremaining: function () {\n  \t\treturn this.str.substring(this.pos);\n  \t},\n\n  \tnextChar: function () {\n  \t\treturn this.str.charAt(this.pos);\n  \t}\n  };\n\n  Parser.extend = function (proto) {\n  \tvar Parent = this,\n  \t    Child,\n  \t    key;\n\n  \tChild = function (str, options) {\n  \t\tParser.call(this, str, options);\n  \t};\n\n  \tChild.prototype = create(Parent.prototype);\n\n  \tfor (key in proto) {\n  \t\tif (hasOwn.call(proto, key)) {\n  \t\t\tChild.prototype[key] = proto[key];\n  \t\t}\n  \t}\n\n  \tChild.extend = Parser.extend;\n  \treturn Child;\n  };\n\n  var Parser$1 = Parser;\n\n  // simple JSON parser, without the restrictions of JSON parse\n  // (i.e. having to double-quote keys).\n  //\n  // If passed a hash of values as the second argument, ${placeholders}\n  // will be replaced with those values\n\n  var specials = {\n  \t'true': true,\n  \t'false': false,\n  \t'null': null,\n  \tundefined: undefined\n  };\n\n  var specialsPattern = new RegExp('^(?:' + Object.keys(specials).join('|') + ')');\n  var numberPattern = /^(?:[+-]?)(?:(?:(?:0|[1-9]\\d*)?\\.\\d+)|(?:(?:0|[1-9]\\d*)\\.)|(?:0|[1-9]\\d*))(?:[eE][+-]?\\d+)?/;\n  var placeholderPattern = /\\$\\{([^\\}]+)\\}/g;\n  var placeholderAtStartPattern = /^\\$\\{([^\\}]+)\\}/;\n  var onlyWhitespace = /^\\s*$/;\n\n  var JsonParser = Parser$1.extend({\n  \tinit: function (str, options) {\n  \t\tthis.values = options.values;\n  \t\tthis.allowWhitespace();\n  \t},\n\n  \tpostProcess: function (result) {\n  \t\tif (result.length !== 1 || !onlyWhitespace.test(this.leftover)) {\n  \t\t\treturn null;\n  \t\t}\n\n  \t\treturn { value: result[0].v };\n  \t},\n\n  \tconverters: [function getPlaceholder(parser) {\n  \t\tif (!parser.values) return null;\n\n  \t\tvar placeholder = parser.matchPattern(placeholderAtStartPattern);\n\n  \t\tif (placeholder && parser.values.hasOwnProperty(placeholder)) {\n  \t\t\treturn { v: parser.values[placeholder] };\n  \t\t}\n  \t}, function getSpecial(parser) {\n  \t\tvar special = parser.matchPattern(specialsPattern);\n  \t\tif (special) return { v: specials[special] };\n  \t}, function getNumber(parser) {\n  \t\tvar number = parser.matchPattern(numberPattern);\n  \t\tif (number) return { v: +number };\n  \t}, function getString(parser) {\n  \t\tvar stringLiteral = readStringLiteral(parser);\n  \t\tvar values = parser.values;\n\n  \t\tif (stringLiteral && values) {\n  \t\t\treturn {\n  \t\t\t\tv: stringLiteral.v.replace(placeholderPattern, function (match, $1) {\n  \t\t\t\t\treturn $1 in values ? values[$1] : $1;\n  \t\t\t\t})\n  \t\t\t};\n  \t\t}\n\n  \t\treturn stringLiteral;\n  \t}, function getObject(parser) {\n  \t\tif (!parser.matchString('{')) return null;\n\n  \t\tvar result = {};\n\n  \t\tparser.allowWhitespace();\n\n  \t\tif (parser.matchString('}')) {\n  \t\t\treturn { v: result };\n  \t\t}\n\n  \t\tvar pair = undefined;\n  \t\twhile (pair = getKeyValuePair(parser)) {\n  \t\t\tresult[pair.key] = pair.value;\n\n  \t\t\tparser.allowWhitespace();\n\n  \t\t\tif (parser.matchString('}')) {\n  \t\t\t\treturn { v: result };\n  \t\t\t}\n\n  \t\t\tif (!parser.matchString(',')) {\n  \t\t\t\treturn null;\n  \t\t\t}\n  \t\t}\n\n  \t\treturn null;\n  \t}, function getArray(parser) {\n  \t\tif (!parser.matchString('[')) return null;\n\n  \t\tvar result = [];\n\n  \t\tparser.allowWhitespace();\n\n  \t\tif (parser.matchString(']')) {\n  \t\t\treturn { v: result };\n  \t\t}\n\n  \t\tvar valueToken = undefined;\n  \t\twhile (valueToken = parser.read()) {\n  \t\t\tresult.push(valueToken.v);\n\n  \t\t\tparser.allowWhitespace();\n\n  \t\t\tif (parser.matchString(']')) {\n  \t\t\t\treturn { v: result };\n  \t\t\t}\n\n  \t\t\tif (!parser.matchString(',')) {\n  \t\t\t\treturn null;\n  \t\t\t}\n\n  \t\t\tparser.allowWhitespace();\n  \t\t}\n\n  \t\treturn null;\n  \t}]\n  });\n\n  function getKeyValuePair(parser) {\n  \tparser.allowWhitespace();\n\n  \tvar key = readKey(parser);\n\n  \tif (!key) return null;\n\n  \tvar pair = { key: key };\n\n  \tparser.allowWhitespace();\n  \tif (!parser.matchString(':')) {\n  \t\treturn null;\n  \t}\n  \tparser.allowWhitespace();\n\n  \tvar valueToken = parser.read();\n\n  \tif (!valueToken) return null;\n\n  \tpair.value = valueToken.v;\n  \treturn pair;\n  }\n\n  function parseJSON (str, values) {\n  \tvar parser = new JsonParser(str, { values: values });\n  \treturn parser.result;\n  }\n\n  var methodCallPattern = /^([a-zA-Z_$][a-zA-Z_$0-9]*)\\(/;\n  var methodCallExcessPattern = /\\)\\s*$/;\n  var ExpressionParser;\n  ExpressionParser = Parser$1.extend({\n  \tconverters: [readExpression]\n  });\n\n  // TODO clean this up, it's shocking\n\n  function processDirective(tokens, parentParser) {\n  \tvar result, match, parser, args, token, colonIndex, directiveName, directiveArgs, parsed;\n\n  \tif (typeof tokens === 'string') {\n  \t\tif (match = methodCallPattern.exec(tokens)) {\n  \t\t\tvar end = tokens.lastIndexOf(')');\n\n  \t\t\t// check for invalid method calls\n  \t\t\tif (!methodCallExcessPattern.test(tokens)) {\n  \t\t\t\tparentParser.error('Invalid input after method call expression \\'' + tokens.slice(end + 1) + '\\'');\n  \t\t\t}\n\n  \t\t\tresult = { m: match[1] };\n  \t\t\tvar sliced = tokens.slice(result.m.length + 1, end);\n\n  \t\t\tif (sliced === '...arguments') {\n  \t\t\t\t// TODO: what the heck should this be???\n  \t\t\t\t// maybe ExpressionParser should understand ES6???\n  \t\t\t\tresult.g = true;\n  \t\t\t} else {\n  \t\t\t\targs = '[' + sliced + ']';\n  \t\t\t\tparser = new ExpressionParser(args);\n  \t\t\t\tresult.a = flattenExpression(parser.result[0]);\n  \t\t\t}\n\n  \t\t\treturn result;\n  \t\t}\n\n  \t\tif (tokens.indexOf(':') === -1) {\n  \t\t\treturn tokens.trim();\n  \t\t}\n\n  \t\ttokens = [tokens];\n  \t}\n\n  \tresult = {};\n\n  \tdirectiveName = [];\n  \tdirectiveArgs = [];\n\n  \tif (tokens) {\n  \t\twhile (tokens.length) {\n  \t\t\ttoken = tokens.shift();\n\n  \t\t\tif (typeof token === 'string') {\n  \t\t\t\tcolonIndex = token.indexOf(':');\n\n  \t\t\t\tif (colonIndex === -1) {\n  \t\t\t\t\tdirectiveName.push(token);\n  \t\t\t\t} else {\n  \t\t\t\t\t// is the colon the first character?\n  \t\t\t\t\tif (colonIndex) {\n  \t\t\t\t\t\t// no\n  \t\t\t\t\t\tdirectiveName.push(token.substr(0, colonIndex));\n  \t\t\t\t\t}\n\n  \t\t\t\t\t// if there is anything after the colon in this token, treat\n  \t\t\t\t\t// it as the first token of the directiveArgs fragment\n  \t\t\t\t\tif (token.length > colonIndex + 1) {\n  \t\t\t\t\t\tdirectiveArgs[0] = token.substring(colonIndex + 1);\n  \t\t\t\t\t}\n\n  \t\t\t\t\tbreak;\n  \t\t\t\t}\n  \t\t\t} else {\n  \t\t\t\tdirectiveName.push(token);\n  \t\t\t}\n  \t\t}\n\n  \t\tdirectiveArgs = directiveArgs.concat(tokens);\n  \t}\n\n  \tif (!directiveName.length) {\n  \t\tresult = '';\n  \t} else if (directiveArgs.length || typeof directiveName !== 'string') {\n  \t\tresult = {\n  \t\t\t// TODO is this really necessary? just use the array\n  \t\t\tn: directiveName.length === 1 && typeof directiveName[0] === 'string' ? directiveName[0] : directiveName\n  \t\t};\n\n  \t\tif (directiveArgs.length === 1 && typeof directiveArgs[0] === 'string') {\n  \t\t\tparsed = parseJSON('[' + directiveArgs[0] + ']');\n  \t\t\tresult.a = parsed ? parsed.value : [directiveArgs[0].trim()];\n  \t\t} else {\n  \t\t\tresult.d = directiveArgs;\n  \t\t}\n  \t} else {\n  \t\tresult = directiveName;\n  \t}\n\n  \treturn result;\n  }\n\n  var tagNamePattern = /^[a-zA-Z]{1,}:?[a-zA-Z0-9\\-]*/;\n  var validTagNameFollower = /^[\\s\\n\\/>]/;\n  var onPattern = /^on/;\n  var proxyEventPattern = /^on-([a-zA-Z\\\\*\\\\.$_][a-zA-Z\\\\*\\\\.$_0-9\\-]+)$/;\n  var reservedEventNames = /^(?:change|reset|teardown|update|construct|config|init|render|unrender|detach|insert)$/;\n  var directives = { 'intro-outro': 't0', intro: 't1', outro: 't2', decorator: 'o' };\n  var exclude = { exclude: true };\n  var disallowedContents;\n  // based on http://developers.whatwg.org/syntax.html#syntax-tag-omission\n  disallowedContents = {\n  \tli: ['li'],\n  \tdt: ['dt', 'dd'],\n  \tdd: ['dt', 'dd'],\n  \tp: 'address article aside blockquote div dl fieldset footer form h1 h2 h3 h4 h5 h6 header hgroup hr main menu nav ol p pre section table ul'.split(' '),\n  \trt: ['rt', 'rp'],\n  \trp: ['rt', 'rp'],\n  \toptgroup: ['optgroup'],\n  \toption: ['option', 'optgroup'],\n  \tthead: ['tbody', 'tfoot'],\n  \ttbody: ['tbody', 'tfoot'],\n  \ttfoot: ['tbody'],\n  \ttr: ['tr', 'tbody'],\n  \ttd: ['td', 'th', 'tr'],\n  \tth: ['td', 'th', 'tr']\n  };\n\n  function readElement(parser) {\n  \tvar start, element, directiveName, match, addProxyEvent, attribute, directive, selfClosing, children, partials, hasPartials, child, closed, pos, remaining, closingTag;\n\n  \tstart = parser.pos;\n\n  \tif (parser.inside || parser.inAttribute) {\n  \t\treturn null;\n  \t}\n\n  \tif (!parser.matchString('<')) {\n  \t\treturn null;\n  \t}\n\n  \t// if this is a closing tag, abort straight away\n  \tif (parser.nextChar() === '/') {\n  \t\treturn null;\n  \t}\n\n  \telement = {};\n  \tif (parser.includeLinePositions) {\n  \t\telement.p = parser.getLinePos(start);\n  \t}\n\n  \tif (parser.matchString('!')) {\n  \t\telement.t = DOCTYPE;\n  \t\tif (!parser.matchPattern(/^doctype/i)) {\n  \t\t\tparser.error('Expected DOCTYPE declaration');\n  \t\t}\n\n  \t\telement.a = parser.matchPattern(/^(.+?)>/);\n  \t\treturn element;\n  \t}\n\n  \telement.t = ELEMENT;\n\n  \t// element name\n  \telement.e = parser.matchPattern(tagNamePattern);\n  \tif (!element.e) {\n  \t\treturn null;\n  \t}\n\n  \t// next character must be whitespace, closing solidus or '>'\n  \tif (!validTagNameFollower.test(parser.nextChar())) {\n  \t\tparser.error('Illegal tag name');\n  \t}\n\n  \taddProxyEvent = function (name, directive) {\n  \t\tvar directiveName = directive.n || directive;\n\n  \t\tif (reservedEventNames.test(directiveName)) {\n  \t\t\tparser.pos -= directiveName.length;\n  \t\t\tparser.error('Cannot use reserved event names (change, reset, teardown, update, construct, config, init, render, unrender, detach, insert)');\n  \t\t}\n\n  \t\telement.v[name] = directive;\n  \t};\n\n  \tparser.allowWhitespace();\n\n  \t// directives and attributes\n  \twhile (attribute = readMustache(parser) || readAttribute(parser)) {\n  \t\t// regular attributes\n  \t\tif (attribute.name) {\n  \t\t\t// intro, outro, decorator\n  \t\t\tif (directiveName = directives[attribute.name]) {\n  \t\t\t\telement[directiveName] = processDirective(attribute.value, parser);\n  \t\t\t}\n\n  \t\t\t// on-click etc\n  \t\t\telse if (match = proxyEventPattern.exec(attribute.name)) {\n  \t\t\t\t\tif (!element.v) element.v = {};\n  \t\t\t\t\tdirective = processDirective(attribute.value, parser);\n  \t\t\t\t\taddProxyEvent(match[1], directive);\n  \t\t\t\t} else {\n  \t\t\t\t\tif (!parser.sanitizeEventAttributes || !onPattern.test(attribute.name)) {\n  \t\t\t\t\t\tif (!element.a) element.a = {};\n  \t\t\t\t\t\telement.a[attribute.name] = attribute.value || (attribute.value === '' ? '' : 0);\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t}\n\n  \t\t// {{#if foo}}class='foo'{{/if}}\n  \t\telse {\n  \t\t\t\tif (!element.m) element.m = [];\n  \t\t\t\telement.m.push(attribute);\n  \t\t\t}\n\n  \t\tparser.allowWhitespace();\n  \t}\n\n  \t// allow whitespace before closing solidus\n  \tparser.allowWhitespace();\n\n  \t// self-closing solidus?\n  \tif (parser.matchString('/')) {\n  \t\tselfClosing = true;\n  \t}\n\n  \t// closing angle bracket\n  \tif (!parser.matchString('>')) {\n  \t\treturn null;\n  \t}\n\n  \tvar lowerCaseName = element.e.toLowerCase();\n  \tvar preserveWhitespace = parser.preserveWhitespace;\n\n  \tif (!selfClosing && !voidElementNames.test(element.e)) {\n  \t\tparser.elementStack.push(lowerCaseName);\n\n  \t\t// Special case - if we open a script element, further tags should\n  \t\t// be ignored unless they're a closing script element\n  \t\tif (lowerCaseName === 'script' || lowerCaseName === 'style' || lowerCaseName === 'textarea') {\n  \t\t\tparser.inside = lowerCaseName;\n  \t\t}\n\n  \t\tchildren = [];\n  \t\tpartials = create(null);\n\n  \t\tdo {\n  \t\t\tpos = parser.pos;\n  \t\t\tremaining = parser.remaining();\n\n  \t\t\t// if for example we're in an <li> element, and we see another\n  \t\t\t// <li> tag, close the first so they become siblings\n  \t\t\tif (!canContain(lowerCaseName, remaining)) {\n  \t\t\t\tclosed = true;\n  \t\t\t}\n\n  \t\t\t// closing tag\n  \t\t\telse if (closingTag = readClosingTag(parser)) {\n  \t\t\t\t\tclosed = true;\n\n  \t\t\t\t\tvar closingTagName = closingTag.e.toLowerCase();\n\n  \t\t\t\t\t// if this *isn't* the closing tag for the current element...\n  \t\t\t\t\tif (closingTagName !== lowerCaseName) {\n  \t\t\t\t\t\t// rewind parser\n  \t\t\t\t\t\tparser.pos = pos;\n\n  \t\t\t\t\t\t// if it doesn't close a parent tag, error\n  \t\t\t\t\t\tif (! ~parser.elementStack.indexOf(closingTagName)) {\n  \t\t\t\t\t\t\tvar errorMessage = 'Unexpected closing tag';\n\n  \t\t\t\t\t\t\t// add additional help for void elements, since component names\n  \t\t\t\t\t\t\t// might clash with them\n  \t\t\t\t\t\t\tif (voidElementNames.test(closingTagName)) {\n  \t\t\t\t\t\t\t\terrorMessage += ' (<' + closingTagName + '> is a void element - it cannot contain children)';\n  \t\t\t\t\t\t\t}\n\n  \t\t\t\t\t\t\tparser.error(errorMessage);\n  \t\t\t\t\t\t}\n  \t\t\t\t\t}\n  \t\t\t\t}\n\n  \t\t\t\t// implicit close by closing section tag. TODO clean this up\n  \t\t\t\telse if (child = readClosing(parser, { open: parser.standardDelimiters[0], close: parser.standardDelimiters[1] })) {\n  \t\t\t\t\t\tclosed = true;\n  \t\t\t\t\t\tparser.pos = pos;\n  \t\t\t\t\t} else {\n  \t\t\t\t\t\tif (child = parser.read(PARTIAL_READERS)) {\n  \t\t\t\t\t\t\tif (partials[child.n]) {\n  \t\t\t\t\t\t\t\tparser.pos = pos;\n  \t\t\t\t\t\t\t\tparser.error('Duplicate partial definition');\n  \t\t\t\t\t\t\t}\n\n  \t\t\t\t\t\t\tcleanup(child.f, parser.stripComments, preserveWhitespace, !preserveWhitespace, !preserveWhitespace);\n\n  \t\t\t\t\t\t\tpartials[child.n] = child.f;\n  \t\t\t\t\t\t\thasPartials = true;\n  \t\t\t\t\t\t} else {\n  \t\t\t\t\t\t\tif (child = parser.read(READERS)) {\n  \t\t\t\t\t\t\t\tchildren.push(child);\n  \t\t\t\t\t\t\t} else {\n  \t\t\t\t\t\t\t\tclosed = true;\n  \t\t\t\t\t\t\t}\n  \t\t\t\t\t\t}\n  \t\t\t\t\t}\n  \t\t} while (!closed);\n\n  \t\tif (children.length) {\n  \t\t\telement.f = children;\n  \t\t}\n\n  \t\tif (hasPartials) {\n  \t\t\telement.p = partials;\n  \t\t}\n\n  \t\tparser.elementStack.pop();\n  \t}\n\n  \tparser.inside = null;\n\n  \tif (parser.sanitizeElements && parser.sanitizeElements.indexOf(lowerCaseName) !== -1) {\n  \t\treturn exclude;\n  \t}\n\n  \treturn element;\n  }\n\n  function canContain(name, remaining) {\n  \tvar match, disallowed;\n\n  \tmatch = /^<([a-zA-Z][a-zA-Z0-9]*)/.exec(remaining);\n  \tdisallowed = disallowedContents[name];\n\n  \tif (!match || !disallowed) {\n  \t\treturn true;\n  \t}\n\n  \treturn ! ~disallowed.indexOf(match[1].toLowerCase());\n  }\n\n  var OPEN_COMMENT = '<!--';\n  var CLOSE_COMMENT = '-->';\n  function readHtmlComment(parser) {\n  \tvar start, content, remaining, endIndex, comment;\n\n  \tstart = parser.pos;\n\n  \tif (!parser.matchString(OPEN_COMMENT)) {\n  \t\treturn null;\n  \t}\n\n  \tremaining = parser.remaining();\n  \tendIndex = remaining.indexOf(CLOSE_COMMENT);\n\n  \tif (endIndex === -1) {\n  \t\tparser.error('Illegal HTML - expected closing comment sequence (\\'-->\\')');\n  \t}\n\n  \tcontent = remaining.substr(0, endIndex);\n  \tparser.pos += endIndex + 3;\n\n  \tcomment = {\n  \t\tt: COMMENT,\n  \t\tc: content\n  \t};\n\n  \tif (parser.includeLinePositions) {\n  \t\tcomment.p = parser.getLinePos(start);\n  \t}\n\n  \treturn comment;\n  }\n\n  var partialDefinitionSectionPattern = /^#\\s*partial\\s+/;\n  function readPartialDefinitionSection(parser) {\n  \tvar start, name, content, child, closed;\n\n  \tstart = parser.pos;\n\n  \tvar delimiters = parser.standardDelimiters;\n\n  \tif (!parser.matchString(delimiters[0])) {\n  \t\treturn null;\n  \t}\n\n  \tif (!parser.matchPattern(partialDefinitionSectionPattern)) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \tname = parser.matchPattern(/^[a-zA-Z_$][a-zA-Z_$0-9\\-\\/]*/);\n\n  \tif (!name) {\n  \t\tparser.error('expected legal partial name');\n  \t}\n\n  \tif (!parser.matchString(delimiters[1])) {\n  \t\tparser.error('Expected closing delimiter \\'' + delimiters[1] + '\\'');\n  \t}\n\n  \tcontent = [];\n\n  \tdo {\n  \t\t// TODO clean this up\n  \t\tif (child = readClosing(parser, { open: parser.standardDelimiters[0], close: parser.standardDelimiters[1] })) {\n  \t\t\tif (!child.r === 'partial') {\n  \t\t\t\tparser.error('Expected ' + delimiters[0] + '/partial' + delimiters[1]);\n  \t\t\t}\n\n  \t\t\tclosed = true;\n  \t\t} else {\n  \t\t\tchild = parser.read(READERS);\n\n  \t\t\tif (!child) {\n  \t\t\t\tparser.error('Expected ' + delimiters[0] + '/partial' + delimiters[1]);\n  \t\t\t}\n\n  \t\t\tcontent.push(child);\n  \t\t}\n  \t} while (!closed);\n\n  \treturn {\n  \t\tt: INLINE_PARTIAL,\n  \t\tn: name,\n  \t\tf: content\n  \t};\n  }\n\n  var pattern$1 = /[-/\\\\^$*+?.()|[\\]{}]/g;\n  function escapeRegExp(str) {\n  \treturn str.replace(pattern$1, '\\\\$&');\n  }\n\n  var startPattern = /^<!--\\s*/;\n  var namePattern = /s*>\\s*([a-zA-Z_$][-a-zA-Z_$0-9]*)\\s*/;\n  var finishPattern = /\\s*-->/;\n\n  function readPartialDefinitionComment(parser) {\n  \tvar start = parser.pos;\n  \tvar open = parser.standardDelimiters[0];\n  \tvar close = parser.standardDelimiters[1];\n\n  \tif (!parser.matchPattern(startPattern) || !parser.matchString(open)) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \tvar name = parser.matchPattern(namePattern);\n\n  \twarnOnceIfDebug('Inline partial comments are deprecated.\\nUse this...\\n  {{#partial ' + name + '}} ... {{/partial}}\\n\\n...instead of this:\\n  <!-- {{>' + name + '}} --> ... <!-- {{/' + name + '}} -->\\'');\n\n  \t// make sure the rest of the comment is in the correct place\n  \tif (!parser.matchString(close) || !parser.matchPattern(finishPattern)) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \tvar content = [];\n  \tvar closed = undefined;\n\n  \tvar endPattern = new RegExp('^<!--\\\\s*' + escapeRegExp(open) + '\\\\s*\\\\/\\\\s*' + name + '\\\\s*' + escapeRegExp(close) + '\\\\s*-->');\n\n  \tdo {\n  \t\tif (parser.matchPattern(endPattern)) {\n  \t\t\tclosed = true;\n  \t\t} else {\n  \t\t\tvar child = parser.read(READERS);\n  \t\t\tif (!child) {\n  \t\t\t\tparser.error('expected closing comment (\\'<!-- ' + open + '/' + name + close + ' -->\\')');\n  \t\t\t}\n\n  \t\t\tcontent.push(child);\n  \t\t}\n  \t} while (!closed);\n\n  \treturn {\n  \t\tt: INLINE_PARTIAL,\n  \t\tf: content,\n  \t\tn: name\n  \t};\n  }\n\n  function readTemplate(parser) {\n  \tvar fragment = [];\n  \tvar partials = create(null);\n  \tvar hasPartials = false;\n\n  \tvar preserveWhitespace = parser.preserveWhitespace;\n\n  \twhile (parser.pos < parser.str.length) {\n  \t\tvar pos = parser.pos,\n  \t\t    item = undefined,\n  \t\t    partial = undefined;\n\n  \t\tif (partial = parser.read(PARTIAL_READERS)) {\n  \t\t\tif (partials[partial.n]) {\n  \t\t\t\tparser.pos = pos;\n  \t\t\t\tparser.error('Duplicated partial definition');\n  \t\t\t}\n\n  \t\t\tcleanup(partial.f, parser.stripComments, preserveWhitespace, !preserveWhitespace, !preserveWhitespace);\n\n  \t\t\tpartials[partial.n] = partial.f;\n  \t\t\thasPartials = true;\n  \t\t} else if (item = parser.read(READERS)) {\n  \t\t\tfragment.push(item);\n  \t\t} else {\n  \t\t\tparser.error('Unexpected template content');\n  \t\t}\n  \t}\n\n  \tvar result = {\n  \t\tv: TEMPLATE_VERSION,\n  \t\tt: fragment\n  \t};\n\n  \tif (hasPartials) {\n  \t\tresult.p = partials;\n  \t}\n\n  \treturn result;\n  }\n\n  // See https://github.com/ractivejs/template-spec for information\n  // about the Ractive template specification\n\n  var STANDARD_READERS = [readPartial, readUnescaped, readSection, readYielder, readInterpolator, readComment];\n  var TRIPLE_READERS = [readTriple];\n  var STATIC_READERS = [readUnescaped, readSection, readInterpolator]; // TODO does it make sense to have a static section?\n\n  var StandardParser = undefined;\n  function parse(template, options) {\n  \treturn new StandardParser(template, options || {}).result;\n  }\n\n  var READERS = [readMustache, readHtmlComment, readElement, readText];\n  var PARTIAL_READERS = [readPartialDefinitionComment, readPartialDefinitionSection];\n\n  StandardParser = Parser$1.extend({\n  \tinit: function (str, options) {\n  \t\tvar tripleDelimiters = options.tripleDelimiters || ['{{{', '}}}'],\n  \t\t    staticDelimiters = options.staticDelimiters || ['[[', ']]'],\n  \t\t    staticTripleDelimiters = options.staticTripleDelimiters || ['[[[', ']]]'];\n\n  \t\tthis.standardDelimiters = options.delimiters || ['{{', '}}'];\n\n  \t\tthis.tags = [{ isStatic: false, isTriple: false, open: this.standardDelimiters[0], close: this.standardDelimiters[1], readers: STANDARD_READERS }, { isStatic: false, isTriple: true, open: tripleDelimiters[0], close: tripleDelimiters[1], readers: TRIPLE_READERS }, { isStatic: true, isTriple: false, open: staticDelimiters[0], close: staticDelimiters[1], readers: STATIC_READERS }, { isStatic: true, isTriple: true, open: staticTripleDelimiters[0], close: staticTripleDelimiters[1], readers: TRIPLE_READERS }];\n\n  \t\tthis.sortMustacheTags();\n\n  \t\tthis.sectionDepth = 0;\n  \t\tthis.elementStack = [];\n\n  \t\tthis.interpolate = {\n  \t\t\tscript: !options.interpolate || options.interpolate.script !== false,\n  \t\t\tstyle: !options.interpolate || options.interpolate.style !== false,\n  \t\t\ttextarea: true\n  \t\t};\n\n  \t\tif (options.sanitize === true) {\n  \t\t\toptions.sanitize = {\n  \t\t\t\t// blacklist from https://code.google.com/p/google-caja/source/browse/trunk/src/com/google/caja/lang/html/html4-elements-whitelist.json\n  \t\t\t\telements: 'applet base basefont body frame frameset head html isindex link meta noframes noscript object param script style title'.split(' '),\n  \t\t\t\teventAttributes: true\n  \t\t\t};\n  \t\t}\n\n  \t\tthis.stripComments = options.stripComments !== false;\n  \t\tthis.preserveWhitespace = options.preserveWhitespace;\n  \t\tthis.sanitizeElements = options.sanitize && options.sanitize.elements;\n  \t\tthis.sanitizeEventAttributes = options.sanitize && options.sanitize.eventAttributes;\n  \t\tthis.includeLinePositions = options.includeLinePositions;\n  \t},\n\n  \tpostProcess: function (result) {\n  \t\t// special case - empty string\n  \t\tif (!result.length) {\n  \t\t\treturn { t: [], v: TEMPLATE_VERSION };\n  \t\t}\n\n  \t\tif (this.sectionDepth > 0) {\n  \t\t\tthis.error('A section was left open');\n  \t\t}\n\n  \t\tcleanup(result[0].t, this.stripComments, this.preserveWhitespace, !this.preserveWhitespace, !this.preserveWhitespace);\n\n  \t\treturn result[0];\n  \t},\n\n  \tconverters: [readTemplate],\n\n  \tsortMustacheTags: function () {\n  \t\t// Sort in order of descending opening delimiter length (longer first),\n  \t\t// to protect against opening delimiters being substrings of each other\n  \t\tthis.tags.sort(function (a, b) {\n  \t\t\treturn b.open.length - a.open.length;\n  \t\t});\n  \t}\n  });\n\n  var parseOptions = ['preserveWhitespace', 'sanitize', 'stripComments', 'delimiters', 'tripleDelimiters', 'interpolate'];\n\n  var parser$1 = {\n  \tfromId: fromId, isHashedId: isHashedId, isParsed: isParsed, getParseOptions: getParseOptions, createHelper: createHelper$1,\n  \tparse: doParse\n  };\n\n  function createHelper$1(parseOptions) {\n  \tvar helper = create(parser$1);\n  \thelper.parse = function (template, options) {\n  \t\treturn doParse(template, options || parseOptions);\n  \t};\n  \treturn helper;\n  }\n\n  function doParse(template, parseOptions) {\n  \tif (!parse) {\n  \t\tthrow new Error('Missing Ractive.parse - cannot parse template. Either preparse or use the version that includes the parser');\n  \t}\n\n  \treturn parse(template, parseOptions || this.options);\n  }\n\n  function fromId(id, options) {\n  \tif (!doc) {\n  \t\tif (options && options.noThrow) {\n  \t\t\treturn;\n  \t\t}\n  \t\tthrow new Error('Cannot retrieve template #' + id + ' as Ractive is not running in a browser.');\n  \t}\n\n  \tif (isHashedId(id)) id = id.substring(1);\n\n  \tvar template = undefined;\n\n  \tif (!(template = doc.getElementById(id))) {\n  \t\tif (options && options.noThrow) {\n  \t\t\treturn;\n  \t\t}\n  \t\tthrow new Error('Could not find template element with id #' + id);\n  \t}\n\n  \tif (template.tagName.toUpperCase() !== 'SCRIPT') {\n  \t\tif (options && options.noThrow) {\n  \t\t\treturn;\n  \t\t}\n  \t\tthrow new Error('Template element with id #' + id + ', must be a <script> element');\n  \t}\n\n  \treturn 'textContent' in template ? template.textContent : template.innerHTML;\n  }\n\n  function isHashedId(id) {\n  \treturn id && id[0] === '#';\n  }\n\n  function isParsed(template) {\n  \treturn !(typeof template === 'string');\n  }\n\n  function getParseOptions(ractive) {\n  \t// Could be Ractive or a Component\n  \tif (ractive.defaults) {\n  \t\tractive = ractive.defaults;\n  \t}\n\n  \treturn parseOptions.reduce(function (val, key) {\n  \t\tval[key] = ractive[key];\n  \t\treturn val;\n  \t}, {});\n  }\n\n  var templateConfigurator = {\n  \tname: 'template',\n\n  \textend: function (Parent, proto, options) {\n  \t\t// only assign if exists\n  \t\tif ('template' in options) {\n  \t\t\tvar template = options.template;\n\n  \t\t\tif (typeof template === 'function') {\n  \t\t\t\tproto.template = template;\n  \t\t\t} else {\n  \t\t\t\tproto.template = parseIfString(template, proto);\n  \t\t\t}\n  \t\t}\n  \t},\n\n  \tinit: function (Parent, ractive, options) {\n  \t\t// TODO because of prototypal inheritance, we might just be able to use\n  \t\t// ractive.template, and not bother passing through the Parent object.\n  \t\t// At present that breaks the test mocks' expectations\n  \t\tvar template = 'template' in options ? options.template : Parent.prototype.template;\n  \t\ttemplate = template || { v: TEMPLATE_VERSION, t: [] };\n\n  \t\tif (typeof template === 'function') {\n  \t\t\tvar fn = template;\n  \t\t\ttemplate = getDynamicTemplate(ractive, fn);\n\n  \t\t\tractive._config.template = {\n  \t\t\t\tfn: fn,\n  \t\t\t\tresult: template\n  \t\t\t};\n  \t\t}\n\n  \t\ttemplate = parseIfString(template, ractive);\n\n  \t\t// TODO the naming of this is confusing - ractive.template refers to [...],\n  \t\t// but Component.prototype.template refers to {v:1,t:[],p:[]}...\n  \t\t// it's unnecessary, because the developer never needs to access\n  \t\t// ractive.template\n  \t\tractive.template = template.t;\n\n  \t\tif (template.p) {\n  \t\t\textendPartials(ractive.partials, template.p);\n  \t\t}\n  \t},\n\n  \treset: function (ractive) {\n  \t\tvar result = resetValue(ractive);\n\n  \t\tif (result) {\n  \t\t\tvar parsed = parseIfString(result, ractive);\n\n  \t\t\tractive.template = parsed.t;\n  \t\t\textendPartials(ractive.partials, parsed.p, true);\n\n  \t\t\treturn true;\n  \t\t}\n  \t}\n  };\n\n  function resetValue(ractive) {\n  \tvar initial = ractive._config.template;\n\n  \t// If this isn't a dynamic template, there's nothing to do\n  \tif (!initial || !initial.fn) {\n  \t\treturn;\n  \t}\n\n  \tvar result = getDynamicTemplate(ractive, initial.fn);\n\n  \t// TODO deep equality check to prevent unnecessary re-rendering\n  \t// in the case of already-parsed templates\n  \tif (result !== initial.result) {\n  \t\tinitial.result = result;\n  \t\tresult = parseIfString(result, ractive);\n  \t\treturn result;\n  \t}\n  }\n\n  function getDynamicTemplate(ractive, fn) {\n  \tvar helper = createHelper(parser$1.getParseOptions(ractive));\n  \treturn fn.call(ractive, helper);\n  }\n\n  function createHelper(parseOptions) {\n  \tvar helper = create(parser$1);\n  \thelper.parse = function (template, options) {\n  \t\treturn parser$1.parse(template, options || parseOptions);\n  \t};\n  \treturn helper;\n  }\n\n  function parseIfString(template, ractive) {\n  \tif (typeof template === 'string') {\n  \t\t// ID of an element containing the template?\n  \t\tif (template[0] === '#') {\n  \t\t\ttemplate = parser$1.fromId(template);\n  \t\t}\n\n  \t\ttemplate = parse(template, parser$1.getParseOptions(ractive));\n  \t}\n\n  \t// Check that the template even exists\n  \telse if (template == undefined) {\n  \t\t\tthrow new Error('The template cannot be ' + template + '.');\n  \t\t}\n\n  \t\t// Check the parsed template has a version at all\n  \t\telse if (typeof template.v !== 'number') {\n  \t\t\t\tthrow new Error('The template parser was passed a non-string template, but the template doesn\\'t have a version.  Make sure you\\'re passing in the template you think you are.');\n  \t\t\t}\n\n  \t\t\t// Check we're using the correct version\n  \t\t\telse if (template.v !== TEMPLATE_VERSION) {\n  \t\t\t\t\tthrow new Error('Mismatched template version (expected ' + TEMPLATE_VERSION + ', got ' + template.v + ') Please ensure you are using the latest version of Ractive.js in your build process as well as in your app');\n  \t\t\t\t}\n\n  \treturn template;\n  }\n\n  function extendPartials(existingPartials, newPartials, overwrite) {\n  \tif (!newPartials) return;\n\n  \t// TODO there's an ambiguity here - we need to overwrite in the `reset()`\n  \t// case, but not initially...\n\n  \tfor (var key in newPartials) {\n  \t\tif (overwrite || !existingPartials.hasOwnProperty(key)) {\n  \t\t\texistingPartials[key] = newPartials[key];\n  \t\t}\n  \t}\n  }\n\n  var Item = (function () {\n  \tfunction Item(options) {\n  \t\tclassCallCheck(this, Item);\n\n  \t\tthis.parentFragment = options.parentFragment;\n  \t\tthis.ractive = options.parentFragment.ractive;\n\n  \t\tthis.template = options.template;\n  \t\tthis.index = options.index;\n  \t\tthis.type = options.template.t;\n\n  \t\tthis.dirty = false;\n  \t}\n\n  \tItem.prototype.bubble = function bubble() {\n  \t\tif (!this.dirty) {\n  \t\t\tthis.dirty = true;\n  \t\t\tthis.parentFragment.bubble();\n  \t\t}\n  \t};\n\n  \tItem.prototype.find = function find() {\n  \t\treturn null;\n  \t};\n\n  \tItem.prototype.findAll = function findAll() {\n  \t\t// noop\n  \t};\n\n  \tItem.prototype.findComponent = function findComponent() {\n  \t\treturn null;\n  \t};\n\n  \tItem.prototype.findAllComponents = function findAllComponents() {\n  \t\t// noop;\n  \t};\n\n  \tItem.prototype.findNextNode = function findNextNode() {\n  \t\treturn this.parentFragment.findNextNode(this);\n  \t};\n\n  \treturn Item;\n  })();\n\n  var Doctype = (function (_Item) {\n  \tinherits(Doctype, _Item);\n\n  \tfunction Doctype() {\n  \t\tclassCallCheck(this, Doctype);\n\n  \t\t_Item.apply(this, arguments);\n  \t}\n\n  \tDoctype.prototype.bind = function bind() {\n  \t\t// noop\n  \t};\n\n  \tDoctype.prototype.render = function render() {\n  \t\t// noop\n  \t};\n\n  \tDoctype.prototype.teardown = function teardown() {\n  \t\t// noop\n  \t};\n\n  \tDoctype.prototype.toString = function toString() {\n  \t\treturn '<!DOCTYPE' + this.template.a + '>';\n  \t};\n\n  \tDoctype.prototype.unbind = function unbind() {\n  \t\t// noop\n  \t};\n\n  \tDoctype.prototype.unrender = function unrender() {\n  \t\t// noop\n  \t};\n\n  \treturn Doctype;\n  })(Item);\n\n  function badReference(key) {\n  \tthrow new Error(\"An index or key reference (\" + key + \") cannot have child properties\");\n  }\n  function resolveAmbiguousReference(fragment, ref) {\n  \tvar localViewmodel = fragment.findContext().root;\n  \tvar keys = splitKeypath(ref);\n  \tvar key = keys[0];\n\n  \tvar hasContextChain = undefined;\n  \tvar crossedComponentBoundary = undefined;\n\n  \twhile (fragment) {\n  \t\t// repeated fragments\n  \t\tif (fragment.isIteration) {\n  \t\t\tif (key === fragment.parent.keyRef) {\n  \t\t\t\tif (keys.length > 1) badReference(key);\n  \t\t\t\treturn fragment.context.getKeyModel();\n  \t\t\t}\n\n  \t\t\tif (key === fragment.parent.indexRef) {\n  \t\t\t\tif (keys.length > 1) badReference(key);\n  \t\t\t\treturn fragment.context.getIndexModel(fragment.index);\n  \t\t\t}\n  \t\t}\n\n  \t\tif (fragment.context) {\n  \t\t\t// TODO better encapsulate the component check\n  \t\t\tif (!fragment.isRoot || fragment.ractive.component) hasContextChain = true;\n\n  \t\t\tif (fragment.context.has(key)) {\n  \t\t\t\tif (crossedComponentBoundary) {\n  \t\t\t\t\tlocalViewmodel.map(key, fragment.context.joinKey(key));\n  \t\t\t\t}\n\n  \t\t\t\treturn fragment.context.joinAll(keys);\n  \t\t\t}\n  \t\t}\n\n  \t\tif (fragment.componentParent && !fragment.ractive.isolated) {\n  \t\t\t// ascend through component boundary\n  \t\t\tfragment = fragment.componentParent;\n  \t\t\tcrossedComponentBoundary = true;\n  \t\t} else {\n  \t\t\tfragment = fragment.parent;\n  \t\t}\n  \t}\n\n  \tif (!hasContextChain) {\n  \t\treturn localViewmodel.joinAll(keys);\n  \t}\n  }\n\n  function resolveReference(fragment, ref) {\n  \tvar context = fragment.findContext();\n\n  \t// special references\n  \t// TODO does `this` become `.` at parse time?\n  \tif (ref === '.' || ref === 'this') return context;\n  \tif (ref === '@keypath') return context.getKeypathModel();\n  \tif (ref === '@index') {\n  \t\tvar repeater = fragment.findRepeatingFragment();\n  \t\t// make sure the found fragment is actually an iteration\n  \t\tif (!repeater.isIteration) return;\n  \t\treturn repeater.context.getIndexModel(repeater.index);\n  \t}\n  \tif (ref === '@key') return fragment.findRepeatingFragment().context.getKeyModel();\n\n  \t// ancestor references\n  \tif (ref[0] === '~') return context.root.joinAll(splitKeypath(ref.slice(2)));\n  \tif (ref[0] === '.') {\n  \t\tvar parts = ref.split('/');\n\n  \t\twhile (parts[0] === '.' || parts[0] === '..') {\n  \t\t\tvar part = parts.shift();\n\n  \t\t\tif (part === '..') {\n  \t\t\t\tcontext = context.parent;\n  \t\t\t}\n  \t\t}\n\n  \t\tref = parts.join('/');\n\n  \t\t// special case - `{{.foo}}` means the same as `{{./foo}}`\n  \t\tif (ref[0] === '.') ref = ref.slice(1);\n  \t\treturn context.joinAll(splitKeypath(ref));\n  \t}\n\n  \treturn resolveAmbiguousReference(fragment, ref);\n  }\n\n  var stack = [];\n  var captureGroup = undefined;\n\n  function startCapturing() {\n  \tstack.push(captureGroup = []);\n  }\n\n  function stopCapturing() {\n  \treturn stack.pop();\n  }\n\n  function capture(model) {\n  \tif (captureGroup) {\n  \t\tcaptureGroup.push(model);\n  \t}\n  }\n\n  var requestAnimationFrame;\n\n  // If window doesn't exist, we don't need requestAnimationFrame\n  if (!win) {\n  \trequestAnimationFrame = null;\n  } else {\n  \t// https://gist.github.com/paulirish/1579671\n  \t(function (vendors, lastTime, win) {\n\n  \t\tvar x, setTimeout;\n\n  \t\tif (win.requestAnimationFrame) {\n  \t\t\treturn;\n  \t\t}\n\n  \t\tfor (x = 0; x < vendors.length && !win.requestAnimationFrame; ++x) {\n  \t\t\twin.requestAnimationFrame = win[vendors[x] + 'RequestAnimationFrame'];\n  \t\t}\n\n  \t\tif (!win.requestAnimationFrame) {\n  \t\t\tsetTimeout = win.setTimeout;\n\n  \t\t\twin.requestAnimationFrame = function (callback) {\n  \t\t\t\tvar currTime, timeToCall, id;\n\n  \t\t\t\tcurrTime = Date.now();\n  \t\t\t\ttimeToCall = Math.max(0, 16 - (currTime - lastTime));\n  \t\t\t\tid = setTimeout(function () {\n  \t\t\t\t\tcallback(currTime + timeToCall);\n  \t\t\t\t}, timeToCall);\n\n  \t\t\t\tlastTime = currTime + timeToCall;\n  \t\t\t\treturn id;\n  \t\t\t};\n  \t\t}\n  \t})(vendors, 0, win);\n\n  \trequestAnimationFrame = win.requestAnimationFrame;\n  }\n\n  var rAF = requestAnimationFrame;\n\n  var getTime = win && win.performance && typeof win.performance.now === 'function' ? function () {\n  \treturn win.performance.now();\n  } : function () {\n  \treturn Date.now();\n  };\n\n  // TODO what happens if a transition is aborted?\n\n  var tickers = [];\n  var running = false;\n\n  function tick() {\n  \trunloop.start();\n\n  \tvar now = getTime();\n\n  \tvar i = undefined;\n  \tvar ticker = undefined;\n\n  \tfor (i = 0; i < tickers.length; i += 1) {\n  \t\tticker = tickers[i];\n\n  \t\tif (!ticker.tick(now)) {\n  \t\t\t// ticker is complete, remove it from the stack, and decrement i so we don't miss one\n  \t\t\ttickers.splice(i--, 1);\n  \t\t}\n  \t}\n\n  \trunloop.end();\n\n  \tif (tickers.length) {\n  \t\trAF(tick);\n  \t} else {\n  \t\trunning = false;\n  \t}\n  }\n\n  var Ticker = (function () {\n  \tfunction Ticker(options) {\n  \t\tclassCallCheck(this, Ticker);\n\n  \t\tthis.duration = options.duration;\n  \t\tthis.step = options.step;\n  \t\tthis.complete = options.complete;\n  \t\tthis.easing = options.easing;\n\n  \t\tthis.start = getTime();\n  \t\tthis.end = this.start + this.duration;\n\n  \t\tthis.running = true;\n\n  \t\ttickers.push(this);\n  \t\tif (!running) rAF(tick);\n  \t}\n\n  \tTicker.prototype.tick = function tick(now) {\n  \t\tif (!this.running) return false;\n\n  \t\tif (now > this.end) {\n  \t\t\tif (this.step) this.step(1);\n  \t\t\tif (this.complete) this.complete(1);\n\n  \t\t\treturn false;\n  \t\t}\n\n  \t\tvar elapsed = now - this.start;\n  \t\tvar eased = this.easing(elapsed / this.duration);\n\n  \t\tif (this.step) this.step(eased);\n\n  \t\treturn true;\n  \t};\n\n  \tTicker.prototype.stop = function stop() {\n  \t\tif (this.abort) this.abort();\n  \t\tthis.running = false;\n  \t};\n\n  \treturn Ticker;\n  })();\n\n  var prefixers = {};\n\n  // TODO this is legacy. sooner we can replace the old adaptor API the better\n  function prefixKeypath(obj, prefix) {\n  \tvar prefixed = {},\n  \t    key;\n\n  \tif (!prefix) {\n  \t\treturn obj;\n  \t}\n\n  \tprefix += '.';\n\n  \tfor (key in obj) {\n  \t\tif (obj.hasOwnProperty(key)) {\n  \t\t\tprefixed[prefix + key] = obj[key];\n  \t\t}\n  \t}\n\n  \treturn prefixed;\n  }\n  function getPrefixer(rootKeypath) {\n  \tvar rootDot;\n\n  \tif (!prefixers[rootKeypath]) {\n  \t\trootDot = rootKeypath ? rootKeypath + '.' : '';\n\n  \t\tprefixers[rootKeypath] = function (relativeKeypath, value) {\n  \t\t\tvar obj;\n\n  \t\t\tif (typeof relativeKeypath === 'string') {\n  \t\t\t\tobj = {};\n  \t\t\t\tobj[rootDot + relativeKeypath] = value;\n  \t\t\t\treturn obj;\n  \t\t\t}\n\n  \t\t\tif (typeof relativeKeypath === 'object') {\n  \t\t\t\t// 'relativeKeypath' is in fact a hash, not a keypath\n  \t\t\t\treturn rootDot ? prefixKeypath(relativeKeypath, rootKeypath) : relativeKeypath;\n  \t\t\t}\n  \t\t};\n  \t}\n\n  \treturn prefixers[rootKeypath];\n  }\n\n  var KeyModel = (function () {\n  \tfunction KeyModel(key) {\n  \t\tclassCallCheck(this, KeyModel);\n\n  \t\tthis.value = key;\n  \t\tthis.isReadonly = true;\n  \t\tthis.dependants = [];\n  \t}\n\n  \tKeyModel.prototype.get = function get() {\n  \t\treturn this.value;\n  \t};\n\n  \tKeyModel.prototype.getKeypath = function getKeypath() {\n  \t\treturn this.value;\n  \t};\n\n  \tKeyModel.prototype.rebind = function rebind(key) {\n  \t\tthis.value = key;\n  \t\tthis.dependants.forEach(_handleChange);\n  \t};\n\n  \tKeyModel.prototype.register = function register(dependant) {\n  \t\tthis.dependants.push(dependant);\n  \t};\n\n  \tKeyModel.prototype.unregister = function unregister(dependant) {\n  \t\tremoveFromArray(this.dependants, dependant);\n  \t};\n\n  \treturn KeyModel;\n  })();\n\n  var KeypathModel = (function () {\n  \tfunction KeypathModel(parent) {\n  \t\tclassCallCheck(this, KeypathModel);\n\n  \t\tthis.parent = parent;\n  \t\tthis.value = parent.getKeypath();\n  \t\tthis.dependants = [];\n  \t}\n\n  \tKeypathModel.prototype.get = function get() {\n  \t\treturn this.value;\n  \t};\n\n  \tKeypathModel.prototype.getKeypath = function getKeypath() {\n  \t\treturn this.value;\n  \t};\n\n  \tKeypathModel.prototype.handleChange = function handleChange() {\n  \t\tthis.value = this.parent.getKeypath();\n  \t\tthis.dependants.forEach(_handleChange);\n  \t};\n\n  \tKeypathModel.prototype.register = function register(dependant) {\n  \t\tthis.dependants.push(dependant);\n  \t};\n\n  \tKeypathModel.prototype.unregister = function unregister(dependant) {\n  \t\tremoveFromArray(this.dependants, dependant);\n  \t};\n\n  \treturn KeypathModel;\n  })();\n\n  var hasProp = Object.prototype.hasOwnProperty;\n\n  function _updateFromBindings(model) {\n  \tmodel.updateFromBindings(true);\n  }\n\n  function _updateKeypathDependants(model) {\n  \tmodel.updateKeypathDependants();\n  }\n\n  var originatingModel = null;\n\n  var Model = (function () {\n  \tfunction Model(parent, key) {\n  \t\tclassCallCheck(this, Model);\n\n  \t\tthis.deps = [];\n\n  \t\tthis.children = [];\n  \t\tthis.childByKey = {};\n\n  \t\tthis.indexModels = [];\n\n  \t\tthis.unresolved = [];\n  \t\tthis.unresolvedByKey = {};\n\n  \t\tthis.bindings = [];\n\n  \t\tthis.value = undefined;\n\n  \t\tthis.ticker = null;\n\n  \t\tif (parent) {\n  \t\t\tthis.parent = parent;\n  \t\t\tthis.root = parent.root;\n  \t\t\tthis.key = unescape(key);\n  \t\t\tthis.isReadonly = parent.isReadonly;\n\n  \t\t\tif (parent.value) {\n  \t\t\t\tthis.value = parent.value[this.key];\n  \t\t\t\tthis.adapt();\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \tModel.prototype.adapt = function adapt() {\n  \t\tvar adaptors = this.root.adaptors;\n  \t\tvar value = this.value;\n  \t\tvar len = adaptors.length;\n\n  \t\t// TODO remove this legacy nonsense\n  \t\tvar ractive = this.root.ractive;\n  \t\tvar keypath = this.getKeypath();\n\n  \t\tvar i = undefined;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tvar adaptor = adaptors[i];\n  \t\t\tif (adaptor.filter(value, keypath, ractive)) {\n  \t\t\t\tthis.wrapper = adaptor.wrap(ractive, value, keypath, getPrefixer(keypath));\n  \t\t\t\tthis.wrapper.value = this.value;\n  \t\t\t\tthis.wrapper.__model = this; // massive temporary hack to enable array adaptor\n\n  \t\t\t\tthis.value = this.wrapper.get();\n\n  \t\t\t\tbreak;\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tModel.prototype.addUnresolved = function addUnresolved(key, resolver) {\n  \t\tif (!this.unresolvedByKey[key]) {\n  \t\t\tthis.unresolved.push(key);\n  \t\t\tthis.unresolvedByKey[key] = [];\n  \t\t}\n\n  \t\tthis.unresolvedByKey[key].push(resolver);\n  \t};\n\n  \tModel.prototype.animate = function animate(from, to, options, interpolator) {\n  \t\tvar _this = this;\n\n  \t\tif (this.ticker) this.ticker.stop();\n\n  \t\tvar fulfilPromise = undefined;\n  \t\tvar promise = new Promise$1(function (fulfil) {\n  \t\t\treturn fulfilPromise = fulfil;\n  \t\t});\n\n  \t\tthis.ticker = new Ticker({\n  \t\t\tduration: options.duration,\n  \t\t\teasing: options.easing,\n  \t\t\tstep: function (t) {\n  \t\t\t\tvar value = interpolator(t);\n  \t\t\t\t_this.applyValue(value);\n  \t\t\t\tif (options.step) options.step(t, value);\n  \t\t\t},\n  \t\t\tcomplete: function () {\n  \t\t\t\t_this.applyValue(to);\n  \t\t\t\tif (options.complete) options.complete(to);\n\n  \t\t\t\t_this.ticker = null;\n  \t\t\t\tfulfilPromise();\n  \t\t\t}\n  \t\t});\n\n  \t\tpromise.stop = this.ticker.stop;\n  \t\treturn promise;\n  \t};\n\n  \tModel.prototype.applyValue = function applyValue(value) {\n  \t\tif (isEqual(value, this.value)) return;\n\n  \t\t// TODO deprecate this nonsense\n  \t\tthis.root.changes[this.getKeypath()] = value;\n\n  \t\tif (this.parent.wrapper && this.parent.wrapper.set) {\n  \t\t\tthis.parent.wrapper.set(this.key, value);\n  \t\t\tthis.parent.value = this.parent.wrapper.get();\n\n  \t\t\tthis.value = this.parent.value[this.key];\n  \t\t\t// TODO should this value be adapted? probably\n  \t\t} else if (this.wrapper) {\n  \t\t\t\tvar shouldTeardown = !this.wrapper.reset || this.wrapper.reset(value) === false;\n\n  \t\t\t\tif (shouldTeardown) {\n  \t\t\t\t\tthis.wrapper.teardown();\n  \t\t\t\t\tthis.wrapper = null;\n  \t\t\t\t\tthis.parent.value[this.key] = this.value = value;\n  \t\t\t\t\tthis.adapt();\n  \t\t\t\t} else {\n  \t\t\t\t\tthis.value = this.wrapper.get();\n  \t\t\t\t}\n  \t\t\t} else {\n  \t\t\t\tvar parentValue = this.parent.value || this.parent.createBranch(this.key);\n  \t\t\t\tparentValue[this.key] = value;\n\n  \t\t\t\tthis.value = value;\n  \t\t\t\tthis.adapt();\n  \t\t\t}\n\n  \t\tthis.parent.clearUnresolveds();\n  \t\tthis.clearUnresolveds();\n\n  \t\t// notify dependants\n  \t\tvar previousOriginatingModel = originatingModel; // for the array.length special case\n  \t\toriginatingModel = this;\n\n  \t\tthis.children.forEach(_mark);\n  \t\tthis.deps.forEach(_handleChange);\n\n  \t\tvar parent = this.parent;\n  \t\twhile (parent) {\n  \t\t\tparent.deps.forEach(_handleChange);\n  \t\t\tparent = parent.parent;\n  \t\t}\n\n  \t\toriginatingModel = previousOriginatingModel;\n  \t};\n\n  \tModel.prototype.clearUnresolveds = function clearUnresolveds(specificKey) {\n  \t\tvar i = this.unresolved.length;\n\n  \t\twhile (i--) {\n  \t\t\tvar key = this.unresolved[i];\n\n  \t\t\tif (specificKey && key !== specificKey) continue;\n\n  \t\t\tvar resolvers = this.unresolvedByKey[key];\n  \t\t\tvar hasKey = this.has(key);\n\n  \t\t\tvar j = resolvers.length;\n  \t\t\twhile (j--) {\n  \t\t\t\tif (hasKey) resolvers[j].attemptResolution();\n  \t\t\t\tif (resolvers[j].resolved) resolvers.splice(j, 1);\n  \t\t\t}\n\n  \t\t\tif (!resolvers.length) {\n  \t\t\t\tthis.unresolved.splice(i, 1);\n  \t\t\t\tthis.unresolvedByKey[key] = null;\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tModel.prototype.createBranch = function createBranch(key) {\n  \t\tvar branch = isNumeric(key) ? [] : {};\n  \t\tthis.set(branch);\n\n  \t\treturn branch;\n  \t};\n\n  \tModel.prototype.discard = function discard() {\n  \t\tvar _this2 = this;\n\n  \t\tthis.deps.forEach(function (d) {\n  \t\t\tif (d.boundsSensitive) _this2.unregister(d);\n  \t\t});\n  \t};\n\n  \tModel.prototype.findMatches = function findMatches(keys) {\n  \t\tvar len = keys.length;\n\n  \t\tvar existingMatches = [this];\n  \t\tvar matches = undefined;\n  \t\tvar i = undefined;\n\n  \t\tvar _loop = function () {\n  \t\t\tvar key = keys[i];\n\n  \t\t\tif (key === '*') {\n  \t\t\t\tmatches = [];\n  \t\t\t\texistingMatches.forEach(function (model) {\n  \t\t\t\t\tif (isArray(model.value)) {\n  \t\t\t\t\t\t// special case - array.length. This is a horrible kludge, but\n  \t\t\t\t\t\t// it'll do for now. Alternatives welcome\n  \t\t\t\t\t\tif (originatingModel && originatingModel.parent === model && originatingModel.key === 'length') {\n  \t\t\t\t\t\t\tmatches.push(originatingModel);\n  \t\t\t\t\t\t}\n\n  \t\t\t\t\t\tmodel.value.forEach(function (member, i) {\n  \t\t\t\t\t\t\tmatches.push(model.joinKey(i));\n  \t\t\t\t\t\t});\n  \t\t\t\t\t} else if (isObject(model.value) || typeof model.value === 'function') {\n  \t\t\t\t\t\tObject.keys(model.value).forEach(function (key) {\n  \t\t\t\t\t\t\tmatches.push(model.joinKey(key));\n  \t\t\t\t\t\t});\n\n  \t\t\t\t\t\t// special case - computed properties. TODO mappings also?\n  \t\t\t\t\t\tif (model.isRoot) {\n  \t\t\t\t\t\t\tObject.keys(model.computations).forEach(function (key) {\n  \t\t\t\t\t\t\t\tmatches.push(model.joinKey(key));\n  \t\t\t\t\t\t\t});\n  \t\t\t\t\t\t}\n  \t\t\t\t\t}\n  \t\t\t\t});\n  \t\t\t} else {\n  \t\t\t\tmatches = existingMatches.map(function (model) {\n  \t\t\t\t\treturn model.joinKey(key);\n  \t\t\t\t});\n  \t\t\t}\n\n  \t\t\texistingMatches = matches;\n  \t\t};\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\t_loop();\n  \t\t}\n\n  \t\treturn matches;\n  \t};\n\n  \tModel.prototype.get = function get(shouldCapture) {\n  \t\tif (shouldCapture) capture(this);\n  \t\treturn this.value;\n  \t};\n\n  \tModel.prototype.getIndexModel = function getIndexModel(fragmentIndex) {\n  \t\tvar indexModels = this.parent.indexModels;\n\n  \t\t// non-numeric keys are a special of a numeric index in a object iteration\n  \t\tif (typeof this.key === 'string' && fragmentIndex !== undefined) {\n  \t\t\treturn new KeyModel(fragmentIndex);\n  \t\t} else if (!indexModels[this.key]) {\n  \t\t\tindexModels[this.key] = new KeyModel(this.key);\n  \t\t}\n\n  \t\treturn indexModels[this.key];\n  \t};\n\n  \tModel.prototype.getKeyModel = function getKeyModel() {\n  \t\t// TODO... different to IndexModel because key can never change\n  \t\treturn new KeyModel(escape(this.key));\n  \t};\n\n  \tModel.prototype.getKeypathModel = function getKeypathModel() {\n  \t\treturn this.keypathModel || (this.keypathModel = new KeypathModel(this));\n  \t};\n\n  \tModel.prototype.getKeypath = function getKeypath() {\n  \t\t// TODO keypaths inside components... tricky\n  \t\treturn this.parent.isRoot ? escape(this.key) : this.parent.getKeypath() + '.' + escape(this.key);\n  \t};\n\n  \tModel.prototype.has = function has(key) {\n  \t\tvar value = this.get();\n  \t\tif (!value) return false;\n\n  \t\tkey = unescape(key);\n  \t\tif (hasProp.call(value, key)) return true;\n\n  \t\t// We climb up the constructor chain to find if one of them contains the key\n  \t\tvar constructor = value.constructor;\n  \t\twhile (constructor !== Function && constructor !== Array && constructor !== Object) {\n  \t\t\tif (hasProp.call(constructor.prototype, key)) return true;\n  \t\t\tconstructor = constructor.constructor;\n  \t\t}\n\n  \t\treturn false;\n  \t};\n\n  \tModel.prototype.joinKey = function joinKey(key) {\n  \t\tif (key === undefined || key === '') return this;\n\n  \t\tif (!this.childByKey.hasOwnProperty(key)) {\n  \t\t\tvar child = new Model(this, key);\n  \t\t\tthis.children.push(child);\n  \t\t\tthis.childByKey[key] = child;\n  \t\t}\n\n  \t\treturn this.childByKey[key];\n  \t};\n\n  \tModel.prototype.joinAll = function joinAll(keys) {\n  \t\tvar model = this;\n  \t\tfor (var i = 0; i < keys.length; i += 1) {\n  \t\t\tmodel = model.joinKey(keys[i]);\n  \t\t}\n\n  \t\treturn model;\n  \t};\n\n  \tModel.prototype.mark = function mark() {\n  \t\tvar value = this.retrieve();\n\n  \t\tif (!isEqual(value, this.value)) {\n  \t\t\tthis.value = value;\n\n  \t\t\tthis.children.forEach(_mark);\n\n  \t\t\tthis.deps.forEach(_handleChange);\n  \t\t\tthis.clearUnresolveds();\n  \t\t}\n  \t};\n\n  \tModel.prototype.merge = function merge(array, comparator) {\n  \t\tvar oldArray = comparator ? this.value.map(comparator) : this.value;\n  \t\tvar newArray = comparator ? array.map(comparator) : array;\n\n  \t\tvar oldLength = oldArray.length;\n\n  \t\tvar usedIndices = {};\n  \t\tvar firstUnusedIndex = 0;\n\n  \t\tvar newIndices = oldArray.map(function (item) {\n  \t\t\tvar index = undefined;\n  \t\t\tvar start = firstUnusedIndex;\n\n  \t\t\tdo {\n  \t\t\t\tindex = newArray.indexOf(item, start);\n\n  \t\t\t\tif (index === -1) {\n  \t\t\t\t\treturn -1;\n  \t\t\t\t}\n\n  \t\t\t\tstart = index + 1;\n  \t\t\t} while (usedIndices[index] === true && start < oldLength);\n\n  \t\t\t// keep track of the first unused index, so we don't search\n  \t\t\t// the whole of newArray for each item in oldArray unnecessarily\n  \t\t\tif (index === firstUnusedIndex) {\n  \t\t\t\tfirstUnusedIndex += 1;\n  \t\t\t}\n  \t\t\t// allow next instance of next \"equal\" to be found item\n  \t\t\tusedIndices[index] = true;\n  \t\t\treturn index;\n  \t\t});\n\n  \t\tthis.parent.value[this.key] = array;\n  \t\tthis._merged = true;\n  \t\tthis.shuffle(newIndices);\n  \t};\n\n  \tModel.prototype.register = function register(dep) {\n  \t\tthis.deps.push(dep);\n  \t};\n\n  \tModel.prototype.registerTwowayBinding = function registerTwowayBinding(binding) {\n  \t\tthis.bindings.push(binding);\n  \t};\n\n  \tModel.prototype.retrieve = function retrieve() {\n  \t\treturn this.parent.value ? this.parent.value[this.key] : undefined;\n  \t};\n\n  \tModel.prototype.set = function set(value) {\n  \t\tif (this.ticker) this.ticker.stop();\n  \t\tthis.applyValue(value);\n  \t};\n\n  \tModel.prototype.shuffle = function shuffle(newIndices) {\n  \t\tvar _this3 = this;\n\n  \t\tvar indexModels = [];\n  \t\tvar max = 0,\n  \t\t    child = undefined;\n\n  \t\tnewIndices.forEach(function (newIndex, oldIndex) {\n  \t\t\tif (newIndex > max) max = newIndex;\n\n  \t\t\tif (! ~newIndex) return;\n\n  \t\t\tvar model = _this3.indexModels[oldIndex];\n\n  \t\t\tif (!model) return;\n\n  \t\t\tindexModels[newIndex] = model;\n\n  \t\t\tif (newIndex !== oldIndex) {\n  \t\t\t\tmodel.rebind(newIndex);\n  \t\t\t}\n  \t\t});\n\n  \t\t// some children, notably computations, need to be notified when they are\n  \t\t// no longer attached to anything so they don't recompute\n  \t\twhile (child = this.childByKey[++max]) {\n  \t\t\tif (typeof child.discard === 'function') child.discard();\n  \t\t}\n\n  \t\tthis.indexModels = indexModels;\n\n  \t\t// shuffles need to happen before marks...\n  \t\tthis.deps.forEach(function (dep) {\n  \t\t\tif (dep.shuffle) dep.shuffle(newIndices);\n  \t\t});\n\n  \t\tthis.updateKeypathDependants();\n  \t\tthis.mark();\n\n  \t\t// ...but handleChange must happen after (TODO document why)\n  \t\tthis.deps.forEach(function (dep) {\n  \t\t\tif (!dep.shuffle) dep.handleChange();\n  \t\t});\n  \t};\n\n  \tModel.prototype.teardown = function teardown$$() {\n  \t\tthis.children.forEach(teardown);\n  \t\tif (this.wrapper) this.wrapper.teardown();\n  \t};\n\n  \tModel.prototype.unregister = function unregister(dependant) {\n  \t\tremoveFromArray(this.deps, dependant);\n  \t};\n\n  \tModel.prototype.unregisterTwowayBinding = function unregisterTwowayBinding(binding) {\n  \t\tremoveFromArray(this.bindings, binding);\n  \t};\n\n  \tModel.prototype.updateFromBindings = function updateFromBindings(cascade) {\n  \t\tvar i = this.bindings.length;\n  \t\twhile (i--) {\n  \t\t\tvar value = this.bindings[i].getValue();\n  \t\t\tif (value !== this.value) this.set(value);\n  \t\t}\n\n  \t\tif (cascade) {\n  \t\t\tthis.children.forEach(_updateFromBindings);\n  \t\t}\n  \t};\n\n  \tModel.prototype.updateKeypathDependants = function updateKeypathDependants() {\n  \t\tthis.children.forEach(_updateKeypathDependants);\n  \t\tif (this.keypathModel) this.keypathModel.handleChange();\n  \t};\n\n  \treturn Model;\n  })();\n\n  function escape(key) {\n  \tif (typeof key === 'string') {\n  \t\treturn key.replace('.', '\\\\.');\n  \t}\n  \treturn key;\n  }\n\n  function unescape(key) {\n  \tif (typeof key === 'string') {\n  \t\treturn key.replace('\\\\.', '.');\n  \t}\n  \treturn key;\n  }\n\n  var ComputationChild = (function (_Model) {\n  \tinherits(ComputationChild, _Model);\n\n  \tfunction ComputationChild() {\n  \t\tclassCallCheck(this, ComputationChild);\n\n  \t\t_Model.apply(this, arguments);\n  \t}\n\n  \tComputationChild.prototype.get = function get(shouldCapture) {\n  \t\tif (shouldCapture) capture(this);\n\n  \t\tvar parentValue = this.parent.get();\n  \t\treturn parentValue ? parentValue[this.key] : undefined;\n  \t};\n\n  \tComputationChild.prototype.handleChange = function handleChange() {\n  \t\tthis.dirty = true;\n\n  \t\tthis.deps.forEach(_handleChange);\n  \t\tthis.children.forEach(_handleChange);\n  \t\tthis.clearUnresolveds(); // TODO is this necessary?\n  \t};\n\n  \tComputationChild.prototype.joinKey = function joinKey(key) {\n  \t\tif (key === undefined || key === '') return this;\n\n  \t\tif (!this.childByKey.hasOwnProperty(key)) {\n  \t\t\tvar child = new ComputationChild(this, key);\n  \t\t\tthis.children.push(child);\n  \t\t\tthis.childByKey[key] = child;\n  \t\t}\n\n  \t\treturn this.childByKey[key];\n  \t};\n\n  \t// TODO this causes problems with inter-component mappings\n  \t// set () {\n  \t// \tthrow new Error( `Cannot set read-only property of computed value (${this.getKeypath()})` );\n  \t// }\n  \treturn ComputationChild;\n  })(Model);\n\n  var functionCache = {};\n  function createFunction(str, i) {\n  \tif (functionCache[str]) return functionCache[str];\n\n  \tvar args = new Array(i);\n  \twhile (i--) args[i] = \"_\" + i;\n\n  \tvar fn = new Function(args.join(','), \"return (\" + str + \")\");\n\n  \treturn functionCache[str] = fn;\n  }\n\n  function getValue(model) {\n  \treturn model ? model.get(true) : undefined;\n  }\n\n  var ExpressionProxy = (function (_Model) {\n  \tinherits(ExpressionProxy, _Model);\n\n  \tfunction ExpressionProxy(fragment, template) {\n  \t\tvar _this = this;\n\n  \t\tclassCallCheck(this, ExpressionProxy);\n\n  \t\t_Model.call(this, fragment.ractive.viewmodel, null);\n\n  \t\tthis.fragment = fragment;\n  \t\tthis.template = template;\n\n  \t\tthis.isReadonly = true;\n\n  \t\tthis.fn = createFunction(template.s, template.r.length);\n  \t\tthis.computation = null;\n\n  \t\tthis.resolvers = [];\n  \t\tthis.models = template.r.map(function (ref, index) {\n  \t\t\tvar model = resolveReference(fragment, ref);\n  \t\t\tvar resolver = undefined;\n\n  \t\t\tif (!model) {\n  \t\t\t\tresolver = fragment.resolve(ref, function (model) {\n  \t\t\t\t\tremoveFromArray(_this.resolvers, resolver);\n  \t\t\t\t\t_this.models[index] = model;\n  \t\t\t\t\t_this.bubble();\n  \t\t\t\t});\n\n  \t\t\t\t_this.resolvers.push(resolver);\n  \t\t\t}\n\n  \t\t\treturn model;\n  \t\t});\n\n  \t\tthis.bubble();\n  \t}\n\n  \tExpressionProxy.prototype.bubble = function bubble() {\n  \t\tvar _this2 = this;\n\n  \t\tvar ractive = this.fragment.ractive;\n\n  \t\t// TODO the @ prevents computed props from shadowing keypaths, but the real\n  \t\t// question is why it's a computed prop in the first place... (hint, it's\n  \t\t// to do with {{else}} blocks)\n  \t\tvar key = '@' + this.template.s.replace(/_(\\d+)/g, function (match, i) {\n  \t\t\tif (i >= _this2.models.length) return match;\n\n  \t\t\tvar model = _this2.models[i];\n  \t\t\treturn model ? model.getKeypath() : '@undefined';\n  \t\t});\n\n  \t\t// TODO can/should we reuse computations?\n  \t\tvar signature = {\n  \t\t\tgetter: function () {\n  \t\t\t\tvar values = _this2.models.map(getValue);\n  \t\t\t\treturn _this2.fn.apply(ractive, values);\n  \t\t\t},\n  \t\t\tgetterString: key\n  \t\t};\n\n  \t\tvar computation = ractive.viewmodel.compute(key, signature);\n\n  \t\tthis.value = computation.get(); // TODO should not need this, eventually\n\n  \t\tif (this.computation) {\n  \t\t\tthis.computation.unregister(this);\n  \t\t\t// notify children...\n  \t\t}\n\n  \t\tthis.computation = computation;\n  \t\tcomputation.register(this);\n  \t};\n\n  \tExpressionProxy.prototype.get = function get() {\n  \t\treturn this.computation.get();\n  \t};\n\n  \tExpressionProxy.prototype.getKeypath = function getKeypath() {\n  \t\treturn this.computation ? this.computation.getKeypath() : '@undefined';\n  \t};\n\n  \tExpressionProxy.prototype.handleChange = function handleChange() {\n  \t\tthis.deps.forEach(_handleChange);\n  \t\tthis.children.forEach(_handleChange);\n\n  \t\tthis.clearUnresolveds();\n  \t};\n\n  \tExpressionProxy.prototype.joinKey = function joinKey(key) {\n  \t\tif (key === undefined || key === '') return this;\n\n  \t\tif (!this.childByKey.hasOwnProperty(key)) {\n  \t\t\tvar child = new ComputationChild(this, key);\n  \t\t\tthis.children.push(child);\n  \t\t\tthis.childByKey[key] = child;\n  \t\t}\n\n  \t\treturn this.childByKey[key];\n  \t};\n\n  \tExpressionProxy.prototype.mark = function mark() {\n  \t\tthis.handleChange();\n  \t};\n\n  \tExpressionProxy.prototype.retrieve = function retrieve() {\n  \t\treturn this.get();\n  \t};\n\n  \tExpressionProxy.prototype.unbind = function unbind() {\n  \t\tthis.resolvers.forEach(_unbind);\n  \t};\n\n  \treturn ExpressionProxy;\n  })(Model);\n\n  var ReferenceExpressionProxy = (function (_Model) {\n  \tinherits(ReferenceExpressionProxy, _Model);\n\n  \tfunction ReferenceExpressionProxy(fragment, template) {\n  \t\tvar _this = this;\n\n  \t\tclassCallCheck(this, ReferenceExpressionProxy);\n\n  \t\t_Model.call(this, null, null);\n  \t\tthis.root = fragment.ractive.viewmodel;\n\n  \t\tthis.resolvers = [];\n\n  \t\tthis.base = resolve$1(fragment, template);\n  \t\tvar baseResolver = undefined;\n\n  \t\tif (!this.base) {\n  \t\t\tbaseResolver = fragment.resolve(template.r, function (model) {\n  \t\t\t\t_this.base = model;\n  \t\t\t\t_this.bubble();\n\n  \t\t\t\tremoveFromArray(_this.resolvers, baseResolver);\n  \t\t\t});\n\n  \t\t\tthis.resolvers.push(baseResolver);\n  \t\t}\n\n  \t\tvar intermediary = {\n  \t\t\thandleChange: function () {\n  \t\t\t\treturn _this.bubble();\n  \t\t\t}\n  \t\t};\n\n  \t\tthis.members = template.m.map(function (template, i) {\n  \t\t\tif (typeof template === 'string') {\n  \t\t\t\treturn { get: function () {\n  \t\t\t\t\t\treturn template;\n  \t\t\t\t\t} };\n  \t\t\t}\n\n  \t\t\tvar model = undefined;\n  \t\t\tvar resolver = undefined;\n\n  \t\t\tif (template.t === REFERENCE) {\n  \t\t\t\tmodel = resolveReference(fragment, template.n);\n\n  \t\t\t\tif (model) {\n  \t\t\t\t\tmodel.register(intermediary);\n  \t\t\t\t} else {\n  \t\t\t\t\tresolver = fragment.resolve(template.n, function (model) {\n  \t\t\t\t\t\t_this.members[i] = model;\n\n  \t\t\t\t\t\tmodel.register(intermediary);\n  \t\t\t\t\t\t_this.bubble();\n\n  \t\t\t\t\t\tremoveFromArray(_this.resolvers, resolver);\n  \t\t\t\t\t});\n\n  \t\t\t\t\t_this.resolvers.push(resolver);\n  \t\t\t\t}\n\n  \t\t\t\treturn model;\n  \t\t\t}\n\n  \t\t\tmodel = new ExpressionProxy(fragment, template);\n  \t\t\tmodel.register(intermediary);\n  \t\t\treturn model;\n  \t\t});\n\n  \t\tthis.isUnresolved = true;\n  \t\tthis.bubble();\n  \t}\n\n  \tReferenceExpressionProxy.prototype.bubble = function bubble() {\n  \t\tif (!this.base) return;\n\n  \t\t// if some members are not resolved, abort\n  \t\tvar i = this.members.length;\n  \t\twhile (i--) {\n  \t\t\tif (!this.members[i] || this.members[i].get() === undefined) return;\n  \t\t}\n\n  \t\tthis.isUnresolved = false;\n\n  \t\tvar keys = this.members.map(function (model) {\n  \t\t\treturn model.get();\n  \t\t});\n  \t\tvar model = this.base.joinAll(keys);\n\n  \t\tif (this.model) {\n  \t\t\tthis.model.unregister(this);\n  \t\t\tthis.model.unregisterTwowayBinding(this);\n  \t\t}\n\n  \t\tthis.model = model;\n  \t\tthis.parent = model.parent;\n\n  \t\tmodel.register(this);\n  \t\tmodel.registerTwowayBinding(this);\n\n  \t\tif (this.keypathModel) this.keypathModel.handleChange();\n\n  \t\tthis.mark();\n  \t};\n\n  \tReferenceExpressionProxy.prototype.forceResolution = function forceResolution() {\n  \t\tthis.resolvers.forEach(function (resolver) {\n  \t\t\treturn resolver.forceResolution();\n  \t\t});\n  \t\tthis.bubble();\n  \t};\n\n  \tReferenceExpressionProxy.prototype.get = function get() {\n  \t\treturn this.model ? this.model.get() : undefined;\n  \t};\n\n  \t// indirect two-way bindings\n\n  \tReferenceExpressionProxy.prototype.getValue = function getValue() {\n  \t\tvar i = this.bindings.length;\n  \t\twhile (i--) {\n  \t\t\tvar value = this.bindings[i].getValue();\n  \t\t\tif (value !== this.value) return value;\n  \t\t}\n\n  \t\treturn this.value;\n  \t};\n\n  \tReferenceExpressionProxy.prototype.getKeypath = function getKeypath() {\n  \t\treturn this.model ? this.model.getKeypath() : '@undefined';\n  \t};\n\n  \tReferenceExpressionProxy.prototype.handleChange = function handleChange() {\n  \t\tthis.mark();\n  \t};\n\n  \tReferenceExpressionProxy.prototype.retrieve = function retrieve() {\n  \t\treturn this.get();\n  \t};\n\n  \tReferenceExpressionProxy.prototype.set = function set(value) {\n  \t\tif (!this.model) throw new Error('Unresolved reference expression. This should not happen!');\n  \t\tthis.model.set(value);\n  \t};\n\n  \tReferenceExpressionProxy.prototype.unbind = function unbind() {\n  \t\tthis.resolvers.forEach(_unbind);\n  \t};\n\n  \treturn ReferenceExpressionProxy;\n  })(Model);\n\n  function resolve$1(fragment, template) {\n  \tif (template.r) {\n  \t\treturn resolveReference(fragment, template.r);\n  \t} else if (template.x) {\n  \t\treturn new ExpressionProxy(fragment, template.x);\n  \t} else {\n  \t\treturn new ReferenceExpressionProxy(fragment, template.rx);\n  \t}\n  }\n\n  var Mustache = (function (_Item) {\n  \tinherits(Mustache, _Item);\n\n  \tfunction Mustache(options) {\n  \t\tclassCallCheck(this, Mustache);\n\n  \t\t_Item.call(this, options);\n\n  \t\tthis.parentFragment = options.parentFragment;\n  \t\tthis.template = options.template;\n  \t\tthis.index = options.index;\n\n  \t\tthis.isStatic = !!options.template.s;\n\n  \t\tthis.model = null;\n  \t\tthis.dirty = false;\n  \t}\n\n  \tMustache.prototype.bind = function bind() {\n  \t\tvar _this = this;\n\n  \t\t// try to find a model for this view\n  \t\tvar model = resolve$1(this.parentFragment, this.template);\n  \t\tvar value = model ? model.get() : undefined;\n\n  \t\tif (this.isStatic) {\n  \t\t\tthis.model = { get: function () {\n  \t\t\t\t\treturn value;\n  \t\t\t\t} };\n  \t\t\treturn;\n  \t\t}\n\n  \t\tif (model) {\n  \t\t\tmodel.register(this);\n  \t\t\tthis.model = model;\n  \t\t} else {\n  \t\t\tthis.resolver = this.parentFragment.resolve(this.template.r, function (model) {\n  \t\t\t\t_this.model = model;\n  \t\t\t\tmodel.register(_this);\n\n  \t\t\t\t_this.handleChange();\n  \t\t\t\t_this.resolver = null;\n  \t\t\t});\n  \t\t}\n  \t};\n\n  \tMustache.prototype.handleChange = function handleChange() {\n  \t\tthis.bubble();\n  \t};\n\n  \tMustache.prototype.rebind = function rebind() {\n  \t\tif (this.isStatic || !this.model) return;\n\n  \t\tvar model = resolve$1(this.parentFragment, this.template);\n\n  \t\tif (model === this.model) return;\n\n  \t\tvar oldValue = this.model.get();\n  \t\tthis.model.unregister(this);\n\n  \t\tthis.model = model;\n\n  \t\tif (model) {\n  \t\t\tmodel.register(this);\n  \t\t\tif (model.get() !== oldValue) this.handleChange();\n  \t\t}\n  \t};\n\n  \tMustache.prototype.unbind = function unbind() {\n  \t\tif (!this.isStatic) {\n  \t\t\tthis.model && this.model.unregister(this);\n  \t\t\tthis.resolver && this.resolver.unbind();\n  \t\t}\n  \t};\n\n  \treturn Mustache;\n  })(Item);\n\n  var Interpolator = (function (_Mustache) {\n  \tinherits(Interpolator, _Mustache);\n\n  \tfunction Interpolator() {\n  \t\tclassCallCheck(this, Interpolator);\n\n  \t\t_Mustache.apply(this, arguments);\n  \t}\n\n  \tInterpolator.prototype.detach = function detach() {\n  \t\treturn detachNode(this.node);\n  \t};\n\n  \tInterpolator.prototype.firstNode = function firstNode() {\n  \t\treturn this.node;\n  \t};\n\n  \tInterpolator.prototype.getString = function getString() {\n  \t\treturn this.model ? safeToStringValue(this.model.get()) : '';\n  \t};\n\n  \tInterpolator.prototype.render = function render(target) {\n  \t\tthis.rendered = true;\n  \t\tthis.node = doc.createTextNode(this.getString());\n\n  \t\ttarget.appendChild(this.node);\n  \t};\n\n  \tInterpolator.prototype.toString = function toString(escape) {\n  \t\tvar string = this.getString();\n  \t\treturn escape ? escapeHtml(string) : string;\n  \t};\n\n  \tInterpolator.prototype.unrender = function unrender(shouldDestroy) {\n  \t\tif (shouldDestroy) this.detach();\n  \t\tthis.rendered = false;\n  \t};\n\n  \tInterpolator.prototype.update = function update() {\n  \t\tif (this.dirty) {\n  \t\t\tif (this.rendered) {\n  \t\t\t\tthis.node.data = this.getString();\n  \t\t\t}\n\n  \t\t\tthis.dirty = false;\n  \t\t}\n  \t};\n\n  \tInterpolator.prototype.valueOf = function valueOf() {\n  \t\treturn this.model ? this.model.get() : undefined;\n  \t};\n\n  \treturn Interpolator;\n  })(Mustache);\n\n  function findInViewHierarchy(registryName, ractive, name) {\n  \tvar instance = findInstance(registryName, ractive, name);\n  \treturn instance ? instance[registryName][name] : null;\n  }\n\n  function findInstance(registryName, ractive, name) {\n  \twhile (ractive) {\n  \t\tif (name in ractive[registryName]) {\n  \t\t\treturn ractive;\n  \t\t}\n\n  \t\tif (ractive.isolated) {\n  \t\t\treturn null;\n  \t\t}\n\n  \t\tractive = ractive.parent;\n  \t}\n  }\n\n  function getPartialTemplate(ractive, name, parentFragment) {\n  \t// If the partial in instance or view heirarchy instances, great\n  \tvar partial = getPartialFromRegistry(ractive, name, parentFragment || {});\n  \tif (partial) return partial;\n\n  \t// Does it exist on the page as a script tag?\n  \tpartial = parser$1.fromId(name, { noThrow: true });\n  \tif (partial) {\n  \t\t// parse and register to this ractive instance\n  \t\tvar parsed = parser$1.parse(partial, parser$1.getParseOptions(ractive));\n\n  \t\t// register (and return main partial if there are others in the template)\n  \t\treturn ractive.partials[name] = parsed.t;\n  \t}\n  }\n\n  function getPartialFromRegistry(ractive, name, parentFragment) {\n  \t// if there was an instance up-hierarchy, cool\n  \tvar partial = findParentPartial(name, parentFragment.owner);\n  \tif (partial) return partial;\n\n  \t// find first instance in the ractive or view hierarchy that has this partial\n  \tvar instance = findInstance('partials', ractive, name);\n\n  \tif (!instance) {\n  \t\treturn;\n  \t}\n\n  \tpartial = instance.partials[name];\n\n  \t// partial is a function?\n  \tvar fn = undefined;\n  \tif (typeof partial === 'function') {\n  \t\tfn = partial.bind(instance);\n  \t\tfn.isOwner = instance.partials.hasOwnProperty(name);\n  \t\tpartial = fn.call(ractive, parser$1);\n  \t}\n\n  \tif (!partial && partial !== '') {\n  \t\twarnIfDebug(noRegistryFunctionReturn, name, 'partial', 'partial', { ractive: ractive });\n  \t\treturn;\n  \t}\n\n  \t// If this was added manually to the registry,\n  \t// but hasn't been parsed, parse it now\n  \tif (!parser$1.isParsed(partial)) {\n  \t\t// use the parseOptions of the ractive instance on which it was found\n  \t\tvar parsed = parser$1.parse(partial, parser$1.getParseOptions(instance));\n\n  \t\t// Partials cannot contain nested partials!\n  \t\t// TODO add a test for this\n  \t\tif (parsed.p) {\n  \t\t\twarnIfDebug('Partials ({{>%s}}) cannot contain nested inline partials', name, { ractive: ractive });\n  \t\t}\n\n  \t\t// if fn, use instance to store result, otherwise needs to go\n  \t\t// in the correct point in prototype chain on instance or constructor\n  \t\tvar target = fn ? instance : findOwner(instance, name);\n\n  \t\t// may be a template with partials, which need to be registered and main template extracted\n  \t\ttarget.partials[name] = partial = parsed.t;\n  \t}\n\n  \t// store for reset\n  \tif (fn) partial._fn = fn;\n\n  \treturn partial.v ? partial.t : partial;\n  }\n\n  function findOwner(ractive, key) {\n  \treturn ractive.partials.hasOwnProperty(key) ? ractive : findConstructor(ractive.constructor, key);\n  }\n\n  function findConstructor(constructor, key) {\n  \tif (!constructor) {\n  \t\treturn;\n  \t}\n  \treturn constructor.partials.hasOwnProperty(key) ? constructor : findConstructor(constructor._Parent, key);\n  }\n\n  function findParentPartial(name, parent) {\n  \tif (parent) {\n  \t\tif (parent.template && parent.template.p && parent.template.p[name]) {\n  \t\t\treturn parent.template.p[name];\n  \t\t} else if (parent.parentFragment && parent.parentFragment.owner) {\n  \t\t\treturn findParentPartial(name, parent.parentFragment.owner);\n  \t\t}\n  \t}\n  }\n\n  var Partial = (function (_Mustache) {\n  \tinherits(Partial, _Mustache);\n\n  \tfunction Partial() {\n  \t\tclassCallCheck(this, Partial);\n\n  \t\t_Mustache.apply(this, arguments);\n  \t}\n\n  \tPartial.prototype.bind = function bind() {\n  \t\t_Mustache.prototype.bind.call(this);\n\n  \t\t// keep track of the reference name for future resets\n  \t\tthis.refName = this.template.r;\n\n  \t\t// name matches take priority over expressions\n  \t\tvar template = this.refName ? getPartialTemplate(this.ractive, this.refName, this.parentFragment) || null : null;\n\n  \t\tif (template) {\n  \t\t\tthis.named = true;\n  \t\t\tthis.setTemplate(this.template.r, template);\n  \t\t} else if ((!this.model || typeof this.model.get() !== 'string') && this.refName) {\n  \t\t\tthis.setTemplate(this.refName, template);\n  \t\t} else {\n  \t\t\tthis.setTemplate(this.model.get());\n  \t\t}\n\n  \t\tthis.fragment = new Fragment({\n  \t\t\towner: this,\n  \t\t\ttemplate: this.partialTemplate\n  \t\t}).bind();\n  \t};\n\n  \tPartial.prototype.detach = function detach() {\n  \t\treturn this.fragment.detach();\n  \t};\n\n  \tPartial.prototype.find = function find(selector) {\n  \t\treturn this.fragment.find(selector);\n  \t};\n\n  \tPartial.prototype.findAll = function findAll(selector, query) {\n  \t\tthis.fragment.findAll(selector, query);\n  \t};\n\n  \tPartial.prototype.findComponent = function findComponent(name) {\n  \t\treturn this.fragment.findComponent(name);\n  \t};\n\n  \tPartial.prototype.findAllComponents = function findAllComponents(name, query) {\n  \t\tthis.fragment.findAllComponents(name, query);\n  \t};\n\n  \tPartial.prototype.firstNode = function firstNode() {\n  \t\treturn this.fragment.firstNode();\n  \t};\n\n  \tPartial.prototype.forceResetTemplate = function forceResetTemplate() {\n  \t\tthis.partialTemplate = undefined;\n\n  \t\t// on reset, check for the reference name first\n  \t\tif (this.refName) {\n  \t\t\tthis.partialTemplate = getPartialTemplate(this.ractive, this.refName, this.parentFragment);\n  \t\t}\n\n  \t\t// then look for the resolved name\n  \t\tif (!this.partialTemplate) {\n  \t\t\tthis.partialTemplate = getPartialTemplate(this.ractive, this.name, this.parentFragment);\n  \t\t}\n\n  \t\tif (!this.partialTemplate) {\n  \t\t\twarnOnceIfDebug('Could not find template for partial \\'' + this.name + '\\'');\n  \t\t\tthis.partialTemplate = [];\n  \t\t}\n\n  \t\tthis.fragment.resetTemplate(this.partialTemplate);\n  \t\tthis.bubble();\n  \t};\n\n  \tPartial.prototype.rebind = function rebind() {\n  \t\t_Mustache.prototype.unbind.call(this);\n  \t\t_Mustache.prototype.bind.call(this);\n  \t\tthis.fragment.rebind();\n  \t};\n\n  \tPartial.prototype.render = function render(target) {\n  \t\tthis.fragment.render(target);\n  \t};\n\n  \tPartial.prototype.setTemplate = function setTemplate(name, template) {\n  \t\tthis.name = name;\n\n  \t\tif (!template && template !== null) template = getPartialTemplate(this.ractive, name, this.parentFragment);\n\n  \t\tif (!template) {\n  \t\t\twarnOnceIfDebug('Could not find template for partial \\'' + name + '\\'');\n  \t\t}\n\n  \t\tthis.partialTemplate = template || [];\n  \t};\n\n  \tPartial.prototype.toString = function toString(escape) {\n  \t\treturn this.fragment.toString(escape);\n  \t};\n\n  \tPartial.prototype.unbind = function unbind() {\n  \t\t_Mustache.prototype.unbind.call(this);\n  \t\tthis.fragment.unbind();\n  \t};\n\n  \tPartial.prototype.unrender = function unrender(shouldDestroy) {\n  \t\tthis.fragment.unrender(shouldDestroy);\n  \t};\n\n  \tPartial.prototype.update = function update() {\n  \t\tif (this.dirty) {\n  \t\t\tif (!this.named) {\n  \t\t\t\tif (this.model && typeof this.model.get() === 'string' && this.model.get() !== this.name) {\n  \t\t\t\t\tthis.setTemplate(this.model.get());\n  \t\t\t\t\tthis.fragment.resetTemplate(this.partialTemplate);\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\tthis.fragment.update();\n  \t\t\tthis.dirty = false;\n  \t\t}\n  \t};\n\n  \treturn Partial;\n  })(Mustache);\n\n  function getRefs(ref, value, parent) {\n  \tvar refs = undefined;\n\n  \tif (ref) {\n  \t\trefs = {};\n  \t\tObject.keys(parent).forEach(function (ref) {\n  \t\t\trefs[ref] = parent[ref];\n  \t\t});\n  \t\trefs[ref] = value;\n  \t} else {\n  \t\trefs = parent;\n  \t}\n\n  \treturn refs;\n  }\n\n  var RepeatedFragment = (function () {\n  \tfunction RepeatedFragment(options) {\n  \t\tclassCallCheck(this, RepeatedFragment);\n\n  \t\tthis.parent = options.owner.parentFragment;\n\n  \t\t// bit of a hack, so reference resolution works without another\n  \t\t// layer of indirection\n  \t\tthis.parentFragment = this;\n  \t\tthis.owner = options.owner;\n  \t\tthis.ractive = this.parent.ractive;\n\n  \t\tthis.context = null;\n  \t\tthis.rendered = false;\n  \t\tthis.iterations = [];\n\n  \t\tthis.template = options.template;\n\n  \t\tthis.indexRef = options.indexRef;\n  \t\tthis.keyRef = options.keyRef;\n  \t\tthis.indexByKey = null; // for `{{#each object}}...`\n\n  \t\tthis.pendingNewIndices = null;\n  \t\tthis.previousIterations = null;\n\n  \t\t// track array versus object so updates of type rest\n  \t\tthis.isArray = false;\n  \t}\n\n  \tRepeatedFragment.prototype.bind = function bind(context) {\n  \t\tvar _this = this;\n\n  \t\tthis.context = context;\n  \t\tvar value = context.get();\n\n  \t\t// {{#each array}}...\n  \t\tif (this.isArray = isArray(value)) {\n  \t\t\t// we can't use map, because of sparse arrays\n  \t\t\tthis.iterations = [];\n  \t\t\tfor (var i = 0; i < value.length; i += 1) {\n  \t\t\t\tthis.iterations[i] = this.createIteration(i, i);\n  \t\t\t}\n  \t\t}\n\n  \t\t// {{#each object}}...\n  \t\telse if (isObject(value)) {\n  \t\t\t\tthis.isArray = false;\n\n  \t\t\t\t// TODO this is a dreadful hack. There must be a neater way\n  \t\t\t\tif (this.indexRef) {\n  \t\t\t\t\tvar refs = this.indexRef.split(',');\n  \t\t\t\t\tthis.keyRef = refs[0];\n  \t\t\t\t\tthis.indexRef = refs[1];\n  \t\t\t\t}\n\n  \t\t\t\tthis.indexByKey = {};\n  \t\t\t\tthis.iterations = Object.keys(value).map(function (key, index) {\n  \t\t\t\t\t_this.indexByKey[key] = index;\n  \t\t\t\t\treturn _this.createIteration(key, index);\n  \t\t\t\t});\n  \t\t\t}\n\n  \t\treturn this;\n  \t};\n\n  \tRepeatedFragment.prototype.bubble = function bubble() {\n  \t\tthis.owner.bubble();\n  \t};\n\n  \tRepeatedFragment.prototype.createIteration = function createIteration(key, index) {\n  \t\tvar parentFragment = this.owner.parentFragment;\n  \t\tvar keyRefs = getRefs(this.keyRef, key, parentFragment.keyRefs);\n  \t\tvar indexRefs = getRefs(this.indexRef, index, parentFragment.indexRefs);\n\n  \t\tvar fragment = new Fragment({\n  \t\t\towner: this,\n  \t\t\ttemplate: this.template,\n  \t\t\tindexRefs: indexRefs,\n  \t\t\tkeyRefs: keyRefs\n  \t\t});\n\n  \t\t// TODO this is a bit hacky\n  \t\tfragment.key = key;\n  \t\tfragment.index = index;\n  \t\tfragment.isIteration = true;\n\n  \t\tvar model = this.context.joinKey(key);\n  \t\treturn fragment.bind(model);\n  \t};\n\n  \tRepeatedFragment.prototype.detach = function detach() {\n  \t\tvar docFrag = createDocumentFragment();\n  \t\tthis.iterations.forEach(function (fragment) {\n  \t\t\treturn docFrag.appendChild(fragment.detach());\n  \t\t});\n  \t\treturn docFrag;\n  \t};\n\n  \tRepeatedFragment.prototype.find = function find(selector) {\n  \t\tvar len = this.iterations.length;\n  \t\tvar i = undefined;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tvar found = this.iterations[i].find(selector);\n  \t\t\tif (found) return found;\n  \t\t}\n  \t};\n\n  \tRepeatedFragment.prototype.findAll = function findAll(selector, query) {\n  \t\tvar len = this.iterations.length;\n  \t\tvar i = undefined;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tthis.iterations[i].findAll(selector, query);\n  \t\t}\n  \t};\n\n  \tRepeatedFragment.prototype.findComponent = function findComponent(name) {\n  \t\tvar len = this.iterations.length;\n  \t\tvar i = undefined;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tvar found = this.iterations[i].findComponent(name);\n  \t\t\tif (found) return found;\n  \t\t}\n  \t};\n\n  \tRepeatedFragment.prototype.findAllComponents = function findAllComponents(name, query) {\n  \t\tvar len = this.iterations.length;\n  \t\tvar i = undefined;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tthis.iterations[i].findAllComponents(name, query);\n  \t\t}\n  \t};\n\n  \tRepeatedFragment.prototype.findNextNode = function findNextNode(iteration) {\n  \t\tif (iteration.index < this.iterations.length - 1) {\n  \t\t\treturn this.iterations[iteration.index + 1].firstNode();\n  \t\t}\n\n  \t\treturn this.owner.findNextNode();\n  \t};\n\n  \tRepeatedFragment.prototype.firstNode = function firstNode() {\n  \t\treturn this.iterations[0] ? this.iterations[0].firstNode() : null;\n  \t};\n\n  \tRepeatedFragment.prototype.rebind = function rebind(context) {\n  \t\tthis.context = context;\n\n  \t\t// {{#each array}}...\n  \t\tif (isArray(context.get())) {\n  \t\t\tthis.iterations.forEach(function (fragment, i) {\n  \t\t\t\tfragment.rebind(context.joinKey(i));\n  \t\t\t});\n  \t\t}\n  \t};\n\n  \tRepeatedFragment.prototype.render = function render(target) {\n  \t\t// TODO use docFrag.cloneNode...\n\n  \t\tif (this.iterations) {\n  \t\t\tthis.iterations.forEach(function (fragment) {\n  \t\t\t\treturn fragment.render(target);\n  \t\t\t});\n  \t\t}\n\n  \t\tthis.rendered = true;\n  \t};\n\n  \tRepeatedFragment.prototype.shuffle = function shuffle(newIndices) {\n  \t\tvar _this2 = this;\n\n  \t\tif (this.pendingNewIndices) {\n  \t\t\tthrow new Error('Section was already shuffled!');\n  \t\t}\n\n  \t\tthis.pendingNewIndices = newIndices;\n  \t\tthis.previousIterations = this.iterations.slice();\n\n  \t\tvar iterations = [];\n\n  \t\tnewIndices.forEach(function (newIndex, oldIndex) {\n  \t\t\tif (newIndex === -1) return;\n\n  \t\t\tvar fragment = _this2.iterations[oldIndex];\n  \t\t\titerations[newIndex] = fragment;\n\n  \t\t\tif (newIndex !== oldIndex) fragment.dirty = true;\n  \t\t});\n\n  \t\tthis.iterations = iterations;\n  \t\tthis.bubble();\n  \t};\n\n  \tRepeatedFragment.prototype.toString = function toString(escape) {\n  \t\treturn this.iterations ? this.iterations.map(escape ? toEscapedString : _toString).join('') : '';\n  \t};\n\n  \tRepeatedFragment.prototype.unbind = function unbind() {\n  \t\tthis.iterations.forEach(_unbind);\n  \t\treturn this;\n  \t};\n\n  \tRepeatedFragment.prototype.unrender = function unrender(shouldDestroy) {\n  \t\tthis.iterations.forEach(shouldDestroy ? unrenderAndDestroy$1 : _unrender);\n  \t\tthis.rendered = false;\n  \t};\n\n  \t// TODO smart update\n\n  \tRepeatedFragment.prototype.update = function update() {\n  \t\tvar _this3 = this;\n\n  \t\t// skip dirty check, since this is basically just a facade\n\n  \t\tif (this.pendingNewIndices) {\n  \t\t\tthis.updatePostShuffle();\n  \t\t\treturn;\n  \t\t}\n\n  \t\tvar value = this.context.get(),\n  \t\t    wasArray = this.isArray;\n\n  \t\tvar toRemove = undefined;\n  \t\tvar oldKeys = undefined;\n  \t\tvar reset = true;\n  \t\tvar i = undefined;\n\n  \t\tif (this.isArray = isArray(value)) {\n  \t\t\tif (wasArray) {\n  \t\t\t\treset = false;\n  \t\t\t\tif (this.iterations.length > value.length) {\n  \t\t\t\t\ttoRemove = this.iterations.splice(value.length);\n  \t\t\t\t}\n  \t\t\t}\n  \t\t} else if (isObject(value) && !wasArray) {\n  \t\t\treset = false;\n  \t\t\ttoRemove = [];\n  \t\t\toldKeys = {};\n  \t\t\ti = this.iterations.length;\n\n  \t\t\twhile (i--) {\n  \t\t\t\tvar _fragment = this.iterations[i];\n  \t\t\t\tif (_fragment.key in value) {\n  \t\t\t\t\toldKeys[_fragment.key] = true;\n  \t\t\t\t} else {\n  \t\t\t\t\tthis.iterations.splice(i, 1);\n  \t\t\t\t\ttoRemove.push(_fragment);\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\tif (reset) {\n  \t\t\ttoRemove = this.iterations;\n  \t\t\tthis.iterations = [];\n  \t\t}\n\n  \t\tif (toRemove) {\n  \t\t\ttoRemove.forEach(function (fragment) {\n  \t\t\t\tfragment.unbind();\n  \t\t\t\tfragment.unrender(true);\n  \t\t\t});\n  \t\t}\n\n  \t\t// update the remaining ones\n  \t\tthis.iterations.forEach(_update);\n\n  \t\t// add new iterations\n  \t\tvar newLength = isArray(value) ? value.length : isObject(value) ? Object.keys(value).length : 0;\n\n  \t\tvar docFrag = undefined;\n  \t\tvar fragment = undefined;\n\n  \t\tif (newLength > this.iterations.length) {\n  \t\t\tdocFrag = this.rendered ? createDocumentFragment() : null;\n  \t\t\ti = this.iterations.length;\n\n  \t\t\tif (isArray(value)) {\n  \t\t\t\twhile (i < value.length) {\n  \t\t\t\t\tfragment = this.createIteration(i, i);\n\n  \t\t\t\t\tthis.iterations.push(fragment);\n  \t\t\t\t\tif (this.rendered) fragment.render(docFrag);\n\n  \t\t\t\t\ti += 1;\n  \t\t\t\t}\n  \t\t\t} else if (isObject(value)) {\n  \t\t\t\tObject.keys(value).forEach(function (key) {\n  \t\t\t\t\tif (!oldKeys || !(key in oldKeys)) {\n  \t\t\t\t\t\tfragment = _this3.createIteration(key, i);\n\n  \t\t\t\t\t\t_this3.iterations.push(fragment);\n  \t\t\t\t\t\tif (_this3.rendered) fragment.render(docFrag);\n\n  \t\t\t\t\t\ti += 1;\n  \t\t\t\t\t}\n  \t\t\t\t});\n  \t\t\t}\n\n  \t\t\tif (this.rendered) {\n  \t\t\t\tvar parentNode = this.parent.findParentNode();\n  \t\t\t\tvar anchor = this.parent.findNextNode(this.owner);\n\n  \t\t\t\tparentNode.insertBefore(docFrag, anchor);\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tRepeatedFragment.prototype.updatePostShuffle = function updatePostShuffle() {\n  \t\tvar _this4 = this;\n\n  \t\tvar newIndices = this.pendingNewIndices;\n\n  \t\t// This algorithm (for detaching incorrectly-ordered fragments from the DOM and\n  \t\t// storing them in a document fragment for later reinsertion) seems a bit hokey,\n  \t\t// but it seems to work for now\n  \t\tvar previousNewIndex = -1;\n  \t\tvar reinsertFrom = null;\n\n  \t\tnewIndices.forEach(function (newIndex, oldIndex) {\n  \t\t\tvar fragment = _this4.previousIterations[oldIndex];\n\n  \t\t\tif (newIndex === -1) {\n  \t\t\t\tfragment.unbind().unrender(true);\n  \t\t\t} else {\n  \t\t\t\tfragment.index = newIndex;\n  \t\t\t\tfragment.rebind(_this4.context.joinKey(newIndex));\n\n  \t\t\t\tif (reinsertFrom === null && newIndex !== previousNewIndex + 1) {\n  \t\t\t\t\treinsertFrom = oldIndex;\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\tpreviousNewIndex = newIndex;\n  \t\t});\n\n  \t\t// create new iterations\n  \t\tvar docFrag = this.rendered ? createDocumentFragment() : null;\n  \t\tvar parentNode = this.rendered ? this.parent.findParentNode() : null;\n\n  \t\tvar len = this.context.get().length;\n  \t\tvar i = undefined;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tvar existingFragment = this.iterations[i];\n\n  \t\t\tif (this.rendered) {\n  \t\t\t\tif (existingFragment) {\n  \t\t\t\t\tif (reinsertFrom !== null && i >= reinsertFrom) {\n  \t\t\t\t\t\tdocFrag.appendChild(existingFragment.detach());\n  \t\t\t\t\t} else if (docFrag.childNodes.length) {\n  \t\t\t\t\t\tparentNode.insertBefore(docFrag, existingFragment.firstNode());\n  \t\t\t\t\t}\n  \t\t\t\t} else {\n  \t\t\t\t\tthis.iterations[i] = this.createIteration(i, i);\n  \t\t\t\t\tthis.iterations[i].render(docFrag);\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\tif (!this.rendered) {\n  \t\t\t\tif (!existingFragment) {\n  \t\t\t\t\tthis.iterations[i] = this.createIteration(i, i);\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\tif (this.rendered && docFrag.childNodes.length) {\n  \t\t\tparentNode.insertBefore(docFrag, this.owner.findNextNode());\n  \t\t}\n\n  \t\tthis.iterations.forEach(_update);\n\n  \t\tthis.pendingNewIndices = null;\n  \t};\n\n  \treturn RepeatedFragment;\n  })();\n\n  function isEmpty(value) {\n  \treturn !value || isArray(value) && value.length === 0 || isObject(value) && Object.keys(value).length === 0;\n  }\n\n  function getType(value, hasIndexRef) {\n  \tif (hasIndexRef || isArray(value)) return SECTION_EACH;\n  \tif (isObject(value) || typeof value === 'function') return SECTION_WITH;\n  \tif (value === undefined) return null;\n  \treturn SECTION_IF;\n  }\n\n  var Section = (function (_Mustache) {\n  \tinherits(Section, _Mustache);\n\n  \tfunction Section(options) {\n  \t\tclassCallCheck(this, Section);\n\n  \t\t_Mustache.call(this, options);\n\n  \t\tthis.sectionType = options.template.n || null;\n  \t\tthis.fragment = null;\n  \t}\n\n  \tSection.prototype.bind = function bind() {\n  \t\t_Mustache.prototype.bind.call(this);\n\n  \t\t// if we managed to bind, we need to create children\n  \t\tif (this.model) {\n  \t\t\tvar value = this.model.parent ? this.model.get() : this.model.value;\n  \t\t\tvar fragment = undefined;\n\n  \t\t\tif (!this.sectionType) this.sectionType = getType(value, this.template.i);\n\n  \t\t\tif (isEmpty(value) && this.sectionType !== SECTION_WITH) {\n  \t\t\t\t// TODO again, WITH should not render if empty\n  \t\t\t\tif (this.sectionType === SECTION_UNLESS) {\n  \t\t\t\t\tthis.fragment = new Fragment({\n  \t\t\t\t\t\towner: this,\n  \t\t\t\t\t\ttemplate: this.template.f\n  \t\t\t\t\t}).bind();\n  \t\t\t\t}\n\n  \t\t\t\t// otherwise, create no children\n  \t\t\t\treturn;\n  \t\t\t}\n\n  \t\t\tif (this.sectionType === SECTION_UNLESS) return;\n\n  \t\t\tif (this.sectionType === SECTION_IF) {\n  \t\t\t\tfragment = new Fragment({\n  \t\t\t\t\towner: this,\n  \t\t\t\t\ttemplate: this.template.f\n  \t\t\t\t}).bind();\n  \t\t\t}\n\n  \t\t\t// TODO should only be WITH, and it should behave like IF_WITH\n  \t\t\telse if (this.sectionType === SECTION_WITH || this.sectionType === SECTION_IF_WITH) {\n  \t\t\t\t\tfragment = new Fragment({\n  \t\t\t\t\t\towner: this,\n  \t\t\t\t\t\ttemplate: this.template.f\n  \t\t\t\t\t}).bind(this.model);\n  \t\t\t\t} else {\n  \t\t\t\t\tfragment = new RepeatedFragment({\n  \t\t\t\t\t\towner: this,\n  \t\t\t\t\t\ttemplate: this.template.f,\n  \t\t\t\t\t\tindexRef: this.template.i\n  \t\t\t\t\t}).bind(this.model);\n  \t\t\t\t}\n\n  \t\t\tthis.fragment = fragment;\n  \t\t} else if (this.sectionType && this.sectionType === SECTION_UNLESS) {\n  \t\t\tthis.fragment = new Fragment({\n  \t\t\t\towner: this,\n  \t\t\t\ttemplate: this.template.f\n  \t\t\t}).bind();\n  \t\t}\n  \t};\n\n  \tSection.prototype.detach = function detach() {\n  \t\treturn this.fragment ? this.fragment.detach() : createDocumentFragment();\n  \t};\n\n  \tSection.prototype.find = function find(selector) {\n  \t\tif (this.fragment) {\n  \t\t\treturn this.fragment.find(selector);\n  \t\t}\n  \t};\n\n  \tSection.prototype.findAll = function findAll(selector, query) {\n  \t\tif (this.fragment) {\n  \t\t\tthis.fragment.findAll(selector, query);\n  \t\t}\n  \t};\n\n  \tSection.prototype.findComponent = function findComponent(name) {\n  \t\tif (this.fragment) {\n  \t\t\treturn this.fragment.findComponent(name);\n  \t\t}\n  \t};\n\n  \tSection.prototype.findAllComponents = function findAllComponents(name, query) {\n  \t\tif (this.fragment) {\n  \t\t\tthis.fragment.findAllComponents(name, query);\n  \t\t}\n  \t};\n\n  \tSection.prototype.firstNode = function firstNode() {\n  \t\treturn this.fragment && this.fragment.firstNode();\n  \t};\n\n  \tSection.prototype.rebind = function rebind() {\n  \t\t_Mustache.prototype.rebind.call(this);\n\n  \t\tif (this.fragment) {\n  \t\t\tthis.fragment.rebind(this.sectionType === SECTION_IF ? null : this.model);\n  \t\t}\n  \t};\n\n  \tSection.prototype.render = function render(target) {\n  \t\tthis.rendered = true;\n  \t\tif (this.fragment) this.fragment.render(target);\n  \t};\n\n  \tSection.prototype.shuffle = function shuffle(newIndices) {\n  \t\tif (this.fragment && this.sectionType === SECTION_EACH) {\n  \t\t\tthis.fragment.shuffle(newIndices);\n  \t\t}\n  \t};\n\n  \tSection.prototype.toString = function toString(escape) {\n  \t\treturn this.fragment ? this.fragment.toString(escape) : '';\n  \t};\n\n  \tSection.prototype.unbind = function unbind() {\n  \t\t_Mustache.prototype.unbind.call(this);\n  \t\tif (this.fragment) this.fragment.unbind();\n  \t};\n\n  \tSection.prototype.unrender = function unrender(shouldDestroy) {\n  \t\tif (this.rendered && this.fragment) this.fragment.unrender(shouldDestroy);\n  \t\tthis.rendered = false;\n  \t};\n\n  \t// TODO DRY this out - lot of repeated stuff between this and bind()\n\n  \tSection.prototype.update = function update() {\n  \t\tif (!this.dirty) return;\n  \t\tif (!this.model) return; // TODO can this happen?\n\n  \t\tvar value = this.model.get();\n\n  \t\tif (this.sectionType === null) this.sectionType = getType(value, this.template.i);\n\n  \t\tvar newFragment = undefined;\n\n  \t\tif (this.sectionType === SECTION_EACH) {\n  \t\t\tif (this.fragment) {\n  \t\t\t\tthis.fragment.update();\n  \t\t\t} else {\n  \t\t\t\t// TODO can this happen?\n  \t\t\t\tnewFragment = new RepeatedFragment({\n  \t\t\t\t\towner: this,\n  \t\t\t\t\ttemplate: this.template.f,\n  \t\t\t\t\tindexRef: this.template.i\n  \t\t\t\t}).bind(this.model);\n  \t\t\t}\n  \t\t}\n\n  \t\t// TODO same comment as before - WITH should be IF_WITH\n  \t\telse if (this.sectionType === SECTION_WITH) {\n  \t\t\t\tif (this.fragment) {\n  \t\t\t\t\tthis.fragment.update();\n  \t\t\t\t} else {\n  \t\t\t\t\tnewFragment = new Fragment({\n  \t\t\t\t\t\towner: this,\n  \t\t\t\t\t\ttemplate: this.template.f\n  \t\t\t\t\t}).bind(this.model);\n  \t\t\t\t}\n  \t\t\t} else if (this.sectionType === SECTION_IF_WITH) {\n  \t\t\t\tif (this.fragment) {\n  \t\t\t\t\tif (isEmpty(value)) {\n  \t\t\t\t\t\tif (this.rendered) {\n  \t\t\t\t\t\t\tthis.fragment.unbind().unrender(true);\n  \t\t\t\t\t\t}\n\n  \t\t\t\t\t\tthis.fragment = null;\n  \t\t\t\t\t} else {\n  \t\t\t\t\t\tthis.fragment.update();\n  \t\t\t\t\t}\n  \t\t\t\t} else if (!isEmpty(value)) {\n  \t\t\t\t\tnewFragment = new Fragment({\n  \t\t\t\t\t\towner: this,\n  \t\t\t\t\t\ttemplate: this.template.f\n  \t\t\t\t\t}).bind(this.model);\n  \t\t\t\t}\n  \t\t\t} else {\n  \t\t\t\tvar fragmentShouldExist = this.sectionType === SECTION_UNLESS ? isEmpty(value) : !!value;\n\n  \t\t\t\tif (this.fragment) {\n  \t\t\t\t\tif (fragmentShouldExist) {\n  \t\t\t\t\t\tthis.fragment.update();\n  \t\t\t\t\t} else {\n  \t\t\t\t\t\tif (this.rendered) {\n  \t\t\t\t\t\t\tthis.fragment.unbind().unrender(true);\n  \t\t\t\t\t\t}\n\n  \t\t\t\t\t\tthis.fragment = null;\n  \t\t\t\t\t}\n  \t\t\t\t} else if (fragmentShouldExist) {\n  \t\t\t\t\tnewFragment = new Fragment({\n  \t\t\t\t\t\towner: this,\n  \t\t\t\t\t\ttemplate: this.template.f\n  \t\t\t\t\t}).bind(null);\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\tif (newFragment) {\n  \t\t\tif (this.rendered) {\n  \t\t\t\tvar parentNode = this.parentFragment.findParentNode();\n  \t\t\t\tvar anchor = this.parentFragment.findNextNode(this);\n\n  \t\t\t\tif (anchor) {\n  \t\t\t\t\tvar docFrag = createDocumentFragment();\n  \t\t\t\t\tnewFragment.render(docFrag);\n\n  \t\t\t\t\t// we use anchor.parentNode, not parentNode, because the sibling\n  \t\t\t\t\t// may be temporarily detached as a result of a shuffle\n  \t\t\t\t\tanchor.parentNode.insertBefore(docFrag, anchor);\n  \t\t\t\t} else {\n  \t\t\t\t\tnewFragment.render(parentNode);\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\tthis.fragment = newFragment;\n  \t\t}\n\n  \t\tthis.dirty = false;\n  \t};\n\n  \treturn Section;\n  })(Mustache);\n\n  var elementCache = {};\n\n  var ieBug = undefined;\n  var ieBlacklist = undefined;\n\n  try {\n  \tcreateElement('table').innerHTML = 'foo';\n  } catch (err) {\n  \tieBug = true;\n\n  \tieBlacklist = {\n  \t\tTABLE: ['<table class=\"x\">', '</table>'],\n  \t\tTHEAD: ['<table><thead class=\"x\">', '</thead></table>'],\n  \t\tTBODY: ['<table><tbody class=\"x\">', '</tbody></table>'],\n  \t\tTR: ['<table><tr class=\"x\">', '</tr></table>'],\n  \t\tSELECT: ['<select class=\"x\">', '</select>']\n  \t};\n  }\n\n  function insertHtml (html, node, docFrag) {\n  \tvar nodes = [];\n\n  \t// render 0 and false\n  \tif (html == null || html === '') return nodes;\n\n  \tvar container = undefined;\n  \tvar wrapper = undefined;\n  \tvar selectedOption = undefined;\n\n  \tif (ieBug && (wrapper = ieBlacklist[node.tagName])) {\n  \t\tcontainer = element$1('DIV');\n  \t\tcontainer.innerHTML = wrapper[0] + html + wrapper[1];\n  \t\tcontainer = container.querySelector('.x');\n\n  \t\tif (container.tagName === 'SELECT') {\n  \t\t\tselectedOption = container.options[container.selectedIndex];\n  \t\t}\n  \t} else if (node.namespaceURI === svg$1) {\n  \t\tcontainer = element$1('DIV');\n  \t\tcontainer.innerHTML = '<svg class=\"x\">' + html + '</svg>';\n  \t\tcontainer = container.querySelector('.x');\n  \t} else {\n  \t\tcontainer = element$1(node.tagName);\n  \t\tcontainer.innerHTML = html;\n\n  \t\tif (container.tagName === 'SELECT') {\n  \t\t\tselectedOption = container.options[container.selectedIndex];\n  \t\t}\n  \t}\n\n  \tvar child = undefined;\n  \twhile (child = container.firstChild) {\n  \t\tnodes.push(child);\n  \t\tdocFrag.appendChild(child);\n  \t}\n\n  \t// This is really annoying. Extracting <option> nodes from the\n  \t// temporary container <select> causes the remaining ones to\n  \t// become selected. So now we have to deselect them. IE8, you\n  \t// amaze me. You really do\n  \t// ...and now Chrome too\n  \tvar i = undefined;\n  \tif (node.tagName === 'SELECT') {\n  \t\ti = nodes.length;\n  \t\twhile (i--) {\n  \t\t\tif (nodes[i] !== selectedOption) {\n  \t\t\t\tnodes[i].selected = false;\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \treturn nodes;\n  }\n\n  function element$1(tagName) {\n  \treturn elementCache[tagName] || (elementCache[tagName] = createElement(tagName));\n  }\n\n  var Triple = (function (_Mustache) {\n  \tinherits(Triple, _Mustache);\n\n  \tfunction Triple(options) {\n  \t\tclassCallCheck(this, Triple);\n\n  \t\t_Mustache.call(this, options);\n  \t}\n\n  \tTriple.prototype.detach = function detach() {\n  \t\tvar docFrag = createDocumentFragment();\n  \t\tthis.nodes.forEach(function (node) {\n  \t\t\treturn docFrag.appendChild(node);\n  \t\t});\n  \t\treturn docFrag;\n  \t};\n\n  \tTriple.prototype.find = function find(selector) {\n  \t\tvar len = this.nodes.length;\n  \t\tvar i = undefined;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tvar node = this.nodes[i];\n\n  \t\t\tif (node.nodeType !== 1) continue;\n\n  \t\t\tif (matches(node, selector)) return node;\n\n  \t\t\tvar queryResult = node.querySelector(selector);\n  \t\t\tif (queryResult) return queryResult;\n  \t\t}\n\n  \t\treturn null;\n  \t};\n\n  \tTriple.prototype.findAll = function findAll(selector, query) {\n  \t\tvar len = this.nodes.length;\n  \t\tvar i = undefined;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tvar node = this.nodes[i];\n\n  \t\t\tif (node.nodeType !== 1) continue;\n\n  \t\t\tif (query.test(node)) query.add(node);\n\n  \t\t\tvar queryAllResult = node.querySelectorAll(selector);\n  \t\t\tif (queryAllResult) {\n  \t\t\t\tvar numNodes = queryAllResult.length;\n  \t\t\t\tvar j = undefined;\n\n  \t\t\t\tfor (j = 0; j < numNodes; j += 1) {\n  \t\t\t\t\tquery.add(queryAllResult[j]);\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tTriple.prototype.findComponent = function findComponent() {\n  \t\treturn null;\n  \t};\n\n  \tTriple.prototype.firstNode = function firstNode() {\n  \t\treturn this.nodes[0];\n  \t};\n\n  \tTriple.prototype.render = function render(target) {\n  \t\tvar html = this.model ? this.model.get() : '';\n  \t\tthis.nodes = insertHtml(html, this.parentFragment.findParentNode(), target);\n  \t\tthis.rendered = true;\n  \t};\n\n  \tTriple.prototype.toString = function toString() {\n  \t\treturn this.model && this.model.get() != null ? decodeCharacterReferences('' + this.model.get()) : '';\n  \t};\n\n  \tTriple.prototype.unrender = function unrender() {\n  \t\tif (this.nodes) this.nodes.forEach(function (node) {\n  \t\t\treturn detachNode(node);\n  \t\t});\n  \t\tthis.rendered = false;\n  \t};\n\n  \tTriple.prototype.update = function update() {\n  \t\tif (this.rendered && this.dirty) {\n  \t\t\tthis.unrender();\n  \t\t\tvar docFrag = createDocumentFragment();\n  \t\t\tthis.render(docFrag);\n\n  \t\t\tvar parentNode = this.parentFragment.findParentNode();\n  \t\t\tvar anchor = this.parentFragment.findNextNode(this);\n\n  \t\t\tparentNode.insertBefore(docFrag, anchor);\n\n  \t\t\tthis.dirty = false;\n  \t\t}\n  \t};\n\n  \treturn Triple;\n  })(Mustache);\n\n  var Yielder = (function (_Item) {\n  \tinherits(Yielder, _Item);\n\n  \tfunction Yielder(options) {\n  \t\tclassCallCheck(this, Yielder);\n\n  \t\t_Item.call(this, options);\n\n  \t\tthis.container = options.parentFragment.ractive;\n  \t\tthis.component = this.container.component;\n\n  \t\tthis.containerFragment = options.parentFragment;\n  \t\tthis.parentFragment = this.component.parentFragment;\n\n  \t\t// {{yield}} is equivalent to {{yield content}}\n  \t\tthis.name = options.template.n || '';\n  \t}\n\n  \tYielder.prototype.bind = function bind() {\n  \t\tvar name = this.name;\n\n  \t\t(this.component.yielders[name] || (this.component.yielders[name] = [])).push(this);\n\n  \t\t// TODO don't parse here\n  \t\tvar template = this.container._inlinePartials[name || 'content'];\n\n  \t\tif (typeof template === 'string') {\n  \t\t\ttemplate = parse(template).t;\n  \t\t}\n\n  \t\tif (!template) {\n  \t\t\twarnIfDebug('Could not find template for partial \"' + name + '\"', { ractive: this.ractive });\n  \t\t\ttemplate = [];\n  \t\t}\n\n  \t\tthis.fragment = new Fragment({\n  \t\t\towner: this,\n  \t\t\tractive: this.container.parent,\n  \t\t\ttemplate: template\n  \t\t}).bind();\n  \t};\n\n  \tYielder.prototype.detach = function detach() {\n  \t\treturn this.fragment.detach();\n  \t};\n\n  \tYielder.prototype.find = function find(selector) {\n  \t\treturn this.fragment.find(selector);\n  \t};\n\n  \tYielder.prototype.findAll = function findAll(selector, queryResult) {\n  \t\tthis.fragment.find(selector, queryResult);\n  \t};\n\n  \tYielder.prototype.findComponent = function findComponent(name) {\n  \t\treturn this.fragment.findComponent(name);\n  \t};\n\n  \tYielder.prototype.findAllComponents = function findAllComponents(name, queryResult) {\n  \t\tthis.fragment.findAllComponents(name, queryResult);\n  \t};\n\n  \tYielder.prototype.firstNode = function firstNode() {\n  \t\treturn this.fragment.firstNode();\n  \t};\n\n  \tYielder.prototype.rebind = function rebind() {\n  \t\tthrow new Error('Yielder$rebind is not yet implemented!');\n  \t};\n\n  \tYielder.prototype.render = function render(target) {\n  \t\treturn this.fragment.render(target);\n  \t};\n\n  \tYielder.prototype.setTemplate = function setTemplate(name) {\n  \t\tvar template = this.parentFragment.ractive.partials[name];\n\n  \t\tif (typeof template === 'string') {\n  \t\t\ttemplate = parse(template).t;\n  \t\t}\n\n  \t\tthis.partialTemplate = template || []; // TODO warn on missing partial\n  \t};\n\n  \tYielder.prototype.toString = function toString(escape) {\n  \t\treturn this.fragment.toString(escape);\n  \t};\n\n  \tYielder.prototype.unbind = function unbind() {\n  \t\tthis.fragment.unbind();\n  \t\tremoveFromArray(this.component.yielders[this.name], this);\n  \t};\n\n  \tYielder.prototype.unrender = function unrender(shouldDestroy) {\n  \t\tthis.fragment.unrender(shouldDestroy);\n  \t};\n\n  \tYielder.prototype.update = function update() {\n  \t\tthis.fragment.update();\n  \t};\n\n  \treturn Yielder;\n  })(Item);\n\n  function determineNameAndNamespace (attribute, name) {\n  \t// are we dealing with a namespaced attribute, e.g. xlink:href?\n  \tvar colonIndex = name.indexOf(':');\n  \tif (colonIndex !== -1) {\n  \t\t// looks like we are, yes...\n  \t\tvar namespacePrefix = name.substr(0, colonIndex);\n\n  \t\t// ...unless it's a namespace *declaration*, which we ignore (on the assumption\n  \t\t// that only valid namespaces will be used)\n  \t\tif (namespacePrefix !== 'xmlns') {\n  \t\t\tname = name.substring(colonIndex + 1);\n\n  \t\t\tattribute.name = name;\n  \t\t\tattribute.namespace = namespaces[namespacePrefix.toLowerCase()];\n  \t\t\tattribute.namespacePrefix = namespacePrefix;\n\n  \t\t\tif (!attribute.namespace) {\n  \t\t\t\tthrow 'Unknown namespace (\"' + namespacePrefix + '\")';\n  \t\t\t}\n\n  \t\t\treturn;\n  \t\t}\n  \t}\n\n  \tattribute.name = name;\n  }\n\n  function getUpdateDelegate(attribute) {\n  \tvar element = attribute.element;\n  \tvar name = attribute.name;\n\n  \tif (name === 'id') return updateId;\n\n  \tif (name === 'value') {\n  \t\t// special case - selects\n  \t\tif (element.name === 'select' && name === 'value') {\n  \t\t\treturn element.getAttribute('multiple') ? updateMultipleSelectValue : updateSelectValue;\n  \t\t}\n\n  \t\tif (element.name === 'textarea') return updateValue;\n\n  \t\t// special case - contenteditable\n  \t\tif (element.getAttribute('contenteditable') != null) return updateContentEditableValue;\n\n  \t\t// special case - <input>\n  \t\tif (element.name === 'input') {\n  \t\t\tvar type = element.getAttribute('type');\n\n  \t\t\t// type='file' value='{{fileList}}'>\n  \t\t\tif (type === 'file') return noop; // read-only\n\n  \t\t\t// type='radio' name='{{twoway}}'\n  \t\t\tif (type === 'radio' && element.binding && element.binding.attribute.name === 'name') return updateRadioValue;\n  \t\t}\n\n  \t\treturn updateValue;\n  \t}\n\n  \tvar node = element.node;\n\n  \t// special case - <input type='radio' name='{{twoway}}' value='foo'>\n  \tif (attribute.isTwoway && name === 'name') {\n  \t\tif (node.type === 'radio') return updateRadioName;\n  \t\tif (node.type === 'checkbox') return updateCheckboxName;\n  \t}\n\n  \t// special case - style attributes in Internet Exploder\n  \tif (name === 'style' && node.style.setAttribute) return updateIEStyleAttribute;\n\n  \t// special case - class names. IE fucks things up, again\n  \tif (name === 'class' && (!node.namespaceURI || node.namespaceURI === html)) return updateClassName;\n\n  \tif (attribute.useProperty) return updateProperty;\n\n  \tif (attribute.namespace) return updateNamespacedAttribute;\n\n  \treturn updateAttribute;\n  }\n\n  function updateId() {\n  \tvar node = this.node;\n\n  \tvar value = this.getValue();\n\n  \tdelete this.ractive.nodes[node.id];\n  \tthis.ractive.nodes[value] = node;\n\n  \tnode.id = value;\n  }\n\n  function updateMultipleSelectValue() {\n  \tvar value = this.getValue();\n\n  \tif (!isArray(value)) value = [value];\n\n  \tvar options = this.node.options;\n  \tvar i = options.length;\n\n  \twhile (i--) {\n  \t\tvar option = options[i];\n  \t\tvar optionValue = option._ractive ? option._ractive.value : option.value; // options inserted via a triple don't have _ractive\n\n  \t\toption.selected = arrayContains(value, optionValue);\n  \t}\n  }\n\n  function updateSelectValue() {\n  \tvar value = this.getValue();\n\n  \tif (!this.locked) {\n  \t\t// TODO is locked still a thing?\n  \t\tthis.node._ractive.value = value;\n\n  \t\tvar options = this.node.options;\n  \t\tvar i = options.length;\n\n  \t\twhile (i--) {\n  \t\t\tvar option = options[i];\n  \t\t\tvar optionValue = option._ractive ? option._ractive.value : option.value; // options inserted via a triple don't have _ractive\n\n  \t\t\tif (optionValue == value) {\n  \t\t\t\t// double equals as we may be comparing numbers with strings\n  \t\t\t\toption.selected = true;\n  \t\t\t\tbreak;\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \t// if we're still here, it means the new value didn't match any of the options...\n  \t// TODO figure out what to do in this situation\n  }\n\n  function updateContentEditableValue() {\n  \tvar value = this.getValue();\n\n  \tif (!this.locked) {\n  \t\tthis.node.innerHTML = value === undefined ? '' : value;\n  \t}\n  }\n\n  function updateRadioValue() {\n  \tvar node = this.node;\n  \tvar wasChecked = node.checked;\n\n  \tvar value = this.getValue();\n\n  \t//node.value = this.element.getAttribute( 'value' );\n  \tnode.value = this.node._ractive.value = value;\n  \tnode.checked = value === this.element.getAttribute('name');\n\n  \t// This is a special case - if the input was checked, and the value\n  \t// changed so that it's no longer checked, the twoway binding is\n  \t// most likely out of date. To fix it we have to jump through some\n  \t// hoops... this is a little kludgy but it works\n  \tif (wasChecked && !node.checked && this.element.binding && this.element.binding.rendered) {\n  \t\tthis.element.binding.group.model.set(this.element.binding.group.getValue());\n  \t}\n  }\n\n  function updateValue() {\n  \tif (!this.locked) {\n  \t\tvar value = this.getValue();\n\n  \t\tthis.node.value = this.node._ractive.value = value;\n  \t\tthis.node.setAttribute('value', value);\n  \t}\n  }\n\n  function updateRadioName() {\n  \tthis.node.checked = this.getValue() == this.node._ractive.value;\n  }\n\n  function updateCheckboxName() {\n  \tvar element = this.element;\n  \tvar node = this.node;\n\n  \tvar binding = element.binding;\n\n  \tvar value = this.getValue();\n  \tvar valueAttribute = element.getAttribute('value');\n\n  \tif (!isArray(value)) {\n  \t\tbinding.isChecked = node.checked = value == valueAttribute;\n  \t} else {\n  \t\tvar i = value.length;\n  \t\twhile (i--) {\n  \t\t\tif (valueAttribute == value[i]) {\n  \t\t\t\tbinding.isChecked = node.checked = true;\n  \t\t\t\treturn;\n  \t\t\t}\n  \t\t}\n  \t\tbinding.isChecked = node.checked = false;\n  \t}\n  }\n\n  function updateIEStyleAttribute() {\n  \tthis.node.style.setAttribute('cssText', this.getValue() || '');\n  }\n\n  function updateClassName() {\n  \tthis.node.className = safeToStringValue(this.getValue());\n  }\n\n  function updateProperty() {\n  \t// with two-way binding, only update if the change wasn't initiated by the user\n  \t// otherwise the cursor will often be sent to the wrong place\n  \tif (!this.locked) {\n  \t\tthis.node[this.propertyName] = this.getValue();\n  \t}\n  }\n\n  function updateAttribute() {\n  \tthis.node.setAttribute(this.name, safeToStringValue(this.getString()));\n  }\n\n  function updateNamespacedAttribute() {\n  \tthis.node.setAttributeNS(this.namespace, this.name, safeToStringValue(this.getString()));\n  }\n\n  var propertyNames = {\n  \t'accept-charset': 'acceptCharset',\n  \taccesskey: 'accessKey',\n  \tbgcolor: 'bgColor',\n  \t'class': 'className',\n  \tcodebase: 'codeBase',\n  \tcolspan: 'colSpan',\n  \tcontenteditable: 'contentEditable',\n  \tdatetime: 'dateTime',\n  \tdirname: 'dirName',\n  \t'for': 'htmlFor',\n  \t'http-equiv': 'httpEquiv',\n  \tismap: 'isMap',\n  \tmaxlength: 'maxLength',\n  \tnovalidate: 'noValidate',\n  \tpubdate: 'pubDate',\n  \treadonly: 'readOnly',\n  \trowspan: 'rowSpan',\n  \ttabindex: 'tabIndex',\n  \tusemap: 'useMap'\n  };\n\n  var Attribute = (function (_Item) {\n  \tinherits(Attribute, _Item);\n\n  \tfunction Attribute(options) {\n  \t\tclassCallCheck(this, Attribute);\n\n  \t\t_Item.call(this, options);\n\n  \t\tdetermineNameAndNamespace(this, options.name);\n\n  \t\tthis.element = options.element;\n  \t\tthis.parentFragment = options.element.parentFragment; // shared\n  \t\tthis.ractive = this.parentFragment.ractive;\n\n  \t\tthis.rendered = false;\n  \t\tthis.updateDelegate = null;\n  \t\tthis.fragment = null;\n  \t\tthis.value = null;\n\n  \t\tif (!isArray(options.template)) {\n  \t\t\tthis.value = options.template;\n  \t\t\tif (this.value === 0) {\n  \t\t\t\tthis.value = '';\n  \t\t\t}\n  \t\t} else {\n  \t\t\tthis.fragment = new Fragment({\n  \t\t\t\towner: this,\n  \t\t\t\ttemplate: options.template\n  \t\t\t});\n  \t\t}\n\n  \t\tthis.interpolator = this.fragment && this.fragment.items.length === 1 && this.fragment.items[0].type === INTERPOLATOR && this.fragment.items[0];\n  \t}\n\n  \tAttribute.prototype.bind = function bind() {\n  \t\tif (this.fragment) {\n  \t\t\tthis.fragment.bind();\n  \t\t}\n  \t};\n\n  \tAttribute.prototype.bubble = function bubble() {\n  \t\tif (!this.dirty) {\n  \t\t\tthis.element.bubble();\n  \t\t\tthis.dirty = true;\n  \t\t}\n  \t};\n\n  \tAttribute.prototype.getString = function getString() {\n  \t\treturn this.fragment ? this.fragment.toString() : this.value != null ? '' + this.value : '';\n  \t};\n\n  \t// TODO could getValue ever be called for a static attribute,\n  \t// or can we assume that this.fragment exists?\n\n  \tAttribute.prototype.getValue = function getValue() {\n  \t\treturn this.fragment ? this.fragment.valueOf() : booleanAttributes.test(this.name) ? true : this.value;\n  \t};\n\n  \tAttribute.prototype.rebind = function rebind() {\n  \t\tthis.unbind();\n  \t\tthis.bind();\n  \t};\n\n  \tAttribute.prototype.render = function render() {\n  \t\tvar node = this.element.node;\n  \t\tthis.node = node;\n\n  \t\t// should we use direct property access, or setAttribute?\n  \t\tif (!node.namespaceURI || node.namespaceURI === html) {\n  \t\t\tvar propertyName = propertyNames[this.name] || this.name;\n\n  \t\t\tif (node[propertyName] !== undefined) {\n  \t\t\t\tthis.propertyName = propertyName;\n  \t\t\t}\n\n  \t\t\t// is attribute a boolean attribute or 'value'? If so we're better off doing e.g.\n  \t\t\t// node.selected = true rather than node.setAttribute( 'selected', '' )\n  \t\t\tif (booleanAttributes.test(this.name) || this.isTwoway) {\n  \t\t\t\tthis.useProperty = true;\n  \t\t\t}\n\n  \t\t\tif (propertyName === 'value') {\n  \t\t\t\tnode._ractive.value = this.value;\n  \t\t\t}\n  \t\t}\n\n  \t\tthis.rendered = true;\n  \t\tthis.updateDelegate = getUpdateDelegate(this);\n  \t\tthis.updateDelegate();\n  \t};\n\n  \tAttribute.prototype.toString = function toString() {\n  \t\tvar value = this.getValue();\n\n  \t\t// Special case - select and textarea values (should not be stringified)\n  \t\tif (this.name === 'value' && (this.element.getAttribute('contenteditable') !== undefined || (this.element.name === 'select' || this.element.name === 'textarea'))) {\n  \t\t\treturn;\n  \t\t}\n\n  \t\t// Special case  bound radio `name` attributes\n  \t\tif (this.name === 'name' && this.element.name === 'input' && this.interpolator) {\n  \t\t\treturn 'name=\"{{' + this.interpolator.model.getKeypath() + '}}\"';\n  \t\t}\n\n  \t\tif (booleanAttributes.test(this.name)) return value ? this.name : '';\n  \t\tif (value == null) return '';\n\n  \t\tvar str = safeToStringValue(this.getString()).replace(/&/g, '&amp;').replace(/\"/g, '&quot;').replace(/'/g, '&#39;');\n\n  \t\treturn str ? this.name + '=\"' + str + '\"' : this.name;\n  \t};\n\n  \tAttribute.prototype.unbind = function unbind() {\n  \t\tif (this.fragment) this.fragment.unbind();\n  \t};\n\n  \tAttribute.prototype.update = function update() {\n  \t\tif (this.dirty) {\n  \t\t\tif (this.fragment) this.fragment.update();\n  \t\t\tif (this.rendered) this.updateDelegate();\n  \t\t\tthis.dirty = false;\n  \t\t}\n  \t};\n\n  \treturn Attribute;\n  })(Item);\n\n  var div$1 = doc ? createElement('div') : null;\n\n  var ConditionalAttribute = (function (_Item) {\n  \tinherits(ConditionalAttribute, _Item);\n\n  \tfunction ConditionalAttribute(options) {\n  \t\tclassCallCheck(this, ConditionalAttribute);\n\n  \t\t_Item.call(this, options);\n\n  \t\tthis.attributes = [];\n\n  \t\tthis.owner = options.owner;\n\n  \t\tthis.fragment = new Fragment({\n  \t\t\tractive: this.ractive,\n  \t\t\towner: this,\n  \t\t\ttemplate: [this.template]\n  \t\t});\n\n  \t\tthis.dirty = false;\n  \t}\n\n  \tConditionalAttribute.prototype.bind = function bind() {\n  \t\tthis.fragment.bind();\n  \t};\n\n  \tConditionalAttribute.prototype.bubble = function bubble() {\n  \t\tif (!this.dirty) {\n  \t\t\tthis.dirty = true;\n  \t\t\tthis.owner.bubble();\n  \t\t}\n  \t};\n\n  \tConditionalAttribute.prototype.rebind = function rebind() {\n  \t\tthrow new Error('ConditionalAttribute$rebind is not yet implemented'); // TODO test\n  \t};\n\n  \tConditionalAttribute.prototype.render = function render() {\n  \t\tthis.node = this.owner.node;\n  \t\tthis.isSvg = this.node.namespaceURI === svg$1;\n\n  \t\tthis.rendered = true;\n  \t\tthis.dirty = true; // TODO this seems hacky, but necessary for tests to pass in browser AND node.js\n  \t\tthis.update();\n  \t};\n\n  \tConditionalAttribute.prototype.toString = function toString() {\n  \t\treturn this.fragment.toString();\n  \t};\n\n  \tConditionalAttribute.prototype.unbind = function unbind() {\n  \t\tthis.fragment.unbind();\n  \t};\n\n  \tConditionalAttribute.prototype.unrender = function unrender() {\n  \t\tthis.rendered = false;\n  \t};\n\n  \tConditionalAttribute.prototype.update = function update() {\n  \t\tvar _this = this;\n\n  \t\tvar str = undefined;\n  \t\tvar attrs = undefined;\n\n  \t\tif (this.dirty) {\n  \t\t\tthis.fragment.update();\n\n  \t\t\tif (this.rendered) {\n  \t\t\t\tstr = this.fragment.toString();\n  \t\t\t\tattrs = parseAttributes(str, this.isSvg);\n\n  \t\t\t\t// any attributes that previously existed but no longer do\n  \t\t\t\t// must be removed\n  \t\t\t\tthis.attributes.filter(function (a) {\n  \t\t\t\t\treturn notIn(attrs, a);\n  \t\t\t\t}).forEach(function (a) {\n  \t\t\t\t\t_this.node.removeAttribute(a.name);\n  \t\t\t\t});\n\n  \t\t\t\tattrs.forEach(function (a) {\n  \t\t\t\t\t_this.node.setAttribute(a.name, a.value);\n  \t\t\t\t});\n\n  \t\t\t\tthis.attributes = attrs;\n  \t\t\t}\n\n  \t\t\tthis.dirty = false;\n  \t\t}\n  \t};\n\n  \treturn ConditionalAttribute;\n  })(Item);\n\n  function parseAttributes(str, isSvg) {\n  \tvar tagName = isSvg ? 'svg' : 'div';\n  \tdiv$1.innerHTML = '<' + tagName + ' ' + str + '></' + tagName + '>';\n\n  \treturn toArray(div$1.childNodes[0].attributes);\n  }\n\n  function notIn(haystack, needle) {\n  \tvar i = haystack.length;\n\n  \twhile (i--) {\n  \t\tif (haystack[i].name === needle.name) {\n  \t\t\treturn false;\n  \t\t}\n  \t}\n\n  \treturn true;\n  }\n\n  var missingDecorator = {\n  \tupdate: noop,\n  \tteardown: noop\n  };\n\n  var Decorator = (function () {\n  \tfunction Decorator(owner, template) {\n  \t\tclassCallCheck(this, Decorator);\n\n  \t\tthis.owner = owner;\n  \t\tthis.template = template;\n\n  \t\tthis.parentFragment = owner.parentFragment;\n  \t\tthis.ractive = owner.ractive;\n\n  \t\tthis.dynamicName = typeof template.n === 'object';\n  \t\tthis.dynamicArgs = !!template.d;\n\n  \t\tif (this.dynamicName) {\n  \t\t\tthis.nameFragment = new Fragment({\n  \t\t\t\towner: this,\n  \t\t\t\ttemplate: template.n\n  \t\t\t});\n  \t\t} else {\n  \t\t\tthis.name = template.n || template;\n  \t\t}\n\n  \t\tif (this.dynamicArgs) {\n  \t\t\tthis.argsFragment = new Fragment({\n  \t\t\t\towner: this,\n  \t\t\t\ttemplate: template.d\n  \t\t\t});\n  \t\t} else {\n  \t\t\tthis.args = template.a || [];\n  \t\t}\n\n  \t\tthis.node = null;\n  \t\tthis.intermediary = null;\n  \t}\n\n  \tDecorator.prototype.bind = function bind() {\n  \t\tif (this.dynamicName) {\n  \t\t\tthis.nameFragment.bind();\n  \t\t\tthis.name = this.nameFragment.toString();\n  \t\t}\n\n  \t\tif (this.dynamicArgs) this.argsFragment.bind();\n  \t};\n\n  \tDecorator.prototype.bubble = function bubble() {\n  \t\tif (!this.dirty) {\n  \t\t\tthis.dirty = true;\n  \t\t\tthis.owner.bubble();\n  \t\t}\n  \t};\n\n  \tDecorator.prototype.rebind = function rebind() {\n  \t\tif (this.dynamicName) this.nameFragment.rebind();\n  \t\tif (this.dynamicArgs) this.argsFragment.rebind();\n  \t};\n\n  \tDecorator.prototype.render = function render() {\n  \t\tvar fn = findInViewHierarchy('decorators', this.ractive, this.name);\n\n  \t\tif (!fn) {\n  \t\t\tmissingPlugin(this.name, 'decorators');\n  \t\t\tthis.intermediary = missingDecorator;\n  \t\t\treturn;\n  \t\t}\n\n  \t\tthis.node = this.owner.node;\n\n  \t\tvar args = this.dynamicArgs ? this.argsFragment.getArgsList() : this.args;\n  \t\tthis.intermediary = fn.apply(this.ractive, [this.node].concat(args));\n\n  \t\tif (!this.intermediary || !this.intermediary.teardown) {\n  \t\t\tthrow new Error('The \\'' + this.name + '\\' decorator must return an object with a teardown method');\n  \t\t}\n  \t};\n\n  \tDecorator.prototype.unbind = function unbind() {\n  \t\tif (this.dynamicName) this.nameFragment.unbind();\n  \t\tif (this.dynamicArgs) this.argsFragment.unbind();\n  \t};\n\n  \tDecorator.prototype.unrender = function unrender() {\n  \t\tthis.intermediary.teardown();\n  \t};\n\n  \tDecorator.prototype.update = function update() {\n  \t\tif (this.dynamicName) {\n  \t\t\tvar _name = this.nameFragment.toString();\n\n  \t\t\tif (_name !== this.name) {\n  \t\t\t\tthis.name = _name;\n  \t\t\t\tthis.unrender();\n  \t\t\t\tthis.render();\n  \t\t\t}\n  \t\t} else if (this.intermediary.update) {\n  \t\t\tvar args = this.dynamicArgs ? this.argsFragment.getArgsList() : this.args;\n  \t\t\tthis.intermediary.update.apply(this.ractive, args);\n  \t\t} else {\n  \t\t\tthis.unrender();\n  \t\t\tthis.render();\n  \t\t}\n  \t};\n\n  \treturn Decorator;\n  })();\n\n  function enqueue(ractive, event) {\n  \tif (ractive.event) {\n  \t\tractive._eventQueue.push(ractive.event);\n  \t}\n\n  \tractive.event = event;\n  }\n\n  function dequeue(ractive) {\n  \tif (ractive._eventQueue.length) {\n  \t\tractive.event = ractive._eventQueue.pop();\n  \t} else {\n  \t\tractive.event = null;\n  \t}\n  }\n\n  var starMaps = {};\n\n  // This function takes a keypath such as 'foo.bar.baz', and returns\n  // all the variants of that keypath that include a wildcard in place\n  // of a key, such as 'foo.bar.*', 'foo.*.baz', 'foo.*.*' and so on.\n  // These are then checked against the dependants map (ractive.viewmodel.depsMap)\n  // to see if any pattern observers are downstream of one or more of\n  // these wildcard keypaths (e.g. 'foo.bar.*.status')\n\n  function getPotentialWildcardMatches(keypath) {\n  \tvar keys, starMap, mapper, i, result, wildcardKeypath;\n\n  \tkeys = splitKeypath(keypath);\n  \tif (!(starMap = starMaps[keys.length])) {\n  \t\tstarMap = getStarMap(keys.length);\n  \t}\n\n  \tresult = [];\n\n  \tmapper = function (star, i) {\n  \t\treturn star ? '*' : keys[i];\n  \t};\n\n  \ti = starMap.length;\n  \twhile (i--) {\n  \t\twildcardKeypath = starMap[i].map(mapper).join('.');\n\n  \t\tif (!result.hasOwnProperty(wildcardKeypath)) {\n  \t\t\tresult.push(wildcardKeypath);\n  \t\t\tresult[wildcardKeypath] = true;\n  \t\t}\n  \t}\n\n  \treturn result;\n  }\n\n  // This function returns all the possible true/false combinations for\n  // a given number - e.g. for two, the possible combinations are\n  // [ true, true ], [ true, false ], [ false, true ], [ false, false ].\n  // It does so by getting all the binary values between 0 and e.g. 11\n  function getStarMap(num) {\n  \tvar ones = '',\n  \t    max,\n  \t    binary,\n  \t    starMap,\n  \t    mapper,\n  \t    i,\n  \t    j,\n  \t    l,\n  \t    map;\n\n  \tif (!starMaps[num]) {\n  \t\tstarMap = [];\n\n  \t\twhile (ones.length < num) {\n  \t\t\tones += 1;\n  \t\t}\n\n  \t\tmax = parseInt(ones, 2);\n\n  \t\tmapper = function (digit) {\n  \t\t\treturn digit === '1';\n  \t\t};\n\n  \t\tfor (i = 0; i <= max; i += 1) {\n  \t\t\tbinary = i.toString(2);\n  \t\t\twhile (binary.length < num) {\n  \t\t\t\tbinary = '0' + binary;\n  \t\t\t}\n\n  \t\t\tmap = [];\n  \t\t\tl = binary.length;\n  \t\t\tfor (j = 0; j < l; j++) {\n  \t\t\t\tmap.push(mapper(binary[j]));\n  \t\t\t}\n  \t\t\tstarMap[i] = map;\n  \t\t}\n\n  \t\tstarMaps[num] = starMap;\n  \t}\n\n  \treturn starMaps[num];\n  }\n\n  var wildcardCache = {};\n  function fireEvent(ractive, eventName) {\n  \tvar options = arguments.length <= 2 || arguments[2] === undefined ? {} : arguments[2];\n\n  \tif (!eventName) {\n  \t\treturn;\n  \t}\n\n  \tif (!options.event) {\n  \t\toptions.event = {\n  \t\t\tname: eventName,\n  \t\t\t// until event not included as argument default\n  \t\t\t_noArg: true\n  \t\t};\n  \t} else {\n  \t\toptions.event.name = eventName;\n  \t}\n\n  \tvar eventNames = getWildcardNames(eventName);\n\n  \tfireEventAs(ractive, eventNames, options.event, options.args, true);\n  }\n\n  function getWildcardNames(eventName) {\n  \tif (wildcardCache.hasOwnProperty(eventName)) {\n  \t\treturn wildcardCache[eventName];\n  \t} else {\n  \t\treturn wildcardCache[eventName] = getPotentialWildcardMatches(eventName);\n  \t}\n  }\n\n  function fireEventAs(ractive, eventNames, event, args) {\n  \tvar initialFire = arguments.length <= 4 || arguments[4] === undefined ? false : arguments[4];\n\n  \tvar subscribers,\n  \t    i,\n  \t    bubble = true;\n\n  \tenqueue(ractive, event);\n\n  \tfor (i = eventNames.length; i >= 0; i--) {\n  \t\tsubscribers = ractive._subs[eventNames[i]];\n\n  \t\tif (subscribers) {\n  \t\t\tbubble = notifySubscribers(ractive, subscribers, event, args) && bubble;\n  \t\t}\n  \t}\n\n  \tdequeue(ractive);\n\n  \tif (ractive.parent && bubble) {\n\n  \t\tif (initialFire && ractive.component) {\n  \t\t\tvar fullName = ractive.component.name + '.' + eventNames[eventNames.length - 1];\n  \t\t\teventNames = getWildcardNames(fullName);\n\n  \t\t\tif (event && !event.component) {\n  \t\t\t\tevent.component = ractive;\n  \t\t\t}\n  \t\t}\n\n  \t\tfireEventAs(ractive.parent, eventNames, event, args);\n  \t}\n  }\n\n  function notifySubscribers(ractive, subscribers, event, args) {\n  \tvar originalEvent = null,\n  \t    stopEvent = false;\n\n  \tif (event && !event._noArg) {\n  \t\targs = [event].concat(args);\n  \t}\n\n  \t// subscribers can be modified inflight, e.g. \"once\" functionality\n  \t// so we need to copy to make sure everyone gets called\n  \tsubscribers = subscribers.slice();\n\n  \tfor (var i = 0, len = subscribers.length; i < len; i += 1) {\n  \t\tif (subscribers[i].apply(ractive, args) === false) {\n  \t\t\tstopEvent = true;\n  \t\t}\n  \t}\n\n  \tif (event && !event._noArg && stopEvent && (originalEvent = event.original)) {\n  \t\toriginalEvent.preventDefault && originalEvent.preventDefault();\n  \t\toriginalEvent.stopPropagation && originalEvent.stopPropagation();\n  \t}\n\n  \treturn !stopEvent;\n  }\n\n  var eventPattern = /^event(?:\\.(.+))?$/;\n  var argumentsPattern = /^arguments\\.(\\d*)$/;\n  var dollarArgsPattern = /^\\$(\\d*)$/;\n\n  var EventDirective = (function () {\n  \tfunction EventDirective(owner, event, template) {\n  \t\tclassCallCheck(this, EventDirective);\n\n  \t\tthis.owner = owner;\n  \t\tthis.event = event;\n  \t\tthis.template = template;\n\n  \t\tthis.ractive = owner.parentFragment.ractive;\n  \t\tthis.parentFragment = owner.parentFragment;\n\n  \t\tthis.context = null;\n  \t\tthis.passthru = false;\n\n  \t\t// method calls\n  \t\tthis.method = null;\n  \t\tthis.resolvers = null;\n  \t\tthis.models = null;\n  \t\tthis.argsFn = null;\n\n  \t\t// handler directive\n  \t\tthis.action = null;\n  \t\tthis.args = null;\n  \t}\n\n  \tEventDirective.prototype.bind = function bind() {\n  \t\tvar _this = this;\n\n  \t\tthis.context = this.parentFragment.findContext();\n\n  \t\tvar template = this.template;\n\n  \t\tif (template.m) {\n  \t\t\tthis.method = template.m;\n\n  \t\t\tif (this.passthru = template.g) {\n  \t\t\t\t// on-click=\"foo(...arguments)\"\n  \t\t\t\t// no models or args, just pass thru values\n  \t\t\t} else {\n  \t\t\t\t\tthis.resolvers = [];\n  \t\t\t\t\tthis.models = template.a.r.map(function (ref, i) {\n  \t\t\t\t\t\tif (eventPattern.test(ref)) {\n  \t\t\t\t\t\t\t// on-click=\"foo(event.node)\"\n  \t\t\t\t\t\t\treturn {\n  \t\t\t\t\t\t\t\tevent: true,\n  \t\t\t\t\t\t\t\tkeys: ref.length > 5 ? splitKeypath(ref.slice(6)) : [],\n  \t\t\t\t\t\t\t\tunbind: noop\n  \t\t\t\t\t\t\t};\n  \t\t\t\t\t\t}\n\n  \t\t\t\t\t\tvar argMatch = argumentsPattern.exec(ref);\n  \t\t\t\t\t\tif (argMatch) {\n  \t\t\t\t\t\t\t// on-click=\"foo(arguments[0])\"\n  \t\t\t\t\t\t\treturn {\n  \t\t\t\t\t\t\t\targument: true,\n  \t\t\t\t\t\t\t\tindex: argMatch[1]\n  \t\t\t\t\t\t\t};\n  \t\t\t\t\t\t}\n\n  \t\t\t\t\t\tvar dollarMatch = dollarArgsPattern.exec(ref);\n  \t\t\t\t\t\tif (dollarMatch) {\n  \t\t\t\t\t\t\t// on-click=\"foo($1)\"\n  \t\t\t\t\t\t\treturn {\n  \t\t\t\t\t\t\t\targument: true,\n  \t\t\t\t\t\t\t\tindex: dollarMatch[1] - 1\n  \t\t\t\t\t\t\t};\n  \t\t\t\t\t\t}\n\n  \t\t\t\t\t\tvar resolver = undefined;\n\n  \t\t\t\t\t\tvar model = resolveReference(_this.parentFragment, ref);\n  \t\t\t\t\t\tif (!model) {\n  \t\t\t\t\t\t\tresolver = _this.parentFragment.resolve(ref, function (model) {\n  \t\t\t\t\t\t\t\t_this.models[i] = model;\n  \t\t\t\t\t\t\t\tremoveFromArray(_this.resolvers, resolver);\n  \t\t\t\t\t\t\t});\n\n  \t\t\t\t\t\t\t_this.resolvers.push(resolver);\n  \t\t\t\t\t\t}\n\n  \t\t\t\t\t\treturn model;\n  \t\t\t\t\t});\n\n  \t\t\t\t\tthis.argsFn = createFunction(template.a.s, template.a.r.length);\n  \t\t\t\t}\n  \t\t} else {\n  \t\t\t// TODO deprecate this style of directive\n  \t\t\tthis.action = typeof template === 'string' ? // on-click='foo'\n  \t\t\ttemplate : typeof template.n === 'string' ? // on-click='{{dynamic}}'\n  \t\t\ttemplate.n : new Fragment({\n  \t\t\t\towner: this,\n  \t\t\t\ttemplate: template.n\n  \t\t\t});\n\n  \t\t\tthis.args = template.a ? // static arguments\n  \t\t\ttypeof template.a === 'string' ? [template.a] : template.a : template.d ? // dynamic arguments\n  \t\t\tnew Fragment({\n  \t\t\t\towner: this,\n  \t\t\t\ttemplate: template.d\n  \t\t\t}) : []; // no arguments\n  \t\t}\n\n  \t\tif (this.template.n && typeof this.template.n !== 'string') this.action.bind();\n  \t\tif (this.template.d) this.args.bind();\n  \t};\n\n  \tEventDirective.prototype.bubble = function bubble() {\n  \t\tif (!this.dirty) {\n  \t\t\tthis.dirty = true;\n  \t\t\tthis.owner.bubble();\n  \t\t}\n  \t};\n\n  \tEventDirective.prototype.fire = function fire(event, passedArgs) {\n  \t\t// augment event object\n  \t\tif (event) {\n  \t\t\tevent.keypath = this.context.getKeypath();\n  \t\t\tevent.context = this.context.get();\n  \t\t\tevent.index = this.parentFragment.indexRefs;\n\n  \t\t\tif (passedArgs) passedArgs.unshift(event);\n  \t\t}\n\n  \t\tif (this.method) {\n  \t\t\tif (typeof this.ractive[this.method] !== 'function') {\n  \t\t\t\tthrow new Error('Attempted to call a non-existent method (\"' + this.method + '\")');\n  \t\t\t}\n\n  \t\t\tvar args = undefined;\n\n  \t\t\tif (this.passthru) {\n  \t\t\t\targs = passedArgs;\n  \t\t\t} else {\n  \t\t\t\tvar values = this.models.map(function (model) {\n  \t\t\t\t\tif (!model) return undefined;\n\n  \t\t\t\t\tif (model.event) {\n  \t\t\t\t\t\tvar obj = event;\n  \t\t\t\t\t\tvar keys = model.keys.slice();\n\n  \t\t\t\t\t\twhile (keys.length) obj = obj[keys.shift()];\n  \t\t\t\t\t\treturn obj;\n  \t\t\t\t\t}\n\n  \t\t\t\t\tif (model.argument) {\n  \t\t\t\t\t\treturn passedArgs ? passedArgs[model.index] : void 0;\n  \t\t\t\t\t}\n\n  \t\t\t\t\tif (model.wrapper) {\n  \t\t\t\t\t\treturn model.wrapper.value;\n  \t\t\t\t\t}\n\n  \t\t\t\t\treturn model.get();\n  \t\t\t\t});\n\n  \t\t\t\targs = this.argsFn.apply(null, values);\n  \t\t\t}\n\n  \t\t\t// make event available as `this.event`\n  \t\t\tvar ractive = this.ractive;\n  \t\t\tvar oldEvent = ractive.event;\n\n  \t\t\tractive.event = event;\n  \t\t\tractive[this.method].apply(ractive, args);\n  \t\t\tractive.event = oldEvent;\n  \t\t} else {\n  \t\t\tvar action = this.action.toString();\n  \t\t\tvar args = this.template.d ? this.args.getArgsList() : this.args;\n\n  \t\t\tif (event) event.name = action;\n\n  \t\t\tfireEvent(this.ractive, action, {\n  \t\t\t\tevent: event,\n  \t\t\t\targs: args\n  \t\t\t});\n  \t\t}\n  \t};\n\n  \tEventDirective.prototype.rebind = function rebind() {\n  \t\tthrow new Error('EventDirective$rebind not yet implemented!'); // TODO add tests\n  \t};\n\n  \tEventDirective.prototype.render = function render() {\n  \t\tthis.event.listen(this);\n  \t};\n\n  \tEventDirective.prototype.unbind = function unbind() {\n  \t\tvar template = this.template;\n\n  \t\tif (template.m) {\n  \t\t\tthis.resolvers.forEach(_unbind);\n  \t\t\tthis.resolvers = [];\n\n  \t\t\tthis.models.forEach(function (model) {\n  \t\t\t\tif (model) model.unbind();\n  \t\t\t});\n  \t\t} else {\n  \t\t\t// TODO this is brittle and non-explicit, fix it\n  \t\t\tif (this.action.unbind) this.action.unbind();\n  \t\t\tif (this.args.unbind) this.args.unbind();\n  \t\t}\n  \t};\n\n  \tEventDirective.prototype.unrender = function unrender() {\n  \t\tthis.event.unlisten();\n  \t};\n\n  \tEventDirective.prototype.update = function update() {\n  \t\tif (this.method) return; // nothing to do\n\n  \t\t// ugh legacy\n  \t\tif (this.action.update) this.action.update();\n  \t\tif (this.template.d) this.args.update();\n\n  \t\tthis.dirty = false;\n  \t};\n\n  \treturn EventDirective;\n  })();\n\n  var DOMEvent = (function () {\n  \tfunction DOMEvent(name, owner) {\n  \t\tclassCallCheck(this, DOMEvent);\n\n  \t\tif (name.indexOf('*') !== -1) {\n  \t\t\tfatal('Only component proxy-events may contain \"*\" wildcards, <' + owner.name + ' on-' + name + '=\"...\"/> is not valid');\n  \t\t}\n\n  \t\tthis.name = name;\n  \t\tthis.owner = owner;\n  \t\tthis.node = null;\n  \t\tthis.handler = null;\n  \t}\n\n  \tDOMEvent.prototype.listen = function listen(directive) {\n  \t\tvar node = this.node = this.owner.node;\n  \t\tvar name = this.name;\n\n  \t\tif (!('on' + name in node)) {\n  \t\t\tmissingPlugin(name, 'events');\n  \t\t}\n\n  \t\tnode.addEventListener(name, this.handler = function (event) {\n  \t\t\tdirective.fire({\n  \t\t\t\tnode: node,\n  \t\t\t\toriginal: event\n  \t\t\t});\n  \t\t}, false);\n  \t};\n\n  \tDOMEvent.prototype.unlisten = function unlisten() {\n  \t\tthis.node.removeEventListener(this.name, this.handler, false);\n  \t};\n\n  \treturn DOMEvent;\n  })();\n\n  var CustomEvent = (function () {\n  \tfunction CustomEvent(eventPlugin, owner) {\n  \t\tclassCallCheck(this, CustomEvent);\n\n  \t\tthis.eventPlugin = eventPlugin;\n  \t\tthis.owner = owner;\n  \t\tthis.handler = null;\n  \t}\n\n  \tCustomEvent.prototype.listen = function listen(directive) {\n  \t\tvar node = this.owner.node;\n\n  \t\tthis.handler = this.eventPlugin(node, function () {\n  \t\t\tvar event = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];\n\n  \t\t\tevent.node = event.node || node;\n  \t\t\tdirective.fire(event);\n  \t\t});\n  \t};\n\n  \tCustomEvent.prototype.unlisten = function unlisten() {\n  \t\tthis.handler.teardown();\n  \t};\n\n  \treturn CustomEvent;\n  })();\n\n  function camelCase (hyphenatedStr) {\n  \treturn hyphenatedStr.replace(/-([a-zA-Z])/g, function (match, $1) {\n  \t\treturn $1.toUpperCase();\n  \t});\n  }\n\n  var prefix$2 = undefined;\n\n  if (!isClient) {\n  \tprefix$2 = null;\n  } else {\n  \t(function () {\n  \t\tvar prefixCache = {};\n  \t\tvar testStyle = createElement('div').style;\n\n  \t\tprefix$2 = function (prop) {\n  \t\t\tprop = camelCase(prop);\n\n  \t\t\tif (!prefixCache[prop]) {\n  \t\t\t\tif (testStyle[prop] !== undefined) {\n  \t\t\t\t\tprefixCache[prop] = prop;\n  \t\t\t\t} else {\n  \t\t\t\t\t// test vendors...\n  \t\t\t\t\tvar capped = prop.charAt(0).toUpperCase() + prop.substring(1);\n\n  \t\t\t\t\tvar i = vendors.length;\n  \t\t\t\t\twhile (i--) {\n  \t\t\t\t\t\tvar vendor = vendors[i];\n  \t\t\t\t\t\tif (testStyle[vendor + capped] !== undefined) {\n  \t\t\t\t\t\t\tprefixCache[prop] = vendor + capped;\n  \t\t\t\t\t\t\tbreak;\n  \t\t\t\t\t\t}\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\treturn prefixCache[prop];\n  \t\t};\n  \t})();\n  }\n\n  var prefix$3 = prefix$2;\n\n  var visible = undefined;\n  var hidden = 'hidden';\n\n  if (doc) {\n  \tvar prefix$4 = undefined;\n\n  \tif (hidden in doc) {\n  \t\tprefix$4 = '';\n  \t} else {\n  \t\tvar i$2 = vendors.length;\n  \t\twhile (i$2--) {\n  \t\t\tvar vendor = vendors[i$2];\n  \t\t\thidden = vendor + 'Hidden';\n\n  \t\t\tif (hidden in doc) {\n  \t\t\t\tprefix$4 = vendor;\n  \t\t\t\tbreak;\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \tif (prefix$4 !== undefined) {\n  \t\tdoc.addEventListener(prefix$4 + 'visibilitychange', onChange);\n  \t\tonChange();\n  \t} else {\n  \t\t// gah, we're in an old browser\n  \t\tif ('onfocusout' in doc) {\n  \t\t\tdoc.addEventListener('focusout', onHide);\n  \t\t\tdoc.addEventListener('focusin', onShow);\n  \t\t} else {\n  \t\t\twin.addEventListener('pagehide', onHide);\n  \t\t\twin.addEventListener('blur', onHide);\n\n  \t\t\twin.addEventListener('pageshow', onShow);\n  \t\t\twin.addEventListener('focus', onShow);\n  \t\t}\n\n  \t\tvisible = true; // until proven otherwise. Not ideal but hey\n  \t}\n  }\n\n  function onChange() {\n  \tvisible = !doc[hidden];\n  }\n\n  function onHide() {\n  \tvisible = false;\n  }\n\n  function onShow() {\n  \tvisible = true;\n  }\n\n  var interpolators = {\n  \tnumber: function (from, to) {\n  \t\tvar delta;\n\n  \t\tif (!isNumeric(from) || !isNumeric(to)) {\n  \t\t\treturn null;\n  \t\t}\n\n  \t\tfrom = +from;\n  \t\tto = +to;\n\n  \t\tdelta = to - from;\n\n  \t\tif (!delta) {\n  \t\t\treturn function () {\n  \t\t\t\treturn from;\n  \t\t\t};\n  \t\t}\n\n  \t\treturn function (t) {\n  \t\t\treturn from + t * delta;\n  \t\t};\n  \t},\n\n  \tarray: function (from, to) {\n  \t\tvar intermediate, interpolators, len, i;\n\n  \t\tif (!isArray(from) || !isArray(to)) {\n  \t\t\treturn null;\n  \t\t}\n\n  \t\tintermediate = [];\n  \t\tinterpolators = [];\n\n  \t\ti = len = Math.min(from.length, to.length);\n  \t\twhile (i--) {\n  \t\t\tinterpolators[i] = interpolate(from[i], to[i]);\n  \t\t}\n\n  \t\t// surplus values - don't interpolate, but don't exclude them either\n  \t\tfor (i = len; i < from.length; i += 1) {\n  \t\t\tintermediate[i] = from[i];\n  \t\t}\n\n  \t\tfor (i = len; i < to.length; i += 1) {\n  \t\t\tintermediate[i] = to[i];\n  \t\t}\n\n  \t\treturn function (t) {\n  \t\t\tvar i = len;\n\n  \t\t\twhile (i--) {\n  \t\t\t\tintermediate[i] = interpolators[i](t);\n  \t\t\t}\n\n  \t\t\treturn intermediate;\n  \t\t};\n  \t},\n\n  \tobject: function (from, to) {\n  \t\tvar properties, len, interpolators, intermediate, prop;\n\n  \t\tif (!isObject(from) || !isObject(to)) {\n  \t\t\treturn null;\n  \t\t}\n\n  \t\tproperties = [];\n  \t\tintermediate = {};\n  \t\tinterpolators = {};\n\n  \t\tfor (prop in from) {\n  \t\t\tif (hasOwn.call(from, prop)) {\n  \t\t\t\tif (hasOwn.call(to, prop)) {\n  \t\t\t\t\tproperties.push(prop);\n  \t\t\t\t\tinterpolators[prop] = interpolate(from[prop], to[prop]);\n  \t\t\t\t} else {\n  \t\t\t\t\tintermediate[prop] = from[prop];\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\tfor (prop in to) {\n  \t\t\tif (hasOwn.call(to, prop) && !hasOwn.call(from, prop)) {\n  \t\t\t\tintermediate[prop] = to[prop];\n  \t\t\t}\n  \t\t}\n\n  \t\tlen = properties.length;\n\n  \t\treturn function (t) {\n  \t\t\tvar i = len,\n  \t\t\t    prop;\n\n  \t\t\twhile (i--) {\n  \t\t\t\tprop = properties[i];\n\n  \t\t\t\tintermediate[prop] = interpolators[prop](t);\n  \t\t\t}\n\n  \t\t\treturn intermediate;\n  \t\t};\n  \t}\n  };\n\n  var interpolators$1 = interpolators;\n\n  function interpolate(from, to, ractive, type) {\n  \tif (from === to) return null;\n\n  \tif (type) {\n  \t\tvar interpol = findInViewHierarchy('interpolators', ractive, type);\n  \t\tif (interpol) return interpol(from, to) || null;\n\n  \t\tfatal(missingPlugin(type, 'interpolator'));\n  \t}\n\n  \treturn interpolators$1.number(from, to) || interpolators$1.array(from, to) || interpolators$1.object(from, to) || null;\n  }\n\n  var unprefixPattern = new RegExp('^-(?:' + vendors.join('|') + ')-');\n\n  function unprefix (prop) {\n  \treturn prop.replace(unprefixPattern, '');\n  }\n\n  var vendorPattern = new RegExp('^(?:' + vendors.join('|') + ')([A-Z])');\n\n  function hyphenate (str) {\n  \tif (!str) return ''; // edge case\n\n  \tif (vendorPattern.test(str)) str = '-' + str;\n\n  \treturn str.replace(/[A-Z]/g, function (match) {\n  \t\treturn '-' + match.toLowerCase();\n  \t});\n  }\n\n  var createTransitions = undefined;\n\n  if (!isClient) {\n  \tcreateTransitions = null;\n  } else {\n  \t(function () {\n  \t\tvar testStyle = createElement('div').style;\n  \t\tvar linear = function (x) {\n  \t\t\treturn x;\n  \t\t};\n\n  \t\tvar canUseCssTransitions = {};\n  \t\tvar cannotUseCssTransitions = {};\n\n  \t\t// determine some facts about our environment\n  \t\tvar TRANSITION = undefined;\n  \t\tvar TRANSITIONEND = undefined;\n  \t\tvar CSS_TRANSITIONS_ENABLED = undefined;\n  \t\tvar TRANSITION_DURATION = undefined;\n  \t\tvar TRANSITION_PROPERTY = undefined;\n  \t\tvar TRANSITION_TIMING_FUNCTION = undefined;\n\n  \t\tif (testStyle.transition !== undefined) {\n  \t\t\tTRANSITION = 'transition';\n  \t\t\tTRANSITIONEND = 'transitionend';\n  \t\t\tCSS_TRANSITIONS_ENABLED = true;\n  \t\t} else if (testStyle.webkitTransition !== undefined) {\n  \t\t\tTRANSITION = 'webkitTransition';\n  \t\t\tTRANSITIONEND = 'webkitTransitionEnd';\n  \t\t\tCSS_TRANSITIONS_ENABLED = true;\n  \t\t} else {\n  \t\t\tCSS_TRANSITIONS_ENABLED = false;\n  \t\t}\n\n  \t\tif (TRANSITION) {\n  \t\t\tTRANSITION_DURATION = TRANSITION + 'Duration';\n  \t\t\tTRANSITION_PROPERTY = TRANSITION + 'Property';\n  \t\t\tTRANSITION_TIMING_FUNCTION = TRANSITION + 'TimingFunction';\n  \t\t}\n\n  \t\tcreateTransitions = function (t, to, options, changedProperties, resolve) {\n\n  \t\t\t// Wait a beat (otherwise the target styles will be applied immediately)\n  \t\t\t// TODO use a fastdom-style mechanism?\n  \t\t\tsetTimeout(function () {\n  \t\t\t\tvar jsTransitionsComplete = undefined;\n  \t\t\t\tvar cssTransitionsComplete = undefined;\n\n  \t\t\t\tfunction checkComplete() {\n  \t\t\t\t\tif (jsTransitionsComplete && cssTransitionsComplete) {\n  \t\t\t\t\t\t// will changes to events and fire have an unexpected consequence here?\n  \t\t\t\t\t\tt.ractive.fire(t.name + ':end', t.node, t.isIntro);\n  \t\t\t\t\t\tresolve();\n  \t\t\t\t\t}\n  \t\t\t\t}\n\n  \t\t\t\t// this is used to keep track of which elements can use CSS to animate\n  \t\t\t\t// which properties\n  \t\t\t\tvar hashPrefix = (t.node.namespaceURI || '') + t.node.tagName;\n\n  \t\t\t\tt.node.style[TRANSITION_PROPERTY] = changedProperties.map(prefix$3).map(hyphenate).join(',');\n  \t\t\t\tt.node.style[TRANSITION_TIMING_FUNCTION] = hyphenate(options.easing || 'linear');\n  \t\t\t\tt.node.style[TRANSITION_DURATION] = options.duration / 1000 + 's';\n\n  \t\t\t\tfunction transitionEndHandler(event) {\n  \t\t\t\t\tvar index = changedProperties.indexOf(camelCase(unprefix(event.propertyName)));\n  \t\t\t\t\tif (index !== -1) {\n  \t\t\t\t\t\tchangedProperties.splice(index, 1);\n  \t\t\t\t\t}\n\n  \t\t\t\t\tif (changedProperties.length) {\n  \t\t\t\t\t\t// still transitioning...\n  \t\t\t\t\t\treturn;\n  \t\t\t\t\t}\n\n  \t\t\t\t\tt.node.removeEventListener(TRANSITIONEND, transitionEndHandler, false);\n\n  \t\t\t\t\tcssTransitionsComplete = true;\n  \t\t\t\t\tcheckComplete();\n  \t\t\t\t}\n\n  \t\t\t\tt.node.addEventListener(TRANSITIONEND, transitionEndHandler, false);\n\n  \t\t\t\tsetTimeout(function () {\n  \t\t\t\t\tvar i = changedProperties.length;\n  \t\t\t\t\tvar hash = undefined;\n  \t\t\t\t\tvar originalValue = undefined;\n  \t\t\t\t\tvar index = undefined;\n  \t\t\t\t\tvar propertiesToTransitionInJs = [];\n  \t\t\t\t\tvar prop = undefined;\n  \t\t\t\t\tvar suffix = undefined;\n  \t\t\t\t\tvar interpolator = undefined;\n\n  \t\t\t\t\twhile (i--) {\n  \t\t\t\t\t\tprop = changedProperties[i];\n  \t\t\t\t\t\thash = hashPrefix + prop;\n\n  \t\t\t\t\t\tif (CSS_TRANSITIONS_ENABLED && !cannotUseCssTransitions[hash]) {\n  \t\t\t\t\t\t\tt.node.style[prefix$3(prop)] = to[prop];\n\n  \t\t\t\t\t\t\t// If we're not sure if CSS transitions are supported for\n  \t\t\t\t\t\t\t// this tag/property combo, find out now\n  \t\t\t\t\t\t\tif (!canUseCssTransitions[hash]) {\n  \t\t\t\t\t\t\t\toriginalValue = t.getStyle(prop);\n\n  \t\t\t\t\t\t\t\t// if this property is transitionable in this browser,\n  \t\t\t\t\t\t\t\t// the current style will be different from the target style\n  \t\t\t\t\t\t\t\tcanUseCssTransitions[hash] = t.getStyle(prop) != to[prop];\n  \t\t\t\t\t\t\t\tcannotUseCssTransitions[hash] = !canUseCssTransitions[hash];\n\n  \t\t\t\t\t\t\t\t// Reset, if we're going to use timers after all\n  \t\t\t\t\t\t\t\tif (cannotUseCssTransitions[hash]) {\n  \t\t\t\t\t\t\t\t\tt.node.style[prefix$3(prop)] = originalValue;\n  \t\t\t\t\t\t\t\t}\n  \t\t\t\t\t\t\t}\n  \t\t\t\t\t\t}\n\n  \t\t\t\t\t\tif (!CSS_TRANSITIONS_ENABLED || cannotUseCssTransitions[hash]) {\n  \t\t\t\t\t\t\t// we need to fall back to timer-based stuff\n  \t\t\t\t\t\t\tif (originalValue === undefined) {\n  \t\t\t\t\t\t\t\toriginalValue = t.getStyle(prop);\n  \t\t\t\t\t\t\t}\n\n  \t\t\t\t\t\t\t// need to remove this from changedProperties, otherwise transitionEndHandler\n  \t\t\t\t\t\t\t// will get confused\n  \t\t\t\t\t\t\tindex = changedProperties.indexOf(prop);\n  \t\t\t\t\t\t\tif (index === -1) {\n  \t\t\t\t\t\t\t\twarnIfDebug('Something very strange happened with transitions. Please raise an issue at https://github.com/ractivejs/ractive/issues - thanks!', { node: t.node });\n  \t\t\t\t\t\t\t} else {\n  \t\t\t\t\t\t\t\tchangedProperties.splice(index, 1);\n  \t\t\t\t\t\t\t}\n\n  \t\t\t\t\t\t\t// TODO Determine whether this property is animatable at all\n\n  \t\t\t\t\t\t\tsuffix = /[^\\d]*$/.exec(to[prop])[0];\n  \t\t\t\t\t\t\tinterpolator = interpolate(parseFloat(originalValue), parseFloat(to[prop])) || function () {\n  \t\t\t\t\t\t\t\treturn to[prop];\n  \t\t\t\t\t\t\t};\n\n  \t\t\t\t\t\t\t// ...then kick off a timer-based transition\n  \t\t\t\t\t\t\tpropertiesToTransitionInJs.push({\n  \t\t\t\t\t\t\t\tname: prefix$3(prop),\n  \t\t\t\t\t\t\t\tinterpolator: interpolator,\n  \t\t\t\t\t\t\t\tsuffix: suffix\n  \t\t\t\t\t\t\t});\n  \t\t\t\t\t\t}\n  \t\t\t\t\t}\n\n  \t\t\t\t\t// javascript transitions\n  \t\t\t\t\tif (propertiesToTransitionInJs.length) {\n  \t\t\t\t\t\tvar easing = undefined;\n\n  \t\t\t\t\t\tif (typeof options.easing === 'string') {\n  \t\t\t\t\t\t\teasing = t.ractive.easing[options.easing];\n\n  \t\t\t\t\t\t\tif (!easing) {\n  \t\t\t\t\t\t\t\twarnOnceIfDebug(missingPlugin(options.easing, 'easing'));\n  \t\t\t\t\t\t\t\teasing = linear;\n  \t\t\t\t\t\t\t}\n  \t\t\t\t\t\t} else if (typeof options.easing === 'function') {\n  \t\t\t\t\t\t\teasing = options.easing;\n  \t\t\t\t\t\t} else {\n  \t\t\t\t\t\t\teasing = linear;\n  \t\t\t\t\t\t}\n\n  \t\t\t\t\t\tnew Ticker({\n  \t\t\t\t\t\t\tduration: options.duration,\n  \t\t\t\t\t\t\teasing: easing,\n  \t\t\t\t\t\t\tstep: function (pos) {\n  \t\t\t\t\t\t\t\tvar i = propertiesToTransitionInJs.length;\n  \t\t\t\t\t\t\t\twhile (i--) {\n  \t\t\t\t\t\t\t\t\tvar _prop = propertiesToTransitionInJs[i];\n  \t\t\t\t\t\t\t\t\tt.node.style[_prop.name] = _prop.interpolator(pos) + _prop.suffix;\n  \t\t\t\t\t\t\t\t}\n  \t\t\t\t\t\t\t},\n  \t\t\t\t\t\t\tcomplete: function () {\n  \t\t\t\t\t\t\t\tjsTransitionsComplete = true;\n  \t\t\t\t\t\t\t\tcheckComplete();\n  \t\t\t\t\t\t\t}\n  \t\t\t\t\t\t});\n  \t\t\t\t\t} else {\n  \t\t\t\t\t\tjsTransitionsComplete = true;\n  \t\t\t\t\t}\n\n  \t\t\t\t\tif (!changedProperties.length) {\n  \t\t\t\t\t\t// We need to cancel the transitionEndHandler, and deal with\n  \t\t\t\t\t\t// the fact that it will never fire\n  \t\t\t\t\t\tt.node.removeEventListener(TRANSITIONEND, transitionEndHandler, false);\n  \t\t\t\t\t\tcssTransitionsComplete = true;\n  \t\t\t\t\t\tcheckComplete();\n  \t\t\t\t\t}\n  \t\t\t\t}, 0);\n  \t\t\t}, options.delay || 0);\n  \t\t};\n  \t})();\n  }\n\n  var createTransitions$1 = createTransitions;\n\n  function resetStyle(node, style) {\n  \tif (style) {\n  \t\tnode.setAttribute('style', style);\n  \t} else {\n  \t\t// Next line is necessary, to remove empty style attribute!\n  \t\t// See http://stackoverflow.com/a/7167553\n  \t\tnode.getAttribute('style');\n  \t\tnode.removeAttribute('style');\n  \t}\n  }\n\n  var getComputedStyle = win && (win.getComputedStyle || legacy.getComputedStyle);\n  var resolved = Promise$1.resolve();\n\n  var Transition = (function () {\n  \tfunction Transition(owner, template, isIntro) {\n  \t\tclassCallCheck(this, Transition);\n\n  \t\tthis.owner = owner;\n  \t\tthis.isIntro = isIntro;\n  \t\tthis.ractive = owner.ractive;\n\n  \t\tvar ractive = owner.ractive;\n\n  \t\tvar name = template.n || template;\n\n  \t\tif (typeof name !== 'string') {\n  \t\t\tvar fragment = new Fragment({\n  \t\t\t\towner: owner,\n  \t\t\t\ttemplate: name\n  \t\t\t}).bind(); // TODO need a way to capture values without bind()\n\n  \t\t\tname = fragment.toString();\n  \t\t\tfragment.unbind();\n\n  \t\t\tif (name === '') {\n  \t\t\t\t// empty string okay, just no transition\n  \t\t\t\treturn;\n  \t\t\t}\n  \t\t}\n\n  \t\tthis.name = name;\n\n  \t\tif (template.a) {\n  \t\t\tthis.params = template.a;\n  \t\t} else if (template.d) {\n  \t\t\t// TODO is there a way to interpret dynamic arguments without all the\n  \t\t\t// 'dependency thrashing'?\n  \t\t\tvar fragment = new Fragment({\n  \t\t\t\towner: owner,\n  \t\t\t\ttemplate: template.d\n  \t\t\t}).bind();\n\n  \t\t\tthis.params = fragment.getArgsList();\n  \t\t\tfragment.unbind();\n  \t\t}\n\n  \t\tthis._fn = findInViewHierarchy('transitions', ractive, name);\n\n  \t\tif (!this._fn) {\n  \t\t\twarnOnceIfDebug(missingPlugin(name, 'transition'), { ractive: ractive });\n  \t\t}\n  \t}\n\n  \tTransition.prototype.animateStyle = function animateStyle(style, value, options) {\n  \t\tvar _this = this;\n\n  \t\tif (arguments.length === 4) {\n  \t\t\tthrow new Error('t.animateStyle() returns a promise - use .then() instead of passing a callback');\n  \t\t}\n\n  \t\t// Special case - page isn't visible. Don't animate anything, because\n  \t\t// that way you'll never get CSS transitionend events\n  \t\tif (!visible) {\n  \t\t\tthis.setStyle(style, value);\n  \t\t\treturn resolved;\n  \t\t}\n\n  \t\tvar to = undefined;\n\n  \t\tif (typeof style === 'string') {\n  \t\t\tto = {};\n  \t\t\tto[style] = value;\n  \t\t} else {\n  \t\t\tto = style;\n\n  \t\t\t// shuffle arguments\n  \t\t\toptions = value;\n  \t\t}\n\n  \t\t// As of 0.3.9, transition authors should supply an `option` object with\n  \t\t// `duration` and `easing` properties (and optional `delay`), plus a\n  \t\t// callback function that gets called after the animation completes\n\n  \t\t// TODO remove this check in a future version\n  \t\tif (!options) {\n  \t\t\twarnOnceIfDebug('The \"%s\" transition does not supply an options object to `t.animateStyle()`. This will break in a future version of Ractive. For more info see https://github.com/RactiveJS/Ractive/issues/340', this.name);\n  \t\t\toptions = this;\n  \t\t}\n\n  \t\treturn new Promise$1(function (fulfil) {\n  \t\t\t// Edge case - if duration is zero, set style synchronously and complete\n  \t\t\tif (!options.duration) {\n  \t\t\t\t_this.setStyle(to);\n  \t\t\t\tfulfil();\n  \t\t\t\treturn;\n  \t\t\t}\n\n  \t\t\t// Get a list of the properties we're animating\n  \t\t\tvar propertyNames = Object.keys(to);\n  \t\t\tvar changedProperties = [];\n\n  \t\t\t// Store the current styles\n  \t\t\tvar computedStyle = getComputedStyle(_this.node);\n\n  \t\t\tvar i = propertyNames.length;\n  \t\t\twhile (i--) {\n  \t\t\t\tvar prop = propertyNames[i];\n  \t\t\t\tvar current = computedStyle[prefix$3(prop)];\n\n  \t\t\t\tif (current === '0px') current = 0;\n\n  \t\t\t\t// we need to know if we're actually changing anything\n  \t\t\t\tif (current != to[prop]) {\n  \t\t\t\t\t// use != instead of !==, so we can compare strings with numbers\n  \t\t\t\t\tchangedProperties.push(prop);\n\n  \t\t\t\t\t// make the computed style explicit, so we can animate where\n  \t\t\t\t\t// e.g. height='auto'\n  \t\t\t\t\t_this.node.style[prefix$3(prop)] = current;\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\t// If we're not actually changing anything, the transitionend event\n  \t\t\t// will never fire! So we complete early\n  \t\t\tif (!changedProperties.length) {\n  \t\t\t\tfulfil();\n  \t\t\t\treturn;\n  \t\t\t}\n\n  \t\t\tcreateTransitions$1(_this, to, options, changedProperties, fulfil);\n  \t\t});\n  \t};\n\n  \tTransition.prototype.getStyle = function getStyle(props) {\n  \t\tvar computedStyle = getComputedStyle(this.node);\n\n  \t\tif (typeof props === 'string') {\n  \t\t\tvar value = computedStyle[prefix$3(props)];\n  \t\t\treturn value === '0px' ? 0 : value;\n  \t\t}\n\n  \t\tif (!isArray(props)) {\n  \t\t\tthrow new Error('Transition$getStyle must be passed a string, or an array of strings representing CSS properties');\n  \t\t}\n\n  \t\tvar styles = {};\n\n  \t\tvar i = props.length;\n  \t\twhile (i--) {\n  \t\t\tvar prop = props[i];\n  \t\t\tvar value = computedStyle[prefix$3(prop)];\n\n  \t\t\tif (value === '0px') value = 0;\n  \t\t\tstyles[prop] = value;\n  \t\t}\n\n  \t\treturn styles;\n  \t};\n\n  \tTransition.prototype.processParams = function processParams(params, defaults) {\n  \t\tif (typeof params === 'number') {\n  \t\t\tparams = { duration: params };\n  \t\t} else if (typeof params === 'string') {\n  \t\t\tif (params === 'slow') {\n  \t\t\t\tparams = { duration: 600 };\n  \t\t\t} else if (params === 'fast') {\n  \t\t\t\tparams = { duration: 200 };\n  \t\t\t} else {\n  \t\t\t\tparams = { duration: 400 };\n  \t\t\t}\n  \t\t} else if (!params) {\n  \t\t\tparams = {};\n  \t\t}\n\n  \t\treturn extend({}, defaults, params);\n  \t};\n\n  \tTransition.prototype.setStyle = function setStyle(style, value) {\n  \t\tif (typeof style === 'string') {\n  \t\t\tthis.node.style[prefix$3(style)] = value;\n  \t\t} else {\n  \t\t\tvar prop = undefined;\n  \t\t\tfor (prop in style) {\n  \t\t\t\tif (style.hasOwnProperty(prop)) {\n  \t\t\t\t\tthis.node.style[prefix$3(prop)] = style[prop];\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\treturn this;\n  \t};\n\n  \tTransition.prototype.start = function start() {\n  \t\tvar _this2 = this;\n\n  \t\tvar node = this.node = this.owner.node;\n  \t\tvar originalStyle = node.getAttribute('style');\n\n  \t\tvar completed = undefined;\n\n  \t\t// create t.complete() - we don't want this on the prototype,\n  \t\t// because we don't want `this` silliness when passing it as\n  \t\t// an argument\n  \t\tthis.complete = function (noReset) {\n  \t\t\tif (completed) {\n  \t\t\t\treturn;\n  \t\t\t}\n\n  \t\t\tif (!noReset && _this2.isIntro) {\n  \t\t\t\tresetStyle(node, originalStyle);\n  \t\t\t}\n\n  \t\t\t_this2._manager.remove(_this2);\n\n  \t\t\tcompleted = true;\n  \t\t};\n\n  \t\t// If the transition function doesn't exist, abort\n  \t\tif (!this._fn) {\n  \t\t\tthis.complete();\n  \t\t\treturn;\n  \t\t}\n\n  \t\tthis._fn.apply(this.root, [this].concat(this.params));\n  \t};\n\n  \treturn Transition;\n  })();\n\n  function updateLiveQueries$1(element) {\n  \t// Does this need to be added to any live queries?\n  \tvar node = element.node;\n  \tvar instance = element.ractive;\n\n  \tdo {\n  \t\tvar liveQueries = instance._liveQueries;\n\n  \t\tvar i = liveQueries.length;\n  \t\twhile (i--) {\n  \t\t\tvar selector = liveQueries[i];\n  \t\t\tvar query = liveQueries[\"_\" + selector];\n\n  \t\t\tif (query.test(node)) {\n  \t\t\t\tquery.add(node);\n  \t\t\t\t// keep register of applicable selectors, for when we teardown\n  \t\t\t\telement.liveQueries.push(query);\n  \t\t\t}\n  \t\t}\n  \t} while (instance = instance.parent);\n  }\n\n  // TODO element.parent currently undefined\n  function findParentForm(element) {\n  \twhile (element = element.parent) {\n  \t\tif (element.name === 'form') {\n  \t\t\treturn element;\n  \t\t}\n  \t}\n  }\n\n  function warnAboutAmbiguity(description, ractive) {\n  \twarnOnceIfDebug('The ' + description + ' being used for two-way binding is ambiguous, and may cause unexpected results. Consider initialising your data to eliminate the ambiguity', { ractive: ractive });\n  }\n\n  var Binding = (function () {\n  \tfunction Binding(element) {\n  \t\tvar name = arguments.length <= 1 || arguments[1] === undefined ? 'value' : arguments[1];\n  \t\tclassCallCheck(this, Binding);\n\n  \t\tthis.element = element;\n  \t\tthis.ractive = element.ractive;\n  \t\tthis.attribute = element.attributeByName[name];\n\n  \t\tvar interpolator = this.attribute.interpolator;\n  \t\tinterpolator.twowayBinding = this;\n\n  \t\tvar model = interpolator.model;\n\n  \t\t// not bound?\n  \t\tif (!model) {\n  \t\t\t// try to force resolution\n  \t\t\tinterpolator.resolver.forceResolution();\n  \t\t\tmodel = interpolator.model;\n\n  \t\t\twarnAboutAmbiguity('\\'' + interpolator.template.r + '\\' reference', this.ractive);\n  \t\t} else if (model.isUnresolved) {\n  \t\t\t// reference expressions (e.g. foo[bar])\n  \t\t\tmodel.forceResolution();\n  \t\t\twarnAboutAmbiguity('expression', this.ractive);\n  \t\t}\n\n  \t\t// TODO include index/key/keypath refs as read-only\n  \t\telse if (model.isReadonly) {\n  \t\t\t\tvar keypath = model.getKeypath().replace(/^@/, '');\n  \t\t\t\twarnOnceIfDebug('Cannot use two-way binding on <' + element.name + '> element: ' + keypath + ' is read-only. To suppress this warning use <' + element.name + ' twoway=\\'false\\'...>', { ractive: this.ractive });\n  \t\t\t\treturn false;\n  \t\t\t}\n\n  \t\tthis.attribute.isTwoway = true;\n  \t\tthis.model = model;\n\n  \t\t// initialise value, if it's undefined\n  \t\tvar value = model.get();\n\n  \t\tif (value === undefined && this.getInitialValue) {\n  \t\t\tvalue = this.getInitialValue();\n  \t\t\tmodel.set(value);\n  \t\t}\n\n  \t\tvar parentForm = findParentForm(element);\n  \t\tif (parentForm) {\n  \t\t\tthis.resetValue = value;\n  \t\t\tparentForm.formBindings.push(this);\n  \t\t}\n  \t}\n\n  \tBinding.prototype.bind = function bind() {\n  \t\tthis.model.registerTwowayBinding(this);\n  \t};\n\n  \tBinding.prototype.handleChange = function handleChange() {\n  \t\tvar _this = this;\n\n  \t\trunloop.start(this.root);\n  \t\tthis.attribute.locked = true;\n  \t\tthis.model.set(this.getValue());\n  \t\trunloop.scheduleTask(function () {\n  \t\t\treturn _this.attribute.locked = false;\n  \t\t});\n  \t\trunloop.end();\n  \t};\n\n  \tBinding.prototype.rebind = function rebind() {\n  \t\t// TODO what does this work with CheckboxNameBinding et al?\n  \t\tthis.unbind();\n  \t\tthis.model = this.attribute.interpolator.model;\n  \t\tthis.bind();\n  \t};\n\n  \tBinding.prototype.render = function render() {\n  \t\tthis.node = this.element.node;\n  \t\tthis.node._ractive.binding = this;\n  \t\tthis.rendered = true; // TODO is this used anywhere?\n  \t};\n\n  \tBinding.prototype.unbind = function unbind() {\n  \t\tthis.model.unregisterTwowayBinding(this);\n  \t};\n\n  \tBinding.prototype.unrender = function unrender() {\n  \t\t// noop?\n  \t};\n\n  \treturn Binding;\n  })();\n\n  // This is the handler for DOM events that would lead to a change in the model\n  // (i.e. change, sometimes, input, and occasionally click and keyup)\n\n  function handleDomEvent() {\n  \tthis._ractive.binding.handleChange();\n  }\n\n  var CheckboxBinding = (function (_Binding) {\n  \tinherits(CheckboxBinding, _Binding);\n\n  \tfunction CheckboxBinding(element) {\n  \t\tclassCallCheck(this, CheckboxBinding);\n\n  \t\t_Binding.call(this, element, 'checked');\n  \t}\n\n  \tCheckboxBinding.prototype.render = function render() {\n  \t\t_Binding.prototype.render.call(this);\n\n  \t\tthis.node.addEventListener('change', handleDomEvent, false);\n\n  \t\tif (this.node.attachEvent) {\n  \t\t\tthis.node.addEventListener('click', handleDomEvent, false);\n  \t\t}\n  \t};\n\n  \tCheckboxBinding.prototype.unrender = function unrender() {\n  \t\tthis.node.removeEventListener('change', handleDomEvent, false);\n  \t\tthis.node.removeEventListener('click', handleDomEvent, false);\n  \t};\n\n  \tCheckboxBinding.prototype.getInitialValue = function getInitialValue() {\n  \t\treturn !!this.element.getAttribute('checked');\n  \t};\n\n  \tCheckboxBinding.prototype.getValue = function getValue() {\n  \t\treturn this.node.checked;\n  \t};\n\n  \treturn CheckboxBinding;\n  })(Binding);\n\n  function getBindingGroup(group, model, getValue) {\n  \tvar hash = group + \"-bindingGroup\";\n  \treturn model[hash] || (model[hash] = new BindingGroup(hash, model, getValue));\n  }\n\n  var BindingGroup = (function () {\n  \tfunction BindingGroup(hash, model, getValue) {\n  \t\tvar _this = this;\n\n  \t\tclassCallCheck(this, BindingGroup);\n\n  \t\tthis.model = model;\n  \t\tthis.hash = hash;\n  \t\tthis.getValue = function () {\n  \t\t\t_this.value = getValue.call(_this);\n  \t\t\treturn _this.value;\n  \t\t};\n\n  \t\tthis.bindings = [];\n  \t}\n\n  \tBindingGroup.prototype.add = function add(binding) {\n  \t\tthis.bindings.push(binding);\n  \t};\n\n  \tBindingGroup.prototype.bind = function bind() {\n  \t\tthis.value = this.model.get();\n  \t\tthis.model.registerTwowayBinding(this);\n  \t\tthis.bound = true;\n  \t};\n\n  \tBindingGroup.prototype.remove = function remove(binding) {\n  \t\tremoveFromArray(this.bindings, binding);\n  \t\tif (!this.bindings.length) {\n  \t\t\tthis.unbind();\n  \t\t}\n  \t};\n\n  \tBindingGroup.prototype.unbind = function unbind() {\n  \t\tthis.model.unregisterTwowayBinding(this);\n  \t\tthis.bound = false;\n  \t\tdelete this.model[this.hash];\n  \t};\n\n  \treturn BindingGroup;\n  })();\n\n  var push$1 = [].push;\n\n  function getValue$1() {\n  \tvar all = this.bindings.filter(function (b) {\n  \t\treturn b.node.checked;\n  \t}).map(function (b) {\n  \t\treturn b.element.getAttribute('value');\n  \t});\n  \tvar res = [];\n  \tall.forEach(function (v) {\n  \t\tif (!arrayContains(res, v)) res.push(v);\n  \t});\n  \treturn res;\n  }\n\n  var CheckboxNameBinding = (function (_Binding) {\n  \tinherits(CheckboxNameBinding, _Binding);\n\n  \tfunction CheckboxNameBinding(element) {\n  \t\tclassCallCheck(this, CheckboxNameBinding);\n\n  \t\t_Binding.call(this, element, 'name');\n\n  \t\tthis.checkboxName = true; // so that ractive.updateModel() knows what to do with this\n\n  \t\t// Each input has a reference to an array containing it and its\n  \t\t// group, as two-way binding depends on being able to ascertain\n  \t\t// the status of all inputs within the group\n  \t\tthis.group = getBindingGroup('checkboxes', this.model, getValue$1);\n  \t\tthis.group.add(this);\n\n  \t\tif (this.noInitialValue) {\n  \t\t\tthis.group.noInitialValue = true;\n  \t\t}\n\n  \t\t// If no initial value was set, and this input is checked, we\n  \t\t// update the model\n  \t\tif (this.group.noInitialValue && this.element.getAttribute('checked')) {\n  \t\t\tvar existingValue = this.model.get();\n  \t\t\tvar bindingValue = this.element.getAttribute('value');\n\n  \t\t\tif (!arrayContains(existingValue, bindingValue)) {\n  \t\t\t\tpush$1.call(existingValue, bindingValue); // to avoid triggering runloop with array adaptor\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \tCheckboxNameBinding.prototype.bind = function bind() {\n  \t\tif (!this.group.bound) {\n  \t\t\tthis.group.bind();\n  \t\t}\n  \t};\n\n  \tCheckboxNameBinding.prototype.changed = function changed() {\n  \t\tvar wasChecked = !!this.isChecked;\n  \t\tthis.isChecked = this.node.checked;\n  \t\treturn this.isChecked === wasChecked;\n  \t};\n\n  \tCheckboxNameBinding.prototype.getInitialValue = function getInitialValue() {\n  \t\t// This only gets called once per group (of inputs that\n  \t\t// share a name), because it only gets called if there\n  \t\t// isn't an initial value. By the same token, we can make\n  \t\t// a note of that fact that there was no initial value,\n  \t\t// and populate it using any `checked` attributes that\n  \t\t// exist (which users should avoid, but which we should\n  \t\t// support anyway to avoid breaking expectations)\n  \t\tthis.noInitialValue = true;\n  \t\treturn [];\n  \t};\n\n  \tCheckboxNameBinding.prototype.getValue = function getValue() {\n  \t\treturn this.group.value;\n  \t};\n\n  \tCheckboxNameBinding.prototype.handleChange = function handleChange() {\n  \t\tthis.isChecked = this.element.node.checked;\n  \t\tthis.group.value = this.model.get();\n  \t\tvar value = this.element.getAttribute('value');\n  \t\tif (this.isChecked && !arrayContains(this.group.value, value)) {\n  \t\t\tthis.group.value.push(value);\n  \t\t} else if (!this.isChecked && arrayContains(this.group.value, value)) {\n  \t\t\tremoveFromArray(this.group.value, value);\n  \t\t}\n  \t\t_Binding.prototype.handleChange.call(this);\n  \t};\n\n  \tCheckboxNameBinding.prototype.render = function render() {\n  \t\t_Binding.prototype.render.call(this);\n\n  \t\tvar node = this.node;\n\n  \t\tvar existingValue = this.model.get();\n  \t\tvar bindingValue = this.element.getAttribute('value');\n\n  \t\tif (isArray(existingValue)) {\n  \t\t\tthis.isChecked = arrayContains(existingValue, bindingValue);\n  \t\t} else {\n  \t\t\tthis.isChecked = existingValue == bindingValue;\n  \t\t}\n\n  \t\tnode.name = '{{' + this.model.getKeypath() + '}}';\n  \t\tnode.checked = this.isChecked;\n\n  \t\tnode.addEventListener('change', handleDomEvent, false);\n\n  \t\t// in case of IE emergency, bind to click event as well\n  \t\tif (node.attachEvent) {\n  \t\t\tnode.addEventListener('click', handleDomEvent, false);\n  \t\t}\n  \t};\n\n  \tCheckboxNameBinding.prototype.unbind = function unbind() {\n  \t\tthis.group.remove(this);\n  \t};\n\n  \tCheckboxNameBinding.prototype.unrender = function unrender() {\n  \t\tvar node = this.element.node;\n\n  \t\tnode.removeEventListener('change', handleDomEvent, false);\n  \t\tnode.removeEventListener('click', handleDomEvent, false);\n  \t};\n\n  \treturn CheckboxNameBinding;\n  })(Binding);\n\n  var ContentEditableBinding = (function (_Binding) {\n  \tinherits(ContentEditableBinding, _Binding);\n\n  \tfunction ContentEditableBinding() {\n  \t\tclassCallCheck(this, ContentEditableBinding);\n\n  \t\t_Binding.apply(this, arguments);\n  \t}\n\n  \tContentEditableBinding.prototype.getInitialValue = function getInitialValue() {\n  \t\treturn this.element.fragment ? this.element.fragment.toString() : '';\n  \t};\n\n  \tContentEditableBinding.prototype.render = function render() {\n  \t\t_Binding.prototype.render.call(this);\n\n  \t\tvar node = this.node;\n\n  \t\tnode.addEventListener('change', handleDomEvent, false);\n  \t\tnode.addEventListener('blur', handleDomEvent, false);\n\n  \t\tif (!this.ractive.lazy) {\n  \t\t\tnode.addEventListener('input', handleDomEvent, false);\n\n  \t\t\tif (node.attachEvent) {\n  \t\t\t\tnode.addEventListener('keyup', handleDomEvent, false);\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tContentEditableBinding.prototype.unrender = function unrender() {\n  \t\tvar node = this.node;\n\n  \t\tnode.removeEventListener('blur', handleDomEvent, false);\n  \t\tnode.removeEventListener('change', handleDomEvent, false);\n  \t\tnode.removeEventListener('input', handleDomEvent, false);\n  \t\tnode.removeEventListener('keyup', handleDomEvent, false);\n  \t};\n\n  \tContentEditableBinding.prototype.getValue = function getValue() {\n  \t\treturn this.element.node.innerHTML;\n  \t};\n\n  \treturn ContentEditableBinding;\n  })(Binding);\n\n  function handleBlur() {\n  \thandleDomEvent.call(this);\n\n  \tvar value = this._ractive.binding.model.get();\n  \tthis.value = value == undefined ? '' : value;\n  }\n\n  function handleDelay(delay) {\n  \tvar timeout = undefined;\n\n  \treturn function () {\n  \t\tvar _this = this;\n\n  \t\tif (timeout) clearTimeout(timeout);\n\n  \t\ttimeout = setTimeout(function () {\n  \t\t\tvar binding = _this._ractive.binding;\n  \t\t\tif (binding.rendered) handleDomEvent.call(_this);\n  \t\t\ttimeout = null;\n  \t\t}, delay);\n  \t};\n  }\n\n  var GenericBinding = (function (_Binding) {\n  \tinherits(GenericBinding, _Binding);\n\n  \tfunction GenericBinding() {\n  \t\tclassCallCheck(this, GenericBinding);\n\n  \t\t_Binding.apply(this, arguments);\n  \t}\n\n  \tGenericBinding.prototype.getInitialValue = function getInitialValue() {\n  \t\treturn '';\n  \t};\n\n  \tGenericBinding.prototype.getValue = function getValue() {\n  \t\treturn this.node.value;\n  \t};\n\n  \tGenericBinding.prototype.render = function render() {\n  \t\t_Binding.prototype.render.call(this);\n\n  \t\t// any lazy setting for this element overrides the root\n  \t\t// if the value is a number, it's a timeout\n  \t\tvar lazy = this.ractive.lazy;\n  \t\tvar timeout = false;\n\n  \t\t// TODO handle at parse time\n  \t\tif (this.element.template.a && 'lazy' in this.element.template.a) {\n  \t\t\tlazy = this.element.template.a.lazy;\n  \t\t\tif (lazy === 0) lazy = true; // empty attribute\n  \t\t}\n\n  \t\t// TODO handle this at parse time as well?\n  \t\tif (lazy === 'false') lazy = false;\n\n  \t\tif (isNumeric(lazy)) {\n  \t\t\ttimeout = +lazy;\n  \t\t\tlazy = false;\n  \t\t}\n\n  \t\tthis.handler = timeout ? handleDelay(timeout) : handleDomEvent;\n\n  \t\tvar node = this.node;\n\n  \t\tnode.addEventListener('change', handleDomEvent, false);\n\n  \t\tif (!lazy) {\n  \t\t\tnode.addEventListener('input', this.handler, false);\n\n  \t\t\tif (node.attachEvent) {\n  \t\t\t\tnode.addEventListener('keyup', this.handler, false);\n  \t\t\t}\n  \t\t}\n\n  \t\tnode.addEventListener('blur', handleBlur, false);\n  \t};\n\n  \tGenericBinding.prototype.unrender = function unrender() {\n  \t\tvar node = this.element.node;\n  \t\tthis.rendered = false;\n\n  \t\tnode.removeEventListener('change', handleDomEvent, false);\n  \t\tnode.removeEventListener('input', this.handler, false);\n  \t\tnode.removeEventListener('keyup', this.handler, false);\n  \t\tnode.removeEventListener('blur', handleBlur, false);\n  \t};\n\n  \treturn GenericBinding;\n  })(Binding);\n\n  var MultipleSelectBinding = (function (_Binding) {\n  \tinherits(MultipleSelectBinding, _Binding);\n\n  \tfunction MultipleSelectBinding() {\n  \t\tclassCallCheck(this, MultipleSelectBinding);\n\n  \t\t_Binding.apply(this, arguments);\n  \t}\n\n  \tMultipleSelectBinding.prototype.forceUpdate = function forceUpdate() {\n  \t\tvar _this = this;\n\n  \t\tvar value = this.getValue();\n\n  \t\tif (value !== undefined) {\n  \t\t\tthis.attribute.locked = true;\n  \t\t\trunloop.scheduleTask(function () {\n  \t\t\t\treturn _this.attribute.locked = false;\n  \t\t\t});\n  \t\t\tthis.model.set(value);\n  \t\t}\n  \t};\n\n  \tMultipleSelectBinding.prototype.getInitialValue = function getInitialValue() {\n  \t\treturn this.element.options.filter(function (option) {\n  \t\t\treturn option.getAttribute('selected');\n  \t\t}).map(function (option) {\n  \t\t\treturn option.getAttribute('value');\n  \t\t});\n  \t};\n\n  \tMultipleSelectBinding.prototype.getValue = function getValue() {\n  \t\tvar options = this.element.node.options;\n  \t\tvar len = options.length;\n\n  \t\tvar selectedValues = [];\n\n  \t\tfor (var i = 0; i < len; i += 1) {\n  \t\t\tvar option = options[i];\n\n  \t\t\tif (option.selected) {\n  \t\t\t\tvar optionValue = option._ractive ? option._ractive.value : option.value;\n  \t\t\t\tselectedValues.push(optionValue);\n  \t\t\t}\n  \t\t}\n\n  \t\treturn selectedValues;\n  \t};\n\n  \tMultipleSelectBinding.prototype.handleChange = function handleChange() {\n  \t\tvar attribute = this.attribute;\n  \t\tvar previousValue = attribute.getValue();\n\n  \t\tvar value = this.getValue();\n\n  \t\tif (previousValue === undefined || !arrayContentsMatch(value, previousValue)) {\n  \t\t\t_Binding.prototype.handleChange.call(this);\n  \t\t}\n\n  \t\treturn this;\n  \t};\n\n  \tMultipleSelectBinding.prototype.render = function render() {\n  \t\t_Binding.prototype.render.call(this);\n\n  \t\tthis.node.addEventListener('change', handleDomEvent, false);\n\n  \t\tif (this.model.get() === undefined) {\n  \t\t\t// get value from DOM, if possible\n  \t\t\tthis.handleChange();\n  \t\t}\n  \t};\n\n  \tMultipleSelectBinding.prototype.setValue = function setValue() {\n  \t\tthrow new Error('TODO not implemented yet');\n  \t};\n\n  \tMultipleSelectBinding.prototype.unrender = function unrender() {\n  \t\tthis.node.removeEventListener('change', handleDomEvent, false);\n  \t};\n\n  \tMultipleSelectBinding.prototype.updateModel = function updateModel() {\n  \t\tif (this.attribute.value === undefined || !this.attribute.value.length) {\n  \t\t\tthis.keypath.set(this.initialValue);\n  \t\t}\n  \t};\n\n  \treturn MultipleSelectBinding;\n  })(Binding);\n\n  var NumericBinding = (function (_GenericBinding) {\n  \tinherits(NumericBinding, _GenericBinding);\n\n  \tfunction NumericBinding() {\n  \t\tclassCallCheck(this, NumericBinding);\n\n  \t\t_GenericBinding.apply(this, arguments);\n  \t}\n\n  \tNumericBinding.prototype.getInitialValue = function getInitialValue() {\n  \t\treturn undefined;\n  \t};\n\n  \tNumericBinding.prototype.getValue = function getValue() {\n  \t\tvar value = parseFloat(this.node.value);\n  \t\treturn isNaN(value) ? undefined : value;\n  \t};\n\n  \treturn NumericBinding;\n  })(GenericBinding);\n\n  var siblings = {};\n\n  function getSiblings(hash) {\n  \treturn siblings[hash] || (siblings[hash] = []);\n  }\n\n  var RadioBinding = (function (_Binding) {\n  \tinherits(RadioBinding, _Binding);\n\n  \tfunction RadioBinding(element) {\n  \t\tclassCallCheck(this, RadioBinding);\n\n  \t\t_Binding.call(this, element, 'checked');\n\n  \t\tthis.siblings = getSiblings(this.ractive._guid + this.element.getAttribute('name'));\n  \t\tthis.siblings.push(this);\n  \t}\n\n  \tRadioBinding.prototype.getValue = function getValue() {\n  \t\treturn this.node.checked;\n  \t};\n\n  \tRadioBinding.prototype.handleChange = function handleChange() {\n  \t\trunloop.start(this.root);\n\n  \t\tthis.siblings.forEach(function (binding) {\n  \t\t\tbinding.model.set(binding.getValue());\n  \t\t});\n\n  \t\trunloop.end();\n  \t};\n\n  \tRadioBinding.prototype.render = function render() {\n  \t\t_Binding.prototype.render.call(this);\n\n  \t\tthis.node.addEventListener('change', handleDomEvent, false);\n\n  \t\tif (this.node.attachEvent) {\n  \t\t\tthis.node.addEventListener('click', handleDomEvent, false);\n  \t\t}\n  \t};\n\n  \tRadioBinding.prototype.unbind = function unbind() {\n  \t\tremoveFromArray(this.siblings, this);\n  \t};\n\n  \tRadioBinding.prototype.unrender = function unrender() {\n  \t\tthis.node.removeEventListener('change', handleDomEvent, false);\n  \t\tthis.node.removeEventListener('click', handleDomEvent, false);\n  \t};\n\n  \treturn RadioBinding;\n  })(Binding);\n\n  function getValue$2() {\n  \tvar checked = this.bindings.filter(function (b) {\n  \t\treturn b.node.checked;\n  \t});\n  \tif (checked.length > 0) {\n  \t\treturn checked[0].element.getAttribute('value');\n  \t}\n  }\n\n  var RadioNameBinding = (function (_Binding) {\n  \tinherits(RadioNameBinding, _Binding);\n\n  \tfunction RadioNameBinding(element) {\n  \t\tclassCallCheck(this, RadioNameBinding);\n\n  \t\t_Binding.call(this, element, 'name');\n\n  \t\tthis.group = getBindingGroup('radioname', this.model, getValue$2);\n  \t\tthis.group.add(this);\n\n  \t\tif (element.checked) {\n  \t\t\tthis.group.value = this.getValue();\n  \t\t}\n  \t}\n\n  \tRadioNameBinding.prototype.bind = function bind() {\n  \t\tvar _this = this;\n\n  \t\tif (!this.group.bound) {\n  \t\t\tthis.group.bind();\n  \t\t}\n\n  \t\t// update name keypath when necessary\n  \t\tthis.nameAttributeBinding = {\n  \t\t\thandleChange: function () {\n  \t\t\t\treturn _this.node.name = '{{' + _this.model.getKeypath() + '}}';\n  \t\t\t}\n  \t\t};\n\n  \t\tthis.model.getKeypathModel().register(this.nameAttributeBinding);\n  \t};\n\n  \tRadioNameBinding.prototype.getInitialValue = function getInitialValue() {\n  \t\tif (this.element.getAttribute('checked')) {\n  \t\t\treturn this.element.getAttribute('value');\n  \t\t}\n  \t};\n\n  \tRadioNameBinding.prototype.getValue = function getValue() {\n  \t\treturn this.element.getAttribute('value');\n  \t};\n\n  \tRadioNameBinding.prototype.handleChange = function handleChange() {\n  \t\t// If this <input> is the one that's checked, then the value of its\n  \t\t// `name` model gets set to its value\n  \t\tif (this.node.checked) {\n  \t\t\tthis.group.value = this.getValue();\n  \t\t\t_Binding.prototype.handleChange.call(this);\n  \t\t}\n  \t};\n\n  \tRadioNameBinding.prototype.render = function render() {\n  \t\t_Binding.prototype.render.call(this);\n\n  \t\tvar node = this.node;\n\n  \t\tnode.name = '{{' + this.model.getKeypath() + '}}';\n  \t\tnode.checked = this.model.get() == this.element.getAttribute('value');\n\n  \t\tnode.addEventListener('change', handleDomEvent, false);\n\n  \t\tif (node.attachEvent) {\n  \t\t\tnode.addEventListener('click', handleDomEvent, false);\n  \t\t}\n  \t};\n\n  \tRadioNameBinding.prototype.unbind = function unbind() {\n  \t\tthis.group.remove(this);\n\n  \t\tthis.model.getKeypathModel().unregister(this.nameAttributeBinding);\n  \t};\n\n  \tRadioNameBinding.prototype.unrender = function unrender() {\n  \t\tvar node = this.node;\n\n  \t\tnode.removeEventListener('change', handleDomEvent, false);\n  \t\tnode.removeEventListener('click', handleDomEvent, false);\n  \t};\n\n  \treturn RadioNameBinding;\n  })(Binding);\n\n  var SingleSelectBinding = (function (_Binding) {\n  \tinherits(SingleSelectBinding, _Binding);\n\n  \tfunction SingleSelectBinding() {\n  \t\tclassCallCheck(this, SingleSelectBinding);\n\n  \t\t_Binding.apply(this, arguments);\n  \t}\n\n  \tSingleSelectBinding.prototype.forceUpdate = function forceUpdate() {\n  \t\tvar _this = this;\n\n  \t\tvar value = this.getValue();\n\n  \t\tif (value !== undefined) {\n  \t\t\tthis.attribute.locked = true;\n  \t\t\trunloop.scheduleTask(function () {\n  \t\t\t\treturn _this.attribute.locked = false;\n  \t\t\t});\n  \t\t\tthis.model.set(value);\n  \t\t}\n  \t};\n\n  \tSingleSelectBinding.prototype.getInitialValue = function getInitialValue() {\n  \t\tif (this.element.getAttribute('value') !== undefined) {\n  \t\t\treturn;\n  \t\t}\n\n  \t\tvar options = this.element.options;\n  \t\tvar len = options.length;\n\n  \t\tif (!len) return;\n\n  \t\tvar value = undefined;\n  \t\tvar optionWasSelected = undefined;\n  \t\tvar i = len;\n\n  \t\t// take the final selected option...\n  \t\twhile (i--) {\n  \t\t\tvar option = options[i];\n\n  \t\t\tif (option.getAttribute('selected')) {\n  \t\t\t\tif (!option.getAttribute('disabled')) {\n  \t\t\t\t\tvalue = option.getAttribute('value');\n  \t\t\t\t}\n\n  \t\t\t\toptionWasSelected = true;\n  \t\t\t\tbreak;\n  \t\t\t}\n  \t\t}\n\n  \t\t// or the first non-disabled option, if none are selected\n  \t\tif (!optionWasSelected) {\n  \t\t\twhile (++i < len) {\n  \t\t\t\tif (!options[i].getAttribute('disabled')) {\n  \t\t\t\t\tvalue = options[i].getAttribute('value');\n  \t\t\t\t\tbreak;\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\t// This is an optimisation (aka hack) that allows us to forgo some\n  \t\t// other more expensive work\n  \t\t// TODO does it still work? seems at odds with new architecture\n  \t\tif (value !== undefined) {\n  \t\t\tthis.element.attributeByName.value.value = value;\n  \t\t}\n\n  \t\treturn value;\n  \t};\n\n  \tSingleSelectBinding.prototype.getValue = function getValue() {\n  \t\tvar options = this.node.options;\n  \t\tvar len = options.length;\n\n  \t\tvar i = undefined;\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tvar option = options[i];\n\n  \t\t\tif (options[i].selected && !options[i].disabled) {\n  \t\t\t\treturn option._ractive ? option._ractive.value : option.value;\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tSingleSelectBinding.prototype.render = function render() {\n  \t\t_Binding.prototype.render.call(this);\n  \t\tthis.node.addEventListener('change', handleDomEvent, false);\n  \t};\n\n  \t// TODO this method is an anomaly... is it necessary?\n\n  \tSingleSelectBinding.prototype.setValue = function setValue(value) {\n  \t\tthis.model.set(value);\n  \t};\n\n  \tSingleSelectBinding.prototype.unrender = function unrender() {\n  \t\tthis.node.removeEventListener('change', handleDomEvent, false);\n  \t};\n\n  \treturn SingleSelectBinding;\n  })(Binding);\n\n  function isBindable(attribute) {\n  \treturn attribute && attribute.template.length === 1 && attribute.template[0].t === INTERPOLATOR && !attribute.template[0].s;\n  }\n\n  function selectBinding(element) {\n  \tvar attributes = element.attributeByName;\n\n  \t// contenteditable - bind if the contenteditable attribute is true\n  \t// or is bindable and may thus become true...\n  \tif (element.getAttribute('contenteditable') || isBindable(attributes.contenteditable)) {\n  \t\t// ...and this element also has a value attribute to bind\n  \t\treturn isBindable(attributes.value) ? ContentEditableBinding : null;\n  \t}\n\n  \t// <input>\n  \tif (element.name === 'input') {\n  \t\tvar type = element.getAttribute('type');\n\n  \t\tif (type === 'radio' || type === 'checkbox') {\n  \t\t\tvar bindName = isBindable(attributes.name);\n  \t\t\tvar bindChecked = isBindable(attributes.checked);\n\n  \t\t\t// we can either bind the name attribute, or the checked attribute - not both\n  \t\t\tif (bindName && bindChecked) {\n  \t\t\t\twarnIfDebug('A radio input can have two-way binding on its name attribute, or its checked attribute - not both', { ractive: element.root });\n  \t\t\t}\n\n  \t\t\tif (bindName) {\n  \t\t\t\treturn type === 'radio' ? RadioNameBinding : CheckboxNameBinding;\n  \t\t\t}\n\n  \t\t\tif (bindChecked) {\n  \t\t\t\treturn type === 'radio' ? RadioBinding : CheckboxBinding;\n  \t\t\t}\n  \t\t}\n\n  \t\tif (type === 'file' && isBindable(attributes.value)) {\n  \t\t\treturn Binding;\n  \t\t}\n\n  \t\tif (isBindable(attributes.value)) {\n  \t\t\treturn type === 'number' || type === 'range' ? NumericBinding : GenericBinding;\n  \t\t}\n\n  \t\treturn null;\n  \t}\n\n  \t// <select>\n  \tif (element.name === 'select' && isBindable(attributes.value)) {\n  \t\treturn element.getAttribute('multiple') ? MultipleSelectBinding : SingleSelectBinding;\n  \t}\n\n  \t// <textarea>\n  \tif (element.name === 'textarea' && isBindable(attributes.value)) {\n  \t\treturn GenericBinding;\n  \t}\n  }\n\n  function makeDirty$1(query) {\n  \tquery.makeDirty();\n  }\n\n  var Element = (function (_Item) {\n  \tinherits(Element, _Item);\n\n  \tfunction Element(options) {\n  \t\tvar _this = this;\n\n  \t\tclassCallCheck(this, Element);\n\n  \t\t_Item.call(this, options);\n\n  \t\tthis.liveQueries = []; // TODO rare case. can we handle differently?\n\n  \t\tthis.name = options.template.e.toLowerCase();\n  \t\tthis.isVoid = voidElementNames.test(this.name);\n\n  \t\t// find parent element\n  \t\tvar fragment = this.parentFragment;\n  \t\twhile (fragment) {\n  \t\t\tif (fragment.owner.type === ELEMENT) {\n  \t\t\t\tthis.parent = fragment.owner;\n  \t\t\t\tbreak;\n  \t\t\t}\n  \t\t\tfragment = fragment.parent;\n  \t\t}\n\n  \t\t// create attributes\n  \t\tthis.attributeByName = {};\n  \t\tthis.attributes = [];\n\n  \t\tif (this.template.a) {\n  \t\t\tObject.keys(this.template.a).forEach(function (name) {\n  \t\t\t\t// TODO process this at parse time\n  \t\t\t\tif (name === 'twoway' || name === 'lazy') return;\n\n  \t\t\t\tvar attribute = new Attribute({\n  \t\t\t\t\tname: name,\n  \t\t\t\t\telement: _this,\n  \t\t\t\t\tparentFragment: _this.parentFragment,\n  \t\t\t\t\ttemplate: _this.template.a[name]\n  \t\t\t\t});\n\n  \t\t\t\t_this.attributeByName[name] = attribute;\n\n  \t\t\t\tif (name !== 'value' && name !== 'type') _this.attributes.push(attribute);\n  \t\t\t});\n\n  \t\t\tif (this.attributeByName.type) this.attributes.unshift(this.attributeByName.type);\n  \t\t\tif (this.attributeByName.value) this.attributes.push(this.attributeByName.value);\n  \t\t}\n\n  \t\t// create conditional attributes\n  \t\tthis.conditionalAttributes = (this.template.m || []).map(function (template) {\n  \t\t\treturn new ConditionalAttribute({\n  \t\t\t\towner: _this,\n  \t\t\t\tparentFragment: _this.parentFragment,\n  \t\t\t\ttemplate: template\n  \t\t\t});\n  \t\t});\n\n  \t\t// create decorator\n  \t\tif (this.template.o) {\n  \t\t\tthis.decorator = new Decorator(this, this.template.o);\n  \t\t}\n\n  \t\t// attach event handlers\n  \t\tthis.eventHandlers = [];\n  \t\tif (this.template.v) {\n  \t\t\tObject.keys(this.template.v).forEach(function (key) {\n  \t\t\t\tvar eventNames = key.split('-');\n  \t\t\t\tvar template = _this.template.v[key];\n\n  \t\t\t\teventNames.forEach(function (eventName) {\n  \t\t\t\t\tvar fn = findInViewHierarchy('events', _this.ractive, eventName);\n  \t\t\t\t\t// we need to pass in \"this\" in order to get\n  \t\t\t\t\t// access to node when it is created.\n  \t\t\t\t\tvar event = fn ? new CustomEvent(fn, _this) : new DOMEvent(eventName, _this);\n  \t\t\t\t\t_this.eventHandlers.push(new EventDirective(_this, event, template));\n  \t\t\t\t});\n  \t\t\t});\n  \t\t}\n\n  \t\t// create children\n  \t\tif (options.template.f && !options.noContent) {\n  \t\t\tthis.fragment = new Fragment({\n  \t\t\t\ttemplate: options.template.f,\n  \t\t\t\towner: this,\n  \t\t\t\tcssIds: null\n  \t\t\t});\n  \t\t}\n\n  \t\tthis.binding = null; // filled in later\n  \t}\n\n  \tElement.prototype.bind = function bind() {\n  \t\tthis.attributes.forEach(_bind);\n  \t\tthis.conditionalAttributes.forEach(_bind);\n  \t\tthis.eventHandlers.forEach(_bind);\n\n  \t\tif (this.decorator) this.decorator.bind();\n  \t\tif (this.fragment) this.fragment.bind();\n\n  \t\t// create two-way binding if necessary\n  \t\tif (this.binding = this.createTwowayBinding()) this.binding.bind();\n  \t};\n\n  \tElement.prototype.createTwowayBinding = function createTwowayBinding() {\n  \t\tvar attributes = this.template.a;\n\n  \t\tif (!attributes) return null;\n\n  \t\tvar shouldBind = 'twoway' in attributes ? attributes.twoway === 0 || attributes.twoway === 'true' : // covers `twoway` and `twoway='true'`\n  \t\tthis.ractive.twoway;\n\n  \t\tif (!shouldBind) return null;\n\n  \t\tvar Binding = selectBinding(this);\n\n  \t\tif (!Binding) return null;\n\n  \t\tvar binding = new Binding(this);\n\n  \t\treturn binding && binding.model ? binding : null;\n  \t};\n\n  \tElement.prototype.detach = function detach() {\n  \t\tif (this.decorator) this.decorator.unrender();\n\n  \t\treturn detachNode(this.node);\n  \t};\n\n  \tElement.prototype.find = function find(selector) {\n  \t\tif (matches(this.node, selector)) return this.node;\n  \t\tif (this.fragment) {\n  \t\t\treturn this.fragment.find(selector);\n  \t\t}\n  \t};\n\n  \tElement.prototype.findAll = function findAll(selector, query) {\n  \t\t// Add this node to the query, if applicable, and register the\n  \t\t// query on this element\n  \t\tvar matches = query.test(this.node);\n  \t\tif (matches) {\n  \t\t\tquery.add(this.node);\n  \t\t\tif (query.live) this.liveQueries.push(query);\n  \t\t}\n\n  \t\tif (this.fragment) {\n  \t\t\tthis.fragment.findAll(selector, query);\n  \t\t}\n  \t};\n\n  \tElement.prototype.findComponent = function findComponent(name) {\n  \t\tif (this.fragment) {\n  \t\t\treturn this.fragment.findComponent(name);\n  \t\t}\n  \t};\n\n  \tElement.prototype.findAllComponents = function findAllComponents(name, query) {\n  \t\tif (this.fragment) {\n  \t\t\tthis.fragment.findAllComponents(name, query);\n  \t\t}\n  \t};\n\n  \tElement.prototype.findNextNode = function findNextNode() {\n  \t\treturn null;\n  \t};\n\n  \tElement.prototype.firstNode = function firstNode() {\n  \t\treturn this.node;\n  \t};\n\n  \tElement.prototype.getAttribute = function getAttribute(name) {\n  \t\tvar attribute = this.attributeByName[name];\n  \t\treturn attribute ? attribute.getValue() : undefined;\n  \t};\n\n  \tElement.prototype.rebind = function rebind() {\n  \t\tthis.attributes.forEach(_rebind);\n  \t\tthis.conditionalAttributes.forEach(_rebind);\n  \t\tif (this.decorator) this.decorator.rebind();\n  \t\tif (this.fragment) this.fragment.rebind();\n  \t\tif (this.binding) this.binding.rebind();\n\n  \t\tthis.liveQueries.forEach(makeDirty$1);\n  \t};\n\n  \tElement.prototype.render = function render(target) {\n  \t\tvar _this2 = this;\n\n  \t\t// TODO determine correct namespace\n  \t\tthis.namespace = getNamespace(this);\n\n  \t\tvar node = createElement(this.template.e, this.namespace, this.getAttribute('is'));\n  \t\tthis.node = node;\n\n  \t\tvar context = this.parentFragment.findContext();\n\n  \t\tdefineProperty(node, '_ractive', {\n  \t\t\tvalue: {\n  \t\t\t\tproxy: this,\n  \t\t\t\tractive: this.ractive,\n  \t\t\t\tfragment: this.parentFragment,\n  \t\t\t\tcontext: context,\n  \t\t\t\tkeypath: context.getKeypath()\n  \t\t\t}\n  \t\t});\n\n  \t\t// Is this a top-level node of a component? If so, we may need to add\n  \t\t// a data-ractive-css attribute, for CSS encapsulation\n  \t\tif (this.parentFragment.cssIds) {\n  \t\t\tnode.setAttribute('data-ractive-css', this.parentFragment.cssIds.map(function (x) {\n  \t\t\t\treturn '{' + x + '}';\n  \t\t\t}).join(' '));\n  \t\t}\n\n  \t\tif (this.fragment) {\n  \t\t\tthis.fragment.render(node);\n  \t\t}\n\n  \t\tthis.attributes.forEach(_render);\n  \t\tthis.conditionalAttributes.forEach(_render);\n\n  \t\tif (this.decorator) runloop.scheduleTask(function () {\n  \t\t\treturn _this2.decorator.render();\n  \t\t}, true);\n  \t\tif (this.binding) this.binding.render();\n\n  \t\tthis.eventHandlers.forEach(_render);\n\n  \t\tupdateLiveQueries$1(this);\n\n  \t\t// transitions\n  \t\tvar transitionTemplate = this.template.t0 || this.template.t1;\n  \t\tif (transitionTemplate && this.ractive.transitionsEnabled) {\n  \t\t\tvar transition = new Transition(this, transitionTemplate, true);\n  \t\t\trunloop.registerTransition(transition);\n\n  \t\t\tthis._introTransition = transition; // so we can abort if it gets removed\n  \t\t}\n\n  \t\ttarget.appendChild(node);\n\n  \t\tthis.rendered = true;\n  \t};\n\n  \tElement.prototype.toString = function toString() {\n  \t\tvar tagName = this.template.e;\n\n  \t\tvar attrs = this.attributes.map(stringifyAttribute).join('') + this.conditionalAttributes.map(stringifyAttribute).join('');\n\n  \t\t// Special case - selected options\n  \t\tif (this.name === 'option' && this.isSelected()) {\n  \t\t\tattrs += ' selected';\n  \t\t}\n\n  \t\t// Special case - two-way radio name bindings\n  \t\tif (this.name === 'input' && inputIsCheckedRadio(this)) {\n  \t\t\tattrs += ' checked';\n  \t\t}\n\n  \t\tvar str = '<' + tagName + attrs + '>';\n\n  \t\tif (this.isVoid) return str;\n\n  \t\t// Special case - textarea\n  \t\tif (this.name === 'textarea' && this.getAttribute('value') !== undefined) {\n  \t\t\tstr += escapeHtml(this.getAttribute('value'));\n  \t\t}\n\n  \t\t// Special case - contenteditable\n  \t\telse if (this.getAttribute('contenteditable') !== undefined) {\n  \t\t\t\tstr += this.getAttribute('value') || '';\n  \t\t\t}\n\n  \t\tif (this.fragment) {\n  \t\t\tstr += this.fragment.toString(!/^(?:script|style)$/i.test(this.template.e)); // escape text unless script/style\n  \t\t}\n\n  \t\tstr += '</' + tagName + '>';\n  \t\treturn str;\n  \t};\n\n  \tElement.prototype.unbind = function unbind() {\n  \t\tthis.attributes.forEach(_unbind);\n  \t\tthis.conditionalAttributes.forEach(_unbind);\n\n  \t\tif (this.decorator) this.decorator.unbind();\n  \t\tif (this.fragment) this.fragment.unbind();\n  \t};\n\n  \tElement.prototype.unrender = function unrender(shouldDestroy) {\n  \t\tif (!this.rendered) return;\n  \t\tthis.rendered = false;\n\n  \t\t// unrendering before intro completed? complete it now\n  \t\t// TODO should be an API for aborting transitions\n  \t\tvar transition = this._introTransition;\n  \t\tif (transition) transition.complete();\n\n  \t\t// Detach as soon as we can\n  \t\tif (this.name === 'option') {\n  \t\t\t// <option> elements detach immediately, so that\n  \t\t\t// their parent <select> element syncs correctly, and\n  \t\t\t// since option elements can't have transitions anyway\n  \t\t\tthis.detach();\n  \t\t} else if (shouldDestroy) {\n  \t\t\trunloop.detachWhenReady(this);\n  \t\t}\n\n  \t\tif (this.fragment) this.fragment.unrender();\n\n  \t\tthis.eventHandlers.forEach(_unrender);\n\n  \t\tif (this.binding) this.binding.unrender();\n  \t\tif (!shouldDestroy && this.decorator) this.decorator.unrender();\n\n  \t\t// outro transition\n  \t\tvar transitionTemplate = this.template.t0 || this.template.t2;\n  \t\tif (transitionTemplate && this.ractive.transitionsEnabled) {\n  \t\t\tvar _transition = new Transition(this, transitionTemplate, false);\n  \t\t\trunloop.registerTransition(_transition);\n  \t\t}\n\n  \t\t// special case\n  \t\tvar id = this.attributeByName.id;\n  \t\tif (id) {\n  \t\t\tdelete this.ractive.nodes[id.getValue()];\n  \t\t}\n\n  \t\tremoveFromLiveQueries(this);\n  \t\t// TODO forms are a special case\n  \t};\n\n  \tElement.prototype.update = function update() {\n  \t\tif (this.dirty) {\n  \t\t\tthis.attributes.forEach(_update);\n  \t\t\tthis.conditionalAttributes.forEach(_update);\n  \t\t\tthis.eventHandlers.forEach(_update);\n\n  \t\t\tif (this.decorator) this.decorator.update();\n  \t\t\tif (this.fragment) this.fragment.update();\n\n  \t\t\tthis.dirty = false;\n  \t\t}\n  \t};\n\n  \treturn Element;\n  })(Item);\n\n  function inputIsCheckedRadio(element) {\n  \tvar attributes = element.attributeByName;\n\n  \tvar typeAttribute = attributes.type;\n  \tvar valueAttribute = attributes.value;\n  \tvar nameAttribute = attributes.name;\n\n  \tif (!typeAttribute || typeAttribute.value !== 'radio' || !valueAttribute || !nameAttribute.interpolator) {\n  \t\treturn;\n  \t}\n\n  \tif (valueAttribute.getValue() === nameAttribute.interpolator.model.get()) {\n  \t\treturn true;\n  \t}\n  }\n\n  function stringifyAttribute(attribute) {\n  \tvar str = attribute.toString();\n  \treturn str ? ' ' + str : '';\n  }\n\n  function removeFromLiveQueries(element) {\n  \tvar i = element.liveQueries.length;\n  \twhile (i--) {\n  \t\tvar query = element.liveQueries[i];\n  \t\tquery.remove(element.node);\n  \t}\n  }\n\n  function getNamespace(element) {\n  \t// Use specified namespace...\n  \tvar xmlns = element.getAttribute('xmlns');\n  \tif (xmlns) return xmlns;\n\n  \t// ...or SVG namespace, if this is an <svg> element\n  \tif (element.name === 'svg') return svg$1;\n\n  \tvar parent = element.parent;\n\n  \tif (parent) {\n  \t\t// ...or HTML, if the parent is a <foreignObject>\n  \t\tif (parent.name === 'foreignobject') return html;\n\n  \t\t// ...or inherit from the parent node\n  \t\treturn parent.node.namespaceURI;\n  \t}\n\n  \treturn element.ractive.el.namespaceURI;\n  }\n\n  var Input = (function (_Element) {\n  \tinherits(Input, _Element);\n\n  \tfunction Input() {\n  \t\tclassCallCheck(this, Input);\n\n  \t\t_Element.apply(this, arguments);\n  \t}\n\n  \tInput.prototype.render = function render(target) {\n  \t\t_Element.prototype.render.call(this, target);\n  \t\tthis.node.defaultValue = this.node.value;\n  \t};\n\n  \treturn Input;\n  })(Element);\n\n  var Textarea = (function (_Input) {\n  \tinherits(Textarea, _Input);\n\n  \tfunction Textarea(options) {\n  \t\tclassCallCheck(this, Textarea);\n\n  \t\tvar template = options.template;\n\n  \t\t// if there is a bindable value, there should be no body\n  \t\tif (template.a && template.a.value && isBindable({ template: template.a.value })) {\n  \t\t\toptions.noContent = true;\n  \t\t}\n\n  \t\t// otherwise, if there is a single bindable interpolator as content, move it to the value attr\n  \t\telse if (template.f && (!template.a || !template.a.value) && isBindable({ template: template.f })) {\n  \t\t\t\tif (!template.a) template.a = {};\n  \t\t\t\ttemplate.a.value = template.f;\n  \t\t\t\toptions.noContent = true;\n  \t\t\t}\n\n  \t\t_Input.call(this, options);\n  \t}\n\n  \tTextarea.prototype.bubble = function bubble() {\n  \t\tvar _this = this;\n\n  \t\tif (!this.dirty) {\n  \t\t\tthis.dirty = true;\n\n  \t\t\tif (this.rendered && !this.binding && this.fragment) {\n  \t\t\t\trunloop.scheduleTask(function () {\n  \t\t\t\t\t_this.dirty = false;\n  \t\t\t\t\t_this.node.value = _this.fragment.toString();\n  \t\t\t\t});\n  \t\t\t}\n\n  \t\t\tthis.parentFragment.bubble(); // default behaviour\n  \t\t}\n  \t};\n\n  \treturn Textarea;\n  })(Input);\n\n  function valueContains(selectValue, optionValue) {\n  \tvar i = selectValue.length;\n  \twhile (i--) {\n  \t\tif (selectValue[i] == optionValue) return true;\n  \t}\n  }\n\n  var Select = (function (_Element) {\n  \tinherits(Select, _Element);\n\n  \tfunction Select(options) {\n  \t\tclassCallCheck(this, Select);\n\n  \t\t_Element.call(this, options);\n  \t\tthis.options = [];\n  \t}\n\n  \tSelect.prototype.bubble = function bubble() {\n  \t\tvar _this = this;\n\n  \t\tif (!this.dirty) {\n  \t\t\tthis.dirty = true;\n\n  \t\t\tif (this.rendered) {\n  \t\t\t\trunloop.scheduleTask(function () {\n  \t\t\t\t\t_this.sync();\n  \t\t\t\t\t_this.dirty = false;\n  \t\t\t\t});\n  \t\t\t}\n\n  \t\t\tthis.parentFragment.bubble(); // default behaviour\n  \t\t}\n  \t};\n\n  \tSelect.prototype.render = function render(target) {\n  \t\t_Element.prototype.render.call(this, target);\n  \t\tthis.sync();\n\n  \t\tvar node = this.node;\n\n  \t\tvar i = node.options.length;\n  \t\twhile (i--) {\n  \t\t\tnode.options[i].defaultSelected = node.options[i].selected;\n  \t\t}\n\n  \t\tthis.rendered = true;\n  \t};\n\n  \tSelect.prototype.sync = function sync() {\n  \t\tvar selectNode = this.node;\n\n  \t\tif (!selectNode) return;\n\n  \t\tvar options = toArray(selectNode.options);\n\n  \t\tvar selectValue = this.getAttribute('value');\n  \t\tvar isMultiple = this.getAttribute('multiple');\n\n  \t\t// If the <select> has a specified value, that should override\n  \t\t// these options\n  \t\tif (selectValue !== undefined) {\n  \t\t\tvar optionWasSelected = undefined;\n\n  \t\t\toptions.forEach(function (o) {\n  \t\t\t\tvar optionValue = o._ractive ? o._ractive.value : o.value;\n  \t\t\t\tvar shouldSelect = isMultiple ? valueContains(selectValue, optionValue) : selectValue == optionValue;\n\n  \t\t\t\tif (shouldSelect) {\n  \t\t\t\t\toptionWasSelected = true;\n  \t\t\t\t}\n\n  \t\t\t\to.selected = shouldSelect;\n  \t\t\t});\n\n  \t\t\tif (!optionWasSelected && !isMultiple) {\n  \t\t\t\tif (options[0]) {\n  \t\t\t\t\toptions[0].selected = true;\n  \t\t\t\t}\n\n  \t\t\t\tif (this.binding) {\n  \t\t\t\t\tthis.binding.forceUpdate();\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\t// Otherwise the value should be initialised according to which\n  \t\t// <option> element is selected, if twoway binding is in effect\n  \t\telse if (this.binding) {\n  \t\t\t\tthis.binding.forceUpdate();\n  \t\t\t}\n  \t};\n\n  \tSelect.prototype.update = function update() {\n  \t\t_Element.prototype.update.call(this);\n  \t\tthis.sync();\n  \t};\n\n  \treturn Select;\n  })(Element);\n\n  function findParentSelect(element) {\n  \twhile (element) {\n  \t\tif (element.name === 'select') return element;\n  \t\telement = element.parent;\n  \t}\n  }\n\n  var Option = (function (_Element) {\n  \tinherits(Option, _Element);\n\n  \tfunction Option(options) {\n  \t\tclassCallCheck(this, Option);\n\n  \t\tvar template = options.template;\n  \t\tif (!template.a) template.a = {};\n\n  \t\t// If the value attribute is missing, use the element's content,\n  \t\t// as long as it isn't disabled\n  \t\tif (template.a.value === undefined && !('disabled' in template)) {\n  \t\t\ttemplate.a.value = template.f || '';\n  \t\t}\n\n  \t\t_Element.call(this, options);\n\n  \t\tthis.select = findParentSelect(this.parent);\n  \t}\n\n  \tOption.prototype.bind = function bind() {\n  \t\tif (!this.select) {\n  \t\t\t_Element.prototype.bind.call(this);\n  \t\t\treturn;\n  \t\t}\n\n  \t\t// If the select has a value, it overrides the `selected` attribute on\n  \t\t// this option - so we delete the attribute\n  \t\tvar selectedAttribute = this.attributeByName.selected;\n  \t\tif (selectedAttribute && this.select.getAttribute('value') !== undefined) {\n  \t\t\tvar index = this.attributes.indexOf(selectedAttribute);\n  \t\t\tthis.attributes.splice(index, 1);\n  \t\t\tdelete this.attributeByName.selected;\n  \t\t}\n\n  \t\t_Element.prototype.bind.call(this);\n  \t\tthis.select.options.push(this);\n  \t};\n\n  \tOption.prototype.isSelected = function isSelected() {\n  \t\tvar optionValue = this.getAttribute('value');\n\n  \t\tif (optionValue === undefined || !this.select) {\n  \t\t\treturn false;\n  \t\t}\n\n  \t\tvar selectValue = this.select.getAttribute('value');\n\n  \t\tif (selectValue == optionValue) {\n  \t\t\treturn true;\n  \t\t}\n\n  \t\tif (this.select.getAttribute('multiple') && isArray(selectValue)) {\n  \t\t\tvar i = selectValue.length;\n  \t\t\twhile (i--) {\n  \t\t\t\tif (selectValue[i] == optionValue) {\n  \t\t\t\t\treturn true;\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tOption.prototype.unbind = function unbind() {\n  \t\t_Element.prototype.unbind.call(this);\n\n  \t\tif (this.select) {\n  \t\t\tremoveFromArray(this.select.options, this);\n  \t\t}\n  \t};\n\n  \treturn Option;\n  })(Element);\n\n  var Form = (function (_Element) {\n  \tinherits(Form, _Element);\n\n  \tfunction Form(options) {\n  \t\tclassCallCheck(this, Form);\n\n  \t\t_Element.call(this, options);\n  \t\tthis.formBindings = [];\n  \t}\n\n  \tForm.prototype.render = function render(target) {\n  \t\t_Element.prototype.render.call(this, target);\n  \t\tthis.node.addEventListener('reset', handleReset, false);\n  \t};\n\n  \tForm.prototype.unrender = function unrender() {\n  \t\tthis.node.removeEventListener('reset', handleReset, false);\n  \t};\n\n  \treturn Form;\n  })(Element);\n\n  function handleReset() {\n  \tvar element = this._ractive.proxy;\n\n  \trunloop.start();\n  \telement.formBindings.forEach(updateModel);\n  \trunloop.end();\n  }\n\n  function updateModel(binding) {\n  \tbinding.model.set(binding.resetValue);\n  }\n\n  function processWrapper (wrapper, array, methodName, newIndices) {\n  \tvar __model = wrapper.__model;\n\n  \tif (newIndices) {\n  \t\t__model.shuffle(newIndices);\n  \t} else {\n  \t\t// If this is a sort or reverse, we just do root.set()...\n  \t\t// TODO use merge logic?\n  \t\t//root.viewmodel.mark( keypath );\n  \t}\n  }\n\n  var mutatorMethods = ['pop', 'push', 'reverse', 'shift', 'sort', 'splice', 'unshift'];\n  var patchedArrayProto = [];\n\n  mutatorMethods.forEach(function (methodName) {\n  \tvar method = function () {\n  \t\tfor (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n  \t\t\targs[_key] = arguments[_key];\n  \t\t}\n\n  \t\tvar newIndices = getNewIndices(this.length, methodName, args);\n\n  \t\t// apply the underlying method\n  \t\tvar result = Array.prototype[methodName].apply(this, arguments);\n\n  \t\t// trigger changes\n  \t\trunloop.start();\n\n  \t\tthis._ractive.setting = true;\n  \t\tvar i = this._ractive.wrappers.length;\n  \t\twhile (i--) {\n  \t\t\tprocessWrapper(this._ractive.wrappers[i], this, methodName, newIndices);\n  \t\t}\n\n  \t\trunloop.end();\n\n  \t\tthis._ractive.setting = false;\n  \t\treturn result;\n  \t};\n\n  \tdefineProperty(patchedArrayProto, methodName, {\n  \t\tvalue: method\n  \t});\n  });\n\n  var patchArrayMethods = undefined;\n  var unpatchArrayMethods = undefined;\n\n  // can we use prototype chain injection?\n  // http://perfectionkills.com/how-ecmascript-5-still-does-not-allow-to-subclass-an-array/#wrappers_prototype_chain_injection\n  if (({}).__proto__) {\n  \t// yes, we can\n  \tpatchArrayMethods = function (array) {\n  \t\treturn array.__proto__ = patchedArrayProto;\n  \t};\n  \tunpatchArrayMethods = function (array) {\n  \t\treturn array.__proto__ = Array.prototype;\n  \t};\n  } else {\n  \t// no, we can't\n  \tpatchArrayMethods = function (array) {\n  \t\tvar i = mutatorMethods.length;\n  \t\twhile (i--) {\n  \t\t\tvar methodName = mutatorMethods[i];\n  \t\t\tdefineProperty(array, methodName, {\n  \t\t\t\tvalue: patchedArrayProto[methodName],\n  \t\t\t\tconfigurable: true\n  \t\t\t});\n  \t\t}\n  \t};\n\n  \tunpatchArrayMethods = function (array) {\n  \t\tvar i = mutatorMethods.length;\n  \t\twhile (i--) {\n  \t\t\tdelete array[mutatorMethods[i]];\n  \t\t}\n  \t};\n  }\n\n  patchArrayMethods.unpatch = unpatchArrayMethods; // TODO export separately?\n  var patch = patchArrayMethods;\n\n  var errorMessage = 'Something went wrong in a rather interesting way';\n\n  var arrayAdaptor = {\n  \tfilter: function (object) {\n  \t\t// wrap the array if a) b) it's an array, and b) either it hasn't been wrapped already,\n  \t\t// or the array didn't trigger the get() itself\n  \t\treturn isArray(object) && (!object._ractive || !object._ractive.setting);\n  \t},\n  \twrap: function (ractive, array, keypath) {\n  \t\treturn new ArrayWrapper(ractive, array, keypath);\n  \t}\n  };\n\n  var ArrayWrapper = (function () {\n  \tfunction ArrayWrapper(ractive, array) {\n  \t\tclassCallCheck(this, ArrayWrapper);\n\n  \t\tthis.root = ractive;\n  \t\tthis.value = array;\n  \t\tthis.__model = null; // filled in later\n\n  \t\t// if this array hasn't already been ractified, ractify it\n  \t\tif (!array._ractive) {\n  \t\t\t// define a non-enumerable _ractive property to store the wrappers\n  \t\t\tdefineProperty(array, '_ractive', {\n  \t\t\t\tvalue: {\n  \t\t\t\t\twrappers: [],\n  \t\t\t\t\tinstances: [],\n  \t\t\t\t\tsetting: false\n  \t\t\t\t},\n  \t\t\t\tconfigurable: true\n  \t\t\t});\n\n  \t\t\tpatch(array);\n  \t\t}\n\n  \t\t// store the ractive instance, so we can handle transitions later\n  \t\tif (!array._ractive.instances[ractive._guid]) {\n  \t\t\tarray._ractive.instances[ractive._guid] = 0;\n  \t\t\tarray._ractive.instances.push(ractive);\n  \t\t}\n\n  \t\tarray._ractive.instances[ractive._guid] += 1;\n  \t\tarray._ractive.wrappers.push(this);\n  \t}\n\n  \tArrayWrapper.prototype.get = function get() {\n  \t\treturn this.value;\n  \t};\n\n  \tArrayWrapper.prototype.teardown = function teardown() {\n  \t\tvar array, storage, wrappers, instances, index;\n\n  \t\tarray = this.value;\n  \t\tstorage = array._ractive;\n  \t\twrappers = storage.wrappers;\n  \t\tinstances = storage.instances;\n\n  \t\t// if teardown() was invoked because we're clearing the cache as a result of\n  \t\t// a change that the array itself triggered, we can save ourselves the teardown\n  \t\t// and immediate setup\n  \t\tif (storage.setting) {\n  \t\t\treturn false; // so that we don't remove it from cached wrappers\n  \t\t}\n\n  \t\tindex = wrappers.indexOf(this);\n  \t\tif (index === -1) {\n  \t\t\tthrow new Error(errorMessage);\n  \t\t}\n\n  \t\twrappers.splice(index, 1);\n\n  \t\t// if nothing else depends on this array, we can revert it to its\n  \t\t// natural state\n  \t\tif (!wrappers.length) {\n  \t\t\tdelete array._ractive;\n  \t\t\tpatch.unpatch(this.value);\n  \t\t} else {\n  \t\t\t// remove ractive instance if possible\n  \t\t\tinstances[this.root._guid] -= 1;\n  \t\t\tif (!instances[this.root._guid]) {\n  \t\t\t\tindex = instances.indexOf(this.root);\n\n  \t\t\t\tif (index === -1) {\n  \t\t\t\t\tthrow new Error(errorMessage);\n  \t\t\t\t}\n\n  \t\t\t\tinstances.splice(index, 1);\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \treturn ArrayWrapper;\n  })();\n\n  var magicAdaptor = undefined;\n\n  try {\n  \tObject.defineProperty({}, 'test', { value: 0 });\n\n  \tmagicAdaptor = {\n  \t\tfilter: function (value) {\n  \t\t\treturn value && typeof value === 'object';\n  \t\t},\n  \t\twrap: function (ractive, value, keypath) {\n  \t\t\treturn new MagicWrapper(ractive, value, keypath);\n  \t\t}\n  \t};\n  } catch (err) {\n  \tmagicAdaptor = false;\n  }\n\n  var magicAdaptor$1 = magicAdaptor;\n\n  function createOrWrapDescriptor(originalDescriptor, ractive, keypath) {\n  \tif (originalDescriptor.set && originalDescriptor.set.__magic) {\n  \t\toriginalDescriptor.set.__magic.dependants.push({ ractive: ractive, keypath: keypath });\n  \t\treturn originalDescriptor;\n  \t}\n\n  \tvar setting = undefined;\n\n  \tvar dependants = [{ ractive: ractive, keypath: keypath }];\n\n  \tvar descriptor = {\n  \t\tget: function () {\n  \t\t\treturn 'value' in originalDescriptor ? originalDescriptor.value : originalDescriptor.get();\n  \t\t},\n  \t\tset: function (value) {\n  \t\t\tif (setting) return;\n\n  \t\t\tif ('value' in originalDescriptor) {\n  \t\t\t\toriginalDescriptor.value = value;\n  \t\t\t} else {\n  \t\t\t\toriginalDescriptor.set(value);\n  \t\t\t}\n\n  \t\t\tsetting = true;\n  \t\t\tdependants.forEach(function (_ref) {\n  \t\t\t\tvar ractive = _ref.ractive;\n  \t\t\t\tvar keypath = _ref.keypath;\n\n  \t\t\t\tractive.set(keypath, value);\n  \t\t\t});\n  \t\t\tsetting = false;\n  \t\t},\n  \t\tenumerable: true\n  \t};\n\n  \tdescriptor.set.__magic = { dependants: dependants, originalDescriptor: originalDescriptor };\n\n  \treturn descriptor;\n  }\n\n  function revert(descriptor, ractive, keypath) {\n  \tif (!descriptor.set || !descriptor.set.__magic) return true;\n\n  \tvar dependants = descriptor.set.__magic;\n  \tvar i = dependants.length;\n  \twhile (i--) {\n  \t\tvar dependant = dependants[i];\n  \t\tif (dependant.ractive === ractive && dependant.keypath === keypath) {\n  \t\t\tdependants.splice(i, 1);\n  \t\t\treturn false;\n  \t\t}\n  \t}\n  }\n\n  var MagicWrapper = (function () {\n  \tfunction MagicWrapper(ractive, value, keypath) {\n  \t\tvar _this = this;\n\n  \t\tclassCallCheck(this, MagicWrapper);\n\n  \t\tthis.ractive = ractive;\n  \t\tthis.value = value;\n  \t\tthis.keypath = keypath;\n\n  \t\tthis.originalDescriptors = {};\n\n  \t\t// wrap all properties with getters\n  \t\tObject.keys(value).forEach(function (key) {\n  \t\t\tvar originalDescriptor = Object.getOwnPropertyDescriptor(_this.value, key);\n  \t\t\t_this.originalDescriptors[key] = originalDescriptor;\n\n  \t\t\tvar childKeypath = keypath ? keypath + '.' + key : key;\n\n  \t\t\tvar descriptor = createOrWrapDescriptor(originalDescriptor, ractive, childKeypath);\n\n  \t\t\tObject.defineProperty(_this.value, key, descriptor);\n  \t\t});\n  \t}\n\n  \tMagicWrapper.prototype.get = function get() {\n  \t\treturn this.value;\n  \t};\n\n  \tMagicWrapper.prototype.reset = function reset() {\n  \t\tthrow new Error('TODO magic adaptor reset'); // does this ever happen?\n  \t};\n\n  \tMagicWrapper.prototype.set = function set(key, value) {\n  \t\tthis.value[key] = value;\n  \t};\n\n  \tMagicWrapper.prototype.teardown = function teardown() {\n  \t\tvar _this2 = this;\n\n  \t\tObject.keys(this.value).forEach(function (key) {\n  \t\t\tvar descriptor = Object.getOwnPropertyDescriptor(_this2.value, key);\n  \t\t\tif (!descriptor.set || !descriptor.set.__magic) return;\n\n  \t\t\trevert(descriptor);\n\n  \t\t\tif (descriptor.set.__magic.dependants.length === 1) {\n  \t\t\t\tObject.defineProperty(_this2.value, key, descriptor.set.__magic.originalDescriptor);\n  \t\t\t}\n  \t\t});\n  \t};\n\n  \treturn MagicWrapper;\n  })();\n\n  var MagicArrayWrapper = (function () {\n  \tfunction MagicArrayWrapper(ractive, array, keypath) {\n  \t\tclassCallCheck(this, MagicArrayWrapper);\n\n  \t\tthis.value = array;\n\n  \t\tthis.magic = true;\n\n  \t\tthis.magicWrapper = magicAdaptor$1.wrap(ractive, array, keypath);\n  \t\tthis.arrayWrapper = arrayAdaptor.wrap(ractive, array, keypath);\n\n  \t\t// ugh, this really is a terrible hack\n  \t\tObject.defineProperty(this, '__model', {\n  \t\t\tget: function () {\n  \t\t\t\treturn this.arrayWrapper.__model;\n  \t\t\t},\n  \t\t\tset: function (model) {\n  \t\t\t\tthis.arrayWrapper.__model = model;\n  \t\t\t}\n  \t\t});\n  \t}\n\n  \tMagicArrayWrapper.prototype.get = function get() {\n  \t\treturn this.value;\n  \t};\n\n  \tMagicArrayWrapper.prototype.teardown = function teardown() {\n  \t\tthis.arrayWrapper.teardown();\n  \t\tthis.magicWrapper.teardown();\n  \t};\n\n  \tMagicArrayWrapper.prototype.reset = function reset(value) {\n  \t\treturn this.magicWrapper.reset(value);\n  \t};\n\n  \treturn MagicArrayWrapper;\n  })();\n\n  var magicArrayAdaptor = {\n  \tfilter: function (object, keypath, ractive) {\n  \t\treturn magicAdaptor$1.filter(object, keypath, ractive) && arrayAdaptor.filter(object);\n  \t},\n\n  \twrap: function (ractive, array, keypath) {\n  \t\treturn new MagicArrayWrapper(ractive, array, keypath);\n  \t}\n  };\n\n  function validate(data) {\n  \t// Warn if userOptions.data is a non-POJO\n  \tif (data && data.constructor !== Object) {\n  \t\tif (typeof data === 'function') {\n  \t\t\t// TODO do we need to support this in the new Ractive() case?\n  \t\t} else if (typeof data !== 'object') {\n  \t\t\t\tfatal('data option must be an object or a function, `' + data + '` is not valid');\n  \t\t\t} else {\n  \t\t\t\twarnIfDebug('If supplied, options.data should be a plain JavaScript object - using a non-POJO as the root object may work, but is discouraged');\n  \t\t\t}\n  \t}\n  }\n\n  var dataConfigurator = {\n  \tname: 'data',\n\n  \textend: function (Parent, proto, options) {\n  \t\tvar key = undefined;\n  \t\tvar value = undefined;\n\n  \t\t// check for non-primitives, which could cause mutation-related bugs\n  \t\tif (options.data && isObject(options.data)) {\n  \t\t\tfor (key in options.data) {\n  \t\t\t\tvalue = options.data[key];\n\n  \t\t\t\tif (value && typeof value === 'object') {\n  \t\t\t\t\tif (isObject(value) || isArray(value)) {\n  \t\t\t\t\t\twarnIfDebug('Passing a `data` option with object and array properties to Ractive.extend() is discouraged, as mutating them is likely to cause bugs. Consider using a data function instead:\\n\\n  // this...\\n  data: function () {\\n    return {\\n      myObject: {}\\n    };\\n  })\\n\\n  // instead of this:\\n  data: {\\n    myObject: {}\\n  }');\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\tproto.data = combine$1(proto.data, options.data);\n  \t},\n\n  \tinit: function (Parent, ractive, options) {\n  \t\tvar result = combine$1(Parent.prototype.data, options.data);\n\n  \t\tif (typeof result === 'function') result = result.call(ractive);\n\n  \t\t// bind functions to the ractive instance at the top level,\n  \t\t// unless it's a non-POJO (in which case alarm bells should ring)\n  \t\tif (result && result.constructor === Object) {\n  \t\t\tfor (var prop in result) {\n  \t\t\t\tif (typeof result[prop] === 'function') result[prop] = bind(result[prop], ractive);\n  \t\t\t}\n  \t\t}\n\n  \t\treturn result || {};\n  \t},\n\n  \treset: function (ractive) {\n  \t\tvar result = this.init(ractive.constructor, ractive, ractive.viewmodel);\n  \t\tractive.viewmodel.root.set(result);\n  \t\treturn true;\n  \t}\n  };\n\n  function combine$1(parentValue, childValue) {\n  \tvalidate(childValue);\n\n  \tvar parentIsFn = typeof parentValue === 'function';\n  \tvar childIsFn = typeof childValue === 'function';\n\n  \t// Very important, otherwise child instance can become\n  \t// the default data object on Ractive or a component.\n  \t// then ractive.set() ends up setting on the prototype!\n  \tif (!childValue && !parentIsFn) {\n  \t\tchildValue = {};\n  \t}\n\n  \t// Fast path, where we just need to copy properties from\n  \t// parent to child\n  \tif (!parentIsFn && !childIsFn) {\n  \t\treturn fromProperties(childValue, parentValue);\n  \t}\n\n  \treturn function () {\n  \t\tvar child = childIsFn ? callDataFunction(childValue, this) : childValue;\n  \t\tvar parent = parentIsFn ? callDataFunction(parentValue, this) : parentValue;\n\n  \t\treturn fromProperties(child, parent);\n  \t};\n  }\n\n  function callDataFunction(fn, context) {\n  \tvar data = fn.call(context);\n\n  \tif (!data) return;\n\n  \tif (typeof data !== 'object') {\n  \t\tfatal('Data function must return an object');\n  \t}\n\n  \tif (data.constructor !== Object) {\n  \t\twarnOnceIfDebug('Data function returned something other than a plain JavaScript object. This might work, but is strongly discouraged');\n  \t}\n\n  \treturn data;\n  }\n\n  function fromProperties(primary, secondary) {\n  \tif (primary && secondary) {\n  \t\tfor (var key in secondary) {\n  \t\t\tif (!(key in primary)) {\n  \t\t\t\tprimary[key] = secondary[key];\n  \t\t\t}\n  \t\t}\n\n  \t\treturn primary;\n  \t}\n\n  \treturn primary || secondary;\n  }\n\n  // TODO this is probably a bit anal, maybe we should leave it out\n  function prettify(fnBody) {\n  \tvar lines = fnBody.replace(/^\\t+/gm, function (tabs) {\n  \t\treturn tabs.split('\\t').join('  ');\n  \t}).split('\\n');\n\n  \tvar minIndent = lines.length < 2 ? 0 : lines.slice(1).reduce(function (prev, line) {\n  \t\treturn Math.min(prev, /^\\s*/.exec(line)[0].length);\n  \t}, Infinity);\n\n  \treturn lines.map(function (line, i) {\n  \t\treturn '    ' + (i ? line.substring(minIndent) : line);\n  \t}).join('\\n');\n  }\n\n  // Ditto. This function truncates the stack to only include app code\n  function truncateStack(stack) {\n  \tif (!stack) return '';\n\n  \tvar lines = stack.split('\\n');\n  \tvar name = Computation.name + '.getValue';\n\n  \tvar truncated = [];\n\n  \tvar len = lines.length;\n  \tfor (var i = 1; i < len; i += 1) {\n  \t\tvar line = lines[i];\n\n  \t\tif (~line.indexOf(name)) {\n  \t\t\treturn truncated.join('\\n');\n  \t\t} else {\n  \t\t\ttruncated.push(line);\n  \t\t}\n  \t}\n  }\n\n  var Computation = (function (_Model) {\n  \tinherits(Computation, _Model);\n\n  \tfunction Computation(viewmodel, signature, key) {\n  \t\tclassCallCheck(this, Computation);\n\n  \t\t_Model.call(this, null, null);\n\n  \t\tthis.root = this.parent = viewmodel;\n  \t\tthis.signature = signature;\n  \t\tthis.key = key; // not actually used, but helps with debugging\n\n  \t\tthis.isReadonly = !this.signature.setter;\n\n  \t\tthis.context = viewmodel.computationContext;\n\n  \t\tthis.dependencies = [];\n\n  \t\tthis.children = [];\n  \t\tthis.childByKey = {};\n\n  \t\tthis.deps = [];\n\n  \t\tthis.boundsSensitive = true;\n  \t\tthis.dirty = true;\n  \t}\n\n  \tComputation.prototype.get = function get(shouldCapture) {\n  \t\tif (shouldCapture) capture(this);\n\n  \t\tif (this.dirty) {\n  \t\t\tthis.value = this.getValue();\n  \t\t\tthis.adapt();\n  \t\t\tthis.dirty = false;\n  \t\t}\n\n  \t\treturn this.value;\n  \t};\n\n  \tComputation.prototype.getValue = function getValue() {\n  \t\tstartCapturing();\n  \t\tvar result = undefined;\n\n  \t\ttry {\n  \t\t\tresult = this.signature.getter.call(this.context);\n  \t\t} catch (err) {\n  \t\t\twarnIfDebug('Failed to compute ' + this.getKeypath() + ': ' + (err.message || err));\n\n  \t\t\t// TODO this is all well and good in Chrome, but...\n  \t\t\t// ...also, should encapsulate this stuff better, and only\n  \t\t\t// show it if Ractive.DEBUG\n  \t\t\tif (console.groupCollapsed) console.groupCollapsed('%cshow details', 'color: rgb(82, 140, 224); font-weight: normal; text-decoration: underline;');\n  \t\t\tvar functionBody = prettify(this.signature.getterString);\n  \t\t\tvar stack = this.signature.getterUseStack ? '\\n\\n' + truncateStack(err.stack) : '';\n  \t\t\tconsole.error(err.name + ': ' + err.message + '\\n\\n' + functionBody + stack);\n  \t\t\tif (console.groupCollapsed) console.groupEnd();\n  \t\t}\n\n  \t\tvar dependencies = stopCapturing();\n  \t\tthis.setDependencies(dependencies);\n\n  \t\treturn result;\n  \t};\n\n  \tComputation.prototype.handleChange = function handleChange() {\n  \t\tthis.dirty = true;\n\n  \t\tthis.deps.forEach(_handleChange);\n  \t\tthis.children.forEach(_handleChange);\n  \t\tthis.clearUnresolveds(); // TODO same question as on Model - necessary for primitives?\n  \t};\n\n  \tComputation.prototype.joinKey = function joinKey(key) {\n  \t\tif (key === undefined || key === '') return this;\n\n  \t\tif (!this.childByKey.hasOwnProperty(key)) {\n  \t\t\tvar child = new ComputationChild(this, key);\n  \t\t\tthis.children.push(child);\n  \t\t\tthis.childByKey[key] = child;\n  \t\t}\n\n  \t\treturn this.childByKey[key];\n  \t};\n\n  \tComputation.prototype.mark = function mark() {\n  \t\tthis.handleChange();\n  \t};\n\n  \tComputation.prototype.set = function set(value) {\n  \t\tif (!this.signature.setter) {\n  \t\t\tthrow new Error('Cannot set read-only computed value \\'' + this.key + '\\'');\n  \t\t}\n\n  \t\tthis.signature.setter(value);\n  \t};\n\n  \tComputation.prototype.setDependencies = function setDependencies(dependencies) {\n  \t\t// unregister any soft dependencies we no longer have\n  \t\tvar i = this.dependencies.length;\n  \t\twhile (i--) {\n  \t\t\tvar model = this.dependencies[i];\n  \t\t\tif (! ~dependencies.indexOf(model)) model.unregister(this);\n  \t\t}\n\n  \t\t// and add any new ones\n  \t\ti = dependencies.length;\n  \t\twhile (i--) {\n  \t\t\tvar model = dependencies[i];\n  \t\t\tif (! ~this.dependencies.indexOf(model)) model.register(this);\n  \t\t}\n\n  \t\tthis.dependencies = dependencies;\n  \t};\n\n  \treturn Computation;\n  })(Model);\n\n  var RootModel = (function (_Model) {\n  \tinherits(RootModel, _Model);\n\n  \tfunction RootModel(options) {\n  \t\tclassCallCheck(this, RootModel);\n\n  \t\t_Model.call(this, null, null);\n\n  \t\t// TODO deprecate this\n  \t\tthis.changes = {};\n\n  \t\tthis.isRoot = true;\n  \t\tthis.root = this;\n  \t\tthis.ractive = options.ractive; // TODO sever this link\n\n  \t\tthis.value = options.data;\n  \t\tthis.adaptors = options.adapt;\n  \t\tthis.adapt();\n\n  \t\tthis.mappings = {};\n\n  \t\tthis.computationContext = options.ractive;\n  \t\tthis.computations = {};\n  \t}\n\n  \tRootModel.prototype.applyChanges = function applyChanges() {\n  \t\tthis._changeHash = {};\n  \t\tthis.flush();\n\n  \t\treturn this._changeHash;\n  \t};\n\n  \tRootModel.prototype.compute = function compute(key, signature) {\n  \t\tvar computation = new Computation(this, signature, key);\n  \t\tthis.computations[key] = computation;\n\n  \t\treturn computation;\n  \t};\n\n  \tRootModel.prototype.get = function get(shouldCapture) {\n  \t\tvar _this = this;\n\n  \t\tif (shouldCapture) capture(this);\n  \t\tvar result = extend({}, this.value);\n\n  \t\tObject.keys(this.mappings).forEach(function (key) {\n  \t\t\tresult[key] = _this.mappings[key].value;\n  \t\t});\n\n  \t\tObject.keys(this.computations).forEach(function (key) {\n  \t\t\tif (key[0] !== '@') {\n  \t\t\t\t// exclude template expressions\n  \t\t\t\tresult[key] = _this.computations[key].value;\n  \t\t\t}\n  \t\t});\n\n  \t\treturn result;\n  \t};\n\n  \tRootModel.prototype.getKeypath = function getKeypath() {\n  \t\treturn '';\n  \t};\n\n  \tRootModel.prototype.has = function has(key) {\n  \t\treturn key in this.mappings || key in this.computations || _Model.prototype.has.call(this, key);\n  \t};\n\n  \tRootModel.prototype.joinKey = function joinKey(key) {\n  \t\treturn this.mappings.hasOwnProperty(key) ? this.mappings[key] : this.computations.hasOwnProperty(key) ? this.computations[key] : _Model.prototype.joinKey.call(this, key);\n  \t};\n\n  \tRootModel.prototype.map = function map(localKey, origin) {\n  \t\t// TODO remapping\n  \t\tthis.mappings[localKey] = origin;\n  \t};\n\n  \tRootModel.prototype.set = function set(value) {\n  \t\t// TODO wrapping root node is a baaaad idea. We should prevent this\n  \t\tvar wrapper = this.wrapper;\n  \t\tif (wrapper) {\n  \t\t\tvar shouldTeardown = !wrapper.reset || wrapper.reset(value) === false;\n\n  \t\t\tif (shouldTeardown) {\n  \t\t\t\twrapper.teardown();\n  \t\t\t\tthis.wrapper = null;\n  \t\t\t\tthis.value = value;\n  \t\t\t\tthis.adapt();\n  \t\t\t}\n  \t\t} else {\n  \t\t\tthis.value = value;\n  \t\t\tthis.adapt();\n  \t\t}\n\n  \t\tthis.deps.forEach(_handleChange);\n  \t\tthis.children.forEach(_mark);\n  \t\tthis.clearUnresolveds(); // TODO do we need to do this with primitive values? if not, what about e.g. unresolved `length` property of null -> string?\n  \t};\n\n  \tRootModel.prototype.retrieve = function retrieve() {\n  \t\treturn this.value;\n  \t};\n\n  \tRootModel.prototype.update = function update() {\n  \t\t// noop\n  \t};\n\n  \tRootModel.prototype.updateFromBindings = function updateFromBindings(cascade) {\n  \t\tvar _this2 = this;\n\n  \t\t_Model.prototype.updateFromBindings.call(this, cascade);\n\n  \t\tif (cascade) {\n  \t\t\t// TODO computations as well?\n  \t\t\tObject.keys(this.mappings).forEach(function (key) {\n  \t\t\t\tvar model = _this2.mappings[key];\n  \t\t\t\tmodel.updateFromBindings(cascade);\n  \t\t\t});\n  \t\t}\n  \t};\n\n  \treturn RootModel;\n  })(Model);\n\n  var pattern = /\\$\\{([^\\}]+)\\}/g;\n\n  function createFunctionFromString(ractive, str) {\n  \tvar hasThis = undefined;\n\n  \tvar functionBody = 'return (' + str.replace(pattern, function (match, keypath) {\n  \t\thasThis = true;\n  \t\treturn '__ractive.get(\"' + keypath + '\")';\n  \t}) + ');';\n\n  \tif (hasThis) functionBody = 'var __ractive = this; ' + functionBody;\n\n  \tvar fn = new Function(functionBody);\n  \treturn hasThis ? fn.bind(ractive) : fn;\n  }\n  function getComputationSignature(ractive, key, signature) {\n  \tvar getter = undefined;\n  \tvar setter = undefined;\n\n  \t// useful for debugging\n  \tvar getterString = undefined;\n  \tvar getterUseStack = undefined;\n  \tvar setterString = undefined;\n\n  \tif (typeof signature === 'function') {\n  \t\tgetter = bind(signature, ractive);\n  \t\tgetterString = signature.toString();\n  \t\tgetterUseStack = true;\n  \t}\n\n  \tif (typeof signature === 'string') {\n  \t\tgetter = createFunctionFromString(ractive, signature);\n  \t\tgetterString = signature;\n  \t}\n\n  \tif (typeof signature === 'object') {\n  \t\tif (typeof signature.get === 'string') {\n  \t\t\tgetter = createFunctionFromString(ractive, signature.get);\n  \t\t\tgetterString = signature.get;\n  \t\t} else if (typeof signature.get === 'function') {\n  \t\t\tgetter = bind(signature.get, ractive);\n  \t\t\tgetterString = signature.get.toString();\n  \t\t\tgetterUseStack = true;\n  \t\t} else {\n  \t\t\tfatal('`%s` computation must have a `get()` method', key);\n  \t\t}\n\n  \t\tif (typeof signature.set === 'function') {\n  \t\t\tsetter = bind(signature.set, ractive);\n  \t\t\tsetterString = signature.set.toString();\n  \t\t}\n  \t}\n\n  \treturn {\n  \t\tgetter: getter,\n  \t\tsetter: setter,\n  \t\tgetterString: getterString,\n  \t\tsetterString: setterString,\n  \t\tgetterUseStack: getterUseStack\n  \t};\n  }\n\n  var constructHook = new Hook('construct');\n\n  var registryNames = ['adaptors', 'components', 'decorators', 'easing', 'events', 'interpolators', 'partials', 'transitions'];\n\n  var uid = 0;\n  function construct(ractive, options) {\n  \tif (Ractive.DEBUG) welcome();\n\n  \tinitialiseProperties(ractive);\n\n  \t// TODO remove this, eventually\n  \tdefineProperty(ractive, 'data', { get: deprecateRactiveData });\n\n  \t// TODO don't allow `onconstruct` with `new Ractive()`, there's no need for it\n  \tconstructHook.fire(ractive, options);\n\n  \t// Add registries\n  \tregistryNames.forEach(function (name) {\n  \t\tractive[name] = extend(create(ractive.constructor[name] || null), options[name]);\n  \t});\n\n  \t// Create a viewmodel\n  \tvar viewmodel = new RootModel({\n  \t\tadapt: getAdaptors(ractive, ractive.adapt, options),\n  \t\tdata: dataConfigurator.init(ractive.constructor, ractive, options),\n  \t\tractive: ractive\n  \t});\n\n  \tractive.viewmodel = viewmodel;\n\n  \t// Add computed properties\n  \tvar computed = extend(create(ractive.constructor.prototype.computed), options.computed);\n\n  \tfor (var key in computed) {\n  \t\tvar signature = getComputationSignature(ractive, key, computed[key]);\n  \t\tviewmodel.compute(key, signature);\n  \t}\n  }\n\n  function combine(a, b) {\n  \tvar c = a.slice();\n  \tvar i = b.length;\n\n  \twhile (i--) {\n  \t\tif (! ~c.indexOf(b[i])) {\n  \t\t\tc.push(b[i]);\n  \t\t}\n  \t}\n\n  \treturn c;\n  }\n\n  function getAdaptors(ractive, protoAdapt, options) {\n  \tprotoAdapt = protoAdapt.map(lookup);\n  \tvar adapt = ensureArray(options.adapt).map(lookup);\n\n  \tadapt = combine(protoAdapt, adapt);\n\n  \tvar magic = 'magic' in options ? options.magic : ractive.magic;\n  \tvar modifyArrays = 'modifyArrays' in options ? options.modifyArrays : ractive.modifyArrays;\n\n  \tif (magic) {\n  \t\tif (!magicSupported) {\n  \t\t\tthrow new Error('Getters and setters (magic mode) are not supported in this browser');\n  \t\t}\n\n  \t\tif (modifyArrays) {\n  \t\t\tadapt.push(magicArrayAdaptor);\n  \t\t}\n\n  \t\tadapt.push(magicAdaptor$1);\n  \t}\n\n  \tif (modifyArrays) {\n  \t\tadapt.push(arrayAdaptor);\n  \t}\n\n  \treturn adapt;\n\n  \tfunction lookup(adaptor) {\n  \t\tif (typeof adaptor === 'string') {\n  \t\t\tadaptor = findInViewHierarchy('adaptors', ractive, adaptor);\n\n  \t\t\tif (!adaptor) {\n  \t\t\t\tfatal(missingPlugin(adaptor, 'adaptor'));\n  \t\t\t}\n  \t\t}\n\n  \t\treturn adaptor;\n  \t}\n  }\n\n  function initialiseProperties(ractive) {\n  \t// Generate a unique identifier, for places where you'd use a weak map if it\n  \t// existed\n  \tractive._guid = 'r-' + uid++;\n\n  \t// events\n  \tractive._subs = create(null);\n\n  \t// storage for item configuration from instantiation to reset,\n  \t// like dynamic functions or original values\n  \tractive._config = {};\n\n  \t// nodes registry\n  \tractive.nodes = {};\n\n  \t// events\n  \tractive.event = null;\n  \tractive._eventQueue = [];\n\n  \t// live queries\n  \tractive._liveQueries = [];\n  \tractive._liveComponentQueries = [];\n\n  \t// observers\n  \tractive._observers = [];\n\n  \tif (!ractive.component) {\n  \t\tractive.root = ractive;\n  \t\tractive.parent = ractive.container = null; // TODO container still applicable?\n  \t}\n  }\n\n  function deprecateRactiveData() {\n  \tthrow new Error('Using `ractive.data` is no longer supported - you must use the `ractive.get()` API instead');\n  }\n\n  function getChildQueue(queue, ractive) {\n  \treturn queue[ractive._guid] || (queue[ractive._guid] = []);\n  }\n\n  function fire(hookQueue, ractive) {\n  \tvar childQueue = getChildQueue(hookQueue.queue, ractive);\n\n  \thookQueue.hook.fire(ractive);\n\n  \t// queue is \"live\" because components can end up being\n  \t// added while hooks fire on parents that modify data values.\n  \twhile (childQueue.length) {\n  \t\tfire(hookQueue, childQueue.shift());\n  \t}\n\n  \tdelete hookQueue.queue[ractive._guid];\n  }\n\n  var HookQueue = (function () {\n  \tfunction HookQueue(event) {\n  \t\tclassCallCheck(this, HookQueue);\n\n  \t\tthis.hook = new Hook(event);\n  \t\tthis.inProcess = {};\n  \t\tthis.queue = {};\n  \t}\n\n  \tHookQueue.prototype.begin = function begin(ractive) {\n  \t\tthis.inProcess[ractive._guid] = true;\n  \t};\n\n  \tHookQueue.prototype.end = function end(ractive) {\n  \t\tvar parent = ractive.parent;\n\n  \t\t// If this is *isn't* a child of a component that's in process,\n  \t\t// it should call methods or fire at this point\n  \t\tif (!parent || !this.inProcess[parent._guid]) {\n  \t\t\tfire(this, ractive);\n  \t\t}\n  \t\t// elsewise, handoff to parent to fire when ready\n  \t\telse {\n  \t\t\t\tgetChildQueue(this.queue, parent).push(ractive);\n  \t\t\t}\n\n  \t\tdelete this.inProcess[ractive._guid];\n  \t};\n\n  \treturn HookQueue;\n  })();\n\n  var css;\n  var update;\n  var styleElement;\n  var head;\n  var styleSheet;\n  var inDom;\n  var prefix$1 = '/* Ractive.js component styles */\\n';\n  var styles = [];\n  var dirty = false;\n  if (!doc) {\n  \t// TODO handle encapsulated CSS in server-rendered HTML!\n  \tcss = {\n  \t\tadd: noop,\n  \t\tapply: noop\n  \t};\n  } else {\n  \tstyleElement = doc.createElement('style');\n  \tstyleElement.type = 'text/css';\n\n  \thead = doc.getElementsByTagName('head')[0];\n\n  \tinDom = false;\n\n  \t// Internet Exploder won't let you use styleSheet.innerHTML - we have to\n  \t// use styleSheet.cssText instead\n  \tstyleSheet = styleElement.styleSheet;\n\n  \tupdate = function () {\n  \t\tvar css = prefix$1 + styles.map(function (s) {\n  \t\t\treturn '\\n/* {' + s.id + '} */\\n' + s.styles;\n  \t\t}).join('\\n');\n\n  \t\tif (styleSheet) {\n  \t\t\tstyleSheet.cssText = css;\n  \t\t} else {\n  \t\t\tstyleElement.innerHTML = css;\n  \t\t}\n\n  \t\tif (!inDom) {\n  \t\t\thead.appendChild(styleElement);\n  \t\t\tinDom = true;\n  \t\t}\n  \t};\n\n  \tcss = {\n  \t\tadd: function (s) {\n  \t\t\tstyles.push(s);\n  \t\t\tdirty = true;\n  \t\t},\n\n  \t\tapply: function () {\n  \t\t\tif (dirty) {\n  \t\t\t\tupdate();\n  \t\t\t\tdirty = false;\n  \t\t\t}\n  \t\t}\n  \t};\n  }\n\n  var css$1 = css;\n\n  var selectorsPattern = /(?:^|\\})?\\s*([^\\{\\}]+)\\s*\\{/g;\n  var commentsPattern = /\\/\\*.*?\\*\\//g;\n  var selectorUnitPattern = /((?:(?:\\[[^\\]+]\\])|(?:[^\\s\\+\\>\\~:]))+)((?::[^\\s\\+\\>\\~\\(]+(?:\\([^\\)]+\\))?)?\\s*[\\s\\+\\>\\~]?)\\s*/g;\n  var mediaQueryPattern = /^@media/;\n  var dataRvcGuidPattern = /\\[data-ractive-css~=\"\\{[a-z0-9-]+\\}\"]/g;\n\n  function trim$1(str) {\n  \treturn str.trim();\n  }\n\n  function extractString(unit) {\n  \treturn unit.str;\n  }\n\n  function transformSelector(selector, parent) {\n  \tvar selectorUnits = [];\n  \tvar match = undefined;\n\n  \twhile (match = selectorUnitPattern.exec(selector)) {\n  \t\tselectorUnits.push({\n  \t\t\tstr: match[0],\n  \t\t\tbase: match[1],\n  \t\t\tmodifiers: match[2]\n  \t\t});\n  \t}\n\n  \t// For each simple selector within the selector, we need to create a version\n  \t// that a) combines with the id, and b) is inside the id\n  \tvar base = selectorUnits.map(extractString);\n\n  \tvar transformed = [];\n  \tvar i = selectorUnits.length;\n\n  \twhile (i--) {\n  \t\tvar appended = base.slice();\n\n  \t\t// Pseudo-selectors should go after the attribute selector\n  \t\tvar unit = selectorUnits[i];\n  \t\tappended[i] = unit.base + parent + unit.modifiers || '';\n\n  \t\tvar prepended = base.slice();\n  \t\tprepended[i] = parent + ' ' + prepended[i];\n\n  \t\ttransformed.push(appended.join(' '), prepended.join(' '));\n  \t}\n\n  \treturn transformed.join(', ');\n  }\n  function transformCss(css, id) {\n  \tvar dataAttr = '[data-ractive-css~=\"{' + id + '}\"]';\n\n  \tvar transformed = undefined;\n\n  \tif (dataRvcGuidPattern.test(css)) {\n  \t\ttransformed = css.replace(dataRvcGuidPattern, dataAttr);\n  \t} else {\n  \t\ttransformed = css.replace(commentsPattern, '').replace(selectorsPattern, function (match, $1) {\n  \t\t\t// don't transform media queries!\n  \t\t\tif (mediaQueryPattern.test($1)) return match;\n\n  \t\t\tvar selectors = $1.split(',').map(trim$1);\n  \t\t\tvar transformed = selectors.map(function (selector) {\n  \t\t\t\treturn transformSelector(selector, dataAttr);\n  \t\t\t}).join(', ') + ' ';\n\n  \t\t\treturn match.replace($1, transformed);\n  \t\t});\n  \t}\n\n  \treturn transformed;\n  }\n\n  var uid$1 = 1;\n\n  var cssConfigurator = {\n  \tname: 'css',\n\n  \textend: function (Parent, proto, options) {\n  \t\tif (options.css) {\n  \t\t\tvar id = uid$1++;\n  \t\t\tvar styles = options.noCssTransform ? options.css : transformCss(options.css, id);\n\n  \t\t\tproto.cssId = id;\n  \t\t\tcss$1.add({ id: id, styles: styles });\n  \t\t}\n  \t},\n\n  \tinit: function () {}\n  };\n\n  var adaptConfigurator = {\n  \textend: function (Parent, proto, options) {\n  \t\tproto.adapt = combine$3(proto.adapt, ensureArray(options.adapt));\n  \t},\n\n  \tinit: function () {}\n  };\n\n  function combine$3(a, b) {\n  \tvar c = a.slice();\n  \tvar i = b.length;\n\n  \twhile (i--) {\n  \t\tif (! ~c.indexOf(b[i])) {\n  \t\t\tc.push(b[i]);\n  \t\t}\n  \t}\n\n  \treturn c;\n  }\n\n  var registryNames$1 = ['adaptors', 'components', 'computed', 'decorators', 'easing', 'events', 'interpolators', 'partials', 'transitions'];\n\n  var Registry = (function () {\n  \tfunction Registry(name, useDefaults) {\n  \t\tclassCallCheck(this, Registry);\n\n  \t\tthis.name = name;\n  \t\tthis.useDefaults = useDefaults;\n  \t}\n\n  \tRegistry.prototype.extend = function extend(Parent, proto, options) {\n  \t\tthis.configure(this.useDefaults ? Parent.defaults : Parent, this.useDefaults ? proto : proto.constructor, options);\n  \t};\n\n  \tRegistry.prototype.init = function init() {\n  \t\t// noop\n  \t};\n\n  \tRegistry.prototype.configure = function configure(Parent, target, options) {\n  \t\tvar name = this.name;\n  \t\tvar option = options[name];\n\n  \t\tvar registry = create(Parent[name]);\n\n  \t\tfor (var key in option) {\n  \t\t\tregistry[key] = option[key];\n  \t\t}\n\n  \t\ttarget[name] = registry;\n  \t};\n\n  \tRegistry.prototype.reset = function reset(ractive) {\n  \t\tvar registry = ractive[this.name];\n  \t\tvar changed = false;\n\n  \t\tObject.keys(registry).forEach(function (key) {\n  \t\t\tvar item = registry[key];\n\n  \t\t\tif (item._fn) {\n  \t\t\t\tif (item._fn.isOwner) {\n  \t\t\t\t\tregistry[key] = item._fn;\n  \t\t\t\t} else {\n  \t\t\t\t\tdelete registry[key];\n  \t\t\t\t}\n  \t\t\t\tchanged = true;\n  \t\t\t}\n  \t\t});\n\n  \t\treturn changed;\n  \t};\n\n  \treturn Registry;\n  })();\n\n  var registries = registryNames$1.map(function (name) {\n  \treturn new Registry(name, name === 'computed');\n  });\n\n  function wrap(parent, name, method) {\n  \tif (!/_super/.test(method)) return method;\n\n  \tfunction wrapper() {\n  \t\tvar superMethod = getSuperMethod(wrapper._parent, name);\n  \t\tvar hasSuper = ('_super' in this);\n  \t\tvar oldSuper = this._super;\n\n  \t\tthis._super = superMethod;\n\n  \t\tvar result = method.apply(this, arguments);\n\n  \t\tif (hasSuper) {\n  \t\t\tthis._super = oldSuper;\n  \t\t} else {\n  \t\t\tdelete this._super;\n  \t\t}\n\n  \t\treturn result;\n  \t}\n\n  \twrapper._parent = parent;\n  \twrapper._method = method;\n\n  \treturn wrapper;\n  }\n\n  function getSuperMethod(parent, name) {\n  \tif (name in parent) {\n  \t\tvar _ret = (function () {\n  \t\t\tvar value = parent[name];\n\n  \t\t\treturn {\n  \t\t\t\tv: typeof value === 'function' ? value : function () {\n  \t\t\t\t\treturn value;\n  \t\t\t\t}\n  \t\t\t};\n  \t\t})();\n\n  \t\tif (typeof _ret === 'object') return _ret.v;\n  \t}\n\n  \treturn noop;\n  }\n\n  function getMessage(deprecated, correct, isError) {\n  \treturn 'options.' + deprecated + ' has been deprecated in favour of options.' + correct + '.' + (isError ? ' You cannot specify both options, please use options.' + correct + '.' : '');\n  }\n\n  function deprecateOption(options, deprecatedOption, correct) {\n  \tif (deprecatedOption in options) {\n  \t\tif (!(correct in options)) {\n  \t\t\twarnIfDebug(getMessage(deprecatedOption, correct));\n  \t\t\toptions[correct] = options[deprecatedOption];\n  \t\t} else {\n  \t\t\tthrow new Error(getMessage(deprecatedOption, correct, true));\n  \t\t}\n  \t}\n  }\n  function deprecate(options) {\n  \tdeprecateOption(options, 'beforeInit', 'onconstruct');\n  \tdeprecateOption(options, 'init', 'onrender');\n  \tdeprecateOption(options, 'complete', 'oncomplete');\n  \tdeprecateOption(options, 'eventDefinitions', 'events');\n\n  \t// Using extend with Component instead of options,\n  \t// like Human.extend( Spider ) means adaptors as a registry\n  \t// gets copied to options. So we have to check if actually an array\n  \tif (isArray(options.adaptors)) {\n  \t\tdeprecateOption(options, 'adaptors', 'adapt');\n  \t}\n  }\n\n  var custom = {\n  \tadapt: adaptConfigurator,\n  \tcss: cssConfigurator,\n  \tdata: dataConfigurator,\n  \ttemplate: templateConfigurator\n  };\n\n  var defaultKeys = Object.keys(defaults);\n\n  var isStandardKey = makeObj(defaultKeys.filter(function (key) {\n  \treturn !custom[key];\n  }));\n\n  // blacklisted keys that we don't double extend\n  var isBlacklisted = makeObj(defaultKeys.concat(registries.map(function (r) {\n  \treturn r.name;\n  })));\n\n  var order = [].concat(defaultKeys.filter(function (key) {\n  \treturn !registries[key] && !custom[key];\n  }), registries,\n  //custom.data,\n  custom.template, custom.css);\n\n  var config = {\n  \textend: function (Parent, proto, options) {\n  \t\treturn configure('extend', Parent, proto, options);\n  \t},\n\n  \tinit: function (Parent, ractive, options) {\n  \t\treturn configure('init', Parent, ractive, options);\n  \t},\n\n  \treset: function (ractive) {\n  \t\treturn order.filter(function (c) {\n  \t\t\treturn c.reset && c.reset(ractive);\n  \t\t}).map(function (c) {\n  \t\t\treturn c.name;\n  \t\t});\n  \t},\n\n  \t// this defines the order. TODO this isn't used anywhere in the codebase,\n  \t// only in the test suite - should get rid of it\n  \torder: order\n  };\n\n  function configure(method, Parent, target, options) {\n  \tdeprecate(options);\n\n  \tfor (var key in options) {\n  \t\tif (isStandardKey.hasOwnProperty(key)) {\n  \t\t\tvar value = options[key];\n\n  \t\t\t// warn the developer if they passed a function and ignore its value\n\n  \t\t\t// NOTE: we allow some functions on \"el\" because we duck type element lists\n  \t\t\t// and some libraries or ef'ed-up virtual browsers (phantomJS) return a\n  \t\t\t// function object as the result of querySelector methods\n  \t\t\tif (key !== 'el' && typeof value === 'function') {\n  \t\t\t\twarnIfDebug(key + ' is a Ractive option that does not expect a function and will be ignored', method === 'init' ? target : null);\n  \t\t\t} else {\n  \t\t\t\ttarget[key] = value;\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \tregistries.forEach(function (registry) {\n  \t\tregistry[method](Parent, target, options);\n  \t});\n\n  \tadaptConfigurator[method](Parent, target, options);\n  \ttemplateConfigurator[method](Parent, target, options);\n  \tcssConfigurator[method](Parent, target, options);\n\n  \textendOtherMethods(Parent.prototype, target, options);\n  }\n\n  function extendOtherMethods(parent, target, options) {\n  \tfor (var key in options) {\n  \t\tif (!isBlacklisted[key] && options.hasOwnProperty(key)) {\n  \t\t\tvar member = options[key];\n\n  \t\t\t// if this is a method that overwrites a method, wrap it:\n  \t\t\tif (typeof member === 'function') {\n  \t\t\t\tmember = wrap(parent, key, member);\n  \t\t\t}\n\n  \t\t\ttarget[key] = member;\n  \t\t}\n  \t}\n  }\n\n  function makeObj(array) {\n  \tvar obj = {};\n  \tarray.forEach(function (x) {\n  \t\treturn obj[x] = true;\n  \t});\n  \treturn obj;\n  }\n\n  var configHook = new Hook('config');\n  var initHook = new HookQueue('init');\n  function initialise(ractive, userOptions, options) {\n  \tObject.keys(ractive.viewmodel.computations).forEach(function (key) {\n  \t\tvar computation = ractive.viewmodel.computations[key];\n\n  \t\tif (ractive.viewmodel.value.hasOwnProperty(key)) {\n  \t\t\tcomputation.set(ractive.viewmodel.value[key]);\n  \t\t}\n  \t});\n\n  \t// init config from Parent and options\n  \tconfig.init(ractive.constructor, ractive, userOptions);\n\n  \tconfigHook.fire(ractive);\n  \tinitHook.begin(ractive);\n\n  \tvar fragment = undefined;\n\n  \t// Render virtual DOM\n  \tif (ractive.template) {\n  \t\tvar cssIds = undefined;\n\n  \t\tif (options.cssIds || ractive.cssId) {\n  \t\t\tcssIds = options.cssIds ? options.cssIds.slice() : [];\n\n  \t\t\tif (ractive.cssId) {\n  \t\t\t\tcssIds.push(ractive.cssId);\n  \t\t\t}\n  \t\t}\n\n  \t\tractive.fragment = fragment = new Fragment({\n  \t\t\towner: ractive,\n  \t\t\ttemplate: ractive.template,\n  \t\t\tcssIds: cssIds,\n  \t\t\tindexRefs: options.indexRefs || {},\n  \t\t\tkeyRefs: options.keyRefs || {}\n  \t\t}).bind(ractive.viewmodel);\n  \t}\n\n  \tinitHook.end(ractive);\n\n  \tif (fragment) {\n  \t\t// render automatically ( if `el` is specified )\n  \t\tvar el = getElement(ractive.el);\n  \t\tif (el) {\n  \t\t\tvar promise = ractive.render(el, ractive.append);\n\n  \t\t\tif (Ractive.DEBUG_PROMISES) {\n  \t\t\t\tpromise['catch'](function (err) {\n  \t\t\t\t\twarnOnceIfDebug('Promise debugging is enabled, to help solve errors that happen asynchronously. Some browsers will log unhandled promise rejections, in which case you can safely disable promise debugging:\\n  Ractive.DEBUG_PROMISES = false;');\n  \t\t\t\t\twarnIfDebug('An error happened during rendering', { ractive: ractive });\n  \t\t\t\t\terr.stack && logIfDebug(err.stack);\n\n  \t\t\t\t\tthrow err;\n  \t\t\t\t});\n  \t\t\t}\n  \t\t}\n  \t}\n  }\n\n  var renderHook$1 = new Hook('render');\n  var completeHook$1 = new Hook('complete');\n  function render(ractive, target, anchor) {\n  \t// if `noIntro` is `true`, temporarily disable transitions\n  \tvar transitionsEnabled = ractive.transitionsEnabled;\n  \tif (ractive.noIntro) ractive.transitionsEnabled = false;\n\n  \tvar promise = runloop.start(ractive, true);\n  \trunloop.scheduleTask(function () {\n  \t\treturn renderHook$1.fire(ractive);\n  \t}, true);\n\n  \tif (ractive.fragment.rendered) {\n  \t\tthrow new Error('You cannot call ractive.render() on an already rendered instance! Call ractive.unrender() first');\n  \t}\n\n  \tanchor = getElement(anchor) || ractive.anchor;\n\n  \tractive.el = target;\n  \tractive.anchor = anchor;\n\n  \t// ensure encapsulated CSS is up-to-date\n  \tif (ractive.cssId) css$1.apply();\n\n  \tif (target) {\n  \t\t(target.__ractive_instances__ || (target.__ractive_instances__ = [])).push(ractive);\n\n  \t\tif (anchor) {\n  \t\t\tvar docFrag = doc.createDocumentFragment();\n  \t\t\tractive.fragment.render(docFrag);\n  \t\t\ttarget.insertBefore(docFrag, anchor);\n  \t\t} else {\n  \t\t\tractive.fragment.render(target);\n  \t\t}\n  \t}\n\n  \trunloop.end();\n  \tractive.transitionsEnabled = transitionsEnabled;\n\n  \treturn promise.then(function () {\n  \t\treturn completeHook$1.fire(ractive);\n  \t});\n  }\n\n  var RactiveEvent = (function () {\n  \tfunction RactiveEvent(ractive, name) {\n  \t\tclassCallCheck(this, RactiveEvent);\n\n  \t\tthis.ractive = ractive;\n  \t\tthis.name = name;\n  \t\tthis.handler = null;\n  \t}\n\n  \tRactiveEvent.prototype.listen = function listen(directive) {\n  \t\tvar ractive = this.ractive;\n\n  \t\tthis.handler = ractive.on(this.name, function () {\n  \t\t\tvar event = undefined;\n\n  \t\t\t// semi-weak test, but what else? tag the event obj ._isEvent ?\n  \t\t\tif (arguments.length && arguments[0] && arguments[0].node) {\n  \t\t\t\tevent = Array.prototype.shift.call(arguments);\n  \t\t\t\tevent.component = ractive;\n  \t\t\t}\n\n  \t\t\tvar args = Array.prototype.slice.call(arguments);\n  \t\t\tdirective.fire(event, args);\n\n  \t\t\t// cancel bubbling\n  \t\t\treturn false;\n  \t\t});\n  \t};\n\n  \tRactiveEvent.prototype.unlisten = function unlisten() {\n  \t\tthis.handler.cancel();\n  \t};\n\n  \treturn RactiveEvent;\n  })();\n\n  // TODO it's unfortunate that this has to run every time a\n  // component is rendered... is there a better way?\n\n  function updateLiveQueries(component) {\n  \t// Does this need to be added to any live queries?\n  \tvar instance = component.ractive;\n\n  \tdo {\n  \t\tvar liveQueries = instance._liveComponentQueries;\n\n  \t\tvar i = liveQueries.length;\n  \t\twhile (i--) {\n  \t\t\tvar _name = liveQueries[i];\n  \t\t\tvar query = liveQueries[\"_\" + _name];\n\n  \t\t\tif (query.test(component)) {\n  \t\t\t\tquery.add(component.instance);\n  \t\t\t\t// keep register of applicable selectors, for when we teardown\n  \t\t\t\tcomponent.liveQueries.push(query);\n  \t\t\t}\n  \t\t}\n  \t} while (instance = instance.parent);\n  }\n\n  function removeFromLiveComponentQueries(component) {\n  \tvar instance = component.ractive;\n\n  \twhile (instance) {\n  \t\tvar query = instance._liveComponentQueries['_' + component.name];\n  \t\tif (query) query.remove(component);\n\n  \t\tinstance = instance.parent;\n  \t}\n  }\n\n  function makeDirty(query) {\n  \tquery.makeDirty();\n  }\n\n  var teardownHook$1 = new Hook('teardown');\n\n  var Component = (function (_Item) {\n  \tinherits(Component, _Item);\n\n  \tfunction Component(options, ComponentConstructor) {\n  \t\tclassCallCheck(this, Component);\n\n  \t\t_Item.call(this, options);\n  \t\tthis.type = COMPONENT; // override ELEMENT from super\n\n  \t\tvar instance = create(ComponentConstructor.prototype);\n\n  \t\tthis.instance = instance;\n  \t\tthis.name = options.template.e;\n  \t\tthis.parentFragment = options.parentFragment;\n  \t\tthis.complexMappings = [];\n\n  \t\tthis.liveQueries = [];\n\n  \t\tif (instance.el) {\n  \t\t\twarnIfDebug('The <' + this.name + '> component has a default \\'el\\' property; it has been disregarded');\n  \t\t}\n\n  \t\tvar partials = options.template.p || {};\n  \t\tif (!('content' in partials)) partials.content = options.template.f || [];\n  \t\tthis._partials = partials; // TEMP\n\n  \t\tthis.yielders = {};\n\n  \t\t// find container\n  \t\tvar fragment = options.parentFragment;\n  \t\tvar container = undefined;\n  \t\twhile (fragment) {\n  \t\t\tif (fragment.owner.type === YIELDER) {\n  \t\t\t\tcontainer = fragment.owner.container;\n  \t\t\t\tbreak;\n  \t\t\t}\n\n  \t\t\tfragment = fragment.parent;\n  \t\t}\n\n  \t\t// add component-instance-specific properties\n  \t\tinstance.parent = this.parentFragment.ractive;\n  \t\tinstance.container = container || null;\n  \t\tinstance.root = instance.parent.root;\n  \t\tinstance.component = this;\n\n  \t\tconstruct(this.instance, { partials: partials });\n\n  \t\t// for hackability, this could be an open option\n  \t\t// for any ractive instance, but for now, just\n  \t\t// for components and just for ractive...\n  \t\tinstance._inlinePartials = partials;\n\n  \t\tthis.eventHandlers = [];\n  \t\tif (this.template.v) this.setupEvents();\n  \t}\n\n  \tComponent.prototype.bind = function bind() {\n  \t\tvar _this = this;\n\n  \t\tvar viewmodel = this.instance.viewmodel;\n  \t\tvar childData = viewmodel.value;\n\n  \t\t// determine mappings\n  \t\tif (this.template.a) {\n  \t\t\tObject.keys(this.template.a).forEach(function (localKey) {\n  \t\t\t\tvar template = _this.template.a[localKey];\n  \t\t\t\tvar model = undefined;\n  \t\t\t\tvar fragment = undefined;\n\n  \t\t\t\tif (template === 0) {\n  \t\t\t\t\t// empty attributes are `true`\n  \t\t\t\t\tviewmodel.joinKey(localKey).set(true);\n  \t\t\t\t} else if (typeof template === 'string') {\n  \t\t\t\t\tvar parsed = parseJSON(template);\n  \t\t\t\t\tviewmodel.joinKey(localKey).set(parsed ? parsed.value : template);\n  \t\t\t\t} else if (isArray(template)) {\n  \t\t\t\t\tif (template.length === 1 && template[0].t === INTERPOLATOR) {\n  \t\t\t\t\t\tmodel = resolve$1(_this.parentFragment, template[0]);\n\n  \t\t\t\t\t\tif (!model) {\n  \t\t\t\t\t\t\twarnOnceIfDebug('The ' + localKey + '=\\'{{' + template[0].r + '}}\\' mapping is ambiguous, and may cause unexpected results. Consider initialising your data to eliminate the ambiguity', { ractive: _this.instance }); // TODO add docs page explaining this\n  \t\t\t\t\t\t\t_this.parentFragment.ractive.get(localKey); // side-effect: create mappings as necessary\n  \t\t\t\t\t\t\tmodel = _this.parentFragment.findContext().joinKey(localKey);\n  \t\t\t\t\t\t}\n\n  \t\t\t\t\t\tviewmodel.map(localKey, model);\n\n  \t\t\t\t\t\tif (model.get() === undefined && localKey in childData) {\n  \t\t\t\t\t\t\tmodel.set(childData[localKey]);\n  \t\t\t\t\t\t}\n  \t\t\t\t\t} else {\n  \t\t\t\t\t\tfragment = new Fragment({\n  \t\t\t\t\t\t\towner: _this,\n  \t\t\t\t\t\t\ttemplate: template\n  \t\t\t\t\t\t}).bind();\n\n  \t\t\t\t\t\tmodel = viewmodel.joinKey(localKey);\n  \t\t\t\t\t\tmodel.set(fragment.valueOf());\n\n  \t\t\t\t\t\t// this is a *bit* of a hack\n  \t\t\t\t\t\tfragment.bubble = function () {\n  \t\t\t\t\t\t\tFragment.prototype.bubble.call(fragment);\n  \t\t\t\t\t\t\tmodel.set(fragment.valueOf());\n  \t\t\t\t\t\t};\n\n  \t\t\t\t\t\t_this.complexMappings.push(fragment);\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t\t});\n  \t\t}\n\n  \t\tinitialise(this.instance, {\n  \t\t\tpartials: this._partials\n  \t\t}, {\n  \t\t\tindexRefs: this.instance.isolated ? {} : this.parentFragment.indexRefs,\n  \t\t\tkeyRefs: this.instance.isolated ? {} : this.parentFragment.keyRefs,\n  \t\t\tcssIds: this.parentFragment.cssIds\n  \t\t});\n\n  \t\tthis.eventHandlers.forEach(_bind);\n  \t};\n\n  \tComponent.prototype.bubble = function bubble() {\n  \t\tif (!this.dirty) {\n  \t\t\tthis.dirty = true;\n  \t\t\tthis.parentFragment.bubble();\n  \t\t}\n  \t};\n\n  \tComponent.prototype.checkYielders = function checkYielders() {\n  \t\tvar _this2 = this;\n\n  \t\tObject.keys(this.yielders).forEach(function (name) {\n  \t\t\tif (_this2.yielders[name].length > 1) {\n  \t\t\t\trunloop.end();\n  \t\t\t\tthrow new Error('A component template can only have one {{yield' + (name ? ' ' + name : '') + '}} declaration at a time');\n  \t\t\t}\n  \t\t});\n  \t};\n\n  \tComponent.prototype.detach = function detach() {\n  \t\treturn this.instance.fragment.detach();\n  \t};\n\n  \tComponent.prototype.find = function find(selector) {\n  \t\treturn this.instance.fragment.find(selector);\n  \t};\n\n  \tComponent.prototype.findAll = function findAll(selector, query) {\n  \t\tthis.instance.fragment.findAll(selector, query);\n  \t};\n\n  \tComponent.prototype.findComponent = function findComponent(name) {\n  \t\tif (!name || this.name === name) return this.instance;\n\n  \t\tif (this.instance.fragment) {\n  \t\t\treturn this.instance.fragment.findComponent(name);\n  \t\t}\n  \t};\n\n  \tComponent.prototype.findAllComponents = function findAllComponents(name, query) {\n  \t\tif (query.test(this)) {\n  \t\t\tquery.add(this.instance);\n\n  \t\t\tif (query.live) {\n  \t\t\t\tthis.liveQueries.push(query);\n  \t\t\t}\n  \t\t}\n\n  \t\tthis.instance.fragment.findAllComponents(name, query);\n  \t};\n\n  \tComponent.prototype.firstNode = function firstNode() {\n  \t\treturn this.instance.fragment.firstNode();\n  \t};\n\n  \tComponent.prototype.rebind = function rebind() {\n  \t\tvar _this3 = this;\n\n  \t\tthis.complexMappings.forEach(_rebind);\n\n  \t\tthis.liveQueries.forEach(makeDirty);\n\n  \t\t// update relevant mappings\n  \t\tvar viewmodel = this.instance.viewmodel;\n  \t\tviewmodel.mappings = {};\n\n  \t\tif (this.template.a) {\n  \t\t\tObject.keys(this.template.a).forEach(function (localKey) {\n  \t\t\t\tvar template = _this3.template.a[localKey];\n  \t\t\t\tvar model = undefined;\n\n  \t\t\t\tif (isArray(template) && template.length === 1 && template[0].t === INTERPOLATOR) {\n  \t\t\t\t\tmodel = resolve$1(_this3.parentFragment, template[0]);\n\n  \t\t\t\t\tif (!model) {\n  \t\t\t\t\t\t// TODO is this even possible?\n  \t\t\t\t\t\twarnOnceIfDebug('The ' + localKey + '=\\'{{' + template[0].r + '}}\\' mapping is ambiguous, and may cause unexpected results. Consider initialising your data to eliminate the ambiguity', { ractive: _this3.instance });\n  \t\t\t\t\t\t_this3.parentFragment.ractive.get(localKey); // side-effect: create mappings as necessary\n  \t\t\t\t\t\tmodel = _this3.parentFragment.findContext().joinKey(localKey);\n  \t\t\t\t\t}\n\n  \t\t\t\t\tviewmodel.map(localKey, model);\n  \t\t\t\t}\n  \t\t\t});\n  \t\t}\n\n  \t\tthis.instance.fragment.rebind(viewmodel);\n  \t};\n\n  \tComponent.prototype.render = function render$$(target) {\n  \t\trender(this.instance, target, null);\n\n  \t\tthis.checkYielders();\n  \t\tthis.eventHandlers.forEach(_render);\n  \t\tupdateLiveQueries(this);\n\n  \t\tthis.rendered = true;\n  \t};\n\n  \tComponent.prototype.setupEvents = function setupEvents() {\n  \t\tvar _this4 = this;\n\n  \t\tvar handlers = this.eventHandlers;\n\n  \t\tObject.keys(this.template.v).forEach(function (key) {\n  \t\t\tvar eventNames = key.split('-');\n  \t\t\tvar template = _this4.template.v[key];\n\n  \t\t\teventNames.forEach(function (eventName) {\n  \t\t\t\tvar event = new RactiveEvent(_this4.instance, eventName);\n  \t\t\t\thandlers.push(new EventDirective(_this4, event, template));\n  \t\t\t});\n  \t\t});\n  \t};\n\n  \tComponent.prototype.toString = function toString() {\n  \t\treturn this.instance.toHTML();\n  \t};\n\n  \tComponent.prototype.unbind = function unbind() {\n  \t\tthis.complexMappings.forEach(_unbind);\n\n  \t\tvar instance = this.instance;\n  \t\tinstance.viewmodel.teardown();\n  \t\tinstance.fragment.unbind();\n  \t\tinstance._observers.forEach(cancel);\n\n  \t\tremoveFromLiveComponentQueries(this);\n\n  \t\tif (instance.fragment.rendered && instance.el.__ractive_instances__) {\n  \t\t\tremoveFromArray(instance.el.__ractive_instances__, instance);\n  \t\t}\n\n  \t\tteardownHook$1.fire(instance);\n  \t};\n\n  \tComponent.prototype.unrender = function unrender(shouldDestroy) {\n  \t\tvar _this5 = this;\n\n  \t\tthis.shouldDestroy = shouldDestroy;\n  \t\tthis.instance.unrender();\n  \t\tthis.eventHandlers.forEach(_unrender);\n  \t\tthis.liveQueries.forEach(function (query) {\n  \t\t\treturn query.remove(_this5.instance);\n  \t\t});\n  \t};\n\n  \tComponent.prototype.update = function update() {\n  \t\tthis.instance.fragment.update();\n  \t\tthis.checkYielders();\n  \t\tthis.eventHandlers.forEach(_update);\n  \t\tthis.dirty = false;\n  \t};\n\n  \treturn Component;\n  })(Item);\n\n  var Text = (function (_Item) {\n  \tinherits(Text, _Item);\n\n  \tfunction Text(options) {\n  \t\tclassCallCheck(this, Text);\n\n  \t\t_Item.call(this, options);\n  \t\tthis.type = TEXT;\n  \t}\n\n  \tText.prototype.bind = function bind() {\n  \t\t// noop\n  \t};\n\n  \tText.prototype.detach = function detach() {\n  \t\treturn detachNode(this.node);\n  \t};\n\n  \tText.prototype.firstNode = function firstNode() {\n  \t\treturn this.node;\n  \t};\n\n  \tText.prototype.rebind = function rebind() {\n  \t\t// noop\n  \t};\n\n  \tText.prototype.render = function render(target) {\n  \t\tthis.node = doc.createTextNode(this.template);\n  \t\ttarget.appendChild(this.node);\n  \t\tthis.rendered = true;\n  \t};\n\n  \tText.prototype.toString = function toString(escape) {\n  \t\treturn escape ? escapeHtml(this.template) : this.template;\n  \t};\n\n  \tText.prototype.unbind = function unbind() {\n  \t\t// noop\n  \t};\n\n  \tText.prototype.unrender = function unrender(shouldDestroy) {\n  \t\tif (this.rendered && shouldDestroy) this.detach();\n  \t\tthis.rendered = false;\n  \t};\n\n  \tText.prototype.update = function update() {\n  \t\t// noop\n  \t};\n\n  \tText.prototype.valueOf = function valueOf() {\n  \t\treturn this.template;\n  \t};\n\n  \treturn Text;\n  })(Item);\n\n  // finds the component constructor in the registry or view hierarchy registries\n\n  function getComponentConstructor(ractive, name) {\n  \tvar instance = findInstance('components', ractive, name);\n  \tvar Component = undefined;\n\n  \tif (instance) {\n  \t\tComponent = instance.components[name];\n\n  \t\t// best test we have for not Ractive.extend\n  \t\tif (!Component._Parent) {\n  \t\t\t// function option, execute and store for reset\n  \t\t\tvar fn = Component.bind(instance);\n  \t\t\tfn.isOwner = instance.components.hasOwnProperty(name);\n  \t\t\tComponent = fn();\n\n  \t\t\tif (!Component) {\n  \t\t\t\twarnIfDebug(noRegistryFunctionReturn, name, 'component', 'component', { ractive: ractive });\n  \t\t\t\treturn;\n  \t\t\t}\n\n  \t\t\tif (typeof Component === 'string') {\n  \t\t\t\t// allow string lookup\n  \t\t\t\tComponent = getComponentConstructor(ractive, Component);\n  \t\t\t}\n\n  \t\t\tComponent._fn = fn;\n  \t\t\tinstance.components[name] = Component;\n  \t\t}\n  \t}\n\n  \treturn Component;\n  }\n\n  var constructors = {};\n  constructors[DOCTYPE] = Doctype;\n  constructors[INTERPOLATOR] = Interpolator;\n  constructors[PARTIAL] = Partial;\n  constructors[SECTION] = Section;\n  constructors[TRIPLE] = Triple;\n  constructors[YIELDER] = Yielder;\n\n  var specialElements = {\n  \tdoctype: Doctype,\n  \tform: Form,\n  \tinput: Input,\n  \toption: Option,\n  \tselect: Select,\n  \ttextarea: Textarea\n  };\n  function createItem(options) {\n  \tif (typeof options.template === 'string') {\n  \t\treturn new Text(options);\n  \t}\n\n  \tif (options.template.t === ELEMENT) {\n  \t\t// could be component or element\n  \t\tvar ComponentConstructor = getComponentConstructor(options.parentFragment.ractive, options.template.e);\n  \t\tif (ComponentConstructor) {\n  \t\t\treturn new Component(options, ComponentConstructor);\n  \t\t}\n\n  \t\tvar tagName = options.template.e.toLowerCase();\n\n  \t\tvar ElementConstructor = specialElements[tagName] || Element;\n  \t\treturn new ElementConstructor(options);\n  \t}\n\n  \tvar Item = constructors[options.template.t];\n\n  \tif (!Item) throw new Error('Unrecognised item type ' + options.template.t);\n\n  \treturn new Item(options);\n  }\n\n  var ReferenceResolver = (function () {\n  \tfunction ReferenceResolver(fragment, reference, callback) {\n  \t\tclassCallCheck(this, ReferenceResolver);\n\n  \t\tthis.fragment = fragment;\n  \t\tthis.reference = normalise(reference);\n  \t\tthis.callback = callback;\n\n  \t\tthis.keys = splitKeypath(reference);\n  \t\tthis.resolved = false;\n\n  \t\t// TODO the consumer should take care of addUnresolved\n  \t\t// we attach to all the contexts between here and the root\n  \t\t// - whenever their values change, they can quickly\n  \t\t// check to see if we can resolve\n  \t\twhile (fragment) {\n  \t\t\tif (fragment.context) {\n  \t\t\t\tfragment.context.addUnresolved(this.keys[0], this);\n  \t\t\t}\n\n  \t\t\tfragment = fragment.componentParent || fragment.parent;\n  \t\t}\n  \t}\n\n  \tReferenceResolver.prototype.attemptResolution = function attemptResolution() {\n  \t\tif (this.resolved) return;\n\n  \t\tvar model = resolveAmbiguousReference(this.fragment, this.reference);\n\n  \t\tif (model) {\n  \t\t\tthis.resolved = true;\n  \t\t\tthis.callback(model);\n  \t\t}\n  \t};\n\n  \tReferenceResolver.prototype.forceResolution = function forceResolution() {\n  \t\tif (this.resolved) return;\n\n  \t\tvar model = this.fragment.findContext().joinAll(this.keys);\n  \t\tthis.callback(model);\n  \t\tthis.resolved = true;\n  \t};\n\n  \tReferenceResolver.prototype.unbind = function unbind() {\n  \t\tremoveFromArray(this.fragment.unresolved, this);\n  \t};\n\n  \treturn ReferenceResolver;\n  })();\n\n  // TODO all this code needs to die\n\n  function processItems(items, values, guid) {\n  \tvar counter = arguments.length <= 3 || arguments[3] === undefined ? 0 : arguments[3];\n\n  \treturn items.map(function (item) {\n  \t\tif (item.type === TEXT) {\n  \t\t\treturn item.template;\n  \t\t}\n\n  \t\tif (item.fragment) {\n  \t\t\tif (item.fragment.iterations) {\n  \t\t\t\treturn item.fragment.iterations.map(function (fragment) {\n  \t\t\t\t\treturn processItems(fragment.items, values, guid, counter);\n  \t\t\t\t}).join('');\n  \t\t\t} else {\n  \t\t\t\treturn processItems(item.fragment.items, values, guid, counter);\n  \t\t\t}\n  \t\t}\n\n  \t\tvar placeholderId = guid + '-' + counter++;\n\n  \t\tvalues[placeholderId] = item.model ? item.model.wrapper ? item.model.wrapper.value : item.model.get() : undefined;\n\n  \t\treturn '${' + placeholderId + '}';\n  \t}).join('');\n  }\n\n  function unrenderAndDestroy(item) {\n  \titem.unrender(true);\n  }\n\n  var Fragment = (function () {\n  \tfunction Fragment(options) {\n  \t\tclassCallCheck(this, Fragment);\n\n  \t\tthis.owner = options.owner; // The item that owns this fragment - an element, section, partial, or attribute\n\n  \t\tthis.isRoot = !options.owner.parentFragment;\n  \t\tthis.parent = this.isRoot ? null : this.owner.parentFragment;\n  \t\tthis.ractive = options.ractive || (this.isRoot ? options.owner : this.parent.ractive);\n\n  \t\tthis.componentParent = this.isRoot && this.ractive.component ? this.ractive.component.parentFragment : null;\n\n  \t\tthis.context = null;\n  \t\tthis.rendered = false;\n  \t\tthis.indexRefs = options.indexRefs || (this.parent ? this.parent.indexRefs : []);\n  \t\tthis.keyRefs = options.keyRefs || (this.parent ? this.parent.keyRefs : {});\n\n  \t\t// encapsulated styles should be inherited until they get applied by an element\n  \t\tthis.cssIds = 'cssIds' in options ? options.cssIds : this.parent ? this.parent.cssIds : null;\n\n  \t\tthis.resolvers = [];\n\n  \t\tthis.dirty = false;\n  \t\tthis.dirtyArgs = this.dirtyValue = true; // TODO getArgsList is nonsense - should deprecate legacy directives style\n\n  \t\tthis.template = options.template || [];\n  \t\tthis.createItems();\n  \t}\n\n  \tFragment.prototype.bind = function bind(context) {\n  \t\tthis.context = context;\n  \t\tthis.items.forEach(_bind);\n  \t\tthis.bound = true;\n\n  \t\t// in rare cases, a forced resolution (or similar) will cause the\n  \t\t// fragment to be dirty before it's even finished binding. In those\n  \t\t// cases we update immediately\n  \t\tif (this.dirty) this.update();\n\n  \t\treturn this;\n  \t};\n\n  \tFragment.prototype.bubble = function bubble() {\n  \t\tthis.dirtyArgs = this.dirtyValue = true;\n\n  \t\tif (!this.dirty) {\n  \t\t\tthis.dirty = true;\n\n  \t\t\tif (this.isRoot) {\n  \t\t\t\t// TODO encapsulate 'is component root, but not overall root' check?\n  \t\t\t\tif (this.ractive.component) {\n  \t\t\t\t\tthis.ractive.component.bubble();\n  \t\t\t\t} else if (this.bound) {\n  \t\t\t\t\trunloop.addFragment(this);\n  \t\t\t\t}\n  \t\t\t} else {\n  \t\t\t\tthis.owner.bubble();\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tFragment.prototype.createItems = function createItems() {\n  \t\tvar _this = this;\n\n  \t\tthis.items = this.template.map(function (template, index) {\n  \t\t\treturn createItem({ parentFragment: _this, template: template, index: index });\n  \t\t});\n  \t};\n\n  \tFragment.prototype.detach = function detach() {\n  \t\tvar docFrag = createDocumentFragment();\n  \t\tthis.items.forEach(function (item) {\n  \t\t\treturn docFrag.appendChild(item.detach());\n  \t\t});\n  \t\treturn docFrag;\n  \t};\n\n  \tFragment.prototype.find = function find(selector) {\n  \t\tvar len = this.items.length;\n  \t\tvar i = undefined;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tvar found = this.items[i].find(selector);\n  \t\t\tif (found) return found;\n  \t\t}\n  \t};\n\n  \tFragment.prototype.findAll = function findAll(selector, query) {\n  \t\tif (this.items) {\n  \t\t\tvar len = this.items.length;\n  \t\t\tvar i = undefined;\n\n  \t\t\tfor (i = 0; i < len; i += 1) {\n  \t\t\t\tvar item = this.items[i];\n\n  \t\t\t\tif (item.findAll) {\n  \t\t\t\t\titem.findAll(selector, query);\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\treturn query;\n  \t};\n\n  \tFragment.prototype.findComponent = function findComponent(name) {\n  \t\tvar len = this.items.length;\n  \t\tvar i = undefined;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tvar found = this.items[i].findComponent(name);\n  \t\t\tif (found) return found;\n  \t\t}\n  \t};\n\n  \tFragment.prototype.findAllComponents = function findAllComponents(name, query) {\n  \t\tif (this.items) {\n  \t\t\tvar len = this.items.length;\n  \t\t\tvar i = undefined;\n\n  \t\t\tfor (i = 0; i < len; i += 1) {\n  \t\t\t\tvar item = this.items[i];\n\n  \t\t\t\tif (item.findAllComponents) {\n  \t\t\t\t\titem.findAllComponents(name, query);\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\treturn query;\n  \t};\n\n  \tFragment.prototype.findContext = function findContext() {\n  \t\tvar fragment = this;\n  \t\twhile (!fragment.context) fragment = fragment.parent;\n  \t\treturn fragment.context;\n  \t};\n\n  \tFragment.prototype.findNextNode = function findNextNode(item) {\n  \t\tvar nextItem = this.items[item.index + 1];\n\n  \t\tif (nextItem) return nextItem.firstNode();\n\n  \t\t// if this is the root fragment, and there are no more items,\n  \t\t// it means we're at the end...\n  \t\tif (this.isRoot) {\n  \t\t\tif (this.ractive.component) {\n  \t\t\t\treturn this.ractive.component.parentFragment.findNextNode(this.ractive.component);\n  \t\t\t}\n\n  \t\t\t// TODO possible edge case with other content\n  \t\t\t// appended to this.ractive.el?\n  \t\t\treturn null;\n  \t\t}\n\n  \t\treturn this.owner.findNextNode(this); // the argument is in case the parent is a RepeatedFragment\n  \t};\n\n  \tFragment.prototype.findParentNode = function findParentNode() {\n  \t\tvar fragment = this;\n\n  \t\tdo {\n  \t\t\tif (fragment.owner.type === ELEMENT) {\n  \t\t\t\treturn fragment.owner.node;\n  \t\t\t}\n\n  \t\t\tif (fragment.isRoot && !fragment.ractive.component) {\n  \t\t\t\t// TODO encapsulate check\n  \t\t\t\treturn fragment.ractive.el;\n  \t\t\t}\n\n  \t\t\tfragment = fragment.componentParent || fragment.parent; // TODO ugh\n  \t\t} while (fragment);\n\n  \t\tthrow new Error('Could not find parent node'); // TODO link to issue tracker\n  \t};\n\n  \tFragment.prototype.findRepeatingFragment = function findRepeatingFragment() {\n  \t\tvar fragment = this;\n  \t\t// TODO better check than fragment.parent.iterations\n  \t\twhile (fragment.parent && !fragment.isIteration) {\n  \t\t\tfragment = fragment.parent || fragment.componentParent;\n  \t\t}\n\n  \t\treturn fragment;\n  \t};\n\n  \tFragment.prototype.firstNode = function firstNode() {\n  \t\treturn this.items[0] ? this.items[0].firstNode() : this.parent.findNextNode(this.owner);\n  \t};\n\n  \t// TODO ideally, this would be deprecated in favour of an\n  \t// expression-like approach\n\n  \tFragment.prototype.getArgsList = function getArgsList() {\n  \t\tif (this.dirtyArgs) {\n  \t\t\tvar values = {};\n  \t\t\tvar source = processItems(this.items, values, this.ractive._guid);\n  \t\t\tvar parsed = parseJSON('[' + source + ']', values);\n\n  \t\t\tthis.argsList = parsed ? parsed.value : [this.toString()];\n\n  \t\t\tthis.dirtyArgs = false;\n  \t\t}\n\n  \t\treturn this.argsList;\n  \t};\n\n  \tFragment.prototype.rebind = function rebind(context) {\n  \t\tthis.context = context;\n\n  \t\tthis.items.forEach(_rebind);\n  \t};\n\n  \tFragment.prototype.render = function render(target) {\n  \t\tif (this.rendered) throw new Error('Fragment is already rendered!');\n  \t\tthis.rendered = true;\n\n  \t\tthis.items.forEach(function (item) {\n  \t\t\treturn item.render(target);\n  \t\t});\n  \t};\n\n  \tFragment.prototype.resetTemplate = function resetTemplate(template) {\n  \t\tvar wasBound = this.bound;\n  \t\tvar wasRendered = this.rendered;\n\n  \t\t// TODO ensure transitions are disabled globally during reset\n\n  \t\tif (wasBound) {\n  \t\t\tif (wasRendered) this.unrender(true);\n  \t\t\tthis.unbind();\n  \t\t}\n\n  \t\tthis.template = template;\n  \t\tthis.createItems();\n\n  \t\tif (wasBound) {\n  \t\t\tthis.bind(this.context);\n\n  \t\t\tif (wasRendered) {\n  \t\t\t\tvar parentNode = this.findParentNode();\n  \t\t\t\tvar anchor = this.parent ? this.parent.findNextNode(this.owner) : null;\n\n  \t\t\t\tif (anchor) {\n  \t\t\t\t\tvar docFrag = createDocumentFragment();\n  \t\t\t\t\tthis.render(docFrag);\n  \t\t\t\t\tparentNode.insertBefore(docFrag, anchor);\n  \t\t\t\t} else {\n  \t\t\t\t\tthis.render(parentNode);\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tFragment.prototype.resolve = function resolve(template, callback) {\n  \t\tif (!this.context) {\n  \t\t\treturn this.parent.resolve(template, callback);\n  \t\t}\n\n  \t\tvar resolver = new ReferenceResolver(this, template, callback);\n  \t\tthis.resolvers.push(resolver);\n\n  \t\treturn resolver; // so we can e.g. force resolution\n  \t};\n\n  \tFragment.prototype.toHtml = function toHtml() {\n  \t\treturn this.toString();\n  \t};\n\n  \tFragment.prototype.toString = function toString(escape) {\n  \t\treturn this.items.map(escape ? toEscapedString : _toString).join('');\n  \t};\n\n  \tFragment.prototype.unbind = function unbind() {\n  \t\tthis.items.forEach(_unbind);\n  \t\tthis.bound = false;\n\n  \t\treturn this;\n  \t};\n\n  \tFragment.prototype.unrender = function unrender(shouldDestroy) {\n  \t\tthis.items.forEach(shouldDestroy ? unrenderAndDestroy : _unrender);\n  \t\tthis.rendered = false;\n  \t};\n\n  \tFragment.prototype.update = function update() {\n  \t\tif (this.dirty) {\n  \t\t\tthis.items.forEach(_update);\n  \t\t\tthis.dirty = false;\n  \t\t}\n  \t};\n\n  \tFragment.prototype.valueOf = function valueOf() {\n  \t\tif (this.items.length === 1) {\n  \t\t\treturn this.items[0].valueOf();\n  \t\t}\n\n  \t\tif (this.dirtyValue) {\n  \t\t\tvar values = {};\n  \t\t\tvar source = processItems(this.items, values, this.ractive._guid);\n  \t\t\tvar parsed = parseJSON(source, values);\n\n  \t\t\tthis.value = parsed ? parsed.value : this.toString();\n\n  \t\t\tthis.dirtyValue = false;\n  \t\t}\n\n  \t\treturn this.value;\n  \t};\n\n  \treturn Fragment;\n  })();\n\n  // TODO should resetTemplate be asynchronous? i.e. should it be a case\n  // of outro, update template, intro? I reckon probably not, since that\n  // could be achieved with unrender-resetTemplate-render. Also, it should\n  // conceptually be similar to resetPartial, which couldn't be async\n\n  function Ractive$resetTemplate(template) {\n  \ttemplateConfigurator.init(null, this, { template: template });\n\n  \tvar transitionsEnabled = this.transitionsEnabled;\n  \tthis.transitionsEnabled = false;\n\n  \t// Is this is a component, we need to set the `shouldDestroy`\n  \t// flag, otherwise it will assume by default that a parent node\n  \t// will be detached, and therefore it doesn't need to bother\n  \t// detaching its own nodes\n  \tvar component = this.component;\n  \tif (component) component.shouldDestroy = true;\n  \tthis.unrender();\n  \tif (component) component.shouldDestroy = false;\n\n  \t// remove existing fragment and create new one\n  \tthis.fragment.unbind();\n  \tthis.fragment = new Fragment({\n  \t\ttemplate: this.template,\n  \t\troot: this,\n  \t\towner: this\n  \t});\n  \tthis.fragment.bind(this.viewmodel);\n\n  \tthis.render(this.el, this.anchor);\n\n  \tthis.transitionsEnabled = transitionsEnabled;\n  }\n\n  function collect(source, name, dest) {\n  \tsource.forEach(function (item) {\n  \t\t// queue to rerender if the item is a partial and the current name matches\n  \t\tif (item.type === PARTIAL && (item.refName === name || item.name === name)) {\n  \t\t\tdest.push(item);\n  \t\t\treturn; // go no further\n  \t\t}\n\n  \t\t// if it has a fragment, process its items\n  \t\tif (item.fragment) {\n  \t\t\tcollect(item.fragment.iterations || item.fragment.items, name, dest);\n  \t\t}\n\n  \t\t// or if it is itself a fragment, process its items\n  \t\telse if (isArray(item.items)) {\n  \t\t\t\tcollect(item.items, name, dest);\n  \t\t\t}\n\n  \t\t\t// or if it is a component, step in and process its items\n  \t\t\telse if (item.type === COMPONENT && item.instance) {\n  \t\t\t\t\t// ...unless the partial is shadowed\n  \t\t\t\t\tif (item.instance.partials[name]) return;\n  \t\t\t\t\tcollect(item.instance.fragment.items, name, dest);\n  \t\t\t\t}\n\n  \t\t// if the item is an element, process its attributes too\n  \t\tif (item.type === ELEMENT) {\n  \t\t\tif (isArray(item.attributes)) {\n  \t\t\t\tcollect(item.attributes, name, dest);\n  \t\t\t}\n\n  \t\t\tif (isArray(item.conditionalAttributes)) {\n  \t\t\t\tcollect(item.conditionalAttributes, name, dest);\n  \t\t\t}\n  \t\t}\n  \t});\n  }\n\n  function forceResetTemplate(partial) {\n  \tpartial.forceResetTemplate();\n  }\n\n  function resetPartial (name, partial) {\n  \tvar collection = [];\n  \tcollect(this.fragment.items, name, collection);\n\n  \tvar promise = runloop.start(this, true);\n\n  \tthis.partials[name] = partial;\n  \tcollection.forEach(forceResetTemplate);\n\n  \trunloop.end();\n\n  \treturn promise;\n  }\n\n  var shouldRerender = ['template', 'partials', 'components', 'decorators', 'events'];\n\n  var completeHook = new Hook('complete');\n  var resetHook = new Hook('reset');\n  var renderHook = new Hook('render');\n  var unrenderHook = new Hook('unrender');\n  function Ractive$reset(data) {\n  \tdata = data || {};\n\n  \tif (typeof data !== 'object') {\n  \t\tthrow new Error('The reset method takes either no arguments, or an object containing new data');\n  \t}\n\n  \t// TEMP need to tidy this up\n  \tdata = dataConfigurator.init(this.constructor, this, { data: data });\n\n  \tvar promise = runloop.start(this, true);\n\n  \t// If the root object is wrapped, try and use the wrapper's reset value\n  \tvar wrapper = this.viewmodel.wrapper;\n  \tif (wrapper && wrapper.reset) {\n  \t\tif (wrapper.reset(data) === false) {\n  \t\t\t// reset was rejected, we need to replace the object\n  \t\t\tthis.viewmodel.set(data);\n  \t\t}\n  \t} else {\n  \t\tthis.viewmodel.set(data);\n  \t}\n\n  \t// reset config items and track if need to rerender\n  \tvar changes = config.reset(this);\n  \tvar rerender = undefined;\n\n  \tvar i = changes.length;\n  \twhile (i--) {\n  \t\tif (shouldRerender.indexOf(changes[i]) > -1) {\n  \t\t\trerender = true;\n  \t\t\tbreak;\n  \t\t}\n  \t}\n\n  \tif (rerender) {\n  \t\tunrenderHook.fire(this);\n  \t\tthis.fragment.resetTemplate(this.template);\n  \t\trenderHook.fire(this);\n  \t\tcompleteHook.fire(this);\n  \t}\n\n  \trunloop.end();\n\n  \tresetHook.fire(this, data);\n\n  \treturn promise;\n  }\n\n  function Ractive$render(target, anchor) {\n  \ttarget = getElement(target) || this.el;\n\n  \tif (!this.append && target) {\n  \t\t// Teardown any existing instances *before* trying to set up the new one -\n  \t\t// avoids certain weird bugs\n  \t\tvar others = target.__ractive_instances__;\n  \t\tif (others) others.forEach(teardown);\n\n  \t\t// make sure we are the only occupants\n  \t\ttarget.innerHTML = ''; // TODO is this quicker than removeChild? Initial research inconclusive\n  \t}\n\n  \treturn render(this, target, anchor);\n  }\n\n  var push = makeArrayMethod('push');\n\n  var pop = makeArrayMethod('pop');\n\n  function Ractive$once(eventName, handler) {\n  \tvar listener = this.on(eventName, function () {\n  \t\thandler.apply(this, arguments);\n  \t\tlistener.cancel();\n  \t});\n\n  \t// so we can still do listener.cancel() manually\n  \treturn listener;\n  }\n\n  function trim (str) {\n    return str.trim();\n  }\n\n  function notEmptyString (str) {\n    return str !== '';\n  }\n\n  function Ractive$on(eventName, callback) {\n  \tvar _this = this;\n\n  \t// allow mutliple listeners to be bound in one go\n  \tif (typeof eventName === 'object') {\n  \t\tvar _ret = (function () {\n  \t\t\tvar listeners = [];\n  \t\t\tvar n = undefined;\n\n  \t\t\tfor (n in eventName) {\n  \t\t\t\tif (eventName.hasOwnProperty(n)) {\n  \t\t\t\t\tlisteners.push(_this.on(n, eventName[n]));\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\treturn {\n  \t\t\t\tv: {\n  \t\t\t\t\tcancel: function () {\n  \t\t\t\t\t\tvar listener = undefined;\n  \t\t\t\t\t\twhile (listener = listeners.pop()) listener.cancel();\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t\t};\n  \t\t})();\n\n  \t\tif (typeof _ret === 'object') return _ret.v;\n  \t}\n\n  \t// Handle multiple space-separated event names\n  \tvar eventNames = eventName.split(' ').map(trim).filter(notEmptyString);\n\n  \teventNames.forEach(function (eventName) {\n  \t\t(_this._subs[eventName] || (_this._subs[eventName] = [])).push(callback);\n  \t});\n\n  \treturn {\n  \t\tcancel: function () {\n  \t\t\treturn _this.off(eventName, callback);\n  \t\t}\n  \t};\n  }\n\n  function Ractive$off(eventName, callback) {\n  \tvar _this = this;\n\n  \t// if no arguments specified, remove all callbacks\n  \tif (!eventName) {\n  \t\t// TODO use this code instead, once the following issue has been resolved\n  \t\t// in PhantomJS (tests are unpassable otherwise!)\n  \t\t// https://github.com/ariya/phantomjs/issues/11856\n  \t\t// defineProperty( this, '_subs', { value: create( null ), configurable: true });\n  \t\tfor (eventName in this._subs) {\n  \t\t\tdelete this._subs[eventName];\n  \t\t}\n  \t} else {\n  \t\t// Handle multiple space-separated event names\n  \t\tvar eventNames = eventName.split(' ').map(trim).filter(notEmptyString);\n\n  \t\teventNames.forEach(function (eventName) {\n  \t\t\tvar subscribers = _this._subs[eventName];\n\n  \t\t\t// If we have subscribers for this event...\n  \t\t\tif (subscribers) {\n  \t\t\t\t// ...if a callback was specified, only remove that\n  \t\t\t\tif (callback) {\n  \t\t\t\t\tvar index = subscribers.indexOf(callback);\n  \t\t\t\t\tif (index !== -1) {\n  \t\t\t\t\t\tsubscribers.splice(index, 1);\n  \t\t\t\t\t}\n  \t\t\t\t}\n\n  \t\t\t\t// ...otherwise remove all callbacks\n  \t\t\t\telse {\n  \t\t\t\t\t\t_this._subs[eventName] = [];\n  \t\t\t\t\t}\n  \t\t\t}\n  \t\t});\n  \t}\n\n  \treturn this;\n  }\n\n  var onceOptions = { init: false, once: true };\n  function observeOnce(keypath, callback, options) {\n  \tif (isObject(keypath) || typeof keypath === 'function') {\n  \t\toptions = extend(callback || {}, onceOptions);\n  \t\treturn this.observe(keypath, options);\n  \t}\n\n  \toptions = extend(options || {}, onceOptions);\n  \treturn this.observe(keypath, callback, options);\n  }\n\n  function observeList(keypath, callback, options) {\n  \tif (typeof keypath !== 'string') {\n  \t\tthrow new Error('ractive.observeList() must be passed a string as its first argument');\n  \t}\n\n  \tvar model = this.viewmodel.joinAll(splitKeypath(keypath));\n  \tvar observer = new ListObserver(this, model, callback, options || {});\n\n  \t// add observer to the Ractive instance, so it can be\n  \t// cancelled on ractive.teardown()\n  \tthis._observers.push(observer);\n\n  \treturn {\n  \t\tcancel: function () {\n  \t\t\tobserver.cancel();\n  \t\t}\n  \t};\n  }\n\n  function negativeOne() {\n  \treturn -1;\n  }\n\n  var ListObserver = (function () {\n  \tfunction ListObserver(context, model, callback, options) {\n  \t\tclassCallCheck(this, ListObserver);\n\n  \t\tthis.context = context;\n  \t\tthis.model = model;\n  \t\tthis.keypath = model.getKeypath();\n  \t\tthis.callback = callback;\n\n  \t\tthis.pending = null;\n\n  \t\tmodel.register(this);\n\n  \t\tif (options.init !== false) {\n  \t\t\tthis.sliced = [];\n  \t\t\tthis.shuffle([]);\n  \t\t\tthis.handleChange();\n  \t\t} else {\n  \t\t\tthis.sliced = this.slice();\n  \t\t}\n  \t}\n\n  \tListObserver.prototype.handleChange = function handleChange() {\n  \t\tif (this.pending) {\n  \t\t\t// post-shuffle\n  \t\t\tthis.callback(this.pending);\n  \t\t\tthis.pending = null;\n  \t\t} else {\n  \t\t\t// entire array changed\n  \t\t\tthis.shuffle(this.sliced.map(negativeOne));\n  \t\t\tthis.handleChange();\n  \t\t}\n  \t};\n\n  \tListObserver.prototype.shuffle = function shuffle(newIndices) {\n  \t\tvar _this = this;\n\n  \t\tvar newValue = this.slice();\n\n  \t\tvar inserted = [];\n  \t\tvar deleted = [];\n  \t\tvar start = undefined;\n\n  \t\tvar hadIndex = {};\n\n  \t\tnewIndices.forEach(function (newIndex, oldIndex) {\n  \t\t\thadIndex[newIndex] = true;\n\n  \t\t\tif (newIndex !== oldIndex && start === undefined) {\n  \t\t\t\tstart = oldIndex;\n  \t\t\t}\n\n  \t\t\tif (newIndex === -1) {\n  \t\t\t\tdeleted.push(_this.sliced[oldIndex]);\n  \t\t\t}\n  \t\t});\n\n  \t\tif (start === undefined) start = newIndices.length;\n\n  \t\tvar len = newValue.length;\n  \t\tfor (var i = 0; i < len; i += 1) {\n  \t\t\tif (!hadIndex[i]) inserted.push(newValue[i]);\n  \t\t}\n\n  \t\tthis.pending = { inserted: inserted, deleted: deleted, start: start };\n  \t\tthis.sliced = newValue;\n  \t};\n\n  \tListObserver.prototype.slice = function slice() {\n  \t\tvar value = this.model.get();\n  \t\treturn isArray(value) ? value.slice() : [];\n  \t};\n\n  \treturn ListObserver;\n  })();\n\n  function observe(keypath, callback, options) {\n  \tvar _this = this;\n\n  \tvar observers = [];\n  \tvar map = undefined;\n\n  \tif (isObject(keypath)) {\n  \t\tmap = keypath;\n  \t\toptions = callback || {};\n\n  \t\tObject.keys(map).forEach(function (keypath) {\n  \t\t\tvar callback = map[keypath];\n\n  \t\t\tkeypath.split(' ').forEach(function (keypath) {\n  \t\t\t\tobservers.push(createObserver(_this, keypath, callback, options));\n  \t\t\t});\n  \t\t});\n  \t} else {\n  \t\tvar keypaths = undefined;\n\n  \t\tif (typeof keypath === 'function') {\n  \t\t\toptions = callback;\n  \t\t\tcallback = keypath;\n  \t\t\tkeypaths = [''];\n  \t\t} else {\n  \t\t\tkeypaths = keypath.split(' ');\n  \t\t}\n\n  \t\tkeypaths.forEach(function (keypath) {\n  \t\t\tobservers.push(createObserver(_this, keypath, callback, options || {}));\n  \t\t});\n  \t}\n\n  \t// add observers to the Ractive instance, so they can be\n  \t// cancelled on ractive.teardown()\n  \tthis._observers.push.apply(this._observers, observers);\n\n  \treturn {\n  \t\tcancel: function () {\n  \t\t\tobservers.forEach(cancel);\n  \t\t}\n  \t};\n  }\n\n  function createObserver(ractive, keypath, callback, options) {\n  \tvar viewmodel = ractive.viewmodel;\n\n  \tvar keys = splitKeypath(keypath);\n  \tvar wildcardIndex = keys.indexOf('*');\n\n  \t// normal keypath - no wildcards\n  \tif (! ~wildcardIndex) {\n  \t\tvar key = keys[0];\n\n  \t\tif (!viewmodel.has(key)) {\n  \t\t\t// if this is an inline component, we may need to create an implicit mapping\n  \t\t\tif (ractive.component) {\n  \t\t\t\tvar _model = resolveReference(ractive.component.parentFragment, key);\n  \t\t\t\tif (_model) viewmodel.map(key, _model);\n  \t\t\t}\n  \t\t}\n\n  \t\tvar model = viewmodel.joinAll(keys);\n  \t\treturn new Observer(options.context || ractive, model, callback, options);\n  \t}\n\n  \t// pattern observers - more complex case\n  \tvar baseModel = wildcardIndex === 0 ? viewmodel : viewmodel.joinAll(keys.slice(0, wildcardIndex));\n\n  \treturn new PatternObserver(options.context || ractive, baseModel, keys.splice(wildcardIndex), callback, options);\n  }\n\n  var Observer = (function () {\n  \tfunction Observer(context, model, callback, options) {\n  \t\tclassCallCheck(this, Observer);\n\n  \t\tthis.context = context;\n  \t\tthis.model = model;\n  \t\tthis.keypath = model.getKeypath();\n  \t\tthis.callback = callback;\n\n  \t\tthis.oldValue = undefined;\n  \t\tthis.newValue = model.get();\n\n  \t\tthis.defer = options.defer;\n  \t\tthis.once = options.once;\n  \t\tthis.strict = options.strict;\n\n  \t\tthis.dirty = false;\n\n  \t\tif (options.init !== false) {\n  \t\t\tthis.dispatch();\n  \t\t} else {\n  \t\t\tthis.oldValue = this.newValue;\n  \t\t}\n\n  \t\tmodel.register(this);\n  \t}\n\n  \tObserver.prototype.cancel = function cancel() {\n  \t\tthis.model.unregister(this);\n  \t};\n\n  \tObserver.prototype.dispatch = function dispatch() {\n  \t\tthis.callback.call(this.context, this.newValue, this.oldValue, this.keypath);\n  \t\tthis.oldValue = this.newValue;\n  \t\tthis.dirty = false;\n  \t};\n\n  \tObserver.prototype.handleChange = function handleChange() {\n  \t\tif (!this.dirty) {\n  \t\t\tthis.newValue = this.model.get();\n\n  \t\t\tif (this.strict && this.newValue === this.oldValue) return;\n\n  \t\t\trunloop.addObserver(this, this.defer);\n  \t\t\tthis.dirty = true;\n\n  \t\t\tif (this.once) this.cancel();\n  \t\t}\n  \t};\n\n  \treturn Observer;\n  })();\n\n  var PatternObserver = (function () {\n  \tfunction PatternObserver(context, baseModel, keys, callback, options) {\n  \t\tvar _this2 = this;\n\n  \t\tclassCallCheck(this, PatternObserver);\n\n  \t\tthis.context = context;\n  \t\tthis.baseModel = baseModel;\n  \t\tthis.keys = keys;\n  \t\tthis.callback = callback;\n\n  \t\tvar pattern = keys.join('\\\\.').replace(/\\*/g, '(.+)');\n  \t\tvar baseKeypath = baseModel.getKeypath();\n  \t\tthis.pattern = new RegExp('^' + (baseKeypath ? baseKeypath + '.' : '') + pattern + '$');\n\n  \t\tthis.oldValues = {};\n  \t\tthis.newValues = {};\n\n  \t\tthis.defer = options.defer;\n  \t\tthis.once = options.once;\n  \t\tthis.strict = options.strict;\n\n  \t\tthis.dirty = false;\n\n  \t\tthis.baseModel.findMatches(this.keys).forEach(function (model) {\n  \t\t\t_this2.newValues[model.getKeypath()] = model.get();\n  \t\t});\n\n  \t\tif (options.init !== false) {\n  \t\t\tthis.dispatch();\n  \t\t} else {\n  \t\t\tthis.oldValues = this.newValues;\n  \t\t}\n\n  \t\tbaseModel.register(this);\n  \t}\n\n  \tPatternObserver.prototype.cancel = function cancel() {\n  \t\tthis.baseModel.unregister(this);\n  \t};\n\n  \tPatternObserver.prototype.dispatch = function dispatch() {\n  \t\tvar _this3 = this;\n\n  \t\tObject.keys(this.newValues).forEach(function (keypath) {\n  \t\t\tvar newValue = _this3.newValues[keypath];\n  \t\t\tvar oldValue = _this3.oldValues[keypath];\n\n  \t\t\tif (_this3.strict && newValue === oldValue) return;\n  \t\t\tif (isEqual(newValue, oldValue)) return;\n\n  \t\t\tvar wildcards = _this3.pattern.exec(keypath).slice(1);\n  \t\t\tvar args = [newValue, oldValue, keypath].concat(wildcards);\n\n  \t\t\t_this3.callback.apply(_this3.context, args);\n  \t\t});\n\n  \t\tthis.oldValues = this.newValues;\n  \t\tthis.dirty = false;\n  \t};\n\n  \tPatternObserver.prototype.handleChange = function handleChange() {\n  \t\tvar _this4 = this;\n\n  \t\tif (!this.dirty) {\n  \t\t\tthis.newValues = {};\n\n  \t\t\t// handle case where previously extant keypath no longer exists -\n  \t\t\t// observer should still fire, with undefined as new value\n  \t\t\t// TODO huh. according to the test suite that's not the case...\n  \t\t\t// Object.keys( this.oldValues ).forEach( keypath => {\n  \t\t\t// \tthis.newValues[ keypath ] = undefined;\n  \t\t\t// });\n\n  \t\t\tthis.baseModel.findMatches(this.keys).forEach(function (model) {\n  \t\t\t\tvar keypath = model.getKeypath();\n  \t\t\t\t_this4.newValues[keypath] = model.get();\n  \t\t\t});\n\n  \t\t\trunloop.addObserver(this, this.defer);\n  \t\t\tthis.dirty = true;\n\n  \t\t\tif (this.once) this.cancel();\n  \t\t}\n  \t};\n\n  \treturn PatternObserver;\n  })();\n\n  var comparators = {};\n\n  function getComparator(option) {\n  \tif (!option) return null; // use existing arrays\n  \tif (option === true) return JSON.stringify;\n  \tif (typeof option === 'function') return option;\n\n  \tif (typeof option === 'string') {\n  \t\treturn comparators[option] || (comparators[option] = function (thing) {\n  \t\t\treturn thing[option];\n  \t\t});\n  \t}\n\n  \tthrow new Error('If supplied, options.compare must be a string, function, or `true`'); // TODO link to docs\n  }\n  function Ractive$merge(keypath, array, options) {\n  \tvar model = this.viewmodel.joinAll(splitKeypath(keypath));\n  \tvar promise = runloop.start(this, true);\n  \tvar value = model.get();\n\n  \tif (array === value) {\n  \t\tthrow new Error('You cannot merge an array with itself'); // TODO link to docs\n  \t} else if (!isArray(value) || !isArray(array)) {\n  \t\t\tthrow new Error('You cannot merge an array with a non-array');\n  \t\t}\n\n  \tvar comparator = getComparator(options && options.compare);\n  \tmodel.merge(array, comparator);\n\n  \trunloop.end();\n  \treturn promise;\n  }\n\n  var insertHook = new Hook('insert');\n  function Ractive$insert(target, anchor) {\n  \tif (!this.fragment.rendered) {\n  \t\t// TODO create, and link to, documentation explaining this\n  \t\tthrow new Error('The API has changed - you must call `ractive.render(target[, anchor])` to render your Ractive instance. Once rendered you can use `ractive.insert()`.');\n  \t}\n\n  \ttarget = getElement(target);\n  \tanchor = getElement(anchor) || null;\n\n  \tif (!target) {\n  \t\tthrow new Error('You must specify a valid target to insert into');\n  \t}\n\n  \ttarget.insertBefore(this.detach(), anchor);\n  \tthis.el = target;\n\n  \t(target.__ractive_instances__ || (target.__ractive_instances__ = [])).push(this);\n  \tthis.isDetached = false;\n\n  \tfireInsertHook(this);\n  }\n\n  function fireInsertHook(ractive) {\n  \tinsertHook.fire(ractive);\n\n  \tractive.findAllComponents('*').forEach(function (child) {\n  \t\tfireInsertHook(child.instance);\n  \t});\n  }\n\n  function Ractive$get(keypath) {\n  \tif (!keypath) return this.viewmodel.get(true);\n\n  \tvar keys = splitKeypath(keypath);\n  \tvar key = keys[0];\n\n  \tvar model = undefined;\n\n  \tif (!this.viewmodel.has(key)) {\n  \t\t// if this is an inline component, we may need to create\n  \t\t// an implicit mapping\n  \t\tif (this.component) {\n  \t\t\tmodel = resolveReference(this.component.parentFragment, key);\n\n  \t\t\tif (model) {\n  \t\t\t\tthis.viewmodel.map(key, model);\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \tmodel = this.viewmodel.joinAll(keys);\n  \treturn model.get(true);\n  }\n\n  function Ractive$fire(eventName) {\n  \tfor (var _len = arguments.length, args = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n  \t\targs[_key - 1] = arguments[_key];\n  \t}\n\n  \tfireEvent(this, eventName, { args: args });\n  }\n\n  function Ractive$findParent(selector) {\n\n  \tif (this.parent) {\n  \t\tif (this.parent.component && this.parent.component.name === selector) {\n  \t\t\treturn this.parent;\n  \t\t} else {\n  \t\t\treturn this.parent.findParent(selector);\n  \t\t}\n  \t}\n\n  \treturn null;\n  }\n\n  function Ractive$findContainer(selector) {\n  \tif (this.container) {\n  \t\tif (this.container.component && this.container.component.name === selector) {\n  \t\t\treturn this.container;\n  \t\t} else {\n  \t\t\treturn this.container.findContainer(selector);\n  \t\t}\n  \t}\n\n  \treturn null;\n  }\n\n  function Ractive$findComponent(selector) {\n  \treturn this.fragment.findComponent(selector);\n  }\n\n  function sortByDocumentPosition(node, otherNode) {\n  \tif (node.compareDocumentPosition) {\n  \t\tvar bitmask = node.compareDocumentPosition(otherNode);\n  \t\treturn bitmask & 2 ? 1 : -1;\n  \t}\n\n  \t// In old IE, we can piggy back on the mechanism for\n  \t// comparing component positions\n  \treturn sortByItemPosition(node, otherNode);\n  }\n\n  function sortByItemPosition(a, b) {\n  \tvar ancestryA = getAncestry(a.component || a._ractive.proxy);\n  \tvar ancestryB = getAncestry(b.component || b._ractive.proxy);\n\n  \tvar oldestA = lastItem(ancestryA);\n  \tvar oldestB = lastItem(ancestryB);\n  \tvar mutualAncestor = undefined;\n\n  \t// remove items from the end of both ancestries as long as they are identical\n  \t// - the final one removed is the closest mutual ancestor\n  \twhile (oldestA && oldestA === oldestB) {\n  \t\tancestryA.pop();\n  \t\tancestryB.pop();\n\n  \t\tmutualAncestor = oldestA;\n\n  \t\toldestA = lastItem(ancestryA);\n  \t\toldestB = lastItem(ancestryB);\n  \t}\n\n  \t// now that we have the mutual ancestor, we can find which is earliest\n  \toldestA = oldestA.component || oldestA;\n  \toldestB = oldestB.component || oldestB;\n\n  \tvar fragmentA = oldestA.parentFragment;\n  \tvar fragmentB = oldestB.parentFragment;\n\n  \t// if both items share a parent fragment, our job is easy\n  \tif (fragmentA === fragmentB) {\n  \t\tvar indexA = fragmentA.items.indexOf(oldestA);\n  \t\tvar indexB = fragmentB.items.indexOf(oldestB);\n\n  \t\t// if it's the same index, it means one contains the other,\n  \t\t// so we see which has the longest ancestry\n  \t\treturn indexA - indexB || ancestryA.length - ancestryB.length;\n  \t}\n\n  \t// if mutual ancestor is a section, we first test to see which section\n  \t// fragment comes first\n  \tvar fragments = mutualAncestor.iterations;\n  \tif (fragments) {\n  \t\tvar indexA = fragments.indexOf(fragmentA);\n  \t\tvar indexB = fragments.indexOf(fragmentB);\n\n  \t\treturn indexA - indexB || ancestryA.length - ancestryB.length;\n  \t}\n\n  \tthrow new Error('An unexpected condition was met while comparing the position of two components. Please file an issue at https://github.com/ractivejs/ractive/issues - thanks!');\n  }\n\n  function getParent(item) {\n  \tvar parentFragment = item.parentFragment;\n\n  \tif (parentFragment) return parentFragment.owner;\n\n  \tif (item.component && (parentFragment = item.component.parentFragment)) {\n  \t\treturn parentFragment.owner;\n  \t}\n  }\n\n  function getAncestry(item) {\n  \tvar ancestry = [item];\n  \tvar ancestor = getParent(item);\n\n  \twhile (ancestor) {\n  \t\tancestry.push(ancestor);\n  \t\tancestor = getParent(ancestor);\n  \t}\n\n  \treturn ancestry;\n  }\n\n  var Query = (function () {\n  \tfunction Query(ractive, selector, live, isComponentQuery) {\n  \t\tclassCallCheck(this, Query);\n\n  \t\tthis.ractive = ractive;\n  \t\tthis.selector = selector;\n  \t\tthis.live = live;\n  \t\tthis.isComponentQuery = isComponentQuery;\n\n  \t\tthis.result = [];\n\n  \t\tthis.dirty = true;\n  \t}\n\n  \tQuery.prototype.add = function add(item) {\n  \t\tthis.result.push(item);\n  \t\tthis.makeDirty();\n  \t};\n\n  \tQuery.prototype.cancel = function cancel() {\n  \t\tvar liveQueries = this._root[this.isComponentQuery ? 'liveComponentQueries' : 'liveQueries'];\n  \t\tvar selector = this.selector;\n\n  \t\tvar index = liveQueries.indexOf(selector);\n\n  \t\tif (index !== -1) {\n  \t\t\tliveQueries.splice(index, 1);\n  \t\t\tliveQueries[selector] = null;\n  \t\t}\n  \t};\n\n  \tQuery.prototype.init = function init() {\n  \t\tthis.dirty = false;\n  \t};\n\n  \tQuery.prototype.makeDirty = function makeDirty() {\n  \t\tvar _this = this;\n\n  \t\tif (!this.dirty) {\n  \t\t\tthis.dirty = true;\n\n  \t\t\t// Once the DOM has been updated, ensure the query\n  \t\t\t// is correctly ordered\n  \t\t\trunloop.scheduleTask(function () {\n  \t\t\t\treturn _this.update();\n  \t\t\t});\n  \t\t}\n  \t};\n\n  \tQuery.prototype.remove = function remove(nodeOrComponent) {\n  \t\tvar index = this.result.indexOf(this.isComponentQuery ? nodeOrComponent.instance : nodeOrComponent);\n  \t\tif (index !== -1) this.result.splice(index, 1);\n  \t};\n\n  \tQuery.prototype.update = function update() {\n  \t\tthis.result.sort(this.isComponentQuery ? sortByItemPosition : sortByDocumentPosition);\n  \t\tthis.dirty = false;\n  \t};\n\n  \tQuery.prototype.test = function test(item) {\n  \t\treturn this.isComponentQuery ? !this.selector || item.name === this.selector : item ? matches(item, this.selector) : null;\n  \t};\n\n  \treturn Query;\n  })();\n\n  function Ractive$findAllComponents(selector, options) {\n  \toptions = options || {};\n  \tvar liveQueries = this._liveComponentQueries;\n\n  \t// Shortcut: if we're maintaining a live query with this\n  \t// selector, we don't need to traverse the parallel DOM\n  \tvar query = liveQueries[selector];\n  \tif (query) {\n  \t\t// Either return the exact same query, or (if not live) a snapshot\n  \t\treturn options && options.live ? query : query.slice();\n  \t}\n\n  \tquery = new Query(this, selector, !!options.live, true);\n\n  \t// Add this to the list of live queries Ractive needs to maintain,\n  \t// if applicable\n  \tif (query.live) {\n  \t\tliveQueries.push(selector);\n  \t\tliveQueries['_' + selector] = query;\n  \t}\n\n  \tthis.fragment.findAllComponents(selector, query);\n\n  \tquery.init();\n  \treturn query.result;\n  }\n\n  function Ractive$findAll(selector, options) {\n  \tif (!this.el) return [];\n\n  \toptions = options || {};\n  \tvar liveQueries = this._liveQueries;\n\n  \t// Shortcut: if we're maintaining a live query with this\n  \t// selector, we don't need to traverse the parallel DOM\n  \tvar query = liveQueries[selector];\n  \tif (query) {\n  \t\t// Either return the exact same query, or (if not live) a snapshot\n  \t\treturn options && options.live ? query : query.slice();\n  \t}\n\n  \tquery = new Query(this, selector, !!options.live, false);\n\n  \t// Add this to the list of live queries Ractive needs to maintain,\n  \t// if applicable\n  \tif (query.live) {\n  \t\tliveQueries.push(selector);\n  \t\tliveQueries['_' + selector] = query;\n  \t}\n\n  \tthis.fragment.findAll(selector, query);\n\n  \tquery.init();\n  \treturn query.result;\n  }\n\n  function Ractive$find(selector) {\n  \tif (!this.el) {\n  \t\treturn null;\n  \t}\n\n  \treturn this.fragment.find(selector);\n  }\n\n  var detachHook = new Hook('detach');\n  function Ractive$detach() {\n  \tif (this.isDetached) {\n  \t\treturn this.el;\n  \t}\n\n  \tif (this.el) {\n  \t\tremoveFromArray(this.el.__ractive_instances__, this);\n  \t}\n\n  \tthis.el = this.fragment.detach();\n  \tthis.isDetached = true;\n\n  \tdetachHook.fire(this);\n  \treturn this.el;\n  }\n\n  // These are a subset of the easing equations found at\n  // https://raw.github.com/danro/easing-js - license info\n  // follows:\n\n  // --------------------------------------------------\n  // easing.js v0.5.4\n  // Generic set of easing functions with AMD support\n  // https://github.com/danro/easing-js\n  // This code may be freely distributed under the MIT license\n  // http://danro.mit-license.org/\n  // --------------------------------------------------\n  // All functions adapted from Thomas Fuchs & Jeremy Kahn\n  // Easing Equations (c) 2003 Robert Penner, BSD license\n  // https://raw.github.com/danro/easing-js/master/LICENSE\n  // --------------------------------------------------\n\n  // In that library, the functions named easeIn, easeOut, and\n  // easeInOut below are named easeInCubic, easeOutCubic, and\n  // (you guessed it) easeInOutCubic.\n  //\n  // You can add additional easing functions to this list, and they\n  // will be globally available.\n\n  var easing = {\n  \tlinear: function (pos) {\n  \t\treturn pos;\n  \t},\n  \teaseIn: function (pos) {\n  \t\treturn Math.pow(pos, 3);\n  \t},\n  \teaseOut: function (pos) {\n  \t\treturn Math.pow(pos - 1, 3) + 1;\n  \t},\n  \teaseInOut: function (pos) {\n  \t\tif ((pos /= 0.5) < 1) {\n  \t\t\treturn 0.5 * Math.pow(pos, 3);\n  \t\t}\n  \t\treturn 0.5 * (Math.pow(pos - 2, 3) + 2);\n  \t}\n  };\n\n  var noAnimation = { stop: noop };\n  var linear = easing.linear;\n\n  function getOptions(options, instance) {\n  \toptions = options || {};\n\n  \tvar easing = undefined;\n  \tif (options.easing) {\n  \t\teasing = typeof options.easing === 'function' ? options.easing : instance.easing[options.easing];\n  \t}\n\n  \treturn {\n  \t\teasing: easing || linear,\n  \t\tduration: 'duration' in options ? options.duration : 400,\n  \t\tcomplete: options.complete || noop,\n  \t\tstep: options.step || noop\n  \t};\n  }\n  function Ractive$animate(keypath, to, options) {\n  \tif (typeof keypath === 'object') {\n  \t\tvar keys = Object.keys(keypath);\n\n  \t\tthrow new Error('ractive.animate(...) no longer supports objects. Instead of ractive.animate({\\n  ' + keys.map(function (key) {\n  \t\t\treturn '\\'' + key + '\\': ' + keypath[key];\n  \t\t}).join('\\n  ') + '\\n}, {...}), do\\n\\n' + keys.map(function (key) {\n  \t\t\treturn 'ractive.animate(\\'' + key + '\\', ' + keypath[key] + ', {...});';\n  \t\t}).join('\\n') + '\\n');\n  \t}\n\n  \toptions = getOptions(options);\n\n  \tvar model = this.viewmodel.joinAll(splitKeypath(keypath));\n  \tvar from = model.get();\n\n  \t// don't bother animating values that stay the same\n  \tif (isEqual(from, to)) {\n  \t\toptions.complete(options.to);\n  \t\treturn noAnimation; // TODO should this have .then and .catch methods?\n  \t}\n\n  \tvar interpolator = interpolate(from, to, this, options.interpolator);\n\n  \t// if we can't interpolate the value, set it immediately\n  \tif (!interpolator) {\n  \t\trunloop.start();\n  \t\tmodel.set(to);\n  \t\trunloop.end();\n\n  \t\treturn noAnimation;\n  \t}\n\n  \treturn model.animate(from, to, options, interpolator);\n  }\n\n  function Ractive$add(keypath, d) {\n  \treturn add(this, keypath, d === undefined ? 1 : +d);\n  }\n\n  var proto$1 = {\n  \tadd: Ractive$add,\n  \tanimate: Ractive$animate,\n  \tdetach: Ractive$detach,\n  \tfind: Ractive$find,\n  \tfindAll: Ractive$findAll,\n  \tfindAllComponents: Ractive$findAllComponents,\n  \tfindComponent: Ractive$findComponent,\n  \tfindContainer: Ractive$findContainer,\n  \tfindParent: Ractive$findParent,\n  \tfire: Ractive$fire,\n  \tget: Ractive$get,\n  \tinsert: Ractive$insert,\n  \tmerge: Ractive$merge,\n  \tobserve: observe,\n  \tobserveList: observeList,\n  \tobserveOnce: observeOnce,\n  \t// TODO reinstate these\n  \t// observeListOnce,\n  \toff: Ractive$off,\n  \ton: Ractive$on,\n  \tonce: Ractive$once,\n  \tpop: pop,\n  \tpush: push,\n  \trender: Ractive$render,\n  \treset: Ractive$reset,\n  \tresetPartial: resetPartial,\n  \tresetTemplate: Ractive$resetTemplate,\n  \treverse: reverse,\n  \tset: Ractive$set,\n  \tshift: shift,\n  \tsort: sort,\n  \tsplice: splice,\n  \tsubtract: Ractive$subtract,\n  \tteardown: Ractive$teardown,\n  \ttoggle: Ractive$toggle,\n  \ttoHTML: Ractive$toHTML,\n  \ttoHtml: Ractive$toHTML,\n  \tunrender: Ractive$unrender,\n  \tunshift: unshift,\n  \tupdate: Ractive$update,\n  \tupdateModel: Ractive$updateModel\n  };\n\n  function getNodeInfo (node) {\n  \tif (!node || !node._ractive) return {};\n\n  \tvar storage = node._ractive;\n\n  \treturn {\n  \t\tractive: storage.ractive,\n  \t\tkeypath: storage.context.getKeypath(),\n  \t\tindex: extend({}, storage.fragment.indexRefs),\n  \t\tkey: extend({}, storage.fragment.keyRefs)\n  \t};\n  }\n\n  function wrap$1 (method, superMethod, force) {\n\n  \tif (force || needsSuper$1(method, superMethod)) {\n\n  \t\treturn function () {\n\n  \t\t\tvar hasSuper = ('_super' in this),\n  \t\t\t    _super = this._super,\n  \t\t\t    result;\n\n  \t\t\tthis._super = superMethod;\n\n  \t\t\tresult = method.apply(this, arguments);\n\n  \t\t\tif (hasSuper) {\n  \t\t\t\tthis._super = _super;\n  \t\t\t}\n\n  \t\t\treturn result;\n  \t\t};\n  \t} else {\n  \t\treturn method;\n  \t}\n  }\n\n  function needsSuper$1(method, superMethod) {\n  \treturn typeof superMethod === 'function' && /_super/.test(method);\n  }\n\n  function unwrap(Child) {\n  \tvar options = {};\n\n  \twhile (Child) {\n  \t\taddRegistries(Child, options);\n  \t\taddOtherOptions(Child, options);\n\n  \t\tif (Child._Parent !== Ractive) {\n  \t\t\tChild = Child._Parent;\n  \t\t} else {\n  \t\t\tChild = false;\n  \t\t}\n  \t}\n\n  \treturn options;\n  }\n\n  function addRegistries(Child, options) {\n  \tregistries.forEach(function (r) {\n  \t\taddRegistry(r.useDefaults ? Child.prototype : Child, options, r.name);\n  \t});\n  }\n\n  function addRegistry(target, options, name) {\n  \tvar registry,\n  \t    keys = Object.keys(target[name]);\n\n  \tif (!keys.length) {\n  \t\treturn;\n  \t}\n\n  \tif (!(registry = options[name])) {\n  \t\tregistry = options[name] = {};\n  \t}\n\n  \tkeys.filter(function (key) {\n  \t\treturn !(key in registry);\n  \t}).forEach(function (key) {\n  \t\treturn registry[key] = target[name][key];\n  \t});\n  }\n\n  function addOtherOptions(Child, options) {\n  \tObject.keys(Child.prototype).forEach(function (key) {\n  \t\tif (key === 'computed') {\n  \t\t\treturn;\n  \t\t}\n\n  \t\tvar value = Child.prototype[key];\n\n  \t\tif (!(key in options)) {\n  \t\t\toptions[key] = value._method ? value._method : value;\n  \t\t}\n\n  \t\t// is it a wrapped function?\n  \t\telse if (typeof options[key] === 'function' && typeof value === 'function' && options[key]._method) {\n\n  \t\t\t\tvar result = undefined,\n  \t\t\t\t    needsSuper = value._method;\n\n  \t\t\t\tif (needsSuper) {\n  \t\t\t\t\tvalue = value._method;\n  \t\t\t\t}\n\n  \t\t\t\t// rewrap bound directly to parent fn\n  \t\t\t\tresult = wrap$1(options[key]._method, value);\n\n  \t\t\t\tif (needsSuper) {\n  \t\t\t\t\tresult._method = result;\n  \t\t\t\t}\n\n  \t\t\t\toptions[key] = result;\n  \t\t\t}\n  \t});\n  }\n\n  function extend$1() {\n  \tfor (var _len = arguments.length, options = Array(_len), _key = 0; _key < _len; _key++) {\n  \t\toptions[_key] = arguments[_key];\n  \t}\n\n  \tif (!options.length) {\n  \t\treturn extendOne(this);\n  \t} else {\n  \t\treturn options.reduce(extendOne, this);\n  \t}\n  }\n\n  function extendOne(Parent) {\n  \tvar options = arguments.length <= 1 || arguments[1] === undefined ? {} : arguments[1];\n\n  \tvar Child, proto;\n\n  \t// if we're extending with another Ractive instance...\n  \t//\n  \t//   var Human = Ractive.extend(...), Spider = Ractive.extend(...);\n  \t//   var Spiderman = Human.extend( Spider );\n  \t//\n  \t// ...inherit prototype methods and default options as well\n  \tif (options.prototype instanceof Ractive) {\n  \t\toptions = unwrap(options);\n  \t}\n\n  \tChild = function (options) {\n  \t\tif (!(this instanceof Child)) return new Child(options);\n\n  \t\tconstruct(this, options || {});\n  \t\tinitialise(this, options || {}, {});\n  \t};\n\n  \tproto = create(Parent.prototype);\n  \tproto.constructor = Child;\n\n  \t// Static properties\n  \tdefineProperties(Child, {\n  \t\t// alias prototype as defaults\n  \t\tdefaults: { value: proto },\n\n  \t\t// extendable\n  \t\textend: { value: extend$1, writable: true, configurable: true },\n\n  \t\t// Parent - for IE8, can't use Object.getPrototypeOf\n  \t\t_Parent: { value: Parent }\n  \t});\n\n  \t// extend configuration\n  \tconfig.extend(Parent, proto, options);\n\n  \tdataConfigurator.extend(Parent, proto, options);\n\n  \tif (options.computed) {\n  \t\tproto.computed = extend(create(Parent.prototype.computed), options.computed);\n  \t}\n\n  \tChild.prototype = proto;\n\n  \treturn Child;\n  }\n\n  // Ractive.js makes liberal use of things like Array.prototype.indexOf. In\n  // older browsers, these are made available via a shim - here, we do a quick\n  // pre-flight check to make sure that either a) we're not in a shit browser,\n  // or b) we're using a Ractive-legacy.js build\n  var FUNCTION = 'function';\n\n  if (typeof Date.now !== FUNCTION || typeof String.prototype.trim !== FUNCTION || typeof Object.keys !== FUNCTION || typeof Array.prototype.indexOf !== FUNCTION || typeof Array.prototype.forEach !== FUNCTION || typeof Array.prototype.map !== FUNCTION || typeof Array.prototype.filter !== FUNCTION || win && typeof win.addEventListener !== FUNCTION) {\n  \tthrow new Error('It looks like you\\'re attempting to use Ractive.js in an older browser. You\\'ll need to use one of the \\'legacy builds\\' in order to continue - see http://docs.ractivejs.org/latest/legacy-builds for more information.');\n  }\n  function Ractive(options) {\n  \tif (!(this instanceof Ractive)) return new Ractive(options);\n\n  \tconstruct(this, options || {});\n  \tinitialise(this, options || {}, {});\n  }\n\n  extend(Ractive.prototype, proto$1, defaults);\n  Ractive.prototype.constructor = Ractive;\n\n  // alias prototype as `defaults`\n  Ractive.defaults = Ractive.prototype;\n\n  // static properties\n  defineProperties(Ractive, {\n\n  \t// debug flag\n  \tDEBUG: { writable: true, value: true },\n  \tDEBUG_PROMISES: { writable: true, value: true },\n\n  \t// static methods:\n  \textend: { value: extend$1 },\n  \tgetNodeInfo: { value: getNodeInfo },\n  \tparse: { value: parse },\n\n  \t// namespaced constructors\n  \tPromise: { value: Promise$1 },\n\n  \t// support\n  \tsvg: { value: svg },\n  \tmagic: { value: magicSupported },\n\n  \t// version\n  \tVERSION: { value: '0.8.0-edge' },\n\n  \t// plugins\n  \tadaptors: { writable: true, value: {} },\n  \tcomponents: { writable: true, value: {} },\n  \tdecorators: { writable: true, value: {} },\n  \teasing: { writable: true, value: easing },\n  \tevents: { writable: true, value: {} },\n  \tinterpolators: { writable: true, value: interpolators$1 },\n  \tpartials: { writable: true, value: {} },\n  \ttransitions: { writable: true, value: {} }\n  });\n\n  return Ractive;\n\n}));"],"names":["_this","this","dirty","runloop","scheduleTask","update","Query","prototype","remove","nodeOrComponent","index","result","indexOf","isComponentQuery","instance","splice","sort","sortByItemPosition","sortByDocumentPosition","test","item","selector","name","matches","detachHook","Hook","easing","linear","pos","easeIn","Math","pow","easeOut","easeInOut","noAnimation","stop","noop","proto$1","add","Ractive$add","animate","Ractive$animate","detach","Ractive$detach","find","Ractive$find","findAll","Ractive$findAll","findAllComponents","Ractive$findAllComponents","findComponent","Ractive$findComponent","findContainer","Ractive$findContainer","findParent","Ractive$findParent","fire","Ractive$fire","get","Ractive$get","insert","Ractive$insert","merge","Ractive$merge","observe","observeList","observeOnce","off","Ractive$off","on","Ractive$on","once","Ractive$once","pop","push","render","Ractive$render","reset","Ractive$reset","resetPartial","resetTemplate","Ractive$resetTemplate","reverse","set","Ractive$set","shift","subtract","Ractive$subtract","teardown","Ractive$teardown","toggle","Ractive$toggle","toHTML","Ractive$toHTML","toHtml","unrender","Ractive$unrender","unshift","Ractive$update","updateModel","Ractive$updateModel","FUNCTION","Date","now","String","trim","Object","keys","Array","forEach","map","filter","win","addEventListener","Error","extend","Ractive","defaults","constructor","defineProperties","DEBUG","writable","value","DEBUG_PROMISES","extend$1","getNodeInfo","parse","Promise","Promise$1","svg","magic","magicSupported","VERSION","adaptors","components","decorators","events","interpolators","interpolators$1","partials","transitions","optionWasSelected","i","len","options","getAttribute","undefined","element","attributeByName","SingleSelectBinding","getValue","node","length","option","selected","disabled","_ractive","_Binding","call","handleDomEvent","setValue","model","removeEventListener","Binding","Element","_Item","classCallCheck","liveQueries","template","e","toLowerCase","isVoid","voidElementNames","fragment","parentFragment","owner","type","ELEMENT","parent","attributes","a","attribute","Attribute","conditionalAttributes","m","ConditionalAttribute","o","decorator","Decorator","eventHandlers","v","key","eventNames","split","eventName","fn","findInViewHierarchy","ractive","event","CustomEvent","DOMEvent","EventDirective","f","noContent","Fragment","cssIds","binding","inherits","bind","_bind","createTwowayBinding","shouldBind","twoway","selectBinding","detachNode","query","live","findNextNode","firstNode","rebind","_rebind","makeDirty$1","target","_this2","namespace","getNamespace","createElement","context","findContext","defineProperty","proxy","keypath","getKeypath","setAttribute","x","join","_render","updateLiveQueries$1","transitionTemplate","t0","t1","transitionsEnabled","transition","Transition","registerTransition","_introTransition","appendChild","rendered","toString","tagName","attrs","stringifyAttribute","isSelected","inputIsCheckedRadio","str","escapeHtml","unbind","_unbind","shouldDestroy","complete","detachWhenReady","_unrender","t2","_transition","id","nodes","removeFromLiveQueries","_update","Item","Input","_Element","apply","arguments","defaultValue","Textarea","_Input","isBindable","bubble","Select","sync","defaultSelected","selectNode","toArray","selectValue","isMultiple","optionValue","shouldSelect","valueContains","forceUpdate","Option","select","findParentSelect","selectedAttribute","isArray","removeFromArray","Form","formBindings","handleReset","mutatorMethods","patchedArrayProto","methodName","method","_len","args","_key","newIndices","getNewIndices","start","setting","wrappers","processWrapper","end","patchArrayMethods","unpatchArrayMethods","__proto__","array","configurable","unpatch","patch","errorMessage","arrayAdaptor","object","wrap","ArrayWrapper","root","__model","instances","_guid","storage","magicAdaptor","MagicWrapper","err","css","styleElement","head","styleSheet","inDom","magicAdaptor$1","originalDescriptors","originalDescriptor","getOwnPropertyDescriptor","childKeypath","descriptor","createOrWrapDescriptor","__magic","revert","dependants","MagicArrayWrapper","magicWrapper","arrayWrapper","magicArrayAdaptor","dataConfigurator","Parent","proto","data","isObject","warnIfDebug","combine$1","init","prop","viewmodel","Computation","_Model","signature","isReadonly","setter","computationContext","dependencies","children","childByKey","deps","boundsSensitive","shouldCapture","capture","adapt","startCapturing","getter","message","console","groupCollapsed","functionBody","prettify","getterString","stack","getterUseStack","truncateStack","error","groupEnd","stopCapturing","setDependencies","handleChange","_handleChange","clearUnresolveds","joinKey","hasOwnProperty","child","ComputationChild","mark","unregister","register","Model","RootModel","changes","isRoot","mappings","computations","applyChanges","_changeHash","flush","compute","computation","has","localKey","origin","wrapper","shouldTeardown","_mark","retrieve","updateFromBindings","cascade","pattern","constructHook","registryNames","uid","HookQueue","hook","inProcess","queue","begin","getChildQueue","prefix$1","styles","doc","getElementsByTagName","s","cssText","innerHTML","css$1","selectorsPattern","commentsPattern","selectorUnitPattern","mediaQueryPattern","dataRvcGuidPattern","uid$1","cssConfigurator","noCssTransform","transformCss","cssId","adaptConfigurator","combine$3","ensureArray","registryNames$1","Registry","useDefaults","configure","registry","create","changed","_fn","isOwner","registries","custom","templateConfigurator","defaultKeys","isStandardKey","makeObj","isBlacklisted","concat","r","order","config","c","configHook","initHook","renderHook$1","completeHook$1","RactiveEvent","handler","listen","directive","component","slice","unlisten","cancel","teardownHook$1","Component","ComponentConstructor","COMPONENT","complexMappings","el","p","content","_partials","yielders","container","YIELDER","construct","_inlinePartials","setupEvents","childData","parsed","parseJSON","t","INTERPOLATOR","resolve$1","warnOnceIfDebug","valueOf","initialise","indexRefs","isolated","keyRefs","checkYielders","_this3","makeDirty","updateLiveQueries","_this4","handlers","_observers","removeFromLiveComponentQueries","__ractive_instances__","_this5","Text","TEXT","createTextNode","escape","constructors","DOCTYPE","Doctype","Interpolator","PARTIAL","Partial","SECTION","Section","TRIPLE","Triple","Yielder","specialElements","doctype","form","input","textarea","ReferenceResolver","reference","callback","normalise","splitKeypath","resolved","addUnresolved","componentParent","attemptResolution","resolveAmbiguousReference","forceResolution","joinAll","unresolved","resolvers","dirtyArgs","dirtyValue","createItems","items","bound","addFragment","createItem","docFrag","createDocumentFragment","found","nextItem","findParentNode","findRepeatingFragment","isIteration","getArgsList","values","source","processItems","argsList","wasBound","wasRendered","parentNode","anchor","insertBefore","resolve","resolver","toEscapedString","_toString","unrenderAndDestroy","shouldRerender","completeHook","resetHook","renderHook","unrenderHook","makeArrayMethod","onceOptions","ListObserver","pending","sliced","shuffle","negativeOne","newValue","inserted","deleted","hadIndex","newIndex","oldIndex","Observer","oldValue","defer","strict","dispatch","addObserver","PatternObserver","baseModel","replace","baseKeypath","RegExp","oldValues","newValues","findMatches","isEqual","wildcards","exec","comparators","insertHook","_root","wasArray","toRemove","oldKeys","iterations","_fragment","newLength","createIteration","RepeatedFragment","updatePostShuffle","pendingNewIndices","previousNewIndex","reinsertFrom","previousIterations","existingFragment","childNodes","_Mustache","sectionType","n","getType","isEmpty","SECTION_WITH","SECTION_UNLESS","SECTION_IF","SECTION_IF_WITH","indexRef","SECTION_EACH","newFragment","fragmentShouldExist","Mustache","elementCache","ieBug","ieBlacklist","TABLE","THEAD","TBODY","TR","SELECT","nodeType","queryResult","querySelector","queryAllResult","querySelectorAll","numNodes","j","html","insertHtml","decodeCharacterReferences","containerFragment","setTemplate","partialTemplate","propertyNames","accept-charset","accesskey","bgcolor","class","codebase","colspan","contenteditable","datetime","dirname","for","http-equiv","ismap","maxlength","novalidate","pubdate","readonly","rowspan","tabindex","usemap","determineNameAndNamespace","updateDelegate","interpolator","getString","booleanAttributes","namespaceURI","propertyName","isTwoway","useProperty","getUpdateDelegate","safeToStringValue","div$1","isSvg","svg$1","parseAttributes","notIn","removeAttribute","missingDecorator","dynamicName","dynamicArgs","d","nameFragment","argsFragment","intermediary","missingPlugin","_name","starMaps","wildcardCache","eventPattern","argumentsPattern","dollarArgsPattern","passthru","models","argsFn","action","g","ref","argMatch","argument","dollarMatch","resolveReference","createFunction","passedArgs","obj","oldEvent","fireEvent","fatal","original","eventPlugin","prefix$2","isClient","prefixCache","testStyle","style","camelCase","capped","charAt","toUpperCase","substring","vendors","vendor","prefix$3","visible","hidden","prefix$4","i$2","onChange","onHide","onShow","number","from","to","delta","isNumeric","intermediate","min","interpolate","properties","hasOwn","unprefixPattern","vendorPattern","createTransitions","canUseCssTransitions","cannotUseCssTransitions","TRANSITION","TRANSITIONEND","CSS_TRANSITIONS_ENABLED","TRANSITION_DURATION","TRANSITION_PROPERTY","TRANSITION_TIMING_FUNCTION","webkitTransition","changedProperties","setTimeout","checkComplete","jsTransitionsComplete","cssTransitionsComplete","isIntro","transitionEndHandler","unprefix","hashPrefix","hyphenate","duration","hash","originalValue","propertiesToTransitionInJs","suffix","getStyle","parseFloat","Ticker","step","_prop","delay","createTransitions$1","getComputedStyle","legacy","params","animateStyle","setStyle","fulfil","computedStyle","current","props","processParams","originalStyle","completed","noReset","resetStyle","_manager","twowayBinding","isUnresolved","warnAboutAmbiguity","getInitialValue","parentForm","findParentForm","resetValue","registerTwowayBinding","locked","unregisterTwowayBinding","CheckboxBinding","attachEvent","checked","BindingGroup","bindings","push$1","CheckboxNameBinding","checkboxName","group","getBindingGroup","getValue$1","noInitialValue","existingValue","bindingValue","arrayContains","wasChecked","isChecked","ContentEditableBinding","lazy","GenericBinding","timeout","handleDelay","handleBlur","MultipleSelectBinding","selectedValues","previousValue","arrayContentsMatch","initialValue","NumericBinding","_GenericBinding","isNaN","siblings","RadioBinding","getSiblings","RadioNameBinding","getValue$2","nameAttributeBinding","getKeypathModel","div","methodNames","makeFunction","i$1","unprefixed","j$1","prefixed","substr","cloneNode","desc","F","stringMiddlePattern","escapeSequencePattern","lineContinuationPattern","INVERTED","CLOSING","COMMENT","DELIMCHANGE","CLOSING_TAG","INLINE_PARTIAL","NUMBER_LITERAL","STRING_LITERAL","ARRAY_LITERAL","OBJECT_LITERAL","BOOLEAN_LITERAL","REGEXP_LITERAL","GLOBAL","KEY_VALUE_PAIR","REFERENCE","REFINEMENT","MEMBER","PREFIX_OPERATOR","BRACKETED","CONDITIONAL","INFIX_OPERATOR","INVOCATION","ELSE","ELSEIF","expectedExpression","expectedParen","numberPattern$1","globals","keywords","getSingleQuotedString","makeQuotedStringMatcher","getDoubleQuotedString","namePattern$1","identifier","regexpPattern","prefixPattern","readTypeOf","makePrefixSequenceMatcher","legalReference","relaxedName","symbol","fallthrough","parser","expression","matchString","allowWhitespace","readExpression","matcher","prefixOperators","readMemberOrInvocation","readLogicalOr","makeInfixSequenceMatcher","readTypeof","left","right","remaining","infixOperators","Parser","ParseError","readLogicalOr$1","arrayMemberPattern","yieldPattern","handlebarsBlockCodes","each","if","if-with","with","unless","elsePattern","elsePattern$1","indexRefPattern","keyIndexRefPattern","handlebarsBlockPattern","htmlEntities","quot","amp","apos","lt","gt","nbsp","iexcl","cent","pound","curren","yen","brvbar","sect","uml","copy","ordf","laquo","not","shy","reg","macr","deg","plusmn","sup2","sup3","acute","micro","para","middot","cedil","sup1","ordm","raquo","frac14","frac12","frac34","iquest","Agrave","Aacute","Acirc","Atilde","Auml","Aring","AElig","Ccedil","Egrave","Eacute","Ecirc","Euml","Igrave","Iacute","Icirc","Iuml","ETH","Ntilde","Ograve","Oacute","Ocirc","Otilde","Ouml","times","Oslash","Ugrave","Uacute","Ucirc","Uuml","Yacute","THORN","szlig","agrave","aacute","acirc","atilde","auml","aring","aelig","ccedil","egrave","eacute","ecirc","euml","igrave","iacute","icirc","iuml","eth","ntilde","ograve","oacute","ocirc","otilde","ouml","divide","oslash","ugrave","uacute","ucirc","uuml","yacute","thorn","yuml","OElig","oelig","Scaron","scaron","Yuml","fnof","circ","tilde","Alpha","Beta","Gamma","Delta","Epsilon","Zeta","Eta","Theta","Iota","Kappa","Lambda","Mu","Nu","Xi","Omicron","Pi","Rho","Sigma","Tau","Upsilon","Phi","Chi","Psi","Omega","alpha","beta","gamma","epsilon","zeta","eta","theta","iota","kappa","lambda","mu","nu","xi","omicron","pi","rho","sigmaf","sigma","tau","upsilon","phi","chi","psi","omega","thetasym","upsih","piv","ensp","emsp","thinsp","zwnj","zwj","lrm","rlm","ndash","mdash","lsquo","rsquo","sbquo","ldquo","rdquo","bdquo","dagger","Dagger","bull","hellip","permil","prime","Prime","lsaquo","rsaquo","oline","frasl","euro","image","weierp","real","trade","alefsym","larr","uarr","rarr","darr","harr","crarr","lArr","uArr","rArr","dArr","hArr","forall","part","exist","empty","nabla","isin","notin","ni","prod","sum","minus","lowast","radic","infin","ang","and","or","cap","cup","int","there4","sim","cong","asymp","ne","equiv","le","ge","sub","sup","nsub","sube","supe","oplus","otimes","perp","sdot","lceil","rceil","lfloor","rfloor","lang","rang","loz","spades","clubs","hearts","diams","controlCharacters","entityPattern","lessThan","greaterThan","leadingLinebreak","trailingLinebreak","contiguousWhitespace","preserveWhitespaceElements","leadingWhitespace$1","trailingWhitespace","leadingNewLine","trailingNewLine","delimiterChangePattern","whitespacePattern","delimiterChangeToken","exclude","closingTagPattern","attributeNamePattern","unquotedAttributeValueTextPattern","leadingWhitespace","lineStart","lines","lineEnds","line","lineEnd","read","leftover","postProcess","converters","getLinePos","char","columnNum","lineNum","numTabs","annotation","match","character","shortMessage","string","matchPattern","nextChar","Child","ExpressionParser","Parser$1","specials","true","false","null","specialsPattern","numberPattern","placeholderPattern","placeholderAtStartPattern","onlyWhitespace","JsonParser","placeholder","special","stringLiteral","readStringLiteral","$1","pair","getKeyValuePair","valueToken","methodCallPattern","methodCallExcessPattern","disallowedContents","tagNamePattern","validTagNameFollower","onPattern","proxyEventPattern","reservedEventNames","directives","intro-outro","intro","outro","li","dt","dd","rt","rp","optgroup","thead","tbody","tfoot","tr","td","th","OPEN_COMMENT","CLOSE_COMMENT","partialDefinitionSectionPattern","pattern$1","startPattern","namePattern","finishPattern","STANDARD_READERS","readPartial","readUnescaped","readSection","readYielder","readInterpolator","readComment","TRIPLE_READERS","readTriple","STATIC_READERS","StandardParser","READERS","readMustache","readHtmlComment","readElement","readText","PARTIAL_READERS","readPartialDefinitionComment","readPartialDefinitionSection","tripleDelimiters","staticDelimiters","staticTripleDelimiters","standardDelimiters","delimiters","tags","isStatic","isTriple","open","close","readers","sortMustacheTags","sectionDepth","elementStack","script","sanitize","elements","eventAttributes","stripComments","preserveWhitespace","sanitizeElements","sanitizeEventAttributes","includeLinePositions","cleanup","TEMPLATE_VERSION","readTemplate","b","requestAnimationFrame","parseOptions","parser$1","fromId","isHashedId","isParsed","getParseOptions","createHelper","createHelper$1","doParse","parseIfString","getDynamicTemplate","_config","extendPartials","captureGroup","lastTime","currTime","timeToCall","max","rAF","getTime","performance","tickers","running","tick","elapsed","eased","abort","prefixers","KeyModel","dependant","KeypathModel","hasProp","originatingModel","indexModels","unresolvedByKey","ticker","unescape","adaptor","getPrefixer","fulfilPromise","promise","applyValue","parentValue","createBranch","previousOriginatingModel","specificKey","hasKey","branch","discard","existingMatches","_loop","member","getIndexModel","fragmentIndex","getKeyModel","keypathModel","Function","comparator","oldArray","newArray","oldLength","usedIndices","firstUnusedIndex","_merged","dep","updateKeypathDependants","_updateFromBindings","_updateKeypathDependants","functionCache","ExpressionProxy","ReferenceExpressionProxy","base","baseResolver","members","refName","getPartialTemplate","named","forceResetTemplate","keyRef","indexByKey","refs","getRefs","iteration","unrenderAndDestroy$1","updateSelectValue","updateContentEditableValue","updateRadioValue","updateValue","updateRadioName","updateCheckboxName","valueAttribute","updateIEStyleAttribute","updateClassName","className","updateProperty","updateAttribute","updateNamespacedAttribute","setAttributeNS","haystack","needle","enqueue","_eventQueue","dequeue","getPotentialWildcardMatches","starMap","mapper","wildcardKeypath","getStarMap","star","num","binary","l","ones","parseInt","digit","_noArg","getWildcardNames","fireEventAs","subscribers","initialFire","_subs","notifySubscribers","fullName","originalEvent","stopEvent","preventDefault","stopPropagation","hyphenatedStr","interpol","_liveQueries","description","all","res","clearTimeout","bindName","bindChecked","typeAttribute","nameAttribute","xmlns","_ref","enumerable","validate","childValue","parentIsFn","childIsFn","callDataFunction","fromProperties","primary","secondary","fnBody","tabs","minIndent","reduce","prev","Infinity","truncated","createFunctionFromString","hasThis","getComputationSignature","setterString","welcome","initialiseProperties","deprecateRactiveData","getAdaptors","computed","combine","protoAdapt","lookup","modifyArrays","_liveComponentQueries","hookQueue","childQueue","trim$1","extractString","unit","transformSelector","selectorUnits","modifiers","transformed","appended","prepended","dataAttr","selectors","superMethod","getSuperMethod","_parent","hasSuper","oldSuper","_super","_method","_ret","getMessage","deprecated","correct","isError","deprecateOption","deprecatedOption","deprecate","extendOtherMethods","userOptions","getElement","append","logIfDebug","noIntro","then","getComponentConstructor","findInstance","_Parent","noRegistryFunctionReturn","ElementConstructor","guid","counter","placeholderId","collect","dest","partial","collection","rerender","others","listener","notEmptyString","listeners","observer","observers","createObserver","keypaths","wildcardIndex","_model","getComparator","JSON","stringify","thing","compare","isDetached","fireInsertHook","otherNode","compareDocumentPosition","bitmask","ancestryA","getAncestry","ancestryB","oldestA","lastItem","oldestB","mutualAncestor","fragmentA","fragmentB","indexA","indexB","fragments","getParent","ancestry","ancestor","getOptions","wrap$1","force","needsSuper$1","unwrap","addRegistries","addOtherOptions","addRegistry","needsSuper","extendOne","subClass","superClass","TypeError","setPrototypeOf","Constructor","window","document","hasConsole","navigator","appName","warn","log","printWarning","implementation","hasFeature","refPattern","alreadyWarned","welcomeIntro","welcomeMessage","hasGroup","_Promise","deprecations","replacement","arg","PENDING","FULFILLED","REJECTED","dispatchHandlers","makeResolver","reject","fulfilledHandlers","rejectedHandlers","state","newState","makeDispatcher","wait","onFulfilled","onRejected","promise2","processResolutionHandler","forward","p1result","promises","processPromise","reason","TransitionManager","intros","outros","totalChildren","outroChildren","detachQueue","decoratorQueue","outrosComplete","addChild","list","addDecorator","decrementOutros","check","decrementTotal","detachNodes","_detachNodes","ready","changeHook","batch","returnPromise","previousBatch","transitionManager","tasks","immediateObservers","deferredObservers","flushChanges","addToArray","registerDecorator","task","postRender","_batch","updateHook","arrayProto","unrenderHook$1","badArguments","teardownHook","errorMessage$1","mathml","xlink","xml","namespaces","ns","createElementNS","global","factory","exports","module","define","amd","parts","format","_len2","_key2","warnOnce","_len3","_key3","isFinite","arrayLike","called","resolvePromise","rejectPromise","y","tm","spliceArguments","removeStart","removeEnd","balance","getSpliceEquivalent","touchedFrom","output","getElementById","removeChild","sources","tag","readNumberLiteral$1","readBooleanLiteral","okQuote","literal","done","next","charCodeAt","readKey","token","readKeyValuePair","refKey","k","readKeyValuePairs","pairs","keyValuePairs","readObjectLiteral","readExpressionList","expr","expressions","readArrayLiteral","expressionList","readNumberLiteral","readLiteral","readReference","startPos","prefix","lastDotIndex","relaxedNames","lastIndexOf","readBracketedExpression","readPrimary","readRefinement","strictRefinement","refinement","getConditional","ifTrue","ifFalse","readExpressionOrReference","expectedFollowers","flattenExpression","extractRefs","refineExpression","mustache","referenceExpression","getReferenceExpression","rx","yielder","readClosing","closing","readElse","readElseIf","section","hasElse","block","unlessBlock","conditions","closed","expectedClose","extra","createUnlessBlock","combine$2","invert","parensIfNecessary","triple","getLowestIndex","needles","lowest","entity","code","fromCharCode","validateCode","disallowed","barrier","inside","inAttribute","stripStandalones","backOne","backTwo","lastSectionItem","isString","isComment","isSection","trimWhitespace","leadingPattern","trailingPattern","removeLeadingWhitespace","removeTrailingWhitespace","previousItem","preserveWhitespaceInsideFragment","removeLeadingWhitespaceInsideFragment","removeTrailingWhitespaceInsideFragment","isPreserveWhitespaceElement","readDelimiterChange","opening","readMustacheOfType","reader","rewind","readClosingTag","readAttribute","attr","readAttributeValue","valueStart","startDepth","readQuotedAttributeValue","readUnquotedAttributeValue","readUnquotedAttributeValueToken","text","tokens","quoteMark","readQuotedStringToken","processDirective","parentParser","colonIndex","directiveName","directiveArgs","addProxyEvent","selfClosing","hasPartials","closingTag","lowerCaseName","canContain","closingTagName","endIndex","comment","escapeRegExp","endPattern","helper","noThrow","textContent","val","initial","existingPartials","newPartials","overwrite","badReference","localViewmodel","hasContextChain","crossedComponentBoundary","repeater","prefixKeypath","rootKeypath","rootDot","relativeKeypath","registryName","getPartialFromRegistry","findParentPartial","findOwner","findConstructor","hasIndexRef","selectedOption","element$1","selectedIndex","firstChild","namespacePrefix","updateId","updateMultipleSelectValue"],"mappings":"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"}