{"version":3,"file":"ractive-legacy.min.js","sources":["ractive-legacy.js"],"sourcesContent":["/*\n\tRactive.js v0.8.0-edge\n\tMon Nov 02 2015 01:13:59 GMT+0000 (UTC) - commit 29d309a06576970aae6525bd8d25c7f912df4419\n\n\thttp://ractivejs.org\n\thttp://twitter.com/RactiveJS\n\n\tReleased under the MIT License.\n*/\n\n\n(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n  typeof define === 'function' && define.amd ? define(factory) :\n  global.Ractive = factory();\n}(this, function () { 'use strict';\n\nvar inherits = function (subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass);\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      enumerable: false,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n};\n\nvar defineProperty = function (obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n};\n\nvar classCallCheck = function (instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n};\n\n  /*global console, navigator */\n\n  var win = typeof window !== 'undefined' ? window : null;\n  var doc = win ? document : null;\n\n  var isClient = !!doc;\n  var isJsdom = typeof navigator !== 'undefined' && /jsDom/.test(navigator.appName);\n  var hasConsole = typeof console !== 'undefined' && typeof console.warn === 'function' && typeof console.warn.apply === 'function';\n\n  var magicSupported = undefined;\n  try {\n  \tObject.defineProperty({}, 'test', { value: 0 });\n  \tmagicSupported = true;\n  } catch (e) {\n  \tmagicSupported = false;\n  }\n\n  var svg = doc ? doc.implementation.hasFeature('http://www.w3.org/TR/SVG11/feature#BasicStructure', '1.1') : false;\n\n  var vendors = ['o', 'ms', 'moz', 'webkit'];\n\n  var defaults = {\n  \t// render placement:\n  \tel: void 0,\n  \tappend: false,\n\n  \t// template:\n  \ttemplate: null,\n\n  \t// parse:\n  \tpreserveWhitespace: false,\n  \tsanitize: false,\n  \tstripComments: true,\n  \tdelimiters: ['{{', '}}'],\n  \ttripleDelimiters: ['{{{', '}}}'],\n  \tstaticDelimiters: ['[[', ']]'],\n  \tstaticTripleDelimiters: ['[[[', ']]]'],\n  \tinterpolate: false,\n\n  \t// data & binding:\n  \tdata: {},\n  \tcomputed: {},\n  \tmagic: false,\n  \tmodifyArrays: true,\n  \tadapt: [],\n  \tisolated: false,\n  \ttwoway: true,\n  \tlazy: false,\n\n  \t// transitions:\n  \tnoIntro: false,\n  \ttransitionsEnabled: true,\n  \tcomplete: void 0,\n\n  \t// css:\n  \tcss: null,\n  \tnoCssTransform: false\n  };\n\n  var refPattern = /\\[\\s*(\\*|[0-9]|[1-9][0-9]+)\\s*\\]/g;\n  var splitPattern = /([^\\\\](?:\\\\\\\\)*)\\./;\n  var escapeKeyPattern = /\\\\|\\./g;\n  var unescapeKeyPattern = /((?:\\\\)+)\\1|\\\\(\\.)/g;\n\n  function escapeKey(key) {\n  \tif (typeof key === 'string') {\n  \t\treturn key.replace(escapeKeyPattern, '\\\\$&');\n  \t}\n\n  \treturn key;\n  }\n\n  function normalise(ref) {\n  \treturn ref ? ref.replace(refPattern, '.$1') : '';\n  }\n\n  function splitKeypath(keypath) {\n  \tvar parts = normalise(keypath).split(splitPattern),\n  \t    result = [];\n\n  \tfor (var i = 0; i < parts.length; i += 2) {\n  \t\tresult.push(parts[i] + (parts[i + 1] || ''));\n  \t}\n\n  \treturn result;\n  }\n\n  function unescapeKey(key) {\n  \tif (typeof key === 'string') {\n  \t\treturn key.replace(unescapeKeyPattern, '$1$2');\n  \t}\n\n  \treturn key;\n  }\n\n  function noop () {}\n\n  var alreadyWarned = {};\n  var log;\n  var printWarning;\n  var welcome;\n  if (hasConsole) {\n  \t(function () {\n  \t\tvar welcomeIntro = ['%cRactive.js %c0.8.0-edge %cin debug mode, %cmore...', 'color: rgb(114, 157, 52); font-weight: normal;', 'color: rgb(85, 85, 85); font-weight: normal;', 'color: rgb(85, 85, 85); font-weight: normal;', 'color: rgb(82, 140, 224); font-weight: normal; text-decoration: underline;'];\n  \t\tvar welcomeMessage = 'You\\'re running Ractive 0.8.0-edge in debug mode - messages will be printed to the console to help you fix problems and optimise your application.\\n\\nTo disable debug mode, add this line at the start of your app:\\n  Ractive.DEBUG = false;\\n\\nTo disable debug mode when your app is minified, add this snippet:\\n  Ractive.DEBUG = /unminified/.test(function(){/*unminified*/});\\n\\nGet help and support:\\n  http://docs.ractivejs.org\\n  http://stackoverflow.com/questions/tagged/ractivejs\\n  http://groups.google.com/forum/#!forum/ractive-js\\n  http://twitter.com/ractivejs\\n\\nFound a bug? Raise an issue:\\n  https://github.com/ractivejs/ractive/issues\\n\\n';\n\n  \t\twelcome = function () {\n  \t\t\tvar hasGroup = !!console.groupCollapsed;\n  \t\t\tconsole[hasGroup ? 'groupCollapsed' : 'log'].apply(console, welcomeIntro);\n  \t\t\tconsole.log(welcomeMessage);\n  \t\t\tif (hasGroup) {\n  \t\t\t\tconsole.groupEnd(welcomeIntro);\n  \t\t\t}\n\n  \t\t\twelcome = noop;\n  \t\t};\n\n  \t\tprintWarning = function (message, args) {\n  \t\t\twelcome();\n\n  \t\t\t// extract information about the instance this message pertains to, if applicable\n  \t\t\tif (typeof args[args.length - 1] === 'object') {\n  \t\t\t\tvar options = args.pop();\n  \t\t\t\tvar ractive = options ? options.ractive : null;\n\n  \t\t\t\tif (ractive) {\n  \t\t\t\t\t// if this is an instance of a component that we know the name of, add\n  \t\t\t\t\t// it to the message\n  \t\t\t\t\tvar _name = undefined;\n  \t\t\t\t\tif (ractive.component && (_name = ractive.component.name)) {\n  \t\t\t\t\t\tmessage = '<' + _name + '> ' + message;\n  \t\t\t\t\t}\n\n  \t\t\t\t\tvar node = undefined;\n  \t\t\t\t\tif (node = options.node || ractive.fragment && ractive.fragment.rendered && ractive.find('*')) {\n  \t\t\t\t\t\targs.push(node);\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\tconsole.warn.apply(console, ['%cRactive.js: %c' + message, 'color: rgb(114, 157, 52);', 'color: rgb(85, 85, 85);'].concat(args));\n  \t\t};\n\n  \t\tlog = function () {\n  \t\t\tconsole.log.apply(console, arguments);\n  \t\t};\n  \t})();\n  } else {\n  \tprintWarning = log = welcome = noop;\n  }\n\n  function format(message, args) {\n  \treturn message.replace(/%s/g, function () {\n  \t\treturn args.shift();\n  \t});\n  }\n\n  function fatal(message) {\n  \tfor (var _len = arguments.length, args = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n  \t\targs[_key - 1] = arguments[_key];\n  \t}\n\n  \tmessage = format(message, args);\n  \tthrow new Error(message);\n  }\n\n  function logIfDebug() {\n  \tif (Ractive.DEBUG) {\n  \t\tlog.apply(null, arguments);\n  \t}\n  }\n\n  function warn(message) {\n  \tfor (var _len2 = arguments.length, args = Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {\n  \t\targs[_key2 - 1] = arguments[_key2];\n  \t}\n\n  \tmessage = format(message, args);\n  \tprintWarning(message, args);\n  }\n\n  function warnOnce(message) {\n  \tfor (var _len3 = arguments.length, args = Array(_len3 > 1 ? _len3 - 1 : 0), _key3 = 1; _key3 < _len3; _key3++) {\n  \t\targs[_key3 - 1] = arguments[_key3];\n  \t}\n\n  \tmessage = format(message, args);\n\n  \tif (alreadyWarned[message]) {\n  \t\treturn;\n  \t}\n\n  \talreadyWarned[message] = true;\n  \tprintWarning(message, args);\n  }\n\n  function warnIfDebug() {\n  \tif (Ractive.DEBUG) {\n  \t\twarn.apply(null, arguments);\n  \t}\n  }\n\n  function warnOnceIfDebug() {\n  \tif (Ractive.DEBUG) {\n  \t\twarnOnce.apply(null, arguments);\n  \t}\n  }\n\n  // TODO: deprecate in future release\n  var deprecations = {\n  \tconstruct: {\n  \t\tdeprecated: 'beforeInit',\n  \t\treplacement: 'onconstruct'\n  \t},\n  \trender: {\n  \t\tdeprecated: 'init',\n  \t\tmessage: 'The \"init\" method has been deprecated ' + 'and will likely be removed in a future release. ' + 'You can either use the \"oninit\" method which will fire ' + 'only once prior to, and regardless of, any eventual ractive ' + 'instance being rendered, or if you need to access the ' + 'rendered DOM, use \"onrender\" instead. ' + 'See http://docs.ractivejs.org/latest/migrating for more information.'\n  \t},\n  \tcomplete: {\n  \t\tdeprecated: 'complete',\n  \t\treplacement: 'oncomplete'\n  \t}\n  };\n\n  var Hook = (function () {\n  \tfunction Hook(event) {\n  \t\tclassCallCheck(this, Hook);\n\n  \t\tthis.event = event;\n  \t\tthis.method = 'on' + event;\n  \t\tthis.deprecate = deprecations[event];\n  \t}\n\n  \tHook.prototype.call = function call(method, ractive, arg) {\n  \t\tif (ractive[method]) {\n  \t\t\targ ? ractive[method](arg) : ractive[method]();\n  \t\t\treturn true;\n  \t\t}\n  \t};\n\n  \tHook.prototype.fire = function fire(ractive, arg) {\n  \t\tthis.call(this.method, ractive, arg);\n\n  \t\t// handle deprecations\n  \t\tif (!ractive[this.method] && this.deprecate && this.call(this.deprecate.deprecated, ractive, arg)) {\n  \t\t\tif (this.deprecate.message) {\n  \t\t\t\twarnIfDebug(this.deprecate.message);\n  \t\t\t} else {\n  \t\t\t\twarnIfDebug('The method \"%s\" has been deprecated in favor of \"%s\" and will likely be removed in a future release. See http://docs.ractivejs.org/latest/migrating for more information.', this.deprecate.deprecated, this.deprecate.replacement);\n  \t\t\t}\n  \t\t}\n\n  \t\t// TODO should probably use internal method, in case ractive.fire was overwritten\n  \t\targ ? ractive.fire(this.event, arg) : ractive.fire(this.event);\n  \t};\n\n  \treturn Hook;\n  })();\n\n  var toString = Object.prototype.toString;\n  // thanks, http://perfectionkills.com/instanceof-considered-harmful-or-how-to-write-a-robust-isarray/\n\n  function isArray(thing) {\n  \treturn toString.call(thing) === '[object Array]';\n  }\n\n  function isEqual(a, b) {\n  \tif (a === null && b === null) {\n  \t\treturn true;\n  \t}\n\n  \tif (typeof a === 'object' || typeof b === 'object') {\n  \t\treturn false;\n  \t}\n\n  \treturn a === b;\n  }\n\n  // http://stackoverflow.com/questions/18082/validate-numbers-in-javascript-isnumeric\n\n  function isNumeric(thing) {\n  \treturn !isNaN(parseFloat(thing)) && isFinite(thing);\n  }\n\n  function isObject(thing) {\n  \treturn thing && toString.call(thing) === '[object Object]';\n  }\n\n  function addToArray(array, value) {\n  \tvar index = array.indexOf(value);\n\n  \tif (index === -1) {\n  \t\tarray.push(value);\n  \t}\n  }\n\n  function arrayContains(array, value) {\n  \tfor (var i = 0, c = array.length; i < c; i++) {\n  \t\tif (array[i] == value) {\n  \t\t\treturn true;\n  \t\t}\n  \t}\n\n  \treturn false;\n  }\n\n  function arrayContentsMatch(a, b) {\n  \tvar i;\n\n  \tif (!isArray(a) || !isArray(b)) {\n  \t\treturn false;\n  \t}\n\n  \tif (a.length !== b.length) {\n  \t\treturn false;\n  \t}\n\n  \ti = a.length;\n  \twhile (i--) {\n  \t\tif (a[i] !== b[i]) {\n  \t\t\treturn false;\n  \t\t}\n  \t}\n\n  \treturn true;\n  }\n\n  function ensureArray(x) {\n  \tif (typeof x === 'string') {\n  \t\treturn [x];\n  \t}\n\n  \tif (x === undefined) {\n  \t\treturn [];\n  \t}\n\n  \treturn x;\n  }\n\n  function lastItem(array) {\n  \treturn array[array.length - 1];\n  }\n\n  function removeFromArray(array, member) {\n  \tif (!array) {\n  \t\treturn;\n  \t}\n\n  \tvar index = array.indexOf(member);\n\n  \tif (index !== -1) {\n  \t\tarray.splice(index, 1);\n  \t}\n  }\n\n  function toArray(arrayLike) {\n  \tvar array = [],\n  \t    i = arrayLike.length;\n  \twhile (i--) {\n  \t\tarray[i] = arrayLike[i];\n  \t}\n\n  \treturn array;\n  }\n\n  var _Promise;\n  var PENDING = {};\n  var FULFILLED = {};\n  var REJECTED = {};\n  if (typeof Promise === 'function') {\n  \t// use native Promise\n  \t_Promise = Promise;\n  } else {\n  \t_Promise = function (callback) {\n  \t\tvar fulfilledHandlers = [],\n  \t\t    rejectedHandlers = [],\n  \t\t    state = PENDING,\n  \t\t    result,\n  \t\t    dispatchHandlers,\n  \t\t    makeResolver,\n  \t\t    fulfil,\n  \t\t    reject,\n  \t\t    promise;\n\n  \t\tmakeResolver = function (newState) {\n  \t\t\treturn function (value) {\n  \t\t\t\tif (state !== PENDING) {\n  \t\t\t\t\treturn;\n  \t\t\t\t}\n\n  \t\t\t\tresult = value;\n  \t\t\t\tstate = newState;\n\n  \t\t\t\tdispatchHandlers = makeDispatcher(state === FULFILLED ? fulfilledHandlers : rejectedHandlers, result);\n\n  \t\t\t\t// dispatch onFulfilled and onRejected handlers asynchronously\n  \t\t\t\twait(dispatchHandlers);\n  \t\t\t};\n  \t\t};\n\n  \t\tfulfil = makeResolver(FULFILLED);\n  \t\treject = makeResolver(REJECTED);\n\n  \t\ttry {\n  \t\t\tcallback(fulfil, reject);\n  \t\t} catch (err) {\n  \t\t\treject(err);\n  \t\t}\n\n  \t\tpromise = {\n  \t\t\t// `then()` returns a Promise - 2.2.7\n  \t\t\tthen: function (onFulfilled, onRejected) {\n  \t\t\t\tvar promise2 = new _Promise(function (fulfil, reject) {\n\n  \t\t\t\t\tvar processResolutionHandler = function (handler, handlers, forward) {\n\n  \t\t\t\t\t\t// 2.2.1.1\n  \t\t\t\t\t\tif (typeof handler === 'function') {\n  \t\t\t\t\t\t\thandlers.push(function (p1result) {\n  \t\t\t\t\t\t\t\tvar x;\n\n  \t\t\t\t\t\t\t\ttry {\n  \t\t\t\t\t\t\t\t\tx = handler(p1result);\n  \t\t\t\t\t\t\t\t\tresolve(promise2, x, fulfil, reject);\n  \t\t\t\t\t\t\t\t} catch (err) {\n  \t\t\t\t\t\t\t\t\treject(err);\n  \t\t\t\t\t\t\t\t}\n  \t\t\t\t\t\t\t});\n  \t\t\t\t\t\t} else {\n  \t\t\t\t\t\t\t// Forward the result of promise1 to promise2, if resolution handlers\n  \t\t\t\t\t\t\t// are not given\n  \t\t\t\t\t\t\thandlers.push(forward);\n  \t\t\t\t\t\t}\n  \t\t\t\t\t};\n\n  \t\t\t\t\t// 2.2\n  \t\t\t\t\tprocessResolutionHandler(onFulfilled, fulfilledHandlers, fulfil);\n  \t\t\t\t\tprocessResolutionHandler(onRejected, rejectedHandlers, reject);\n\n  \t\t\t\t\tif (state !== PENDING) {\n  \t\t\t\t\t\t// If the promise has resolved already, dispatch the appropriate handlers asynchronously\n  \t\t\t\t\t\twait(dispatchHandlers);\n  \t\t\t\t\t}\n  \t\t\t\t});\n\n  \t\t\t\treturn promise2;\n  \t\t\t}\n  \t\t};\n\n  \t\tpromise['catch'] = function (onRejected) {\n  \t\t\treturn this.then(null, onRejected);\n  \t\t};\n\n  \t\treturn promise;\n  \t};\n\n  \t_Promise.all = function (promises) {\n  \t\treturn new _Promise(function (fulfil, reject) {\n  \t\t\tvar result = [],\n  \t\t\t    pending,\n  \t\t\t    i,\n  \t\t\t    processPromise;\n\n  \t\t\tif (!promises.length) {\n  \t\t\t\tfulfil(result);\n  \t\t\t\treturn;\n  \t\t\t}\n\n  \t\t\tprocessPromise = function (promise, i) {\n  \t\t\t\tif (promise && typeof promise.then === 'function') {\n  \t\t\t\t\tpromise.then(function (value) {\n  \t\t\t\t\t\tresult[i] = value;\n  \t\t\t\t\t\t--pending || fulfil(result);\n  \t\t\t\t\t}, reject);\n  \t\t\t\t} else {\n  \t\t\t\t\tresult[i] = promise;\n  \t\t\t\t\t--pending || fulfil(result);\n  \t\t\t\t}\n  \t\t\t};\n\n  \t\t\tpending = i = promises.length;\n  \t\t\twhile (i--) {\n  \t\t\t\tprocessPromise(promises[i], i);\n  \t\t\t}\n  \t\t});\n  \t};\n\n  \t_Promise.resolve = function (value) {\n  \t\treturn new _Promise(function (fulfil) {\n  \t\t\tfulfil(value);\n  \t\t});\n  \t};\n\n  \t_Promise.reject = function (reason) {\n  \t\treturn new _Promise(function (fulfil, reject) {\n  \t\t\treject(reason);\n  \t\t});\n  \t};\n  }\n\n  var Promise$1 = _Promise;\n\n  // TODO use MutationObservers or something to simulate setImmediate\n  function wait(callback) {\n  \tsetTimeout(callback, 0);\n  }\n\n  function makeDispatcher(handlers, result) {\n  \treturn function () {\n  \t\tvar handler;\n\n  \t\twhile (handler = handlers.shift()) {\n  \t\t\thandler(result);\n  \t\t}\n  \t};\n  }\n\n  function resolve(promise, x, fulfil, reject) {\n  \t// Promise Resolution Procedure\n  \tvar then;\n\n  \t// 2.3.1\n  \tif (x === promise) {\n  \t\tthrow new TypeError('A promise\\'s fulfillment handler cannot return the same promise');\n  \t}\n\n  \t// 2.3.2\n  \tif (x instanceof _Promise) {\n  \t\tx.then(fulfil, reject);\n  \t}\n\n  \t// 2.3.3\n  \telse if (x && (typeof x === 'object' || typeof x === 'function')) {\n  \t\t\ttry {\n  \t\t\t\tthen = x.then; // 2.3.3.1\n  \t\t\t} catch (e) {\n  \t\t\t\treject(e); // 2.3.3.2\n  \t\t\t\treturn;\n  \t\t\t}\n\n  \t\t\t// 2.3.3.3\n  \t\t\tif (typeof then === 'function') {\n  \t\t\t\tvar called, resolvePromise, rejectPromise;\n\n  \t\t\t\tresolvePromise = function (y) {\n  \t\t\t\t\tif (called) {\n  \t\t\t\t\t\treturn;\n  \t\t\t\t\t}\n  \t\t\t\t\tcalled = true;\n  \t\t\t\t\tresolve(promise, y, fulfil, reject);\n  \t\t\t\t};\n\n  \t\t\t\trejectPromise = function (r) {\n  \t\t\t\t\tif (called) {\n  \t\t\t\t\t\treturn;\n  \t\t\t\t\t}\n  \t\t\t\t\tcalled = true;\n  \t\t\t\t\treject(r);\n  \t\t\t\t};\n\n  \t\t\t\ttry {\n  \t\t\t\t\tthen.call(x, resolvePromise, rejectPromise);\n  \t\t\t\t} catch (e) {\n  \t\t\t\t\tif (!called) {\n  \t\t\t\t\t\t// 2.3.3.3.4.1\n  \t\t\t\t\t\treject(e); // 2.3.3.3.4.2\n  \t\t\t\t\t\tcalled = true;\n  \t\t\t\t\t\treturn;\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t\t} else {\n  \t\t\t\tfulfil(x);\n  \t\t\t}\n  \t\t} else {\n  \t\t\tfulfil(x);\n  \t\t}\n  }\n\n  var TransitionManager = (function () {\n  \tfunction TransitionManager(callback, parent) {\n  \t\tclassCallCheck(this, TransitionManager);\n\n  \t\tthis.callback = callback;\n  \t\tthis.parent = parent;\n\n  \t\tthis.intros = [];\n  \t\tthis.outros = [];\n\n  \t\tthis.children = [];\n  \t\tthis.totalChildren = this.outroChildren = 0;\n\n  \t\tthis.detachQueue = [];\n  \t\tthis.outrosComplete = false;\n\n  \t\tif (parent) {\n  \t\t\tparent.addChild(this);\n  \t\t}\n  \t}\n\n  \tTransitionManager.prototype.add = function add(transition) {\n  \t\tvar list = transition.isIntro ? this.intros : this.outros;\n  \t\tlist.push(transition);\n  \t};\n\n  \tTransitionManager.prototype.addChild = function addChild(child) {\n  \t\tthis.children.push(child);\n\n  \t\tthis.totalChildren += 1;\n  \t\tthis.outroChildren += 1;\n  \t};\n\n  \tTransitionManager.prototype.decrementOutros = function decrementOutros() {\n  \t\tthis.outroChildren -= 1;\n  \t\tcheck(this);\n  \t};\n\n  \tTransitionManager.prototype.decrementTotal = function decrementTotal() {\n  \t\tthis.totalChildren -= 1;\n  \t\tcheck(this);\n  \t};\n\n  \tTransitionManager.prototype.detachNodes = function detachNodes() {\n  \t\tthis.detachQueue.forEach(detach);\n  \t\tthis.children.forEach(_detachNodes);\n  \t};\n\n  \tTransitionManager.prototype.remove = function remove(transition) {\n  \t\tvar list = transition.isIntro ? this.intros : this.outros;\n  \t\tremoveFromArray(list, transition);\n  \t\tcheck(this);\n  \t};\n\n  \tTransitionManager.prototype.start = function start() {\n  \t\tthis.intros.concat(this.outros).forEach(function (t) {\n  \t\t\treturn t.start();\n  \t\t});\n  \t\tthis.ready = true;\n  \t\tcheck(this);\n  \t};\n\n  \treturn TransitionManager;\n  })();\n\n  function detach(element) {\n  \telement.detach();\n  }\n\n  function _detachNodes(tm) {\n  \t// _ to avoid transpiler quirk\n  \ttm.detachNodes();\n  }\n\n  function check(tm) {\n  \tif (!tm.ready || tm.outros.length || tm.outroChildren) return;\n\n  \t// If all outros are complete, and we haven't already done this,\n  \t// we notify the parent if there is one, otherwise\n  \t// start detaching nodes\n  \tif (!tm.outrosComplete) {\n  \t\tif (tm.parent) {\n  \t\t\ttm.parent.decrementOutros(tm);\n  \t\t} else {\n  \t\t\ttm.detachNodes();\n  \t\t}\n\n  \t\ttm.outrosComplete = true;\n  \t}\n\n  \t// Once everything is done, we can notify parent transition\n  \t// manager and call the callback\n  \tif (!tm.intros.length && !tm.totalChildren) {\n  \t\tif (typeof tm.callback === 'function') {\n  \t\t\ttm.callback();\n  \t\t}\n\n  \t\tif (tm.parent) {\n  \t\t\ttm.parent.decrementTotal();\n  \t\t}\n  \t}\n  }\n\n  var changeHook = new Hook('change');\n\n  var batch = undefined;\n\n  var runloop = {\n  \tstart: function (instance, returnPromise) {\n  \t\tvar promise, fulfilPromise;\n\n  \t\tif (returnPromise) {\n  \t\t\tpromise = new Promise$1(function (f) {\n  \t\t\t\treturn fulfilPromise = f;\n  \t\t\t});\n  \t\t}\n\n  \t\tbatch = {\n  \t\t\tpreviousBatch: batch,\n  \t\t\ttransitionManager: new TransitionManager(fulfilPromise, batch && batch.transitionManager),\n  \t\t\tfragments: [],\n  \t\t\ttasks: [],\n  \t\t\timmediateObservers: [],\n  \t\t\tdeferredObservers: [],\n  \t\t\tinstance: instance\n  \t\t};\n\n  \t\treturn promise;\n  \t},\n\n  \tend: function () {\n  \t\tflushChanges();\n  \t\tbatch = batch.previousBatch;\n  \t},\n\n  \taddFragment: function (fragment) {\n  \t\taddToArray(batch.fragments, fragment);\n  \t},\n\n  \taddObserver: function (observer, defer) {\n  \t\taddToArray(defer ? batch.deferredObservers : batch.immediateObservers, observer);\n  \t},\n\n  \tregisterTransition: function (transition) {\n  \t\ttransition._manager = batch.transitionManager;\n  \t\tbatch.transitionManager.add(transition);\n  \t},\n\n  \t// synchronise node detachments with transition ends\n  \tdetachWhenReady: function (thing) {\n  \t\tbatch.transitionManager.detachQueue.push(thing);\n  \t},\n\n  \tscheduleTask: function (task, postRender) {\n  \t\tvar _batch;\n\n  \t\tif (!batch) {\n  \t\t\ttask();\n  \t\t} else {\n  \t\t\t_batch = batch;\n  \t\t\twhile (postRender && _batch.previousBatch) {\n  \t\t\t\t// this can't happen until the DOM has been fully updated\n  \t\t\t\t// otherwise in some situations (with components inside elements)\n  \t\t\t\t// transitions and decorators will initialise prematurely\n  \t\t\t\t_batch = _batch.previousBatch;\n  \t\t\t}\n\n  \t\t\t_batch.tasks.push(task);\n  \t\t}\n  \t}\n  };\n\n  function dispatch(observer) {\n  \tobserver.dispatch();\n  }\n\n  function flushChanges() {\n  \tbatch.immediateObservers.forEach(dispatch);\n\n  \t// Now that changes have been fully propagated, we can update the DOM\n  \t// and complete other tasks\n  \tvar i = batch.fragments.length;\n  \tvar fragment = undefined;\n\n  \twhile (i--) {\n  \t\tfragment = batch.fragments[i];\n\n  \t\t// TODO deprecate this. It's annoying and serves no useful function\n  \t\tvar ractive = fragment.ractive;\n  \t\tchangeHook.fire(ractive, ractive.viewmodel.changes);\n  \t\tractive.viewmodel.changes = {};\n\n  \t\tfragment.update();\n  \t}\n  \tbatch.fragments.length = 0;\n\n  \tbatch.transitionManager.start();\n\n  \tbatch.deferredObservers.forEach(dispatch);\n\n  \tvar tasks = batch.tasks;\n  \tbatch.tasks = [];\n\n  \tfor (i = 0; i < tasks.length; i += 1) {\n  \t\ttasks[i]();\n  \t}\n\n  \t// If updating the view caused some model blowback - e.g. a triple\n  \t// containing <option> elements caused the binding on the <select>\n  \t// to update - then we start over\n  \tif (batch.fragments.length) return flushChanges();\n  }\n\n  function Ractive$updateModel(keypath, cascade) {\n  \tvar promise = runloop.start(this, true);\n\n  \tif (!keypath) {\n  \t\tthis.viewmodel.updateFromBindings(true);\n  \t} else {\n  \t\tthis.viewmodel.joinAll(splitKeypath(keypath)).updateFromBindings(cascade !== false);\n  \t}\n\n  \trunloop.end();\n\n  \treturn promise;\n  }\n\n  var updateHook = new Hook('update');\n  function Ractive$update(keypath) {\n  \tvar model = keypath ? this.viewmodel.joinAll(splitKeypath(keypath)) : this.viewmodel;\n\n  \tvar promise = runloop.start(this, true);\n  \tmodel.mark();\n  \trunloop.end();\n\n  \tupdateHook.fire(this, model);\n\n  \treturn promise;\n  }\n\n  // This function takes an array, the name of a mutator method, and the\n  // arguments to call that mutator method with, and returns an array that\n  // maps the old indices to their new indices.\n\n  // So if you had something like this...\n  //\n  //     array = [ 'a', 'b', 'c', 'd' ];\n  //     array.push( 'e' );\n  //\n  // ...you'd get `[ 0, 1, 2, 3 ]` - in other words, none of the old indices\n  // have changed. If you then did this...\n  //\n  //     array.unshift( 'z' );\n  //\n  // ...the indices would be `[ 1, 2, 3, 4, 5 ]` - every item has been moved\n  // one higher to make room for the 'z'. If you removed an item, the new index\n  // would be -1...\n  //\n  //     array.splice( 2, 2 );\n  //\n  // ...this would result in [ 0, 1, -1, -1, 2, 3 ].\n  //\n  // This information is used to enable fast, non-destructive shuffling of list\n  // sections when you do e.g. `ractive.splice( 'items', 2, 2 );\n\n  function getNewIndices(length, methodName, args) {\n  \tvar spliceArguments,\n  \t    newIndices = [],\n  \t    removeStart,\n  \t    removeEnd,\n  \t    balance,\n  \t    i;\n\n  \tspliceArguments = getSpliceEquivalent(length, methodName, args);\n\n  \tif (!spliceArguments) {\n  \t\treturn null; // TODO support reverse and sort?\n  \t}\n\n  \tbalance = spliceArguments.length - 2 - spliceArguments[1];\n\n  \tremoveStart = Math.min(length, spliceArguments[0]);\n  \tremoveEnd = removeStart + spliceArguments[1];\n\n  \tfor (i = 0; i < removeStart; i += 1) {\n  \t\tnewIndices.push(i);\n  \t}\n\n  \tfor (; i < removeEnd; i += 1) {\n  \t\tnewIndices.push(-1);\n  \t}\n\n  \tfor (; i < length; i += 1) {\n  \t\tnewIndices.push(i + balance);\n  \t}\n\n  \t// there is a net shift for the rest of the array starting with index + balance\n  \tif (balance !== 0) {\n  \t\tnewIndices.touchedFrom = spliceArguments[0];\n  \t} else {\n  \t\tnewIndices.touchedFrom = length;\n  \t}\n\n  \treturn newIndices;\n  }\n\n  // The pop, push, shift an unshift methods can all be represented\n  // as an equivalent splice\n  function getSpliceEquivalent(length, methodName, args) {\n  \tswitch (methodName) {\n  \t\tcase 'splice':\n  \t\t\tif (args[0] !== undefined && args[0] < 0) {\n  \t\t\t\targs[0] = length + Math.max(args[0], -length);\n  \t\t\t}\n\n  \t\t\twhile (args.length < 2) {\n  \t\t\t\targs.push(length - args[0]);\n  \t\t\t}\n\n  \t\t\t// ensure we only remove elements that exist\n  \t\t\targs[1] = Math.min(args[1], length - args[0]);\n\n  \t\t\treturn args;\n\n  \t\tcase 'sort':\n  \t\tcase 'reverse':\n  \t\t\treturn null;\n\n  \t\tcase 'pop':\n  \t\t\tif (length) {\n  \t\t\t\treturn [length - 1, 1];\n  \t\t\t}\n  \t\t\treturn [0, 0];\n\n  \t\tcase 'push':\n  \t\t\treturn [length, 0].concat(args);\n\n  \t\tcase 'shift':\n  \t\t\treturn [0, length ? 1 : 0];\n\n  \t\tcase 'unshift':\n  \t\t\treturn [0, 0].concat(args);\n  \t}\n  }\n\n  var arrayProto = Array.prototype;\n\n  function makeArrayMethod (methodName) {\n  \treturn function (keypath) {\n  \t\tvar model = this.viewmodel.joinAll(splitKeypath(keypath));\n  \t\tvar array = model.get();\n\n  \t\tif (!isArray(array)) {\n  \t\t\tthrow new Error('shuffle array method ' + methodName + ' called on non-array at ' + model.getKeypath());\n  \t\t}\n\n  \t\tfor (var _len = arguments.length, args = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n  \t\t\targs[_key - 1] = arguments[_key];\n  \t\t}\n\n  \t\tvar newIndices = getNewIndices(array.length, methodName, args);\n  \t\tvar result = arrayProto[methodName].apply(array, args);\n\n  \t\tvar promise = runloop.start(this, true).then(function () {\n  \t\t\treturn result;\n  \t\t});\n\n  \t\tif (newIndices) {\n  \t\t\tmodel.shuffle(newIndices);\n  \t\t} else {\n  \t\t\tmodel.set(result);\n  \t\t}\n\n  \t\trunloop.end();\n\n  \t\treturn promise;\n  \t};\n  }\n\n  var unshift = makeArrayMethod('unshift');\n\n  var unrenderHook$1 = new Hook('unrender');\n  function Ractive$unrender() {\n  \tif (!this.fragment.rendered) {\n  \t\twarnIfDebug('ractive.unrender() was called on a Ractive instance that was not rendered');\n  \t\treturn Promise$1.resolve();\n  \t}\n\n  \tvar promise = runloop.start(this, true);\n\n  \t// If this is a component, and the component isn't marked for destruction,\n  \t// don't detach nodes from the DOM unnecessarily\n  \tvar shouldDestroy = !this.component || this.component.shouldDestroy || this.shouldDestroy;\n  \tthis.fragment.unrender(shouldDestroy);\n\n  \tremoveFromArray(this.el.__ractive_instances__, this);\n\n  \tunrenderHook$1.fire(this);\n\n  \trunloop.end();\n  \treturn promise;\n  }\n\n  function Ractive$toHTML() {\n  \treturn this.fragment.toString(true);\n  }\n\n  // Error messages that are used (or could be) in multiple places\n  var badArguments = 'Bad arguments';\n  var noRegistryFunctionReturn = 'A function was specified for \"%s\" %s, but no %s was returned';\n  var missingPlugin = function (name, type) {\n    return 'Missing \"' + name + '\" ' + type + ' plugin. You may need to download a plugin via http://docs.ractivejs.org/latest/plugins#' + type + 's';\n  };\n\n  function Ractive$toggle(keypath) {\n  \tif (typeof keypath !== 'string') {\n  \t\tthrow new TypeError(badArguments);\n  \t}\n\n  \tvar changes = undefined;\n\n  \tif (/\\*/.test(keypath)) {\n  \t\tchanges = {};\n\n  \t\tthis.viewmodel.findMatches(splitKeypath(keypath)).forEach(function (model) {\n  \t\t\tchanges[model.getKeypath()] = !model.get();\n  \t\t});\n\n  \t\treturn this.set(changes);\n  \t}\n\n  \treturn this.set(keypath, !this.get(keypath));\n  }\n\n  function _bind(x) {\n    x.bind();\n  }\n\n  function cancel(x) {\n    x.cancel();\n  }\n\n  function _handleChange(x) {\n    x.handleChange();\n  }\n\n  function _mark(x) {\n    x.mark();\n  }\n\n  function _render(x) {\n    x.render();\n  }\n\n  function _rebind(x) {\n    x.rebind();\n  }\n\n  function _teardown(x) {\n    x.teardown();\n  }\n\n  function _unbind(x) {\n    x.unbind();\n  }\n\n  function _unrender(x) {\n    x.unrender();\n  }\n\n  function unrenderAndDestroy$1(x) {\n    x.unrender(true);\n  }\n\n  function _update(x) {\n    x.update();\n  }\n\n  function _toString(x) {\n    return x.toString();\n  }\n\n  function toEscapedString(x) {\n    return x.toString(true);\n  }\n\n  var teardownHook = new Hook('teardown');\n\n  // Teardown. This goes through the root fragment and all its children, removing observers\n  // and generally cleaning up after itself\n\n  function Ractive$teardown() {\n  \tthis.fragment.unbind();\n  \tthis.viewmodel.teardown();\n\n  \tthis._observers.forEach(cancel);\n\n  \tif (this.fragment.rendered && this.el.__ractive_instances__) {\n  \t\tremoveFromArray(this.el.__ractive_instances__, this);\n  \t}\n\n  \tthis.shouldDestroy = true;\n  \tvar promise = this.fragment.rendered ? this.unrender() : Promise$1.resolve();\n\n  \tteardownHook.fire(this);\n\n  \treturn promise;\n  }\n\n  var errorMessage$1 = 'Cannot add to a non-numeric value';\n  function add(ractive, keypath, d) {\n  \tif (typeof keypath !== 'string' || !isNumeric(d)) {\n  \t\tthrow new Error('Bad arguments');\n  \t}\n\n  \tvar changes = undefined;\n\n  \tif (/\\*/.test(keypath)) {\n  \t\tchanges = {};\n\n  \t\tractive.viewmodel.findMatches(splitKeypath(keypath)).forEach(function (model) {\n  \t\t\tvar value = model.get();\n\n  \t\t\tif (!isNumeric(value)) throw new Error(errorMessage$1);\n\n  \t\t\tchanges[model.getKeypath()] = value + d;\n  \t\t});\n\n  \t\treturn ractive.set(changes);\n  \t}\n\n  \tvar value = ractive.get(keypath);\n\n  \tif (!isNumeric(value)) {\n  \t\tthrow new Error(errorMessage$1);\n  \t}\n\n  \treturn ractive.set(keypath, +value + d);\n  }\n\n  function Ractive$subtract(keypath, d) {\n  \treturn add(this, keypath, d === undefined ? -1 : -d);\n  }\n\n  var splice = makeArrayMethod('splice');\n\n  var sort = makeArrayMethod('sort');\n\n  var shift = makeArrayMethod('shift');\n\n  function bind(fn, context) {\n  \tif (!/this/.test(fn.toString())) return fn;\n\n  \tvar bound = fn.bind(context);\n  \tfor (var prop in fn) {\n  \t\tbound[prop] = fn[prop];\n  \t}return bound;\n  }\n\n  function Ractive$set(keypath, value) {\n  \tvar promise = runloop.start(this, true);\n\n  \t// Set multiple keypaths in one go\n  \tif (isObject(keypath)) {\n  \t\tvar map = keypath;\n\n  \t\tfor (keypath in map) {\n  \t\t\tif (map.hasOwnProperty(keypath)) {\n  \t\t\t\tset(this, keypath, map[keypath]);\n  \t\t\t}\n  \t\t}\n  \t}\n  \t// Set a single keypath\n  \telse {\n  \t\t\tset(this, keypath, value);\n  \t\t}\n\n  \trunloop.end();\n\n  \treturn promise;\n  }\n\n  function set(ractive, keypath, value) {\n  \tif (typeof value === 'function') value = bind(value, ractive);\n\n  \tif (/\\*/.test(keypath)) {\n  \t\tractive.viewmodel.findMatches(splitKeypath(keypath)).forEach(function (model) {\n  \t\t\tmodel.set(value);\n  \t\t});\n  \t} else {\n  \t\tvar model = ractive.viewmodel.joinAll(splitKeypath(keypath));\n  \t\tmodel.set(value);\n  \t}\n  }\n\n  var reverse = makeArrayMethod('reverse');\n\n  var TEMPLATE_VERSION = 3;\n\n  var html = 'http://www.w3.org/1999/xhtml';\n  var mathml = 'http://www.w3.org/1998/Math/MathML';\n  var svg$1 = 'http://www.w3.org/2000/svg';\n  var xlink = 'http://www.w3.org/1999/xlink';\n  var xml = 'http://www.w3.org/XML/1998/namespace';\n  var xmlns = 'http://www.w3.org/2000/xmlns/';\n\n\n  var namespaces = {\n  \thtml: html,\n  \tmathml: mathml,\n  \tsvg: svg$1,\n  \txlink: xlink,\n  \txml: xml,\n  \txmlns: xmlns\n  };\n\n  var createElement;\n  var matches;\n  var div;\n  var methodNames;\n  var unprefixed;\n  var prefixed;\n  var i$1;\n  var j$1;\n  var makeFunction;\n  // Test for SVG support\n  if (!svg) {\n  \tcreateElement = function (type, ns, extend) {\n  \t\tif (ns && ns !== html) {\n  \t\t\tthrow 'This browser does not support namespaces other than http://www.w3.org/1999/xhtml. The most likely cause of this error is that you\\'re trying to render SVG in an older browser. See http://docs.ractivejs.org/latest/svg-and-older-browsers for more information';\n  \t\t}\n\n  \t\treturn extend ? doc.createElement(type, extend) : doc.createElement(type);\n  \t};\n  } else {\n  \tcreateElement = function (type, ns, extend) {\n  \t\tif (!ns || ns === html) {\n  \t\t\treturn extend ? doc.createElement(type, extend) : doc.createElement(type);\n  \t\t}\n\n  \t\treturn extend ? doc.createElementNS(ns, type, extend) : doc.createElementNS(ns, type);\n  \t};\n  }\n\n  function createDocumentFragment() {\n  \treturn doc.createDocumentFragment();\n  }\n\n  function getElement(input) {\n  \tvar output;\n\n  \tif (!input || typeof input === 'boolean') {\n  \t\treturn;\n  \t}\n\n  \tif (!win || !doc || !input) {\n  \t\treturn null;\n  \t}\n\n  \t// We already have a DOM node - no work to do. (Duck typing alert!)\n  \tif (input.nodeType) {\n  \t\treturn input;\n  \t}\n\n  \t// Get node from string\n  \tif (typeof input === 'string') {\n  \t\t// try ID first\n  \t\toutput = doc.getElementById(input);\n\n  \t\t// then as selector, if possible\n  \t\tif (!output && doc.querySelector) {\n  \t\t\toutput = doc.querySelector(input);\n  \t\t}\n\n  \t\t// did it work?\n  \t\tif (output && output.nodeType) {\n  \t\t\treturn output;\n  \t\t}\n  \t}\n\n  \t// If we've been given a collection (jQuery, Zepto etc), extract the first item\n  \tif (input[0] && input[0].nodeType) {\n  \t\treturn input[0];\n  \t}\n\n  \treturn null;\n  }\n\n  if (!isClient) {\n  \tmatches = null;\n  } else {\n  \tdiv = createElement('div');\n  \tmethodNames = ['matches', 'matchesSelector'];\n\n  \tmakeFunction = function (methodName) {\n  \t\treturn function (node, selector) {\n  \t\t\treturn node[methodName](selector);\n  \t\t};\n  \t};\n\n  \ti$1 = methodNames.length;\n\n  \twhile (i$1-- && !matches) {\n  \t\tunprefixed = methodNames[i$1];\n\n  \t\tif (div[unprefixed]) {\n  \t\t\tmatches = makeFunction(unprefixed);\n  \t\t} else {\n  \t\t\tj$1 = vendors.length;\n  \t\t\twhile (j$1--) {\n  \t\t\t\tprefixed = vendors[i$1] + unprefixed.substr(0, 1).toUpperCase() + unprefixed.substring(1);\n\n  \t\t\t\tif (div[prefixed]) {\n  \t\t\t\t\tmatches = makeFunction(prefixed);\n  \t\t\t\t\tbreak;\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \t// IE8...\n  \tif (!matches) {\n  \t\tmatches = function (node, selector) {\n  \t\t\tvar nodes, parentNode, i$1;\n\n  \t\t\tparentNode = node.parentNode;\n\n  \t\t\tif (!parentNode) {\n  \t\t\t\t// empty dummy <div>\n  \t\t\t\tdiv.innerHTML = '';\n\n  \t\t\t\tparentNode = div;\n  \t\t\t\tnode = node.cloneNode();\n\n  \t\t\t\tdiv.appendChild(node);\n  \t\t\t}\n\n  \t\t\tnodes = parentNode.querySelectorAll(selector);\n\n  \t\t\ti$1 = nodes.length;\n  \t\t\twhile (i$1--) {\n  \t\t\t\tif (nodes[i$1] === node) {\n  \t\t\t\t\treturn true;\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\treturn false;\n  \t\t};\n  \t}\n  }\n\n  function detachNode(node) {\n  \tif (node && typeof node.parentNode !== 'unknown' && node.parentNode) {\n  \t\tnode.parentNode.removeChild(node);\n  \t}\n\n  \treturn node;\n  }\n\n  function safeToStringValue(value) {\n  \treturn value == null || !value.toString ? '' : '' + value;\n  }\n\n  var exportedShims;\n\n  if (!win) {\n  \texportedShims = null;\n  } else {\n  \texportedShims = {};\n\n  \t// Shims for older browsers\n\n  \tif (!Date.now) {\n  \t\tDate.now = function () {\n  \t\t\treturn +new Date();\n  \t\t};\n  \t}\n\n  \tif (!String.prototype.trim) {\n  \t\tString.prototype.trim = function () {\n  \t\t\treturn this.replace(/^\\s+/, '').replace(/\\s+$/, '');\n  \t\t};\n  \t}\n\n  \t// Polyfill for Object.keys\n  \t// https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Object/keys\n  \tif (!Object.keys) {\n  \t\tObject.keys = (function () {\n  \t\t\tvar hasOwnProperty = Object.prototype.hasOwnProperty,\n  \t\t\t    hasDontEnumBug = !({ toString: null }).propertyIsEnumerable('toString'),\n  \t\t\t    dontEnums = ['toString', 'toLocaleString', 'valueOf', 'hasOwnProperty', 'isPrototypeOf', 'propertyIsEnumerable', 'constructor'],\n  \t\t\t    dontEnumsLength = dontEnums.length;\n\n  \t\t\treturn function (obj) {\n  \t\t\t\tif (typeof obj !== 'object' && typeof obj !== 'function' || obj === null) {\n  \t\t\t\t\tthrow new TypeError('Object.keys called on non-object');\n  \t\t\t\t}\n\n  \t\t\t\tvar result = [];\n\n  \t\t\t\tfor (var prop in obj) {\n  \t\t\t\t\tif (hasOwnProperty.call(obj, prop)) {\n  \t\t\t\t\t\tresult.push(prop);\n  \t\t\t\t\t}\n  \t\t\t\t}\n\n  \t\t\t\tif (hasDontEnumBug) {\n  \t\t\t\t\tfor (var i = 0; i < dontEnumsLength; i++) {\n  \t\t\t\t\t\tif (hasOwnProperty.call(obj, dontEnums[i])) {\n  \t\t\t\t\t\t\tresult.push(dontEnums[i]);\n  \t\t\t\t\t\t}\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t\t\treturn result;\n  \t\t\t};\n  \t\t})();\n  \t}\n\n  \t// TODO: use defineProperty to make these non-enumerable\n\n  \t// Array extras\n  \tif (!Array.prototype.indexOf) {\n  \t\tArray.prototype.indexOf = function (needle, i) {\n  \t\t\tvar len;\n\n  \t\t\tif (i === undefined) {\n  \t\t\t\ti = 0;\n  \t\t\t}\n\n  \t\t\tif (i < 0) {\n  \t\t\t\ti += this.length;\n  \t\t\t}\n\n  \t\t\tif (i < 0) {\n  \t\t\t\ti = 0;\n  \t\t\t}\n\n  \t\t\tfor (len = this.length; i < len; i++) {\n  \t\t\t\tif (this.hasOwnProperty(i) && this[i] === needle) {\n  \t\t\t\t\treturn i;\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\treturn -1;\n  \t\t};\n  \t}\n\n  \tif (!Array.prototype.forEach) {\n  \t\tArray.prototype.forEach = function (callback, context) {\n  \t\t\tvar i, len;\n\n  \t\t\tfor (i = 0, len = this.length; i < len; i += 1) {\n  \t\t\t\tif (this.hasOwnProperty(i)) {\n  \t\t\t\t\tcallback.call(context, this[i], i, this);\n  \t\t\t\t}\n  \t\t\t}\n  \t\t};\n  \t}\n\n  \tif (!Array.prototype.map) {\n  \t\tArray.prototype.map = function (mapper, context) {\n  \t\t\tvar array = this,\n  \t\t\t    i,\n  \t\t\t    len,\n  \t\t\t    mapped = [],\n  \t\t\t    isActuallyString;\n\n  \t\t\t// incredibly, if you do something like\n  \t\t\t// Array.prototype.map.call( someString, iterator )\n  \t\t\t// then `this` will become an instance of String in IE8.\n  \t\t\t// And in IE8, you then can't do string[i]. Facepalm.\n  \t\t\tif (array instanceof String) {\n  \t\t\t\tarray = array.toString();\n  \t\t\t\tisActuallyString = true;\n  \t\t\t}\n\n  \t\t\tfor (i = 0, len = array.length; i < len; i += 1) {\n  \t\t\t\tif (array.hasOwnProperty(i) || isActuallyString) {\n  \t\t\t\t\tmapped[i] = mapper.call(context, array[i], i, array);\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\treturn mapped;\n  \t\t};\n  \t}\n\n  \tif (typeof Array.prototype.reduce !== 'function') {\n  \t\tArray.prototype.reduce = function (callback, opt_initialValue) {\n  \t\t\tvar i, value, len, valueIsSet;\n\n  \t\t\tif ('function' !== typeof callback) {\n  \t\t\t\tthrow new TypeError(callback + ' is not a function');\n  \t\t\t}\n\n  \t\t\tlen = this.length;\n  \t\t\tvalueIsSet = false;\n\n  \t\t\tif (arguments.length > 1) {\n  \t\t\t\tvalue = opt_initialValue;\n  \t\t\t\tvalueIsSet = true;\n  \t\t\t}\n\n  \t\t\tfor (i = 0; i < len; i += 1) {\n  \t\t\t\tif (this.hasOwnProperty(i)) {\n  \t\t\t\t\tif (valueIsSet) {\n  \t\t\t\t\t\tvalue = callback(value, this[i], i, this);\n  \t\t\t\t\t}\n  \t\t\t\t} else {\n  \t\t\t\t\tvalue = this[i];\n  \t\t\t\t\tvalueIsSet = true;\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\tif (!valueIsSet) {\n  \t\t\t\tthrow new TypeError('Reduce of empty array with no initial value');\n  \t\t\t}\n\n  \t\t\treturn value;\n  \t\t};\n  \t}\n\n  \tif (!Array.prototype.filter) {\n  \t\tArray.prototype.filter = function (filter, context) {\n  \t\t\tvar i,\n  \t\t\t    len,\n  \t\t\t    filtered = [];\n\n  \t\t\tfor (i = 0, len = this.length; i < len; i += 1) {\n  \t\t\t\tif (this.hasOwnProperty(i) && filter.call(context, this[i], i, this)) {\n  \t\t\t\t\tfiltered[filtered.length] = this[i];\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\treturn filtered;\n  \t\t};\n  \t}\n\n  \tif (!Array.prototype.every) {\n  \t\tArray.prototype.every = function (iterator, context) {\n  \t\t\tvar t, len, i;\n\n  \t\t\tif (this == null) {\n  \t\t\t\tthrow new TypeError();\n  \t\t\t}\n\n  \t\t\tt = Object(this);\n  \t\t\tlen = t.length >>> 0;\n\n  \t\t\tif (typeof iterator !== 'function') {\n  \t\t\t\tthrow new TypeError();\n  \t\t\t}\n\n  \t\t\tfor (i = 0; i < len; i += 1) {\n  \t\t\t\tif (i in t && !iterator.call(context, t[i], i, t)) {\n  \t\t\t\t\treturn false;\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\treturn true;\n  \t\t};\n  \t}\n\n  \tif (typeof Function.prototype.bind !== 'function') {\n  \t\tFunction.prototype.bind = function (context) {\n  \t\t\tvar args,\n  \t\t\t    fn,\n  \t\t\t    Empty,\n  \t\t\t    bound,\n  \t\t\t    slice = [].slice;\n\n  \t\t\tif (typeof this !== 'function') {\n  \t\t\t\tthrow new TypeError('Function.prototype.bind called on non-function');\n  \t\t\t}\n\n  \t\t\targs = slice.call(arguments, 1);\n  \t\t\tfn = this;\n  \t\t\tEmpty = function () {};\n\n  \t\t\tbound = function () {\n  \t\t\t\tvar ctx = this instanceof Empty && context ? this : context;\n  \t\t\t\treturn fn.apply(ctx, args.concat(slice.call(arguments)));\n  \t\t\t};\n\n  \t\t\tEmpty.prototype = this.prototype;\n  \t\t\tbound.prototype = new Empty();\n\n  \t\t\treturn bound;\n  \t\t};\n  \t}\n\n  \t// https://gist.github.com/Rich-Harris/6010282 via https://gist.github.com/jonathantneal/2869388\n  \t// addEventListener polyfill IE6+\n  \tif (!win.addEventListener) {\n  \t\t(function (win, doc) {\n  \t\t\tvar Event, addEventListener, removeEventListener, head, style, origCreateElement;\n\n  \t\t\t// because sometimes inquiring minds want to know\n  \t\t\twin.appearsToBeIELessEqual8 = true;\n\n  \t\t\tEvent = function (e, element) {\n  \t\t\t\tvar property,\n  \t\t\t\t    instance = this;\n\n  \t\t\t\tfor (property in e) {\n  \t\t\t\t\tinstance[property] = e[property];\n  \t\t\t\t}\n\n  \t\t\t\tinstance.currentTarget = element;\n  \t\t\t\tinstance.target = e.srcElement || element;\n  \t\t\t\tinstance.timeStamp = +new Date();\n\n  \t\t\t\tinstance.preventDefault = function () {\n  \t\t\t\t\te.returnValue = false;\n  \t\t\t\t};\n\n  \t\t\t\tinstance.stopPropagation = function () {\n  \t\t\t\t\te.cancelBubble = true;\n  \t\t\t\t};\n  \t\t\t};\n\n  \t\t\taddEventListener = function (type, listener) {\n  \t\t\t\tvar element = this,\n  \t\t\t\t    listeners,\n  \t\t\t\t    i;\n\n  \t\t\t\tlisteners = element.listeners || (element.listeners = []);\n  \t\t\t\ti = listeners.length;\n\n  \t\t\t\tlisteners[i] = [listener, function (e) {\n  \t\t\t\t\tlistener.call(element, new Event(e, element));\n  \t\t\t\t}];\n\n  \t\t\t\telement.attachEvent('on' + type, listeners[i][1]);\n  \t\t\t};\n\n  \t\t\tremoveEventListener = function (type, listener) {\n  \t\t\t\tvar element = this,\n  \t\t\t\t    listeners,\n  \t\t\t\t    i;\n\n  \t\t\t\tif (!element.listeners) {\n  \t\t\t\t\treturn;\n  \t\t\t\t}\n\n  \t\t\t\tlisteners = element.listeners;\n  \t\t\t\ti = listeners.length;\n\n  \t\t\t\twhile (i--) {\n  \t\t\t\t\tif (listeners[i][0] === listener) {\n  \t\t\t\t\t\telement.detachEvent('on' + type, listeners[i][1]);\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t\t};\n\n  \t\t\twin.addEventListener = doc.addEventListener = addEventListener;\n  \t\t\twin.removeEventListener = doc.removeEventListener = removeEventListener;\n\n  \t\t\tif ('Element' in win) {\n  \t\t\t\twin.Element.prototype.addEventListener = addEventListener;\n  \t\t\t\twin.Element.prototype.removeEventListener = removeEventListener;\n  \t\t\t} else {\n  \t\t\t\t// First, intercept any calls to document.createElement - this is necessary\n  \t\t\t\t// because the CSS hack (see below) doesn't come into play until after a\n  \t\t\t\t// node is added to the DOM, which is too late for a lot of Ractive setup work\n  \t\t\t\torigCreateElement = doc.createElement;\n\n  \t\t\t\tdoc.createElement = function (tagName) {\n  \t\t\t\t\tvar el = origCreateElement(tagName);\n  \t\t\t\t\tel.addEventListener = addEventListener;\n  \t\t\t\t\tel.removeEventListener = removeEventListener;\n  \t\t\t\t\treturn el;\n  \t\t\t\t};\n\n  \t\t\t\t// Then, mop up any additional elements that weren't created via\n  \t\t\t\t// document.createElement (i.e. with innerHTML).\n  \t\t\t\thead = doc.getElementsByTagName('head')[0];\n  \t\t\t\tstyle = doc.createElement('style');\n\n  \t\t\t\thead.insertBefore(style, head.firstChild);\n\n  \t\t\t\t//style.styleSheet.cssText = '*{-ms-event-prototype:expression(!this.addEventListener&&(this.addEventListener=addEventListener)&&(this.removeEventListener=removeEventListener))}';\n  \t\t\t}\n  \t\t})(win, doc);\n  \t}\n\n  \t// The getComputedStyle polyfill interacts badly with jQuery, so we don't attach\n  \t// it to window. Instead, we export it for other modules to use as needed\n\n  \t// https://github.com/jonathantneal/Polyfills-for-IE8/blob/master/getComputedStyle.js\n  \tif (!win.getComputedStyle) {\n  \t\texportedShims.getComputedStyle = (function () {\n  \t\t\tvar borderSizes = {};\n\n  \t\t\tfunction getPixelSize(element, style, property, fontSize) {\n  \t\t\t\tvar sizeWithSuffix = style[property];\n  \t\t\t\tvar size = parseFloat(sizeWithSuffix);\n  \t\t\t\tvar suffix = sizeWithSuffix.split(/\\d/)[0];\n\n  \t\t\t\tif (isNaN(size)) {\n  \t\t\t\t\tif (/^thin|medium|thick$/.test(sizeWithSuffix)) {\n  \t\t\t\t\t\tsize = getBorderPixelSize(sizeWithSuffix);\n  \t\t\t\t\t\tsuffix = '';\n  \t\t\t\t\t} else {\n  \t\t\t\t\t\t// TODO...\n  \t\t\t\t\t}\n  \t\t\t\t}\n\n  \t\t\t\tfontSize = fontSize != null ? fontSize : /%|em/.test(suffix) && element.parentElement ? getPixelSize(element.parentElement, element.parentElement.currentStyle, 'fontSize', null) : 16;\n  \t\t\t\tvar rootSize = property == 'fontSize' ? fontSize : /width/i.test(property) ? element.clientWidth : element.clientHeight;\n\n  \t\t\t\treturn suffix == 'em' ? size * fontSize : suffix == 'in' ? size * 96 : suffix == 'pt' ? size * 96 / 72 : suffix == '%' ? size / 100 * rootSize : size;\n  \t\t\t}\n\n  \t\t\tfunction getBorderPixelSize(size) {\n  \t\t\t\tvar div, bcr;\n\n  \t\t\t\t// `thin`, `medium` and `thick` vary between browsers. (Don't ever use them.)\n  \t\t\t\tif (!borderSizes[size]) {\n  \t\t\t\t\tdiv = doc.createElement('div');\n  \t\t\t\t\tdiv.style.display = 'block';\n  \t\t\t\t\tdiv.style.position = 'fixed';\n  \t\t\t\t\tdiv.style.width = div.style.height = '0';\n  \t\t\t\t\tdiv.style.borderRight = size + ' solid black';\n\n  \t\t\t\t\tdoc.getElementsByTagName('body')[0].appendChild(div);\n  \t\t\t\t\tbcr = div.getBoundingClientRect();\n\n  \t\t\t\t\tborderSizes[size] = bcr.right - bcr.left;\n  \t\t\t\t}\n\n  \t\t\t\treturn borderSizes[size];\n  \t\t\t}\n\n  \t\t\tfunction setShortStyleProperty(style, property) {\n  \t\t\t\tvar borderSuffix = property == 'border' ? 'Width' : '';\n  \t\t\t\tvar t = property + 'Top' + borderSuffix;\n  \t\t\t\tvar r = property + 'Right' + borderSuffix;\n  \t\t\t\tvar b = property + 'Bottom' + borderSuffix;\n  \t\t\t\tvar l = property + 'Left' + borderSuffix;\n\n  \t\t\t\tstyle[property] = (style[t] == style[r] == style[b] == style[l] ? [style[t]] : style[t] == style[b] && style[l] == style[r] ? [style[t], style[r]] : style[l] == style[r] ? [style[t], style[r], style[b]] : [style[t], style[r], style[b], style[l]]).join(' ');\n  \t\t\t}\n\n  \t\t\tvar normalProps = {\n  \t\t\t\tfontWeight: 400,\n  \t\t\t\tlineHeight: 1.2, // actually varies depending on font-family, but is generally close enough...\n  \t\t\t\tletterSpacing: 0\n  \t\t\t};\n\n  \t\t\tfunction CSSStyleDeclaration(element) {\n  \t\t\t\tvar currentStyle, style, fontSize, property;\n\n  \t\t\t\tcurrentStyle = element.currentStyle;\n  \t\t\t\tstyle = this;\n  \t\t\t\tfontSize = getPixelSize(element, currentStyle, 'fontSize', null);\n\n  \t\t\t\t// TODO tidy this up, test it, send PR to jonathantneal!\n  \t\t\t\tfor (property in currentStyle) {\n  \t\t\t\t\tif (currentStyle[property] === 'normal' && normalProps.hasOwnProperty(property)) {\n  \t\t\t\t\t\tstyle[property] = normalProps[property];\n  \t\t\t\t\t} else if (/width|height|margin.|padding.|border.+W/.test(property)) {\n  \t\t\t\t\t\tif (currentStyle[property] === 'auto') {\n  \t\t\t\t\t\t\tif (/^width|height/.test(property)) {\n  \t\t\t\t\t\t\t\t// just use clientWidth/clientHeight...\n  \t\t\t\t\t\t\t\tstyle[property] = (property === 'width' ? element.clientWidth : element.clientHeight) + 'px';\n  \t\t\t\t\t\t\t} else if (/(?:padding)?Top|Bottom$/.test(property)) {\n  \t\t\t\t\t\t\t\tstyle[property] = '0px';\n  \t\t\t\t\t\t\t}\n  \t\t\t\t\t\t} else {\n  \t\t\t\t\t\t\tstyle[property] = getPixelSize(element, currentStyle, property, fontSize) + 'px';\n  \t\t\t\t\t\t}\n  \t\t\t\t\t} else if (property === 'styleFloat') {\n  \t\t\t\t\t\tstyle.float = currentStyle[property];\n  \t\t\t\t\t} else {\n  \t\t\t\t\t\tstyle[property] = currentStyle[property];\n  \t\t\t\t\t}\n  \t\t\t\t}\n\n  \t\t\t\tsetShortStyleProperty(style, 'margin');\n  \t\t\t\tsetShortStyleProperty(style, 'padding');\n  \t\t\t\tsetShortStyleProperty(style, 'border');\n\n  \t\t\t\tstyle.fontSize = fontSize + 'px';\n\n  \t\t\t\treturn style;\n  \t\t\t}\n\n  \t\t\tCSSStyleDeclaration.prototype = {\n  \t\t\t\tconstructor: CSSStyleDeclaration,\n  \t\t\t\tgetPropertyPriority: noop,\n  \t\t\t\tgetPropertyValue: function (prop) {\n  \t\t\t\t\treturn this[prop] || '';\n  \t\t\t\t},\n  \t\t\t\titem: noop,\n  \t\t\t\tremoveProperty: noop,\n  \t\t\t\tsetProperty: noop,\n  \t\t\t\tgetPropertyCSSValue: noop\n  \t\t\t};\n\n  \t\t\tfunction getComputedStyle(element) {\n  \t\t\t\treturn new CSSStyleDeclaration(element);\n  \t\t\t}\n\n  \t\t\treturn getComputedStyle;\n  \t\t})();\n  \t}\n  }\n\n  var legacy = exportedShims;\n\n  var create;\n  var defineProperty;\n  var defineProperties;\n  try {\n  \tObject.defineProperty({}, 'test', { value: 0 });\n\n  \tif (doc) {\n  \t\tObject.defineProperty(createElement('div'), 'test', { value: 0 });\n  \t}\n\n  \tdefineProperty = Object.defineProperty;\n  } catch (err) {\n  \t// Object.defineProperty doesn't exist, or we're in IE8 where you can\n  \t// only use it with DOM objects (what were you smoking, MSFT?)\n  \tdefineProperty = function (obj, prop, desc) {\n  \t\tobj[prop] = desc.value;\n  \t};\n  }\n\n  try {\n  \ttry {\n  \t\tObject.defineProperties({}, { test: { value: 0 } });\n  \t} catch (err) {\n  \t\t// TODO how do we account for this? noMagic = true;\n  \t\tthrow err;\n  \t}\n\n  \tif (doc) {\n  \t\tObject.defineProperties(createElement('div'), { test: { value: 0 } });\n  \t}\n\n  \tdefineProperties = Object.defineProperties;\n  } catch (err) {\n  \tdefineProperties = function (obj, props) {\n  \t\tvar prop;\n\n  \t\tfor (prop in props) {\n  \t\t\tif (props.hasOwnProperty(prop)) {\n  \t\t\t\tdefineProperty(obj, prop, props[prop]);\n  \t\t\t}\n  \t\t}\n  \t};\n  }\n\n  try {\n  \tObject.create(null);\n\n  \tcreate = Object.create;\n  } catch (err) {\n  \t// sigh\n  \tcreate = (function () {\n  \t\tvar F = function () {};\n\n  \t\treturn function (proto, props) {\n  \t\t\tvar obj;\n\n  \t\t\tif (proto === null) {\n  \t\t\t\treturn {};\n  \t\t\t}\n\n  \t\t\tF.prototype = proto;\n  \t\t\tobj = new F();\n\n  \t\t\tif (props) {\n  \t\t\t\tObject.defineProperties(obj, props);\n  \t\t\t}\n\n  \t\t\treturn obj;\n  \t\t};\n  \t})();\n  }\n\n  function extend(target) {\n  \tvar prop, source;\n\n  \tfor (var _len = arguments.length, sources = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n  \t\tsources[_key - 1] = arguments[_key];\n  \t}\n\n  \twhile (source = sources.shift()) {\n  \t\tfor (prop in source) {\n  \t\t\tif (hasOwn.call(source, prop)) {\n  \t\t\t\ttarget[prop] = source[prop];\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \treturn target;\n  }\n\n  var hasOwn = Object.prototype.hasOwnProperty;\n\n  var TEXT = 1;\n  var INTERPOLATOR = 2;\n  var TRIPLE = 3;\n  var SECTION = 4;\n  var INVERTED = 5;\n  var CLOSING = 6;\n  var ELEMENT = 7;\n  var PARTIAL = 8;\n  var COMMENT = 9;\n  var DELIMCHANGE = 10;\n  var CLOSING_TAG = 14;\n  var COMPONENT = 15;\n  var YIELDER = 16;\n  var INLINE_PARTIAL = 17;\n  var DOCTYPE = 18;\n  var ALIAS = 19;\n\n  var NUMBER_LITERAL = 20;\n  var STRING_LITERAL = 21;\n  var ARRAY_LITERAL = 22;\n  var OBJECT_LITERAL = 23;\n  var BOOLEAN_LITERAL = 24;\n  var REGEXP_LITERAL = 25;\n\n  var GLOBAL = 26;\n  var KEY_VALUE_PAIR = 27;\n\n  var REFERENCE = 30;\n  var REFINEMENT = 31;\n  var MEMBER = 32;\n  var PREFIX_OPERATOR = 33;\n  var BRACKETED = 34;\n  var CONDITIONAL = 35;\n  var INFIX_OPERATOR = 36;\n\n  var INVOCATION = 40;\n\n  var SECTION_IF = 50;\n  var SECTION_UNLESS = 51;\n  var SECTION_EACH = 52;\n  var SECTION_WITH = 53;\n  var SECTION_IF_WITH = 54;\n\n  var ELSE = 60;\n  var ELSEIF = 61;\n\n  function readComment(parser, tag) {\n  \tvar index;\n\n  \tif (!parser.matchString('!')) {\n  \t\treturn null;\n  \t}\n\n  \tindex = parser.remaining().indexOf(tag.close);\n\n  \tif (index !== -1) {\n  \t\tparser.pos += index + tag.close.length;\n  \t\treturn { t: COMMENT };\n  \t}\n  }\n\n  var expectedExpression = 'Expected a JavaScript expression';\n  var expectedParen = 'Expected closing paren';\n\n  // bulletproof number regex from https://gist.github.com/Rich-Harris/7544330\n  var numberPattern$1 = /^(?:[+-]?)0*(?:(?:(?:[1-9]\\d*)?\\.\\d+)|(?:(?:0|[1-9]\\d*)\\.)|(?:0|[1-9]\\d*))(?:[eE][+-]?\\d+)?/;\n  function readNumberLiteral$1(parser) {\n  \tvar result;\n\n  \tif (result = parser.matchPattern(numberPattern$1)) {\n  \t\treturn {\n  \t\t\tt: NUMBER_LITERAL,\n  \t\t\tv: result\n  \t\t};\n  \t}\n\n  \treturn null;\n  }\n\n  function readBooleanLiteral(parser) {\n  \tvar remaining = parser.remaining();\n\n  \tif (remaining.substr(0, 4) === 'true') {\n  \t\tparser.pos += 4;\n  \t\treturn {\n  \t\t\tt: BOOLEAN_LITERAL,\n  \t\t\tv: 'true'\n  \t\t};\n  \t}\n\n  \tif (remaining.substr(0, 5) === 'false') {\n  \t\tparser.pos += 5;\n  \t\treturn {\n  \t\t\tt: BOOLEAN_LITERAL,\n  \t\t\tv: 'false'\n  \t\t};\n  \t}\n\n  \treturn null;\n  }\n\n  var stringMiddlePattern;\n  var escapeSequencePattern;\n  var lineContinuationPattern;\n  // Match one or more characters until: \", ', \\, or EOL/EOF.\n  // EOL/EOF is written as (?!.) (meaning there's no non-newline char next).\n  stringMiddlePattern = /^(?=.)[^\"'\\\\]+?(?:(?!.)|(?=[\"'\\\\]))/;\n\n  // Match one escape sequence, including the backslash.\n  escapeSequencePattern = /^\\\\(?:['\"\\\\bfnrt]|0(?![0-9])|x[0-9a-fA-F]{2}|u[0-9a-fA-F]{4}|(?=.)[^ux0-9])/;\n\n  // Match one ES5 line continuation (backslash + line terminator).\n  lineContinuationPattern = /^\\\\(?:\\r\\n|[\\u000A\\u000D\\u2028\\u2029])/;\n\n  // Helper for defining getDoubleQuotedString and getSingleQuotedString.\n  function makeQuotedStringMatcher (okQuote) {\n  \treturn function (parser) {\n  \t\tvar literal = '\"';\n  \t\tvar done = false;\n  \t\tvar next = undefined;\n\n  \t\twhile (!done) {\n  \t\t\tnext = parser.matchPattern(stringMiddlePattern) || parser.matchPattern(escapeSequencePattern) || parser.matchString(okQuote);\n  \t\t\tif (next) {\n  \t\t\t\tif (next === '\"') {\n  \t\t\t\t\tliteral += '\\\\\"';\n  \t\t\t\t} else if (next === '\\\\\\'') {\n  \t\t\t\t\tliteral += '\\'';\n  \t\t\t\t} else {\n  \t\t\t\t\tliteral += next;\n  \t\t\t\t}\n  \t\t\t} else {\n  \t\t\t\tnext = parser.matchPattern(lineContinuationPattern);\n  \t\t\t\tif (next) {\n  \t\t\t\t\t// convert \\(newline-like) into a \\u escape, which is allowed in JSON\n  \t\t\t\t\tliteral += '\\\\u' + ('000' + next.charCodeAt(1).toString(16)).slice(-4);\n  \t\t\t\t} else {\n  \t\t\t\t\tdone = true;\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\tliteral += '\"';\n\n  \t\t// use JSON.parse to interpret escapes\n  \t\treturn JSON.parse(literal);\n  \t};\n  }\n\n  var getSingleQuotedString = makeQuotedStringMatcher('\"');\n  var getDoubleQuotedString = makeQuotedStringMatcher('\\'');\n\n  function readStringLiteral (parser) {\n  \tvar start, string;\n\n  \tstart = parser.pos;\n\n  \tif (parser.matchString('\"')) {\n  \t\tstring = getDoubleQuotedString(parser);\n\n  \t\tif (!parser.matchString('\"')) {\n  \t\t\tparser.pos = start;\n  \t\t\treturn null;\n  \t\t}\n\n  \t\treturn {\n  \t\t\tt: STRING_LITERAL,\n  \t\t\tv: string\n  \t\t};\n  \t}\n\n  \tif (parser.matchString('\\'')) {\n  \t\tstring = getSingleQuotedString(parser);\n\n  \t\tif (!parser.matchString('\\'')) {\n  \t\t\tparser.pos = start;\n  \t\t\treturn null;\n  \t\t}\n\n  \t\treturn {\n  \t\t\tt: STRING_LITERAL,\n  \t\t\tv: string\n  \t\t};\n  \t}\n\n  \treturn null;\n  }\n\n  var namePattern$1 = /^[a-zA-Z_$][a-zA-Z_$0-9]*/;\n\n  var identifier = /^[a-zA-Z_$][a-zA-Z_$0-9]*$/;\n\n  // http://mathiasbynens.be/notes/javascript-properties\n  // can be any name, string literal, or number literal\n\n  function readKey(parser) {\n  \tvar token;\n\n  \tif (token = readStringLiteral(parser)) {\n  \t\treturn identifier.test(token.v) ? token.v : '\"' + token.v.replace(/\"/g, '\\\\\"') + '\"';\n  \t}\n\n  \tif (token = readNumberLiteral$1(parser)) {\n  \t\treturn token.v;\n  \t}\n\n  \tif (token = parser.matchPattern(namePattern$1)) {\n  \t\treturn token;\n  \t}\n\n  \treturn null;\n  }\n\n  function readKeyValuePair(parser) {\n  \tvar start, key, value;\n\n  \tstart = parser.pos;\n\n  \t// allow whitespace between '{' and key\n  \tparser.allowWhitespace();\n\n  \tvar refKey = parser.nextChar() !== '\\'' && parser.nextChar() !== '\"';\n\n  \tkey = readKey(parser);\n  \tif (key === null) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \t// allow whitespace between key and ':'\n  \tparser.allowWhitespace();\n\n  \t// es2015 shorthand property\n  \tif (refKey && (parser.nextChar() === ',' || parser.nextChar() === '}')) {\n  \t\tif (!namePattern$1.test(key)) {\n  \t\t\tparser.error('Expected a valid reference, but found \\'' + key + '\\' instead.');\n  \t\t}\n\n  \t\treturn {\n  \t\t\tt: KEY_VALUE_PAIR,\n  \t\t\tk: key,\n  \t\t\tv: {\n  \t\t\t\tt: REFERENCE,\n  \t\t\t\tn: key\n  \t\t\t}\n  \t\t};\n  \t}\n\n  \t// next character must be ':'\n  \tif (!parser.matchString(':')) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \t// allow whitespace between ':' and value\n  \tparser.allowWhitespace();\n\n  \t// next expression must be a, well... expression\n  \tvalue = readExpression(parser);\n  \tif (value === null) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \treturn {\n  \t\tt: KEY_VALUE_PAIR,\n  \t\tk: key,\n  \t\tv: value\n  \t};\n  }\n\n  function readKeyValuePairs(parser) {\n  \tvar start, pairs, pair, keyValuePairs;\n\n  \tstart = parser.pos;\n\n  \tpair = readKeyValuePair(parser);\n  \tif (pair === null) {\n  \t\treturn null;\n  \t}\n\n  \tpairs = [pair];\n\n  \tif (parser.matchString(',')) {\n  \t\tkeyValuePairs = readKeyValuePairs(parser);\n\n  \t\tif (!keyValuePairs) {\n  \t\t\tparser.pos = start;\n  \t\t\treturn null;\n  \t\t}\n\n  \t\treturn pairs.concat(keyValuePairs);\n  \t}\n\n  \treturn pairs;\n  }\n\n  function readObjectLiteral (parser) {\n  \tvar start, keyValuePairs;\n\n  \tstart = parser.pos;\n\n  \t// allow whitespace\n  \tparser.allowWhitespace();\n\n  \tif (!parser.matchString('{')) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \tkeyValuePairs = readKeyValuePairs(parser);\n\n  \t// allow whitespace between final value and '}'\n  \tparser.allowWhitespace();\n\n  \tif (!parser.matchString('}')) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \treturn {\n  \t\tt: OBJECT_LITERAL,\n  \t\tm: keyValuePairs\n  \t};\n  }\n\n  function readExpressionList(parser) {\n  \tparser.allowWhitespace();\n\n  \tvar expr = readExpression(parser);\n\n  \tif (expr === null) return null;\n\n  \tvar expressions = [expr];\n\n  \t// allow whitespace between expression and ','\n  \tparser.allowWhitespace();\n\n  \tif (parser.matchString(',')) {\n  \t\tvar next = readExpressionList(parser);\n  \t\tif (next === null) parser.error(expectedExpression);\n\n  \t\texpressions.push.apply(expressions, next);\n  \t}\n\n  \treturn expressions;\n  }\n\n  function readArrayLiteral (parser) {\n  \tvar start, expressionList;\n\n  \tstart = parser.pos;\n\n  \t// allow whitespace before '['\n  \tparser.allowWhitespace();\n\n  \tif (!parser.matchString('[')) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \texpressionList = readExpressionList(parser);\n\n  \tif (!parser.matchString(']')) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \treturn {\n  \t\tt: ARRAY_LITERAL,\n  \t\tm: expressionList\n  \t};\n  }\n\n  var regexpPattern = /^(\\/(?:[^\\n\\r\\u2028\\u2029/\\\\[]|\\\\.|\\[(?:[^\\n\\r\\u2028\\u2029\\]\\\\]|\\\\.)*])+\\/(?:([gimuy])(?![a-z]*\\2))*(?![a-zA-Z_$0-9]))/;\n  function readNumberLiteral(parser) {\n  \tvar result;\n\n  \tif (result = parser.matchPattern(regexpPattern)) {\n  \t\treturn {\n  \t\t\tt: REGEXP_LITERAL,\n  \t\t\tv: result\n  \t\t};\n  \t}\n\n  \treturn null;\n  }\n\n  function readLiteral(parser) {\n  \treturn readNumberLiteral$1(parser) || readBooleanLiteral(parser) || readStringLiteral(parser) || readObjectLiteral(parser) || readArrayLiteral(parser) || readNumberLiteral(parser);\n  }\n\n  var prefixPattern = /^(?:~\\/|(?:\\.\\.\\/)+|\\.\\/(?:\\.\\.\\/)*|\\.)/;\n  var globals;\n  var keywords;\n  // if a reference is a browser global, we don't deference it later, so it needs special treatment\n  globals = /^(?:Array|console|Date|RegExp|decodeURIComponent|decodeURI|encodeURIComponent|encodeURI|isFinite|isNaN|parseFloat|parseInt|JSON|Math|NaN|undefined|null)\\b/;\n\n  // keywords are not valid references, with the exception of `this`\n  keywords = /^(?:break|case|catch|continue|debugger|default|delete|do|else|finally|for|function|if|in|instanceof|new|return|switch|throw|try|typeof|var|void|while|with)$/;\n\n  var legalReference = /^(?:[a-zA-Z$_0-9]|\\\\\\.)+(?:(?:\\.(?:[a-zA-Z$_0-9]|\\\\\\.)+)|(?:\\[[0-9]+\\]))*/;\n  var relaxedName = /^[a-zA-Z_$][-\\/a-zA-Z_$0-9]*/;\n  function readReference(parser) {\n  \tvar startPos, prefix, name, global, reference, lastDotIndex;\n\n  \tstartPos = parser.pos;\n\n  \tname = parser.matchPattern(/^@(?:keypath|index|key)/);\n\n  \tif (!name) {\n  \t\tprefix = parser.matchPattern(prefixPattern) || '';\n  \t\tname = !prefix && parser.relaxedNames && parser.matchPattern(relaxedName) || parser.matchPattern(legalReference);\n\n  \t\tif (!name && prefix === '.') {\n  \t\t\tprefix = '';\n  \t\t\tname = '.';\n  \t\t}\n  \t}\n\n  \tif (!name) {\n  \t\treturn null;\n  \t}\n\n  \t// bug out if it's a keyword (exception for ancestor/restricted refs - see https://github.com/ractivejs/ractive/issues/1497)\n  \tif (!prefix && !parser.relaxedNames && keywords.test(name)) {\n  \t\tparser.pos = startPos;\n  \t\treturn null;\n  \t}\n\n  \t// if this is a browser global, stop here\n  \tif (!prefix && globals.test(name)) {\n  \t\tglobal = globals.exec(name)[0];\n  \t\tparser.pos = startPos + global.length;\n\n  \t\treturn {\n  \t\t\tt: GLOBAL,\n  \t\t\tv: global\n  \t\t};\n  \t}\n\n  \treference = (prefix || '') + normalise(name);\n\n  \tif (parser.matchString('(')) {\n  \t\t// if this is a method invocation (as opposed to a function) we need\n  \t\t// to strip the method name from the reference combo, else the context\n  \t\t// will be wrong\n  \t\tlastDotIndex = reference.lastIndexOf('.');\n  \t\tif (lastDotIndex !== -1) {\n  \t\t\treference = reference.substr(0, lastDotIndex);\n  \t\t\tparser.pos = startPos + reference.length;\n  \t\t} else {\n  \t\t\tparser.pos -= 1;\n  \t\t}\n  \t}\n\n  \treturn {\n  \t\tt: REFERENCE,\n  \t\tn: reference.replace(/^this\\./, './').replace(/^this$/, '.')\n  \t};\n  }\n\n  function readBracketedExpression(parser) {\n  \tif (!parser.matchString('(')) return null;\n\n  \tparser.allowWhitespace();\n\n  \tvar expr = readExpression(parser);\n\n  \tif (!expr) parser.error(expectedExpression);\n\n  \tparser.allowWhitespace();\n\n  \tif (!parser.matchString(')')) parser.error(expectedParen);\n\n  \treturn {\n  \t\tt: BRACKETED,\n  \t\tx: expr\n  \t};\n  }\n\n  function readPrimary (parser) {\n  \treturn readLiteral(parser) || readReference(parser) || readBracketedExpression(parser);\n  }\n\n  function readRefinement(parser) {\n  \t// some things call for strict refinement (partial names), meaning no space between reference and refinement\n  \tif (!parser.strictRefinement) {\n  \t\tparser.allowWhitespace();\n  \t}\n\n  \t// \".\" name\n  \tif (parser.matchString('.')) {\n  \t\tparser.allowWhitespace();\n\n  \t\tvar _name = parser.matchPattern(namePattern$1);\n  \t\tif (_name) {\n  \t\t\treturn {\n  \t\t\t\tt: REFINEMENT,\n  \t\t\t\tn: _name\n  \t\t\t};\n  \t\t}\n\n  \t\tparser.error('Expected a property name');\n  \t}\n\n  \t// \"[\" expression \"]\"\n  \tif (parser.matchString('[')) {\n  \t\tparser.allowWhitespace();\n\n  \t\tvar expr = readExpression(parser);\n  \t\tif (!expr) parser.error(expectedExpression);\n\n  \t\tparser.allowWhitespace();\n\n  \t\tif (!parser.matchString(']')) parser.error('Expected \\']\\'');\n\n  \t\treturn {\n  \t\t\tt: REFINEMENT,\n  \t\t\tx: expr\n  \t\t};\n  \t}\n\n  \treturn null;\n  }\n\n  function readMemberOrInvocation (parser) {\n  \tvar expression = readPrimary(parser);\n\n  \tif (!expression) return null;\n\n  \twhile (expression) {\n  \t\tvar refinement = readRefinement(parser);\n  \t\tif (refinement) {\n  \t\t\texpression = {\n  \t\t\t\tt: MEMBER,\n  \t\t\t\tx: expression,\n  \t\t\t\tr: refinement\n  \t\t\t};\n  \t\t} else if (parser.matchString('(')) {\n  \t\t\tparser.allowWhitespace();\n  \t\t\tvar expressionList = readExpressionList(parser);\n\n  \t\t\tparser.allowWhitespace();\n\n  \t\t\tif (!parser.matchString(')')) {\n  \t\t\t\tparser.error(expectedParen);\n  \t\t\t}\n\n  \t\t\texpression = {\n  \t\t\t\tt: INVOCATION,\n  \t\t\t\tx: expression\n  \t\t\t};\n\n  \t\t\tif (expressionList) expression.o = expressionList;\n  \t\t} else {\n  \t\t\tbreak;\n  \t\t}\n  \t}\n\n  \treturn expression;\n  }\n\n  var readTypeOf;\n  var makePrefixSequenceMatcher;\n  makePrefixSequenceMatcher = function (symbol, fallthrough) {\n  \treturn function (parser) {\n  \t\tvar expression;\n\n  \t\tif (expression = fallthrough(parser)) {\n  \t\t\treturn expression;\n  \t\t}\n\n  \t\tif (!parser.matchString(symbol)) {\n  \t\t\treturn null;\n  \t\t}\n\n  \t\tparser.allowWhitespace();\n\n  \t\texpression = readExpression(parser);\n  \t\tif (!expression) {\n  \t\t\tparser.error(expectedExpression);\n  \t\t}\n\n  \t\treturn {\n  \t\t\ts: symbol,\n  \t\t\to: expression,\n  \t\t\tt: PREFIX_OPERATOR\n  \t\t};\n  \t};\n  };\n\n  // create all prefix sequence matchers, return readTypeOf\n  (function () {\n  \tvar i, len, matcher, prefixOperators, fallthrough;\n\n  \tprefixOperators = '! ~ + - typeof'.split(' ');\n\n  \tfallthrough = readMemberOrInvocation;\n  \tfor (i = 0, len = prefixOperators.length; i < len; i += 1) {\n  \t\tmatcher = makePrefixSequenceMatcher(prefixOperators[i], fallthrough);\n  \t\tfallthrough = matcher;\n  \t}\n\n  \t// typeof operator is higher precedence than multiplication, so provides the\n  \t// fallthrough for the multiplication sequence matcher we're about to create\n  \t// (we're skipping void and delete)\n  \treadTypeOf = fallthrough;\n  })();\n\n  var readTypeof = readTypeOf;\n\n  var readLogicalOr;\n  var makeInfixSequenceMatcher;\n  makeInfixSequenceMatcher = function (symbol, fallthrough) {\n  \treturn function (parser) {\n  \t\tvar start, left, right;\n\n  \t\tleft = fallthrough(parser);\n  \t\tif (!left) {\n  \t\t\treturn null;\n  \t\t}\n\n  \t\t// Loop to handle left-recursion in a case like `a * b * c` and produce\n  \t\t// left association, i.e. `(a * b) * c`.  The matcher can't call itself\n  \t\t// to parse `left` because that would be infinite regress.\n  \t\twhile (true) {\n  \t\t\tstart = parser.pos;\n\n  \t\t\tparser.allowWhitespace();\n\n  \t\t\tif (!parser.matchString(symbol)) {\n  \t\t\t\tparser.pos = start;\n  \t\t\t\treturn left;\n  \t\t\t}\n\n  \t\t\t// special case - in operator must not be followed by [a-zA-Z_$0-9]\n  \t\t\tif (symbol === 'in' && /[a-zA-Z_$0-9]/.test(parser.remaining().charAt(0))) {\n  \t\t\t\tparser.pos = start;\n  \t\t\t\treturn left;\n  \t\t\t}\n\n  \t\t\tparser.allowWhitespace();\n\n  \t\t\t// right operand must also consist of only higher-precedence operators\n  \t\t\tright = fallthrough(parser);\n  \t\t\tif (!right) {\n  \t\t\t\tparser.pos = start;\n  \t\t\t\treturn left;\n  \t\t\t}\n\n  \t\t\tleft = {\n  \t\t\t\tt: INFIX_OPERATOR,\n  \t\t\t\ts: symbol,\n  \t\t\t\to: [left, right]\n  \t\t\t};\n\n  \t\t\t// Loop back around.  If we don't see another occurrence of the symbol,\n  \t\t\t// we'll return left.\n  \t\t}\n  \t};\n  };\n\n  // create all infix sequence matchers, and return readLogicalOr\n  (function () {\n  \tvar i, len, matcher, infixOperators, fallthrough;\n\n  \t// All the infix operators on order of precedence (source: https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Operators/Operator_Precedence)\n  \t// Each sequence matcher will initially fall through to its higher precedence\n  \t// neighbour, and only attempt to match if one of the higher precedence operators\n  \t// (or, ultimately, a literal, reference, or bracketed expression) already matched\n  \tinfixOperators = '* / % + - << >> >>> < <= > >= in instanceof == != === !== & ^ | && ||'.split(' ');\n\n  \t// A typeof operator is higher precedence than multiplication\n  \tfallthrough = readTypeof;\n  \tfor (i = 0, len = infixOperators.length; i < len; i += 1) {\n  \t\tmatcher = makeInfixSequenceMatcher(infixOperators[i], fallthrough);\n  \t\tfallthrough = matcher;\n  \t}\n\n  \t// Logical OR is the fallthrough for the conditional matcher\n  \treadLogicalOr = fallthrough;\n  })();\n\n  var readLogicalOr$1 = readLogicalOr;\n\n  // The conditional operator is the lowest precedence operator, so we start here\n\n  function getConditional(parser) {\n  \tvar start, expression, ifTrue, ifFalse;\n\n  \texpression = readLogicalOr$1(parser);\n  \tif (!expression) {\n  \t\treturn null;\n  \t}\n\n  \tstart = parser.pos;\n\n  \tparser.allowWhitespace();\n\n  \tif (!parser.matchString('?')) {\n  \t\tparser.pos = start;\n  \t\treturn expression;\n  \t}\n\n  \tparser.allowWhitespace();\n\n  \tifTrue = readExpression(parser);\n  \tif (!ifTrue) {\n  \t\tparser.error(expectedExpression);\n  \t}\n\n  \tparser.allowWhitespace();\n\n  \tif (!parser.matchString(':')) {\n  \t\tparser.error('Expected \":\"');\n  \t}\n\n  \tparser.allowWhitespace();\n\n  \tifFalse = readExpression(parser);\n  \tif (!ifFalse) {\n  \t\tparser.error(expectedExpression);\n  \t}\n\n  \treturn {\n  \t\tt: CONDITIONAL,\n  \t\to: [expression, ifTrue, ifFalse]\n  \t};\n  }\n\n  function readExpression(parser) {\n  \t// The conditional operator is the lowest precedence operator (except yield,\n  \t// assignment operators, and commas, none of which are supported), so we\n  \t// start there. If it doesn't match, it 'falls through' to progressively\n  \t// higher precedence operators, until it eventually matches (or fails to\n  \t// match) a 'primary' - a literal or a reference. This way, the abstract syntax\n  \t// tree has everything in its proper place, i.e. 2 + 3 * 4 === 14, not 20.\n  \treturn getConditional(parser);\n  }\n\n  function readExpressionOrReference(parser, expectedFollowers) {\n  \tvar start, expression, i;\n\n  \tstart = parser.pos;\n  \texpression = readExpression(parser);\n\n  \tif (!expression) {\n  \t\treturn null;\n  \t}\n\n  \tfor (i = 0; i < expectedFollowers.length; i += 1) {\n  \t\tif (parser.remaining().substr(0, expectedFollowers[i].length) === expectedFollowers[i]) {\n  \t\t\treturn expression;\n  \t\t}\n  \t}\n\n  \tparser.pos = start;\n  \treturn readReference(parser);\n  }\n\n  function flattenExpression(expression) {\n  \tvar refs;\n\n  \textractRefs(expression, refs = []);\n\n  \treturn {\n  \t\tr: refs,\n  \t\ts: stringify(expression)\n  \t};\n\n  \tfunction stringify(node) {\n  \t\tswitch (node.t) {\n  \t\t\tcase BOOLEAN_LITERAL:\n  \t\t\tcase GLOBAL:\n  \t\t\tcase NUMBER_LITERAL:\n  \t\t\tcase REGEXP_LITERAL:\n  \t\t\t\treturn node.v;\n\n  \t\t\tcase STRING_LITERAL:\n  \t\t\t\treturn JSON.stringify(String(node.v));\n\n  \t\t\tcase ARRAY_LITERAL:\n  \t\t\t\treturn '[' + (node.m ? node.m.map(stringify).join(',') : '') + ']';\n\n  \t\t\tcase OBJECT_LITERAL:\n  \t\t\t\treturn '{' + (node.m ? node.m.map(stringify).join(',') : '') + '}';\n\n  \t\t\tcase KEY_VALUE_PAIR:\n  \t\t\t\treturn node.k + ':' + stringify(node.v);\n\n  \t\t\tcase PREFIX_OPERATOR:\n  \t\t\t\treturn (node.s === 'typeof' ? 'typeof ' : node.s) + stringify(node.o);\n\n  \t\t\tcase INFIX_OPERATOR:\n  \t\t\t\treturn stringify(node.o[0]) + (node.s.substr(0, 2) === 'in' ? ' ' + node.s + ' ' : node.s) + stringify(node.o[1]);\n\n  \t\t\tcase INVOCATION:\n  \t\t\t\treturn stringify(node.x) + '(' + (node.o ? node.o.map(stringify).join(',') : '') + ')';\n\n  \t\t\tcase BRACKETED:\n  \t\t\t\treturn '(' + stringify(node.x) + ')';\n\n  \t\t\tcase MEMBER:\n  \t\t\t\treturn stringify(node.x) + stringify(node.r);\n\n  \t\t\tcase REFINEMENT:\n  \t\t\t\treturn node.n ? '.' + node.n : '[' + stringify(node.x) + ']';\n\n  \t\t\tcase CONDITIONAL:\n  \t\t\t\treturn stringify(node.o[0]) + '?' + stringify(node.o[1]) + ':' + stringify(node.o[2]);\n\n  \t\t\tcase REFERENCE:\n  \t\t\t\treturn '_' + refs.indexOf(node.n);\n\n  \t\t\tdefault:\n  \t\t\t\tthrow new Error('Expected legal JavaScript');\n  \t\t}\n  \t}\n  }\n\n  // TODO maybe refactor this?\n  function extractRefs(node, refs) {\n  \tvar i, list;\n\n  \tif (node.t === REFERENCE) {\n  \t\tif (refs.indexOf(node.n) === -1) {\n  \t\t\trefs.unshift(node.n);\n  \t\t}\n  \t}\n\n  \tlist = node.o || node.m;\n  \tif (list) {\n  \t\tif (isObject(list)) {\n  \t\t\textractRefs(list, refs);\n  \t\t} else {\n  \t\t\ti = list.length;\n  \t\t\twhile (i--) {\n  \t\t\t\textractRefs(list[i], refs);\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \tif (node.x) {\n  \t\textractRefs(node.x, refs);\n  \t}\n\n  \tif (node.r) {\n  \t\textractRefs(node.r, refs);\n  \t}\n\n  \tif (node.v) {\n  \t\textractRefs(node.v, refs);\n  \t}\n  }\n\n  var arrayMemberPattern = /^[0-9][1-9]*$/;\n  function refineExpression(expression, mustache) {\n  \tvar referenceExpression;\n\n  \tif (expression) {\n  \t\twhile (expression.t === BRACKETED && expression.x) {\n  \t\t\texpression = expression.x;\n  \t\t}\n\n  \t\t// special case - integers should be treated as array members references,\n  \t\t// rather than as expressions in their own right\n  \t\tif (expression.t === REFERENCE) {\n  \t\t\tmustache.r = expression.n;\n  \t\t} else {\n  \t\t\tif (expression.t === NUMBER_LITERAL && arrayMemberPattern.test(expression.v)) {\n  \t\t\t\tmustache.r = expression.v;\n  \t\t\t} else if (referenceExpression = getReferenceExpression(expression)) {\n  \t\t\t\tmustache.rx = referenceExpression;\n  \t\t\t} else {\n  \t\t\t\tmustache.x = flattenExpression(expression);\n  \t\t\t}\n  \t\t}\n\n  \t\treturn mustache;\n  \t}\n  }\n\n  // TODO refactor this! it's bewildering\n  function getReferenceExpression(expression) {\n  \tvar members = [],\n  \t    refinement;\n\n  \twhile (expression.t === MEMBER && expression.r.t === REFINEMENT) {\n  \t\trefinement = expression.r;\n\n  \t\tif (refinement.x) {\n  \t\t\tif (refinement.x.t === REFERENCE) {\n  \t\t\t\tmembers.unshift(refinement.x);\n  \t\t\t} else {\n  \t\t\t\tmembers.unshift(flattenExpression(refinement.x));\n  \t\t\t}\n  \t\t} else {\n  \t\t\tmembers.unshift(refinement.n);\n  \t\t}\n\n  \t\texpression = expression.x;\n  \t}\n\n  \tif (expression.t !== REFERENCE) {\n  \t\treturn null;\n  \t}\n\n  \treturn {\n  \t\tr: expression.n,\n  \t\tm: members\n  \t};\n  }\n\n  function readInterpolator(parser, tag) {\n  \tvar start, expression, interpolator, err;\n\n  \tstart = parser.pos;\n\n  \t// TODO would be good for perf if we could do away with the try-catch\n  \ttry {\n  \t\texpression = readExpressionOrReference(parser, [tag.close]);\n  \t} catch (e) {\n  \t\terr = e;\n  \t}\n\n  \tif (!expression) {\n  \t\tif (parser.str.charAt(start) === '!') {\n  \t\t\t// special case - comment\n  \t\t\tparser.pos = start;\n  \t\t\treturn null;\n  \t\t}\n\n  \t\tif (err) {\n  \t\t\tthrow err;\n  \t\t}\n  \t}\n\n  \tif (!parser.matchString(tag.close)) {\n  \t\tparser.error('Expected closing delimiter \\'' + tag.close + '\\' after reference');\n\n  \t\tif (!expression) {\n  \t\t\t// special case - comment\n  \t\t\tif (parser.nextChar() === '!') {\n  \t\t\t\treturn null;\n  \t\t\t}\n\n  \t\t\tparser.error('Expected expression or legal reference');\n  \t\t}\n  \t}\n\n  \tinterpolator = { t: INTERPOLATOR };\n  \trefineExpression(expression, interpolator); // TODO handle this differently - it's mysterious\n\n  \treturn interpolator;\n  }\n\n  var yieldPattern = /^yield\\s*/;\n  function readYielder(parser, tag) {\n  \tif (!parser.matchPattern(yieldPattern)) return null;\n\n  \tvar name = parser.matchPattern(/^[a-zA-Z_$][a-zA-Z_$0-9\\-]*/);\n\n  \tparser.allowWhitespace();\n\n  \tif (!parser.matchString(tag.close)) {\n  \t\tparser.error(\"expected legal partial name\");\n  \t}\n\n  \tvar yielder = { t: YIELDER };\n  \tif (name) yielder.n = name;\n\n  \treturn yielder;\n  }\n\n  var handlebarsBlockCodes = {\n  \t'each': SECTION_EACH,\n  \t'if': SECTION_IF,\n  \t'if-with': SECTION_IF_WITH,\n  \t'with': SECTION_WITH,\n  \t'unless': SECTION_UNLESS\n  };\n\n  function readClosing(parser, tag) {\n  \tvar start, remaining, index, closing;\n\n  \tstart = parser.pos;\n\n  \tif (!parser.matchString(tag.open)) {\n  \t\treturn null;\n  \t}\n\n  \tparser.allowWhitespace();\n\n  \tif (!parser.matchString('/')) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \tparser.allowWhitespace();\n\n  \tremaining = parser.remaining();\n  \tindex = remaining.indexOf(tag.close);\n\n  \tif (index !== -1) {\n  \t\tclosing = {\n  \t\t\tt: CLOSING,\n  \t\t\tr: remaining.substr(0, index).split(' ')[0]\n  \t\t};\n\n  \t\tparser.pos += index;\n\n  \t\tif (!parser.matchString(tag.close)) {\n  \t\t\tparser.error('Expected closing delimiter \\'' + tag.close + '\\'');\n  \t\t}\n\n  \t\treturn closing;\n  \t}\n\n  \tparser.pos = start;\n  \treturn null;\n  }\n\n  var elsePattern = /^\\s*else\\s*/;\n  function readElse(parser, tag) {\n  \tvar start = parser.pos;\n\n  \tif (!parser.matchString(tag.open)) {\n  \t\treturn null;\n  \t}\n\n  \tif (!parser.matchPattern(elsePattern)) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \tif (!parser.matchString(tag.close)) {\n  \t\tparser.error(\"Expected closing delimiter '\" + tag.close + \"'\");\n  \t}\n\n  \treturn {\n  \t\tt: ELSE\n  \t};\n  }\n\n  var elsePattern$1 = /^\\s*elseif\\s+/;\n  function readElseIf(parser, tag) {\n  \tvar start = parser.pos;\n\n  \tif (!parser.matchString(tag.open)) {\n  \t\treturn null;\n  \t}\n\n  \tif (!parser.matchPattern(elsePattern$1)) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \tvar expression = readExpression(parser);\n\n  \tif (!parser.matchString(tag.close)) {\n  \t\tparser.error('Expected closing delimiter \\'' + tag.close + '\\'');\n  \t}\n\n  \treturn {\n  \t\tt: ELSEIF,\n  \t\tx: expression\n  \t};\n  }\n\n  var legalAlias = /^(?:[a-zA-Z$_0-9]|\\\\\\.)+(?:(?:(?:[a-zA-Z$_0-9]|\\\\\\.)+)|(?:\\[[0-9]+\\]))*/;\n  var asRE = /^as/i;\n\n  function readAliases(parser) {\n  \tvar aliases = [],\n  \t    alias = undefined,\n  \t    start = parser.pos;\n\n  \tparser.allowWhitespace();\n\n  \talias = readAlias(parser);\n\n  \tif (alias) {\n  \t\talias.x = refineExpression(alias.x, {});\n  \t\taliases.push(alias);\n\n  \t\tparser.allowWhitespace();\n\n  \t\twhile (parser.matchString(',')) {\n  \t\t\talias = readAlias(parser);\n\n  \t\t\tif (!alias) {\n  \t\t\t\tparser.error('Expected another alias.');\n  \t\t\t}\n\n  \t\t\talias.x = refineExpression(alias.x, {});\n  \t\t\taliases.push(alias);\n\n  \t\t\tparser.allowWhitespace();\n  \t\t}\n\n  \t\treturn aliases;\n  \t}\n\n  \tparser.pos = start;\n  \treturn null;\n  }\n\n  function readAlias(parser) {\n  \tvar expr = undefined,\n  \t    alias = undefined,\n  \t    start = parser.pos;\n\n  \tparser.allowWhitespace();\n\n  \texpr = readExpression(parser, []);\n\n  \tif (!expr) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \tparser.allowWhitespace();\n\n  \tif (!parser.matchPattern(asRE)) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \tparser.allowWhitespace();\n\n  \talias = parser.matchPattern(legalAlias);\n\n  \tif (!alias) {\n  \t\tparser.error('Expected a legal alias name.');\n  \t}\n\n  \treturn { n: alias, x: expr };\n  }\n\n  var indexRefPattern = /^\\s*:\\s*([a-zA-Z_$][a-zA-Z_$0-9]*)/;\n  var keyIndexRefPattern = /^\\s*,\\s*([a-zA-Z_$][a-zA-Z_$0-9]*)/;\n  var handlebarsBlockPattern = new RegExp('^(' + Object.keys(handlebarsBlockCodes).join('|') + ')\\\\b');\n  function readSection(parser, tag) {\n  \tvar start,\n  \t    expression,\n  \t    section,\n  \t    child,\n  \t    children,\n  \t    hasElse,\n  \t    block,\n  \t    unlessBlock,\n  \t    conditions,\n  \t    closed,\n  \t    i,\n  \t    expectedClose,\n  \t    aliasOnly = false;\n\n  \tstart = parser.pos;\n\n  \tif (parser.matchString('^')) {\n  \t\tsection = { t: SECTION, f: [], n: SECTION_UNLESS };\n  \t} else if (parser.matchString('#')) {\n  \t\tsection = { t: SECTION, f: [] };\n\n  \t\tif (parser.matchString('partial')) {\n  \t\t\tparser.pos = start - parser.standardDelimiters[0].length;\n  \t\t\tparser.error('Partial definitions can only be at the top level of the template, or immediately inside components');\n  \t\t}\n\n  \t\tif (block = parser.matchPattern(handlebarsBlockPattern)) {\n  \t\t\texpectedClose = block;\n  \t\t\tsection.n = handlebarsBlockCodes[block];\n  \t\t}\n  \t} else {\n  \t\treturn null;\n  \t}\n\n  \tparser.allowWhitespace();\n\n  \tif (block === 'with') {\n  \t\tvar aliases = readAliases(parser);\n  \t\tif (aliases) {\n  \t\t\taliasOnly = true;\n  \t\t\tsection.z = aliases;\n  \t\t\tsection.t = ALIAS;\n  \t\t}\n  \t} else if (block === 'each') {\n  \t\tvar alias = readAlias(parser);\n  \t\tif (alias) {\n  \t\t\tsection.z = [{ n: alias.n, x: { r: '.' } }];\n  \t\t\texpression = alias.x;\n  \t\t}\n  \t}\n\n  \tif (!aliasOnly) {\n  \t\tif (!expression) expression = readExpression(parser);\n\n  \t\tif (!expression) {\n  \t\t\tparser.error('Expected expression');\n  \t\t}\n\n  \t\t// optional index and key references\n  \t\tif (i = parser.matchPattern(indexRefPattern)) {\n  \t\t\tvar extra = undefined;\n\n  \t\t\tif (extra = parser.matchPattern(keyIndexRefPattern)) {\n  \t\t\t\tsection.i = i + ',' + extra;\n  \t\t\t} else {\n  \t\t\t\tsection.i = i;\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \tparser.allowWhitespace();\n\n  \tif (!parser.matchString(tag.close)) {\n  \t\tparser.error('Expected closing delimiter \\'' + tag.close + '\\'');\n  \t}\n\n  \tparser.sectionDepth += 1;\n  \tchildren = section.f;\n\n  \tconditions = [];\n\n  \tdo {\n  \t\tif (child = readClosing(parser, tag)) {\n  \t\t\tif (expectedClose && child.r !== expectedClose) {\n  \t\t\t\tparser.error('Expected ' + tag.open + '/' + expectedClose + tag.close);\n  \t\t\t}\n\n  \t\t\tparser.sectionDepth -= 1;\n  \t\t\tclosed = true;\n  \t\t} else if (!aliasOnly && (child = readElseIf(parser, tag))) {\n  \t\t\tif (section.n === SECTION_UNLESS) {\n  \t\t\t\tparser.error('{{else}} not allowed in {{#unless}}');\n  \t\t\t}\n\n  \t\t\tif (hasElse) {\n  \t\t\t\tparser.error('illegal {{elseif...}} after {{else}}');\n  \t\t\t}\n\n  \t\t\tif (!unlessBlock) {\n  \t\t\t\tunlessBlock = createUnlessBlock(expression);\n  \t\t\t}\n\n  \t\t\tunlessBlock.f.push({\n  \t\t\t\tt: SECTION,\n  \t\t\t\tn: SECTION_IF,\n  \t\t\t\tx: flattenExpression(combine$2(conditions.concat(child.x))),\n  \t\t\t\tf: children = []\n  \t\t\t});\n\n  \t\t\tconditions.push(invert(child.x));\n  \t\t} else if (!aliasOnly && (child = readElse(parser, tag))) {\n  \t\t\tif (section.n === SECTION_UNLESS) {\n  \t\t\t\tparser.error('{{else}} not allowed in {{#unless}}');\n  \t\t\t}\n\n  \t\t\tif (hasElse) {\n  \t\t\t\tparser.error('there can only be one {{else}} block, at the end of a section');\n  \t\t\t}\n\n  \t\t\thasElse = true;\n\n  \t\t\t// use an unless block if there's no elseif\n  \t\t\tif (!unlessBlock) {\n  \t\t\t\tunlessBlock = createUnlessBlock(expression);\n  \t\t\t\tchildren = unlessBlock.f;\n  \t\t\t} else {\n  \t\t\t\tunlessBlock.f.push({\n  \t\t\t\t\tt: SECTION,\n  \t\t\t\t\tn: SECTION_IF,\n  \t\t\t\t\tx: flattenExpression(combine$2(conditions)),\n  \t\t\t\t\tf: children = []\n  \t\t\t\t});\n  \t\t\t}\n  \t\t} else {\n  \t\t\tchild = parser.read(READERS);\n\n  \t\t\tif (!child) {\n  \t\t\t\tbreak;\n  \t\t\t}\n\n  \t\t\tchildren.push(child);\n  \t\t}\n  \t} while (!closed);\n\n  \tif (unlessBlock) {\n  \t\t// special case - `with` should become `if-with` (TODO is this right?\n  \t\t// seems to me that `with` ought to behave consistently, regardless\n  \t\t// of the presence/absence of `else`. In other words should always\n  \t\t// be `if-with`\n  \t\tif (section.n === SECTION_WITH) {\n  \t\t\tsection.n = SECTION_IF_WITH;\n  \t\t}\n\n  \t\tsection.l = unlessBlock;\n  \t}\n\n  \tif (!aliasOnly) {\n  \t\trefineExpression(expression, section);\n  \t}\n\n  \t// TODO if a section is empty it should be discarded. Don't do\n  \t// that here though - we need to clean everything up first, as\n  \t// it may contain removeable whitespace. As a temporary measure,\n  \t// to pass the existing tests, remove empty `f` arrays\n  \tif (!section.f.length) {\n  \t\tdelete section.f;\n  \t}\n\n  \treturn section;\n  }\n\n  function createUnlessBlock(expression) {\n  \tvar unlessBlock = {\n  \t\tt: SECTION,\n  \t\tn: SECTION_UNLESS,\n  \t\tf: []\n  \t};\n\n  \trefineExpression(expression, unlessBlock);\n  \treturn unlessBlock;\n  }\n\n  function invert(expression) {\n  \tif (expression.t === PREFIX_OPERATOR && expression.s === '!') {\n  \t\treturn expression.o;\n  \t}\n\n  \treturn {\n  \t\tt: PREFIX_OPERATOR,\n  \t\ts: '!',\n  \t\to: parensIfNecessary(expression)\n  \t};\n  }\n\n  function combine$2(expressions) {\n  \tif (expressions.length === 1) {\n  \t\treturn expressions[0];\n  \t}\n\n  \treturn {\n  \t\tt: INFIX_OPERATOR,\n  \t\ts: '&&',\n  \t\to: [parensIfNecessary(expressions[0]), parensIfNecessary(combine$2(expressions.slice(1)))]\n  \t};\n  }\n\n  function parensIfNecessary(expression) {\n  \t// TODO only wrap if necessary\n  \treturn {\n  \t\tt: BRACKETED,\n  \t\tx: expression\n  \t};\n  }\n\n  function readUnescaped(parser, tag) {\n  \tvar expression, triple;\n\n  \tif (!parser.matchString('&')) {\n  \t\treturn null;\n  \t}\n\n  \tparser.allowWhitespace();\n\n  \texpression = readExpression(parser);\n\n  \tif (!expression) {\n  \t\treturn null;\n  \t}\n\n  \tif (!parser.matchString(tag.close)) {\n  \t\tparser.error('Expected closing delimiter \\'' + tag.close + '\\'');\n  \t}\n\n  \ttriple = { t: TRIPLE };\n  \trefineExpression(expression, triple); // TODO handle this differently - it's mysterious\n\n  \treturn triple;\n  }\n\n  function readPartial(parser, tag) {\n  \tif (!parser.matchString('>')) return null;\n\n  \tparser.allowWhitespace();\n\n  \t// Partial names can include hyphens, so we can't use readExpression\n  \t// blindly. Instead, we use the `relaxedNames` flag to indicate that\n  \t// `foo-bar` should be read as a single name, rather than 'subtract\n  \t// bar from foo'\n  \tparser.relaxedNames = parser.strictRefinement = true;\n  \tvar expression = readExpression(parser);\n  \tparser.relaxedNames = parser.strictRefinement = false;\n\n  \tparser.allowWhitespace();\n  \tvar context = readExpression(parser);\n  \tparser.allowWhitespace();\n\n  \tif (!expression) return null;\n\n  \tvar partial = { t: PARTIAL };\n  \trefineExpression(expression, partial); // TODO...\n\n  \tparser.allowWhitespace();\n\n  \t// if we have another expression - e.g. `{{>foo bar}}` - then\n  \t// we turn it into `{{#with bar}}{{>foo}}{{/with}}`\n  \tif (context) {\n  \t\tpartial = {\n  \t\t\tt: SECTION,\n  \t\t\tn: SECTION_WITH,\n  \t\t\tf: [partial]\n  \t\t};\n\n  \t\trefineExpression(context, partial);\n  \t}\n\n  \tif (!parser.matchString(tag.close)) {\n  \t\tparser.error('Expected closing delimiter \\'' + tag.close + '\\'');\n  \t}\n\n  \treturn partial;\n  }\n\n  function readTriple(parser, tag) {\n  \tvar expression = readExpression(parser),\n  \t    triple;\n\n  \tif (!expression) {\n  \t\treturn null;\n  \t}\n\n  \tif (!parser.matchString(tag.close)) {\n  \t\tparser.error('Expected closing delimiter \\'' + tag.close + '\\'');\n  \t}\n\n  \ttriple = { t: TRIPLE };\n  \trefineExpression(expression, triple); // TODO handle this differently - it's mysterious\n\n  \treturn triple;\n  }\n\n  var pattern$1 = /[-/\\\\^$*+?.()|[\\]{}]/g;\n  function escapeRegExp(str) {\n  \treturn str.replace(pattern$1, '\\\\$&');\n  }\n\n  var regExpCache = {};\n\n  function getLowestIndex (haystack, needles) {\n  \treturn haystack.search(regExpCache[needles.join()] || (regExpCache[needles.join()] = new RegExp(needles.map(escapeRegExp).join('|'))));\n  }\n\n  // https://github.com/kangax/html-minifier/issues/63#issuecomment-37763316\n  var booleanAttributes = /^(allowFullscreen|async|autofocus|autoplay|checked|compact|controls|declare|default|defaultChecked|defaultMuted|defaultSelected|defer|disabled|enabled|formNoValidate|hidden|indeterminate|inert|isMap|itemScope|loop|multiple|muted|noHref|noResize|noShade|noValidate|noWrap|open|pauseOnExit|readOnly|required|reversed|scoped|seamless|selected|sortable|translate|trueSpeed|typeMustMatch|visible)$/i;\n  var voidElementNames = /^(?:area|base|br|col|command|doctype|embed|hr|img|input|keygen|link|meta|param|source|track|wbr)$/i;\n\n  var htmlEntities = { quot: 34, amp: 38, apos: 39, lt: 60, gt: 62, nbsp: 160, iexcl: 161, cent: 162, pound: 163, curren: 164, yen: 165, brvbar: 166, sect: 167, uml: 168, copy: 169, ordf: 170, laquo: 171, not: 172, shy: 173, reg: 174, macr: 175, deg: 176, plusmn: 177, sup2: 178, sup3: 179, acute: 180, micro: 181, para: 182, middot: 183, cedil: 184, sup1: 185, ordm: 186, raquo: 187, frac14: 188, frac12: 189, frac34: 190, iquest: 191, Agrave: 192, Aacute: 193, Acirc: 194, Atilde: 195, Auml: 196, Aring: 197, AElig: 198, Ccedil: 199, Egrave: 200, Eacute: 201, Ecirc: 202, Euml: 203, Igrave: 204, Iacute: 205, Icirc: 206, Iuml: 207, ETH: 208, Ntilde: 209, Ograve: 210, Oacute: 211, Ocirc: 212, Otilde: 213, Ouml: 214, times: 215, Oslash: 216, Ugrave: 217, Uacute: 218, Ucirc: 219, Uuml: 220, Yacute: 221, THORN: 222, szlig: 223, agrave: 224, aacute: 225, acirc: 226, atilde: 227, auml: 228, aring: 229, aelig: 230, ccedil: 231, egrave: 232, eacute: 233, ecirc: 234, euml: 235, igrave: 236, iacute: 237, icirc: 238, iuml: 239, eth: 240, ntilde: 241, ograve: 242, oacute: 243, ocirc: 244, otilde: 245, ouml: 246, divide: 247, oslash: 248, ugrave: 249, uacute: 250, ucirc: 251, uuml: 252, yacute: 253, thorn: 254, yuml: 255, OElig: 338, oelig: 339, Scaron: 352, scaron: 353, Yuml: 376, fnof: 402, circ: 710, tilde: 732, Alpha: 913, Beta: 914, Gamma: 915, Delta: 916, Epsilon: 917, Zeta: 918, Eta: 919, Theta: 920, Iota: 921, Kappa: 922, Lambda: 923, Mu: 924, Nu: 925, Xi: 926, Omicron: 927, Pi: 928, Rho: 929, Sigma: 931, Tau: 932, Upsilon: 933, Phi: 934, Chi: 935, Psi: 936, Omega: 937, alpha: 945, beta: 946, gamma: 947, delta: 948, epsilon: 949, zeta: 950, eta: 951, theta: 952, iota: 953, kappa: 954, lambda: 955, mu: 956, nu: 957, xi: 958, omicron: 959, pi: 960, rho: 961, sigmaf: 962, sigma: 963, tau: 964, upsilon: 965, phi: 966, chi: 967, psi: 968, omega: 969, thetasym: 977, upsih: 978, piv: 982, ensp: 8194, emsp: 8195, thinsp: 8201, zwnj: 8204, zwj: 8205, lrm: 8206, rlm: 8207, ndash: 8211, mdash: 8212, lsquo: 8216, rsquo: 8217, sbquo: 8218, ldquo: 8220, rdquo: 8221, bdquo: 8222, dagger: 8224, Dagger: 8225, bull: 8226, hellip: 8230, permil: 8240, prime: 8242, Prime: 8243, lsaquo: 8249, rsaquo: 8250, oline: 8254, frasl: 8260, euro: 8364, image: 8465, weierp: 8472, real: 8476, trade: 8482, alefsym: 8501, larr: 8592, uarr: 8593, rarr: 8594, darr: 8595, harr: 8596, crarr: 8629, lArr: 8656, uArr: 8657, rArr: 8658, dArr: 8659, hArr: 8660, forall: 8704, part: 8706, exist: 8707, empty: 8709, nabla: 8711, isin: 8712, notin: 8713, ni: 8715, prod: 8719, sum: 8721, minus: 8722, lowast: 8727, radic: 8730, prop: 8733, infin: 8734, ang: 8736, and: 8743, or: 8744, cap: 8745, cup: 8746, 'int': 8747, there4: 8756, sim: 8764, cong: 8773, asymp: 8776, ne: 8800, equiv: 8801, le: 8804, ge: 8805, sub: 8834, sup: 8835, nsub: 8836, sube: 8838, supe: 8839, oplus: 8853, otimes: 8855, perp: 8869, sdot: 8901, lceil: 8968, rceil: 8969, lfloor: 8970, rfloor: 8971, lang: 9001, rang: 9002, loz: 9674, spades: 9824, clubs: 9827, hearts: 9829, diams: 9830 };\n  var controlCharacters = [8364, 129, 8218, 402, 8222, 8230, 8224, 8225, 710, 8240, 352, 8249, 338, 141, 381, 143, 144, 8216, 8217, 8220, 8221, 8226, 8211, 8212, 732, 8482, 353, 8250, 339, 157, 382, 376];\n  var entityPattern = new RegExp('&(#?(?:x[\\\\w\\\\d]+|\\\\d+|' + Object.keys(htmlEntities).join('|') + '));?', 'g');\n\n  function decodeCharacterReferences(html) {\n  \treturn html.replace(entityPattern, function (match, entity) {\n  \t\tvar code;\n\n  \t\t// Handle named entities\n  \t\tif (entity[0] !== '#') {\n  \t\t\tcode = htmlEntities[entity];\n  \t\t} else if (entity[1] === 'x') {\n  \t\t\tcode = parseInt(entity.substring(2), 16);\n  \t\t} else {\n  \t\t\tcode = parseInt(entity.substring(1), 10);\n  \t\t}\n\n  \t\tif (!code) {\n  \t\t\treturn match;\n  \t\t}\n\n  \t\treturn String.fromCharCode(validateCode(code));\n  \t});\n  }\n\n  var lessThan = /</g;\n  var greaterThan = />/g;\n  var amp = /&/g;\n\n  function escapeHtml(str) {\n  \treturn str.replace(amp, '&amp;').replace(lessThan, '&lt;').replace(greaterThan, '&gt;');\n  }\n\n  // some code points are verboten. If we were inserting HTML, the browser would replace the illegal\n  // code points with alternatives in some cases - since we're bypassing that mechanism, we need\n  // to replace them ourselves\n  //\n  // Source: http://en.wikipedia.org/wiki/Character_encodings_in_HTML#Illegal_characters\n  function validateCode(code) {\n  \tif (!code) {\n  \t\treturn 65533;\n  \t}\n\n  \t// line feed becomes generic whitespace\n  \tif (code === 10) {\n  \t\treturn 32;\n  \t}\n\n  \t// ASCII range. (Why someone would use HTML entities for ASCII characters I don't know, but...)\n  \tif (code < 128) {\n  \t\treturn code;\n  \t}\n\n  \t// code points 128-159 are dealt with leniently by browsers, but they're incorrect. We need\n  \t// to correct the mistake or we'll end up with missing  signs and so on\n  \tif (code <= 159) {\n  \t\treturn controlCharacters[code - 128];\n  \t}\n\n  \t// basic multilingual plane\n  \tif (code < 55296) {\n  \t\treturn code;\n  \t}\n\n  \t// UTF-16 surrogate halves\n  \tif (code <= 57343) {\n  \t\treturn 65533;\n  \t}\n\n  \t// rest of the basic multilingual plane\n  \tif (code <= 65535) {\n  \t\treturn code;\n  \t}\n\n  \treturn 65533;\n  }\n\n  function readText(parser) {\n  \tvar index, remaining, disallowed, barrier;\n\n  \tremaining = parser.remaining();\n\n  \tif (parser.textOnlyMode) {\n  \t\tdisallowed = parser.tags.map(function (t) {\n  \t\t\treturn t.open;\n  \t\t});\n  \t\tdisallowed = disallowed.concat(parser.tags.map(function (t) {\n  \t\t\treturn '\\\\' + t.open;\n  \t\t}));\n\n  \t\tindex = getLowestIndex(remaining, disallowed);\n  \t} else {\n  \t\tbarrier = parser.inside ? '</' + parser.inside : '<';\n\n  \t\tif (parser.inside && !parser.interpolate[parser.inside]) {\n  \t\t\tindex = remaining.indexOf(barrier);\n  \t\t} else {\n  \t\t\tdisallowed = parser.tags.map(function (t) {\n  \t\t\t\treturn t.open;\n  \t\t\t});\n  \t\t\tdisallowed = disallowed.concat(parser.tags.map(function (t) {\n  \t\t\t\treturn '\\\\' + t.open;\n  \t\t\t}));\n\n  \t\t\t// http://developers.whatwg.org/syntax.html#syntax-attributes\n  \t\t\tif (parser.inAttribute === true) {\n  \t\t\t\t// we're inside an unquoted attribute value\n  \t\t\t\tdisallowed.push('\"', '\\'', '=', '<', '>', '`');\n  \t\t\t} else if (parser.inAttribute) {\n  \t\t\t\t// quoted attribute value\n  \t\t\t\tdisallowed.push(parser.inAttribute);\n  \t\t\t} else {\n  \t\t\t\tdisallowed.push(barrier);\n  \t\t\t}\n\n  \t\t\tindex = getLowestIndex(remaining, disallowed);\n  \t\t}\n  \t}\n\n  \tif (!index) {\n  \t\treturn null;\n  \t}\n\n  \tif (index === -1) {\n  \t\tindex = remaining.length;\n  \t}\n\n  \tparser.pos += index;\n\n  \tif (parser.inside && parser.inside !== 'textarea' || parser.textOnlyMode) {\n  \t\treturn remaining.substr(0, index);\n  \t} else {\n  \t\treturn decodeCharacterReferences(remaining.substr(0, index));\n  \t}\n  }\n\n  var leadingLinebreak = /^\\s*\\r?\\n/;\n  var trailingLinebreak = /\\r?\\n\\s*$/;\n  function stripStandalones (items) {\n  \tvar i, current, backOne, backTwo, lastSectionItem;\n\n  \tfor (i = 1; i < items.length; i += 1) {\n  \t\tcurrent = items[i];\n  \t\tbackOne = items[i - 1];\n  \t\tbackTwo = items[i - 2];\n\n  \t\t// if we're at the end of a [text][comment][text] sequence...\n  \t\tif (isString(current) && isComment(backOne) && isString(backTwo)) {\n\n  \t\t\t// ... and the comment is a standalone (i.e. line breaks either side)...\n  \t\t\tif (trailingLinebreak.test(backTwo) && leadingLinebreak.test(current)) {\n\n  \t\t\t\t// ... then we want to remove the whitespace after the first line break\n  \t\t\t\titems[i - 2] = backTwo.replace(trailingLinebreak, '\\n');\n\n  \t\t\t\t// and the leading line break of the second text token\n  \t\t\t\titems[i] = current.replace(leadingLinebreak, '');\n  \t\t\t}\n  \t\t}\n\n  \t\t// if the current item is a section, and it is preceded by a linebreak, and\n  \t\t// its first item is a linebreak...\n  \t\tif (isSection(current) && isString(backOne)) {\n  \t\t\tif (trailingLinebreak.test(backOne) && isString(current.f[0]) && leadingLinebreak.test(current.f[0])) {\n  \t\t\t\titems[i - 1] = backOne.replace(trailingLinebreak, '\\n');\n  \t\t\t\tcurrent.f[0] = current.f[0].replace(leadingLinebreak, '');\n  \t\t\t}\n  \t\t}\n\n  \t\t// if the last item was a section, and it is followed by a linebreak, and\n  \t\t// its last item is a linebreak...\n  \t\tif (isString(current) && isSection(backOne)) {\n  \t\t\tlastSectionItem = lastItem(backOne.f);\n\n  \t\t\tif (isString(lastSectionItem) && trailingLinebreak.test(lastSectionItem) && leadingLinebreak.test(current)) {\n  \t\t\t\tbackOne.f[backOne.f.length - 1] = lastSectionItem.replace(trailingLinebreak, '\\n');\n  \t\t\t\titems[i] = current.replace(leadingLinebreak, '');\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \treturn items;\n  }\n\n  function isString(item) {\n  \treturn typeof item === 'string';\n  }\n\n  function isComment(item) {\n  \treturn item.t === COMMENT || item.t === DELIMCHANGE;\n  }\n\n  function isSection(item) {\n  \treturn (item.t === SECTION || item.t === INVERTED) && item.f;\n  }\n\n  function trimWhitespace (items, leadingPattern, trailingPattern) {\n  \tvar item;\n\n  \tif (leadingPattern) {\n  \t\titem = items[0];\n  \t\tif (typeof item === 'string') {\n  \t\t\titem = item.replace(leadingPattern, '');\n\n  \t\t\tif (!item) {\n  \t\t\t\titems.shift();\n  \t\t\t} else {\n  \t\t\t\titems[0] = item;\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \tif (trailingPattern) {\n  \t\titem = lastItem(items);\n  \t\tif (typeof item === 'string') {\n  \t\t\titem = item.replace(trailingPattern, '');\n\n  \t\t\tif (!item) {\n  \t\t\t\titems.pop();\n  \t\t\t} else {\n  \t\t\t\titems[items.length - 1] = item;\n  \t\t\t}\n  \t\t}\n  \t}\n  }\n\n  var contiguousWhitespace = /[ \\t\\f\\r\\n]+/g;\n  var preserveWhitespaceElements = /^(?:pre|script|style|textarea)$/i;\n  var leadingWhitespace$1 = /^[ \\t\\f\\r\\n]+/;\n  var trailingWhitespace = /[ \\t\\f\\r\\n]+$/;\n  var leadingNewLine = /^(?:\\r\\n|\\r|\\n)/;\n  var trailingNewLine = /(?:\\r\\n|\\r|\\n)$/;\n  function cleanup(items, stripComments, preserveWhitespace, removeLeadingWhitespace, removeTrailingWhitespace) {\n  \tvar i, item, previousItem, nextItem, preserveWhitespaceInsideFragment, removeLeadingWhitespaceInsideFragment, removeTrailingWhitespaceInsideFragment, key;\n\n  \t// First pass - remove standalones and comments etc\n  \tstripStandalones(items);\n\n  \ti = items.length;\n  \twhile (i--) {\n  \t\titem = items[i];\n\n  \t\t// Remove delimiter changes, unsafe elements etc\n  \t\tif (item.exclude) {\n  \t\t\titems.splice(i, 1);\n  \t\t}\n\n  \t\t// Remove comments, unless we want to keep them\n  \t\telse if (stripComments && item.t === COMMENT) {\n  \t\t\t\titems.splice(i, 1);\n  \t\t\t}\n  \t}\n\n  \t// If necessary, remove leading and trailing whitespace\n  \ttrimWhitespace(items, removeLeadingWhitespace ? leadingWhitespace$1 : null, removeTrailingWhitespace ? trailingWhitespace : null);\n\n  \ti = items.length;\n  \twhile (i--) {\n  \t\titem = items[i];\n\n  \t\t// Recurse\n  \t\tif (item.f) {\n  \t\t\tvar isPreserveWhitespaceElement = item.t === ELEMENT && preserveWhitespaceElements.test(item.e);\n  \t\t\tpreserveWhitespaceInsideFragment = preserveWhitespace || isPreserveWhitespaceElement;\n\n  \t\t\tif (!preserveWhitespace && isPreserveWhitespaceElement) {\n  \t\t\t\ttrimWhitespace(item.f, leadingNewLine, trailingNewLine);\n  \t\t\t}\n\n  \t\t\tif (!preserveWhitespaceInsideFragment) {\n  \t\t\t\tpreviousItem = items[i - 1];\n  \t\t\t\tnextItem = items[i + 1];\n\n  \t\t\t\t// if the previous item was a text item with trailing whitespace,\n  \t\t\t\t// remove leading whitespace inside the fragment\n  \t\t\t\tif (!previousItem || typeof previousItem === 'string' && trailingWhitespace.test(previousItem)) {\n  \t\t\t\t\tremoveLeadingWhitespaceInsideFragment = true;\n  \t\t\t\t}\n\n  \t\t\t\t// and vice versa\n  \t\t\t\tif (!nextItem || typeof nextItem === 'string' && leadingWhitespace$1.test(nextItem)) {\n  \t\t\t\t\tremoveTrailingWhitespaceInsideFragment = true;\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\tcleanup(item.f, stripComments, preserveWhitespaceInsideFragment, removeLeadingWhitespaceInsideFragment, removeTrailingWhitespaceInsideFragment);\n  \t\t}\n\n  \t\t// Split if-else blocks into two (an if, and an unless)\n  \t\tif (item.l) {\n  \t\t\tcleanup(item.l.f, stripComments, preserveWhitespace, removeLeadingWhitespaceInsideFragment, removeTrailingWhitespaceInsideFragment);\n\n  \t\t\titems.splice(i + 1, 0, item.l);\n  \t\t\tdelete item.l; // TODO would be nice if there was a way around this\n  \t\t}\n\n  \t\t// Clean up element attributes\n  \t\tif (item.a) {\n  \t\t\tfor (key in item.a) {\n  \t\t\t\tif (item.a.hasOwnProperty(key) && typeof item.a[key] !== 'string') {\n  \t\t\t\t\tcleanup(item.a[key], stripComments, preserveWhitespace, removeLeadingWhitespaceInsideFragment, removeTrailingWhitespaceInsideFragment);\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\t// Clean up conditional attributes\n  \t\tif (item.m) {\n  \t\t\tcleanup(item.m, stripComments, preserveWhitespace, removeLeadingWhitespaceInsideFragment, removeTrailingWhitespaceInsideFragment);\n  \t\t}\n\n  \t\t// Clean up event handlers\n  \t\tif (item.v) {\n  \t\t\tfor (key in item.v) {\n  \t\t\t\tif (item.v.hasOwnProperty(key)) {\n  \t\t\t\t\t// clean up names\n  \t\t\t\t\tif (isArray(item.v[key].n)) {\n  \t\t\t\t\t\tcleanup(item.v[key].n, stripComments, preserveWhitespace, removeLeadingWhitespaceInsideFragment, removeTrailingWhitespaceInsideFragment);\n  \t\t\t\t\t}\n\n  \t\t\t\t\t// clean up params\n  \t\t\t\t\tif (isArray(item.v[key].d)) {\n  \t\t\t\t\t\tcleanup(item.v[key].d, stripComments, preserveWhitespace, removeLeadingWhitespaceInsideFragment, removeTrailingWhitespaceInsideFragment);\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \t// final pass - fuse text nodes together\n  \ti = items.length;\n  \twhile (i--) {\n  \t\tif (typeof items[i] === 'string') {\n  \t\t\tif (typeof items[i + 1] === 'string') {\n  \t\t\t\titems[i] = items[i] + items[i + 1];\n  \t\t\t\titems.splice(i + 1, 1);\n  \t\t\t}\n\n  \t\t\tif (!preserveWhitespace) {\n  \t\t\t\titems[i] = items[i].replace(contiguousWhitespace, ' ');\n  \t\t\t}\n\n  \t\t\tif (items[i] === '') {\n  \t\t\t\titems.splice(i, 1);\n  \t\t\t}\n  \t\t}\n  \t}\n  }\n\n  var delimiterChangePattern = /^[^\\s=]+/;\n  var whitespacePattern = /^\\s+/;\n  function readDelimiterChange(parser) {\n  \tvar start, opening, closing;\n\n  \tif (!parser.matchString('=')) {\n  \t\treturn null;\n  \t}\n\n  \tstart = parser.pos;\n\n  \t// allow whitespace before new opening delimiter\n  \tparser.allowWhitespace();\n\n  \topening = parser.matchPattern(delimiterChangePattern);\n  \tif (!opening) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \t// allow whitespace (in fact, it's necessary...)\n  \tif (!parser.matchPattern(whitespacePattern)) {\n  \t\treturn null;\n  \t}\n\n  \tclosing = parser.matchPattern(delimiterChangePattern);\n  \tif (!closing) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \t// allow whitespace before closing '='\n  \tparser.allowWhitespace();\n\n  \tif (!parser.matchString('=')) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \treturn [opening, closing];\n  }\n\n  var delimiterChangeToken = { t: DELIMCHANGE, exclude: true };\n  function readMustache(parser) {\n  \tvar mustache, i;\n\n  \t// If we're inside a <script> or <style> tag, and we're not\n  \t// interpolating, bug out\n  \tif (parser.interpolate[parser.inside] === false) {\n  \t\treturn null;\n  \t}\n\n  \tfor (i = 0; i < parser.tags.length; i += 1) {\n  \t\tif (mustache = readMustacheOfType(parser, parser.tags[i])) {\n  \t\t\treturn mustache;\n  \t\t}\n  \t}\n  }\n\n  function readMustacheOfType(parser, tag) {\n  \tvar start, mustache, reader, i;\n\n  \tstart = parser.pos;\n\n  \tif (parser.matchString('\\\\' + tag.open)) {\n  \t\tif (start === 0 || parser.str[start - 1] !== '\\\\') {\n  \t\t\treturn tag.open;\n  \t\t}\n  \t} else if (!parser.matchString(tag.open)) {\n  \t\treturn null;\n  \t}\n\n  \t// delimiter change?\n  \tif (mustache = readDelimiterChange(parser)) {\n  \t\t// find closing delimiter or abort...\n  \t\tif (!parser.matchString(tag.close)) {\n  \t\t\treturn null;\n  \t\t}\n\n  \t\t// ...then make the switch\n  \t\ttag.open = mustache[0];\n  \t\ttag.close = mustache[1];\n  \t\tparser.sortMustacheTags();\n\n  \t\treturn delimiterChangeToken;\n  \t}\n\n  \tparser.allowWhitespace();\n\n  \t// illegal section closer\n  \tif (parser.matchString('/')) {\n  \t\tparser.pos -= 1;\n  \t\tvar rewind = parser.pos;\n  \t\tif (!readNumberLiteral(parser)) {\n  \t\t\tparser.pos = rewind - tag.close.length;\n  \t\t\tparser.error('Attempted to close a section that wasn\\'t open');\n  \t\t} else {\n  \t\t\tparser.pos = rewind;\n  \t\t}\n  \t}\n\n  \tfor (i = 0; i < tag.readers.length; i += 1) {\n  \t\treader = tag.readers[i];\n\n  \t\tif (mustache = reader(parser, tag)) {\n  \t\t\tif (tag.isStatic) {\n  \t\t\t\tmustache.s = true; // TODO make this `1` instead - more compact\n  \t\t\t}\n\n  \t\t\tif (parser.includeLinePositions) {\n  \t\t\t\tmustache.p = parser.getLinePos(start);\n  \t\t\t}\n\n  \t\t\treturn mustache;\n  \t\t}\n  \t}\n\n  \tparser.pos = start;\n  \treturn null;\n  }\n\n  var closingTagPattern = /^([a-zA-Z]{1,}:?[a-zA-Z0-9\\-]*)\\s*\\>/;\n  function readClosingTag(parser) {\n  \tvar start, tag;\n\n  \tstart = parser.pos;\n\n  \t// are we looking at a closing tag?\n  \tif (!parser.matchString('</')) {\n  \t\treturn null;\n  \t}\n\n  \tif (tag = parser.matchPattern(closingTagPattern)) {\n  \t\tif (parser.inside && tag !== parser.inside) {\n  \t\t\tparser.pos = start;\n  \t\t\treturn null;\n  \t\t}\n\n  \t\treturn {\n  \t\t\tt: CLOSING_TAG,\n  \t\t\te: tag\n  \t\t};\n  \t}\n\n  \t// We have an illegal closing tag, report it\n  \tparser.pos -= 2;\n  \tparser.error('Illegal closing tag');\n  }\n\n  var attributeNamePattern = /^[^\\s\"'>\\/=]+/;\n  var unquotedAttributeValueTextPattern = /^[^\\s\"'=<>`]+/;\n  function readAttribute(parser) {\n  \tvar attr, name, value;\n\n  \tparser.allowWhitespace();\n\n  \tname = parser.matchPattern(attributeNamePattern);\n  \tif (!name) {\n  \t\treturn null;\n  \t}\n\n  \tattr = { name: name };\n\n  \tvalue = readAttributeValue(parser);\n  \tif (value != null) {\n  \t\t// not null/undefined\n  \t\tattr.value = value;\n  \t}\n\n  \treturn attr;\n  }\n\n  function readAttributeValue(parser) {\n  \tvar start, valueStart, startDepth, value;\n\n  \tstart = parser.pos;\n\n  \t// next character must be `=`, `/`, `>` or whitespace\n  \tif (!/[=\\/>\\s]/.test(parser.nextChar())) {\n  \t\tparser.error('Expected `=`, `/`, `>` or whitespace');\n  \t}\n\n  \tparser.allowWhitespace();\n\n  \tif (!parser.matchString('=')) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \tparser.allowWhitespace();\n\n  \tvalueStart = parser.pos;\n  \tstartDepth = parser.sectionDepth;\n\n  \tvalue = readQuotedAttributeValue(parser, '\\'') || readQuotedAttributeValue(parser, '\"') || readUnquotedAttributeValue(parser);\n\n  \tif (value === null) {\n  \t\tparser.error('Expected valid attribute value');\n  \t}\n\n  \tif (parser.sectionDepth !== startDepth) {\n  \t\tparser.pos = valueStart;\n  \t\tparser.error('An attribute value must contain as many opening section tags as closing section tags');\n  \t}\n\n  \tif (!value.length) {\n  \t\treturn '';\n  \t}\n\n  \tif (value.length === 1 && typeof value[0] === 'string') {\n  \t\treturn decodeCharacterReferences(value[0]);\n  \t}\n\n  \treturn value;\n  }\n\n  function readUnquotedAttributeValueToken(parser) {\n  \tvar start, text, haystack, needles, index;\n\n  \tstart = parser.pos;\n\n  \ttext = parser.matchPattern(unquotedAttributeValueTextPattern);\n\n  \tif (!text) {\n  \t\treturn null;\n  \t}\n\n  \thaystack = text;\n  \tneedles = parser.tags.map(function (t) {\n  \t\treturn t.open;\n  \t}); // TODO refactor... we do this in readText.js as well\n\n  \tif ((index = getLowestIndex(haystack, needles)) !== -1) {\n  \t\ttext = text.substr(0, index);\n  \t\tparser.pos = start + text.length;\n  \t}\n\n  \treturn text;\n  }\n\n  function readUnquotedAttributeValue(parser) {\n  \tvar tokens, token;\n\n  \tparser.inAttribute = true;\n\n  \ttokens = [];\n\n  \ttoken = readMustache(parser) || readUnquotedAttributeValueToken(parser);\n  \twhile (token !== null) {\n  \t\ttokens.push(token);\n  \t\ttoken = readMustache(parser) || readUnquotedAttributeValueToken(parser);\n  \t}\n\n  \tif (!tokens.length) {\n  \t\treturn null;\n  \t}\n\n  \tparser.inAttribute = false;\n  \treturn tokens;\n  }\n\n  function readQuotedAttributeValue(parser, quoteMark) {\n  \tvar start, tokens, token;\n\n  \tstart = parser.pos;\n\n  \tif (!parser.matchString(quoteMark)) {\n  \t\treturn null;\n  \t}\n\n  \tparser.inAttribute = quoteMark;\n\n  \ttokens = [];\n\n  \ttoken = readMustache(parser) || readQuotedStringToken(parser, quoteMark);\n  \twhile (token !== null) {\n  \t\ttokens.push(token);\n  \t\ttoken = readMustache(parser) || readQuotedStringToken(parser, quoteMark);\n  \t}\n\n  \tif (!parser.matchString(quoteMark)) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \tparser.inAttribute = false;\n\n  \treturn tokens;\n  }\n\n  function readQuotedStringToken(parser, quoteMark) {\n  \tvar haystack = parser.remaining();\n\n  \tvar needles = parser.tags.map(function (t) {\n  \t\treturn t.open;\n  \t}); // TODO refactor... we do this in readText.js as well\n  \tneedles.push(quoteMark);\n\n  \tvar index = getLowestIndex(haystack, needles);\n\n  \tif (index === -1) {\n  \t\tparser.error('Quoted attribute value must have a closing quote');\n  \t}\n\n  \tif (!index) {\n  \t\treturn null;\n  \t}\n\n  \tparser.pos += index;\n  \treturn haystack.substr(0, index);\n  }\n\n  var Parser;\n  var ParseError;\n  var leadingWhitespace = /^\\s+/;\n  ParseError = function (message) {\n  \tthis.name = 'ParseError';\n  \tthis.message = message;\n  \ttry {\n  \t\tthrow new Error(message);\n  \t} catch (e) {\n  \t\tthis.stack = e.stack;\n  \t}\n  };\n\n  ParseError.prototype = Error.prototype;\n\n  Parser = function (str, options) {\n  \tvar items,\n  \t    item,\n  \t    lineStart = 0;\n\n  \tthis.str = str;\n  \tthis.options = options || {};\n  \tthis.pos = 0;\n\n  \tthis.lines = this.str.split('\\n');\n  \tthis.lineEnds = this.lines.map(function (line) {\n  \t\tvar lineEnd = lineStart + line.length + 1; // +1 for the newline\n\n  \t\tlineStart = lineEnd;\n  \t\treturn lineEnd;\n  \t}, 0);\n\n  \t// Custom init logic\n  \tif (this.init) this.init(str, options);\n\n  \titems = [];\n\n  \twhile (this.pos < this.str.length && (item = this.read())) {\n  \t\titems.push(item);\n  \t}\n\n  \tthis.leftover = this.remaining();\n  \tthis.result = this.postProcess ? this.postProcess(items, options) : items;\n  };\n\n  Parser.prototype = {\n  \tread: function (converters) {\n  \t\tvar pos, i, len, item;\n\n  \t\tif (!converters) converters = this.converters;\n\n  \t\tpos = this.pos;\n\n  \t\tlen = converters.length;\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tthis.pos = pos; // reset for each attempt\n\n  \t\t\tif (item = converters[i](this)) {\n  \t\t\t\treturn item;\n  \t\t\t}\n  \t\t}\n\n  \t\treturn null;\n  \t},\n\n  \tgetLinePos: function (char) {\n  \t\tvar lineNum = 0,\n  \t\t    lineStart = 0,\n  \t\t    columnNum;\n\n  \t\twhile (char >= this.lineEnds[lineNum]) {\n  \t\t\tlineStart = this.lineEnds[lineNum];\n  \t\t\tlineNum += 1;\n  \t\t}\n\n  \t\tcolumnNum = char - lineStart;\n  \t\treturn [lineNum + 1, columnNum + 1, char]; // line/col should be one-based, not zero-based!\n  \t},\n\n  \terror: function (message) {\n  \t\tvar pos = this.getLinePos(this.pos);\n  \t\tvar lineNum = pos[0];\n  \t\tvar columnNum = pos[1];\n\n  \t\tvar line = this.lines[pos[0] - 1];\n  \t\tvar numTabs = 0;\n  \t\tvar annotation = line.replace(/\\t/g, function (match, char) {\n  \t\t\tif (char < pos[1]) {\n  \t\t\t\tnumTabs += 1;\n  \t\t\t}\n\n  \t\t\treturn '  ';\n  \t\t}) + '\\n' + new Array(pos[1] + numTabs).join(' ') + '^----';\n\n  \t\tvar error = new ParseError(message + ' at line ' + lineNum + ' character ' + columnNum + ':\\n' + annotation);\n\n  \t\terror.line = pos[0];\n  \t\terror.character = pos[1];\n  \t\terror.shortMessage = message;\n\n  \t\tthrow error;\n  \t},\n\n  \tmatchString: function (string) {\n  \t\tif (this.str.substr(this.pos, string.length) === string) {\n  \t\t\tthis.pos += string.length;\n  \t\t\treturn string;\n  \t\t}\n  \t},\n\n  \tmatchPattern: function (pattern) {\n  \t\tvar match;\n\n  \t\tif (match = pattern.exec(this.remaining())) {\n  \t\t\tthis.pos += match[0].length;\n  \t\t\treturn match[1] || match[0];\n  \t\t}\n  \t},\n\n  \tallowWhitespace: function () {\n  \t\tthis.matchPattern(leadingWhitespace);\n  \t},\n\n  \tremaining: function () {\n  \t\treturn this.str.substring(this.pos);\n  \t},\n\n  \tnextChar: function () {\n  \t\treturn this.str.charAt(this.pos);\n  \t}\n  };\n\n  Parser.extend = function (proto) {\n  \tvar Parent = this,\n  \t    Child,\n  \t    key;\n\n  \tChild = function (str, options) {\n  \t\tParser.call(this, str, options);\n  \t};\n\n  \tChild.prototype = create(Parent.prototype);\n\n  \tfor (key in proto) {\n  \t\tif (hasOwn.call(proto, key)) {\n  \t\t\tChild.prototype[key] = proto[key];\n  \t\t}\n  \t}\n\n  \tChild.extend = Parser.extend;\n  \treturn Child;\n  };\n\n  var Parser$1 = Parser;\n\n  // simple JSON parser, without the restrictions of JSON parse\n  // (i.e. having to double-quote keys).\n  //\n  // If passed a hash of values as the second argument, ${placeholders}\n  // will be replaced with those values\n\n  var specials = {\n  \t'true': true,\n  \t'false': false,\n  \t'null': null,\n  \tundefined: undefined\n  };\n\n  var specialsPattern = new RegExp('^(?:' + Object.keys(specials).join('|') + ')');\n  var numberPattern = /^(?:[+-]?)(?:(?:(?:0|[1-9]\\d*)?\\.\\d+)|(?:(?:0|[1-9]\\d*)\\.)|(?:0|[1-9]\\d*))(?:[eE][+-]?\\d+)?/;\n  var placeholderPattern = /\\$\\{([^\\}]+)\\}/g;\n  var placeholderAtStartPattern = /^\\$\\{([^\\}]+)\\}/;\n  var onlyWhitespace = /^\\s*$/;\n\n  var JsonParser = Parser$1.extend({\n  \tinit: function (str, options) {\n  \t\tthis.values = options.values;\n  \t\tthis.allowWhitespace();\n  \t},\n\n  \tpostProcess: function (result) {\n  \t\tif (result.length !== 1 || !onlyWhitespace.test(this.leftover)) {\n  \t\t\treturn null;\n  \t\t}\n\n  \t\treturn { value: result[0].v };\n  \t},\n\n  \tconverters: [function getPlaceholder(parser) {\n  \t\tif (!parser.values) return null;\n\n  \t\tvar placeholder = parser.matchPattern(placeholderAtStartPattern);\n\n  \t\tif (placeholder && parser.values.hasOwnProperty(placeholder)) {\n  \t\t\treturn { v: parser.values[placeholder] };\n  \t\t}\n  \t}, function getSpecial(parser) {\n  \t\tvar special = parser.matchPattern(specialsPattern);\n  \t\tif (special) return { v: specials[special] };\n  \t}, function getNumber(parser) {\n  \t\tvar number = parser.matchPattern(numberPattern);\n  \t\tif (number) return { v: +number };\n  \t}, function getString(parser) {\n  \t\tvar stringLiteral = readStringLiteral(parser);\n  \t\tvar values = parser.values;\n\n  \t\tif (stringLiteral && values) {\n  \t\t\treturn {\n  \t\t\t\tv: stringLiteral.v.replace(placeholderPattern, function (match, $1) {\n  \t\t\t\t\treturn $1 in values ? values[$1] : $1;\n  \t\t\t\t})\n  \t\t\t};\n  \t\t}\n\n  \t\treturn stringLiteral;\n  \t}, function getObject(parser) {\n  \t\tif (!parser.matchString('{')) return null;\n\n  \t\tvar result = {};\n\n  \t\tparser.allowWhitespace();\n\n  \t\tif (parser.matchString('}')) {\n  \t\t\treturn { v: result };\n  \t\t}\n\n  \t\tvar pair = undefined;\n  \t\twhile (pair = getKeyValuePair(parser)) {\n  \t\t\tresult[pair.key] = pair.value;\n\n  \t\t\tparser.allowWhitespace();\n\n  \t\t\tif (parser.matchString('}')) {\n  \t\t\t\treturn { v: result };\n  \t\t\t}\n\n  \t\t\tif (!parser.matchString(',')) {\n  \t\t\t\treturn null;\n  \t\t\t}\n  \t\t}\n\n  \t\treturn null;\n  \t}, function getArray(parser) {\n  \t\tif (!parser.matchString('[')) return null;\n\n  \t\tvar result = [];\n\n  \t\tparser.allowWhitespace();\n\n  \t\tif (parser.matchString(']')) {\n  \t\t\treturn { v: result };\n  \t\t}\n\n  \t\tvar valueToken = undefined;\n  \t\twhile (valueToken = parser.read()) {\n  \t\t\tresult.push(valueToken.v);\n\n  \t\t\tparser.allowWhitespace();\n\n  \t\t\tif (parser.matchString(']')) {\n  \t\t\t\treturn { v: result };\n  \t\t\t}\n\n  \t\t\tif (!parser.matchString(',')) {\n  \t\t\t\treturn null;\n  \t\t\t}\n\n  \t\t\tparser.allowWhitespace();\n  \t\t}\n\n  \t\treturn null;\n  \t}]\n  });\n\n  function getKeyValuePair(parser) {\n  \tparser.allowWhitespace();\n\n  \tvar key = readKey(parser);\n\n  \tif (!key) return null;\n\n  \tvar pair = { key: key };\n\n  \tparser.allowWhitespace();\n  \tif (!parser.matchString(':')) {\n  \t\treturn null;\n  \t}\n  \tparser.allowWhitespace();\n\n  \tvar valueToken = parser.read();\n\n  \tif (!valueToken) return null;\n\n  \tpair.value = valueToken.v;\n  \treturn pair;\n  }\n\n  function parseJSON (str, values) {\n  \tvar parser = new JsonParser(str, { values: values });\n  \treturn parser.result;\n  }\n\n  var methodCallPattern = /^([a-zA-Z_$][a-zA-Z_$0-9]*)\\(/;\n  var methodCallExcessPattern = /\\)\\s*$/;\n  var ExpressionParser;\n  ExpressionParser = Parser$1.extend({\n  \tconverters: [readExpression]\n  });\n\n  // TODO clean this up, it's shocking\n\n  function processDirective(tokens, parentParser) {\n  \tvar result, match, parser, args, token, colonIndex, directiveName, directiveArgs, parsed;\n\n  \tif (typeof tokens === 'string') {\n  \t\tif (match = methodCallPattern.exec(tokens)) {\n  \t\t\tvar end = tokens.lastIndexOf(')');\n\n  \t\t\t// check for invalid method calls\n  \t\t\tif (!methodCallExcessPattern.test(tokens)) {\n  \t\t\t\tparentParser.error('Invalid input after method call expression \\'' + tokens.slice(end + 1) + '\\'');\n  \t\t\t}\n\n  \t\t\tresult = { m: match[1] };\n  \t\t\tvar sliced = tokens.slice(result.m.length + 1, end);\n\n  \t\t\tif (sliced === '...arguments') {\n  \t\t\t\t// TODO: what the heck should this be???\n  \t\t\t\t// maybe ExpressionParser should understand ES6???\n  \t\t\t\tresult.g = true;\n  \t\t\t} else {\n  \t\t\t\targs = '[' + sliced + ']';\n  \t\t\t\tparser = new ExpressionParser(args);\n  \t\t\t\tresult.a = flattenExpression(parser.result[0]);\n  \t\t\t}\n\n  \t\t\treturn result;\n  \t\t}\n\n  \t\tif (tokens.indexOf(':') === -1) {\n  \t\t\treturn tokens.trim();\n  \t\t}\n\n  \t\ttokens = [tokens];\n  \t}\n\n  \tresult = {};\n\n  \tdirectiveName = [];\n  \tdirectiveArgs = [];\n\n  \tif (tokens) {\n  \t\twhile (tokens.length) {\n  \t\t\ttoken = tokens.shift();\n\n  \t\t\tif (typeof token === 'string') {\n  \t\t\t\tcolonIndex = token.indexOf(':');\n\n  \t\t\t\tif (colonIndex === -1) {\n  \t\t\t\t\tdirectiveName.push(token);\n  \t\t\t\t} else {\n  \t\t\t\t\t// is the colon the first character?\n  \t\t\t\t\tif (colonIndex) {\n  \t\t\t\t\t\t// no\n  \t\t\t\t\t\tdirectiveName.push(token.substr(0, colonIndex));\n  \t\t\t\t\t}\n\n  \t\t\t\t\t// if there is anything after the colon in this token, treat\n  \t\t\t\t\t// it as the first token of the directiveArgs fragment\n  \t\t\t\t\tif (token.length > colonIndex + 1) {\n  \t\t\t\t\t\tdirectiveArgs[0] = token.substring(colonIndex + 1);\n  \t\t\t\t\t}\n\n  \t\t\t\t\tbreak;\n  \t\t\t\t}\n  \t\t\t} else {\n  \t\t\t\tdirectiveName.push(token);\n  \t\t\t}\n  \t\t}\n\n  \t\tdirectiveArgs = directiveArgs.concat(tokens);\n  \t}\n\n  \tif (!directiveName.length) {\n  \t\tresult = '';\n  \t} else if (directiveArgs.length || typeof directiveName !== 'string') {\n  \t\tresult = {\n  \t\t\t// TODO is this really necessary? just use the array\n  \t\t\tn: directiveName.length === 1 && typeof directiveName[0] === 'string' ? directiveName[0] : directiveName\n  \t\t};\n\n  \t\tif (directiveArgs.length === 1 && typeof directiveArgs[0] === 'string') {\n  \t\t\tparsed = parseJSON('[' + directiveArgs[0] + ']');\n  \t\t\tresult.a = parsed ? parsed.value : [directiveArgs[0].trim()];\n  \t\t} else {\n  \t\t\tresult.d = directiveArgs;\n  \t\t}\n  \t} else {\n  \t\tresult = directiveName;\n  \t}\n\n  \treturn result;\n  }\n\n  var tagNamePattern = /^[a-zA-Z]{1,}:?[a-zA-Z0-9\\-]*/;\n  var validTagNameFollower = /^[\\s\\n\\/>]/;\n  var onPattern = /^on/;\n  var proxyEventPattern = /^on-([a-zA-Z\\\\*\\\\.$_][a-zA-Z\\\\*\\\\.$_0-9\\-]+)$/;\n  var reservedEventNames = /^(?:change|reset|teardown|update|construct|config|init|render|unrender|detach|insert)$/;\n  var directives = { 'intro-outro': 't0', intro: 't1', outro: 't2', decorator: 'o' };\n  var exclude = { exclude: true };\n  var disallowedContents;\n  // based on http://developers.whatwg.org/syntax.html#syntax-tag-omission\n  disallowedContents = {\n  \tli: ['li'],\n  \tdt: ['dt', 'dd'],\n  \tdd: ['dt', 'dd'],\n  \tp: 'address article aside blockquote div dl fieldset footer form h1 h2 h3 h4 h5 h6 header hgroup hr main menu nav ol p pre section table ul'.split(' '),\n  \trt: ['rt', 'rp'],\n  \trp: ['rt', 'rp'],\n  \toptgroup: ['optgroup'],\n  \toption: ['option', 'optgroup'],\n  \tthead: ['tbody', 'tfoot'],\n  \ttbody: ['tbody', 'tfoot'],\n  \ttfoot: ['tbody'],\n  \ttr: ['tr', 'tbody'],\n  \ttd: ['td', 'th', 'tr'],\n  \tth: ['td', 'th', 'tr']\n  };\n\n  function readElement(parser) {\n  \tvar start, element, directiveName, match, addProxyEvent, attribute, directive, selfClosing, children, partials, hasPartials, child, closed, pos, remaining, closingTag;\n\n  \tstart = parser.pos;\n\n  \tif (parser.inside || parser.inAttribute) {\n  \t\treturn null;\n  \t}\n\n  \tif (!parser.matchString('<')) {\n  \t\treturn null;\n  \t}\n\n  \t// if this is a closing tag, abort straight away\n  \tif (parser.nextChar() === '/') {\n  \t\treturn null;\n  \t}\n\n  \telement = {};\n  \tif (parser.includeLinePositions) {\n  \t\telement.p = parser.getLinePos(start);\n  \t}\n\n  \tif (parser.matchString('!')) {\n  \t\telement.t = DOCTYPE;\n  \t\tif (!parser.matchPattern(/^doctype/i)) {\n  \t\t\tparser.error('Expected DOCTYPE declaration');\n  \t\t}\n\n  \t\telement.a = parser.matchPattern(/^(.+?)>/);\n  \t\treturn element;\n  \t}\n\n  \telement.t = ELEMENT;\n\n  \t// element name\n  \telement.e = parser.matchPattern(tagNamePattern);\n  \tif (!element.e) {\n  \t\treturn null;\n  \t}\n\n  \t// next character must be whitespace, closing solidus or '>'\n  \tif (!validTagNameFollower.test(parser.nextChar())) {\n  \t\tparser.error('Illegal tag name');\n  \t}\n\n  \taddProxyEvent = function (name, directive) {\n  \t\tvar directiveName = directive.n || directive;\n\n  \t\tif (reservedEventNames.test(directiveName)) {\n  \t\t\tparser.pos -= directiveName.length;\n  \t\t\tparser.error('Cannot use reserved event names (change, reset, teardown, update, construct, config, init, render, unrender, detach, insert)');\n  \t\t}\n\n  \t\telement.v[name] = directive;\n  \t};\n\n  \tparser.allowWhitespace();\n\n  \t// directives and attributes\n  \twhile (attribute = readMustache(parser) || readAttribute(parser)) {\n  \t\t// regular attributes\n  \t\tif (attribute.name) {\n  \t\t\t// intro, outro, decorator\n  \t\t\tif (directiveName = directives[attribute.name]) {\n  \t\t\t\telement[directiveName] = processDirective(attribute.value, parser);\n  \t\t\t}\n\n  \t\t\t// on-click etc\n  \t\t\telse if (match = proxyEventPattern.exec(attribute.name)) {\n  \t\t\t\t\tif (!element.v) element.v = {};\n  \t\t\t\t\tdirective = processDirective(attribute.value, parser);\n  \t\t\t\t\taddProxyEvent(match[1], directive);\n  \t\t\t\t} else {\n  \t\t\t\t\tif (!parser.sanitizeEventAttributes || !onPattern.test(attribute.name)) {\n  \t\t\t\t\t\tif (!element.a) element.a = {};\n  \t\t\t\t\t\telement.a[attribute.name] = attribute.value || (attribute.value === '' ? '' : 0);\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t}\n\n  \t\t// {{#if foo}}class='foo'{{/if}}\n  \t\telse {\n  \t\t\t\tif (!element.m) element.m = [];\n  \t\t\t\telement.m.push(attribute);\n  \t\t\t}\n\n  \t\tparser.allowWhitespace();\n  \t}\n\n  \t// allow whitespace before closing solidus\n  \tparser.allowWhitespace();\n\n  \t// self-closing solidus?\n  \tif (parser.matchString('/')) {\n  \t\tselfClosing = true;\n  \t}\n\n  \t// closing angle bracket\n  \tif (!parser.matchString('>')) {\n  \t\treturn null;\n  \t}\n\n  \tvar lowerCaseName = element.e.toLowerCase();\n  \tvar preserveWhitespace = parser.preserveWhitespace;\n\n  \tif (!selfClosing && !voidElementNames.test(element.e)) {\n  \t\tparser.elementStack.push(lowerCaseName);\n\n  \t\t// Special case - if we open a script element, further tags should\n  \t\t// be ignored unless they're a closing script element\n  \t\tif (lowerCaseName === 'script' || lowerCaseName === 'style' || lowerCaseName === 'textarea') {\n  \t\t\tparser.inside = lowerCaseName;\n  \t\t}\n\n  \t\tchildren = [];\n  \t\tpartials = create(null);\n\n  \t\tdo {\n  \t\t\tpos = parser.pos;\n  \t\t\tremaining = parser.remaining();\n\n  \t\t\tif (!remaining) {\n  \t\t\t\tparser.error('Missing end ' + (parser.elementStack.length > 1 ? 'tags' : 'tag') + ' (' + parser.elementStack.reverse().map(function (x) {\n  \t\t\t\t\treturn '</' + x + '>';\n  \t\t\t\t}).join('') + ')');\n  \t\t\t}\n\n  \t\t\t// if for example we're in an <li> element, and we see another\n  \t\t\t// <li> tag, close the first so they become siblings\n  \t\t\tif (!canContain(lowerCaseName, remaining)) {\n  \t\t\t\tclosed = true;\n  \t\t\t}\n\n  \t\t\t// closing tag\n  \t\t\telse if (closingTag = readClosingTag(parser)) {\n  \t\t\t\t\tclosed = true;\n\n  \t\t\t\t\tvar closingTagName = closingTag.e.toLowerCase();\n\n  \t\t\t\t\t// if this *isn't* the closing tag for the current element...\n  \t\t\t\t\tif (closingTagName !== lowerCaseName) {\n  \t\t\t\t\t\t// rewind parser\n  \t\t\t\t\t\tparser.pos = pos;\n\n  \t\t\t\t\t\t// if it doesn't close a parent tag, error\n  \t\t\t\t\t\tif (! ~parser.elementStack.indexOf(closingTagName)) {\n  \t\t\t\t\t\t\tvar errorMessage = 'Unexpected closing tag';\n\n  \t\t\t\t\t\t\t// add additional help for void elements, since component names\n  \t\t\t\t\t\t\t// might clash with them\n  \t\t\t\t\t\t\tif (voidElementNames.test(closingTagName)) {\n  \t\t\t\t\t\t\t\terrorMessage += ' (<' + closingTagName + '> is a void element - it cannot contain children)';\n  \t\t\t\t\t\t\t}\n\n  \t\t\t\t\t\t\tparser.error(errorMessage);\n  \t\t\t\t\t\t}\n  \t\t\t\t\t}\n  \t\t\t\t}\n\n  \t\t\t\t// implicit close by closing section tag. TODO clean this up\n  \t\t\t\telse if (child = readClosing(parser, { open: parser.standardDelimiters[0], close: parser.standardDelimiters[1] })) {\n  \t\t\t\t\t\tclosed = true;\n  \t\t\t\t\t\tparser.pos = pos;\n  \t\t\t\t\t} else {\n  \t\t\t\t\t\tif (child = parser.read(PARTIAL_READERS)) {\n  \t\t\t\t\t\t\tif (partials[child.n]) {\n  \t\t\t\t\t\t\t\tparser.pos = pos;\n  \t\t\t\t\t\t\t\tparser.error('Duplicate partial definition');\n  \t\t\t\t\t\t\t}\n\n  \t\t\t\t\t\t\tcleanup(child.f, parser.stripComments, preserveWhitespace, !preserveWhitespace, !preserveWhitespace);\n\n  \t\t\t\t\t\t\tpartials[child.n] = child.f;\n  \t\t\t\t\t\t\thasPartials = true;\n  \t\t\t\t\t\t} else {\n  \t\t\t\t\t\t\tif (child = parser.read(READERS)) {\n  \t\t\t\t\t\t\t\tchildren.push(child);\n  \t\t\t\t\t\t\t} else {\n  \t\t\t\t\t\t\t\tclosed = true;\n  \t\t\t\t\t\t\t}\n  \t\t\t\t\t\t}\n  \t\t\t\t\t}\n  \t\t} while (!closed);\n\n  \t\tif (children.length) {\n  \t\t\telement.f = children;\n  \t\t}\n\n  \t\tif (hasPartials) {\n  \t\t\telement.p = partials;\n  \t\t}\n\n  \t\tparser.elementStack.pop();\n  \t}\n\n  \tparser.inside = null;\n\n  \tif (parser.sanitizeElements && parser.sanitizeElements.indexOf(lowerCaseName) !== -1) {\n  \t\treturn exclude;\n  \t}\n\n  \treturn element;\n  }\n\n  function canContain(name, remaining) {\n  \tvar match, disallowed;\n\n  \tmatch = /^<([a-zA-Z][a-zA-Z0-9]*)/.exec(remaining);\n  \tdisallowed = disallowedContents[name];\n\n  \tif (!match || !disallowed) {\n  \t\treturn true;\n  \t}\n\n  \treturn ! ~disallowed.indexOf(match[1].toLowerCase());\n  }\n\n  var OPEN_COMMENT = '<!--';\n  var CLOSE_COMMENT = '-->';\n  function readHtmlComment(parser) {\n  \tvar start, content, remaining, endIndex, comment;\n\n  \tstart = parser.pos;\n\n  \tif (!parser.matchString(OPEN_COMMENT)) {\n  \t\treturn null;\n  \t}\n\n  \tremaining = parser.remaining();\n  \tendIndex = remaining.indexOf(CLOSE_COMMENT);\n\n  \tif (endIndex === -1) {\n  \t\tparser.error('Illegal HTML - expected closing comment sequence (\\'-->\\')');\n  \t}\n\n  \tcontent = remaining.substr(0, endIndex);\n  \tparser.pos += endIndex + 3;\n\n  \tcomment = {\n  \t\tt: COMMENT,\n  \t\tc: content\n  \t};\n\n  \tif (parser.includeLinePositions) {\n  \t\tcomment.p = parser.getLinePos(start);\n  \t}\n\n  \treturn comment;\n  }\n\n  var partialDefinitionSectionPattern = /^#\\s*partial\\s+/;\n  function readPartialDefinitionSection(parser) {\n  \tvar start, name, content, child, closed;\n\n  \tstart = parser.pos;\n\n  \tvar delimiters = parser.standardDelimiters;\n\n  \tif (!parser.matchString(delimiters[0])) {\n  \t\treturn null;\n  \t}\n\n  \tif (!parser.matchPattern(partialDefinitionSectionPattern)) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \tname = parser.matchPattern(/^[a-zA-Z_$][a-zA-Z_$0-9\\-\\/]*/);\n\n  \tif (!name) {\n  \t\tparser.error('expected legal partial name');\n  \t}\n\n  \tif (!parser.matchString(delimiters[1])) {\n  \t\tparser.error('Expected closing delimiter \\'' + delimiters[1] + '\\'');\n  \t}\n\n  \tcontent = [];\n\n  \tdo {\n  \t\t// TODO clean this up\n  \t\tif (child = readClosing(parser, { open: parser.standardDelimiters[0], close: parser.standardDelimiters[1] })) {\n  \t\t\tif (!child.r === 'partial') {\n  \t\t\t\tparser.error('Expected ' + delimiters[0] + '/partial' + delimiters[1]);\n  \t\t\t}\n\n  \t\t\tclosed = true;\n  \t\t} else {\n  \t\t\tchild = parser.read(READERS);\n\n  \t\t\tif (!child) {\n  \t\t\t\tparser.error('Expected ' + delimiters[0] + '/partial' + delimiters[1]);\n  \t\t\t}\n\n  \t\t\tcontent.push(child);\n  \t\t}\n  \t} while (!closed);\n\n  \treturn {\n  \t\tt: INLINE_PARTIAL,\n  \t\tn: name,\n  \t\tf: content\n  \t};\n  }\n\n  var startPattern = /^<!--\\s*/;\n  var namePattern = /s*>\\s*([a-zA-Z_$][-a-zA-Z_$0-9]*)\\s*/;\n  var finishPattern = /\\s*-->/;\n\n  function readPartialDefinitionComment(parser) {\n  \tvar start = parser.pos;\n  \tvar open = parser.standardDelimiters[0];\n  \tvar close = parser.standardDelimiters[1];\n\n  \tif (!parser.matchPattern(startPattern) || !parser.matchString(open)) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \tvar name = parser.matchPattern(namePattern);\n\n  \twarnOnceIfDebug('Inline partial comments are deprecated.\\nUse this...\\n  {{#partial ' + name + '}} ... {{/partial}}\\n\\n...instead of this:\\n  <!-- {{>' + name + '}} --> ... <!-- {{/' + name + '}} -->\\'');\n\n  \t// make sure the rest of the comment is in the correct place\n  \tif (!parser.matchString(close) || !parser.matchPattern(finishPattern)) {\n  \t\tparser.pos = start;\n  \t\treturn null;\n  \t}\n\n  \tvar content = [];\n  \tvar closed = undefined;\n\n  \tvar endPattern = new RegExp('^<!--\\\\s*' + escapeRegExp(open) + '\\\\s*\\\\/\\\\s*' + name + '\\\\s*' + escapeRegExp(close) + '\\\\s*-->');\n\n  \tdo {\n  \t\tif (parser.matchPattern(endPattern)) {\n  \t\t\tclosed = true;\n  \t\t} else {\n  \t\t\tvar child = parser.read(READERS);\n  \t\t\tif (!child) {\n  \t\t\t\tparser.error('expected closing comment (\\'<!-- ' + open + '/' + name + close + ' -->\\')');\n  \t\t\t}\n\n  \t\t\tcontent.push(child);\n  \t\t}\n  \t} while (!closed);\n\n  \treturn {\n  \t\tt: INLINE_PARTIAL,\n  \t\tf: content,\n  \t\tn: name\n  \t};\n  }\n\n  function readTemplate(parser) {\n  \tvar fragment = [];\n  \tvar partials = create(null);\n  \tvar hasPartials = false;\n\n  \tvar preserveWhitespace = parser.preserveWhitespace;\n\n  \twhile (parser.pos < parser.str.length) {\n  \t\tvar pos = parser.pos,\n  \t\t    item = undefined,\n  \t\t    partial = undefined;\n\n  \t\tif (partial = parser.read(PARTIAL_READERS)) {\n  \t\t\tif (partials[partial.n]) {\n  \t\t\t\tparser.pos = pos;\n  \t\t\t\tparser.error('Duplicated partial definition');\n  \t\t\t}\n\n  \t\t\tcleanup(partial.f, parser.stripComments, preserveWhitespace, !preserveWhitespace, !preserveWhitespace);\n\n  \t\t\tpartials[partial.n] = partial.f;\n  \t\t\thasPartials = true;\n  \t\t} else if (item = parser.read(READERS)) {\n  \t\t\tfragment.push(item);\n  \t\t} else {\n  \t\t\tparser.error('Unexpected template content');\n  \t\t}\n  \t}\n\n  \tvar result = {\n  \t\tv: TEMPLATE_VERSION,\n  \t\tt: fragment\n  \t};\n\n  \tif (hasPartials) {\n  \t\tresult.p = partials;\n  \t}\n\n  \treturn result;\n  }\n\n  // See https://github.com/ractivejs/template-spec for information\n  // about the Ractive template specification\n\n  var STANDARD_READERS = [readPartial, readUnescaped, readSection, readYielder, readInterpolator, readComment];\n  var TRIPLE_READERS = [readTriple];\n  var STATIC_READERS = [readUnescaped, readSection, readInterpolator]; // TODO does it make sense to have a static section?\n\n  var StandardParser = undefined;\n  function parse(template, options) {\n  \treturn new StandardParser(template, options || {}).result;\n  }\n\n  var READERS = [readMustache, readHtmlComment, readElement, readText];\n  var PARTIAL_READERS = [readPartialDefinitionComment, readPartialDefinitionSection];\n\n  StandardParser = Parser$1.extend({\n  \tinit: function (str, options) {\n  \t\tvar tripleDelimiters = options.tripleDelimiters || ['{{{', '}}}'],\n  \t\t    staticDelimiters = options.staticDelimiters || ['[[', ']]'],\n  \t\t    staticTripleDelimiters = options.staticTripleDelimiters || ['[[[', ']]]'];\n\n  \t\tthis.standardDelimiters = options.delimiters || ['{{', '}}'];\n\n  \t\tthis.tags = [{ isStatic: false, isTriple: false, open: this.standardDelimiters[0], close: this.standardDelimiters[1], readers: STANDARD_READERS }, { isStatic: false, isTriple: true, open: tripleDelimiters[0], close: tripleDelimiters[1], readers: TRIPLE_READERS }, { isStatic: true, isTriple: false, open: staticDelimiters[0], close: staticDelimiters[1], readers: STATIC_READERS }, { isStatic: true, isTriple: true, open: staticTripleDelimiters[0], close: staticTripleDelimiters[1], readers: TRIPLE_READERS }];\n\n  \t\tthis.sortMustacheTags();\n\n  \t\tthis.sectionDepth = 0;\n  \t\tthis.elementStack = [];\n\n  \t\tthis.interpolate = {\n  \t\t\tscript: !options.interpolate || options.interpolate.script !== false,\n  \t\t\tstyle: !options.interpolate || options.interpolate.style !== false,\n  \t\t\ttextarea: true\n  \t\t};\n\n  \t\tif (options.sanitize === true) {\n  \t\t\toptions.sanitize = {\n  \t\t\t\t// blacklist from https://code.google.com/p/google-caja/source/browse/trunk/src/com/google/caja/lang/html/html4-elements-whitelist.json\n  \t\t\t\telements: 'applet base basefont body frame frameset head html isindex link meta noframes noscript object param script style title'.split(' '),\n  \t\t\t\teventAttributes: true\n  \t\t\t};\n  \t\t}\n\n  \t\tthis.stripComments = options.stripComments !== false;\n  \t\tthis.preserveWhitespace = options.preserveWhitespace;\n  \t\tthis.sanitizeElements = options.sanitize && options.sanitize.elements;\n  \t\tthis.sanitizeEventAttributes = options.sanitize && options.sanitize.eventAttributes;\n  \t\tthis.includeLinePositions = options.includeLinePositions;\n  \t\tthis.textOnlyMode = options.textOnlyMode;\n  \t},\n\n  \tpostProcess: function (result) {\n  \t\t// special case - empty string\n  \t\tif (!result.length) {\n  \t\t\treturn { t: [], v: TEMPLATE_VERSION };\n  \t\t}\n\n  \t\tif (this.sectionDepth > 0) {\n  \t\t\tthis.error('A section was left open');\n  \t\t}\n\n  \t\tcleanup(result[0].t, this.stripComments, this.preserveWhitespace, !this.preserveWhitespace, !this.preserveWhitespace);\n\n  \t\treturn result[0];\n  \t},\n\n  \tconverters: [readTemplate],\n\n  \tsortMustacheTags: function () {\n  \t\t// Sort in order of descending opening delimiter length (longer first),\n  \t\t// to protect against opening delimiters being substrings of each other\n  \t\tthis.tags.sort(function (a, b) {\n  \t\t\treturn b.open.length - a.open.length;\n  \t\t});\n  \t}\n  });\n\n  var parseOptions = ['preserveWhitespace', 'sanitize', 'stripComments', 'delimiters', 'tripleDelimiters', 'staticDelimiters', 'staticTripleDelimiters', 'interpolate'];\n\n  var parser$1 = {\n  \tfromId: fromId, isHashedId: isHashedId, isParsed: isParsed, getParseOptions: getParseOptions, createHelper: createHelper$1,\n  \tparse: doParse\n  };\n\n  function createHelper$1(parseOptions) {\n  \tvar helper = create(parser$1);\n  \thelper.parse = function (template, options) {\n  \t\treturn doParse(template, options || parseOptions);\n  \t};\n  \treturn helper;\n  }\n\n  function doParse(template, parseOptions) {\n  \tif (!parse) {\n  \t\tthrow new Error('Missing Ractive.parse - cannot parse template. Either preparse or use the version that includes the parser');\n  \t}\n\n  \treturn parse(template, parseOptions || this.options);\n  }\n\n  function fromId(id, options) {\n  \tif (!doc) {\n  \t\tif (options && options.noThrow) {\n  \t\t\treturn;\n  \t\t}\n  \t\tthrow new Error('Cannot retrieve template #' + id + ' as Ractive is not running in a browser.');\n  \t}\n\n  \tif (isHashedId(id)) id = id.substring(1);\n\n  \tvar template = undefined;\n\n  \tif (!(template = doc.getElementById(id))) {\n  \t\tif (options && options.noThrow) {\n  \t\t\treturn;\n  \t\t}\n  \t\tthrow new Error('Could not find template element with id #' + id);\n  \t}\n\n  \tif (template.tagName.toUpperCase() !== 'SCRIPT') {\n  \t\tif (options && options.noThrow) {\n  \t\t\treturn;\n  \t\t}\n  \t\tthrow new Error('Template element with id #' + id + ', must be a <script> element');\n  \t}\n\n  \treturn 'textContent' in template ? template.textContent : template.innerHTML;\n  }\n\n  function isHashedId(id) {\n  \treturn id && id[0] === '#';\n  }\n\n  function isParsed(template) {\n  \treturn !(typeof template === 'string');\n  }\n\n  function getParseOptions(ractive) {\n  \t// Could be Ractive or a Component\n  \tif (ractive.defaults) {\n  \t\tractive = ractive.defaults;\n  \t}\n\n  \treturn parseOptions.reduce(function (val, key) {\n  \t\tval[key] = ractive[key];\n  \t\treturn val;\n  \t}, {});\n  }\n\n  var templateConfigurator = {\n  \tname: 'template',\n\n  \textend: function (Parent, proto, options) {\n  \t\t// only assign if exists\n  \t\tif ('template' in options) {\n  \t\t\tvar template = options.template;\n\n  \t\t\tif (typeof template === 'function') {\n  \t\t\t\tproto.template = template;\n  \t\t\t} else {\n  \t\t\t\tproto.template = parseIfString(template, proto);\n  \t\t\t}\n  \t\t}\n  \t},\n\n  \tinit: function (Parent, ractive, options) {\n  \t\t// TODO because of prototypal inheritance, we might just be able to use\n  \t\t// ractive.template, and not bother passing through the Parent object.\n  \t\t// At present that breaks the test mocks' expectations\n  \t\tvar template = 'template' in options ? options.template : Parent.prototype.template;\n  \t\ttemplate = template || { v: TEMPLATE_VERSION, t: [] };\n\n  \t\tif (typeof template === 'function') {\n  \t\t\tvar fn = template;\n  \t\t\ttemplate = getDynamicTemplate(ractive, fn);\n\n  \t\t\tractive._config.template = {\n  \t\t\t\tfn: fn,\n  \t\t\t\tresult: template\n  \t\t\t};\n  \t\t}\n\n  \t\ttemplate = parseIfString(template, ractive);\n\n  \t\t// TODO the naming of this is confusing - ractive.template refers to [...],\n  \t\t// but Component.prototype.template refers to {v:1,t:[],p:[]}...\n  \t\t// it's unnecessary, because the developer never needs to access\n  \t\t// ractive.template\n  \t\tractive.template = template.t;\n\n  \t\tif (template.p) {\n  \t\t\textendPartials(ractive.partials, template.p);\n  \t\t}\n  \t},\n\n  \treset: function (ractive) {\n  \t\tvar result = resetValue(ractive);\n\n  \t\tif (result) {\n  \t\t\tvar parsed = parseIfString(result, ractive);\n\n  \t\t\tractive.template = parsed.t;\n  \t\t\textendPartials(ractive.partials, parsed.p, true);\n\n  \t\t\treturn true;\n  \t\t}\n  \t}\n  };\n\n  function resetValue(ractive) {\n  \tvar initial = ractive._config.template;\n\n  \t// If this isn't a dynamic template, there's nothing to do\n  \tif (!initial || !initial.fn) {\n  \t\treturn;\n  \t}\n\n  \tvar result = getDynamicTemplate(ractive, initial.fn);\n\n  \t// TODO deep equality check to prevent unnecessary re-rendering\n  \t// in the case of already-parsed templates\n  \tif (result !== initial.result) {\n  \t\tinitial.result = result;\n  \t\tresult = parseIfString(result, ractive);\n  \t\treturn result;\n  \t}\n  }\n\n  function getDynamicTemplate(ractive, fn) {\n  \tvar helper = createHelper(parser$1.getParseOptions(ractive));\n  \treturn fn.call(ractive, helper);\n  }\n\n  function createHelper(parseOptions) {\n  \tvar helper = create(parser$1);\n  \thelper.parse = function (template, options) {\n  \t\treturn parser$1.parse(template, options || parseOptions);\n  \t};\n  \treturn helper;\n  }\n\n  function parseIfString(template, ractive) {\n  \tif (typeof template === 'string') {\n  \t\t// ID of an element containing the template?\n  \t\tif (template[0] === '#') {\n  \t\t\ttemplate = parser$1.fromId(template);\n  \t\t}\n\n  \t\ttemplate = parse(template, parser$1.getParseOptions(ractive));\n  \t}\n\n  \t// Check that the template even exists\n  \telse if (template == undefined) {\n  \t\t\tthrow new Error('The template cannot be ' + template + '.');\n  \t\t}\n\n  \t\t// Check the parsed template has a version at all\n  \t\telse if (typeof template.v !== 'number') {\n  \t\t\t\tthrow new Error('The template parser was passed a non-string template, but the template doesn\\'t have a version.  Make sure you\\'re passing in the template you think you are.');\n  \t\t\t}\n\n  \t\t\t// Check we're using the correct version\n  \t\t\telse if (template.v !== TEMPLATE_VERSION) {\n  \t\t\t\t\tthrow new Error('Mismatched template version (expected ' + TEMPLATE_VERSION + ', got ' + template.v + ') Please ensure you are using the latest version of Ractive.js in your build process as well as in your app');\n  \t\t\t\t}\n\n  \treturn template;\n  }\n\n  function extendPartials(existingPartials, newPartials, overwrite) {\n  \tif (!newPartials) return;\n\n  \t// TODO there's an ambiguity here - we need to overwrite in the `reset()`\n  \t// case, but not initially...\n\n  \tfor (var key in newPartials) {\n  \t\tif (overwrite || !existingPartials.hasOwnProperty(key)) {\n  \t\t\texistingPartials[key] = newPartials[key];\n  \t\t}\n  \t}\n  }\n\n  var Item = (function () {\n  \tfunction Item(options) {\n  \t\tclassCallCheck(this, Item);\n\n  \t\tthis.parentFragment = options.parentFragment;\n  \t\tthis.ractive = options.parentFragment.ractive;\n\n  \t\tthis.template = options.template;\n  \t\tthis.index = options.index;\n  \t\tthis.type = options.template.t;\n\n  \t\tthis.dirty = false;\n  \t}\n\n  \tItem.prototype.bubble = function bubble() {\n  \t\tif (!this.dirty) {\n  \t\t\tthis.dirty = true;\n  \t\t\tthis.parentFragment.bubble();\n  \t\t}\n  \t};\n\n  \tItem.prototype.find = function find() {\n  \t\treturn null;\n  \t};\n\n  \tItem.prototype.findAll = function findAll() {\n  \t\t// noop\n  \t};\n\n  \tItem.prototype.findComponent = function findComponent() {\n  \t\treturn null;\n  \t};\n\n  \tItem.prototype.findAllComponents = function findAllComponents() {\n  \t\t// noop;\n  \t};\n\n  \tItem.prototype.findNextNode = function findNextNode() {\n  \t\treturn this.parentFragment.findNextNode(this);\n  \t};\n\n  \treturn Item;\n  })();\n\n  function badReference(key) {\n  \tthrow new Error('An index or key reference (' + key + ') cannot have child properties');\n  }\n  function resolveAmbiguousReference(fragment, ref) {\n  \tvar localViewmodel = fragment.findContext().root;\n  \tvar keys = splitKeypath(ref);\n  \tvar key = keys[0];\n\n  \tvar hasContextChain = undefined;\n  \tvar crossedComponentBoundary = undefined;\n  \tvar aliases = undefined;\n\n  \twhile (fragment) {\n  \t\t// repeated fragments\n  \t\tif (fragment.isIteration) {\n  \t\t\tif (key === fragment.parent.keyRef) {\n  \t\t\t\tif (keys.length > 1) badReference(key);\n  \t\t\t\treturn fragment.context.getKeyModel();\n  \t\t\t}\n\n  \t\t\tif (key === fragment.parent.indexRef) {\n  \t\t\t\tif (keys.length > 1) badReference(key);\n  \t\t\t\treturn fragment.context.getIndexModel(fragment.index);\n  \t\t\t}\n  \t\t}\n\n  \t\t// alias node or iteration\n  \t\tif (((aliases = fragment.owner.aliases) || (aliases = fragment.aliases)) && aliases.hasOwnProperty(key)) {\n  \t\t\tvar model = aliases[key];\n\n  \t\t\tif (keys.length === 1) return model;else if (typeof model.joinAll === 'function') {\n  \t\t\t\treturn model.joinAll(keys.slice(1));\n  \t\t\t}\n  \t\t}\n\n  \t\tif (fragment.context) {\n  \t\t\t// TODO better encapsulate the component check\n  \t\t\tif (!fragment.isRoot || fragment.ractive.component) hasContextChain = true;\n\n  \t\t\tif (fragment.context.has(key)) {\n  \t\t\t\tif (crossedComponentBoundary) {\n  \t\t\t\t\tlocalViewmodel.map(key, fragment.context.joinKey(key));\n  \t\t\t\t}\n\n  \t\t\t\treturn fragment.context.joinAll(keys);\n  \t\t\t}\n  \t\t}\n\n  \t\tif (fragment.componentParent && !fragment.ractive.isolated) {\n  \t\t\t// ascend through component boundary\n  \t\t\tfragment = fragment.componentParent;\n  \t\t\tcrossedComponentBoundary = true;\n  \t\t} else {\n  \t\t\tfragment = fragment.parent;\n  \t\t}\n  \t}\n\n  \tif (!hasContextChain) {\n  \t\treturn localViewmodel.joinAll(keys);\n  \t}\n  }\n\n  function resolveReference(fragment, ref) {\n  \tvar context = fragment.findContext();\n\n  \t// special references\n  \t// TODO does `this` become `.` at parse time?\n  \tif (ref === '.' || ref === 'this') return context;\n  \tif (ref === '@keypath') return context.getKeypathModel();\n  \tif (ref === '@index') {\n  \t\tvar repeater = fragment.findRepeatingFragment();\n  \t\t// make sure the found fragment is actually an iteration\n  \t\tif (!repeater.isIteration) return;\n  \t\treturn repeater.context.getIndexModel(repeater.index);\n  \t}\n  \tif (ref === '@key') return fragment.findRepeatingFragment().context.getKeyModel();\n\n  \t// ancestor references\n  \tif (ref[0] === '~') return context.root.joinAll(splitKeypath(ref.slice(2)));\n  \tif (ref[0] === '.') {\n  \t\tvar parts = ref.split('/');\n\n  \t\twhile (parts[0] === '.' || parts[0] === '..') {\n  \t\t\tvar part = parts.shift();\n\n  \t\t\tif (part === '..') {\n  \t\t\t\tcontext = context.parent;\n  \t\t\t}\n  \t\t}\n\n  \t\tref = parts.join('/');\n\n  \t\t// special case - `{{.foo}}` means the same as `{{./foo}}`\n  \t\tif (ref[0] === '.') ref = ref.slice(1);\n  \t\treturn context.joinAll(splitKeypath(ref));\n  \t}\n\n  \treturn resolveAmbiguousReference(fragment, ref);\n  }\n\n  var stack = [];\n  var captureGroup = undefined;\n\n  function startCapturing() {\n  \tstack.push(captureGroup = []);\n  }\n\n  function stopCapturing() {\n  \tvar dependencies = stack.pop();\n  \tcaptureGroup = stack[stack.length - 1];\n  \treturn dependencies;\n  }\n\n  function capture(model) {\n  \tif (captureGroup) {\n  \t\tcaptureGroup.push(model);\n  \t}\n  }\n\n  var requestAnimationFrame;\n\n  // If window doesn't exist, we don't need requestAnimationFrame\n  if (!win) {\n  \trequestAnimationFrame = null;\n  } else {\n  \t// https://gist.github.com/paulirish/1579671\n  \t(function (vendors, lastTime, win) {\n\n  \t\tvar x, setTimeout;\n\n  \t\tif (win.requestAnimationFrame) {\n  \t\t\treturn;\n  \t\t}\n\n  \t\tfor (x = 0; x < vendors.length && !win.requestAnimationFrame; ++x) {\n  \t\t\twin.requestAnimationFrame = win[vendors[x] + 'RequestAnimationFrame'];\n  \t\t}\n\n  \t\tif (!win.requestAnimationFrame) {\n  \t\t\tsetTimeout = win.setTimeout;\n\n  \t\t\twin.requestAnimationFrame = function (callback) {\n  \t\t\t\tvar currTime, timeToCall, id;\n\n  \t\t\t\tcurrTime = Date.now();\n  \t\t\t\ttimeToCall = Math.max(0, 16 - (currTime - lastTime));\n  \t\t\t\tid = setTimeout(function () {\n  \t\t\t\t\tcallback(currTime + timeToCall);\n  \t\t\t\t}, timeToCall);\n\n  \t\t\t\tlastTime = currTime + timeToCall;\n  \t\t\t\treturn id;\n  \t\t\t};\n  \t\t}\n  \t})(vendors, 0, win);\n\n  \trequestAnimationFrame = win.requestAnimationFrame;\n  }\n\n  var rAF = requestAnimationFrame;\n\n  var getTime = win && win.performance && typeof win.performance.now === 'function' ? function () {\n  \treturn win.performance.now();\n  } : function () {\n  \treturn Date.now();\n  };\n\n  // TODO what happens if a transition is aborted?\n\n  var tickers = [];\n  var running = false;\n\n  function tick() {\n  \trunloop.start();\n\n  \tvar now = getTime();\n\n  \tvar i = undefined;\n  \tvar ticker = undefined;\n\n  \tfor (i = 0; i < tickers.length; i += 1) {\n  \t\tticker = tickers[i];\n\n  \t\tif (!ticker.tick(now)) {\n  \t\t\t// ticker is complete, remove it from the stack, and decrement i so we don't miss one\n  \t\t\ttickers.splice(i--, 1);\n  \t\t}\n  \t}\n\n  \trunloop.end();\n\n  \tif (tickers.length) {\n  \t\trAF(tick);\n  \t} else {\n  \t\trunning = false;\n  \t}\n  }\n\n  var Ticker = (function () {\n  \tfunction Ticker(options) {\n  \t\tclassCallCheck(this, Ticker);\n\n  \t\tthis.duration = options.duration;\n  \t\tthis.step = options.step;\n  \t\tthis.complete = options.complete;\n  \t\tthis.easing = options.easing;\n\n  \t\tthis.start = getTime();\n  \t\tthis.end = this.start + this.duration;\n\n  \t\tthis.running = true;\n\n  \t\ttickers.push(this);\n  \t\tif (!running) rAF(tick);\n  \t}\n\n  \tTicker.prototype.tick = function tick(now) {\n  \t\tif (!this.running) return false;\n\n  \t\tif (now > this.end) {\n  \t\t\tif (this.step) this.step(1);\n  \t\t\tif (this.complete) this.complete(1);\n\n  \t\t\treturn false;\n  \t\t}\n\n  \t\tvar elapsed = now - this.start;\n  \t\tvar eased = this.easing(elapsed / this.duration);\n\n  \t\tif (this.step) this.step(eased);\n\n  \t\treturn true;\n  \t};\n\n  \tTicker.prototype.stop = function stop() {\n  \t\tif (this.abort) this.abort();\n  \t\tthis.running = false;\n  \t};\n\n  \treturn Ticker;\n  })();\n\n  var prefixers = {};\n\n  // TODO this is legacy. sooner we can replace the old adaptor API the better\n  function prefixKeypath(obj, prefix) {\n  \tvar prefixed = {},\n  \t    key;\n\n  \tif (!prefix) {\n  \t\treturn obj;\n  \t}\n\n  \tprefix += '.';\n\n  \tfor (key in obj) {\n  \t\tif (obj.hasOwnProperty(key)) {\n  \t\t\tprefixed[prefix + key] = obj[key];\n  \t\t}\n  \t}\n\n  \treturn prefixed;\n  }\n  function getPrefixer(rootKeypath) {\n  \tvar rootDot;\n\n  \tif (!prefixers[rootKeypath]) {\n  \t\trootDot = rootKeypath ? rootKeypath + '.' : '';\n\n  \t\tprefixers[rootKeypath] = function (relativeKeypath, value) {\n  \t\t\tvar obj;\n\n  \t\t\tif (typeof relativeKeypath === 'string') {\n  \t\t\t\tobj = {};\n  \t\t\t\tobj[rootDot + relativeKeypath] = value;\n  \t\t\t\treturn obj;\n  \t\t\t}\n\n  \t\t\tif (typeof relativeKeypath === 'object') {\n  \t\t\t\t// 'relativeKeypath' is in fact a hash, not a keypath\n  \t\t\t\treturn rootDot ? prefixKeypath(relativeKeypath, rootKeypath) : relativeKeypath;\n  \t\t\t}\n  \t\t};\n  \t}\n\n  \treturn prefixers[rootKeypath];\n  }\n\n  var KeyModel = (function () {\n  \tfunction KeyModel(key) {\n  \t\tclassCallCheck(this, KeyModel);\n\n  \t\tthis.value = key;\n  \t\tthis.isReadonly = true;\n  \t\tthis.dependants = [];\n  \t}\n\n  \tKeyModel.prototype.get = function get() {\n  \t\treturn this.value;\n  \t};\n\n  \tKeyModel.prototype.getKeypath = function getKeypath() {\n  \t\treturn this.value;\n  \t};\n\n  \tKeyModel.prototype.rebind = function rebind(key) {\n  \t\tthis.value = key;\n  \t\tthis.dependants.forEach(_handleChange);\n  \t};\n\n  \tKeyModel.prototype.register = function register(dependant) {\n  \t\tthis.dependants.push(dependant);\n  \t};\n\n  \tKeyModel.prototype.unregister = function unregister(dependant) {\n  \t\tremoveFromArray(this.dependants, dependant);\n  \t};\n\n  \treturn KeyModel;\n  })();\n\n  var KeypathModel = (function () {\n  \tfunction KeypathModel(parent) {\n  \t\tclassCallCheck(this, KeypathModel);\n\n  \t\tthis.parent = parent;\n  \t\tthis.value = parent.getKeypath();\n  \t\tthis.dependants = [];\n  \t}\n\n  \tKeypathModel.prototype.get = function get() {\n  \t\treturn this.value;\n  \t};\n\n  \tKeypathModel.prototype.getKeypath = function getKeypath() {\n  \t\treturn this.value;\n  \t};\n\n  \tKeypathModel.prototype.handleChange = function handleChange() {\n  \t\tthis.value = this.parent.getKeypath();\n  \t\tthis.dependants.forEach(_handleChange);\n  \t};\n\n  \tKeypathModel.prototype.register = function register(dependant) {\n  \t\tthis.dependants.push(dependant);\n  \t};\n\n  \tKeypathModel.prototype.unregister = function unregister(dependant) {\n  \t\tremoveFromArray(this.dependants, dependant);\n  \t};\n\n  \treturn KeypathModel;\n  })();\n\n  var hasProp = Object.prototype.hasOwnProperty;\n\n  function _updateFromBindings(model) {\n  \tmodel.updateFromBindings(true);\n  }\n\n  function _updateKeypathDependants(model) {\n  \tmodel.updateKeypathDependants();\n  }\n\n  var originatingModel = null;\n\n  var Model = (function () {\n  \tfunction Model(parent, key) {\n  \t\tclassCallCheck(this, Model);\n\n  \t\tthis.deps = [];\n\n  \t\tthis.children = [];\n  \t\tthis.childByKey = {};\n\n  \t\tthis.indexModels = [];\n\n  \t\tthis.unresolved = [];\n  \t\tthis.unresolvedByKey = {};\n\n  \t\tthis.bindings = [];\n\n  \t\tthis.value = undefined;\n\n  \t\tthis.ticker = null;\n\n  \t\tif (parent) {\n  \t\t\tthis.parent = parent;\n  \t\t\tthis.root = parent.root;\n  \t\t\tthis.key = unescapeKey(key);\n  \t\t\tthis.isReadonly = parent.isReadonly;\n\n  \t\t\tif (parent.value) {\n  \t\t\t\tthis.value = parent.value[this.key];\n  \t\t\t\tthis.adapt();\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \tModel.prototype.adapt = function adapt() {\n  \t\tvar adaptors = this.root.adaptors;\n  \t\tvar value = this.value;\n  \t\tvar len = adaptors.length;\n\n  \t\t// TODO remove this legacy nonsense\n  \t\tvar ractive = this.root.ractive;\n  \t\tvar keypath = this.getKeypath();\n\n  \t\tvar i = undefined;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tvar adaptor = adaptors[i];\n  \t\t\tif (adaptor.filter(value, keypath, ractive)) {\n  \t\t\t\tthis.wrapper = adaptor.wrap(ractive, value, keypath, getPrefixer(keypath));\n  \t\t\t\tthis.wrapper.value = this.value;\n  \t\t\t\tthis.wrapper.__model = this; // massive temporary hack to enable array adaptor\n\n  \t\t\t\tthis.value = this.wrapper.get();\n\n  \t\t\t\tbreak;\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tModel.prototype.addUnresolved = function addUnresolved(key, resolver) {\n  \t\tif (!this.unresolvedByKey[key]) {\n  \t\t\tthis.unresolved.push(key);\n  \t\t\tthis.unresolvedByKey[key] = [];\n  \t\t}\n\n  \t\tthis.unresolvedByKey[key].push(resolver);\n  \t};\n\n  \tModel.prototype.animate = function animate(from, to, options, interpolator) {\n  \t\tvar _this = this;\n\n  \t\tif (this.ticker) this.ticker.stop();\n\n  \t\tvar fulfilPromise = undefined;\n  \t\tvar promise = new Promise$1(function (fulfil) {\n  \t\t\treturn fulfilPromise = fulfil;\n  \t\t});\n\n  \t\tthis.ticker = new Ticker({\n  \t\t\tduration: options.duration,\n  \t\t\teasing: options.easing,\n  \t\t\tstep: function (t) {\n  \t\t\t\tvar value = interpolator(t);\n  \t\t\t\t_this.applyValue(value);\n  \t\t\t\tif (options.step) options.step(t, value);\n  \t\t\t},\n  \t\t\tcomplete: function () {\n  \t\t\t\t_this.applyValue(to);\n  \t\t\t\tif (options.complete) options.complete(to);\n\n  \t\t\t\t_this.ticker = null;\n  \t\t\t\tfulfilPromise();\n  \t\t\t}\n  \t\t});\n\n  \t\tpromise.stop = this.ticker.stop;\n  \t\treturn promise;\n  \t};\n\n  \tModel.prototype.applyValue = function applyValue(value) {\n  \t\tif (isEqual(value, this.value)) return;\n\n  \t\t// TODO deprecate this nonsense\n  \t\tthis.root.changes[this.getKeypath()] = value;\n\n  \t\tif (this.parent.wrapper && this.parent.wrapper.set) {\n  \t\t\tthis.parent.wrapper.set(this.key, value);\n  \t\t\tthis.parent.value = this.parent.wrapper.get();\n\n  \t\t\tthis.value = this.parent.value[this.key];\n  \t\t\t// TODO should this value be adapted? probably\n  \t\t} else if (this.wrapper) {\n  \t\t\t\tvar shouldTeardown = !this.wrapper.reset || this.wrapper.reset(value) === false;\n\n  \t\t\t\tif (shouldTeardown) {\n  \t\t\t\t\tthis.wrapper.teardown();\n  \t\t\t\t\tthis.wrapper = null;\n  \t\t\t\t\tthis.parent.value[this.key] = this.value = value;\n  \t\t\t\t\tthis.adapt();\n  \t\t\t\t} else {\n  \t\t\t\t\tthis.value = this.wrapper.get();\n  \t\t\t\t}\n  \t\t\t} else {\n  \t\t\t\tvar parentValue = this.parent.value || this.parent.createBranch(this.key);\n  \t\t\t\tparentValue[this.key] = value;\n\n  \t\t\t\tthis.value = value;\n  \t\t\t\tthis.adapt();\n  \t\t\t}\n\n  \t\tthis.parent.clearUnresolveds();\n  \t\tthis.clearUnresolveds();\n\n  \t\t// notify dependants\n  \t\tvar previousOriginatingModel = originatingModel; // for the array.length special case\n  \t\toriginatingModel = this;\n\n  \t\tthis.children.forEach(_mark);\n  \t\tthis.deps.forEach(_handleChange);\n\n  \t\tvar parent = this.parent;\n  \t\twhile (parent) {\n  \t\t\tparent.deps.forEach(_handleChange);\n  \t\t\tparent = parent.parent;\n  \t\t}\n\n  \t\toriginatingModel = previousOriginatingModel;\n  \t};\n\n  \tModel.prototype.clearUnresolveds = function clearUnresolveds(specificKey) {\n  \t\tvar i = this.unresolved.length;\n\n  \t\twhile (i--) {\n  \t\t\tvar key = this.unresolved[i];\n\n  \t\t\tif (specificKey && key !== specificKey) continue;\n\n  \t\t\tvar resolvers = this.unresolvedByKey[key];\n  \t\t\tvar hasKey = this.has(key);\n\n  \t\t\tvar j = resolvers.length;\n  \t\t\twhile (j--) {\n  \t\t\t\tif (hasKey) resolvers[j].attemptResolution();\n  \t\t\t\tif (resolvers[j].resolved) resolvers.splice(j, 1);\n  \t\t\t}\n\n  \t\t\tif (!resolvers.length) {\n  \t\t\t\tthis.unresolved.splice(i, 1);\n  \t\t\t\tthis.unresolvedByKey[key] = null;\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tModel.prototype.createBranch = function createBranch(key) {\n  \t\tvar branch = isNumeric(key) ? [] : {};\n  \t\tthis.set(branch);\n\n  \t\treturn branch;\n  \t};\n\n  \tModel.prototype.discard = function discard() {\n  \t\tvar _this2 = this;\n\n  \t\tthis.deps.forEach(function (d) {\n  \t\t\tif (d.boundsSensitive) _this2.unregister(d);\n  \t\t});\n  \t};\n\n  \tModel.prototype.findMatches = function findMatches(keys) {\n  \t\tvar len = keys.length;\n\n  \t\tvar existingMatches = [this];\n  \t\tvar matches = undefined;\n  \t\tvar i = undefined;\n\n  \t\tvar _loop = function () {\n  \t\t\tvar key = keys[i];\n\n  \t\t\tif (key === '*') {\n  \t\t\t\tmatches = [];\n  \t\t\t\texistingMatches.forEach(function (model) {\n  \t\t\t\t\tif (isArray(model.value)) {\n  \t\t\t\t\t\t// special case - array.length. This is a horrible kludge, but\n  \t\t\t\t\t\t// it'll do for now. Alternatives welcome\n  \t\t\t\t\t\tif (originatingModel && originatingModel.parent === model && originatingModel.key === 'length') {\n  \t\t\t\t\t\t\tmatches.push(originatingModel);\n  \t\t\t\t\t\t}\n\n  \t\t\t\t\t\tmodel.value.forEach(function (member, i) {\n  \t\t\t\t\t\t\tmatches.push(model.joinKey(i));\n  \t\t\t\t\t\t});\n  \t\t\t\t\t} else if (isObject(model.value) || typeof model.value === 'function') {\n  \t\t\t\t\t\tObject.keys(model.value).forEach(function (key) {\n  \t\t\t\t\t\t\tmatches.push(model.joinKey(key));\n  \t\t\t\t\t\t});\n\n  \t\t\t\t\t\t// special case - computed properties. TODO mappings also?\n  \t\t\t\t\t\tif (model.isRoot) {\n  \t\t\t\t\t\t\tObject.keys(model.computations).forEach(function (key) {\n  \t\t\t\t\t\t\t\tmatches.push(model.joinKey(key));\n  \t\t\t\t\t\t\t});\n  \t\t\t\t\t\t}\n  \t\t\t\t\t}\n  \t\t\t\t});\n  \t\t\t} else {\n  \t\t\t\tmatches = existingMatches.map(function (model) {\n  \t\t\t\t\treturn model.joinKey(key);\n  \t\t\t\t});\n  \t\t\t}\n\n  \t\t\texistingMatches = matches;\n  \t\t};\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\t_loop();\n  \t\t}\n\n  \t\treturn matches;\n  \t};\n\n  \tModel.prototype.get = function get(shouldCapture) {\n  \t\tif (shouldCapture) capture(this);\n  \t\treturn this.value;\n  \t};\n\n  \tModel.prototype.getIndexModel = function getIndexModel(fragmentIndex) {\n  \t\tvar indexModels = this.parent.indexModels;\n\n  \t\t// non-numeric keys are a special of a numeric index in a object iteration\n  \t\tif (typeof this.key === 'string' && fragmentIndex !== undefined) {\n  \t\t\treturn new KeyModel(fragmentIndex);\n  \t\t} else if (!indexModels[this.key]) {\n  \t\t\tindexModels[this.key] = new KeyModel(this.key);\n  \t\t}\n\n  \t\treturn indexModels[this.key];\n  \t};\n\n  \tModel.prototype.getKeyModel = function getKeyModel() {\n  \t\t// TODO... different to IndexModel because key can never change\n  \t\treturn new KeyModel(escapeKey(this.key));\n  \t};\n\n  \tModel.prototype.getKeypathModel = function getKeypathModel() {\n  \t\treturn this.keypathModel || (this.keypathModel = new KeypathModel(this));\n  \t};\n\n  \tModel.prototype.getKeypath = function getKeypath() {\n  \t\t// TODO keypaths inside components... tricky\n  \t\treturn this.parent.isRoot ? escapeKey(this.key) : this.parent.getKeypath() + '.' + escapeKey(this.key);\n  \t};\n\n  \tModel.prototype.has = function has(key) {\n  \t\tvar value = this.get();\n  \t\tif (!value) return false;\n\n  \t\tkey = unescapeKey(key);\n  \t\tif (hasProp.call(value, key)) return true;\n\n  \t\t// We climb up the constructor chain to find if one of them contains the key\n  \t\tvar constructor = value.constructor;\n  \t\twhile (constructor !== Function && constructor !== Array && constructor !== Object) {\n  \t\t\tif (hasProp.call(constructor.prototype, key)) return true;\n  \t\t\tconstructor = constructor.constructor;\n  \t\t}\n\n  \t\treturn false;\n  \t};\n\n  \tModel.prototype.joinKey = function joinKey(key) {\n  \t\tif (key === undefined || key === '') return this;\n\n  \t\tif (!this.childByKey.hasOwnProperty(key)) {\n  \t\t\tvar child = new Model(this, key);\n  \t\t\tthis.children.push(child);\n  \t\t\tthis.childByKey[key] = child;\n  \t\t}\n\n  \t\treturn this.childByKey[key];\n  \t};\n\n  \tModel.prototype.joinAll = function joinAll(keys) {\n  \t\tvar model = this;\n  \t\tfor (var i = 0; i < keys.length; i += 1) {\n  \t\t\tmodel = model.joinKey(keys[i]);\n  \t\t}\n\n  \t\treturn model;\n  \t};\n\n  \tModel.prototype.mark = function mark() {\n  \t\tvar value = this.retrieve();\n\n  \t\tif (!isEqual(value, this.value)) {\n  \t\t\tthis.value = value;\n\n  \t\t\tthis.children.forEach(_mark);\n\n  \t\t\tthis.deps.forEach(_handleChange);\n  \t\t\tthis.clearUnresolveds();\n  \t\t}\n  \t};\n\n  \tModel.prototype.merge = function merge(array, comparator) {\n  \t\tvar oldArray = comparator ? this.value.map(comparator) : this.value;\n  \t\tvar newArray = comparator ? array.map(comparator) : array;\n\n  \t\tvar oldLength = oldArray.length;\n\n  \t\tvar usedIndices = {};\n  \t\tvar firstUnusedIndex = 0;\n\n  \t\tvar newIndices = oldArray.map(function (item) {\n  \t\t\tvar index = undefined;\n  \t\t\tvar start = firstUnusedIndex;\n\n  \t\t\tdo {\n  \t\t\t\tindex = newArray.indexOf(item, start);\n\n  \t\t\t\tif (index === -1) {\n  \t\t\t\t\treturn -1;\n  \t\t\t\t}\n\n  \t\t\t\tstart = index + 1;\n  \t\t\t} while (usedIndices[index] === true && start < oldLength);\n\n  \t\t\t// keep track of the first unused index, so we don't search\n  \t\t\t// the whole of newArray for each item in oldArray unnecessarily\n  \t\t\tif (index === firstUnusedIndex) {\n  \t\t\t\tfirstUnusedIndex += 1;\n  \t\t\t}\n  \t\t\t// allow next instance of next \"equal\" to be found item\n  \t\t\tusedIndices[index] = true;\n  \t\t\treturn index;\n  \t\t});\n\n  \t\tthis.parent.value[this.key] = array;\n  \t\tthis._merged = true;\n  \t\tthis.shuffle(newIndices);\n  \t};\n\n  \tModel.prototype.register = function register(dep) {\n  \t\tthis.deps.push(dep);\n  \t};\n\n  \tModel.prototype.registerTwowayBinding = function registerTwowayBinding(binding) {\n  \t\tthis.bindings.push(binding);\n  \t};\n\n  \tModel.prototype.retrieve = function retrieve() {\n  \t\treturn this.parent.value ? this.parent.value[this.key] : undefined;\n  \t};\n\n  \tModel.prototype.set = function set(value) {\n  \t\tif (this.ticker) this.ticker.stop();\n  \t\tthis.applyValue(value);\n  \t};\n\n  \tModel.prototype.shuffle = function shuffle(newIndices) {\n  \t\tvar _this3 = this;\n\n  \t\tvar indexModels = [];\n  \t\tvar max = 0,\n  \t\t    child = undefined;\n\n  \t\tnewIndices.forEach(function (newIndex, oldIndex) {\n  \t\t\tif (newIndex > max) max = newIndex;\n\n  \t\t\tif (! ~newIndex) return;\n\n  \t\t\tvar model = _this3.indexModels[oldIndex];\n\n  \t\t\tif (!model) return;\n\n  \t\t\tindexModels[newIndex] = model;\n\n  \t\t\tif (newIndex !== oldIndex) {\n  \t\t\t\tmodel.rebind(newIndex);\n  \t\t\t}\n  \t\t});\n\n  \t\t// some children, notably computations, need to be notified when they are\n  \t\t// no longer attached to anything so they don't recompute\n  \t\twhile (child = this.childByKey[++max]) {\n  \t\t\tif (typeof child.discard === 'function') child.discard();\n  \t\t}\n\n  \t\tthis.indexModels = indexModels;\n\n  \t\t// shuffles need to happen before marks...\n  \t\tthis.deps.forEach(function (dep) {\n  \t\t\tif (dep.shuffle) dep.shuffle(newIndices);\n  \t\t});\n\n  \t\tthis.updateKeypathDependants();\n  \t\tthis.mark();\n\n  \t\t// ...but handleChange must happen after (TODO document why)\n  \t\tthis.deps.forEach(function (dep) {\n  \t\t\tif (!dep.shuffle) dep.handleChange();\n  \t\t});\n  \t};\n\n  \tModel.prototype.teardown = function teardown() {\n  \t\tthis.children.forEach(_teardown);\n  \t\tif (this.wrapper) this.wrapper.teardown();\n  \t};\n\n  \tModel.prototype.unregister = function unregister(dependant) {\n  \t\tremoveFromArray(this.deps, dependant);\n  \t};\n\n  \tModel.prototype.unregisterTwowayBinding = function unregisterTwowayBinding(binding) {\n  \t\tremoveFromArray(this.bindings, binding);\n  \t};\n\n  \tModel.prototype.updateFromBindings = function updateFromBindings(cascade) {\n  \t\tvar i = this.bindings.length;\n  \t\twhile (i--) {\n  \t\t\tvar value = this.bindings[i].getValue();\n  \t\t\tif (value !== this.value) this.set(value);\n  \t\t}\n\n  \t\tif (cascade) {\n  \t\t\tthis.children.forEach(_updateFromBindings);\n  \t\t}\n  \t};\n\n  \tModel.prototype.updateKeypathDependants = function updateKeypathDependants() {\n  \t\tthis.children.forEach(_updateKeypathDependants);\n  \t\tif (this.keypathModel) this.keypathModel.handleChange();\n  \t};\n\n  \treturn Model;\n  })();\n\n  var ComputationChild = (function (_Model) {\n  \tinherits(ComputationChild, _Model);\n\n  \tfunction ComputationChild() {\n  \t\tclassCallCheck(this, ComputationChild);\n\n  \t\t_Model.apply(this, arguments);\n  \t}\n\n  \tComputationChild.prototype.get = function get(shouldCapture) {\n  \t\tif (shouldCapture) capture(this);\n\n  \t\tvar parentValue = this.parent.get();\n  \t\treturn parentValue ? parentValue[this.key] : undefined;\n  \t};\n\n  \tComputationChild.prototype.handleChange = function handleChange() {\n  \t\tthis.dirty = true;\n\n  \t\tthis.deps.forEach(_handleChange);\n  \t\tthis.children.forEach(_handleChange);\n  \t\tthis.clearUnresolveds(); // TODO is this necessary?\n  \t};\n\n  \tComputationChild.prototype.joinKey = function joinKey(key) {\n  \t\tif (key === undefined || key === '') return this;\n\n  \t\tif (!this.childByKey.hasOwnProperty(key)) {\n  \t\t\tvar child = new ComputationChild(this, key);\n  \t\t\tthis.children.push(child);\n  \t\t\tthis.childByKey[key] = child;\n  \t\t}\n\n  \t\treturn this.childByKey[key];\n  \t};\n\n  \t// TODO this causes problems with inter-component mappings\n  \t// set () {\n  \t// \tthrow new Error( `Cannot set read-only property of computed value (${this.getKeypath()})` );\n  \t// }\n  \treturn ComputationChild;\n  })(Model);\n\n  var functionCache = {};\n  function createFunction(str, i) {\n  \tif (functionCache[str]) return functionCache[str];\n\n  \tvar args = new Array(i);\n  \twhile (i--) args[i] = \"_\" + i;\n\n  \tvar fn = new Function(args.join(','), \"return (\" + str + \")\");\n\n  \treturn functionCache[str] = fn;\n  }\n\n  function getValue(model) {\n  \treturn model ? model.get(true) : undefined;\n  }\n\n  var ExpressionProxy = (function (_Model) {\n  \tinherits(ExpressionProxy, _Model);\n\n  \tfunction ExpressionProxy(fragment, template) {\n  \t\tvar _this = this;\n\n  \t\tclassCallCheck(this, ExpressionProxy);\n\n  \t\t_Model.call(this, fragment.ractive.viewmodel, null);\n\n  \t\tthis.fragment = fragment;\n  \t\tthis.template = template;\n\n  \t\tthis.isReadonly = true;\n\n  \t\tthis.fn = createFunction(template.s, template.r.length);\n  \t\tthis.computation = null;\n\n  \t\tthis.resolvers = [];\n  \t\tthis.models = template.r.map(function (ref, index) {\n  \t\t\tvar model = resolveReference(fragment, ref);\n  \t\t\tvar resolver = undefined;\n\n  \t\t\tif (!model) {\n  \t\t\t\tresolver = fragment.resolve(ref, function (model) {\n  \t\t\t\t\tremoveFromArray(_this.resolvers, resolver);\n  \t\t\t\t\t_this.models[index] = model;\n  \t\t\t\t\t_this.bubble();\n  \t\t\t\t});\n\n  \t\t\t\t_this.resolvers.push(resolver);\n  \t\t\t}\n\n  \t\t\treturn model;\n  \t\t});\n\n  \t\tthis.bubble();\n  \t}\n\n  \tExpressionProxy.prototype.bubble = function bubble() {\n  \t\tvar _this2 = this;\n\n  \t\tvar ractive = this.fragment.ractive;\n\n  \t\t// TODO the @ prevents computed props from shadowing keypaths, but the real\n  \t\t// question is why it's a computed prop in the first place... (hint, it's\n  \t\t// to do with {{else}} blocks)\n  \t\tvar key = '@' + this.template.s.replace(/_(\\d+)/g, function (match, i) {\n  \t\t\tif (i >= _this2.models.length) return match;\n\n  \t\t\tvar model = _this2.models[i];\n  \t\t\treturn model ? model.getKeypath() : '@undefined';\n  \t\t});\n\n  \t\t// TODO can/should we reuse computations?\n  \t\tvar signature = {\n  \t\t\tgetter: function () {\n  \t\t\t\tvar values = _this2.models.map(getValue);\n  \t\t\t\treturn _this2.fn.apply(ractive, values);\n  \t\t\t},\n  \t\t\tgetterString: key\n  \t\t};\n\n  \t\tvar computation = ractive.viewmodel.compute(key, signature);\n\n  \t\tthis.value = computation.get(); // TODO should not need this, eventually\n\n  \t\tif (this.computation) {\n  \t\t\tthis.computation.unregister(this);\n  \t\t\t// notify children...\n  \t\t}\n\n  \t\tthis.computation = computation;\n  \t\tcomputation.register(this);\n\n  \t\tthis.handleChange();\n  \t};\n\n  \tExpressionProxy.prototype.get = function get() {\n  \t\treturn this.computation.get();\n  \t};\n\n  \tExpressionProxy.prototype.getKeypath = function getKeypath() {\n  \t\treturn this.computation ? this.computation.getKeypath() : '@undefined';\n  \t};\n\n  \tExpressionProxy.prototype.handleChange = function handleChange() {\n  \t\tthis.deps.forEach(_handleChange);\n  \t\tthis.children.forEach(_handleChange);\n\n  \t\tthis.clearUnresolveds();\n  \t};\n\n  \tExpressionProxy.prototype.joinKey = function joinKey(key) {\n  \t\tif (key === undefined || key === '') return this;\n\n  \t\tif (!this.childByKey.hasOwnProperty(key)) {\n  \t\t\tvar child = new ComputationChild(this, key);\n  \t\t\tthis.children.push(child);\n  \t\t\tthis.childByKey[key] = child;\n  \t\t}\n\n  \t\treturn this.childByKey[key];\n  \t};\n\n  \tExpressionProxy.prototype.mark = function mark() {\n  \t\tthis.handleChange();\n  \t};\n\n  \tExpressionProxy.prototype.retrieve = function retrieve() {\n  \t\treturn this.get();\n  \t};\n\n  \tExpressionProxy.prototype.unbind = function unbind() {\n  \t\tthis.resolvers.forEach(_unbind);\n  \t};\n\n  \treturn ExpressionProxy;\n  })(Model);\n\n  var ReferenceExpressionProxy = (function (_Model) {\n  \tinherits(ReferenceExpressionProxy, _Model);\n\n  \tfunction ReferenceExpressionProxy(fragment, template) {\n  \t\tvar _this = this;\n\n  \t\tclassCallCheck(this, ReferenceExpressionProxy);\n\n  \t\t_Model.call(this, null, null);\n  \t\tthis.root = fragment.ractive.viewmodel;\n\n  \t\tthis.resolvers = [];\n\n  \t\tthis.base = resolve$1(fragment, template);\n  \t\tvar baseResolver = undefined;\n\n  \t\tif (!this.base) {\n  \t\t\tbaseResolver = fragment.resolve(template.r, function (model) {\n  \t\t\t\t_this.base = model;\n  \t\t\t\t_this.bubble();\n\n  \t\t\t\tremoveFromArray(_this.resolvers, baseResolver);\n  \t\t\t});\n\n  \t\t\tthis.resolvers.push(baseResolver);\n  \t\t}\n\n  \t\tvar intermediary = {\n  \t\t\thandleChange: function () {\n  \t\t\t\treturn _this.bubble();\n  \t\t\t}\n  \t\t};\n\n  \t\tthis.members = template.m.map(function (template, i) {\n  \t\t\tif (typeof template === 'string') {\n  \t\t\t\treturn { get: function () {\n  \t\t\t\t\t\treturn template;\n  \t\t\t\t\t} };\n  \t\t\t}\n\n  \t\t\tvar model = undefined;\n  \t\t\tvar resolver = undefined;\n\n  \t\t\tif (template.t === REFERENCE) {\n  \t\t\t\tmodel = resolveReference(fragment, template.n);\n\n  \t\t\t\tif (model) {\n  \t\t\t\t\tmodel.register(intermediary);\n  \t\t\t\t} else {\n  \t\t\t\t\tresolver = fragment.resolve(template.n, function (model) {\n  \t\t\t\t\t\t_this.members[i] = model;\n\n  \t\t\t\t\t\tmodel.register(intermediary);\n  \t\t\t\t\t\t_this.bubble();\n\n  \t\t\t\t\t\tremoveFromArray(_this.resolvers, resolver);\n  \t\t\t\t\t});\n\n  \t\t\t\t\t_this.resolvers.push(resolver);\n  \t\t\t\t}\n\n  \t\t\t\treturn model;\n  \t\t\t}\n\n  \t\t\tmodel = new ExpressionProxy(fragment, template);\n  \t\t\tmodel.register(intermediary);\n  \t\t\treturn model;\n  \t\t});\n\n  \t\tthis.isUnresolved = true;\n  \t\tthis.bubble();\n  \t}\n\n  \tReferenceExpressionProxy.prototype.bubble = function bubble() {\n  \t\tif (!this.base) return;\n\n  \t\t// if some members are not resolved, abort\n  \t\tvar i = this.members.length;\n  \t\twhile (i--) {\n  \t\t\tif (!this.members[i]) return;\n  \t\t}\n\n  \t\tthis.isUnresolved = false;\n\n  \t\tvar keys = this.members.map(function (model) {\n  \t\t\treturn escapeKey(String(model.get()));\n  \t\t});\n  \t\tvar model = this.base.joinAll(keys);\n\n  \t\tif (this.model) {\n  \t\t\tthis.model.unregister(this);\n  \t\t\tthis.model.unregisterTwowayBinding(this);\n  \t\t}\n\n  \t\tthis.model = model;\n  \t\tthis.parent = model.parent;\n\n  \t\tmodel.register(this);\n  \t\tmodel.registerTwowayBinding(this);\n\n  \t\tif (this.keypathModel) this.keypathModel.handleChange();\n\n  \t\tthis.mark();\n  \t};\n\n  \tReferenceExpressionProxy.prototype.forceResolution = function forceResolution() {\n  \t\tthis.resolvers.forEach(function (resolver) {\n  \t\t\treturn resolver.forceResolution();\n  \t\t});\n  \t\tthis.bubble();\n  \t};\n\n  \tReferenceExpressionProxy.prototype.get = function get() {\n  \t\treturn this.model ? this.model.get() : undefined;\n  \t};\n\n  \t// indirect two-way bindings\n\n  \tReferenceExpressionProxy.prototype.getValue = function getValue() {\n  \t\tvar i = this.bindings.length;\n  \t\twhile (i--) {\n  \t\t\tvar value = this.bindings[i].getValue();\n  \t\t\tif (value !== this.value) return value;\n  \t\t}\n\n  \t\treturn this.value;\n  \t};\n\n  \tReferenceExpressionProxy.prototype.getKeypath = function getKeypath() {\n  \t\treturn this.model ? this.model.getKeypath() : '@undefined';\n  \t};\n\n  \tReferenceExpressionProxy.prototype.handleChange = function handleChange() {\n  \t\tthis.mark();\n  \t};\n\n  \tReferenceExpressionProxy.prototype.retrieve = function retrieve() {\n  \t\treturn this.get();\n  \t};\n\n  \tReferenceExpressionProxy.prototype.set = function set(value) {\n  \t\tif (!this.model) throw new Error('Unresolved reference expression. This should not happen!');\n  \t\tthis.model.set(value);\n  \t};\n\n  \tReferenceExpressionProxy.prototype.unbind = function unbind() {\n  \t\tthis.resolvers.forEach(_unbind);\n  \t};\n\n  \treturn ReferenceExpressionProxy;\n  })(Model);\n\n  function resolve$1(fragment, template) {\n  \tif (template.r) {\n  \t\treturn resolveReference(fragment, template.r);\n  \t} else if (template.x) {\n  \t\treturn new ExpressionProxy(fragment, template.x);\n  \t} else {\n  \t\treturn new ReferenceExpressionProxy(fragment, template.rx);\n  \t}\n  }\n\n  function resolveAliases(section) {\n  \tif (section.template.z) {\n  \t\tsection.aliases = {};\n\n  \t\tvar refs = section.template.z;\n  \t\tfor (var i = 0; i < refs.length; i++) {\n  \t\t\tsection.aliases[refs[i].n] = resolve$1(section.parentFragment, refs[i].x);\n  \t\t}\n  \t}\n  }\n\n  var Alias = (function (_Item) {\n  \tinherits(Alias, _Item);\n\n  \tfunction Alias(options) {\n  \t\tclassCallCheck(this, Alias);\n\n  \t\t_Item.call(this, options);\n\n  \t\tthis.fragment = null;\n  \t}\n\n  \tAlias.prototype.bind = function bind() {\n  \t\tresolveAliases(this);\n\n  \t\tthis.fragment = new Fragment({\n  \t\t\towner: this,\n  \t\t\ttemplate: this.template.f\n  \t\t}).bind();\n  \t};\n\n  \tAlias.prototype.detach = function detach() {\n  \t\treturn this.fragment ? this.fragment.detach() : createDocumentFragment();\n  \t};\n\n  \tAlias.prototype.find = function find(selector) {\n  \t\tif (this.fragment) {\n  \t\t\treturn this.fragment.find(selector);\n  \t\t}\n  \t};\n\n  \tAlias.prototype.findAll = function findAll(selector, query) {\n  \t\tif (this.fragment) {\n  \t\t\tthis.fragment.findAll(selector, query);\n  \t\t}\n  \t};\n\n  \tAlias.prototype.findComponent = function findComponent(name) {\n  \t\tif (this.fragment) {\n  \t\t\treturn this.fragment.findComponent(name);\n  \t\t}\n  \t};\n\n  \tAlias.prototype.findAllComponents = function findAllComponents(name, query) {\n  \t\tif (this.fragment) {\n  \t\t\tthis.fragment.findAllComponents(name, query);\n  \t\t}\n  \t};\n\n  \tAlias.prototype.firstNode = function firstNode() {\n  \t\treturn this.fragment && this.fragment.firstNode();\n  \t};\n\n  \tAlias.prototype.rebind = function rebind() {\n  \t\tresolveAliases(this);\n  \t\tif (this.fragment) this.fragment.rebind();\n  \t};\n\n  \tAlias.prototype.render = function render(target) {\n  \t\tthis.rendered = true;\n  \t\tif (this.fragment) this.fragment.render(target);\n  \t};\n\n  \tAlias.prototype.toString = function toString(escape) {\n  \t\treturn this.fragment ? this.fragment.toString(escape) : '';\n  \t};\n\n  \tAlias.prototype.unbind = function unbind() {\n  \t\tthis.aliases = {};\n  \t\tif (this.fragment) this.fragment.unbind();\n  \t};\n\n  \tAlias.prototype.unrender = function unrender(shouldDestroy) {\n  \t\tif (this.rendered && this.fragment) this.fragment.unrender(shouldDestroy);\n  \t\tthis.rendered = false;\n  \t};\n\n  \tAlias.prototype.update = function update() {\n  \t\tif (!this.dirty) return;\n\n  \t\tthis.fragment.update();\n\n  \t\tthis.dirty = false;\n  \t};\n\n  \treturn Alias;\n  })(Item);\n\n  var Doctype = (function (_Item) {\n  \tinherits(Doctype, _Item);\n\n  \tfunction Doctype() {\n  \t\tclassCallCheck(this, Doctype);\n\n  \t\t_Item.apply(this, arguments);\n  \t}\n\n  \tDoctype.prototype.bind = function bind() {\n  \t\t// noop\n  \t};\n\n  \tDoctype.prototype.render = function render() {\n  \t\t// noop\n  \t};\n\n  \tDoctype.prototype.teardown = function teardown() {\n  \t\t// noop\n  \t};\n\n  \tDoctype.prototype.toString = function toString() {\n  \t\treturn '<!DOCTYPE' + this.template.a + '>';\n  \t};\n\n  \tDoctype.prototype.unbind = function unbind() {\n  \t\t// noop\n  \t};\n\n  \tDoctype.prototype.unrender = function unrender() {\n  \t\t// noop\n  \t};\n\n  \treturn Doctype;\n  })(Item);\n\n  var Mustache = (function (_Item) {\n  \tinherits(Mustache, _Item);\n\n  \tfunction Mustache(options) {\n  \t\tclassCallCheck(this, Mustache);\n\n  \t\t_Item.call(this, options);\n\n  \t\tthis.parentFragment = options.parentFragment;\n  \t\tthis.template = options.template;\n  \t\tthis.index = options.index;\n\n  \t\tthis.isStatic = !!options.template.s;\n\n  \t\tthis.model = null;\n  \t\tthis.dirty = false;\n  \t}\n\n  \tMustache.prototype.bind = function bind() {\n  \t\tvar _this = this;\n\n  \t\t// try to find a model for this view\n  \t\tvar model = resolve$1(this.parentFragment, this.template);\n  \t\tvar value = model ? model.get() : undefined;\n\n  \t\tif (this.isStatic) {\n  \t\t\tthis.model = { get: function () {\n  \t\t\t\t\treturn value;\n  \t\t\t\t} };\n  \t\t\treturn;\n  \t\t}\n\n  \t\tif (model) {\n  \t\t\tmodel.register(this);\n  \t\t\tthis.model = model;\n  \t\t} else {\n  \t\t\tthis.resolver = this.parentFragment.resolve(this.template.r, function (model) {\n  \t\t\t\t_this.model = model;\n  \t\t\t\tmodel.register(_this);\n\n  \t\t\t\t_this.handleChange();\n  \t\t\t\t_this.resolver = null;\n  \t\t\t});\n  \t\t}\n  \t};\n\n  \tMustache.prototype.handleChange = function handleChange() {\n  \t\tthis.bubble();\n  \t};\n\n  \tMustache.prototype.rebind = function rebind() {\n  \t\tif (this.isStatic || !this.model) return;\n\n  \t\tvar model = resolve$1(this.parentFragment, this.template);\n\n  \t\tif (model === this.model) return;\n\n  \t\tvar oldValue = this.model.get();\n  \t\tthis.model.unregister(this);\n\n  \t\tthis.model = model;\n\n  \t\tif (model) {\n  \t\t\tmodel.register(this);\n  \t\t\tif (model.get() !== oldValue) this.handleChange();\n  \t\t}\n  \t};\n\n  \tMustache.prototype.unbind = function unbind() {\n  \t\tif (!this.isStatic) {\n  \t\t\tthis.model && this.model.unregister(this);\n  \t\t\tthis.resolver && this.resolver.unbind();\n  \t\t}\n  \t};\n\n  \treturn Mustache;\n  })(Item);\n\n  var Interpolator = (function (_Mustache) {\n  \tinherits(Interpolator, _Mustache);\n\n  \tfunction Interpolator() {\n  \t\tclassCallCheck(this, Interpolator);\n\n  \t\t_Mustache.apply(this, arguments);\n  \t}\n\n  \tInterpolator.prototype.detach = function detach() {\n  \t\treturn detachNode(this.node);\n  \t};\n\n  \tInterpolator.prototype.firstNode = function firstNode() {\n  \t\treturn this.node;\n  \t};\n\n  \tInterpolator.prototype.getString = function getString() {\n  \t\treturn this.model ? safeToStringValue(this.model.get()) : '';\n  \t};\n\n  \tInterpolator.prototype.render = function render(target, occupants) {\n  \t\tvar value = this.getString();\n\n  \t\tthis.rendered = true;\n\n  \t\tif (occupants) {\n  \t\t\tvar n = occupants[0];\n  \t\t\tif (n && n.nodeType === 3) {\n  \t\t\t\toccupants.shift();\n  \t\t\t\tif (n.nodeValue !== value) {\n  \t\t\t\t\tn.nodeValue = value;\n  \t\t\t\t}\n  \t\t\t} else {\n  \t\t\t\tn = this.node = doc.createTextNode(value);\n  \t\t\t\tif (occupants[0]) {\n  \t\t\t\t\ttarget.insertBefore(n, occupants[0]);\n  \t\t\t\t} else {\n  \t\t\t\t\ttarget.appendChild(n);\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\tthis.node = n;\n  \t\t} else {\n  \t\t\tthis.node = doc.createTextNode(value);\n  \t\t\ttarget.appendChild(this.node);\n  \t\t}\n  \t};\n\n  \tInterpolator.prototype.toString = function toString(escape) {\n  \t\tvar string = this.getString();\n  \t\treturn escape ? escapeHtml(string) : string;\n  \t};\n\n  \tInterpolator.prototype.unrender = function unrender(shouldDestroy) {\n  \t\tif (shouldDestroy) this.detach();\n  \t\tthis.rendered = false;\n  \t};\n\n  \tInterpolator.prototype.update = function update() {\n  \t\tif (this.dirty) {\n  \t\t\tif (this.rendered) {\n  \t\t\t\tthis.node.data = this.getString();\n  \t\t\t}\n\n  \t\t\tthis.dirty = false;\n  \t\t}\n  \t};\n\n  \tInterpolator.prototype.valueOf = function valueOf() {\n  \t\treturn this.model ? this.model.get() : undefined;\n  \t};\n\n  \treturn Interpolator;\n  })(Mustache);\n\n  function findInViewHierarchy(registryName, ractive, name) {\n  \tvar instance = findInstance(registryName, ractive, name);\n  \treturn instance ? instance[registryName][name] : null;\n  }\n\n  function findInstance(registryName, ractive, name) {\n  \twhile (ractive) {\n  \t\tif (name in ractive[registryName]) {\n  \t\t\treturn ractive;\n  \t\t}\n\n  \t\tif (ractive.isolated) {\n  \t\t\treturn null;\n  \t\t}\n\n  \t\tractive = ractive.parent;\n  \t}\n  }\n\n  function getPartialTemplate(ractive, name, parentFragment) {\n  \t// If the partial in instance or view heirarchy instances, great\n  \tvar partial = getPartialFromRegistry(ractive, name, parentFragment || {});\n  \tif (partial) return partial;\n\n  \t// Does it exist on the page as a script tag?\n  \tpartial = parser$1.fromId(name, { noThrow: true });\n  \tif (partial) {\n  \t\t// parse and register to this ractive instance\n  \t\tvar parsed = parser$1.parse(partial, parser$1.getParseOptions(ractive));\n\n  \t\t// register (and return main partial if there are others in the template)\n  \t\treturn ractive.partials[name] = parsed.t;\n  \t}\n  }\n\n  function getPartialFromRegistry(ractive, name, parentFragment) {\n  \t// if there was an instance up-hierarchy, cool\n  \tvar partial = findParentPartial(name, parentFragment.owner);\n  \tif (partial) return partial;\n\n  \t// find first instance in the ractive or view hierarchy that has this partial\n  \tvar instance = findInstance('partials', ractive, name);\n\n  \tif (!instance) {\n  \t\treturn;\n  \t}\n\n  \tpartial = instance.partials[name];\n\n  \t// partial is a function?\n  \tvar fn = undefined;\n  \tif (typeof partial === 'function') {\n  \t\tfn = partial.bind(instance);\n  \t\tfn.isOwner = instance.partials.hasOwnProperty(name);\n  \t\tpartial = fn.call(ractive, parser$1);\n  \t}\n\n  \tif (!partial && partial !== '') {\n  \t\twarnIfDebug(noRegistryFunctionReturn, name, 'partial', 'partial', { ractive: ractive });\n  \t\treturn;\n  \t}\n\n  \t// If this was added manually to the registry,\n  \t// but hasn't been parsed, parse it now\n  \tif (!parser$1.isParsed(partial)) {\n  \t\t// use the parseOptions of the ractive instance on which it was found\n  \t\tvar parsed = parser$1.parse(partial, parser$1.getParseOptions(instance));\n\n  \t\t// Partials cannot contain nested partials!\n  \t\t// TODO add a test for this\n  \t\tif (parsed.p) {\n  \t\t\twarnIfDebug('Partials ({{>%s}}) cannot contain nested inline partials', name, { ractive: ractive });\n  \t\t}\n\n  \t\t// if fn, use instance to store result, otherwise needs to go\n  \t\t// in the correct point in prototype chain on instance or constructor\n  \t\tvar target = fn ? instance : findOwner(instance, name);\n\n  \t\t// may be a template with partials, which need to be registered and main template extracted\n  \t\ttarget.partials[name] = partial = parsed.t;\n  \t}\n\n  \t// store for reset\n  \tif (fn) partial._fn = fn;\n\n  \treturn partial.v ? partial.t : partial;\n  }\n\n  function findOwner(ractive, key) {\n  \treturn ractive.partials.hasOwnProperty(key) ? ractive : findConstructor(ractive.constructor, key);\n  }\n\n  function findConstructor(constructor, key) {\n  \tif (!constructor) {\n  \t\treturn;\n  \t}\n  \treturn constructor.partials.hasOwnProperty(key) ? constructor : findConstructor(constructor._Parent, key);\n  }\n\n  function findParentPartial(name, parent) {\n  \tif (parent) {\n  \t\tif (parent.template && parent.template.p && parent.template.p[name]) {\n  \t\t\treturn parent.template.p[name];\n  \t\t} else if (parent.parentFragment && parent.parentFragment.owner) {\n  \t\t\treturn findParentPartial(name, parent.parentFragment.owner);\n  \t\t}\n  \t}\n  }\n\n  var Partial = (function (_Mustache) {\n  \tinherits(Partial, _Mustache);\n\n  \tfunction Partial() {\n  \t\tclassCallCheck(this, Partial);\n\n  \t\t_Mustache.apply(this, arguments);\n  \t}\n\n  \tPartial.prototype.bind = function bind() {\n  \t\t_Mustache.prototype.bind.call(this);\n\n  \t\t// keep track of the reference name for future resets\n  \t\tthis.refName = this.template.r;\n\n  \t\t// name matches take priority over expressions\n  \t\tvar template = this.refName ? getPartialTemplate(this.ractive, this.refName, this.parentFragment) || null : null;\n\n  \t\tif (template) {\n  \t\t\tthis.named = true;\n  \t\t\tthis.setTemplate(this.template.r, template);\n  \t\t} else if ((!this.model || typeof this.model.get() !== 'string') && this.refName) {\n  \t\t\tthis.setTemplate(this.refName, template);\n  \t\t} else {\n  \t\t\tthis.setTemplate(this.model.get());\n  \t\t}\n\n  \t\tthis.fragment = new Fragment({\n  \t\t\towner: this,\n  \t\t\ttemplate: this.partialTemplate\n  \t\t}).bind();\n  \t};\n\n  \tPartial.prototype.detach = function detach() {\n  \t\treturn this.fragment.detach();\n  \t};\n\n  \tPartial.prototype.find = function find(selector) {\n  \t\treturn this.fragment.find(selector);\n  \t};\n\n  \tPartial.prototype.findAll = function findAll(selector, query) {\n  \t\tthis.fragment.findAll(selector, query);\n  \t};\n\n  \tPartial.prototype.findComponent = function findComponent(name) {\n  \t\treturn this.fragment.findComponent(name);\n  \t};\n\n  \tPartial.prototype.findAllComponents = function findAllComponents(name, query) {\n  \t\tthis.fragment.findAllComponents(name, query);\n  \t};\n\n  \tPartial.prototype.firstNode = function firstNode() {\n  \t\treturn this.fragment.firstNode();\n  \t};\n\n  \tPartial.prototype.forceResetTemplate = function forceResetTemplate() {\n  \t\tthis.partialTemplate = undefined;\n\n  \t\t// on reset, check for the reference name first\n  \t\tif (this.refName) {\n  \t\t\tthis.partialTemplate = getPartialTemplate(this.ractive, this.refName, this.parentFragment);\n  \t\t}\n\n  \t\t// then look for the resolved name\n  \t\tif (!this.partialTemplate) {\n  \t\t\tthis.partialTemplate = getPartialTemplate(this.ractive, this.name, this.parentFragment);\n  \t\t}\n\n  \t\tif (!this.partialTemplate) {\n  \t\t\twarnOnceIfDebug('Could not find template for partial \\'' + this.name + '\\'');\n  \t\t\tthis.partialTemplate = [];\n  \t\t}\n\n  \t\tthis.fragment.resetTemplate(this.partialTemplate);\n  \t\tthis.bubble();\n  \t};\n\n  \tPartial.prototype.rebind = function rebind() {\n  \t\t_Mustache.prototype.unbind.call(this);\n  \t\t_Mustache.prototype.bind.call(this);\n  \t\tthis.fragment.rebind();\n  \t};\n\n  \tPartial.prototype.render = function render(target, occupants) {\n  \t\tthis.fragment.render(target, occupants);\n  \t};\n\n  \tPartial.prototype.setTemplate = function setTemplate(name, template) {\n  \t\tthis.name = name;\n\n  \t\tif (!template && template !== null) template = getPartialTemplate(this.ractive, name, this.parentFragment);\n\n  \t\tif (!template) {\n  \t\t\twarnOnceIfDebug('Could not find template for partial \\'' + name + '\\'');\n  \t\t}\n\n  \t\tthis.partialTemplate = template || [];\n  \t};\n\n  \tPartial.prototype.toString = function toString(escape) {\n  \t\treturn this.fragment.toString(escape);\n  \t};\n\n  \tPartial.prototype.unbind = function unbind() {\n  \t\t_Mustache.prototype.unbind.call(this);\n  \t\tthis.fragment.unbind();\n  \t};\n\n  \tPartial.prototype.unrender = function unrender(shouldDestroy) {\n  \t\tthis.fragment.unrender(shouldDestroy);\n  \t};\n\n  \tPartial.prototype.update = function update() {\n  \t\tif (this.dirty) {\n  \t\t\tif (!this.named) {\n  \t\t\t\tif (this.model && typeof this.model.get() === 'string' && this.model.get() !== this.name) {\n  \t\t\t\t\tthis.setTemplate(this.model.get());\n  \t\t\t\t\tthis.fragment.resetTemplate(this.partialTemplate);\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\tthis.fragment.update();\n  \t\t\tthis.dirty = false;\n  \t\t}\n  \t};\n\n  \treturn Partial;\n  })(Mustache);\n\n  function getRefs(ref, value, parent) {\n  \tvar refs = undefined;\n\n  \tif (ref) {\n  \t\trefs = {};\n  \t\tObject.keys(parent).forEach(function (ref) {\n  \t\t\trefs[ref] = parent[ref];\n  \t\t});\n  \t\trefs[ref] = value;\n  \t} else {\n  \t\trefs = parent;\n  \t}\n\n  \treturn refs;\n  }\n\n  var RepeatedFragment = (function () {\n  \tfunction RepeatedFragment(options) {\n  \t\tclassCallCheck(this, RepeatedFragment);\n\n  \t\tthis.parent = options.owner.parentFragment;\n\n  \t\t// bit of a hack, so reference resolution works without another\n  \t\t// layer of indirection\n  \t\tthis.parentFragment = this;\n  \t\tthis.owner = options.owner;\n  \t\tthis.ractive = this.parent.ractive;\n\n  \t\tthis.context = null;\n  \t\tthis.rendered = false;\n  \t\tthis.iterations = [];\n\n  \t\tthis.template = options.template;\n\n  \t\tthis.indexRef = options.indexRef;\n  \t\tthis.keyRef = options.keyRef;\n  \t\tthis.indexByKey = null; // for `{{#each object}}...`\n\n  \t\tthis.pendingNewIndices = null;\n  \t\tthis.previousIterations = null;\n\n  \t\t// track array versus object so updates of type rest\n  \t\tthis.isArray = false;\n  \t}\n\n  \tRepeatedFragment.prototype.bind = function bind(context) {\n  \t\tvar _this = this;\n\n  \t\tthis.context = context;\n  \t\tvar value = context.get();\n\n  \t\t// {{#each array}}...\n  \t\tif (this.isArray = isArray(value)) {\n  \t\t\t// we can't use map, because of sparse arrays\n  \t\t\tthis.iterations = [];\n  \t\t\tfor (var i = 0; i < value.length; i += 1) {\n  \t\t\t\tthis.iterations[i] = this.createIteration(i, i);\n  \t\t\t}\n  \t\t}\n\n  \t\t// {{#each object}}...\n  \t\telse if (isObject(value)) {\n  \t\t\t\tthis.isArray = false;\n\n  \t\t\t\t// TODO this is a dreadful hack. There must be a neater way\n  \t\t\t\tif (this.indexRef) {\n  \t\t\t\t\tvar refs = this.indexRef.split(',');\n  \t\t\t\t\tthis.keyRef = refs[0];\n  \t\t\t\t\tthis.indexRef = refs[1];\n  \t\t\t\t}\n\n  \t\t\t\tthis.indexByKey = {};\n  \t\t\t\tthis.iterations = Object.keys(value).map(function (key, index) {\n  \t\t\t\t\t_this.indexByKey[key] = index;\n  \t\t\t\t\treturn _this.createIteration(key, index);\n  \t\t\t\t});\n  \t\t\t}\n\n  \t\treturn this;\n  \t};\n\n  \tRepeatedFragment.prototype.bubble = function bubble() {\n  \t\tthis.owner.bubble();\n  \t};\n\n  \tRepeatedFragment.prototype.createIteration = function createIteration(key, index) {\n  \t\tvar parentFragment = this.owner.parentFragment;\n  \t\tvar keyRefs = getRefs(this.keyRef, key, parentFragment.keyRefs);\n  \t\tvar indexRefs = getRefs(this.indexRef, index, parentFragment.indexRefs);\n\n  \t\tvar fragment = new Fragment({\n  \t\t\towner: this,\n  \t\t\ttemplate: this.template,\n  \t\t\tindexRefs: indexRefs,\n  \t\t\tkeyRefs: keyRefs\n  \t\t});\n\n  \t\t// TODO this is a bit hacky\n  \t\tfragment.key = key;\n  \t\tfragment.index = index;\n  \t\tfragment.isIteration = true;\n\n  \t\tvar model = this.context.joinKey(key);\n\n  \t\t// set up an iteration alias if there is one\n  \t\tif (this.owner.template.z) {\n  \t\t\tfragment.aliases = defineProperty({}, this.owner.template.z[0].n, model);\n  \t\t}\n\n  \t\treturn fragment.bind(model);\n  \t};\n\n  \tRepeatedFragment.prototype.detach = function detach() {\n  \t\tvar docFrag = createDocumentFragment();\n  \t\tthis.iterations.forEach(function (fragment) {\n  \t\t\treturn docFrag.appendChild(fragment.detach());\n  \t\t});\n  \t\treturn docFrag;\n  \t};\n\n  \tRepeatedFragment.prototype.find = function find(selector) {\n  \t\tvar len = this.iterations.length;\n  \t\tvar i = undefined;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tvar found = this.iterations[i].find(selector);\n  \t\t\tif (found) return found;\n  \t\t}\n  \t};\n\n  \tRepeatedFragment.prototype.findAll = function findAll(selector, query) {\n  \t\tvar len = this.iterations.length;\n  \t\tvar i = undefined;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tthis.iterations[i].findAll(selector, query);\n  \t\t}\n  \t};\n\n  \tRepeatedFragment.prototype.findComponent = function findComponent(name) {\n  \t\tvar len = this.iterations.length;\n  \t\tvar i = undefined;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tvar found = this.iterations[i].findComponent(name);\n  \t\t\tif (found) return found;\n  \t\t}\n  \t};\n\n  \tRepeatedFragment.prototype.findAllComponents = function findAllComponents(name, query) {\n  \t\tvar len = this.iterations.length;\n  \t\tvar i = undefined;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tthis.iterations[i].findAllComponents(name, query);\n  \t\t}\n  \t};\n\n  \tRepeatedFragment.prototype.findNextNode = function findNextNode(iteration) {\n  \t\tif (iteration.index < this.iterations.length - 1) {\n  \t\t\tfor (var i = iteration.index + 1; i < this.iterations.length; i++) {\n  \t\t\t\tvar node = this.iterations[i].firstNode();\n  \t\t\t\tif (node) return node;\n  \t\t\t}\n  \t\t}\n\n  \t\treturn this.owner.findNextNode();\n  \t};\n\n  \tRepeatedFragment.prototype.firstNode = function firstNode() {\n  \t\treturn this.iterations[0] ? this.iterations[0].firstNode() : null;\n  \t};\n\n  \tRepeatedFragment.prototype.rebind = function rebind(context) {\n  \t\tvar _this2 = this;\n\n  \t\tthis.context = context;\n\n  \t\t// {{#each array}}...\n  \t\tif (isArray(context.get())) {\n  \t\t\tthis.iterations.forEach(function (fragment, i) {\n  \t\t\t\tvar model = context.joinKey(i);\n  \t\t\t\tif (_this2.owner.template.z) {\n  \t\t\t\t\tfragment.aliases = defineProperty({}, _this2.owner.template.z[0].n, model);\n  \t\t\t\t}\n  \t\t\t\tfragment.rebind(model);\n  \t\t\t});\n  \t\t}\n  \t};\n\n  \tRepeatedFragment.prototype.render = function render(target, occupants) {\n  \t\t// TODO use docFrag.cloneNode...\n\n  \t\tif (this.iterations) {\n  \t\t\tthis.iterations.forEach(function (fragment) {\n  \t\t\t\treturn fragment.render(target, occupants);\n  \t\t\t});\n  \t\t}\n\n  \t\tthis.rendered = true;\n  \t};\n\n  \tRepeatedFragment.prototype.shuffle = function shuffle(newIndices) {\n  \t\tvar _this3 = this;\n\n  \t\tif (!this.pendingNewIndices) this.previousIterations = this.iterations.slice();\n\n  \t\tif (!this.pendingNewIndices) this.pendingNewIndices = [];\n\n  \t\tthis.pendingNewIndices.push(newIndices);\n\n  \t\tvar iterations = [];\n\n  \t\tnewIndices.forEach(function (newIndex, oldIndex) {\n  \t\t\tif (newIndex === -1) return;\n\n  \t\t\tvar fragment = _this3.iterations[oldIndex];\n  \t\t\titerations[newIndex] = fragment;\n\n  \t\t\tif (newIndex !== oldIndex && fragment) fragment.dirty = true;\n  \t\t});\n\n  \t\tthis.iterations = iterations;\n\n  \t\tthis.bubble();\n  \t};\n\n  \tRepeatedFragment.prototype.toString = function toString(escape) {\n  \t\treturn this.iterations ? this.iterations.map(escape ? toEscapedString : _toString).join('') : '';\n  \t};\n\n  \tRepeatedFragment.prototype.unbind = function unbind() {\n  \t\tthis.iterations.forEach(_unbind);\n  \t\treturn this;\n  \t};\n\n  \tRepeatedFragment.prototype.unrender = function unrender(shouldDestroy) {\n  \t\tthis.iterations.forEach(shouldDestroy ? unrenderAndDestroy$1 : _unrender);\n  \t\tthis.rendered = false;\n  \t};\n\n  \t// TODO smart update\n\n  \tRepeatedFragment.prototype.update = function update() {\n  \t\tvar _this4 = this;\n\n  \t\t// skip dirty check, since this is basically just a facade\n\n  \t\tif (this.pendingNewIndices) {\n  \t\t\tthis.updatePostShuffle();\n  \t\t\treturn;\n  \t\t}\n\n  \t\tvar value = this.context.get(),\n  \t\t    wasArray = this.isArray;\n\n  \t\tvar toRemove = undefined;\n  \t\tvar oldKeys = undefined;\n  \t\tvar reset = true;\n  \t\tvar i = undefined;\n\n  \t\tif (this.isArray = isArray(value)) {\n  \t\t\tif (wasArray) {\n  \t\t\t\treset = false;\n  \t\t\t\tif (this.iterations.length > value.length) {\n  \t\t\t\t\ttoRemove = this.iterations.splice(value.length);\n  \t\t\t\t}\n  \t\t\t}\n  \t\t} else if (isObject(value) && !wasArray) {\n  \t\t\treset = false;\n  \t\t\ttoRemove = [];\n  \t\t\toldKeys = {};\n  \t\t\ti = this.iterations.length;\n\n  \t\t\twhile (i--) {\n  \t\t\t\tvar _fragment = this.iterations[i];\n  \t\t\t\tif (_fragment.key in value) {\n  \t\t\t\t\toldKeys[_fragment.key] = true;\n  \t\t\t\t} else {\n  \t\t\t\t\tthis.iterations.splice(i, 1);\n  \t\t\t\t\ttoRemove.push(_fragment);\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\tif (reset) {\n  \t\t\ttoRemove = this.iterations;\n  \t\t\tthis.iterations = [];\n  \t\t}\n\n  \t\tif (toRemove) {\n  \t\t\ttoRemove.forEach(function (fragment) {\n  \t\t\t\tfragment.unbind();\n  \t\t\t\tfragment.unrender(true);\n  \t\t\t});\n  \t\t}\n\n  \t\t// update the remaining ones\n  \t\tthis.iterations.forEach(_update);\n\n  \t\t// add new iterations\n  \t\tvar newLength = isArray(value) ? value.length : isObject(value) ? Object.keys(value).length : 0;\n\n  \t\tvar docFrag = undefined;\n  \t\tvar fragment = undefined;\n\n  \t\tif (newLength > this.iterations.length) {\n  \t\t\tdocFrag = this.rendered ? createDocumentFragment() : null;\n  \t\t\ti = this.iterations.length;\n\n  \t\t\tif (isArray(value)) {\n  \t\t\t\twhile (i < value.length) {\n  \t\t\t\t\tfragment = this.createIteration(i, i);\n\n  \t\t\t\t\tthis.iterations.push(fragment);\n  \t\t\t\t\tif (this.rendered) fragment.render(docFrag);\n\n  \t\t\t\t\ti += 1;\n  \t\t\t\t}\n  \t\t\t} else if (isObject(value)) {\n  \t\t\t\tObject.keys(value).forEach(function (key) {\n  \t\t\t\t\tif (!oldKeys || !(key in oldKeys)) {\n  \t\t\t\t\t\tfragment = _this4.createIteration(key, i);\n\n  \t\t\t\t\t\t_this4.iterations.push(fragment);\n  \t\t\t\t\t\tif (_this4.rendered) fragment.render(docFrag);\n\n  \t\t\t\t\t\ti += 1;\n  \t\t\t\t\t}\n  \t\t\t\t});\n  \t\t\t}\n\n  \t\t\tif (this.rendered) {\n  \t\t\t\tvar parentNode = this.parent.findParentNode();\n  \t\t\t\tvar anchor = this.parent.findNextNode(this.owner);\n\n  \t\t\t\tparentNode.insertBefore(docFrag, anchor);\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tRepeatedFragment.prototype.updatePostShuffle = function updatePostShuffle() {\n  \t\tvar _this5 = this;\n\n  \t\tvar newIndices = this.pendingNewIndices[0];\n\n  \t\t// map first shuffle through\n  \t\tthis.pendingNewIndices.slice(1).forEach(function (indices) {\n  \t\t\tnewIndices.forEach(function (newIndex, oldIndex) {\n  \t\t\t\tnewIndices[oldIndex] = indices[newIndex];\n  \t\t\t});\n  \t\t});\n\n  \t\t// This algorithm (for detaching incorrectly-ordered fragments from the DOM and\n  \t\t// storing them in a document fragment for later reinsertion) seems a bit hokey,\n  \t\t// but it seems to work for now\n  \t\tvar previousNewIndex = -1;\n  \t\tvar reinsertFrom = null;\n\n  \t\tnewIndices.forEach(function (newIndex, oldIndex) {\n  \t\t\tvar fragment = _this5.previousIterations[oldIndex];\n\n  \t\t\tif (newIndex === -1) {\n  \t\t\t\tfragment.unbind().unrender(true);\n  \t\t\t} else {\n  \t\t\t\tfragment.index = newIndex;\n  \t\t\t\tvar model = _this5.context.joinKey(newIndex);\n  \t\t\t\tif (_this5.owner.template.z) {\n  \t\t\t\t\tfragment.aliases = defineProperty({}, _this5.owner.template.z[0].n, model);\n  \t\t\t\t}\n  \t\t\t\tfragment.rebind(model);\n\n  \t\t\t\tif (reinsertFrom === null && newIndex !== previousNewIndex + 1) {\n  \t\t\t\t\treinsertFrom = oldIndex;\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\tpreviousNewIndex = newIndex;\n  \t\t});\n\n  \t\t// create new iterations\n  \t\tvar docFrag = this.rendered ? createDocumentFragment() : null;\n  \t\tvar parentNode = this.rendered ? this.parent.findParentNode() : null;\n\n  \t\tvar len = this.context.get().length;\n  \t\tvar i = undefined;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tvar existingFragment = this.iterations[i];\n\n  \t\t\tif (this.rendered) {\n  \t\t\t\tif (existingFragment) {\n  \t\t\t\t\tif (reinsertFrom !== null && i >= reinsertFrom) {\n  \t\t\t\t\t\tdocFrag.appendChild(existingFragment.detach());\n  \t\t\t\t\t} else if (docFrag.childNodes.length) {\n  \t\t\t\t\t\tparentNode.insertBefore(docFrag, existingFragment.firstNode());\n  \t\t\t\t\t}\n  \t\t\t\t} else {\n  \t\t\t\t\tthis.iterations[i] = this.createIteration(i, i);\n  \t\t\t\t\tthis.iterations[i].render(docFrag);\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\tif (!this.rendered) {\n  \t\t\t\tif (!existingFragment) {\n  \t\t\t\t\tthis.iterations[i] = this.createIteration(i, i);\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\tif (this.rendered && docFrag.childNodes.length) {\n  \t\t\tparentNode.insertBefore(docFrag, this.owner.findNextNode());\n  \t\t}\n\n  \t\tthis.iterations.forEach(_update);\n\n  \t\tthis.pendingNewIndices = null;\n  \t};\n\n  \treturn RepeatedFragment;\n  })();\n\n  function isEmpty(value) {\n  \treturn !value || isArray(value) && value.length === 0 || isObject(value) && Object.keys(value).length === 0;\n  }\n\n  function getType(value, hasIndexRef) {\n  \tif (hasIndexRef || isArray(value)) return SECTION_EACH;\n  \tif (isObject(value) || typeof value === 'function') return SECTION_WITH;\n  \tif (value === undefined) return null;\n  \treturn SECTION_IF;\n  }\n\n  var Section = (function (_Mustache) {\n  \tinherits(Section, _Mustache);\n\n  \tfunction Section(options) {\n  \t\tclassCallCheck(this, Section);\n\n  \t\t_Mustache.call(this, options);\n\n  \t\tthis.sectionType = options.template.n || null;\n  \t\tthis.templateSectionType = this.sectionType;\n  \t\tthis.fragment = null;\n  \t}\n\n  \tSection.prototype.bind = function bind() {\n  \t\t_Mustache.prototype.bind.call(this);\n\n  \t\t// if we managed to bind, we need to create children\n  \t\tif (this.model) {\n  \t\t\tthis.dirty = true;\n  \t\t\tthis.update();\n  \t\t} else if (this.sectionType && this.sectionType === SECTION_UNLESS) {\n  \t\t\tthis.fragment = new Fragment({\n  \t\t\t\towner: this,\n  \t\t\t\ttemplate: this.template.f\n  \t\t\t}).bind();\n  \t\t}\n  \t};\n\n  \tSection.prototype.detach = function detach() {\n  \t\treturn this.fragment ? this.fragment.detach() : createDocumentFragment();\n  \t};\n\n  \tSection.prototype.find = function find(selector) {\n  \t\tif (this.fragment) {\n  \t\t\treturn this.fragment.find(selector);\n  \t\t}\n  \t};\n\n  \tSection.prototype.findAll = function findAll(selector, query) {\n  \t\tif (this.fragment) {\n  \t\t\tthis.fragment.findAll(selector, query);\n  \t\t}\n  \t};\n\n  \tSection.prototype.findComponent = function findComponent(name) {\n  \t\tif (this.fragment) {\n  \t\t\treturn this.fragment.findComponent(name);\n  \t\t}\n  \t};\n\n  \tSection.prototype.findAllComponents = function findAllComponents(name, query) {\n  \t\tif (this.fragment) {\n  \t\t\tthis.fragment.findAllComponents(name, query);\n  \t\t}\n  \t};\n\n  \tSection.prototype.firstNode = function firstNode() {\n  \t\treturn this.fragment && this.fragment.firstNode();\n  \t};\n\n  \tSection.prototype.rebind = function rebind() {\n  \t\t_Mustache.prototype.rebind.call(this);\n\n  \t\tif (this.fragment) {\n  \t\t\tthis.fragment.rebind(this.sectionType === SECTION_IF ? null : this.model);\n  \t\t}\n  \t};\n\n  \tSection.prototype.render = function render(target, occupants) {\n  \t\tthis.rendered = true;\n  \t\tif (this.fragment) this.fragment.render(target, occupants);\n  \t};\n\n  \tSection.prototype.shuffle = function shuffle(newIndices) {\n  \t\tif (this.fragment && this.sectionType === SECTION_EACH) {\n  \t\t\tthis.fragment.shuffle(newIndices);\n  \t\t}\n  \t};\n\n  \tSection.prototype.toString = function toString(escape) {\n  \t\treturn this.fragment ? this.fragment.toString(escape) : '';\n  \t};\n\n  \tSection.prototype.unbind = function unbind() {\n  \t\t_Mustache.prototype.unbind.call(this);\n  \t\tif (this.fragment) this.fragment.unbind();\n  \t};\n\n  \tSection.prototype.unrender = function unrender(shouldDestroy) {\n  \t\tif (this.rendered && this.fragment) this.fragment.unrender(shouldDestroy);\n  \t\tthis.rendered = false;\n  \t};\n\n  \tSection.prototype.update = function update() {\n  \t\tif (!this.dirty) return;\n  \t\tif (!this.model && this.sectionType !== SECTION_UNLESS) return;\n\n  \t\tvar value = !this.model ? undefined : this.model.isRoot ? this.model.value : this.model.get();\n  \t\tvar lastType = this.sectionType;\n\n  \t\t// watch for switching section types\n  \t\tif (this.sectionType === null || this.templateSectionType === null) this.sectionType = getType(value, this.template.i);\n  \t\tif (lastType && lastType !== this.sectionType && this.fragment) {\n  \t\t\tif (this.rendered) {\n  \t\t\t\tthis.fragment.unbind().unrender(true);\n  \t\t\t}\n\n  \t\t\tthis.fragment = null;\n  \t\t}\n\n  \t\tvar newFragment = undefined;\n\n  \t\tif (this.sectionType === SECTION_EACH) {\n  \t\t\tif (this.fragment) {\n  \t\t\t\tthis.fragment.update();\n  \t\t\t} else {\n  \t\t\t\t// TODO can this happen?\n  \t\t\t\tnewFragment = new RepeatedFragment({\n  \t\t\t\t\towner: this,\n  \t\t\t\t\ttemplate: this.template.f,\n  \t\t\t\t\tindexRef: this.template.i\n  \t\t\t\t}).bind(this.model);\n  \t\t\t}\n  \t\t}\n\n  \t\t// TODO same comment as before - WITH should be IF_WITH\n  \t\telse if (this.sectionType === SECTION_WITH) {\n  \t\t\t\tif (this.fragment) {\n  \t\t\t\t\tthis.fragment.update();\n  \t\t\t\t} else {\n  \t\t\t\t\tnewFragment = new Fragment({\n  \t\t\t\t\t\towner: this,\n  \t\t\t\t\t\ttemplate: this.template.f\n  \t\t\t\t\t}).bind(this.model);\n  \t\t\t\t}\n  \t\t\t} else if (this.sectionType === SECTION_IF_WITH) {\n  \t\t\t\tif (this.fragment) {\n  \t\t\t\t\tif (isEmpty(value)) {\n  \t\t\t\t\t\tif (this.rendered) {\n  \t\t\t\t\t\t\tthis.fragment.unbind().unrender(true);\n  \t\t\t\t\t\t}\n\n  \t\t\t\t\t\tthis.fragment = null;\n  \t\t\t\t\t} else {\n  \t\t\t\t\t\tthis.fragment.update();\n  \t\t\t\t\t}\n  \t\t\t\t} else if (!isEmpty(value)) {\n  \t\t\t\t\tnewFragment = new Fragment({\n  \t\t\t\t\t\towner: this,\n  \t\t\t\t\t\ttemplate: this.template.f\n  \t\t\t\t\t}).bind(this.model);\n  \t\t\t\t}\n  \t\t\t} else {\n  \t\t\t\tvar fragmentShouldExist = this.sectionType === SECTION_UNLESS ? isEmpty(value) : !!value;\n\n  \t\t\t\tif (this.fragment) {\n  \t\t\t\t\tif (fragmentShouldExist) {\n  \t\t\t\t\t\tthis.fragment.update();\n  \t\t\t\t\t} else {\n  \t\t\t\t\t\tif (this.rendered) {\n  \t\t\t\t\t\t\tthis.fragment.unbind().unrender(true);\n  \t\t\t\t\t\t}\n\n  \t\t\t\t\t\tthis.fragment = null;\n  \t\t\t\t\t}\n  \t\t\t\t} else if (fragmentShouldExist) {\n  \t\t\t\t\tnewFragment = new Fragment({\n  \t\t\t\t\t\towner: this,\n  \t\t\t\t\t\ttemplate: this.template.f\n  \t\t\t\t\t}).bind(null);\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\tif (newFragment) {\n  \t\t\tif (this.rendered) {\n  \t\t\t\tvar parentNode = this.parentFragment.findParentNode();\n  \t\t\t\tvar anchor = this.parentFragment.findNextNode(this);\n\n  \t\t\t\tif (anchor) {\n  \t\t\t\t\tvar docFrag = createDocumentFragment();\n  \t\t\t\t\tnewFragment.render(docFrag);\n\n  \t\t\t\t\t// we use anchor.parentNode, not parentNode, because the sibling\n  \t\t\t\t\t// may be temporarily detached as a result of a shuffle\n  \t\t\t\t\tanchor.parentNode.insertBefore(docFrag, anchor);\n  \t\t\t\t} else {\n  \t\t\t\t\tnewFragment.render(parentNode);\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\tthis.fragment = newFragment;\n  \t\t}\n\n  \t\tthis.dirty = false;\n  \t};\n\n  \treturn Section;\n  })(Mustache);\n\n  var elementCache = {};\n\n  var ieBug = undefined;\n  var ieBlacklist = undefined;\n\n  try {\n  \tcreateElement('table').innerHTML = 'foo';\n  } catch (err) {\n  \tieBug = true;\n\n  \tieBlacklist = {\n  \t\tTABLE: ['<table class=\"x\">', '</table>'],\n  \t\tTHEAD: ['<table><thead class=\"x\">', '</thead></table>'],\n  \t\tTBODY: ['<table><tbody class=\"x\">', '</tbody></table>'],\n  \t\tTR: ['<table><tr class=\"x\">', '</tr></table>'],\n  \t\tSELECT: ['<select class=\"x\">', '</select>']\n  \t};\n  }\n\n  function insertHtml (html, node, docFrag) {\n  \tvar nodes = [];\n\n  \t// render 0 and false\n  \tif (html == null || html === '') return nodes;\n\n  \tvar container = undefined;\n  \tvar wrapper = undefined;\n  \tvar selectedOption = undefined;\n\n  \tif (ieBug && (wrapper = ieBlacklist[node.tagName])) {\n  \t\tcontainer = element$1('DIV');\n  \t\tcontainer.innerHTML = wrapper[0] + html + wrapper[1];\n  \t\tcontainer = container.querySelector('.x');\n\n  \t\tif (container.tagName === 'SELECT') {\n  \t\t\tselectedOption = container.options[container.selectedIndex];\n  \t\t}\n  \t} else if (node.namespaceURI === svg$1) {\n  \t\tcontainer = element$1('DIV');\n  \t\tcontainer.innerHTML = '<svg class=\"x\">' + html + '</svg>';\n  \t\tcontainer = container.querySelector('.x');\n  \t} else {\n  \t\tcontainer = element$1(node.tagName);\n  \t\tcontainer.innerHTML = html;\n\n  \t\tif (container.tagName === 'SELECT') {\n  \t\t\tselectedOption = container.options[container.selectedIndex];\n  \t\t}\n  \t}\n\n  \tvar child = undefined;\n  \twhile (child = container.firstChild) {\n  \t\tnodes.push(child);\n  \t\tdocFrag.appendChild(child);\n  \t}\n\n  \t// This is really annoying. Extracting <option> nodes from the\n  \t// temporary container <select> causes the remaining ones to\n  \t// become selected. So now we have to deselect them. IE8, you\n  \t// amaze me. You really do\n  \t// ...and now Chrome too\n  \tvar i = undefined;\n  \tif (node.tagName === 'SELECT') {\n  \t\ti = nodes.length;\n  \t\twhile (i--) {\n  \t\t\tif (nodes[i] !== selectedOption) {\n  \t\t\t\tnodes[i].selected = false;\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \treturn nodes;\n  }\n\n  function element$1(tagName) {\n  \treturn elementCache[tagName] || (elementCache[tagName] = createElement(tagName));\n  }\n\n  var Triple = (function (_Mustache) {\n  \tinherits(Triple, _Mustache);\n\n  \tfunction Triple(options) {\n  \t\tclassCallCheck(this, Triple);\n\n  \t\t_Mustache.call(this, options);\n  \t}\n\n  \tTriple.prototype.detach = function detach() {\n  \t\tvar docFrag = createDocumentFragment();\n  \t\tthis.nodes.forEach(function (node) {\n  \t\t\treturn docFrag.appendChild(node);\n  \t\t});\n  \t\treturn docFrag;\n  \t};\n\n  \tTriple.prototype.find = function find(selector) {\n  \t\tvar len = this.nodes.length;\n  \t\tvar i = undefined;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tvar node = this.nodes[i];\n\n  \t\t\tif (node.nodeType !== 1) continue;\n\n  \t\t\tif (matches(node, selector)) return node;\n\n  \t\t\tvar queryResult = node.querySelector(selector);\n  \t\t\tif (queryResult) return queryResult;\n  \t\t}\n\n  \t\treturn null;\n  \t};\n\n  \tTriple.prototype.findAll = function findAll(selector, query) {\n  \t\tvar len = this.nodes.length;\n  \t\tvar i = undefined;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tvar node = this.nodes[i];\n\n  \t\t\tif (node.nodeType !== 1) continue;\n\n  \t\t\tif (query.test(node)) query.add(node);\n\n  \t\t\tvar queryAllResult = node.querySelectorAll(selector);\n  \t\t\tif (queryAllResult) {\n  \t\t\t\tvar numNodes = queryAllResult.length;\n  \t\t\t\tvar j = undefined;\n\n  \t\t\t\tfor (j = 0; j < numNodes; j += 1) {\n  \t\t\t\t\tquery.add(queryAllResult[j]);\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tTriple.prototype.findComponent = function findComponent() {\n  \t\treturn null;\n  \t};\n\n  \tTriple.prototype.firstNode = function firstNode() {\n  \t\treturn this.nodes[0];\n  \t};\n\n  \tTriple.prototype.render = function render(target) {\n  \t\tvar html = this.model ? this.model.get() : '';\n  \t\tthis.nodes = insertHtml(html, this.parentFragment.findParentNode(), target);\n  \t\tthis.rendered = true;\n  \t};\n\n  \tTriple.prototype.toString = function toString() {\n  \t\treturn this.model && this.model.get() != null ? decodeCharacterReferences('' + this.model.get()) : '';\n  \t};\n\n  \tTriple.prototype.unrender = function unrender() {\n  \t\tif (this.nodes) this.nodes.forEach(function (node) {\n  \t\t\treturn detachNode(node);\n  \t\t});\n  \t\tthis.rendered = false;\n  \t};\n\n  \tTriple.prototype.update = function update() {\n  \t\tif (this.rendered && this.dirty) {\n  \t\t\tthis.unrender();\n  \t\t\tvar docFrag = createDocumentFragment();\n  \t\t\tthis.render(docFrag);\n\n  \t\t\tvar parentNode = this.parentFragment.findParentNode();\n  \t\t\tvar anchor = this.parentFragment.findNextNode(this);\n\n  \t\t\tparentNode.insertBefore(docFrag, anchor);\n\n  \t\t\tthis.dirty = false;\n  \t\t}\n  \t};\n\n  \treturn Triple;\n  })(Mustache);\n\n  var Yielder = (function (_Item) {\n  \tinherits(Yielder, _Item);\n\n  \tfunction Yielder(options) {\n  \t\tclassCallCheck(this, Yielder);\n\n  \t\t_Item.call(this, options);\n\n  \t\tthis.container = options.parentFragment.ractive;\n  \t\tthis.component = this.container.component;\n\n  \t\tthis.containerFragment = options.parentFragment;\n  \t\tthis.parentFragment = this.component.parentFragment;\n\n  \t\t// {{yield}} is equivalent to {{yield content}}\n  \t\tthis.name = options.template.n || '';\n  \t}\n\n  \tYielder.prototype.bind = function bind() {\n  \t\tvar name = this.name;\n\n  \t\t(this.component.yielders[name] || (this.component.yielders[name] = [])).push(this);\n\n  \t\t// TODO don't parse here\n  \t\tvar template = this.container._inlinePartials[name || 'content'];\n\n  \t\tif (typeof template === 'string') {\n  \t\t\ttemplate = parse(template).t;\n  \t\t}\n\n  \t\tif (!template) {\n  \t\t\twarnIfDebug('Could not find template for partial \"' + name + '\"', { ractive: this.ractive });\n  \t\t\ttemplate = [];\n  \t\t}\n\n  \t\tthis.fragment = new Fragment({\n  \t\t\towner: this,\n  \t\t\tractive: this.container.parent,\n  \t\t\ttemplate: template\n  \t\t}).bind();\n  \t};\n\n  \tYielder.prototype.detach = function detach() {\n  \t\treturn this.fragment.detach();\n  \t};\n\n  \tYielder.prototype.find = function find(selector) {\n  \t\treturn this.fragment.find(selector);\n  \t};\n\n  \tYielder.prototype.findAll = function findAll(selector, queryResult) {\n  \t\tthis.fragment.find(selector, queryResult);\n  \t};\n\n  \tYielder.prototype.findComponent = function findComponent(name) {\n  \t\treturn this.fragment.findComponent(name);\n  \t};\n\n  \tYielder.prototype.findAllComponents = function findAllComponents(name, queryResult) {\n  \t\tthis.fragment.findAllComponents(name, queryResult);\n  \t};\n\n  \tYielder.prototype.firstNode = function firstNode() {\n  \t\treturn this.fragment.firstNode();\n  \t};\n\n  \tYielder.prototype.rebind = function rebind() {\n  \t\tthis.fragment.rebind();\n  \t};\n\n  \tYielder.prototype.render = function render(target, occupants) {\n  \t\treturn this.fragment.render(target, occupants);\n  \t};\n\n  \tYielder.prototype.setTemplate = function setTemplate(name) {\n  \t\tvar template = this.parentFragment.ractive.partials[name];\n\n  \t\tif (typeof template === 'string') {\n  \t\t\ttemplate = parse(template).t;\n  \t\t}\n\n  \t\tthis.partialTemplate = template || []; // TODO warn on missing partial\n  \t};\n\n  \tYielder.prototype.toString = function toString(escape) {\n  \t\treturn this.fragment.toString(escape);\n  \t};\n\n  \tYielder.prototype.unbind = function unbind() {\n  \t\tthis.fragment.unbind();\n  \t\tremoveFromArray(this.component.yielders[this.name], this);\n  \t};\n\n  \tYielder.prototype.unrender = function unrender(shouldDestroy) {\n  \t\tthis.fragment.unrender(shouldDestroy);\n  \t};\n\n  \tYielder.prototype.update = function update() {\n  \t\tthis.fragment.update();\n  \t};\n\n  \treturn Yielder;\n  })(Item);\n\n  function determineNameAndNamespace (attribute, name) {\n  \t// are we dealing with a namespaced attribute, e.g. xlink:href?\n  \tvar colonIndex = name.indexOf(':');\n  \tif (colonIndex !== -1) {\n  \t\t// looks like we are, yes...\n  \t\tvar namespacePrefix = name.substr(0, colonIndex);\n\n  \t\t// ...unless it's a namespace *declaration*, which we ignore (on the assumption\n  \t\t// that only valid namespaces will be used)\n  \t\tif (namespacePrefix !== 'xmlns') {\n  \t\t\tname = name.substring(colonIndex + 1);\n\n  \t\t\tattribute.name = name;\n  \t\t\tattribute.namespace = namespaces[namespacePrefix.toLowerCase()];\n  \t\t\tattribute.namespacePrefix = namespacePrefix;\n\n  \t\t\tif (!attribute.namespace) {\n  \t\t\t\tthrow 'Unknown namespace (\"' + namespacePrefix + '\")';\n  \t\t\t}\n\n  \t\t\treturn;\n  \t\t}\n  \t}\n\n  \tattribute.name = name;\n  }\n\n  function getUpdateDelegate(attribute) {\n  \tvar element = attribute.element;\n  \tvar name = attribute.name;\n\n  \tif (name === 'id') return updateId;\n\n  \tif (name === 'value') {\n  \t\t// special case - selects\n  \t\tif (element.name === 'select' && name === 'value') {\n  \t\t\treturn element.getAttribute('multiple') ? updateMultipleSelectValue : updateSelectValue;\n  \t\t}\n\n  \t\tif (element.name === 'textarea') return updateValue;\n\n  \t\t// special case - contenteditable\n  \t\tif (element.getAttribute('contenteditable') != null) return updateContentEditableValue;\n\n  \t\t// special case - <input>\n  \t\tif (element.name === 'input') {\n  \t\t\tvar type = element.getAttribute('type');\n\n  \t\t\t// type='file' value='{{fileList}}'>\n  \t\t\tif (type === 'file') return noop; // read-only\n\n  \t\t\t// type='radio' name='{{twoway}}'\n  \t\t\tif (type === 'radio' && element.binding && element.binding.attribute.name === 'name') return updateRadioValue;\n  \t\t}\n\n  \t\treturn updateValue;\n  \t}\n\n  \tvar node = element.node;\n\n  \t// special case - <input type='radio' name='{{twoway}}' value='foo'>\n  \tif (attribute.isTwoway && name === 'name') {\n  \t\tif (node.type === 'radio') return updateRadioName;\n  \t\tif (node.type === 'checkbox') return updateCheckboxName;\n  \t}\n\n  \t// special case - style attributes in Internet Exploder\n  \tif (name === 'style' && node.style.setAttribute) return updateIEStyleAttribute;\n\n  \t// special case - class names. IE fucks things up, again\n  \tif (name === 'class' && (!node.namespaceURI || node.namespaceURI === html)) return updateClassName;\n\n  \tif (attribute.isBoolean) return updateBoolean;\n\n  \tif (attribute.namespace) return updateNamespacedAttribute;\n\n  \treturn updateAttribute;\n  }\n\n  function updateId() {\n  \tvar node = this.node;\n\n  \tvar value = this.getValue();\n\n  \tdelete this.ractive.nodes[node.id];\n  \tthis.ractive.nodes[value] = node;\n\n  \tnode.id = value;\n  }\n\n  function updateMultipleSelectValue() {\n  \tvar value = this.getValue();\n\n  \tif (!isArray(value)) value = [value];\n\n  \tvar options = this.node.options;\n  \tvar i = options.length;\n\n  \twhile (i--) {\n  \t\tvar option = options[i];\n  \t\tvar optionValue = option._ractive ? option._ractive.value : option.value; // options inserted via a triple don't have _ractive\n\n  \t\toption.selected = arrayContains(value, optionValue);\n  \t}\n  }\n\n  function updateSelectValue() {\n  \tvar value = this.getValue();\n\n  \tif (!this.locked) {\n  \t\t// TODO is locked still a thing?\n  \t\tthis.node._ractive.value = value;\n\n  \t\tvar options = this.node.options;\n  \t\tvar i = options.length;\n\n  \t\twhile (i--) {\n  \t\t\tvar option = options[i];\n  \t\t\tvar optionValue = option._ractive ? option._ractive.value : option.value; // options inserted via a triple don't have _ractive\n\n  \t\t\tif (optionValue == value) {\n  \t\t\t\t// double equals as we may be comparing numbers with strings\n  \t\t\t\toption.selected = true;\n  \t\t\t\tbreak;\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \t// if we're still here, it means the new value didn't match any of the options...\n  \t// TODO figure out what to do in this situation\n  }\n\n  function updateContentEditableValue() {\n  \tvar value = this.getValue();\n\n  \tif (!this.locked) {\n  \t\tthis.node.innerHTML = value === undefined ? '' : value;\n  \t}\n  }\n\n  function updateRadioValue() {\n  \tvar node = this.node;\n  \tvar wasChecked = node.checked;\n\n  \tvar value = this.getValue();\n\n  \t//node.value = this.element.getAttribute( 'value' );\n  \tnode.value = this.node._ractive.value = value;\n  \tnode.checked = value === this.element.getAttribute('name');\n\n  \t// This is a special case - if the input was checked, and the value\n  \t// changed so that it's no longer checked, the twoway binding is\n  \t// most likely out of date. To fix it we have to jump through some\n  \t// hoops... this is a little kludgy but it works\n  \tif (wasChecked && !node.checked && this.element.binding && this.element.binding.rendered) {\n  \t\tthis.element.binding.group.model.set(this.element.binding.group.getValue());\n  \t}\n  }\n\n  function updateValue() {\n  \tif (!this.locked) {\n  \t\tvar value = this.getValue();\n\n  \t\tthis.node.value = this.node._ractive.value = value;\n  \t\tthis.node.setAttribute('value', value);\n  \t}\n  }\n\n  function updateRadioName() {\n  \tthis.node.checked = this.getValue() == this.node._ractive.value;\n  }\n\n  function updateCheckboxName() {\n  \tvar element = this.element;\n  \tvar node = this.node;\n\n  \tvar binding = element.binding;\n\n  \tvar value = this.getValue();\n  \tvar valueAttribute = element.getAttribute('value');\n\n  \tif (!isArray(value)) {\n  \t\tbinding.isChecked = node.checked = value == valueAttribute;\n  \t} else {\n  \t\tvar i = value.length;\n  \t\twhile (i--) {\n  \t\t\tif (valueAttribute == value[i]) {\n  \t\t\t\tbinding.isChecked = node.checked = true;\n  \t\t\t\treturn;\n  \t\t\t}\n  \t\t}\n  \t\tbinding.isChecked = node.checked = false;\n  \t}\n  }\n\n  function updateIEStyleAttribute() {\n  \tthis.node.style.setAttribute('cssText', this.getValue() || '');\n  }\n\n  function updateClassName() {\n  \tthis.node.className = safeToStringValue(this.getValue());\n  }\n\n  function updateBoolean() {\n  \t// with two-way binding, only update if the change wasn't initiated by the user\n  \t// otherwise the cursor will often be sent to the wrong place\n  \tif (!this.locked) {\n  \t\tif (this.useProperty) {\n  \t\t\tthis.node[this.propertyName] = this.getValue();\n  \t\t} else {\n  \t\t\tif (this.getValue()) {\n  \t\t\t\tthis.node.setAttribute(this.propertyName, '');\n  \t\t\t} else {\n  \t\t\t\tthis.node.removeAttribute(this.propertyName);\n  \t\t\t}\n  \t\t}\n  \t}\n  }\n\n  function updateAttribute() {\n  \tthis.node.setAttribute(this.name, safeToStringValue(this.getString()));\n  }\n\n  function updateNamespacedAttribute() {\n  \tthis.node.setAttributeNS(this.namespace, this.name, safeToStringValue(this.getString()));\n  }\n\n  var propertyNames = {\n  \t'accept-charset': 'acceptCharset',\n  \taccesskey: 'accessKey',\n  \tbgcolor: 'bgColor',\n  \t'class': 'className',\n  \tcodebase: 'codeBase',\n  \tcolspan: 'colSpan',\n  \tcontenteditable: 'contentEditable',\n  \tdatetime: 'dateTime',\n  \tdirname: 'dirName',\n  \t'for': 'htmlFor',\n  \t'http-equiv': 'httpEquiv',\n  \tismap: 'isMap',\n  \tmaxlength: 'maxLength',\n  \tnovalidate: 'noValidate',\n  \tpubdate: 'pubDate',\n  \treadonly: 'readOnly',\n  \trowspan: 'rowSpan',\n  \ttabindex: 'tabIndex',\n  \tusemap: 'useMap'\n  };\n\n  var Attribute = (function (_Item) {\n  \tinherits(Attribute, _Item);\n\n  \tfunction Attribute(options) {\n  \t\tclassCallCheck(this, Attribute);\n\n  \t\t_Item.call(this, options);\n\n  \t\tdetermineNameAndNamespace(this, options.name);\n\n  \t\tthis.element = options.element;\n  \t\tthis.parentFragment = options.element.parentFragment; // shared\n  \t\tthis.ractive = this.parentFragment.ractive;\n\n  \t\tthis.rendered = false;\n  \t\tthis.updateDelegate = null;\n  \t\tthis.fragment = null;\n  \t\tthis.value = null;\n\n  \t\tif (!isArray(options.template)) {\n  \t\t\tthis.value = options.template;\n  \t\t\tif (this.value === 0) {\n  \t\t\t\tthis.value = '';\n  \t\t\t}\n  \t\t} else {\n  \t\t\tthis.fragment = new Fragment({\n  \t\t\t\towner: this,\n  \t\t\t\ttemplate: options.template\n  \t\t\t});\n  \t\t}\n\n  \t\tthis.interpolator = this.fragment && this.fragment.items.length === 1 && this.fragment.items[0].type === INTERPOLATOR && this.fragment.items[0];\n  \t}\n\n  \tAttribute.prototype.bind = function bind() {\n  \t\tif (this.fragment) {\n  \t\t\tthis.fragment.bind();\n  \t\t}\n  \t};\n\n  \tAttribute.prototype.bubble = function bubble() {\n  \t\tif (!this.dirty) {\n  \t\t\tthis.element.bubble();\n  \t\t\tthis.dirty = true;\n  \t\t}\n  \t};\n\n  \tAttribute.prototype.getString = function getString() {\n  \t\treturn this.fragment ? this.fragment.toString() : this.value != null ? '' + this.value : '';\n  \t};\n\n  \t// TODO could getValue ever be called for a static attribute,\n  \t// or can we assume that this.fragment exists?\n\n  \tAttribute.prototype.getValue = function getValue() {\n  \t\treturn this.fragment ? this.fragment.valueOf() : booleanAttributes.test(this.name) ? true : this.value;\n  \t};\n\n  \tAttribute.prototype.rebind = function rebind() {\n  \t\tthis.unbind();\n  \t\tthis.bind();\n  \t};\n\n  \tAttribute.prototype.render = function render() {\n  \t\tvar node = this.element.node;\n  \t\tthis.node = node;\n\n  \t\t// should we use direct property access, or setAttribute?\n  \t\tif (!node.namespaceURI || node.namespaceURI === html) {\n  \t\t\tthis.propertyName = propertyNames[this.name] || this.name;\n\n  \t\t\tif (node[this.propertyName] !== undefined) {\n  \t\t\t\tthis.useProperty = true;\n  \t\t\t}\n\n  \t\t\t// is attribute a boolean attribute or 'value'? If so we're better off doing e.g.\n  \t\t\t// node.selected = true rather than node.setAttribute( 'selected', '' )\n  \t\t\tif (booleanAttributes.test(this.name) || this.isTwoway) {\n  \t\t\t\tthis.isBoolean = true;\n  \t\t\t}\n\n  \t\t\tif (this.propertyName === 'value') {\n  \t\t\t\tnode._ractive.value = this.value;\n  \t\t\t}\n  \t\t}\n\n  \t\tthis.rendered = true;\n  \t\tthis.updateDelegate = getUpdateDelegate(this);\n  \t\tthis.updateDelegate();\n  \t};\n\n  \tAttribute.prototype.toString = function toString() {\n  \t\tvar value = this.getValue();\n\n  \t\t// Special case - select and textarea values (should not be stringified)\n  \t\tif (this.name === 'value' && (this.element.getAttribute('contenteditable') !== undefined || this.element.name === 'select' || this.element.name === 'textarea')) {\n  \t\t\treturn;\n  \t\t}\n\n  \t\t// Special case  bound radio `name` attributes\n  \t\tif (this.name === 'name' && this.element.name === 'input' && this.interpolator && this.element.getAttribute('type') === 'radio') {\n  \t\t\treturn 'name=\"{{' + this.interpolator.model.getKeypath() + '}}\"';\n  \t\t}\n\n  \t\tif (booleanAttributes.test(this.name)) return value ? this.name : '';\n  \t\tif (value == null) return '';\n\n  \t\tvar str = safeToStringValue(this.getString()).replace(/&/g, '&amp;').replace(/\"/g, '&quot;').replace(/'/g, '&#39;');\n\n  \t\treturn str ? this.name + '=\"' + str + '\"' : this.name;\n  \t};\n\n  \tAttribute.prototype.unbind = function unbind() {\n  \t\tif (this.fragment) this.fragment.unbind();\n  \t};\n\n  \tAttribute.prototype.update = function update() {\n  \t\tif (this.dirty) {\n  \t\t\tif (this.fragment) this.fragment.update();\n  \t\t\tif (this.rendered) this.updateDelegate();\n  \t\t\tthis.dirty = false;\n  \t\t}\n  \t};\n\n  \treturn Attribute;\n  })(Item);\n\n  var div$1 = doc ? createElement('div') : null;\n\n  var ConditionalAttribute = (function (_Item) {\n  \tinherits(ConditionalAttribute, _Item);\n\n  \tfunction ConditionalAttribute(options) {\n  \t\tclassCallCheck(this, ConditionalAttribute);\n\n  \t\t_Item.call(this, options);\n\n  \t\tthis.attributes = [];\n\n  \t\tthis.owner = options.owner;\n\n  \t\tthis.fragment = new Fragment({\n  \t\t\tractive: this.ractive,\n  \t\t\towner: this,\n  \t\t\ttemplate: [this.template]\n  \t\t});\n\n  \t\tthis.dirty = false;\n  \t}\n\n  \tConditionalAttribute.prototype.bind = function bind() {\n  \t\tthis.fragment.bind();\n  \t};\n\n  \tConditionalAttribute.prototype.bubble = function bubble() {\n  \t\tif (!this.dirty) {\n  \t\t\tthis.dirty = true;\n  \t\t\tthis.owner.bubble();\n  \t\t}\n  \t};\n\n  \tConditionalAttribute.prototype.rebind = function rebind() {\n  \t\tthis.fragment.rebind();\n  \t};\n\n  \tConditionalAttribute.prototype.render = function render() {\n  \t\tthis.node = this.owner.node;\n  \t\tthis.isSvg = this.node.namespaceURI === svg$1;\n\n  \t\tthis.rendered = true;\n  \t\tthis.dirty = true; // TODO this seems hacky, but necessary for tests to pass in browser AND node.js\n  \t\tthis.update();\n  \t};\n\n  \tConditionalAttribute.prototype.toString = function toString() {\n  \t\treturn this.fragment.toString();\n  \t};\n\n  \tConditionalAttribute.prototype.unbind = function unbind() {\n  \t\tthis.fragment.unbind();\n  \t};\n\n  \tConditionalAttribute.prototype.unrender = function unrender() {\n  \t\tthis.rendered = false;\n  \t};\n\n  \tConditionalAttribute.prototype.update = function update() {\n  \t\tvar _this = this;\n\n  \t\tvar str = undefined;\n  \t\tvar attrs = undefined;\n\n  \t\tif (this.dirty) {\n  \t\t\tthis.fragment.update();\n\n  \t\t\tif (this.rendered) {\n  \t\t\t\tstr = this.fragment.toString();\n  \t\t\t\tattrs = parseAttributes(str, this.isSvg);\n\n  \t\t\t\t// any attributes that previously existed but no longer do\n  \t\t\t\t// must be removed\n  \t\t\t\tthis.attributes.filter(function (a) {\n  \t\t\t\t\treturn notIn(attrs, a);\n  \t\t\t\t}).forEach(function (a) {\n  \t\t\t\t\t_this.node.removeAttribute(a.name);\n  \t\t\t\t});\n\n  \t\t\t\tattrs.forEach(function (a) {\n  \t\t\t\t\t_this.node.setAttribute(a.name, a.value);\n  \t\t\t\t});\n\n  \t\t\t\tthis.attributes = attrs;\n  \t\t\t}\n\n  \t\t\tthis.dirty = false;\n  \t\t}\n  \t};\n\n  \treturn ConditionalAttribute;\n  })(Item);\n\n  function parseAttributes(str, isSvg) {\n  \tvar tagName = isSvg ? 'svg' : 'div';\n  \tdiv$1.innerHTML = '<' + tagName + ' ' + str + '></' + tagName + '>';\n\n  \treturn toArray(div$1.childNodes[0].attributes);\n  }\n\n  function notIn(haystack, needle) {\n  \tvar i = haystack.length;\n\n  \twhile (i--) {\n  \t\tif (haystack[i].name === needle.name) {\n  \t\t\treturn false;\n  \t\t}\n  \t}\n\n  \treturn true;\n  }\n\n  var missingDecorator = {\n  \tupdate: noop,\n  \tteardown: noop\n  };\n\n  var Decorator = (function () {\n  \tfunction Decorator(owner, template) {\n  \t\tclassCallCheck(this, Decorator);\n\n  \t\tthis.owner = owner;\n  \t\tthis.template = template;\n\n  \t\tthis.parentFragment = owner.parentFragment;\n  \t\tthis.ractive = owner.ractive;\n\n  \t\tthis.dynamicName = typeof template.n === 'object';\n  \t\tthis.dynamicArgs = !!template.d;\n\n  \t\tif (this.dynamicName) {\n  \t\t\tthis.nameFragment = new Fragment({\n  \t\t\t\towner: this,\n  \t\t\t\ttemplate: template.n\n  \t\t\t});\n  \t\t} else {\n  \t\t\tthis.name = template.n || template;\n  \t\t}\n\n  \t\tif (this.dynamicArgs) {\n  \t\t\tthis.argsFragment = new Fragment({\n  \t\t\t\towner: this,\n  \t\t\t\ttemplate: template.d\n  \t\t\t});\n  \t\t} else {\n  \t\t\tthis.args = template.a || [];\n  \t\t}\n\n  \t\tthis.node = null;\n  \t\tthis.intermediary = null;\n  \t}\n\n  \tDecorator.prototype.bind = function bind() {\n  \t\tif (this.dynamicName) {\n  \t\t\tthis.nameFragment.bind();\n  \t\t\tthis.name = this.nameFragment.toString();\n  \t\t}\n\n  \t\tif (this.dynamicArgs) this.argsFragment.bind();\n  \t};\n\n  \tDecorator.prototype.bubble = function bubble() {\n  \t\tif (!this.dirty) {\n  \t\t\tthis.dirty = true;\n  \t\t\tthis.owner.bubble();\n  \t\t}\n  \t};\n\n  \tDecorator.prototype.rebind = function rebind() {\n  \t\tif (this.dynamicName) this.nameFragment.rebind();\n  \t\tif (this.dynamicArgs) this.argsFragment.rebind();\n  \t};\n\n  \tDecorator.prototype.render = function render() {\n  \t\tvar fn = findInViewHierarchy('decorators', this.ractive, this.name);\n\n  \t\tif (!fn) {\n  \t\t\twarnOnce(missingPlugin(this.name, 'decorators'));\n  \t\t\tthis.intermediary = missingDecorator;\n  \t\t\treturn;\n  \t\t}\n\n  \t\tthis.node = this.owner.node;\n\n  \t\tvar args = this.dynamicArgs ? this.argsFragment.getArgsList() : this.args;\n  \t\tthis.intermediary = fn.apply(this.ractive, [this.node].concat(args));\n\n  \t\tif (!this.intermediary || !this.intermediary.teardown) {\n  \t\t\tthrow new Error('The \\'' + this.name + '\\' decorator must return an object with a teardown method');\n  \t\t}\n  \t};\n\n  \tDecorator.prototype.unbind = function unbind() {\n  \t\tif (this.dynamicName) this.nameFragment.unbind();\n  \t\tif (this.dynamicArgs) this.argsFragment.unbind();\n  \t};\n\n  \tDecorator.prototype.unrender = function unrender() {\n  \t\tif (this.intermediary) this.intermediary.teardown();\n  \t};\n\n  \tDecorator.prototype.update = function update() {\n  \t\tif (!this.dirty) return;\n\n  \t\tvar nameChanged = false;\n\n  \t\tif (this.dynamicName && this.nameFragment.dirty) {\n  \t\t\tvar _name = this.nameFragment.toString();\n  \t\t\tnameChanged = _name !== this.name;\n  \t\t\tthis.name = _name;\n  \t\t}\n\n  \t\tif (nameChanged || !this.intermediary.update) {\n  \t\t\tthis.unrender();\n  \t\t\tthis.render();\n  \t\t} else {\n  \t\t\tif (this.dynamicArgs) {\n  \t\t\t\tif (this.argsFragment.dirty) {\n  \t\t\t\t\tvar args = this.argsFragment.getArgsList();\n  \t\t\t\t\tthis.intermediary.update.apply(this.ractive, args);\n  \t\t\t\t}\n  \t\t\t} else {\n  \t\t\t\tthis.intermediary.update.apply(this.ractive, this.args);\n  \t\t\t}\n  \t\t}\n\n  \t\t// need to run these for unrender/render cases\n  \t\t// so can't just be in conditional if above\n\n  \t\tif (this.dynamicName && this.nameFragment.dirty) {\n  \t\t\tthis.nameFragment.update();\n  \t\t}\n\n  \t\tif (this.dynamicArgs && this.argsFragment.dirty) {\n  \t\t\tthis.argsFragment.update();\n  \t\t}\n\n  \t\tthis.dirty = false;\n  \t};\n\n  \treturn Decorator;\n  })();\n\n  function enqueue(ractive, event) {\n  \tif (ractive.event) {\n  \t\tractive._eventQueue.push(ractive.event);\n  \t}\n\n  \tractive.event = event;\n  }\n\n  function dequeue(ractive) {\n  \tif (ractive._eventQueue.length) {\n  \t\tractive.event = ractive._eventQueue.pop();\n  \t} else {\n  \t\tractive.event = null;\n  \t}\n  }\n\n  var starMaps = {};\n\n  // This function takes a keypath such as 'foo.bar.baz', and returns\n  // all the variants of that keypath that include a wildcard in place\n  // of a key, such as 'foo.bar.*', 'foo.*.baz', 'foo.*.*' and so on.\n  // These are then checked against the dependants map (ractive.viewmodel.depsMap)\n  // to see if any pattern observers are downstream of one or more of\n  // these wildcard keypaths (e.g. 'foo.bar.*.status')\n\n  function getPotentialWildcardMatches(keypath) {\n  \tvar keys, starMap, mapper, i, result, wildcardKeypath;\n\n  \tkeys = splitKeypath(keypath);\n  \tif (!(starMap = starMaps[keys.length])) {\n  \t\tstarMap = getStarMap(keys.length);\n  \t}\n\n  \tresult = [];\n\n  \tmapper = function (star, i) {\n  \t\treturn star ? '*' : keys[i];\n  \t};\n\n  \ti = starMap.length;\n  \twhile (i--) {\n  \t\twildcardKeypath = starMap[i].map(mapper).join('.');\n\n  \t\tif (!result.hasOwnProperty(wildcardKeypath)) {\n  \t\t\tresult.push(wildcardKeypath);\n  \t\t\tresult[wildcardKeypath] = true;\n  \t\t}\n  \t}\n\n  \treturn result;\n  }\n\n  // This function returns all the possible true/false combinations for\n  // a given number - e.g. for two, the possible combinations are\n  // [ true, true ], [ true, false ], [ false, true ], [ false, false ].\n  // It does so by getting all the binary values between 0 and e.g. 11\n  function getStarMap(num) {\n  \tvar ones = '',\n  \t    max,\n  \t    binary,\n  \t    starMap,\n  \t    mapper,\n  \t    i,\n  \t    j,\n  \t    l,\n  \t    map;\n\n  \tif (!starMaps[num]) {\n  \t\tstarMap = [];\n\n  \t\twhile (ones.length < num) {\n  \t\t\tones += 1;\n  \t\t}\n\n  \t\tmax = parseInt(ones, 2);\n\n  \t\tmapper = function (digit) {\n  \t\t\treturn digit === '1';\n  \t\t};\n\n  \t\tfor (i = 0; i <= max; i += 1) {\n  \t\t\tbinary = i.toString(2);\n  \t\t\twhile (binary.length < num) {\n  \t\t\t\tbinary = '0' + binary;\n  \t\t\t}\n\n  \t\t\tmap = [];\n  \t\t\tl = binary.length;\n  \t\t\tfor (j = 0; j < l; j++) {\n  \t\t\t\tmap.push(mapper(binary[j]));\n  \t\t\t}\n  \t\t\tstarMap[i] = map;\n  \t\t}\n\n  \t\tstarMaps[num] = starMap;\n  \t}\n\n  \treturn starMaps[num];\n  }\n\n  var wildcardCache = {};\n  function fireEvent(ractive, eventName) {\n  \tvar options = arguments.length <= 2 || arguments[2] === undefined ? {} : arguments[2];\n\n  \tif (!eventName) {\n  \t\treturn;\n  \t}\n\n  \tif (!options.event) {\n  \t\toptions.event = {\n  \t\t\tname: eventName,\n  \t\t\t// until event not included as argument default\n  \t\t\t_noArg: true\n  \t\t};\n  \t} else {\n  \t\toptions.event.name = eventName;\n  \t}\n\n  \tvar eventNames = getWildcardNames(eventName);\n\n  \tfireEventAs(ractive, eventNames, options.event, options.args, true);\n  }\n\n  function getWildcardNames(eventName) {\n  \tif (wildcardCache.hasOwnProperty(eventName)) {\n  \t\treturn wildcardCache[eventName];\n  \t} else {\n  \t\treturn wildcardCache[eventName] = getPotentialWildcardMatches(eventName);\n  \t}\n  }\n\n  function fireEventAs(ractive, eventNames, event, args) {\n  \tvar initialFire = arguments.length <= 4 || arguments[4] === undefined ? false : arguments[4];\n\n  \tvar subscribers,\n  \t    i,\n  \t    bubble = true;\n\n  \tenqueue(ractive, event);\n\n  \tfor (i = eventNames.length; i >= 0; i--) {\n  \t\tsubscribers = ractive._subs[eventNames[i]];\n\n  \t\tif (subscribers) {\n  \t\t\tbubble = notifySubscribers(ractive, subscribers, event, args) && bubble;\n  \t\t}\n  \t}\n\n  \tdequeue(ractive);\n\n  \tif (ractive.parent && bubble) {\n\n  \t\tif (initialFire && ractive.component) {\n  \t\t\tvar fullName = ractive.component.name + '.' + eventNames[eventNames.length - 1];\n  \t\t\teventNames = getWildcardNames(fullName);\n\n  \t\t\tif (event && !event.component) {\n  \t\t\t\tevent.component = ractive;\n  \t\t\t}\n  \t\t}\n\n  \t\tfireEventAs(ractive.parent, eventNames, event, args);\n  \t}\n  }\n\n  function notifySubscribers(ractive, subscribers, event, args) {\n  \tvar originalEvent = null,\n  \t    stopEvent = false;\n\n  \tif (event && !event._noArg) {\n  \t\targs = [event].concat(args);\n  \t}\n\n  \t// subscribers can be modified inflight, e.g. \"once\" functionality\n  \t// so we need to copy to make sure everyone gets called\n  \tsubscribers = subscribers.slice();\n\n  \tfor (var i = 0, len = subscribers.length; i < len; i += 1) {\n  \t\tif (subscribers[i].apply(ractive, args) === false) {\n  \t\t\tstopEvent = true;\n  \t\t}\n  \t}\n\n  \tif (event && !event._noArg && stopEvent && (originalEvent = event.original)) {\n  \t\toriginalEvent.preventDefault && originalEvent.preventDefault();\n  \t\toriginalEvent.stopPropagation && originalEvent.stopPropagation();\n  \t}\n\n  \treturn !stopEvent;\n  }\n\n  var eventPattern = /^event(?:\\.(.+))?$/;\n  var argumentsPattern = /^arguments\\.(\\d*)$/;\n  var dollarArgsPattern = /^\\$(\\d*)$/;\n\n  var EventDirective = (function () {\n  \tfunction EventDirective(owner, event, template) {\n  \t\tclassCallCheck(this, EventDirective);\n\n  \t\tthis.owner = owner;\n  \t\tthis.event = event;\n  \t\tthis.template = template;\n\n  \t\tthis.ractive = owner.parentFragment.ractive;\n  \t\tthis.parentFragment = owner.parentFragment;\n\n  \t\tthis.context = null;\n  \t\tthis.passthru = false;\n\n  \t\t// method calls\n  \t\tthis.method = null;\n  \t\tthis.resolvers = null;\n  \t\tthis.models = null;\n  \t\tthis.argsFn = null;\n\n  \t\t// handler directive\n  \t\tthis.action = null;\n  \t\tthis.args = null;\n  \t}\n\n  \tEventDirective.prototype.bind = function bind() {\n  \t\tvar _this = this;\n\n  \t\tthis.context = this.parentFragment.findContext();\n\n  \t\tvar template = this.template;\n\n  \t\tif (template.m) {\n  \t\t\tthis.method = template.m;\n\n  \t\t\tif (this.passthru = template.g) {\n  \t\t\t\t// on-click=\"foo(...arguments)\"\n  \t\t\t\t// no models or args, just pass thru values\n  \t\t\t} else {\n  \t\t\t\t\tthis.resolvers = [];\n  \t\t\t\t\tthis.models = template.a.r.map(function (ref, i) {\n  \t\t\t\t\t\tif (eventPattern.test(ref)) {\n  \t\t\t\t\t\t\t// on-click=\"foo(event.node)\"\n  \t\t\t\t\t\t\treturn {\n  \t\t\t\t\t\t\t\tevent: true,\n  \t\t\t\t\t\t\t\tkeys: ref.length > 5 ? splitKeypath(ref.slice(6)) : [],\n  \t\t\t\t\t\t\t\tunbind: noop\n  \t\t\t\t\t\t\t};\n  \t\t\t\t\t\t}\n\n  \t\t\t\t\t\tvar argMatch = argumentsPattern.exec(ref);\n  \t\t\t\t\t\tif (argMatch) {\n  \t\t\t\t\t\t\t// on-click=\"foo(arguments[0])\"\n  \t\t\t\t\t\t\treturn {\n  \t\t\t\t\t\t\t\targument: true,\n  \t\t\t\t\t\t\t\tindex: argMatch[1]\n  \t\t\t\t\t\t\t};\n  \t\t\t\t\t\t}\n\n  \t\t\t\t\t\tvar dollarMatch = dollarArgsPattern.exec(ref);\n  \t\t\t\t\t\tif (dollarMatch) {\n  \t\t\t\t\t\t\t// on-click=\"foo($1)\"\n  \t\t\t\t\t\t\treturn {\n  \t\t\t\t\t\t\t\targument: true,\n  \t\t\t\t\t\t\t\tindex: dollarMatch[1] - 1\n  \t\t\t\t\t\t\t};\n  \t\t\t\t\t\t}\n\n  \t\t\t\t\t\tvar resolver = undefined;\n\n  \t\t\t\t\t\tvar model = resolveReference(_this.parentFragment, ref);\n  \t\t\t\t\t\tif (!model) {\n  \t\t\t\t\t\t\tresolver = _this.parentFragment.resolve(ref, function (model) {\n  \t\t\t\t\t\t\t\t_this.models[i] = model;\n  \t\t\t\t\t\t\t\tremoveFromArray(_this.resolvers, resolver);\n  \t\t\t\t\t\t\t});\n\n  \t\t\t\t\t\t\t_this.resolvers.push(resolver);\n  \t\t\t\t\t\t}\n\n  \t\t\t\t\t\treturn model;\n  \t\t\t\t\t});\n\n  \t\t\t\t\tthis.argsFn = createFunction(template.a.s, template.a.r.length);\n  \t\t\t\t}\n  \t\t} else {\n  \t\t\t// TODO deprecate this style of directive\n  \t\t\tthis.action = typeof template === 'string' ? // on-click='foo'\n  \t\t\ttemplate : typeof template.n === 'string' ? // on-click='{{dynamic}}'\n  \t\t\ttemplate.n : new Fragment({\n  \t\t\t\towner: this,\n  \t\t\t\ttemplate: template.n\n  \t\t\t});\n\n  \t\t\tthis.args = template.a ? // static arguments\n  \t\t\ttypeof template.a === 'string' ? [template.a] : template.a : template.d ? // dynamic arguments\n  \t\t\tnew Fragment({\n  \t\t\t\towner: this,\n  \t\t\t\ttemplate: template.d\n  \t\t\t}) : []; // no arguments\n  \t\t}\n\n  \t\tif (this.template.n && typeof this.template.n !== 'string') this.action.bind();\n  \t\tif (this.template.d) this.args.bind();\n  \t};\n\n  \tEventDirective.prototype.bubble = function bubble() {\n  \t\tif (!this.dirty) {\n  \t\t\tthis.dirty = true;\n  \t\t\tthis.owner.bubble();\n  \t\t}\n  \t};\n\n  \tEventDirective.prototype.fire = function fire(event, passedArgs) {\n  \t\t// augment event object\n  \t\tif (event) {\n  \t\t\tevent.keypath = this.context.getKeypath();\n  \t\t\tevent.context = this.context.get();\n  \t\t\tevent.index = this.parentFragment.indexRefs;\n\n  \t\t\tif (passedArgs) passedArgs.unshift(event);\n  \t\t}\n\n  \t\tif (this.method) {\n  \t\t\tif (typeof this.ractive[this.method] !== 'function') {\n  \t\t\t\tthrow new Error('Attempted to call a non-existent method (\"' + this.method + '\")');\n  \t\t\t}\n\n  \t\t\tvar args = undefined;\n\n  \t\t\tif (this.passthru) {\n  \t\t\t\targs = passedArgs;\n  \t\t\t} else {\n  \t\t\t\tvar values = this.models.map(function (model) {\n  \t\t\t\t\tif (!model) return undefined;\n\n  \t\t\t\t\tif (model.event) {\n  \t\t\t\t\t\tvar obj = event;\n  \t\t\t\t\t\tvar keys = model.keys.slice();\n\n  \t\t\t\t\t\twhile (keys.length) obj = obj[keys.shift()];\n  \t\t\t\t\t\treturn obj;\n  \t\t\t\t\t}\n\n  \t\t\t\t\tif (model.argument) {\n  \t\t\t\t\t\treturn passedArgs ? passedArgs[model.index] : void 0;\n  \t\t\t\t\t}\n\n  \t\t\t\t\tif (model.wrapper) {\n  \t\t\t\t\t\treturn model.wrapper.value;\n  \t\t\t\t\t}\n\n  \t\t\t\t\treturn model.get();\n  \t\t\t\t});\n\n  \t\t\t\targs = this.argsFn.apply(null, values);\n  \t\t\t}\n\n  \t\t\t// make event available as `this.event`\n  \t\t\tvar ractive = this.ractive;\n  \t\t\tvar oldEvent = ractive.event;\n\n  \t\t\tractive.event = event;\n  \t\t\tractive[this.method].apply(ractive, args);\n  \t\t\tractive.event = oldEvent;\n  \t\t} else {\n  \t\t\tvar action = this.action.toString();\n  \t\t\tvar args = this.template.d ? this.args.getArgsList() : this.args;\n\n  \t\t\tif (event) event.name = action;\n\n  \t\t\tfireEvent(this.ractive, action, {\n  \t\t\t\tevent: event,\n  \t\t\t\targs: args\n  \t\t\t});\n  \t\t}\n  \t};\n\n  \tEventDirective.prototype.rebind = function rebind() {\n  \t\tthis.unbind();\n  \t\tthis.bind();\n  \t};\n\n  \tEventDirective.prototype.render = function render() {\n  \t\tthis.event.listen(this);\n  \t};\n\n  \tEventDirective.prototype.unbind = function unbind() {\n  \t\tvar template = this.template;\n\n  \t\tif (template.m) {\n  \t\t\tthis.resolvers.forEach(_unbind);\n  \t\t\tthis.resolvers = [];\n\n  \t\t\tthis.models = null;\n  \t\t} else {\n  \t\t\t// TODO this is brittle and non-explicit, fix it\n  \t\t\tif (this.action.unbind) this.action.unbind();\n  \t\t\tif (this.args.unbind) this.args.unbind();\n  \t\t}\n  \t};\n\n  \tEventDirective.prototype.unrender = function unrender() {\n  \t\tthis.event.unlisten();\n  \t};\n\n  \tEventDirective.prototype.update = function update() {\n  \t\tif (this.method) return; // nothing to do\n\n  \t\t// ugh legacy\n  \t\tif (this.action.update) this.action.update();\n  \t\tif (this.template.d) this.args.update();\n\n  \t\tthis.dirty = false;\n  \t};\n\n  \treturn EventDirective;\n  })();\n\n  var DOMEvent = (function () {\n  \tfunction DOMEvent(name, owner) {\n  \t\tclassCallCheck(this, DOMEvent);\n\n  \t\tif (name.indexOf('*') !== -1) {\n  \t\t\tfatal('Only component proxy-events may contain \"*\" wildcards, <' + owner.name + ' on-' + name + '=\"...\"/> is not valid');\n  \t\t}\n\n  \t\tthis.name = name;\n  \t\tthis.owner = owner;\n  \t\tthis.node = null;\n  \t\tthis.handler = null;\n  \t}\n\n  \tDOMEvent.prototype.listen = function listen(directive) {\n  \t\tvar node = this.node = this.owner.node;\n  \t\tvar name = this.name;\n\n  \t\tif (!('on' + name in node)) {\n  \t\t\twarnOnce(missingPlugin(name, 'events'));\n  \t\t}\n\n  \t\tnode.addEventListener(name, this.handler = function (event) {\n  \t\t\tdirective.fire({\n  \t\t\t\tnode: node,\n  \t\t\t\toriginal: event\n  \t\t\t});\n  \t\t}, false);\n  \t};\n\n  \tDOMEvent.prototype.unlisten = function unlisten() {\n  \t\tthis.node.removeEventListener(this.name, this.handler, false);\n  \t};\n\n  \treturn DOMEvent;\n  })();\n\n  var CustomEvent = (function () {\n  \tfunction CustomEvent(eventPlugin, owner) {\n  \t\tclassCallCheck(this, CustomEvent);\n\n  \t\tthis.eventPlugin = eventPlugin;\n  \t\tthis.owner = owner;\n  \t\tthis.handler = null;\n  \t}\n\n  \tCustomEvent.prototype.listen = function listen(directive) {\n  \t\tvar node = this.owner.node;\n\n  \t\tthis.handler = this.eventPlugin(node, function () {\n  \t\t\tvar event = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];\n\n  \t\t\tevent.node = event.node || node;\n  \t\t\tdirective.fire(event);\n  \t\t});\n  \t};\n\n  \tCustomEvent.prototype.unlisten = function unlisten() {\n  \t\tthis.handler.teardown();\n  \t};\n\n  \treturn CustomEvent;\n  })();\n\n  function camelCase (hyphenatedStr) {\n  \treturn hyphenatedStr.replace(/-([a-zA-Z])/g, function (match, $1) {\n  \t\treturn $1.toUpperCase();\n  \t});\n  }\n\n  var prefix$2 = undefined;\n\n  if (!isClient) {\n  \tprefix$2 = null;\n  } else {\n  \t(function () {\n  \t\tvar prefixCache = {};\n  \t\tvar testStyle = createElement('div').style;\n\n  \t\tprefix$2 = function (prop) {\n  \t\t\tprop = camelCase(prop);\n\n  \t\t\tif (!prefixCache[prop]) {\n  \t\t\t\tif (testStyle[prop] !== undefined) {\n  \t\t\t\t\tprefixCache[prop] = prop;\n  \t\t\t\t} else {\n  \t\t\t\t\t// test vendors...\n  \t\t\t\t\tvar capped = prop.charAt(0).toUpperCase() + prop.substring(1);\n\n  \t\t\t\t\tvar i = vendors.length;\n  \t\t\t\t\twhile (i--) {\n  \t\t\t\t\t\tvar vendor = vendors[i];\n  \t\t\t\t\t\tif (testStyle[vendor + capped] !== undefined) {\n  \t\t\t\t\t\t\tprefixCache[prop] = vendor + capped;\n  \t\t\t\t\t\t\tbreak;\n  \t\t\t\t\t\t}\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\treturn prefixCache[prop];\n  \t\t};\n  \t})();\n  }\n\n  var prefix$3 = prefix$2;\n\n  var visible = undefined;\n  var hidden = 'hidden';\n\n  if (doc) {\n  \tvar prefix$4 = undefined;\n\n  \tif (hidden in doc) {\n  \t\tprefix$4 = '';\n  \t} else {\n  \t\tvar i$2 = vendors.length;\n  \t\twhile (i$2--) {\n  \t\t\tvar vendor = vendors[i$2];\n  \t\t\thidden = vendor + 'Hidden';\n\n  \t\t\tif (hidden in doc) {\n  \t\t\t\tprefix$4 = vendor;\n  \t\t\t\tbreak;\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \tif (prefix$4 !== undefined) {\n  \t\tdoc.addEventListener(prefix$4 + 'visibilitychange', onChange);\n  \t\tonChange();\n  \t} else {\n  \t\t// gah, we're in an old browser\n  \t\tif ('onfocusout' in doc) {\n  \t\t\tdoc.addEventListener('focusout', onHide);\n  \t\t\tdoc.addEventListener('focusin', onShow);\n  \t\t} else {\n  \t\t\twin.addEventListener('pagehide', onHide);\n  \t\t\twin.addEventListener('blur', onHide);\n\n  \t\t\twin.addEventListener('pageshow', onShow);\n  \t\t\twin.addEventListener('focus', onShow);\n  \t\t}\n\n  \t\tvisible = true; // until proven otherwise. Not ideal but hey\n  \t}\n  }\n\n  function onChange() {\n  \tvisible = !doc[hidden];\n  }\n\n  function onHide() {\n  \tvisible = false;\n  }\n\n  function onShow() {\n  \tvisible = true;\n  }\n\n  var interpolators = {\n  \tnumber: function (from, to) {\n  \t\tvar delta;\n\n  \t\tif (!isNumeric(from) || !isNumeric(to)) {\n  \t\t\treturn null;\n  \t\t}\n\n  \t\tfrom = +from;\n  \t\tto = +to;\n\n  \t\tdelta = to - from;\n\n  \t\tif (!delta) {\n  \t\t\treturn function () {\n  \t\t\t\treturn from;\n  \t\t\t};\n  \t\t}\n\n  \t\treturn function (t) {\n  \t\t\treturn from + t * delta;\n  \t\t};\n  \t},\n\n  \tarray: function (from, to) {\n  \t\tvar intermediate, interpolators, len, i;\n\n  \t\tif (!isArray(from) || !isArray(to)) {\n  \t\t\treturn null;\n  \t\t}\n\n  \t\tintermediate = [];\n  \t\tinterpolators = [];\n\n  \t\ti = len = Math.min(from.length, to.length);\n  \t\twhile (i--) {\n  \t\t\tinterpolators[i] = interpolate(from[i], to[i]);\n  \t\t}\n\n  \t\t// surplus values - don't interpolate, but don't exclude them either\n  \t\tfor (i = len; i < from.length; i += 1) {\n  \t\t\tintermediate[i] = from[i];\n  \t\t}\n\n  \t\tfor (i = len; i < to.length; i += 1) {\n  \t\t\tintermediate[i] = to[i];\n  \t\t}\n\n  \t\treturn function (t) {\n  \t\t\tvar i = len;\n\n  \t\t\twhile (i--) {\n  \t\t\t\tintermediate[i] = interpolators[i](t);\n  \t\t\t}\n\n  \t\t\treturn intermediate;\n  \t\t};\n  \t},\n\n  \tobject: function (from, to) {\n  \t\tvar properties, len, interpolators, intermediate, prop;\n\n  \t\tif (!isObject(from) || !isObject(to)) {\n  \t\t\treturn null;\n  \t\t}\n\n  \t\tproperties = [];\n  \t\tintermediate = {};\n  \t\tinterpolators = {};\n\n  \t\tfor (prop in from) {\n  \t\t\tif (hasOwn.call(from, prop)) {\n  \t\t\t\tif (hasOwn.call(to, prop)) {\n  \t\t\t\t\tproperties.push(prop);\n  \t\t\t\t\tinterpolators[prop] = interpolate(from[prop], to[prop]);\n  \t\t\t\t} else {\n  \t\t\t\t\tintermediate[prop] = from[prop];\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\tfor (prop in to) {\n  \t\t\tif (hasOwn.call(to, prop) && !hasOwn.call(from, prop)) {\n  \t\t\t\tintermediate[prop] = to[prop];\n  \t\t\t}\n  \t\t}\n\n  \t\tlen = properties.length;\n\n  \t\treturn function (t) {\n  \t\t\tvar i = len,\n  \t\t\t    prop;\n\n  \t\t\twhile (i--) {\n  \t\t\t\tprop = properties[i];\n\n  \t\t\t\tintermediate[prop] = interpolators[prop](t);\n  \t\t\t}\n\n  \t\t\treturn intermediate;\n  \t\t};\n  \t}\n  };\n\n  var interpolators$1 = interpolators;\n\n  function interpolate(from, to, ractive, type) {\n  \tif (from === to) return null;\n\n  \tif (type) {\n  \t\tvar interpol = findInViewHierarchy('interpolators', ractive, type);\n  \t\tif (interpol) return interpol(from, to) || null;\n\n  \t\tfatal(missingPlugin(type, 'interpolator'));\n  \t}\n\n  \treturn interpolators$1.number(from, to) || interpolators$1.array(from, to) || interpolators$1.object(from, to) || null;\n  }\n\n  var unprefixPattern = new RegExp('^-(?:' + vendors.join('|') + ')-');\n\n  function unprefix (prop) {\n  \treturn prop.replace(unprefixPattern, '');\n  }\n\n  var vendorPattern = new RegExp('^(?:' + vendors.join('|') + ')([A-Z])');\n\n  function hyphenate (str) {\n  \tif (!str) return ''; // edge case\n\n  \tif (vendorPattern.test(str)) str = '-' + str;\n\n  \treturn str.replace(/[A-Z]/g, function (match) {\n  \t\treturn '-' + match.toLowerCase();\n  \t});\n  }\n\n  var createTransitions = undefined;\n\n  if (!isClient) {\n  \tcreateTransitions = null;\n  } else {\n  \t(function () {\n  \t\tvar testStyle = createElement('div').style;\n  \t\tvar linear = function (x) {\n  \t\t\treturn x;\n  \t\t};\n\n  \t\tvar canUseCssTransitions = {};\n  \t\tvar cannotUseCssTransitions = {};\n\n  \t\t// determine some facts about our environment\n  \t\tvar TRANSITION = undefined;\n  \t\tvar TRANSITIONEND = undefined;\n  \t\tvar CSS_TRANSITIONS_ENABLED = undefined;\n  \t\tvar TRANSITION_DURATION = undefined;\n  \t\tvar TRANSITION_PROPERTY = undefined;\n  \t\tvar TRANSITION_TIMING_FUNCTION = undefined;\n\n  \t\tif (testStyle.transition !== undefined) {\n  \t\t\tTRANSITION = 'transition';\n  \t\t\tTRANSITIONEND = 'transitionend';\n  \t\t\tCSS_TRANSITIONS_ENABLED = true;\n  \t\t} else if (testStyle.webkitTransition !== undefined) {\n  \t\t\tTRANSITION = 'webkitTransition';\n  \t\t\tTRANSITIONEND = 'webkitTransitionEnd';\n  \t\t\tCSS_TRANSITIONS_ENABLED = true;\n  \t\t} else {\n  \t\t\tCSS_TRANSITIONS_ENABLED = false;\n  \t\t}\n\n  \t\tif (TRANSITION) {\n  \t\t\tTRANSITION_DURATION = TRANSITION + 'Duration';\n  \t\t\tTRANSITION_PROPERTY = TRANSITION + 'Property';\n  \t\t\tTRANSITION_TIMING_FUNCTION = TRANSITION + 'TimingFunction';\n  \t\t}\n\n  \t\tcreateTransitions = function (t, to, options, changedProperties, resolve) {\n\n  \t\t\t// Wait a beat (otherwise the target styles will be applied immediately)\n  \t\t\t// TODO use a fastdom-style mechanism?\n  \t\t\tsetTimeout(function () {\n  \t\t\t\tvar jsTransitionsComplete = undefined;\n  \t\t\t\tvar cssTransitionsComplete = undefined;\n\n  \t\t\t\tfunction checkComplete() {\n  \t\t\t\t\tif (jsTransitionsComplete && cssTransitionsComplete) {\n  \t\t\t\t\t\t// will changes to events and fire have an unexpected consequence here?\n  \t\t\t\t\t\tt.ractive.fire(t.name + ':end', t.node, t.isIntro);\n  \t\t\t\t\t\tresolve();\n  \t\t\t\t\t}\n  \t\t\t\t}\n\n  \t\t\t\t// this is used to keep track of which elements can use CSS to animate\n  \t\t\t\t// which properties\n  \t\t\t\tvar hashPrefix = (t.node.namespaceURI || '') + t.node.tagName;\n\n  \t\t\t\tt.node.style[TRANSITION_PROPERTY] = changedProperties.map(prefix$3).map(hyphenate).join(',');\n  \t\t\t\tt.node.style[TRANSITION_TIMING_FUNCTION] = hyphenate(options.easing || 'linear');\n  \t\t\t\tt.node.style[TRANSITION_DURATION] = options.duration / 1000 + 's';\n\n  \t\t\t\tfunction transitionEndHandler(event) {\n  \t\t\t\t\tvar index = changedProperties.indexOf(camelCase(unprefix(event.propertyName)));\n  \t\t\t\t\tif (index !== -1) {\n  \t\t\t\t\t\tchangedProperties.splice(index, 1);\n  \t\t\t\t\t}\n\n  \t\t\t\t\tif (changedProperties.length) {\n  \t\t\t\t\t\t// still transitioning...\n  \t\t\t\t\t\treturn;\n  \t\t\t\t\t}\n\n  \t\t\t\t\tt.node.removeEventListener(TRANSITIONEND, transitionEndHandler, false);\n\n  \t\t\t\t\tcssTransitionsComplete = true;\n  \t\t\t\t\tcheckComplete();\n  \t\t\t\t}\n\n  \t\t\t\tt.node.addEventListener(TRANSITIONEND, transitionEndHandler, false);\n\n  \t\t\t\tsetTimeout(function () {\n  \t\t\t\t\tvar i = changedProperties.length;\n  \t\t\t\t\tvar hash = undefined;\n  \t\t\t\t\tvar originalValue = undefined;\n  \t\t\t\t\tvar index = undefined;\n  \t\t\t\t\tvar propertiesToTransitionInJs = [];\n  \t\t\t\t\tvar prop = undefined;\n  \t\t\t\t\tvar suffix = undefined;\n  \t\t\t\t\tvar interpolator = undefined;\n\n  \t\t\t\t\twhile (i--) {\n  \t\t\t\t\t\tprop = changedProperties[i];\n  \t\t\t\t\t\thash = hashPrefix + prop;\n\n  \t\t\t\t\t\tif (CSS_TRANSITIONS_ENABLED && !cannotUseCssTransitions[hash]) {\n  \t\t\t\t\t\t\tt.node.style[prefix$3(prop)] = to[prop];\n\n  \t\t\t\t\t\t\t// If we're not sure if CSS transitions are supported for\n  \t\t\t\t\t\t\t// this tag/property combo, find out now\n  \t\t\t\t\t\t\tif (!canUseCssTransitions[hash]) {\n  \t\t\t\t\t\t\t\toriginalValue = t.getStyle(prop);\n\n  \t\t\t\t\t\t\t\t// if this property is transitionable in this browser,\n  \t\t\t\t\t\t\t\t// the current style will be different from the target style\n  \t\t\t\t\t\t\t\tcanUseCssTransitions[hash] = t.getStyle(prop) != to[prop];\n  \t\t\t\t\t\t\t\tcannotUseCssTransitions[hash] = !canUseCssTransitions[hash];\n\n  \t\t\t\t\t\t\t\t// Reset, if we're going to use timers after all\n  \t\t\t\t\t\t\t\tif (cannotUseCssTransitions[hash]) {\n  \t\t\t\t\t\t\t\t\tt.node.style[prefix$3(prop)] = originalValue;\n  \t\t\t\t\t\t\t\t}\n  \t\t\t\t\t\t\t}\n  \t\t\t\t\t\t}\n\n  \t\t\t\t\t\tif (!CSS_TRANSITIONS_ENABLED || cannotUseCssTransitions[hash]) {\n  \t\t\t\t\t\t\t// we need to fall back to timer-based stuff\n  \t\t\t\t\t\t\tif (originalValue === undefined) {\n  \t\t\t\t\t\t\t\toriginalValue = t.getStyle(prop);\n  \t\t\t\t\t\t\t}\n\n  \t\t\t\t\t\t\t// need to remove this from changedProperties, otherwise transitionEndHandler\n  \t\t\t\t\t\t\t// will get confused\n  \t\t\t\t\t\t\tindex = changedProperties.indexOf(prop);\n  \t\t\t\t\t\t\tif (index === -1) {\n  \t\t\t\t\t\t\t\twarnIfDebug('Something very strange happened with transitions. Please raise an issue at https://github.com/ractivejs/ractive/issues - thanks!', { node: t.node });\n  \t\t\t\t\t\t\t} else {\n  \t\t\t\t\t\t\t\tchangedProperties.splice(index, 1);\n  \t\t\t\t\t\t\t}\n\n  \t\t\t\t\t\t\t// TODO Determine whether this property is animatable at all\n\n  \t\t\t\t\t\t\tsuffix = /[^\\d]*$/.exec(to[prop])[0];\n  \t\t\t\t\t\t\tinterpolator = interpolate(parseFloat(originalValue), parseFloat(to[prop])) || function () {\n  \t\t\t\t\t\t\t\treturn to[prop];\n  \t\t\t\t\t\t\t};\n\n  \t\t\t\t\t\t\t// ...then kick off a timer-based transition\n  \t\t\t\t\t\t\tpropertiesToTransitionInJs.push({\n  \t\t\t\t\t\t\t\tname: prefix$3(prop),\n  \t\t\t\t\t\t\t\tinterpolator: interpolator,\n  \t\t\t\t\t\t\t\tsuffix: suffix\n  \t\t\t\t\t\t\t});\n  \t\t\t\t\t\t}\n  \t\t\t\t\t}\n\n  \t\t\t\t\t// javascript transitions\n  \t\t\t\t\tif (propertiesToTransitionInJs.length) {\n  \t\t\t\t\t\tvar easing = undefined;\n\n  \t\t\t\t\t\tif (typeof options.easing === 'string') {\n  \t\t\t\t\t\t\teasing = t.ractive.easing[options.easing];\n\n  \t\t\t\t\t\t\tif (!easing) {\n  \t\t\t\t\t\t\t\twarnOnceIfDebug(missingPlugin(options.easing, 'easing'));\n  \t\t\t\t\t\t\t\teasing = linear;\n  \t\t\t\t\t\t\t}\n  \t\t\t\t\t\t} else if (typeof options.easing === 'function') {\n  \t\t\t\t\t\t\teasing = options.easing;\n  \t\t\t\t\t\t} else {\n  \t\t\t\t\t\t\teasing = linear;\n  \t\t\t\t\t\t}\n\n  \t\t\t\t\t\tnew Ticker({\n  \t\t\t\t\t\t\tduration: options.duration,\n  \t\t\t\t\t\t\teasing: easing,\n  \t\t\t\t\t\t\tstep: function (pos) {\n  \t\t\t\t\t\t\t\tvar i = propertiesToTransitionInJs.length;\n  \t\t\t\t\t\t\t\twhile (i--) {\n  \t\t\t\t\t\t\t\t\tvar _prop = propertiesToTransitionInJs[i];\n  \t\t\t\t\t\t\t\t\tt.node.style[_prop.name] = _prop.interpolator(pos) + _prop.suffix;\n  \t\t\t\t\t\t\t\t}\n  \t\t\t\t\t\t\t},\n  \t\t\t\t\t\t\tcomplete: function () {\n  \t\t\t\t\t\t\t\tjsTransitionsComplete = true;\n  \t\t\t\t\t\t\t\tcheckComplete();\n  \t\t\t\t\t\t\t}\n  \t\t\t\t\t\t});\n  \t\t\t\t\t} else {\n  \t\t\t\t\t\tjsTransitionsComplete = true;\n  \t\t\t\t\t}\n\n  \t\t\t\t\tif (!changedProperties.length) {\n  \t\t\t\t\t\t// We need to cancel the transitionEndHandler, and deal with\n  \t\t\t\t\t\t// the fact that it will never fire\n  \t\t\t\t\t\tt.node.removeEventListener(TRANSITIONEND, transitionEndHandler, false);\n  \t\t\t\t\t\tcssTransitionsComplete = true;\n  \t\t\t\t\t\tcheckComplete();\n  \t\t\t\t\t}\n  \t\t\t\t}, 0);\n  \t\t\t}, options.delay || 0);\n  \t\t};\n  \t})();\n  }\n\n  var createTransitions$1 = createTransitions;\n\n  function resetStyle(node, style) {\n  \tif (style) {\n  \t\tnode.setAttribute('style', style);\n  \t} else {\n  \t\t// Next line is necessary, to remove empty style attribute!\n  \t\t// See http://stackoverflow.com/a/7167553\n  \t\tnode.getAttribute('style');\n  \t\tnode.removeAttribute('style');\n  \t}\n  }\n\n  var getComputedStyle = win && (win.getComputedStyle || legacy.getComputedStyle);\n  var resolved = Promise$1.resolve();\n\n  var Transition = (function () {\n  \tfunction Transition(owner, template, isIntro) {\n  \t\tclassCallCheck(this, Transition);\n\n  \t\tthis.owner = owner;\n  \t\tthis.isIntro = isIntro;\n  \t\tthis.ractive = owner.ractive;\n\n  \t\tvar ractive = owner.ractive;\n\n  \t\tvar name = template.n || template;\n\n  \t\tif (typeof name !== 'string') {\n  \t\t\tvar fragment = new Fragment({\n  \t\t\t\towner: owner,\n  \t\t\t\ttemplate: name\n  \t\t\t}).bind(); // TODO need a way to capture values without bind()\n\n  \t\t\tname = fragment.toString();\n  \t\t\tfragment.unbind();\n\n  \t\t\tif (name === '') {\n  \t\t\t\t// empty string okay, just no transition\n  \t\t\t\treturn;\n  \t\t\t}\n  \t\t}\n\n  \t\tthis.name = name;\n\n  \t\tif (template.a) {\n  \t\t\tthis.params = template.a;\n  \t\t} else if (template.d) {\n  \t\t\t// TODO is there a way to interpret dynamic arguments without all the\n  \t\t\t// 'dependency thrashing'?\n  \t\t\tvar fragment = new Fragment({\n  \t\t\t\towner: owner,\n  \t\t\t\ttemplate: template.d\n  \t\t\t}).bind();\n\n  \t\t\tthis.params = fragment.getArgsList();\n  \t\t\tfragment.unbind();\n  \t\t}\n\n  \t\tthis._fn = findInViewHierarchy('transitions', ractive, name);\n\n  \t\tif (!this._fn) {\n  \t\t\twarnOnceIfDebug(missingPlugin(name, 'transition'), { ractive: ractive });\n  \t\t}\n  \t}\n\n  \tTransition.prototype.animateStyle = function animateStyle(style, value, options) {\n  \t\tvar _this = this;\n\n  \t\tif (arguments.length === 4) {\n  \t\t\tthrow new Error('t.animateStyle() returns a promise - use .then() instead of passing a callback');\n  \t\t}\n\n  \t\t// Special case - page isn't visible. Don't animate anything, because\n  \t\t// that way you'll never get CSS transitionend events\n  \t\tif (!visible) {\n  \t\t\tthis.setStyle(style, value);\n  \t\t\treturn resolved;\n  \t\t}\n\n  \t\tvar to = undefined;\n\n  \t\tif (typeof style === 'string') {\n  \t\t\tto = {};\n  \t\t\tto[style] = value;\n  \t\t} else {\n  \t\t\tto = style;\n\n  \t\t\t// shuffle arguments\n  \t\t\toptions = value;\n  \t\t}\n\n  \t\t// As of 0.3.9, transition authors should supply an `option` object with\n  \t\t// `duration` and `easing` properties (and optional `delay`), plus a\n  \t\t// callback function that gets called after the animation completes\n\n  \t\t// TODO remove this check in a future version\n  \t\tif (!options) {\n  \t\t\twarnOnceIfDebug('The \"%s\" transition does not supply an options object to `t.animateStyle()`. This will break in a future version of Ractive. For more info see https://github.com/RactiveJS/Ractive/issues/340', this.name);\n  \t\t\toptions = this;\n  \t\t}\n\n  \t\treturn new Promise$1(function (fulfil) {\n  \t\t\t// Edge case - if duration is zero, set style synchronously and complete\n  \t\t\tif (!options.duration) {\n  \t\t\t\t_this.setStyle(to);\n  \t\t\t\tfulfil();\n  \t\t\t\treturn;\n  \t\t\t}\n\n  \t\t\t// Get a list of the properties we're animating\n  \t\t\tvar propertyNames = Object.keys(to);\n  \t\t\tvar changedProperties = [];\n\n  \t\t\t// Store the current styles\n  \t\t\tvar computedStyle = getComputedStyle(_this.node);\n\n  \t\t\tvar i = propertyNames.length;\n  \t\t\twhile (i--) {\n  \t\t\t\tvar prop = propertyNames[i];\n  \t\t\t\tvar current = computedStyle[prefix$3(prop)];\n\n  \t\t\t\tif (current === '0px') current = 0;\n\n  \t\t\t\t// we need to know if we're actually changing anything\n  \t\t\t\tif (current != to[prop]) {\n  \t\t\t\t\t// use != instead of !==, so we can compare strings with numbers\n  \t\t\t\t\tchangedProperties.push(prop);\n\n  \t\t\t\t\t// make the computed style explicit, so we can animate where\n  \t\t\t\t\t// e.g. height='auto'\n  \t\t\t\t\t_this.node.style[prefix$3(prop)] = current;\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\t// If we're not actually changing anything, the transitionend event\n  \t\t\t// will never fire! So we complete early\n  \t\t\tif (!changedProperties.length) {\n  \t\t\t\tfulfil();\n  \t\t\t\treturn;\n  \t\t\t}\n\n  \t\t\tcreateTransitions$1(_this, to, options, changedProperties, fulfil);\n  \t\t});\n  \t};\n\n  \tTransition.prototype.getStyle = function getStyle(props) {\n  \t\tvar computedStyle = getComputedStyle(this.node);\n\n  \t\tif (typeof props === 'string') {\n  \t\t\tvar value = computedStyle[prefix$3(props)];\n  \t\t\treturn value === '0px' ? 0 : value;\n  \t\t}\n\n  \t\tif (!isArray(props)) {\n  \t\t\tthrow new Error('Transition$getStyle must be passed a string, or an array of strings representing CSS properties');\n  \t\t}\n\n  \t\tvar styles = {};\n\n  \t\tvar i = props.length;\n  \t\twhile (i--) {\n  \t\t\tvar prop = props[i];\n  \t\t\tvar value = computedStyle[prefix$3(prop)];\n\n  \t\t\tif (value === '0px') value = 0;\n  \t\t\tstyles[prop] = value;\n  \t\t}\n\n  \t\treturn styles;\n  \t};\n\n  \tTransition.prototype.processParams = function processParams(params, defaults) {\n  \t\tif (typeof params === 'number') {\n  \t\t\tparams = { duration: params };\n  \t\t} else if (typeof params === 'string') {\n  \t\t\tif (params === 'slow') {\n  \t\t\t\tparams = { duration: 600 };\n  \t\t\t} else if (params === 'fast') {\n  \t\t\t\tparams = { duration: 200 };\n  \t\t\t} else {\n  \t\t\t\tparams = { duration: 400 };\n  \t\t\t}\n  \t\t} else if (!params) {\n  \t\t\tparams = {};\n  \t\t}\n\n  \t\treturn extend({}, defaults, params);\n  \t};\n\n  \tTransition.prototype.setStyle = function setStyle(style, value) {\n  \t\tif (typeof style === 'string') {\n  \t\t\tthis.node.style[prefix$3(style)] = value;\n  \t\t} else {\n  \t\t\tvar prop = undefined;\n  \t\t\tfor (prop in style) {\n  \t\t\t\tif (style.hasOwnProperty(prop)) {\n  \t\t\t\t\tthis.node.style[prefix$3(prop)] = style[prop];\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\treturn this;\n  \t};\n\n  \tTransition.prototype.start = function start() {\n  \t\tvar _this2 = this;\n\n  \t\tvar node = this.node = this.owner.node;\n  \t\tvar originalStyle = node.getAttribute('style');\n\n  \t\tvar completed = undefined;\n\n  \t\t// create t.complete() - we don't want this on the prototype,\n  \t\t// because we don't want `this` silliness when passing it as\n  \t\t// an argument\n  \t\tthis.complete = function (noReset) {\n  \t\t\tif (completed) {\n  \t\t\t\treturn;\n  \t\t\t}\n\n  \t\t\tif (!noReset && _this2.isIntro) {\n  \t\t\t\tresetStyle(node, originalStyle);\n  \t\t\t}\n\n  \t\t\t_this2._manager.remove(_this2);\n\n  \t\t\tcompleted = true;\n  \t\t};\n\n  \t\t// If the transition function doesn't exist, abort\n  \t\tif (!this._fn) {\n  \t\t\tthis.complete();\n  \t\t\treturn;\n  \t\t}\n\n  \t\tthis._fn.apply(this.root, [this].concat(this.params));\n  \t};\n\n  \treturn Transition;\n  })();\n\n  function updateLiveQueries$1(element) {\n  \t// Does this need to be added to any live queries?\n  \tvar node = element.node;\n  \tvar instance = element.ractive;\n\n  \tdo {\n  \t\tvar liveQueries = instance._liveQueries;\n\n  \t\tvar i = liveQueries.length;\n  \t\twhile (i--) {\n  \t\t\tvar selector = liveQueries[i];\n  \t\t\tvar query = liveQueries[\"_\" + selector];\n\n  \t\t\tif (query.test(node)) {\n  \t\t\t\tquery.add(node);\n  \t\t\t\t// keep register of applicable selectors, for when we teardown\n  \t\t\t\telement.liveQueries.push(query);\n  \t\t\t}\n  \t\t}\n  \t} while (instance = instance.parent);\n  }\n\n  // TODO element.parent currently undefined\n  function findParentForm(element) {\n  \twhile (element = element.parent) {\n  \t\tif (element.name === 'form') {\n  \t\t\treturn element;\n  \t\t}\n  \t}\n  }\n\n  function warnAboutAmbiguity(description, ractive) {\n  \twarnOnceIfDebug('The ' + description + ' being used for two-way binding is ambiguous, and may cause unexpected results. Consider initialising your data to eliminate the ambiguity', { ractive: ractive });\n  }\n\n  var Binding = (function () {\n  \tfunction Binding(element) {\n  \t\tvar name = arguments.length <= 1 || arguments[1] === undefined ? 'value' : arguments[1];\n  \t\tclassCallCheck(this, Binding);\n\n  \t\tthis.element = element;\n  \t\tthis.ractive = element.ractive;\n  \t\tthis.attribute = element.attributeByName[name];\n\n  \t\tvar interpolator = this.attribute.interpolator;\n  \t\tinterpolator.twowayBinding = this;\n\n  \t\tvar model = interpolator.model;\n\n  \t\t// not bound?\n  \t\tif (!model) {\n  \t\t\t// try to force resolution\n  \t\t\tinterpolator.resolver.forceResolution();\n  \t\t\tmodel = interpolator.model;\n\n  \t\t\twarnAboutAmbiguity('\\'' + interpolator.template.r + '\\' reference', this.ractive);\n  \t\t} else if (model.isUnresolved) {\n  \t\t\t// reference expressions (e.g. foo[bar])\n  \t\t\tmodel.forceResolution();\n  \t\t\twarnAboutAmbiguity('expression', this.ractive);\n  \t\t}\n\n  \t\t// TODO include index/key/keypath refs as read-only\n  \t\telse if (model.isReadonly) {\n  \t\t\t\tvar keypath = model.getKeypath().replace(/^@/, '');\n  \t\t\t\twarnOnceIfDebug('Cannot use two-way binding on <' + element.name + '> element: ' + keypath + ' is read-only. To suppress this warning use <' + element.name + ' twoway=\\'false\\'...>', { ractive: this.ractive });\n  \t\t\t\treturn false;\n  \t\t\t}\n\n  \t\tthis.attribute.isTwoway = true;\n  \t\tthis.model = model;\n\n  \t\t// initialise value, if it's undefined\n  \t\tvar value = model.get();\n  \t\tthis.wasUndefined = value === undefined;\n\n  \t\tif (value === undefined && this.getInitialValue) {\n  \t\t\tvalue = this.getInitialValue();\n  \t\t\tmodel.set(value);\n  \t\t}\n\n  \t\tvar parentForm = findParentForm(element);\n  \t\tif (parentForm) {\n  \t\t\tthis.resetValue = value;\n  \t\t\tparentForm.formBindings.push(this);\n  \t\t}\n  \t}\n\n  \tBinding.prototype.bind = function bind() {\n  \t\tthis.model.registerTwowayBinding(this);\n  \t};\n\n  \tBinding.prototype.handleChange = function handleChange() {\n  \t\tvar _this = this;\n\n  \t\trunloop.start(this.root);\n  \t\tthis.attribute.locked = true;\n  \t\tthis.model.set(this.getValue());\n  \t\trunloop.scheduleTask(function () {\n  \t\t\treturn _this.attribute.locked = false;\n  \t\t});\n  \t\trunloop.end();\n  \t};\n\n  \tBinding.prototype.rebind = function rebind() {\n  \t\t// TODO what does this work with CheckboxNameBinding et al?\n  \t\tthis.unbind();\n  \t\tthis.model = this.attribute.interpolator.model;\n  \t\tthis.bind();\n  \t};\n\n  \tBinding.prototype.render = function render() {\n  \t\tthis.node = this.element.node;\n  \t\tthis.node._ractive.binding = this;\n  \t\tthis.rendered = true; // TODO is this used anywhere?\n  \t};\n\n  \tBinding.prototype.setFromNode = function setFromNode(node) {\n  \t\tthis.model.set(node.value);\n  \t};\n\n  \tBinding.prototype.unbind = function unbind() {\n  \t\tthis.model.unregisterTwowayBinding(this);\n  \t};\n\n  \tBinding.prototype.unrender = function unrender() {\n  \t\t// noop?\n  \t};\n\n  \treturn Binding;\n  })();\n\n  // This is the handler for DOM events that would lead to a change in the model\n  // (i.e. change, sometimes, input, and occasionally click and keyup)\n\n  function handleDomEvent() {\n  \tthis._ractive.binding.handleChange();\n  }\n\n  var CheckboxBinding = (function (_Binding) {\n  \tinherits(CheckboxBinding, _Binding);\n\n  \tfunction CheckboxBinding(element) {\n  \t\tclassCallCheck(this, CheckboxBinding);\n\n  \t\t_Binding.call(this, element, 'checked');\n  \t}\n\n  \tCheckboxBinding.prototype.render = function render() {\n  \t\t_Binding.prototype.render.call(this);\n\n  \t\tthis.node.addEventListener('change', handleDomEvent, false);\n\n  \t\tif (this.node.attachEvent) {\n  \t\t\tthis.node.addEventListener('click', handleDomEvent, false);\n  \t\t}\n  \t};\n\n  \tCheckboxBinding.prototype.unrender = function unrender() {\n  \t\tthis.node.removeEventListener('change', handleDomEvent, false);\n  \t\tthis.node.removeEventListener('click', handleDomEvent, false);\n  \t};\n\n  \tCheckboxBinding.prototype.getInitialValue = function getInitialValue() {\n  \t\treturn !!this.element.getAttribute('checked');\n  \t};\n\n  \tCheckboxBinding.prototype.getValue = function getValue() {\n  \t\treturn this.node.checked;\n  \t};\n\n  \tCheckboxBinding.prototype.setFromNode = function setFromNode(node) {\n  \t\tthis.model.set(node.checked);\n  \t};\n\n  \treturn CheckboxBinding;\n  })(Binding);\n\n  function getBindingGroup(group, model, getValue) {\n  \tvar hash = group + \"-bindingGroup\";\n  \treturn model[hash] || (model[hash] = new BindingGroup(hash, model, getValue));\n  }\n\n  var BindingGroup = (function () {\n  \tfunction BindingGroup(hash, model, getValue) {\n  \t\tvar _this = this;\n\n  \t\tclassCallCheck(this, BindingGroup);\n\n  \t\tthis.model = model;\n  \t\tthis.hash = hash;\n  \t\tthis.getValue = function () {\n  \t\t\t_this.value = getValue.call(_this);\n  \t\t\treturn _this.value;\n  \t\t};\n\n  \t\tthis.bindings = [];\n  \t}\n\n  \tBindingGroup.prototype.add = function add(binding) {\n  \t\tthis.bindings.push(binding);\n  \t};\n\n  \tBindingGroup.prototype.bind = function bind() {\n  \t\tthis.value = this.model.get();\n  \t\tthis.model.registerTwowayBinding(this);\n  \t\tthis.bound = true;\n  \t};\n\n  \tBindingGroup.prototype.remove = function remove(binding) {\n  \t\tremoveFromArray(this.bindings, binding);\n  \t\tif (!this.bindings.length) {\n  \t\t\tthis.unbind();\n  \t\t}\n  \t};\n\n  \tBindingGroup.prototype.unbind = function unbind() {\n  \t\tthis.model.unregisterTwowayBinding(this);\n  \t\tthis.bound = false;\n  \t\tdelete this.model[this.hash];\n  \t};\n\n  \treturn BindingGroup;\n  })();\n\n  var push$1 = [].push;\n\n  function getValue$1() {\n  \tvar all = this.bindings.filter(function (b) {\n  \t\treturn b.node && b.node.checked;\n  \t}).map(function (b) {\n  \t\treturn b.element.getAttribute('value');\n  \t});\n  \tvar res = [];\n  \tall.forEach(function (v) {\n  \t\tif (!arrayContains(res, v)) res.push(v);\n  \t});\n  \treturn res;\n  }\n\n  var CheckboxNameBinding = (function (_Binding) {\n  \tinherits(CheckboxNameBinding, _Binding);\n\n  \tfunction CheckboxNameBinding(element) {\n  \t\tclassCallCheck(this, CheckboxNameBinding);\n\n  \t\t_Binding.call(this, element, 'name');\n\n  \t\tthis.checkboxName = true; // so that ractive.updateModel() knows what to do with this\n\n  \t\t// Each input has a reference to an array containing it and its\n  \t\t// group, as two-way binding depends on being able to ascertain\n  \t\t// the status of all inputs within the group\n  \t\tthis.group = getBindingGroup('checkboxes', this.model, getValue$1);\n  \t\tthis.group.add(this);\n\n  \t\tif (this.noInitialValue) {\n  \t\t\tthis.group.noInitialValue = true;\n  \t\t}\n\n  \t\t// If no initial value was set, and this input is checked, we\n  \t\t// update the model\n  \t\tif (this.group.noInitialValue && this.element.getAttribute('checked')) {\n  \t\t\tvar existingValue = this.model.get();\n  \t\t\tvar bindingValue = this.element.getAttribute('value');\n\n  \t\t\tif (!arrayContains(existingValue, bindingValue)) {\n  \t\t\t\tpush$1.call(existingValue, bindingValue); // to avoid triggering runloop with array adaptor\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \tCheckboxNameBinding.prototype.bind = function bind() {\n  \t\tif (!this.group.bound) {\n  \t\t\tthis.group.bind();\n  \t\t}\n  \t};\n\n  \tCheckboxNameBinding.prototype.changed = function changed() {\n  \t\tvar wasChecked = !!this.isChecked;\n  \t\tthis.isChecked = this.node.checked;\n  \t\treturn this.isChecked === wasChecked;\n  \t};\n\n  \tCheckboxNameBinding.prototype.getInitialValue = function getInitialValue() {\n  \t\t// This only gets called once per group (of inputs that\n  \t\t// share a name), because it only gets called if there\n  \t\t// isn't an initial value. By the same token, we can make\n  \t\t// a note of that fact that there was no initial value,\n  \t\t// and populate it using any `checked` attributes that\n  \t\t// exist (which users should avoid, but which we should\n  \t\t// support anyway to avoid breaking expectations)\n  \t\tthis.noInitialValue = true; // TODO are noInitialValue and wasUndefined the same thing?\n  \t\treturn [];\n  \t};\n\n  \tCheckboxNameBinding.prototype.getValue = function getValue() {\n  \t\treturn this.group.value;\n  \t};\n\n  \tCheckboxNameBinding.prototype.handleChange = function handleChange() {\n  \t\tthis.isChecked = this.element.node.checked;\n  \t\tthis.group.value = this.model.get();\n  \t\tvar value = this.element.getAttribute('value');\n  \t\tif (this.isChecked && !arrayContains(this.group.value, value)) {\n  \t\t\tthis.group.value.push(value);\n  \t\t} else if (!this.isChecked && arrayContains(this.group.value, value)) {\n  \t\t\tremoveFromArray(this.group.value, value);\n  \t\t}\n  \t\t_Binding.prototype.handleChange.call(this);\n  \t};\n\n  \tCheckboxNameBinding.prototype.render = function render() {\n  \t\t_Binding.prototype.render.call(this);\n\n  \t\tvar node = this.node;\n\n  \t\tvar existingValue = this.model.get();\n  \t\tvar bindingValue = this.element.getAttribute('value');\n\n  \t\tif (isArray(existingValue)) {\n  \t\t\tthis.isChecked = arrayContains(existingValue, bindingValue);\n  \t\t} else {\n  \t\t\tthis.isChecked = existingValue == bindingValue;\n  \t\t}\n\n  \t\tnode.name = '{{' + this.model.getKeypath() + '}}';\n  \t\tnode.checked = this.isChecked;\n\n  \t\tnode.addEventListener('change', handleDomEvent, false);\n\n  \t\t// in case of IE emergency, bind to click event as well\n  \t\tif (node.attachEvent) {\n  \t\t\tnode.addEventListener('click', handleDomEvent, false);\n  \t\t}\n  \t};\n\n  \tCheckboxNameBinding.prototype.setFromNode = function setFromNode(node) {\n  \t\tthis.group.bindings.forEach(function (binding) {\n  \t\t\treturn binding.wasUndefined = true;\n  \t\t});\n\n  \t\tif (node.checked) {\n  \t\t\tvar valueSoFar = this.group.getValue();\n  \t\t\tvalueSoFar.push(this.element.getAttribute('value'));\n\n  \t\t\tthis.group.model.set(valueSoFar);\n  \t\t}\n  \t};\n\n  \tCheckboxNameBinding.prototype.unbind = function unbind() {\n  \t\tthis.group.remove(this);\n  \t};\n\n  \tCheckboxNameBinding.prototype.unrender = function unrender() {\n  \t\tvar node = this.element.node;\n\n  \t\tnode.removeEventListener('change', handleDomEvent, false);\n  \t\tnode.removeEventListener('click', handleDomEvent, false);\n  \t};\n\n  \treturn CheckboxNameBinding;\n  })(Binding);\n\n  var ContentEditableBinding = (function (_Binding) {\n  \tinherits(ContentEditableBinding, _Binding);\n\n  \tfunction ContentEditableBinding() {\n  \t\tclassCallCheck(this, ContentEditableBinding);\n\n  \t\t_Binding.apply(this, arguments);\n  \t}\n\n  \tContentEditableBinding.prototype.getInitialValue = function getInitialValue() {\n  \t\treturn this.element.fragment ? this.element.fragment.toString() : '';\n  \t};\n\n  \tContentEditableBinding.prototype.getValue = function getValue() {\n  \t\treturn this.element.node.innerHTML;\n  \t};\n\n  \tContentEditableBinding.prototype.render = function render() {\n  \t\t_Binding.prototype.render.call(this);\n\n  \t\tvar node = this.node;\n\n  \t\tnode.addEventListener('change', handleDomEvent, false);\n  \t\tnode.addEventListener('blur', handleDomEvent, false);\n\n  \t\tif (!this.ractive.lazy) {\n  \t\t\tnode.addEventListener('input', handleDomEvent, false);\n\n  \t\t\tif (node.attachEvent) {\n  \t\t\t\tnode.addEventListener('keyup', handleDomEvent, false);\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tContentEditableBinding.prototype.setFromNode = function setFromNode(node) {\n  \t\tthis.model.set(node.innerHTML);\n  \t};\n\n  \tContentEditableBinding.prototype.unrender = function unrender() {\n  \t\tvar node = this.node;\n\n  \t\tnode.removeEventListener('blur', handleDomEvent, false);\n  \t\tnode.removeEventListener('change', handleDomEvent, false);\n  \t\tnode.removeEventListener('input', handleDomEvent, false);\n  \t\tnode.removeEventListener('keyup', handleDomEvent, false);\n  \t};\n\n  \treturn ContentEditableBinding;\n  })(Binding);\n\n  function handleBlur() {\n  \thandleDomEvent.call(this);\n\n  \tvar value = this._ractive.binding.model.get();\n  \tthis.value = value == undefined ? '' : value;\n  }\n\n  function handleDelay(delay) {\n  \tvar timeout = undefined;\n\n  \treturn function () {\n  \t\tvar _this = this;\n\n  \t\tif (timeout) clearTimeout(timeout);\n\n  \t\ttimeout = setTimeout(function () {\n  \t\t\tvar binding = _this._ractive.binding;\n  \t\t\tif (binding.rendered) handleDomEvent.call(_this);\n  \t\t\ttimeout = null;\n  \t\t}, delay);\n  \t};\n  }\n\n  var GenericBinding = (function (_Binding) {\n  \tinherits(GenericBinding, _Binding);\n\n  \tfunction GenericBinding() {\n  \t\tclassCallCheck(this, GenericBinding);\n\n  \t\t_Binding.apply(this, arguments);\n  \t}\n\n  \tGenericBinding.prototype.getInitialValue = function getInitialValue() {\n  \t\treturn '';\n  \t};\n\n  \tGenericBinding.prototype.getValue = function getValue() {\n  \t\treturn this.node.value;\n  \t};\n\n  \tGenericBinding.prototype.render = function render() {\n  \t\t_Binding.prototype.render.call(this);\n\n  \t\t// any lazy setting for this element overrides the root\n  \t\t// if the value is a number, it's a timeout\n  \t\tvar lazy = this.ractive.lazy;\n  \t\tvar timeout = false;\n\n  \t\t// TODO handle at parse time\n  \t\tif (this.element.template.a && 'lazy' in this.element.template.a) {\n  \t\t\tlazy = this.element.template.a.lazy;\n  \t\t\tif (lazy === 0) lazy = true; // empty attribute\n  \t\t}\n\n  \t\t// TODO handle this at parse time as well?\n  \t\tif (lazy === 'false') lazy = false;\n\n  \t\tif (isNumeric(lazy)) {\n  \t\t\ttimeout = +lazy;\n  \t\t\tlazy = false;\n  \t\t}\n\n  \t\tthis.handler = timeout ? handleDelay(timeout) : handleDomEvent;\n\n  \t\tvar node = this.node;\n\n  \t\tnode.addEventListener('change', handleDomEvent, false);\n\n  \t\tif (!lazy) {\n  \t\t\tnode.addEventListener('input', this.handler, false);\n\n  \t\t\tif (node.attachEvent) {\n  \t\t\t\tnode.addEventListener('keyup', this.handler, false);\n  \t\t\t}\n  \t\t}\n\n  \t\tnode.addEventListener('blur', handleBlur, false);\n  \t};\n\n  \tGenericBinding.prototype.unrender = function unrender() {\n  \t\tvar node = this.element.node;\n  \t\tthis.rendered = false;\n\n  \t\tnode.removeEventListener('change', handleDomEvent, false);\n  \t\tnode.removeEventListener('input', this.handler, false);\n  \t\tnode.removeEventListener('keyup', this.handler, false);\n  \t\tnode.removeEventListener('blur', handleBlur, false);\n  \t};\n\n  \treturn GenericBinding;\n  })(Binding);\n\n  var MultipleSelectBinding = (function (_Binding) {\n  \tinherits(MultipleSelectBinding, _Binding);\n\n  \tfunction MultipleSelectBinding() {\n  \t\tclassCallCheck(this, MultipleSelectBinding);\n\n  \t\t_Binding.apply(this, arguments);\n  \t}\n\n  \tMultipleSelectBinding.prototype.forceUpdate = function forceUpdate() {\n  \t\tvar _this = this;\n\n  \t\tvar value = this.getValue();\n\n  \t\tif (value !== undefined) {\n  \t\t\tthis.attribute.locked = true;\n  \t\t\trunloop.scheduleTask(function () {\n  \t\t\t\treturn _this.attribute.locked = false;\n  \t\t\t});\n  \t\t\tthis.model.set(value);\n  \t\t}\n  \t};\n\n  \tMultipleSelectBinding.prototype.getInitialValue = function getInitialValue() {\n  \t\treturn this.element.options.filter(function (option) {\n  \t\t\treturn option.getAttribute('selected');\n  \t\t}).map(function (option) {\n  \t\t\treturn option.getAttribute('value');\n  \t\t});\n  \t};\n\n  \tMultipleSelectBinding.prototype.getValue = function getValue() {\n  \t\tvar options = this.element.node.options;\n  \t\tvar len = options.length;\n\n  \t\tvar selectedValues = [];\n\n  \t\tfor (var i = 0; i < len; i += 1) {\n  \t\t\tvar option = options[i];\n\n  \t\t\tif (option.selected) {\n  \t\t\t\tvar optionValue = option._ractive ? option._ractive.value : option.value;\n  \t\t\t\tselectedValues.push(optionValue);\n  \t\t\t}\n  \t\t}\n\n  \t\treturn selectedValues;\n  \t};\n\n  \tMultipleSelectBinding.prototype.handleChange = function handleChange() {\n  \t\tvar attribute = this.attribute;\n  \t\tvar previousValue = attribute.getValue();\n\n  \t\tvar value = this.getValue();\n\n  \t\tif (previousValue === undefined || !arrayContentsMatch(value, previousValue)) {\n  \t\t\t_Binding.prototype.handleChange.call(this);\n  \t\t}\n\n  \t\treturn this;\n  \t};\n\n  \tMultipleSelectBinding.prototype.render = function render() {\n  \t\t_Binding.prototype.render.call(this);\n\n  \t\tthis.node.addEventListener('change', handleDomEvent, false);\n\n  \t\tif (this.model.get() === undefined) {\n  \t\t\t// get value from DOM, if possible\n  \t\t\tthis.handleChange();\n  \t\t}\n  \t};\n\n  \tMultipleSelectBinding.prototype.setFromNode = function setFromNode(node) {\n  \t\tvar i = node.selectedOptions.length;\n  \t\tvar result = new Array(i);\n\n  \t\twhile (i--) {\n  \t\t\tvar option = node.selectedOptions[i];\n  \t\t\tresult[i] = option._ractive ? option._ractive.value : option.value;\n  \t\t}\n\n  \t\tthis.model.set(result);\n  \t};\n\n  \tMultipleSelectBinding.prototype.setValue = function setValue() {\n  \t\tthrow new Error('TODO not implemented yet');\n  \t};\n\n  \tMultipleSelectBinding.prototype.unrender = function unrender() {\n  \t\tthis.node.removeEventListener('change', handleDomEvent, false);\n  \t};\n\n  \tMultipleSelectBinding.prototype.updateModel = function updateModel() {\n  \t\tif (this.attribute.value === undefined || !this.attribute.value.length) {\n  \t\t\tthis.keypath.set(this.initialValue);\n  \t\t}\n  \t};\n\n  \treturn MultipleSelectBinding;\n  })(Binding);\n\n  var NumericBinding = (function (_GenericBinding) {\n  \tinherits(NumericBinding, _GenericBinding);\n\n  \tfunction NumericBinding() {\n  \t\tclassCallCheck(this, NumericBinding);\n\n  \t\t_GenericBinding.apply(this, arguments);\n  \t}\n\n  \tNumericBinding.prototype.getInitialValue = function getInitialValue() {\n  \t\treturn undefined;\n  \t};\n\n  \tNumericBinding.prototype.getValue = function getValue() {\n  \t\tvar value = parseFloat(this.node.value);\n  \t\treturn isNaN(value) ? undefined : value;\n  \t};\n\n  \tNumericBinding.prototype.setFromNode = function setFromNode(node) {\n  \t\tvar value = parseFloat(node.value);\n  \t\tif (!isNaN(value)) this.model.set(value);\n  \t};\n\n  \treturn NumericBinding;\n  })(GenericBinding);\n\n  var siblings = {};\n\n  function getSiblings(hash) {\n  \treturn siblings[hash] || (siblings[hash] = []);\n  }\n\n  var RadioBinding = (function (_Binding) {\n  \tinherits(RadioBinding, _Binding);\n\n  \tfunction RadioBinding(element) {\n  \t\tclassCallCheck(this, RadioBinding);\n\n  \t\t_Binding.call(this, element, 'checked');\n\n  \t\tthis.siblings = getSiblings(this.ractive._guid + this.element.getAttribute('name'));\n  \t\tthis.siblings.push(this);\n  \t}\n\n  \tRadioBinding.prototype.getValue = function getValue() {\n  \t\treturn this.node.checked;\n  \t};\n\n  \tRadioBinding.prototype.handleChange = function handleChange() {\n  \t\trunloop.start(this.root);\n\n  \t\tthis.siblings.forEach(function (binding) {\n  \t\t\tbinding.model.set(binding.getValue());\n  \t\t});\n\n  \t\trunloop.end();\n  \t};\n\n  \tRadioBinding.prototype.render = function render() {\n  \t\t_Binding.prototype.render.call(this);\n\n  \t\tthis.node.addEventListener('change', handleDomEvent, false);\n\n  \t\tif (this.node.attachEvent) {\n  \t\t\tthis.node.addEventListener('click', handleDomEvent, false);\n  \t\t}\n  \t};\n\n  \tRadioBinding.prototype.setFromNode = function setFromNode(node) {\n  \t\tthis.model.set(node.checked);\n  \t};\n\n  \tRadioBinding.prototype.unbind = function unbind() {\n  \t\tremoveFromArray(this.siblings, this);\n  \t};\n\n  \tRadioBinding.prototype.unrender = function unrender() {\n  \t\tthis.node.removeEventListener('change', handleDomEvent, false);\n  \t\tthis.node.removeEventListener('click', handleDomEvent, false);\n  \t};\n\n  \treturn RadioBinding;\n  })(Binding);\n\n  function getValue$2() {\n  \tvar checked = this.bindings.filter(function (b) {\n  \t\treturn b.node.checked;\n  \t});\n  \tif (checked.length > 0) {\n  \t\treturn checked[0].element.getAttribute('value');\n  \t}\n  }\n\n  var RadioNameBinding = (function (_Binding) {\n  \tinherits(RadioNameBinding, _Binding);\n\n  \tfunction RadioNameBinding(element) {\n  \t\tclassCallCheck(this, RadioNameBinding);\n\n  \t\t_Binding.call(this, element, 'name');\n\n  \t\tthis.group = getBindingGroup('radioname', this.model, getValue$2);\n  \t\tthis.group.add(this);\n\n  \t\tif (element.checked) {\n  \t\t\tthis.group.value = this.getValue();\n  \t\t}\n  \t}\n\n  \tRadioNameBinding.prototype.bind = function bind() {\n  \t\tvar _this = this;\n\n  \t\tif (!this.group.bound) {\n  \t\t\tthis.group.bind();\n  \t\t}\n\n  \t\t// update name keypath when necessary\n  \t\tthis.nameAttributeBinding = {\n  \t\t\thandleChange: function () {\n  \t\t\t\treturn _this.node.name = '{{' + _this.model.getKeypath() + '}}';\n  \t\t\t}\n  \t\t};\n\n  \t\tthis.model.getKeypathModel().register(this.nameAttributeBinding);\n  \t};\n\n  \tRadioNameBinding.prototype.getInitialValue = function getInitialValue() {\n  \t\tif (this.element.getAttribute('checked')) {\n  \t\t\treturn this.element.getAttribute('value');\n  \t\t}\n  \t};\n\n  \tRadioNameBinding.prototype.getValue = function getValue() {\n  \t\treturn this.element.getAttribute('value');\n  \t};\n\n  \tRadioNameBinding.prototype.handleChange = function handleChange() {\n  \t\t// If this <input> is the one that's checked, then the value of its\n  \t\t// `name` model gets set to its value\n  \t\tif (this.node.checked) {\n  \t\t\tthis.group.value = this.getValue();\n  \t\t\t_Binding.prototype.handleChange.call(this);\n  \t\t}\n  \t};\n\n  \tRadioNameBinding.prototype.render = function render() {\n  \t\t_Binding.prototype.render.call(this);\n\n  \t\tvar node = this.node;\n\n  \t\tnode.name = '{{' + this.model.getKeypath() + '}}';\n  \t\tnode.checked = this.model.get() == this.element.getAttribute('value');\n\n  \t\tnode.addEventListener('change', handleDomEvent, false);\n\n  \t\tif (node.attachEvent) {\n  \t\t\tnode.addEventListener('click', handleDomEvent, false);\n  \t\t}\n  \t};\n\n  \tRadioNameBinding.prototype.setFromNode = function setFromNode(node) {\n  \t\tif (node.checked) {\n  \t\t\tthis.group.model.set(this.element.getAttribute('value'));\n  \t\t}\n  \t};\n\n  \tRadioNameBinding.prototype.unbind = function unbind() {\n  \t\tthis.group.remove(this);\n\n  \t\tthis.model.getKeypathModel().unregister(this.nameAttributeBinding);\n  \t};\n\n  \tRadioNameBinding.prototype.unrender = function unrender() {\n  \t\tvar node = this.node;\n\n  \t\tnode.removeEventListener('change', handleDomEvent, false);\n  \t\tnode.removeEventListener('click', handleDomEvent, false);\n  \t};\n\n  \treturn RadioNameBinding;\n  })(Binding);\n\n  var SingleSelectBinding = (function (_Binding) {\n  \tinherits(SingleSelectBinding, _Binding);\n\n  \tfunction SingleSelectBinding() {\n  \t\tclassCallCheck(this, SingleSelectBinding);\n\n  \t\t_Binding.apply(this, arguments);\n  \t}\n\n  \tSingleSelectBinding.prototype.forceUpdate = function forceUpdate() {\n  \t\tvar _this = this;\n\n  \t\tvar value = this.getValue();\n\n  \t\tif (value !== undefined) {\n  \t\t\tthis.attribute.locked = true;\n  \t\t\trunloop.scheduleTask(function () {\n  \t\t\t\treturn _this.attribute.locked = false;\n  \t\t\t});\n  \t\t\tthis.model.set(value);\n  \t\t}\n  \t};\n\n  \tSingleSelectBinding.prototype.getInitialValue = function getInitialValue() {\n  \t\tif (this.element.getAttribute('value') !== undefined) {\n  \t\t\treturn;\n  \t\t}\n\n  \t\tvar options = this.element.options;\n  \t\tvar len = options.length;\n\n  \t\tif (!len) return;\n\n  \t\tvar value = undefined;\n  \t\tvar optionWasSelected = undefined;\n  \t\tvar i = len;\n\n  \t\t// take the final selected option...\n  \t\twhile (i--) {\n  \t\t\tvar option = options[i];\n\n  \t\t\tif (option.getAttribute('selected')) {\n  \t\t\t\tif (!option.getAttribute('disabled')) {\n  \t\t\t\t\tvalue = option.getAttribute('value');\n  \t\t\t\t}\n\n  \t\t\t\toptionWasSelected = true;\n  \t\t\t\tbreak;\n  \t\t\t}\n  \t\t}\n\n  \t\t// or the first non-disabled option, if none are selected\n  \t\tif (!optionWasSelected) {\n  \t\t\twhile (++i < len) {\n  \t\t\t\tif (!options[i].getAttribute('disabled')) {\n  \t\t\t\t\tvalue = options[i].getAttribute('value');\n  \t\t\t\t\tbreak;\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\t// This is an optimisation (aka hack) that allows us to forgo some\n  \t\t// other more expensive work\n  \t\t// TODO does it still work? seems at odds with new architecture\n  \t\tif (value !== undefined) {\n  \t\t\tthis.element.attributeByName.value.value = value;\n  \t\t}\n\n  \t\treturn value;\n  \t};\n\n  \tSingleSelectBinding.prototype.getValue = function getValue() {\n  \t\tvar options = this.node.options;\n  \t\tvar len = options.length;\n\n  \t\tvar i = undefined;\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tvar option = options[i];\n\n  \t\t\tif (options[i].selected && !options[i].disabled) {\n  \t\t\t\treturn option._ractive ? option._ractive.value : option.value;\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tSingleSelectBinding.prototype.render = function render() {\n  \t\t_Binding.prototype.render.call(this);\n  \t\tthis.node.addEventListener('change', handleDomEvent, false);\n  \t};\n\n  \tSingleSelectBinding.prototype.setFromNode = function setFromNode(node) {\n  \t\tvar option = node.selectedOptions[0];\n  \t\tthis.model.set(option._ractive ? option._ractive.value : option.value);\n  \t};\n\n  \t// TODO this method is an anomaly... is it necessary?\n\n  \tSingleSelectBinding.prototype.setValue = function setValue(value) {\n  \t\tthis.model.set(value);\n  \t};\n\n  \tSingleSelectBinding.prototype.unrender = function unrender() {\n  \t\tthis.node.removeEventListener('change', handleDomEvent, false);\n  \t};\n\n  \treturn SingleSelectBinding;\n  })(Binding);\n\n  function isBindable(attribute) {\n  \treturn attribute && attribute.template.length === 1 && attribute.template[0].t === INTERPOLATOR && !attribute.template[0].s;\n  }\n\n  function selectBinding(element) {\n  \tvar attributes = element.attributeByName;\n\n  \t// contenteditable - bind if the contenteditable attribute is true\n  \t// or is bindable and may thus become true...\n  \tif (element.getAttribute('contenteditable') || isBindable(attributes.contenteditable)) {\n  \t\t// ...and this element also has a value attribute to bind\n  \t\treturn isBindable(attributes.value) ? ContentEditableBinding : null;\n  \t}\n\n  \t// <input>\n  \tif (element.name === 'input') {\n  \t\tvar type = element.getAttribute('type');\n\n  \t\tif (type === 'radio' || type === 'checkbox') {\n  \t\t\tvar bindName = isBindable(attributes.name);\n  \t\t\tvar bindChecked = isBindable(attributes.checked);\n\n  \t\t\t// we can either bind the name attribute, or the checked attribute - not both\n  \t\t\tif (bindName && bindChecked) {\n  \t\t\t\twarnIfDebug('A radio input can have two-way binding on its name attribute, or its checked attribute - not both', { ractive: element.root });\n  \t\t\t}\n\n  \t\t\tif (bindName) {\n  \t\t\t\treturn type === 'radio' ? RadioNameBinding : CheckboxNameBinding;\n  \t\t\t}\n\n  \t\t\tif (bindChecked) {\n  \t\t\t\treturn type === 'radio' ? RadioBinding : CheckboxBinding;\n  \t\t\t}\n  \t\t}\n\n  \t\tif (type === 'file' && isBindable(attributes.value)) {\n  \t\t\treturn Binding;\n  \t\t}\n\n  \t\tif (isBindable(attributes.value)) {\n  \t\t\treturn type === 'number' || type === 'range' ? NumericBinding : GenericBinding;\n  \t\t}\n\n  \t\treturn null;\n  \t}\n\n  \t// <select>\n  \tif (element.name === 'select' && isBindable(attributes.value)) {\n  \t\treturn element.getAttribute('multiple') ? MultipleSelectBinding : SingleSelectBinding;\n  \t}\n\n  \t// <textarea>\n  \tif (element.name === 'textarea' && isBindable(attributes.value)) {\n  \t\treturn GenericBinding;\n  \t}\n  }\n\n  function makeDirty$1(query) {\n  \tquery.makeDirty();\n  }\n\n  var Element = (function (_Item) {\n  \tinherits(Element, _Item);\n\n  \tfunction Element(options) {\n  \t\tvar _this = this;\n\n  \t\tclassCallCheck(this, Element);\n\n  \t\t_Item.call(this, options);\n\n  \t\tthis.liveQueries = []; // TODO rare case. can we handle differently?\n\n  \t\tthis.name = options.template.e.toLowerCase();\n  \t\tthis.isVoid = voidElementNames.test(this.name);\n\n  \t\t// find parent element\n  \t\tvar fragment = this.parentFragment;\n  \t\twhile (fragment) {\n  \t\t\tif (fragment.owner.type === ELEMENT) {\n  \t\t\t\tthis.parent = fragment.owner;\n  \t\t\t\tbreak;\n  \t\t\t}\n  \t\t\tfragment = fragment.parent;\n  \t\t}\n\n  \t\t// create attributes\n  \t\tthis.attributeByName = {};\n  \t\tthis.attributes = [];\n\n  \t\tif (this.template.a) {\n  \t\t\tObject.keys(this.template.a).forEach(function (name) {\n  \t\t\t\t// TODO process this at parse time\n  \t\t\t\tif (name === 'twoway' || name === 'lazy') return;\n\n  \t\t\t\tvar attribute = new Attribute({\n  \t\t\t\t\tname: name,\n  \t\t\t\t\telement: _this,\n  \t\t\t\t\tparentFragment: _this.parentFragment,\n  \t\t\t\t\ttemplate: _this.template.a[name]\n  \t\t\t\t});\n\n  \t\t\t\t_this.attributeByName[name] = attribute;\n\n  \t\t\t\tif (name !== 'value' && name !== 'type') _this.attributes.push(attribute);\n  \t\t\t});\n\n  \t\t\tif (this.attributeByName.type) this.attributes.unshift(this.attributeByName.type);\n  \t\t\tif (this.attributeByName.value) this.attributes.push(this.attributeByName.value);\n  \t\t}\n\n  \t\t// create conditional attributes\n  \t\tthis.conditionalAttributes = (this.template.m || []).map(function (template) {\n  \t\t\treturn new ConditionalAttribute({\n  \t\t\t\towner: _this,\n  \t\t\t\tparentFragment: _this.parentFragment,\n  \t\t\t\ttemplate: template\n  \t\t\t});\n  \t\t});\n\n  \t\t// create decorator\n  \t\tif (this.template.o) {\n  \t\t\tthis.decorator = new Decorator(this, this.template.o);\n  \t\t}\n\n  \t\t// attach event handlers\n  \t\tthis.eventHandlers = [];\n  \t\tif (this.template.v) {\n  \t\t\tObject.keys(this.template.v).forEach(function (key) {\n  \t\t\t\tvar eventNames = key.split('-');\n  \t\t\t\tvar template = _this.template.v[key];\n\n  \t\t\t\teventNames.forEach(function (eventName) {\n  \t\t\t\t\tvar fn = findInViewHierarchy('events', _this.ractive, eventName);\n  \t\t\t\t\t// we need to pass in \"this\" in order to get\n  \t\t\t\t\t// access to node when it is created.\n  \t\t\t\t\tvar event = fn ? new CustomEvent(fn, _this) : new DOMEvent(eventName, _this);\n  \t\t\t\t\t_this.eventHandlers.push(new EventDirective(_this, event, template));\n  \t\t\t\t});\n  \t\t\t});\n  \t\t}\n\n  \t\t// create children\n  \t\tif (options.template.f && !options.noContent) {\n  \t\t\tthis.fragment = new Fragment({\n  \t\t\t\ttemplate: options.template.f,\n  \t\t\t\towner: this,\n  \t\t\t\tcssIds: null\n  \t\t\t});\n  \t\t}\n\n  \t\tthis.binding = null; // filled in later\n  \t}\n\n  \tElement.prototype.bind = function bind() {\n  \t\tthis.attributes.forEach(_bind);\n  \t\tthis.conditionalAttributes.forEach(_bind);\n  \t\tthis.eventHandlers.forEach(_bind);\n\n  \t\tif (this.decorator) this.decorator.bind();\n  \t\tif (this.fragment) this.fragment.bind();\n\n  \t\t// create two-way binding if necessary\n  \t\tif (this.binding = this.createTwowayBinding()) this.binding.bind();\n  \t};\n\n  \tElement.prototype.createTwowayBinding = function createTwowayBinding() {\n  \t\tvar attributes = this.template.a;\n\n  \t\tif (!attributes) return null;\n\n  \t\tvar shouldBind = 'twoway' in attributes ? attributes.twoway === 0 || attributes.twoway === 'true' : // covers `twoway` and `twoway='true'`\n  \t\tthis.ractive.twoway;\n\n  \t\tif (!shouldBind) return null;\n\n  \t\tvar Binding = selectBinding(this);\n\n  \t\tif (!Binding) return null;\n\n  \t\tvar binding = new Binding(this);\n\n  \t\treturn binding && binding.model ? binding : null;\n  \t};\n\n  \tElement.prototype.detach = function detach() {\n  \t\tif (this.decorator) this.decorator.unrender();\n  \t\treturn detachNode(this.node);\n  \t};\n\n  \tElement.prototype.find = function find(selector) {\n  \t\tif (matches(this.node, selector)) return this.node;\n  \t\tif (this.fragment) {\n  \t\t\treturn this.fragment.find(selector);\n  \t\t}\n  \t};\n\n  \tElement.prototype.findAll = function findAll(selector, query) {\n  \t\t// Add this node to the query, if applicable, and register the\n  \t\t// query on this element\n  \t\tvar matches = query.test(this.node);\n  \t\tif (matches) {\n  \t\t\tquery.add(this.node);\n  \t\t\tif (query.live) this.liveQueries.push(query);\n  \t\t}\n\n  \t\tif (this.fragment) {\n  \t\t\tthis.fragment.findAll(selector, query);\n  \t\t}\n  \t};\n\n  \tElement.prototype.findComponent = function findComponent(name) {\n  \t\tif (this.fragment) {\n  \t\t\treturn this.fragment.findComponent(name);\n  \t\t}\n  \t};\n\n  \tElement.prototype.findAllComponents = function findAllComponents(name, query) {\n  \t\tif (this.fragment) {\n  \t\t\tthis.fragment.findAllComponents(name, query);\n  \t\t}\n  \t};\n\n  \tElement.prototype.findNextNode = function findNextNode() {\n  \t\treturn null;\n  \t};\n\n  \tElement.prototype.firstNode = function firstNode() {\n  \t\treturn this.node;\n  \t};\n\n  \tElement.prototype.getAttribute = function getAttribute(name) {\n  \t\tvar attribute = this.attributeByName[name];\n  \t\treturn attribute ? attribute.getValue() : undefined;\n  \t};\n\n  \tElement.prototype.rebind = function rebind() {\n  \t\tthis.attributes.forEach(_rebind);\n  \t\tthis.conditionalAttributes.forEach(_rebind);\n  \t\tthis.eventHandlers.forEach(_rebind);\n  \t\tif (this.decorator) this.decorator.rebind();\n  \t\tif (this.fragment) this.fragment.rebind();\n  \t\tif (this.binding) this.binding.rebind();\n\n  \t\tthis.liveQueries.forEach(makeDirty$1);\n  \t};\n\n  \tElement.prototype.render = function render(target, occupants) {\n  \t\tvar _this2 = this;\n\n  \t\t// TODO determine correct namespace\n  \t\tthis.namespace = getNamespace(this);\n\n  \t\tvar node = undefined;\n  \t\tvar existing = false;\n\n  \t\tif (occupants) {\n  \t\t\tvar n = undefined;\n  \t\t\twhile (n = occupants.shift()) {\n  \t\t\t\tif (n.nodeName === this.template.e.toUpperCase() && n.namespaceURI === this.namespace) {\n  \t\t\t\t\tthis.node = node = n;\n  \t\t\t\t\texisting = true;\n  \t\t\t\t\tbreak;\n  \t\t\t\t} else {\n  \t\t\t\t\tdetachNode(n);\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\tif (!node) {\n  \t\t\tnode = createElement(this.template.e, this.namespace, this.getAttribute('is'));\n  \t\t\tthis.node = node;\n  \t\t}\n\n  \t\tvar context = this.parentFragment.findContext();\n\n  \t\tdefineProperty(node, '_ractive', {\n  \t\t\tvalue: {\n  \t\t\t\tproxy: this,\n  \t\t\t\tractive: this.ractive,\n  \t\t\t\tfragment: this.parentFragment,\n  \t\t\t\tcontext: context,\n  \t\t\t\tkeypath: context.getKeypath()\n  \t\t\t}\n  \t\t});\n\n  \t\t// Is this a top-level node of a component? If so, we may need to add\n  \t\t// a data-ractive-css attribute, for CSS encapsulation\n  \t\tif (this.parentFragment.cssIds) {\n  \t\t\tnode.setAttribute('data-ractive-css', this.parentFragment.cssIds.map(function (x) {\n  \t\t\t\treturn '{' + x + '}';\n  \t\t\t}).join(' '));\n  \t\t}\n\n  \t\tif (this.fragment) {\n  \t\t\tvar children = existing ? toArray(node.childNodes) : undefined;\n  \t\t\tthis.fragment.render(node, children);\n\n  \t\t\t// clean up leftover children\n  \t\t\tif (children) {\n  \t\t\t\tchildren.forEach(detachNode);\n  \t\t\t}\n  \t\t}\n\n  \t\tif (existing) {\n  \t\t\t// store initial values for two-way binding\n  \t\t\tif (this.binding && this.binding.wasUndefined) this.binding.setFromNode(node);\n\n  \t\t\t// remove unused attributes\n  \t\t\tvar i = node.attributes.length;\n  \t\t\twhile (i--) {\n  \t\t\t\tvar _name = node.attributes[i].name;\n  \t\t\t\tif (!this.template.a || !(_name in this.template.a)) node.removeAttribute(_name);\n  \t\t\t}\n  \t\t}\n\n  \t\tthis.attributes.forEach(_render);\n  \t\tthis.conditionalAttributes.forEach(_render);\n\n  \t\tif (this.decorator) runloop.scheduleTask(function () {\n  \t\t\treturn _this2.decorator.render();\n  \t\t}, true);\n  \t\tif (this.binding) this.binding.render();\n\n  \t\tthis.eventHandlers.forEach(_render);\n\n  \t\tupdateLiveQueries$1(this);\n\n  \t\t// transitions\n  \t\tvar transitionTemplate = this.template.t0 || this.template.t1;\n  \t\tif (transitionTemplate && this.ractive.transitionsEnabled) {\n  \t\t\tvar transition = new Transition(this, transitionTemplate, true);\n  \t\t\trunloop.registerTransition(transition);\n\n  \t\t\tthis._introTransition = transition; // so we can abort if it gets removed\n  \t\t}\n\n  \t\tif (!existing) {\n  \t\t\ttarget.appendChild(node);\n  \t\t}\n\n  \t\tthis.rendered = true;\n  \t};\n\n  \tElement.prototype.toString = function toString() {\n  \t\tvar tagName = this.template.e;\n\n  \t\tvar attrs = this.attributes.map(stringifyAttribute).join('') + this.conditionalAttributes.map(stringifyAttribute).join('');\n\n  \t\t// Special case - selected options\n  \t\tif (this.name === 'option' && this.isSelected()) {\n  \t\t\tattrs += ' selected';\n  \t\t}\n\n  \t\t// Special case - two-way radio name bindings\n  \t\tif (this.name === 'input' && inputIsCheckedRadio(this)) {\n  \t\t\tattrs += ' checked';\n  \t\t}\n\n  \t\tvar str = '<' + tagName + attrs + '>';\n\n  \t\tif (this.isVoid) return str;\n\n  \t\t// Special case - textarea\n  \t\tif (this.name === 'textarea' && this.getAttribute('value') !== undefined) {\n  \t\t\tstr += escapeHtml(this.getAttribute('value'));\n  \t\t}\n\n  \t\t// Special case - contenteditable\n  \t\telse if (this.getAttribute('contenteditable') !== undefined) {\n  \t\t\t\tstr += this.getAttribute('value') || '';\n  \t\t\t}\n\n  \t\tif (this.fragment) {\n  \t\t\tstr += this.fragment.toString(!/^(?:script|style)$/i.test(this.template.e)); // escape text unless script/style\n  \t\t}\n\n  \t\tstr += '</' + tagName + '>';\n  \t\treturn str;\n  \t};\n\n  \tElement.prototype.unbind = function unbind() {\n  \t\tthis.attributes.forEach(_unbind);\n  \t\tthis.conditionalAttributes.forEach(_unbind);\n\n  \t\tif (this.decorator) this.decorator.unbind();\n  \t\tif (this.fragment) this.fragment.unbind();\n  \t};\n\n  \tElement.prototype.unrender = function unrender(shouldDestroy) {\n  \t\tif (!this.rendered) return;\n  \t\tthis.rendered = false;\n\n  \t\t// unrendering before intro completed? complete it now\n  \t\t// TODO should be an API for aborting transitions\n  \t\tvar transition = this._introTransition;\n  \t\tif (transition) transition.complete();\n\n  \t\t// Detach as soon as we can\n  \t\tif (this.name === 'option') {\n  \t\t\t// <option> elements detach immediately, so that\n  \t\t\t// their parent <select> element syncs correctly, and\n  \t\t\t// since option elements can't have transitions anyway\n  \t\t\tthis.detach();\n  \t\t} else if (shouldDestroy) {\n  \t\t\trunloop.detachWhenReady(this);\n  \t\t}\n\n  \t\tif (this.fragment) this.fragment.unrender();\n\n  \t\tthis.eventHandlers.forEach(_unrender);\n\n  \t\tif (this.binding) this.binding.unrender();\n  \t\tif (!shouldDestroy && this.decorator) this.decorator.unrender();\n\n  \t\t// outro transition\n  \t\tvar transitionTemplate = this.template.t0 || this.template.t2;\n  \t\tif (transitionTemplate && this.ractive.transitionsEnabled) {\n  \t\t\tvar _transition = new Transition(this, transitionTemplate, false);\n  \t\t\trunloop.registerTransition(_transition);\n  \t\t}\n\n  \t\t// special case\n  \t\tvar id = this.attributeByName.id;\n  \t\tif (id) {\n  \t\t\tdelete this.ractive.nodes[id.getValue()];\n  \t\t}\n\n  \t\tremoveFromLiveQueries(this);\n  \t\t// TODO forms are a special case\n  \t};\n\n  \tElement.prototype.update = function update() {\n  \t\tif (this.dirty) {\n  \t\t\tthis.attributes.forEach(_update);\n  \t\t\tthis.conditionalAttributes.forEach(_update);\n  \t\t\tthis.eventHandlers.forEach(_update);\n\n  \t\t\tif (this.decorator) this.decorator.update();\n  \t\t\tif (this.fragment) this.fragment.update();\n\n  \t\t\tthis.dirty = false;\n  \t\t}\n  \t};\n\n  \treturn Element;\n  })(Item);\n\n  function inputIsCheckedRadio(element) {\n  \tvar attributes = element.attributeByName;\n\n  \tvar typeAttribute = attributes.type;\n  \tvar valueAttribute = attributes.value;\n  \tvar nameAttribute = attributes.name;\n\n  \tif (!typeAttribute || typeAttribute.value !== 'radio' || !valueAttribute || !nameAttribute.interpolator) {\n  \t\treturn;\n  \t}\n\n  \tif (valueAttribute.getValue() === nameAttribute.interpolator.model.get()) {\n  \t\treturn true;\n  \t}\n  }\n\n  function stringifyAttribute(attribute) {\n  \tvar str = attribute.toString();\n  \treturn str ? ' ' + str : '';\n  }\n\n  function removeFromLiveQueries(element) {\n  \tvar i = element.liveQueries.length;\n  \twhile (i--) {\n  \t\tvar query = element.liveQueries[i];\n  \t\tquery.remove(element.node);\n  \t}\n  }\n\n  function getNamespace(element) {\n  \t// Use specified namespace...\n  \tvar xmlns = element.getAttribute('xmlns');\n  \tif (xmlns) return xmlns;\n\n  \t// ...or SVG namespace, if this is an <svg> element\n  \tif (element.name === 'svg') return svg$1;\n\n  \tvar parent = element.parent;\n\n  \tif (parent) {\n  \t\t// ...or HTML, if the parent is a <foreignObject>\n  \t\tif (parent.name === 'foreignobject') return html;\n\n  \t\t// ...or inherit from the parent node\n  \t\treturn parent.node.namespaceURI;\n  \t}\n\n  \treturn element.ractive.el.namespaceURI;\n  }\n\n  var Input = (function (_Element) {\n  \tinherits(Input, _Element);\n\n  \tfunction Input() {\n  \t\tclassCallCheck(this, Input);\n\n  \t\t_Element.apply(this, arguments);\n  \t}\n\n  \tInput.prototype.render = function render(target, occupants) {\n  \t\t_Element.prototype.render.call(this, target, occupants);\n  \t\tthis.node.defaultValue = this.node.value;\n  \t};\n\n  \treturn Input;\n  })(Element);\n\n  var Textarea = (function (_Input) {\n  \tinherits(Textarea, _Input);\n\n  \tfunction Textarea(options) {\n  \t\tclassCallCheck(this, Textarea);\n\n  \t\tvar template = options.template;\n\n  \t\t// if there is a bindable value, there should be no body\n  \t\tif (template.a && template.a.value && isBindable({ template: template.a.value })) {\n  \t\t\toptions.noContent = true;\n  \t\t}\n\n  \t\t// otherwise, if there is a single bindable interpolator as content, move it to the value attr\n  \t\telse if (template.f && (!template.a || !template.a.value) && isBindable({ template: template.f })) {\n  \t\t\t\tif (!template.a) template.a = {};\n  \t\t\t\ttemplate.a.value = template.f;\n  \t\t\t\toptions.noContent = true;\n  \t\t\t}\n\n  \t\t_Input.call(this, options);\n  \t}\n\n  \tTextarea.prototype.bubble = function bubble() {\n  \t\tvar _this = this;\n\n  \t\tif (!this.dirty) {\n  \t\t\tthis.dirty = true;\n\n  \t\t\tif (this.rendered && !this.binding && this.fragment) {\n  \t\t\t\trunloop.scheduleTask(function () {\n  \t\t\t\t\t_this.dirty = false;\n  \t\t\t\t\t_this.node.value = _this.fragment.toString();\n  \t\t\t\t});\n  \t\t\t}\n\n  \t\t\tthis.parentFragment.bubble(); // default behaviour\n  \t\t}\n  \t};\n\n  \treturn Textarea;\n  })(Input);\n\n  function valueContains(selectValue, optionValue) {\n  \tvar i = selectValue.length;\n  \twhile (i--) {\n  \t\tif (selectValue[i] == optionValue) return true;\n  \t}\n  }\n\n  var Select = (function (_Element) {\n  \tinherits(Select, _Element);\n\n  \tfunction Select(options) {\n  \t\tclassCallCheck(this, Select);\n\n  \t\t_Element.call(this, options);\n  \t\tthis.options = [];\n  \t}\n\n  \tSelect.prototype.bubble = function bubble() {\n  \t\tvar _this = this;\n\n  \t\tif (!this.dirty) {\n  \t\t\tthis.dirty = true;\n\n  \t\t\tif (this.rendered) {\n  \t\t\t\trunloop.scheduleTask(function () {\n  \t\t\t\t\t_this.sync();\n  \t\t\t\t\t_this.dirty = false;\n  \t\t\t\t});\n  \t\t\t}\n\n  \t\t\tthis.parentFragment.bubble(); // default behaviour\n  \t\t}\n  \t};\n\n  \tSelect.prototype.render = function render(target, occupants) {\n  \t\t_Element.prototype.render.call(this, target, occupants);\n  \t\tthis.sync();\n\n  \t\tvar node = this.node;\n\n  \t\tvar i = node.options.length;\n  \t\twhile (i--) {\n  \t\t\tnode.options[i].defaultSelected = node.options[i].selected;\n  \t\t}\n\n  \t\tthis.rendered = true;\n  \t};\n\n  \tSelect.prototype.sync = function sync() {\n  \t\tvar selectNode = this.node;\n\n  \t\tif (!selectNode) return;\n\n  \t\tvar options = toArray(selectNode.options);\n\n  \t\tvar selectValue = this.getAttribute('value');\n  \t\tvar isMultiple = this.getAttribute('multiple');\n\n  \t\t// If the <select> has a specified value, that should override\n  \t\t// these options\n  \t\tif (selectValue !== undefined) {\n  \t\t\tvar optionWasSelected = undefined;\n\n  \t\t\toptions.forEach(function (o) {\n  \t\t\t\tvar optionValue = o._ractive ? o._ractive.value : o.value;\n  \t\t\t\tvar shouldSelect = isMultiple ? valueContains(selectValue, optionValue) : selectValue == optionValue;\n\n  \t\t\t\tif (shouldSelect) {\n  \t\t\t\t\toptionWasSelected = true;\n  \t\t\t\t}\n\n  \t\t\t\to.selected = shouldSelect;\n  \t\t\t});\n\n  \t\t\tif (!optionWasSelected && !isMultiple) {\n  \t\t\t\tif (options[0]) {\n  \t\t\t\t\toptions[0].selected = true;\n  \t\t\t\t}\n\n  \t\t\t\tif (this.binding) {\n  \t\t\t\t\tthis.binding.forceUpdate();\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\t// Otherwise the value should be initialised according to which\n  \t\t// <option> element is selected, if twoway binding is in effect\n  \t\telse if (this.binding) {\n  \t\t\t\tthis.binding.forceUpdate();\n  \t\t\t}\n  \t};\n\n  \tSelect.prototype.update = function update() {\n  \t\t_Element.prototype.update.call(this);\n  \t\tthis.sync();\n  \t};\n\n  \treturn Select;\n  })(Element);\n\n  function findParentSelect(element) {\n  \twhile (element) {\n  \t\tif (element.name === 'select') return element;\n  \t\telement = element.parent;\n  \t}\n  }\n\n  var Option = (function (_Element) {\n  \tinherits(Option, _Element);\n\n  \tfunction Option(options) {\n  \t\tclassCallCheck(this, Option);\n\n  \t\tvar template = options.template;\n  \t\tif (!template.a) template.a = {};\n\n  \t\t// If the value attribute is missing, use the element's content,\n  \t\t// as long as it isn't disabled\n  \t\tif (template.a.value === undefined && !('disabled' in template)) {\n  \t\t\ttemplate.a.value = template.f || '';\n  \t\t}\n\n  \t\t_Element.call(this, options);\n\n  \t\tthis.select = findParentSelect(this.parent);\n  \t}\n\n  \tOption.prototype.bind = function bind() {\n  \t\tif (!this.select) {\n  \t\t\t_Element.prototype.bind.call(this);\n  \t\t\treturn;\n  \t\t}\n\n  \t\t// If the select has a value, it overrides the `selected` attribute on\n  \t\t// this option - so we delete the attribute\n  \t\tvar selectedAttribute = this.attributeByName.selected;\n  \t\tif (selectedAttribute && this.select.getAttribute('value') !== undefined) {\n  \t\t\tvar index = this.attributes.indexOf(selectedAttribute);\n  \t\t\tthis.attributes.splice(index, 1);\n  \t\t\tdelete this.attributeByName.selected;\n  \t\t}\n\n  \t\t_Element.prototype.bind.call(this);\n  \t\tthis.select.options.push(this);\n  \t};\n\n  \tOption.prototype.isSelected = function isSelected() {\n  \t\tvar optionValue = this.getAttribute('value');\n\n  \t\tif (optionValue === undefined || !this.select) {\n  \t\t\treturn false;\n  \t\t}\n\n  \t\tvar selectValue = this.select.getAttribute('value');\n\n  \t\tif (selectValue == optionValue) {\n  \t\t\treturn true;\n  \t\t}\n\n  \t\tif (this.select.getAttribute('multiple') && isArray(selectValue)) {\n  \t\t\tvar i = selectValue.length;\n  \t\t\twhile (i--) {\n  \t\t\t\tif (selectValue[i] == optionValue) {\n  \t\t\t\t\treturn true;\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tOption.prototype.unbind = function unbind() {\n  \t\t_Element.prototype.unbind.call(this);\n\n  \t\tif (this.select) {\n  \t\t\tremoveFromArray(this.select.options, this);\n  \t\t}\n  \t};\n\n  \treturn Option;\n  })(Element);\n\n  var Form = (function (_Element) {\n  \tinherits(Form, _Element);\n\n  \tfunction Form(options) {\n  \t\tclassCallCheck(this, Form);\n\n  \t\t_Element.call(this, options);\n  \t\tthis.formBindings = [];\n  \t}\n\n  \tForm.prototype.render = function render(target, occupants) {\n  \t\t_Element.prototype.render.call(this, target, occupants);\n  \t\tthis.node.addEventListener('reset', handleReset, false);\n  \t};\n\n  \tForm.prototype.unrender = function unrender() {\n  \t\tthis.node.removeEventListener('reset', handleReset, false);\n  \t};\n\n  \treturn Form;\n  })(Element);\n\n  function handleReset() {\n  \tvar element = this._ractive.proxy;\n\n  \trunloop.start();\n  \telement.formBindings.forEach(updateModel);\n  \trunloop.end();\n  }\n\n  function updateModel(binding) {\n  \tbinding.model.set(binding.resetValue);\n  }\n\n  function processWrapper (wrapper, array, methodName, newIndices) {\n  \tvar __model = wrapper.__model;\n\n  \tif (newIndices) {\n  \t\t__model.shuffle(newIndices);\n  \t} else {\n  \t\t// If this is a sort or reverse, we just do root.set()...\n  \t\t// TODO use merge logic?\n  \t\t//root.viewmodel.mark( keypath );\n  \t}\n  }\n\n  var mutatorMethods = ['pop', 'push', 'reverse', 'shift', 'sort', 'splice', 'unshift'];\n  var patchedArrayProto = [];\n\n  mutatorMethods.forEach(function (methodName) {\n  \tvar method = function () {\n  \t\tfor (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n  \t\t\targs[_key] = arguments[_key];\n  \t\t}\n\n  \t\tvar newIndices = getNewIndices(this.length, methodName, args);\n\n  \t\t// apply the underlying method\n  \t\tvar result = Array.prototype[methodName].apply(this, arguments);\n\n  \t\t// trigger changes\n  \t\trunloop.start();\n\n  \t\tthis._ractive.setting = true;\n  \t\tvar i = this._ractive.wrappers.length;\n  \t\twhile (i--) {\n  \t\t\tprocessWrapper(this._ractive.wrappers[i], this, methodName, newIndices);\n  \t\t}\n\n  \t\trunloop.end();\n\n  \t\tthis._ractive.setting = false;\n  \t\treturn result;\n  \t};\n\n  \tdefineProperty(patchedArrayProto, methodName, {\n  \t\tvalue: method\n  \t});\n  });\n\n  var patchArrayMethods = undefined;\n  var unpatchArrayMethods = undefined;\n\n  // can we use prototype chain injection?\n  // http://perfectionkills.com/how-ecmascript-5-still-does-not-allow-to-subclass-an-array/#wrappers_prototype_chain_injection\n  if (({}).__proto__) {\n  \t// yes, we can\n  \tpatchArrayMethods = function (array) {\n  \t\treturn array.__proto__ = patchedArrayProto;\n  \t};\n  \tunpatchArrayMethods = function (array) {\n  \t\treturn array.__proto__ = Array.prototype;\n  \t};\n  } else {\n  \t// no, we can't\n  \tpatchArrayMethods = function (array) {\n  \t\tvar i = mutatorMethods.length;\n  \t\twhile (i--) {\n  \t\t\tvar methodName = mutatorMethods[i];\n  \t\t\tdefineProperty(array, methodName, {\n  \t\t\t\tvalue: patchedArrayProto[methodName],\n  \t\t\t\tconfigurable: true\n  \t\t\t});\n  \t\t}\n  \t};\n\n  \tunpatchArrayMethods = function (array) {\n  \t\tvar i = mutatorMethods.length;\n  \t\twhile (i--) {\n  \t\t\tdelete array[mutatorMethods[i]];\n  \t\t}\n  \t};\n  }\n\n  patchArrayMethods.unpatch = unpatchArrayMethods; // TODO export separately?\n  var patch = patchArrayMethods;\n\n  var errorMessage = 'Something went wrong in a rather interesting way';\n\n  var arrayAdaptor = {\n  \tfilter: function (object) {\n  \t\t// wrap the array if a) b) it's an array, and b) either it hasn't been wrapped already,\n  \t\t// or the array didn't trigger the get() itself\n  \t\treturn isArray(object) && (!object._ractive || !object._ractive.setting);\n  \t},\n  \twrap: function (ractive, array, keypath) {\n  \t\treturn new ArrayWrapper(ractive, array, keypath);\n  \t}\n  };\n\n  var ArrayWrapper = (function () {\n  \tfunction ArrayWrapper(ractive, array) {\n  \t\tclassCallCheck(this, ArrayWrapper);\n\n  \t\tthis.root = ractive;\n  \t\tthis.value = array;\n  \t\tthis.__model = null; // filled in later\n\n  \t\t// if this array hasn't already been ractified, ractify it\n  \t\tif (!array._ractive) {\n  \t\t\t// define a non-enumerable _ractive property to store the wrappers\n  \t\t\tdefineProperty(array, '_ractive', {\n  \t\t\t\tvalue: {\n  \t\t\t\t\twrappers: [],\n  \t\t\t\t\tinstances: [],\n  \t\t\t\t\tsetting: false\n  \t\t\t\t},\n  \t\t\t\tconfigurable: true\n  \t\t\t});\n\n  \t\t\tpatch(array);\n  \t\t}\n\n  \t\t// store the ractive instance, so we can handle transitions later\n  \t\tif (!array._ractive.instances[ractive._guid]) {\n  \t\t\tarray._ractive.instances[ractive._guid] = 0;\n  \t\t\tarray._ractive.instances.push(ractive);\n  \t\t}\n\n  \t\tarray._ractive.instances[ractive._guid] += 1;\n  \t\tarray._ractive.wrappers.push(this);\n  \t}\n\n  \tArrayWrapper.prototype.get = function get() {\n  \t\treturn this.value;\n  \t};\n\n  \tArrayWrapper.prototype.teardown = function teardown() {\n  \t\tvar array, storage, wrappers, instances, index;\n\n  \t\tarray = this.value;\n  \t\tstorage = array._ractive;\n  \t\twrappers = storage.wrappers;\n  \t\tinstances = storage.instances;\n\n  \t\t// if teardown() was invoked because we're clearing the cache as a result of\n  \t\t// a change that the array itself triggered, we can save ourselves the teardown\n  \t\t// and immediate setup\n  \t\tif (storage.setting) {\n  \t\t\treturn false; // so that we don't remove it from cached wrappers\n  \t\t}\n\n  \t\tindex = wrappers.indexOf(this);\n  \t\tif (index === -1) {\n  \t\t\tthrow new Error(errorMessage);\n  \t\t}\n\n  \t\twrappers.splice(index, 1);\n\n  \t\t// if nothing else depends on this array, we can revert it to its\n  \t\t// natural state\n  \t\tif (!wrappers.length) {\n  \t\t\tdelete array._ractive;\n  \t\t\tpatch.unpatch(this.value);\n  \t\t} else {\n  \t\t\t// remove ractive instance if possible\n  \t\t\tinstances[this.root._guid] -= 1;\n  \t\t\tif (!instances[this.root._guid]) {\n  \t\t\t\tindex = instances.indexOf(this.root);\n\n  \t\t\t\tif (index === -1) {\n  \t\t\t\t\tthrow new Error(errorMessage);\n  \t\t\t\t}\n\n  \t\t\t\tinstances.splice(index, 1);\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \treturn ArrayWrapper;\n  })();\n\n  var magicAdaptor = undefined;\n\n  try {\n  \tObject.defineProperty({}, 'test', { value: 0 });\n\n  \tmagicAdaptor = {\n  \t\tfilter: function (value) {\n  \t\t\treturn value && typeof value === 'object';\n  \t\t},\n  \t\twrap: function (ractive, value, keypath) {\n  \t\t\treturn new MagicWrapper(ractive, value, keypath);\n  \t\t}\n  \t};\n  } catch (err) {\n  \tmagicAdaptor = false;\n  }\n\n  var magicAdaptor$1 = magicAdaptor;\n\n  function createOrWrapDescriptor(originalDescriptor, ractive, keypath) {\n  \tif (originalDescriptor.set && originalDescriptor.set.__magic) {\n  \t\toriginalDescriptor.set.__magic.dependants.push({ ractive: ractive, keypath: keypath });\n  \t\treturn originalDescriptor;\n  \t}\n\n  \tvar setting = undefined;\n\n  \tvar dependants = [{ ractive: ractive, keypath: keypath }];\n\n  \tvar descriptor = {\n  \t\tget: function () {\n  \t\t\treturn 'value' in originalDescriptor ? originalDescriptor.value : originalDescriptor.get();\n  \t\t},\n  \t\tset: function (value) {\n  \t\t\tif (setting) return;\n\n  \t\t\tif ('value' in originalDescriptor) {\n  \t\t\t\toriginalDescriptor.value = value;\n  \t\t\t} else {\n  \t\t\t\toriginalDescriptor.set(value);\n  \t\t\t}\n\n  \t\t\tsetting = true;\n  \t\t\tdependants.forEach(function (_ref) {\n  \t\t\t\tvar ractive = _ref.ractive;\n  \t\t\t\tvar keypath = _ref.keypath;\n\n  \t\t\t\tractive.set(keypath, value);\n  \t\t\t});\n  \t\t\tsetting = false;\n  \t\t},\n  \t\tenumerable: true\n  \t};\n\n  \tdescriptor.set.__magic = { dependants: dependants, originalDescriptor: originalDescriptor };\n\n  \treturn descriptor;\n  }\n\n  function revert(descriptor, ractive, keypath) {\n  \tif (!descriptor.set || !descriptor.set.__magic) return true;\n\n  \tvar dependants = descriptor.set.__magic;\n  \tvar i = dependants.length;\n  \twhile (i--) {\n  \t\tvar dependant = dependants[i];\n  \t\tif (dependant.ractive === ractive && dependant.keypath === keypath) {\n  \t\t\tdependants.splice(i, 1);\n  \t\t\treturn false;\n  \t\t}\n  \t}\n  }\n\n  var MagicWrapper = (function () {\n  \tfunction MagicWrapper(ractive, value, keypath) {\n  \t\tvar _this = this;\n\n  \t\tclassCallCheck(this, MagicWrapper);\n\n  \t\tthis.ractive = ractive;\n  \t\tthis.value = value;\n  \t\tthis.keypath = keypath;\n\n  \t\tthis.originalDescriptors = {};\n\n  \t\t// wrap all properties with getters\n  \t\tObject.keys(value).forEach(function (key) {\n  \t\t\tvar originalDescriptor = Object.getOwnPropertyDescriptor(_this.value, key);\n  \t\t\t_this.originalDescriptors[key] = originalDescriptor;\n\n  \t\t\tvar childKeypath = keypath ? keypath + '.' + escapeKey(key) : escapeKey(key);\n\n  \t\t\tvar descriptor = createOrWrapDescriptor(originalDescriptor, ractive, childKeypath);\n\n  \t\t\tObject.defineProperty(_this.value, key, descriptor);\n  \t\t});\n  \t}\n\n  \tMagicWrapper.prototype.get = function get() {\n  \t\treturn this.value;\n  \t};\n\n  \tMagicWrapper.prototype.reset = function reset() {\n  \t\tthrow new Error('TODO magic adaptor reset'); // does this ever happen?\n  \t};\n\n  \tMagicWrapper.prototype.set = function set(key, value) {\n  \t\tthis.value[key] = value;\n  \t};\n\n  \tMagicWrapper.prototype.teardown = function teardown() {\n  \t\tvar _this2 = this;\n\n  \t\tObject.keys(this.value).forEach(function (key) {\n  \t\t\tvar descriptor = Object.getOwnPropertyDescriptor(_this2.value, key);\n  \t\t\tif (!descriptor.set || !descriptor.set.__magic) return;\n\n  \t\t\trevert(descriptor);\n\n  \t\t\tif (descriptor.set.__magic.dependants.length === 1) {\n  \t\t\t\tObject.defineProperty(_this2.value, key, descriptor.set.__magic.originalDescriptor);\n  \t\t\t}\n  \t\t});\n  \t};\n\n  \treturn MagicWrapper;\n  })();\n\n  var MagicArrayWrapper = (function () {\n  \tfunction MagicArrayWrapper(ractive, array, keypath) {\n  \t\tclassCallCheck(this, MagicArrayWrapper);\n\n  \t\tthis.value = array;\n\n  \t\tthis.magic = true;\n\n  \t\tthis.magicWrapper = magicAdaptor$1.wrap(ractive, array, keypath);\n  \t\tthis.arrayWrapper = arrayAdaptor.wrap(ractive, array, keypath);\n\n  \t\t// ugh, this really is a terrible hack\n  \t\tObject.defineProperty(this, '__model', {\n  \t\t\tget: function () {\n  \t\t\t\treturn this.arrayWrapper.__model;\n  \t\t\t},\n  \t\t\tset: function (model) {\n  \t\t\t\tthis.arrayWrapper.__model = model;\n  \t\t\t}\n  \t\t});\n  \t}\n\n  \tMagicArrayWrapper.prototype.get = function get() {\n  \t\treturn this.value;\n  \t};\n\n  \tMagicArrayWrapper.prototype.teardown = function teardown() {\n  \t\tthis.arrayWrapper.teardown();\n  \t\tthis.magicWrapper.teardown();\n  \t};\n\n  \tMagicArrayWrapper.prototype.reset = function reset(value) {\n  \t\treturn this.magicWrapper.reset(value);\n  \t};\n\n  \treturn MagicArrayWrapper;\n  })();\n\n  var magicArrayAdaptor = {\n  \tfilter: function (object, keypath, ractive) {\n  \t\treturn magicAdaptor$1.filter(object, keypath, ractive) && arrayAdaptor.filter(object);\n  \t},\n\n  \twrap: function (ractive, array, keypath) {\n  \t\treturn new MagicArrayWrapper(ractive, array, keypath);\n  \t}\n  };\n\n  function validate(data) {\n  \t// Warn if userOptions.data is a non-POJO\n  \tif (data && data.constructor !== Object) {\n  \t\tif (typeof data === 'function') {\n  \t\t\t// TODO do we need to support this in the new Ractive() case?\n  \t\t} else if (typeof data !== 'object') {\n  \t\t\t\tfatal('data option must be an object or a function, `' + data + '` is not valid');\n  \t\t\t} else {\n  \t\t\t\twarnIfDebug('If supplied, options.data should be a plain JavaScript object - using a non-POJO as the root object may work, but is discouraged');\n  \t\t\t}\n  \t}\n  }\n\n  var dataConfigurator = {\n  \tname: 'data',\n\n  \textend: function (Parent, proto, options) {\n  \t\tvar key = undefined;\n  \t\tvar value = undefined;\n\n  \t\t// check for non-primitives, which could cause mutation-related bugs\n  \t\tif (options.data && isObject(options.data)) {\n  \t\t\tfor (key in options.data) {\n  \t\t\t\tvalue = options.data[key];\n\n  \t\t\t\tif (value && typeof value === 'object') {\n  \t\t\t\t\tif (isObject(value) || isArray(value)) {\n  \t\t\t\t\t\twarnIfDebug('Passing a `data` option with object and array properties to Ractive.extend() is discouraged, as mutating them is likely to cause bugs. Consider using a data function instead:\\n\\n  // this...\\n  data: function () {\\n    return {\\n      myObject: {}\\n    };\\n  })\\n\\n  // instead of this:\\n  data: {\\n    myObject: {}\\n  }');\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\tproto.data = combine$1(proto.data, options.data);\n  \t},\n\n  \tinit: function (Parent, ractive, options) {\n  \t\tvar result = combine$1(Parent.prototype.data, options.data);\n\n  \t\tif (typeof result === 'function') result = result.call(ractive);\n\n  \t\t// bind functions to the ractive instance at the top level,\n  \t\t// unless it's a non-POJO (in which case alarm bells should ring)\n  \t\tif (result && result.constructor === Object) {\n  \t\t\tfor (var prop in result) {\n  \t\t\t\tif (typeof result[prop] === 'function') result[prop] = bind(result[prop], ractive);\n  \t\t\t}\n  \t\t}\n\n  \t\treturn result || {};\n  \t},\n\n  \treset: function (ractive) {\n  \t\tvar result = this.init(ractive.constructor, ractive, ractive.viewmodel);\n  \t\tractive.viewmodel.root.set(result);\n  \t\treturn true;\n  \t}\n  };\n\n  function combine$1(parentValue, childValue) {\n  \tvalidate(childValue);\n\n  \tvar parentIsFn = typeof parentValue === 'function';\n  \tvar childIsFn = typeof childValue === 'function';\n\n  \t// Very important, otherwise child instance can become\n  \t// the default data object on Ractive or a component.\n  \t// then ractive.set() ends up setting on the prototype!\n  \tif (!childValue && !parentIsFn) {\n  \t\tchildValue = {};\n  \t}\n\n  \t// Fast path, where we just need to copy properties from\n  \t// parent to child\n  \tif (!parentIsFn && !childIsFn) {\n  \t\treturn fromProperties(childValue, parentValue);\n  \t}\n\n  \treturn function () {\n  \t\tvar child = childIsFn ? callDataFunction(childValue, this) : childValue;\n  \t\tvar parent = parentIsFn ? callDataFunction(parentValue, this) : parentValue;\n\n  \t\treturn fromProperties(child, parent);\n  \t};\n  }\n\n  function callDataFunction(fn, context) {\n  \tvar data = fn.call(context);\n\n  \tif (!data) return;\n\n  \tif (typeof data !== 'object') {\n  \t\tfatal('Data function must return an object');\n  \t}\n\n  \tif (data.constructor !== Object) {\n  \t\twarnOnceIfDebug('Data function returned something other than a plain JavaScript object. This might work, but is strongly discouraged');\n  \t}\n\n  \treturn data;\n  }\n\n  function fromProperties(primary, secondary) {\n  \tif (primary && secondary) {\n  \t\tfor (var key in secondary) {\n  \t\t\tif (!(key in primary)) {\n  \t\t\t\tprimary[key] = secondary[key];\n  \t\t\t}\n  \t\t}\n\n  \t\treturn primary;\n  \t}\n\n  \treturn primary || secondary;\n  }\n\n  // TODO this is probably a bit anal, maybe we should leave it out\n  function prettify(fnBody) {\n  \tvar lines = fnBody.replace(/^\\t+/gm, function (tabs) {\n  \t\treturn tabs.split('\\t').join('  ');\n  \t}).split('\\n');\n\n  \tvar minIndent = lines.length < 2 ? 0 : lines.slice(1).reduce(function (prev, line) {\n  \t\treturn Math.min(prev, /^\\s*/.exec(line)[0].length);\n  \t}, Infinity);\n\n  \treturn lines.map(function (line, i) {\n  \t\treturn '    ' + (i ? line.substring(minIndent) : line);\n  \t}).join('\\n');\n  }\n\n  // Ditto. This function truncates the stack to only include app code\n  function truncateStack(stack) {\n  \tif (!stack) return '';\n\n  \tvar lines = stack.split('\\n');\n  \tvar name = Computation.name + '.getValue';\n\n  \tvar truncated = [];\n\n  \tvar len = lines.length;\n  \tfor (var i = 1; i < len; i += 1) {\n  \t\tvar line = lines[i];\n\n  \t\tif (~line.indexOf(name)) {\n  \t\t\treturn truncated.join('\\n');\n  \t\t} else {\n  \t\t\ttruncated.push(line);\n  \t\t}\n  \t}\n  }\n\n  var Computation = (function (_Model) {\n  \tinherits(Computation, _Model);\n\n  \tfunction Computation(viewmodel, signature, key) {\n  \t\tclassCallCheck(this, Computation);\n\n  \t\t_Model.call(this, null, null);\n\n  \t\tthis.root = this.parent = viewmodel;\n  \t\tthis.signature = signature;\n  \t\tthis.key = key; // not actually used, but helps with debugging\n\n  \t\tthis.isReadonly = !this.signature.setter;\n\n  \t\tthis.context = viewmodel.computationContext;\n\n  \t\tthis.dependencies = [];\n\n  \t\tthis.children = [];\n  \t\tthis.childByKey = {};\n\n  \t\tthis.deps = [];\n\n  \t\tthis.boundsSensitive = true;\n  \t\tthis.dirty = true;\n  \t}\n\n  \tComputation.prototype.get = function get(shouldCapture) {\n  \t\tif (shouldCapture) capture(this);\n\n  \t\tif (this.dirty) {\n  \t\t\tthis.value = this.getValue();\n  \t\t\tthis.adapt();\n  \t\t\tthis.dirty = false;\n  \t\t}\n\n  \t\treturn this.value;\n  \t};\n\n  \tComputation.prototype.getValue = function getValue() {\n  \t\tstartCapturing();\n  \t\tvar result = undefined;\n\n  \t\ttry {\n  \t\t\tresult = this.signature.getter.call(this.context);\n  \t\t} catch (err) {\n  \t\t\twarnIfDebug('Failed to compute ' + this.getKeypath() + ': ' + (err.message || err));\n\n  \t\t\t// TODO this is all well and good in Chrome, but...\n  \t\t\t// ...also, should encapsulate this stuff better, and only\n  \t\t\t// show it if Ractive.DEBUG\n  \t\t\tif (console.groupCollapsed) console.groupCollapsed('%cshow details', 'color: rgb(82, 140, 224); font-weight: normal; text-decoration: underline;');\n  \t\t\tvar functionBody = prettify(this.signature.getterString);\n  \t\t\tvar stack = this.signature.getterUseStack ? '\\n\\n' + truncateStack(err.stack) : '';\n  \t\t\tconsole.error(err.name + ': ' + err.message + '\\n\\n' + functionBody + stack);\n  \t\t\tif (console.groupCollapsed) console.groupEnd();\n  \t\t}\n\n  \t\tvar dependencies = stopCapturing();\n  \t\tthis.setDependencies(dependencies);\n\n  \t\treturn result;\n  \t};\n\n  \tComputation.prototype.handleChange = function handleChange() {\n  \t\tthis.dirty = true;\n\n  \t\tthis.deps.forEach(_handleChange);\n  \t\tthis.children.forEach(_handleChange);\n  \t\tthis.clearUnresolveds(); // TODO same question as on Model - necessary for primitives?\n  \t};\n\n  \tComputation.prototype.joinKey = function joinKey(key) {\n  \t\tif (key === undefined || key === '') return this;\n\n  \t\tif (!this.childByKey.hasOwnProperty(key)) {\n  \t\t\tvar child = new ComputationChild(this, key);\n  \t\t\tthis.children.push(child);\n  \t\t\tthis.childByKey[key] = child;\n  \t\t}\n\n  \t\treturn this.childByKey[key];\n  \t};\n\n  \tComputation.prototype.mark = function mark() {\n  \t\tthis.handleChange();\n  \t};\n\n  \tComputation.prototype.set = function set(value) {\n  \t\tif (!this.signature.setter) {\n  \t\t\tthrow new Error('Cannot set read-only computed value \\'' + this.key + '\\'');\n  \t\t}\n\n  \t\tthis.signature.setter(value);\n  \t};\n\n  \tComputation.prototype.setDependencies = function setDependencies(dependencies) {\n  \t\t// unregister any soft dependencies we no longer have\n  \t\tvar i = this.dependencies.length;\n  \t\twhile (i--) {\n  \t\t\tvar model = this.dependencies[i];\n  \t\t\tif (! ~dependencies.indexOf(model)) model.unregister(this);\n  \t\t}\n\n  \t\t// and add any new ones\n  \t\ti = dependencies.length;\n  \t\twhile (i--) {\n  \t\t\tvar model = dependencies[i];\n  \t\t\tif (! ~this.dependencies.indexOf(model)) model.register(this);\n  \t\t}\n\n  \t\tthis.dependencies = dependencies;\n  \t};\n\n  \treturn Computation;\n  })(Model);\n\n  var RootModel = (function (_Model) {\n  \tinherits(RootModel, _Model);\n\n  \tfunction RootModel(options) {\n  \t\tclassCallCheck(this, RootModel);\n\n  \t\t_Model.call(this, null, null);\n\n  \t\t// TODO deprecate this\n  \t\tthis.changes = {};\n\n  \t\tthis.isRoot = true;\n  \t\tthis.root = this;\n  \t\tthis.ractive = options.ractive; // TODO sever this link\n\n  \t\tthis.value = options.data;\n  \t\tthis.adaptors = options.adapt;\n  \t\tthis.adapt();\n\n  \t\tthis.mappings = {};\n\n  \t\tthis.computationContext = options.ractive;\n  \t\tthis.computations = {};\n  \t}\n\n  \tRootModel.prototype.applyChanges = function applyChanges() {\n  \t\tthis._changeHash = {};\n  \t\tthis.flush();\n\n  \t\treturn this._changeHash;\n  \t};\n\n  \tRootModel.prototype.compute = function compute(key, signature) {\n  \t\tvar computation = new Computation(this, signature, key);\n  \t\tthis.computations[key] = computation;\n\n  \t\treturn computation;\n  \t};\n\n  \tRootModel.prototype.get = function get(shouldCapture) {\n  \t\tvar _this = this;\n\n  \t\tif (shouldCapture) capture(this);\n  \t\tvar result = extend({}, this.value);\n\n  \t\tObject.keys(this.mappings).forEach(function (key) {\n  \t\t\tresult[key] = _this.mappings[key].value;\n  \t\t});\n\n  \t\tObject.keys(this.computations).forEach(function (key) {\n  \t\t\tif (key[0] !== '@') {\n  \t\t\t\t// exclude template expressions\n  \t\t\t\tresult[key] = _this.computations[key].value;\n  \t\t\t}\n  \t\t});\n\n  \t\treturn result;\n  \t};\n\n  \tRootModel.prototype.getKeypath = function getKeypath() {\n  \t\treturn '';\n  \t};\n\n  \tRootModel.prototype.has = function has(key) {\n  \t\treturn key in this.mappings || key in this.computations || _Model.prototype.has.call(this, key);\n  \t};\n\n  \tRootModel.prototype.joinKey = function joinKey(key) {\n  \t\treturn this.mappings.hasOwnProperty(key) ? this.mappings[key] : this.computations.hasOwnProperty(key) ? this.computations[key] : _Model.prototype.joinKey.call(this, key);\n  \t};\n\n  \tRootModel.prototype.map = function map(localKey, origin) {\n  \t\t// TODO remapping\n  \t\tthis.mappings[localKey] = origin;\n  \t};\n\n  \tRootModel.prototype.set = function set(value) {\n  \t\t// TODO wrapping root node is a baaaad idea. We should prevent this\n  \t\tvar wrapper = this.wrapper;\n  \t\tif (wrapper) {\n  \t\t\tvar shouldTeardown = !wrapper.reset || wrapper.reset(value) === false;\n\n  \t\t\tif (shouldTeardown) {\n  \t\t\t\twrapper.teardown();\n  \t\t\t\tthis.wrapper = null;\n  \t\t\t\tthis.value = value;\n  \t\t\t\tthis.adapt();\n  \t\t\t}\n  \t\t} else {\n  \t\t\tthis.value = value;\n  \t\t\tthis.adapt();\n  \t\t}\n\n  \t\tthis.deps.forEach(_handleChange);\n  \t\tthis.children.forEach(_mark);\n  \t\tthis.clearUnresolveds(); // TODO do we need to do this with primitive values? if not, what about e.g. unresolved `length` property of null -> string?\n  \t};\n\n  \tRootModel.prototype.retrieve = function retrieve() {\n  \t\treturn this.value;\n  \t};\n\n  \tRootModel.prototype.update = function update() {\n  \t\t// noop\n  \t};\n\n  \tRootModel.prototype.updateFromBindings = function updateFromBindings(cascade) {\n  \t\tvar _this2 = this;\n\n  \t\t_Model.prototype.updateFromBindings.call(this, cascade);\n\n  \t\tif (cascade) {\n  \t\t\t// TODO computations as well?\n  \t\t\tObject.keys(this.mappings).forEach(function (key) {\n  \t\t\t\tvar model = _this2.mappings[key];\n  \t\t\t\tmodel.updateFromBindings(cascade);\n  \t\t\t});\n  \t\t}\n  \t};\n\n  \treturn RootModel;\n  })(Model);\n\n  var pattern = /\\$\\{([^\\}]+)\\}/g;\n\n  function createFunctionFromString(ractive, str) {\n  \tvar hasThis = undefined;\n\n  \tvar functionBody = 'return (' + str.replace(pattern, function (match, keypath) {\n  \t\thasThis = true;\n  \t\treturn '__ractive.get(\"' + keypath + '\")';\n  \t}) + ');';\n\n  \tif (hasThis) functionBody = 'var __ractive = this; ' + functionBody;\n\n  \tvar fn = new Function(functionBody);\n  \treturn hasThis ? fn.bind(ractive) : fn;\n  }\n  function getComputationSignature(ractive, key, signature) {\n  \tvar getter = undefined;\n  \tvar setter = undefined;\n\n  \t// useful for debugging\n  \tvar getterString = undefined;\n  \tvar getterUseStack = undefined;\n  \tvar setterString = undefined;\n\n  \tif (typeof signature === 'function') {\n  \t\tgetter = bind(signature, ractive);\n  \t\tgetterString = signature.toString();\n  \t\tgetterUseStack = true;\n  \t}\n\n  \tif (typeof signature === 'string') {\n  \t\tgetter = createFunctionFromString(ractive, signature);\n  \t\tgetterString = signature;\n  \t}\n\n  \tif (typeof signature === 'object') {\n  \t\tif (typeof signature.get === 'string') {\n  \t\t\tgetter = createFunctionFromString(ractive, signature.get);\n  \t\t\tgetterString = signature.get;\n  \t\t} else if (typeof signature.get === 'function') {\n  \t\t\tgetter = bind(signature.get, ractive);\n  \t\t\tgetterString = signature.get.toString();\n  \t\t\tgetterUseStack = true;\n  \t\t} else {\n  \t\t\tfatal('`%s` computation must have a `get()` method', key);\n  \t\t}\n\n  \t\tif (typeof signature.set === 'function') {\n  \t\t\tsetter = bind(signature.set, ractive);\n  \t\t\tsetterString = signature.set.toString();\n  \t\t}\n  \t}\n\n  \treturn {\n  \t\tgetter: getter,\n  \t\tsetter: setter,\n  \t\tgetterString: getterString,\n  \t\tsetterString: setterString,\n  \t\tgetterUseStack: getterUseStack\n  \t};\n  }\n\n  var constructHook = new Hook('construct');\n\n  var registryNames = ['adaptors', 'components', 'decorators', 'easing', 'events', 'interpolators', 'partials', 'transitions'];\n\n  var uid = 0;\n  function construct(ractive, options) {\n  \tif (Ractive.DEBUG) welcome();\n\n  \tinitialiseProperties(ractive);\n\n  \t// TODO remove this, eventually\n  \tdefineProperty(ractive, 'data', { get: deprecateRactiveData });\n\n  \t// TODO don't allow `onconstruct` with `new Ractive()`, there's no need for it\n  \tconstructHook.fire(ractive, options);\n\n  \t// Add registries\n  \tregistryNames.forEach(function (name) {\n  \t\tractive[name] = extend(create(ractive.constructor[name] || null), options[name]);\n  \t});\n\n  \t// Create a viewmodel\n  \tvar viewmodel = new RootModel({\n  \t\tadapt: getAdaptors(ractive, ractive.adapt, options),\n  \t\tdata: dataConfigurator.init(ractive.constructor, ractive, options),\n  \t\tractive: ractive\n  \t});\n\n  \tractive.viewmodel = viewmodel;\n\n  \t// Add computed properties\n  \tvar computed = extend(create(ractive.constructor.prototype.computed), options.computed);\n\n  \tfor (var key in computed) {\n  \t\tvar signature = getComputationSignature(ractive, key, computed[key]);\n  \t\tviewmodel.compute(key, signature);\n  \t}\n  }\n\n  function combine(a, b) {\n  \tvar c = a.slice();\n  \tvar i = b.length;\n\n  \twhile (i--) {\n  \t\tif (! ~c.indexOf(b[i])) {\n  \t\t\tc.push(b[i]);\n  \t\t}\n  \t}\n\n  \treturn c;\n  }\n\n  function getAdaptors(ractive, protoAdapt, options) {\n  \tprotoAdapt = protoAdapt.map(lookup);\n  \tvar adapt = ensureArray(options.adapt).map(lookup);\n\n  \tadapt = combine(protoAdapt, adapt);\n\n  \tvar magic = 'magic' in options ? options.magic : ractive.magic;\n  \tvar modifyArrays = 'modifyArrays' in options ? options.modifyArrays : ractive.modifyArrays;\n\n  \tif (magic) {\n  \t\tif (!magicSupported) {\n  \t\t\tthrow new Error('Getters and setters (magic mode) are not supported in this browser');\n  \t\t}\n\n  \t\tif (modifyArrays) {\n  \t\t\tadapt.push(magicArrayAdaptor);\n  \t\t}\n\n  \t\tadapt.push(magicAdaptor$1);\n  \t}\n\n  \tif (modifyArrays) {\n  \t\tadapt.push(arrayAdaptor);\n  \t}\n\n  \treturn adapt;\n\n  \tfunction lookup(adaptor) {\n  \t\tif (typeof adaptor === 'string') {\n  \t\t\tadaptor = findInViewHierarchy('adaptors', ractive, adaptor);\n\n  \t\t\tif (!adaptor) {\n  \t\t\t\tfatal(missingPlugin(adaptor, 'adaptor'));\n  \t\t\t}\n  \t\t}\n\n  \t\treturn adaptor;\n  \t}\n  }\n\n  function initialiseProperties(ractive) {\n  \t// Generate a unique identifier, for places where you'd use a weak map if it\n  \t// existed\n  \tractive._guid = 'r-' + uid++;\n\n  \t// events\n  \tractive._subs = create(null);\n\n  \t// storage for item configuration from instantiation to reset,\n  \t// like dynamic functions or original values\n  \tractive._config = {};\n\n  \t// nodes registry\n  \tractive.nodes = {};\n\n  \t// events\n  \tractive.event = null;\n  \tractive._eventQueue = [];\n\n  \t// live queries\n  \tractive._liveQueries = [];\n  \tractive._liveComponentQueries = [];\n\n  \t// observers\n  \tractive._observers = [];\n\n  \tif (!ractive.component) {\n  \t\tractive.root = ractive;\n  \t\tractive.parent = ractive.container = null; // TODO container still applicable?\n  \t}\n  }\n\n  function deprecateRactiveData() {\n  \tthrow new Error('Using `ractive.data` is no longer supported - you must use the `ractive.get()` API instead');\n  }\n\n  function getChildQueue(queue, ractive) {\n  \treturn queue[ractive._guid] || (queue[ractive._guid] = []);\n  }\n\n  function fire(hookQueue, ractive) {\n  \tvar childQueue = getChildQueue(hookQueue.queue, ractive);\n\n  \thookQueue.hook.fire(ractive);\n\n  \t// queue is \"live\" because components can end up being\n  \t// added while hooks fire on parents that modify data values.\n  \twhile (childQueue.length) {\n  \t\tfire(hookQueue, childQueue.shift());\n  \t}\n\n  \tdelete hookQueue.queue[ractive._guid];\n  }\n\n  var HookQueue = (function () {\n  \tfunction HookQueue(event) {\n  \t\tclassCallCheck(this, HookQueue);\n\n  \t\tthis.hook = new Hook(event);\n  \t\tthis.inProcess = {};\n  \t\tthis.queue = {};\n  \t}\n\n  \tHookQueue.prototype.begin = function begin(ractive) {\n  \t\tthis.inProcess[ractive._guid] = true;\n  \t};\n\n  \tHookQueue.prototype.end = function end(ractive) {\n  \t\tvar parent = ractive.parent;\n\n  \t\t// If this is *isn't* a child of a component that's in process,\n  \t\t// it should call methods or fire at this point\n  \t\tif (!parent || !this.inProcess[parent._guid]) {\n  \t\t\tfire(this, ractive);\n  \t\t}\n  \t\t// elsewise, handoff to parent to fire when ready\n  \t\telse {\n  \t\t\t\tgetChildQueue(this.queue, parent).push(ractive);\n  \t\t\t}\n\n  \t\tdelete this.inProcess[ractive._guid];\n  \t};\n\n  \treturn HookQueue;\n  })();\n\n  var css;\n  var update;\n  var styleElement;\n  var head$1;\n  var styleSheet;\n  var inDom;\n  var prefix$1 = '/* Ractive.js component styles */\\n';\n  var styles = [];\n  var dirty = false;\n  if (!doc) {\n  \t// TODO handle encapsulated CSS in server-rendered HTML!\n  \tcss = {\n  \t\tadd: noop,\n  \t\tapply: noop\n  \t};\n  } else {\n  \tstyleElement = doc.createElement('style');\n  \tstyleElement.type = 'text/css';\n\n  \thead$1 = doc.getElementsByTagName('head')[0];\n\n  \tinDom = false;\n\n  \t// Internet Exploder won't let you use styleSheet.innerHTML - we have to\n  \t// use styleSheet.cssText instead\n  \tstyleSheet = styleElement.styleSheet;\n\n  \tupdate = function () {\n  \t\tvar css = prefix$1 + styles.map(function (s) {\n  \t\t\treturn '\\n/* {' + s.id + '} */\\n' + s.styles;\n  \t\t}).join('\\n');\n\n  \t\tif (styleSheet) {\n  \t\t\tstyleSheet.cssText = css;\n  \t\t} else {\n  \t\t\tstyleElement.innerHTML = css;\n  \t\t}\n\n  \t\tif (!inDom) {\n  \t\t\thead$1.appendChild(styleElement);\n  \t\t\tinDom = true;\n  \t\t}\n  \t};\n\n  \tcss = {\n  \t\tadd: function (s) {\n  \t\t\tstyles.push(s);\n  \t\t\tdirty = true;\n  \t\t},\n\n  \t\tapply: function () {\n  \t\t\tif (dirty) {\n  \t\t\t\tupdate();\n  \t\t\t\tdirty = false;\n  \t\t\t}\n  \t\t}\n  \t};\n  }\n\n  var css$1 = css;\n\n  var selectorsPattern = /(?:^|\\})?\\s*([^\\{\\}]+)\\s*\\{/g;\n  var commentsPattern = /\\/\\*.*?\\*\\//g;\n  var selectorUnitPattern = /((?:(?:\\[[^\\]+]\\])|(?:[^\\s\\+\\>~:]))+)((?::[^\\s\\+\\>\\~\\(:]+(?:\\([^\\)]+\\))?)*\\s*[\\s\\+\\>\\~]?)\\s*/g;\n  var excludePattern = /^(?:@|\\d+%)/;\n  var dataRvcGuidPattern = /\\[data-ractive-css~=\"\\{[a-z0-9-]+\\}\"]/g;\n\n  function trim$1(str) {\n  \treturn str.trim();\n  }\n\n  function extractString(unit) {\n  \treturn unit.str;\n  }\n\n  function transformSelector(selector, parent) {\n  \tvar selectorUnits = [];\n  \tvar match = undefined;\n\n  \twhile (match = selectorUnitPattern.exec(selector)) {\n  \t\tselectorUnits.push({\n  \t\t\tstr: match[0],\n  \t\t\tbase: match[1],\n  \t\t\tmodifiers: match[2]\n  \t\t});\n  \t}\n\n  \t// For each simple selector within the selector, we need to create a version\n  \t// that a) combines with the id, and b) is inside the id\n  \tvar base = selectorUnits.map(extractString);\n\n  \tvar transformed = [];\n  \tvar i = selectorUnits.length;\n\n  \twhile (i--) {\n  \t\tvar appended = base.slice();\n\n  \t\t// Pseudo-selectors should go after the attribute selector\n  \t\tvar unit = selectorUnits[i];\n  \t\tappended[i] = unit.base + parent + unit.modifiers || '';\n\n  \t\tvar prepended = base.slice();\n  \t\tprepended[i] = parent + ' ' + prepended[i];\n\n  \t\ttransformed.push(appended.join(' '), prepended.join(' '));\n  \t}\n\n  \treturn transformed.join(', ');\n  }\n  function transformCss(css, id) {\n  \tvar dataAttr = '[data-ractive-css~=\"{' + id + '}\"]';\n\n  \tvar transformed = undefined;\n\n  \tif (dataRvcGuidPattern.test(css)) {\n  \t\ttransformed = css.replace(dataRvcGuidPattern, dataAttr);\n  \t} else {\n  \t\ttransformed = css.replace(commentsPattern, '').replace(selectorsPattern, function (match, $1) {\n  \t\t\t// don't transform at-rules and keyframe declarations\n  \t\t\tif (excludePattern.test($1)) return match;\n\n  \t\t\tvar selectors = $1.split(',').map(trim$1);\n  \t\t\tvar transformed = selectors.map(function (selector) {\n  \t\t\t\treturn transformSelector(selector, dataAttr);\n  \t\t\t}).join(', ') + ' ';\n\n  \t\t\treturn match.replace($1, transformed);\n  \t\t});\n  \t}\n\n  \treturn transformed;\n  }\n\n  var uid$1 = 1;\n\n  var cssConfigurator = {\n  \tname: 'css',\n\n  \textend: function (Parent, proto, options) {\n  \t\tif (options.css) {\n  \t\t\tvar id = uid$1++;\n  \t\t\tvar styles = options.noCssTransform ? options.css : transformCss(options.css, id);\n\n  \t\t\tproto.cssId = id;\n  \t\t\tcss$1.add({ id: id, styles: styles });\n  \t\t}\n  \t},\n\n  \tinit: function () {}\n  };\n\n  var adaptConfigurator = {\n  \textend: function (Parent, proto, options) {\n  \t\tproto.adapt = combine$3(proto.adapt, ensureArray(options.adapt));\n  \t},\n\n  \tinit: function () {}\n  };\n\n  function combine$3(a, b) {\n  \tvar c = a.slice();\n  \tvar i = b.length;\n\n  \twhile (i--) {\n  \t\tif (! ~c.indexOf(b[i])) {\n  \t\t\tc.push(b[i]);\n  \t\t}\n  \t}\n\n  \treturn c;\n  }\n\n  var registryNames$1 = ['adaptors', 'components', 'computed', 'decorators', 'easing', 'events', 'interpolators', 'partials', 'transitions'];\n\n  var Registry = (function () {\n  \tfunction Registry(name, useDefaults) {\n  \t\tclassCallCheck(this, Registry);\n\n  \t\tthis.name = name;\n  \t\tthis.useDefaults = useDefaults;\n  \t}\n\n  \tRegistry.prototype.extend = function extend(Parent, proto, options) {\n  \t\tthis.configure(this.useDefaults ? Parent.defaults : Parent, this.useDefaults ? proto : proto.constructor, options);\n  \t};\n\n  \tRegistry.prototype.init = function init() {\n  \t\t// noop\n  \t};\n\n  \tRegistry.prototype.configure = function configure(Parent, target, options) {\n  \t\tvar name = this.name;\n  \t\tvar option = options[name];\n\n  \t\tvar registry = create(Parent[name]);\n\n  \t\tfor (var key in option) {\n  \t\t\tregistry[key] = option[key];\n  \t\t}\n\n  \t\ttarget[name] = registry;\n  \t};\n\n  \tRegistry.prototype.reset = function reset(ractive) {\n  \t\tvar registry = ractive[this.name];\n  \t\tvar changed = false;\n\n  \t\tObject.keys(registry).forEach(function (key) {\n  \t\t\tvar item = registry[key];\n\n  \t\t\tif (item._fn) {\n  \t\t\t\tif (item._fn.isOwner) {\n  \t\t\t\t\tregistry[key] = item._fn;\n  \t\t\t\t} else {\n  \t\t\t\t\tdelete registry[key];\n  \t\t\t\t}\n  \t\t\t\tchanged = true;\n  \t\t\t}\n  \t\t});\n\n  \t\treturn changed;\n  \t};\n\n  \treturn Registry;\n  })();\n\n  var registries = registryNames$1.map(function (name) {\n  \treturn new Registry(name, name === 'computed');\n  });\n\n  function wrap(parent, name, method) {\n  \tif (!/_super/.test(method)) return method;\n\n  \tfunction wrapper() {\n  \t\tvar superMethod = getSuperMethod(wrapper._parent, name);\n  \t\tvar hasSuper = ('_super' in this);\n  \t\tvar oldSuper = this._super;\n\n  \t\tthis._super = superMethod;\n\n  \t\tvar result = method.apply(this, arguments);\n\n  \t\tif (hasSuper) {\n  \t\t\tthis._super = oldSuper;\n  \t\t} else {\n  \t\t\tdelete this._super;\n  \t\t}\n\n  \t\treturn result;\n  \t}\n\n  \twrapper._parent = parent;\n  \twrapper._method = method;\n\n  \treturn wrapper;\n  }\n\n  function getSuperMethod(parent, name) {\n  \tif (name in parent) {\n  \t\tvar _ret = (function () {\n  \t\t\tvar value = parent[name];\n\n  \t\t\treturn {\n  \t\t\t\tv: typeof value === 'function' ? value : function () {\n  \t\t\t\t\treturn value;\n  \t\t\t\t}\n  \t\t\t};\n  \t\t})();\n\n  \t\tif (typeof _ret === 'object') return _ret.v;\n  \t}\n\n  \treturn noop;\n  }\n\n  function getMessage(deprecated, correct, isError) {\n  \treturn 'options.' + deprecated + ' has been deprecated in favour of options.' + correct + '.' + (isError ? ' You cannot specify both options, please use options.' + correct + '.' : '');\n  }\n\n  function deprecateOption(options, deprecatedOption, correct) {\n  \tif (deprecatedOption in options) {\n  \t\tif (!(correct in options)) {\n  \t\t\twarnIfDebug(getMessage(deprecatedOption, correct));\n  \t\t\toptions[correct] = options[deprecatedOption];\n  \t\t} else {\n  \t\t\tthrow new Error(getMessage(deprecatedOption, correct, true));\n  \t\t}\n  \t}\n  }\n  function deprecate(options) {\n  \tdeprecateOption(options, 'beforeInit', 'onconstruct');\n  \tdeprecateOption(options, 'init', 'onrender');\n  \tdeprecateOption(options, 'complete', 'oncomplete');\n  \tdeprecateOption(options, 'eventDefinitions', 'events');\n\n  \t// Using extend with Component instead of options,\n  \t// like Human.extend( Spider ) means adaptors as a registry\n  \t// gets copied to options. So we have to check if actually an array\n  \tif (isArray(options.adaptors)) {\n  \t\tdeprecateOption(options, 'adaptors', 'adapt');\n  \t}\n  }\n\n  var custom = {\n  \tadapt: adaptConfigurator,\n  \tcss: cssConfigurator,\n  \tdata: dataConfigurator,\n  \ttemplate: templateConfigurator\n  };\n\n  var defaultKeys = Object.keys(defaults);\n\n  var isStandardKey = makeObj(defaultKeys.filter(function (key) {\n  \treturn !custom[key];\n  }));\n\n  // blacklisted keys that we don't double extend\n  var isBlacklisted = makeObj(defaultKeys.concat(registries.map(function (r) {\n  \treturn r.name;\n  })));\n\n  var order = [].concat(defaultKeys.filter(function (key) {\n  \treturn !registries[key] && !custom[key];\n  }), registries,\n  //custom.data,\n  custom.template, custom.css);\n\n  var config = {\n  \textend: function (Parent, proto, options) {\n  \t\treturn configure('extend', Parent, proto, options);\n  \t},\n\n  \tinit: function (Parent, ractive, options) {\n  \t\treturn configure('init', Parent, ractive, options);\n  \t},\n\n  \treset: function (ractive) {\n  \t\treturn order.filter(function (c) {\n  \t\t\treturn c.reset && c.reset(ractive);\n  \t\t}).map(function (c) {\n  \t\t\treturn c.name;\n  \t\t});\n  \t},\n\n  \t// this defines the order. TODO this isn't used anywhere in the codebase,\n  \t// only in the test suite - should get rid of it\n  \torder: order\n  };\n\n  function configure(method, Parent, target, options) {\n  \tdeprecate(options);\n\n  \tfor (var key in options) {\n  \t\tif (isStandardKey.hasOwnProperty(key)) {\n  \t\t\tvar value = options[key];\n\n  \t\t\t// warn the developer if they passed a function and ignore its value\n\n  \t\t\t// NOTE: we allow some functions on \"el\" because we duck type element lists\n  \t\t\t// and some libraries or ef'ed-up virtual browsers (phantomJS) return a\n  \t\t\t// function object as the result of querySelector methods\n  \t\t\tif (key !== 'el' && typeof value === 'function') {\n  \t\t\t\twarnIfDebug(key + ' is a Ractive option that does not expect a function and will be ignored', method === 'init' ? target : null);\n  \t\t\t} else {\n  \t\t\t\ttarget[key] = value;\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \t// disallow combination of `append` and `enhance`\n  \tif (options.append && options.enhance) {\n  \t\tthrow new Error('Cannot use append and enhance at the same time');\n  \t}\n\n  \tregistries.forEach(function (registry) {\n  \t\tregistry[method](Parent, target, options);\n  \t});\n\n  \tadaptConfigurator[method](Parent, target, options);\n  \ttemplateConfigurator[method](Parent, target, options);\n  \tcssConfigurator[method](Parent, target, options);\n\n  \textendOtherMethods(Parent.prototype, target, options);\n  }\n\n  function extendOtherMethods(parent, target, options) {\n  \tfor (var key in options) {\n  \t\tif (!isBlacklisted[key] && options.hasOwnProperty(key)) {\n  \t\t\tvar member = options[key];\n\n  \t\t\t// if this is a method that overwrites a method, wrap it:\n  \t\t\tif (typeof member === 'function') {\n  \t\t\t\tmember = wrap(parent, key, member);\n  \t\t\t}\n\n  \t\t\ttarget[key] = member;\n  \t\t}\n  \t}\n  }\n\n  function makeObj(array) {\n  \tvar obj = {};\n  \tarray.forEach(function (x) {\n  \t\treturn obj[x] = true;\n  \t});\n  \treturn obj;\n  }\n\n  var configHook = new Hook('config');\n  var initHook = new HookQueue('init');\n  function initialise(ractive, userOptions, options) {\n  \tObject.keys(ractive.viewmodel.computations).forEach(function (key) {\n  \t\tvar computation = ractive.viewmodel.computations[key];\n\n  \t\tif (ractive.viewmodel.value.hasOwnProperty(key)) {\n  \t\t\tcomputation.set(ractive.viewmodel.value[key]);\n  \t\t}\n  \t});\n\n  \t// init config from Parent and options\n  \tconfig.init(ractive.constructor, ractive, userOptions);\n\n  \tconfigHook.fire(ractive);\n  \tinitHook.begin(ractive);\n\n  \tvar fragment = undefined;\n\n  \t// Render virtual DOM\n  \tif (ractive.template) {\n  \t\tvar cssIds = undefined;\n\n  \t\tif (options.cssIds || ractive.cssId) {\n  \t\t\tcssIds = options.cssIds ? options.cssIds.slice() : [];\n\n  \t\t\tif (ractive.cssId) {\n  \t\t\t\tcssIds.push(ractive.cssId);\n  \t\t\t}\n  \t\t}\n\n  \t\tractive.fragment = fragment = new Fragment({\n  \t\t\towner: ractive,\n  \t\t\ttemplate: ractive.template,\n  \t\t\tcssIds: cssIds,\n  \t\t\tindexRefs: options.indexRefs || {},\n  \t\t\tkeyRefs: options.keyRefs || {}\n  \t\t}).bind(ractive.viewmodel);\n  \t}\n\n  \tinitHook.end(ractive);\n\n  \tif (fragment) {\n  \t\t// render automatically ( if `el` is specified )\n  \t\tvar el = getElement(ractive.el);\n  \t\tif (el) {\n  \t\t\tvar promise = ractive.render(el, ractive.append);\n\n  \t\t\tif (Ractive.DEBUG_PROMISES) {\n  \t\t\t\tpromise['catch'](function (err) {\n  \t\t\t\t\twarnOnceIfDebug('Promise debugging is enabled, to help solve errors that happen asynchronously. Some browsers will log unhandled promise rejections, in which case you can safely disable promise debugging:\\n  Ractive.DEBUG_PROMISES = false;');\n  \t\t\t\t\twarnIfDebug('An error happened during rendering', { ractive: ractive });\n  \t\t\t\t\terr.stack && logIfDebug(err.stack);\n\n  \t\t\t\t\tthrow err;\n  \t\t\t\t});\n  \t\t\t}\n  \t\t}\n  \t}\n  }\n\n  var renderHook$1 = new Hook('render');\n  var completeHook$1 = new Hook('complete');\n  function render(ractive, target, anchor, occupants) {\n  \t// if `noIntro` is `true`, temporarily disable transitions\n  \tvar transitionsEnabled = ractive.transitionsEnabled;\n  \tif (ractive.noIntro) ractive.transitionsEnabled = false;\n\n  \tvar promise = runloop.start(ractive, true);\n  \trunloop.scheduleTask(function () {\n  \t\treturn renderHook$1.fire(ractive);\n  \t}, true);\n\n  \tif (ractive.fragment.rendered) {\n  \t\tthrow new Error('You cannot call ractive.render() on an already rendered instance! Call ractive.unrender() first');\n  \t}\n\n  \tanchor = getElement(anchor) || ractive.anchor;\n\n  \tractive.el = target;\n  \tractive.anchor = anchor;\n\n  \t// ensure encapsulated CSS is up-to-date\n  \tif (ractive.cssId) css$1.apply();\n\n  \tif (target) {\n  \t\t(target.__ractive_instances__ || (target.__ractive_instances__ = [])).push(ractive);\n\n  \t\tif (anchor) {\n  \t\t\tvar docFrag = doc.createDocumentFragment();\n  \t\t\tractive.fragment.render(docFrag);\n  \t\t\ttarget.insertBefore(docFrag, anchor);\n  \t\t} else {\n  \t\t\tractive.fragment.render(target, occupants);\n  \t\t}\n  \t}\n\n  \trunloop.end();\n  \tractive.transitionsEnabled = transitionsEnabled;\n\n  \treturn promise.then(function () {\n  \t\treturn completeHook$1.fire(ractive);\n  \t});\n  }\n\n  var RactiveEvent = (function () {\n  \tfunction RactiveEvent(ractive, name) {\n  \t\tclassCallCheck(this, RactiveEvent);\n\n  \t\tthis.ractive = ractive;\n  \t\tthis.name = name;\n  \t\tthis.handler = null;\n  \t}\n\n  \tRactiveEvent.prototype.listen = function listen(directive) {\n  \t\tvar ractive = this.ractive;\n\n  \t\tthis.handler = ractive.on(this.name, function () {\n  \t\t\tvar event = undefined;\n\n  \t\t\t// semi-weak test, but what else? tag the event obj ._isEvent ?\n  \t\t\tif (arguments.length && arguments[0] && arguments[0].node) {\n  \t\t\t\tevent = Array.prototype.shift.call(arguments);\n  \t\t\t\tevent.component = ractive;\n  \t\t\t}\n\n  \t\t\tvar args = Array.prototype.slice.call(arguments);\n  \t\t\tdirective.fire(event, args);\n\n  \t\t\t// cancel bubbling\n  \t\t\treturn false;\n  \t\t});\n  \t};\n\n  \tRactiveEvent.prototype.unlisten = function unlisten() {\n  \t\tthis.handler.cancel();\n  \t};\n\n  \treturn RactiveEvent;\n  })();\n\n  // TODO it's unfortunate that this has to run every time a\n  // component is rendered... is there a better way?\n\n  function updateLiveQueries(component) {\n  \t// Does this need to be added to any live queries?\n  \tvar instance = component.ractive;\n\n  \tdo {\n  \t\tvar liveQueries = instance._liveComponentQueries;\n\n  \t\tvar i = liveQueries.length;\n  \t\twhile (i--) {\n  \t\t\tvar _name = liveQueries[i];\n  \t\t\tvar query = liveQueries[\"_\" + _name];\n\n  \t\t\tif (query.test(component)) {\n  \t\t\t\tquery.add(component.instance);\n  \t\t\t\t// keep register of applicable selectors, for when we teardown\n  \t\t\t\tcomponent.liveQueries.push(query);\n  \t\t\t}\n  \t\t}\n  \t} while (instance = instance.parent);\n  }\n\n  function removeFromLiveComponentQueries(component) {\n  \tvar instance = component.ractive;\n\n  \twhile (instance) {\n  \t\tvar query = instance._liveComponentQueries['_' + component.name];\n  \t\tif (query) query.remove(component);\n\n  \t\tinstance = instance.parent;\n  \t}\n  }\n\n  function makeDirty(query) {\n  \tquery.makeDirty();\n  }\n\n  var teardownHook$1 = new Hook('teardown');\n\n  var Component = (function (_Item) {\n  \tinherits(Component, _Item);\n\n  \tfunction Component(options, ComponentConstructor) {\n  \t\tclassCallCheck(this, Component);\n\n  \t\t_Item.call(this, options);\n  \t\tthis.type = COMPONENT; // override ELEMENT from super\n\n  \t\tvar instance = create(ComponentConstructor.prototype);\n\n  \t\tthis.instance = instance;\n  \t\tthis.name = options.template.e;\n  \t\tthis.parentFragment = options.parentFragment;\n  \t\tthis.complexMappings = [];\n\n  \t\tthis.liveQueries = [];\n\n  \t\tif (instance.el) {\n  \t\t\twarnIfDebug('The <' + this.name + '> component has a default \\'el\\' property; it has been disregarded');\n  \t\t}\n\n  \t\tvar partials = options.template.p || {};\n  \t\tif (!('content' in partials)) partials.content = options.template.f || [];\n  \t\tthis._partials = partials; // TEMP\n\n  \t\tthis.yielders = {};\n\n  \t\t// find container\n  \t\tvar fragment = options.parentFragment;\n  \t\tvar container = undefined;\n  \t\twhile (fragment) {\n  \t\t\tif (fragment.owner.type === YIELDER) {\n  \t\t\t\tcontainer = fragment.owner.container;\n  \t\t\t\tbreak;\n  \t\t\t}\n\n  \t\t\tfragment = fragment.parent;\n  \t\t}\n\n  \t\t// add component-instance-specific properties\n  \t\tinstance.parent = this.parentFragment.ractive;\n  \t\tinstance.container = container || null;\n  \t\tinstance.root = instance.parent.root;\n  \t\tinstance.component = this;\n\n  \t\tconstruct(this.instance, { partials: partials });\n\n  \t\t// for hackability, this could be an open option\n  \t\t// for any ractive instance, but for now, just\n  \t\t// for components and just for ractive...\n  \t\tinstance._inlinePartials = partials;\n\n  \t\tthis.eventHandlers = [];\n  \t\tif (this.template.v) this.setupEvents();\n  \t}\n\n  \tComponent.prototype.bind = function bind() {\n  \t\tvar _this = this;\n\n  \t\tvar viewmodel = this.instance.viewmodel;\n  \t\tvar childData = viewmodel.value;\n\n  \t\t// determine mappings\n  \t\tif (this.template.a) {\n  \t\t\tObject.keys(this.template.a).forEach(function (localKey) {\n  \t\t\t\tvar template = _this.template.a[localKey];\n  \t\t\t\tvar model = undefined;\n  \t\t\t\tvar fragment = undefined;\n\n  \t\t\t\tif (template === 0) {\n  \t\t\t\t\t// empty attributes are `true`\n  \t\t\t\t\tviewmodel.joinKey(localKey).set(true);\n  \t\t\t\t} else if (typeof template === 'string') {\n  \t\t\t\t\tvar parsed = parseJSON(template);\n  \t\t\t\t\tviewmodel.joinKey(localKey).set(parsed ? parsed.value : template);\n  \t\t\t\t} else if (isArray(template)) {\n  \t\t\t\t\tif (template.length === 1 && template[0].t === INTERPOLATOR) {\n  \t\t\t\t\t\tmodel = resolve$1(_this.parentFragment, template[0]);\n\n  \t\t\t\t\t\tif (!model) {\n  \t\t\t\t\t\t\twarnOnceIfDebug('The ' + localKey + '=\\'{{' + template[0].r + '}}\\' mapping is ambiguous, and may cause unexpected results. Consider initialising your data to eliminate the ambiguity', { ractive: _this.instance }); // TODO add docs page explaining this\n  \t\t\t\t\t\t\t_this.parentFragment.ractive.get(localKey); // side-effect: create mappings as necessary\n  \t\t\t\t\t\t\tmodel = _this.parentFragment.findContext().joinKey(localKey);\n  \t\t\t\t\t\t}\n\n  \t\t\t\t\t\tviewmodel.map(localKey, model);\n\n  \t\t\t\t\t\tif (model.get() === undefined && localKey in childData) {\n  \t\t\t\t\t\t\tmodel.set(childData[localKey]);\n  \t\t\t\t\t\t}\n  \t\t\t\t\t} else {\n  \t\t\t\t\t\tfragment = new Fragment({\n  \t\t\t\t\t\t\towner: _this,\n  \t\t\t\t\t\t\ttemplate: template\n  \t\t\t\t\t\t}).bind();\n\n  \t\t\t\t\t\tmodel = viewmodel.joinKey(localKey);\n  \t\t\t\t\t\tmodel.set(fragment.valueOf());\n\n  \t\t\t\t\t\t// this is a *bit* of a hack\n  \t\t\t\t\t\tfragment.bubble = function () {\n  \t\t\t\t\t\t\tFragment.prototype.bubble.call(fragment);\n  \t\t\t\t\t\t\tmodel.set(fragment.valueOf());\n  \t\t\t\t\t\t};\n\n  \t\t\t\t\t\t_this.complexMappings.push(fragment);\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t\t});\n  \t\t}\n\n  \t\tinitialise(this.instance, {\n  \t\t\tpartials: this._partials\n  \t\t}, {\n  \t\t\tindexRefs: this.instance.isolated ? {} : this.parentFragment.indexRefs,\n  \t\t\tkeyRefs: this.instance.isolated ? {} : this.parentFragment.keyRefs,\n  \t\t\tcssIds: this.parentFragment.cssIds\n  \t\t});\n\n  \t\tthis.eventHandlers.forEach(_bind);\n  \t};\n\n  \tComponent.prototype.bubble = function bubble() {\n  \t\tif (!this.dirty) {\n  \t\t\tthis.dirty = true;\n  \t\t\tthis.parentFragment.bubble();\n  \t\t}\n  \t};\n\n  \tComponent.prototype.checkYielders = function checkYielders() {\n  \t\tvar _this2 = this;\n\n  \t\tObject.keys(this.yielders).forEach(function (name) {\n  \t\t\tif (_this2.yielders[name].length > 1) {\n  \t\t\t\trunloop.end();\n  \t\t\t\tthrow new Error('A component template can only have one {{yield' + (name ? ' ' + name : '') + '}} declaration at a time');\n  \t\t\t}\n  \t\t});\n  \t};\n\n  \tComponent.prototype.detach = function detach() {\n  \t\treturn this.instance.fragment.detach();\n  \t};\n\n  \tComponent.prototype.find = function find(selector) {\n  \t\treturn this.instance.fragment.find(selector);\n  \t};\n\n  \tComponent.prototype.findAll = function findAll(selector, query) {\n  \t\tthis.instance.fragment.findAll(selector, query);\n  \t};\n\n  \tComponent.prototype.findComponent = function findComponent(name) {\n  \t\tif (!name || this.name === name) return this.instance;\n\n  \t\tif (this.instance.fragment) {\n  \t\t\treturn this.instance.fragment.findComponent(name);\n  \t\t}\n  \t};\n\n  \tComponent.prototype.findAllComponents = function findAllComponents(name, query) {\n  \t\tif (query.test(this)) {\n  \t\t\tquery.add(this.instance);\n\n  \t\t\tif (query.live) {\n  \t\t\t\tthis.liveQueries.push(query);\n  \t\t\t}\n  \t\t}\n\n  \t\tthis.instance.fragment.findAllComponents(name, query);\n  \t};\n\n  \tComponent.prototype.firstNode = function firstNode() {\n  \t\treturn this.instance.fragment.firstNode();\n  \t};\n\n  \tComponent.prototype.rebind = function rebind() {\n  \t\tvar _this3 = this;\n\n  \t\tthis.complexMappings.forEach(_rebind);\n\n  \t\tthis.liveQueries.forEach(makeDirty);\n\n  \t\t// update relevant mappings\n  \t\tvar viewmodel = this.instance.viewmodel;\n  \t\tviewmodel.mappings = {};\n\n  \t\tif (this.template.a) {\n  \t\t\tObject.keys(this.template.a).forEach(function (localKey) {\n  \t\t\t\tvar template = _this3.template.a[localKey];\n  \t\t\t\tvar model = undefined;\n\n  \t\t\t\tif (isArray(template) && template.length === 1 && template[0].t === INTERPOLATOR) {\n  \t\t\t\t\tmodel = resolve$1(_this3.parentFragment, template[0]);\n\n  \t\t\t\t\tif (!model) {\n  \t\t\t\t\t\t// TODO is this even possible?\n  \t\t\t\t\t\twarnOnceIfDebug('The ' + localKey + '=\\'{{' + template[0].r + '}}\\' mapping is ambiguous, and may cause unexpected results. Consider initialising your data to eliminate the ambiguity', { ractive: _this3.instance });\n  \t\t\t\t\t\t_this3.parentFragment.ractive.get(localKey); // side-effect: create mappings as necessary\n  \t\t\t\t\t\tmodel = _this3.parentFragment.findContext().joinKey(localKey);\n  \t\t\t\t\t}\n\n  \t\t\t\t\tviewmodel.map(localKey, model);\n  \t\t\t\t}\n  \t\t\t});\n  \t\t}\n\n  \t\tthis.instance.fragment.rebind(viewmodel);\n  \t};\n\n  \tComponent.prototype.render = function render$$(target, occupants) {\n  \t\trender(this.instance, target, null, occupants);\n\n  \t\tthis.checkYielders();\n  \t\tthis.eventHandlers.forEach(_render);\n  \t\tupdateLiveQueries(this);\n\n  \t\tthis.rendered = true;\n  \t};\n\n  \tComponent.prototype.setupEvents = function setupEvents() {\n  \t\tvar _this4 = this;\n\n  \t\tvar handlers = this.eventHandlers;\n\n  \t\tObject.keys(this.template.v).forEach(function (key) {\n  \t\t\tvar eventNames = key.split('-');\n  \t\t\tvar template = _this4.template.v[key];\n\n  \t\t\teventNames.forEach(function (eventName) {\n  \t\t\t\tvar event = new RactiveEvent(_this4.instance, eventName);\n  \t\t\t\thandlers.push(new EventDirective(_this4, event, template));\n  \t\t\t});\n  \t\t});\n  \t};\n\n  \tComponent.prototype.toString = function toString() {\n  \t\treturn this.instance.toHTML();\n  \t};\n\n  \tComponent.prototype.unbind = function unbind() {\n  \t\tthis.complexMappings.forEach(_unbind);\n\n  \t\tvar instance = this.instance;\n  \t\tinstance.viewmodel.teardown();\n  \t\tinstance.fragment.unbind();\n  \t\tinstance._observers.forEach(cancel);\n\n  \t\tremoveFromLiveComponentQueries(this);\n\n  \t\tif (instance.fragment.rendered && instance.el.__ractive_instances__) {\n  \t\t\tremoveFromArray(instance.el.__ractive_instances__, instance);\n  \t\t}\n\n  \t\tteardownHook$1.fire(instance);\n  \t};\n\n  \tComponent.prototype.unrender = function unrender(shouldDestroy) {\n  \t\tvar _this5 = this;\n\n  \t\tthis.shouldDestroy = shouldDestroy;\n  \t\tthis.instance.unrender();\n  \t\tthis.eventHandlers.forEach(_unrender);\n  \t\tthis.liveQueries.forEach(function (query) {\n  \t\t\treturn query.remove(_this5.instance);\n  \t\t});\n  \t};\n\n  \tComponent.prototype.update = function update() {\n  \t\tthis.instance.fragment.update();\n  \t\tthis.checkYielders();\n  \t\tthis.eventHandlers.forEach(_update);\n  \t\tthis.dirty = false;\n  \t};\n\n  \treturn Component;\n  })(Item);\n\n  var Text = (function (_Item) {\n  \tinherits(Text, _Item);\n\n  \tfunction Text(options) {\n  \t\tclassCallCheck(this, Text);\n\n  \t\t_Item.call(this, options);\n  \t\tthis.type = TEXT;\n  \t}\n\n  \tText.prototype.bind = function bind() {\n  \t\t// noop\n  \t};\n\n  \tText.prototype.detach = function detach() {\n  \t\treturn detachNode(this.node);\n  \t};\n\n  \tText.prototype.firstNode = function firstNode() {\n  \t\treturn this.node;\n  \t};\n\n  \tText.prototype.rebind = function rebind() {\n  \t\t// noop\n  \t};\n\n  \tText.prototype.render = function render(target, occupants) {\n  \t\tthis.rendered = true;\n\n  \t\tif (occupants) {\n  \t\t\tvar n = occupants[0];\n  \t\t\tif (n && n.nodeType === 3) {\n  \t\t\t\toccupants.shift();\n  \t\t\t\tif (n.nodeValue !== this.template) {\n  \t\t\t\t\tn.nodeValue = this.template;\n  \t\t\t\t}\n  \t\t\t} else {\n  \t\t\t\tn = this.node = doc.createTextNode(this.template);\n  \t\t\t\tif (occupants[0]) {\n  \t\t\t\t\ttarget.insertBefore(n, occupants[0]);\n  \t\t\t\t} else {\n  \t\t\t\t\ttarget.appendChild(n);\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\tthis.node = n;\n  \t\t} else {\n  \t\t\tthis.node = doc.createTextNode(this.template);\n  \t\t\ttarget.appendChild(this.node);\n  \t\t}\n  \t};\n\n  \tText.prototype.toString = function toString(escape) {\n  \t\treturn escape ? escapeHtml(this.template) : this.template;\n  \t};\n\n  \tText.prototype.unbind = function unbind() {\n  \t\t// noop\n  \t};\n\n  \tText.prototype.unrender = function unrender(shouldDestroy) {\n  \t\tif (this.rendered && shouldDestroy) this.detach();\n  \t\tthis.rendered = false;\n  \t};\n\n  \tText.prototype.update = function update() {\n  \t\t// noop\n  \t};\n\n  \tText.prototype.valueOf = function valueOf() {\n  \t\treturn this.template;\n  \t};\n\n  \treturn Text;\n  })(Item);\n\n  // finds the component constructor in the registry or view hierarchy registries\n\n  function getComponentConstructor(ractive, name) {\n  \tvar instance = findInstance('components', ractive, name);\n  \tvar Component = undefined;\n\n  \tif (instance) {\n  \t\tComponent = instance.components[name];\n\n  \t\t// best test we have for not Ractive.extend\n  \t\tif (!Component._Parent) {\n  \t\t\t// function option, execute and store for reset\n  \t\t\tvar fn = Component.bind(instance);\n  \t\t\tfn.isOwner = instance.components.hasOwnProperty(name);\n  \t\t\tComponent = fn();\n\n  \t\t\tif (!Component) {\n  \t\t\t\twarnIfDebug(noRegistryFunctionReturn, name, 'component', 'component', { ractive: ractive });\n  \t\t\t\treturn;\n  \t\t\t}\n\n  \t\t\tif (typeof Component === 'string') {\n  \t\t\t\t// allow string lookup\n  \t\t\t\tComponent = getComponentConstructor(ractive, Component);\n  \t\t\t}\n\n  \t\t\tComponent._fn = fn;\n  \t\t\tinstance.components[name] = Component;\n  \t\t}\n  \t}\n\n  \treturn Component;\n  }\n\n  var constructors = {};\n  constructors[ALIAS] = Alias;\n  constructors[DOCTYPE] = Doctype;\n  constructors[INTERPOLATOR] = Interpolator;\n  constructors[PARTIAL] = Partial;\n  constructors[SECTION] = Section;\n  constructors[TRIPLE] = Triple;\n  constructors[YIELDER] = Yielder;\n\n  var specialElements = {\n  \tdoctype: Doctype,\n  \tform: Form,\n  \tinput: Input,\n  \toption: Option,\n  \tselect: Select,\n  \ttextarea: Textarea\n  };\n  function createItem(options) {\n  \tif (typeof options.template === 'string') {\n  \t\treturn new Text(options);\n  \t}\n\n  \tif (options.template.t === ELEMENT) {\n  \t\t// could be component or element\n  \t\tvar ComponentConstructor = getComponentConstructor(options.parentFragment.ractive, options.template.e);\n  \t\tif (ComponentConstructor) {\n  \t\t\treturn new Component(options, ComponentConstructor);\n  \t\t}\n\n  \t\tvar tagName = options.template.e.toLowerCase();\n\n  \t\tvar ElementConstructor = specialElements[tagName] || Element;\n  \t\treturn new ElementConstructor(options);\n  \t}\n\n  \tvar Item = constructors[options.template.t];\n\n  \tif (!Item) throw new Error('Unrecognised item type ' + options.template.t);\n\n  \treturn new Item(options);\n  }\n\n  var ReferenceResolver = (function () {\n  \tfunction ReferenceResolver(fragment, reference, callback) {\n  \t\tclassCallCheck(this, ReferenceResolver);\n\n  \t\tthis.fragment = fragment;\n  \t\tthis.reference = normalise(reference);\n  \t\tthis.callback = callback;\n\n  \t\tthis.keys = splitKeypath(reference);\n  \t\tthis.resolved = false;\n\n  \t\t// TODO the consumer should take care of addUnresolved\n  \t\t// we attach to all the contexts between here and the root\n  \t\t// - whenever their values change, they can quickly\n  \t\t// check to see if we can resolve\n  \t\twhile (fragment) {\n  \t\t\tif (fragment.context) {\n  \t\t\t\tfragment.context.addUnresolved(this.keys[0], this);\n  \t\t\t}\n\n  \t\t\tfragment = fragment.componentParent || fragment.parent;\n  \t\t}\n  \t}\n\n  \tReferenceResolver.prototype.attemptResolution = function attemptResolution() {\n  \t\tif (this.resolved) return;\n\n  \t\tvar model = resolveAmbiguousReference(this.fragment, this.reference);\n\n  \t\tif (model) {\n  \t\t\tthis.resolved = true;\n  \t\t\tthis.callback(model);\n  \t\t}\n  \t};\n\n  \tReferenceResolver.prototype.forceResolution = function forceResolution() {\n  \t\tif (this.resolved) return;\n\n  \t\tvar model = this.fragment.findContext().joinAll(this.keys);\n  \t\tthis.callback(model);\n  \t\tthis.resolved = true;\n  \t};\n\n  \tReferenceResolver.prototype.unbind = function unbind() {\n  \t\tremoveFromArray(this.fragment.unresolved, this);\n  \t};\n\n  \treturn ReferenceResolver;\n  })();\n\n  // TODO all this code needs to die\n\n  function processItems(items, values, guid) {\n  \tvar counter = arguments.length <= 3 || arguments[3] === undefined ? 0 : arguments[3];\n\n  \treturn items.map(function (item) {\n  \t\tif (item.type === TEXT) {\n  \t\t\treturn item.template;\n  \t\t}\n\n  \t\tif (item.fragment) {\n  \t\t\tif (item.fragment.iterations) {\n  \t\t\t\treturn item.fragment.iterations.map(function (fragment) {\n  \t\t\t\t\treturn processItems(fragment.items, values, guid, counter);\n  \t\t\t\t}).join('');\n  \t\t\t} else {\n  \t\t\t\treturn processItems(item.fragment.items, values, guid, counter);\n  \t\t\t}\n  \t\t}\n\n  \t\tvar placeholderId = guid + '-' + counter++;\n\n  \t\tvalues[placeholderId] = item.model ? item.model.wrapper ? item.model.wrapper.value : item.model.get() : undefined;\n\n  \t\treturn '${' + placeholderId + '}';\n  \t}).join('');\n  }\n\n  function unrenderAndDestroy(item) {\n  \titem.unrender(true);\n  }\n\n  var Fragment = (function () {\n  \tfunction Fragment(options) {\n  \t\tclassCallCheck(this, Fragment);\n\n  \t\tthis.owner = options.owner; // The item that owns this fragment - an element, section, partial, or attribute\n\n  \t\tthis.isRoot = !options.owner.parentFragment;\n  \t\tthis.parent = this.isRoot ? null : this.owner.parentFragment;\n  \t\tthis.ractive = options.ractive || (this.isRoot ? options.owner : this.parent.ractive);\n\n  \t\tthis.componentParent = this.isRoot && this.ractive.component ? this.ractive.component.parentFragment : null;\n\n  \t\tthis.context = null;\n  \t\tthis.rendered = false;\n  \t\tthis.indexRefs = options.indexRefs || (this.parent ? this.parent.indexRefs : []);\n  \t\tthis.keyRefs = options.keyRefs || (this.parent ? this.parent.keyRefs : {});\n\n  \t\t// encapsulated styles should be inherited until they get applied by an element\n  \t\tthis.cssIds = 'cssIds' in options ? options.cssIds : this.parent ? this.parent.cssIds : null;\n\n  \t\tthis.resolvers = [];\n\n  \t\tthis.dirty = false;\n  \t\tthis.dirtyArgs = this.dirtyValue = true; // TODO getArgsList is nonsense - should deprecate legacy directives style\n\n  \t\tthis.template = options.template || [];\n  \t\tthis.createItems();\n  \t}\n\n  \tFragment.prototype.bind = function bind(context) {\n  \t\tthis.context = context;\n  \t\tthis.items.forEach(_bind);\n  \t\tthis.bound = true;\n\n  \t\t// in rare cases, a forced resolution (or similar) will cause the\n  \t\t// fragment to be dirty before it's even finished binding. In those\n  \t\t// cases we update immediately\n  \t\tif (this.dirty) this.update();\n\n  \t\treturn this;\n  \t};\n\n  \tFragment.prototype.bubble = function bubble() {\n  \t\tthis.dirtyArgs = this.dirtyValue = true;\n\n  \t\tif (!this.dirty) {\n  \t\t\tthis.dirty = true;\n\n  \t\t\tif (this.isRoot) {\n  \t\t\t\t// TODO encapsulate 'is component root, but not overall root' check?\n  \t\t\t\tif (this.ractive.component) {\n  \t\t\t\t\tthis.ractive.component.bubble();\n  \t\t\t\t} else if (this.bound) {\n  \t\t\t\t\trunloop.addFragment(this);\n  \t\t\t\t}\n  \t\t\t} else {\n  \t\t\t\tthis.owner.bubble();\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tFragment.prototype.createItems = function createItems() {\n  \t\tvar _this = this;\n\n  \t\tthis.items = this.template.map(function (template, index) {\n  \t\t\treturn createItem({ parentFragment: _this, template: template, index: index });\n  \t\t});\n  \t};\n\n  \tFragment.prototype.detach = function detach() {\n  \t\tvar docFrag = createDocumentFragment();\n  \t\tthis.items.forEach(function (item) {\n  \t\t\treturn docFrag.appendChild(item.detach());\n  \t\t});\n  \t\treturn docFrag;\n  \t};\n\n  \tFragment.prototype.find = function find(selector) {\n  \t\tvar len = this.items.length;\n  \t\tvar i = undefined;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tvar found = this.items[i].find(selector);\n  \t\t\tif (found) return found;\n  \t\t}\n  \t};\n\n  \tFragment.prototype.findAll = function findAll(selector, query) {\n  \t\tif (this.items) {\n  \t\t\tvar len = this.items.length;\n  \t\t\tvar i = undefined;\n\n  \t\t\tfor (i = 0; i < len; i += 1) {\n  \t\t\t\tvar item = this.items[i];\n\n  \t\t\t\tif (item.findAll) {\n  \t\t\t\t\titem.findAll(selector, query);\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\treturn query;\n  \t};\n\n  \tFragment.prototype.findComponent = function findComponent(name) {\n  \t\tvar len = this.items.length;\n  \t\tvar i = undefined;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tvar found = this.items[i].findComponent(name);\n  \t\t\tif (found) return found;\n  \t\t}\n  \t};\n\n  \tFragment.prototype.findAllComponents = function findAllComponents(name, query) {\n  \t\tif (this.items) {\n  \t\t\tvar len = this.items.length;\n  \t\t\tvar i = undefined;\n\n  \t\t\tfor (i = 0; i < len; i += 1) {\n  \t\t\t\tvar item = this.items[i];\n\n  \t\t\t\tif (item.findAllComponents) {\n  \t\t\t\t\titem.findAllComponents(name, query);\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\treturn query;\n  \t};\n\n  \tFragment.prototype.findContext = function findContext() {\n  \t\tvar fragment = this;\n  \t\twhile (!fragment.context) fragment = fragment.parent;\n  \t\treturn fragment.context;\n  \t};\n\n  \tFragment.prototype.findNextNode = function findNextNode(item) {\n  \t\tvar nextItem = this.items[item.index + 1];\n\n  \t\tif (nextItem) return nextItem.firstNode();\n\n  \t\t// if this is the root fragment, and there are no more items,\n  \t\t// it means we're at the end...\n  \t\tif (this.isRoot) {\n  \t\t\tif (this.ractive.component) {\n  \t\t\t\treturn this.ractive.component.parentFragment.findNextNode(this.ractive.component);\n  \t\t\t}\n\n  \t\t\t// TODO possible edge case with other content\n  \t\t\t// appended to this.ractive.el?\n  \t\t\treturn null;\n  \t\t}\n\n  \t\treturn this.owner.findNextNode(this); // the argument is in case the parent is a RepeatedFragment\n  \t};\n\n  \tFragment.prototype.findParentNode = function findParentNode() {\n  \t\tvar fragment = this;\n\n  \t\tdo {\n  \t\t\tif (fragment.owner.type === ELEMENT) {\n  \t\t\t\treturn fragment.owner.node;\n  \t\t\t}\n\n  \t\t\tif (fragment.isRoot && !fragment.ractive.component) {\n  \t\t\t\t// TODO encapsulate check\n  \t\t\t\treturn fragment.ractive.el;\n  \t\t\t}\n\n  \t\t\tfragment = fragment.componentParent || fragment.parent; // TODO ugh\n  \t\t} while (fragment);\n\n  \t\tthrow new Error('Could not find parent node'); // TODO link to issue tracker\n  \t};\n\n  \tFragment.prototype.findRepeatingFragment = function findRepeatingFragment() {\n  \t\tvar fragment = this;\n  \t\t// TODO better check than fragment.parent.iterations\n  \t\twhile (fragment.parent && !fragment.isIteration) {\n  \t\t\tfragment = fragment.parent || fragment.componentParent;\n  \t\t}\n\n  \t\treturn fragment;\n  \t};\n\n  \tFragment.prototype.firstNode = function firstNode() {\n  \t\tvar node = undefined;\n  \t\tfor (var i = 0; i < this.items.length; i++) {\n  \t\t\tnode = this.items[i].firstNode();\n\n  \t\t\tif (node) {\n  \t\t\t\treturn node;\n  \t\t\t}\n  \t\t}\n  \t\treturn this.parent.findNextNode(this.owner);\n  \t};\n\n  \t// TODO ideally, this would be deprecated in favour of an\n  \t// expression-like approach\n\n  \tFragment.prototype.getArgsList = function getArgsList() {\n  \t\tif (this.dirtyArgs) {\n  \t\t\tvar values = {};\n  \t\t\tvar source = processItems(this.items, values, this.ractive._guid);\n  \t\t\tvar parsed = parseJSON('[' + source + ']', values);\n\n  \t\t\tthis.argsList = parsed ? parsed.value : [this.toString()];\n\n  \t\t\tthis.dirtyArgs = false;\n  \t\t}\n\n  \t\treturn this.argsList;\n  \t};\n\n  \tFragment.prototype.rebind = function rebind(context) {\n  \t\tthis.context = context;\n\n  \t\tthis.items.forEach(_rebind);\n  \t};\n\n  \tFragment.prototype.render = function render(target, occupants) {\n  \t\tif (this.rendered) throw new Error('Fragment is already rendered!');\n  \t\tthis.rendered = true;\n\n  \t\tthis.items.forEach(function (item) {\n  \t\t\treturn item.render(target, occupants);\n  \t\t});\n  \t};\n\n  \tFragment.prototype.resetTemplate = function resetTemplate(template) {\n  \t\tvar wasBound = this.bound;\n  \t\tvar wasRendered = this.rendered;\n\n  \t\t// TODO ensure transitions are disabled globally during reset\n\n  \t\tif (wasBound) {\n  \t\t\tif (wasRendered) this.unrender(true);\n  \t\t\tthis.unbind();\n  \t\t}\n\n  \t\tthis.template = template;\n  \t\tthis.createItems();\n\n  \t\tif (wasBound) {\n  \t\t\tthis.bind(this.context);\n\n  \t\t\tif (wasRendered) {\n  \t\t\t\tvar parentNode = this.findParentNode();\n  \t\t\t\tvar anchor = this.parent ? this.parent.findNextNode(this.owner) : null;\n\n  \t\t\t\tif (anchor) {\n  \t\t\t\t\tvar docFrag = createDocumentFragment();\n  \t\t\t\t\tthis.render(docFrag);\n  \t\t\t\t\tparentNode.insertBefore(docFrag, anchor);\n  \t\t\t\t} else {\n  \t\t\t\t\tthis.render(parentNode);\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tFragment.prototype.resolve = function resolve(template, callback) {\n  \t\tif (!this.context) {\n  \t\t\treturn this.parent.resolve(template, callback);\n  \t\t}\n\n  \t\tvar resolver = new ReferenceResolver(this, template, callback);\n  \t\tthis.resolvers.push(resolver);\n\n  \t\treturn resolver; // so we can e.g. force resolution\n  \t};\n\n  \tFragment.prototype.toHtml = function toHtml() {\n  \t\treturn this.toString();\n  \t};\n\n  \tFragment.prototype.toString = function toString(escape) {\n  \t\treturn this.items.map(escape ? toEscapedString : _toString).join('');\n  \t};\n\n  \tFragment.prototype.unbind = function unbind() {\n  \t\tthis.items.forEach(_unbind);\n  \t\tthis.bound = false;\n\n  \t\treturn this;\n  \t};\n\n  \tFragment.prototype.unrender = function unrender(shouldDestroy) {\n  \t\tthis.items.forEach(shouldDestroy ? unrenderAndDestroy : _unrender);\n  \t\tthis.rendered = false;\n  \t};\n\n  \tFragment.prototype.update = function update() {\n  \t\tif (this.dirty) {\n  \t\t\tthis.items.forEach(_update);\n  \t\t\tthis.dirty = false;\n  \t\t}\n  \t};\n\n  \tFragment.prototype.valueOf = function valueOf() {\n  \t\tif (this.items.length === 1) {\n  \t\t\treturn this.items[0].valueOf();\n  \t\t}\n\n  \t\tif (this.dirtyValue) {\n  \t\t\tvar values = {};\n  \t\t\tvar source = processItems(this.items, values, this.ractive._guid);\n  \t\t\tvar parsed = parseJSON(source, values);\n\n  \t\t\tthis.value = parsed ? parsed.value : this.toString();\n\n  \t\t\tthis.dirtyValue = false;\n  \t\t}\n\n  \t\treturn this.value;\n  \t};\n\n  \treturn Fragment;\n  })();\n\n  // TODO should resetTemplate be asynchronous? i.e. should it be a case\n  // of outro, update template, intro? I reckon probably not, since that\n  // could be achieved with unrender-resetTemplate-render. Also, it should\n  // conceptually be similar to resetPartial, which couldn't be async\n\n  function Ractive$resetTemplate(template) {\n  \ttemplateConfigurator.init(null, this, { template: template });\n\n  \tvar transitionsEnabled = this.transitionsEnabled;\n  \tthis.transitionsEnabled = false;\n\n  \t// Is this is a component, we need to set the `shouldDestroy`\n  \t// flag, otherwise it will assume by default that a parent node\n  \t// will be detached, and therefore it doesn't need to bother\n  \t// detaching its own nodes\n  \tvar component = this.component;\n  \tif (component) component.shouldDestroy = true;\n  \tthis.unrender();\n  \tif (component) component.shouldDestroy = false;\n\n  \t// remove existing fragment and create new one\n  \tthis.fragment.unbind();\n  \tthis.fragment = new Fragment({\n  \t\ttemplate: this.template,\n  \t\troot: this,\n  \t\towner: this\n  \t});\n  \tthis.fragment.bind(this.viewmodel);\n\n  \tthis.render(this.el, this.anchor);\n\n  \tthis.transitionsEnabled = transitionsEnabled;\n  }\n\n  function collect(source, name, dest) {\n  \tsource.forEach(function (item) {\n  \t\t// queue to rerender if the item is a partial and the current name matches\n  \t\tif (item.type === PARTIAL && (item.refName === name || item.name === name)) {\n  \t\t\tdest.push(item);\n  \t\t\treturn; // go no further\n  \t\t}\n\n  \t\t// if it has a fragment, process its items\n  \t\tif (item.fragment) {\n  \t\t\tcollect(item.fragment.iterations || item.fragment.items, name, dest);\n  \t\t}\n\n  \t\t// or if it is itself a fragment, process its items\n  \t\telse if (isArray(item.items)) {\n  \t\t\t\tcollect(item.items, name, dest);\n  \t\t\t}\n\n  \t\t\t// or if it is a component, step in and process its items\n  \t\t\telse if (item.type === COMPONENT && item.instance) {\n  \t\t\t\t\t// ...unless the partial is shadowed\n  \t\t\t\t\tif (item.instance.partials[name]) return;\n  \t\t\t\t\tcollect(item.instance.fragment.items, name, dest);\n  \t\t\t\t}\n\n  \t\t// if the item is an element, process its attributes too\n  \t\tif (item.type === ELEMENT) {\n  \t\t\tif (isArray(item.attributes)) {\n  \t\t\t\tcollect(item.attributes, name, dest);\n  \t\t\t}\n\n  \t\t\tif (isArray(item.conditionalAttributes)) {\n  \t\t\t\tcollect(item.conditionalAttributes, name, dest);\n  \t\t\t}\n  \t\t}\n  \t});\n  }\n\n  function forceResetTemplate(partial) {\n  \tpartial.forceResetTemplate();\n  }\n\n  function resetPartial (name, partial) {\n  \tvar collection = [];\n  \tcollect(this.fragment.items, name, collection);\n\n  \tvar promise = runloop.start(this, true);\n\n  \tthis.partials[name] = partial;\n  \tcollection.forEach(forceResetTemplate);\n\n  \trunloop.end();\n\n  \treturn promise;\n  }\n\n  var shouldRerender = ['template', 'partials', 'components', 'decorators', 'events'];\n\n  var completeHook = new Hook('complete');\n  var resetHook = new Hook('reset');\n  var renderHook = new Hook('render');\n  var unrenderHook = new Hook('unrender');\n  function Ractive$reset(data) {\n  \tdata = data || {};\n\n  \tif (typeof data !== 'object') {\n  \t\tthrow new Error('The reset method takes either no arguments, or an object containing new data');\n  \t}\n\n  \t// TEMP need to tidy this up\n  \tdata = dataConfigurator.init(this.constructor, this, { data: data });\n\n  \tvar promise = runloop.start(this, true);\n\n  \t// If the root object is wrapped, try and use the wrapper's reset value\n  \tvar wrapper = this.viewmodel.wrapper;\n  \tif (wrapper && wrapper.reset) {\n  \t\tif (wrapper.reset(data) === false) {\n  \t\t\t// reset was rejected, we need to replace the object\n  \t\t\tthis.viewmodel.set(data);\n  \t\t}\n  \t} else {\n  \t\tthis.viewmodel.set(data);\n  \t}\n\n  \t// reset config items and track if need to rerender\n  \tvar changes = config.reset(this);\n  \tvar rerender = undefined;\n\n  \tvar i = changes.length;\n  \twhile (i--) {\n  \t\tif (shouldRerender.indexOf(changes[i]) > -1) {\n  \t\t\trerender = true;\n  \t\t\tbreak;\n  \t\t}\n  \t}\n\n  \tif (rerender) {\n  \t\tunrenderHook.fire(this);\n  \t\tthis.fragment.resetTemplate(this.template);\n  \t\trenderHook.fire(this);\n  \t\tcompleteHook.fire(this);\n  \t}\n\n  \trunloop.end();\n\n  \tresetHook.fire(this, data);\n\n  \treturn promise;\n  }\n\n  function Ractive$render(target, anchor) {\n  \ttarget = getElement(target) || this.el;\n\n  \tif (!this.append && target) {\n  \t\t// Teardown any existing instances *before* trying to set up the new one -\n  \t\t// avoids certain weird bugs\n  \t\tvar others = target.__ractive_instances__;\n  \t\tif (others) others.forEach(_teardown);\n\n  \t\t// make sure we are the only occupants\n  \t\tif (!this.enhance) {\n  \t\t\ttarget.innerHTML = ''; // TODO is this quicker than removeChild? Initial research inconclusive\n  \t\t}\n  \t}\n\n  \tvar occupants = this.enhance ? toArray(target.childNodes) : null;\n  \tvar promise = render(this, target, anchor, occupants);\n\n  \tif (occupants) {\n  \t\twhile (occupants.length) target.removeChild(occupants.pop());\n  \t}\n\n  \treturn promise;\n  }\n\n  var push = makeArrayMethod('push');\n\n  var pop = makeArrayMethod('pop');\n\n  function Ractive$once(eventName, handler) {\n  \tvar listener = this.on(eventName, function () {\n  \t\thandler.apply(this, arguments);\n  \t\tlistener.cancel();\n  \t});\n\n  \t// so we can still do listener.cancel() manually\n  \treturn listener;\n  }\n\n  function trim (str) {\n    return str.trim();\n  }\n\n  function notEmptyString (str) {\n    return str !== '';\n  }\n\n  function Ractive$on(eventName, callback) {\n  \tvar _this = this;\n\n  \t// allow mutliple listeners to be bound in one go\n  \tif (typeof eventName === 'object') {\n  \t\tvar _ret = (function () {\n  \t\t\tvar listeners = [];\n  \t\t\tvar n = undefined;\n\n  \t\t\tfor (n in eventName) {\n  \t\t\t\tif (eventName.hasOwnProperty(n)) {\n  \t\t\t\t\tlisteners.push(_this.on(n, eventName[n]));\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\treturn {\n  \t\t\t\tv: {\n  \t\t\t\t\tcancel: function () {\n  \t\t\t\t\t\tvar listener = undefined;\n  \t\t\t\t\t\twhile (listener = listeners.pop()) listener.cancel();\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t\t};\n  \t\t})();\n\n  \t\tif (typeof _ret === 'object') return _ret.v;\n  \t}\n\n  \t// Handle multiple space-separated event names\n  \tvar eventNames = eventName.split(' ').map(trim).filter(notEmptyString);\n\n  \teventNames.forEach(function (eventName) {\n  \t\t(_this._subs[eventName] || (_this._subs[eventName] = [])).push(callback);\n  \t});\n\n  \treturn {\n  \t\tcancel: function () {\n  \t\t\treturn _this.off(eventName, callback);\n  \t\t}\n  \t};\n  }\n\n  function Ractive$off(eventName, callback) {\n  \tvar _this = this;\n\n  \t// if no arguments specified, remove all callbacks\n  \tif (!eventName) {\n  \t\t// TODO use this code instead, once the following issue has been resolved\n  \t\t// in PhantomJS (tests are unpassable otherwise!)\n  \t\t// https://github.com/ariya/phantomjs/issues/11856\n  \t\t// defineProperty( this, '_subs', { value: create( null ), configurable: true });\n  \t\tfor (eventName in this._subs) {\n  \t\t\tdelete this._subs[eventName];\n  \t\t}\n  \t} else {\n  \t\t// Handle multiple space-separated event names\n  \t\tvar eventNames = eventName.split(' ').map(trim).filter(notEmptyString);\n\n  \t\teventNames.forEach(function (eventName) {\n  \t\t\tvar subscribers = _this._subs[eventName];\n\n  \t\t\t// If we have subscribers for this event...\n  \t\t\tif (subscribers) {\n  \t\t\t\t// ...if a callback was specified, only remove that\n  \t\t\t\tif (callback) {\n  \t\t\t\t\tvar index = subscribers.indexOf(callback);\n  \t\t\t\t\tif (index !== -1) {\n  \t\t\t\t\t\tsubscribers.splice(index, 1);\n  \t\t\t\t\t}\n  \t\t\t\t}\n\n  \t\t\t\t// ...otherwise remove all callbacks\n  \t\t\t\telse {\n  \t\t\t\t\t\t_this._subs[eventName] = [];\n  \t\t\t\t\t}\n  \t\t\t}\n  \t\t});\n  \t}\n\n  \treturn this;\n  }\n\n  var onceOptions = { init: false, once: true };\n  function observeOnce(keypath, callback, options) {\n  \tif (isObject(keypath) || typeof keypath === 'function') {\n  \t\toptions = extend(callback || {}, onceOptions);\n  \t\treturn this.observe(keypath, options);\n  \t}\n\n  \toptions = extend(options || {}, onceOptions);\n  \treturn this.observe(keypath, callback, options);\n  }\n\n  function observeList(keypath, callback, options) {\n  \tif (typeof keypath !== 'string') {\n  \t\tthrow new Error('ractive.observeList() must be passed a string as its first argument');\n  \t}\n\n  \tvar model = this.viewmodel.joinAll(splitKeypath(keypath));\n  \tvar observer = new ListObserver(this, model, callback, options || {});\n\n  \t// add observer to the Ractive instance, so it can be\n  \t// cancelled on ractive.teardown()\n  \tthis._observers.push(observer);\n\n  \treturn {\n  \t\tcancel: function () {\n  \t\t\tobserver.cancel();\n  \t\t}\n  \t};\n  }\n\n  function negativeOne() {\n  \treturn -1;\n  }\n\n  var ListObserver = (function () {\n  \tfunction ListObserver(context, model, callback, options) {\n  \t\tclassCallCheck(this, ListObserver);\n\n  \t\tthis.context = context;\n  \t\tthis.model = model;\n  \t\tthis.keypath = model.getKeypath();\n  \t\tthis.callback = callback;\n\n  \t\tthis.pending = null;\n\n  \t\tmodel.register(this);\n\n  \t\tif (options.init !== false) {\n  \t\t\tthis.sliced = [];\n  \t\t\tthis.shuffle([]);\n  \t\t\tthis.handleChange();\n  \t\t} else {\n  \t\t\tthis.sliced = this.slice();\n  \t\t}\n  \t}\n\n  \tListObserver.prototype.handleChange = function handleChange() {\n  \t\tif (this.pending) {\n  \t\t\t// post-shuffle\n  \t\t\tthis.callback(this.pending);\n  \t\t\tthis.pending = null;\n  \t\t} else {\n  \t\t\t// entire array changed\n  \t\t\tthis.shuffle(this.sliced.map(negativeOne));\n  \t\t\tthis.handleChange();\n  \t\t}\n  \t};\n\n  \tListObserver.prototype.shuffle = function shuffle(newIndices) {\n  \t\tvar _this = this;\n\n  \t\tvar newValue = this.slice();\n\n  \t\tvar inserted = [];\n  \t\tvar deleted = [];\n  \t\tvar start = undefined;\n\n  \t\tvar hadIndex = {};\n\n  \t\tnewIndices.forEach(function (newIndex, oldIndex) {\n  \t\t\thadIndex[newIndex] = true;\n\n  \t\t\tif (newIndex !== oldIndex && start === undefined) {\n  \t\t\t\tstart = oldIndex;\n  \t\t\t}\n\n  \t\t\tif (newIndex === -1) {\n  \t\t\t\tdeleted.push(_this.sliced[oldIndex]);\n  \t\t\t}\n  \t\t});\n\n  \t\tif (start === undefined) start = newIndices.length;\n\n  \t\tvar len = newValue.length;\n  \t\tfor (var i = 0; i < len; i += 1) {\n  \t\t\tif (!hadIndex[i]) inserted.push(newValue[i]);\n  \t\t}\n\n  \t\tthis.pending = { inserted: inserted, deleted: deleted, start: start };\n  \t\tthis.sliced = newValue;\n  \t};\n\n  \tListObserver.prototype.slice = function slice() {\n  \t\tvar value = this.model.get();\n  \t\treturn isArray(value) ? value.slice() : [];\n  \t};\n\n  \treturn ListObserver;\n  })();\n\n  function observe(keypath, callback, options) {\n  \tvar _this = this;\n\n  \tvar observers = [];\n  \tvar map = undefined;\n\n  \tif (isObject(keypath)) {\n  \t\tmap = keypath;\n  \t\toptions = callback || {};\n\n  \t\tObject.keys(map).forEach(function (keypath) {\n  \t\t\tvar callback = map[keypath];\n\n  \t\t\tkeypath.split(' ').forEach(function (keypath) {\n  \t\t\t\tobservers.push(createObserver(_this, keypath, callback, options));\n  \t\t\t});\n  \t\t});\n  \t} else {\n  \t\tvar keypaths = undefined;\n\n  \t\tif (typeof keypath === 'function') {\n  \t\t\toptions = callback;\n  \t\t\tcallback = keypath;\n  \t\t\tkeypaths = [''];\n  \t\t} else {\n  \t\t\tkeypaths = keypath.split(' ');\n  \t\t}\n\n  \t\tkeypaths.forEach(function (keypath) {\n  \t\t\tobservers.push(createObserver(_this, keypath, callback, options || {}));\n  \t\t});\n  \t}\n\n  \t// add observers to the Ractive instance, so they can be\n  \t// cancelled on ractive.teardown()\n  \tthis._observers.push.apply(this._observers, observers);\n\n  \treturn {\n  \t\tcancel: function () {\n  \t\t\tobservers.forEach(cancel);\n  \t\t}\n  \t};\n  }\n\n  function createObserver(ractive, keypath, callback, options) {\n  \tvar viewmodel = ractive.viewmodel;\n\n  \tvar keys = splitKeypath(keypath);\n  \tvar wildcardIndex = keys.indexOf('*');\n\n  \t// normal keypath - no wildcards\n  \tif (! ~wildcardIndex) {\n  \t\tvar key = keys[0];\n\n  \t\tif (!viewmodel.has(key)) {\n  \t\t\t// if this is an inline component, we may need to create an implicit mapping\n  \t\t\tif (ractive.component) {\n  \t\t\t\tvar _model = resolveReference(ractive.component.parentFragment, key);\n  \t\t\t\tif (_model) viewmodel.map(key, _model);\n  \t\t\t}\n  \t\t}\n\n  \t\tvar model = viewmodel.joinAll(keys);\n  \t\treturn new Observer(options.context || ractive, model, callback, options);\n  \t}\n\n  \t// pattern observers - more complex case\n  \tvar baseModel = wildcardIndex === 0 ? viewmodel : viewmodel.joinAll(keys.slice(0, wildcardIndex));\n\n  \treturn new PatternObserver(options.context || ractive, baseModel, keys.splice(wildcardIndex), callback, options);\n  }\n\n  var Observer = (function () {\n  \tfunction Observer(context, model, callback, options) {\n  \t\tclassCallCheck(this, Observer);\n\n  \t\tthis.context = context;\n  \t\tthis.model = model;\n  \t\tthis.keypath = model.getKeypath();\n  \t\tthis.callback = callback;\n\n  \t\tthis.oldValue = undefined;\n  \t\tthis.newValue = model.get();\n\n  \t\tthis.defer = options.defer;\n  \t\tthis.once = options.once;\n  \t\tthis.strict = options.strict;\n\n  \t\tthis.dirty = false;\n\n  \t\tif (options.init !== false) {\n  \t\t\tthis.dispatch();\n  \t\t} else {\n  \t\t\tthis.oldValue = this.newValue;\n  \t\t}\n\n  \t\tmodel.register(this);\n  \t}\n\n  \tObserver.prototype.cancel = function cancel() {\n  \t\tthis.model.unregister(this);\n  \t};\n\n  \tObserver.prototype.dispatch = function dispatch() {\n  \t\tthis.callback.call(this.context, this.newValue, this.oldValue, this.keypath);\n  \t\tthis.oldValue = this.newValue;\n  \t\tthis.dirty = false;\n  \t};\n\n  \tObserver.prototype.handleChange = function handleChange() {\n  \t\tif (!this.dirty) {\n  \t\t\tthis.newValue = this.model.get();\n\n  \t\t\tif (this.strict && this.newValue === this.oldValue) return;\n\n  \t\t\trunloop.addObserver(this, this.defer);\n  \t\t\tthis.dirty = true;\n\n  \t\t\tif (this.once) this.cancel();\n  \t\t}\n  \t};\n\n  \treturn Observer;\n  })();\n\n  var PatternObserver = (function () {\n  \tfunction PatternObserver(context, baseModel, keys, callback, options) {\n  \t\tvar _this2 = this;\n\n  \t\tclassCallCheck(this, PatternObserver);\n\n  \t\tthis.context = context;\n  \t\tthis.baseModel = baseModel;\n  \t\tthis.keys = keys;\n  \t\tthis.callback = callback;\n\n  \t\tvar pattern = keys.join('\\\\.').replace(/\\*/g, '(.+)');\n  \t\tvar baseKeypath = baseModel.getKeypath();\n  \t\tthis.pattern = new RegExp('^' + (baseKeypath ? baseKeypath + '\\\\.' : '') + pattern + '$');\n\n  \t\tthis.oldValues = {};\n  \t\tthis.newValues = {};\n\n  \t\tthis.defer = options.defer;\n  \t\tthis.once = options.once;\n  \t\tthis.strict = options.strict;\n\n  \t\tthis.dirty = false;\n\n  \t\tthis.baseModel.findMatches(this.keys).forEach(function (model) {\n  \t\t\t_this2.newValues[model.getKeypath()] = model.get();\n  \t\t});\n\n  \t\tif (options.init !== false) {\n  \t\t\tthis.dispatch();\n  \t\t} else {\n  \t\t\tthis.oldValues = this.newValues;\n  \t\t}\n\n  \t\tbaseModel.register(this);\n  \t}\n\n  \tPatternObserver.prototype.cancel = function cancel() {\n  \t\tthis.baseModel.unregister(this);\n  \t};\n\n  \tPatternObserver.prototype.dispatch = function dispatch() {\n  \t\tvar _this3 = this;\n\n  \t\tObject.keys(this.newValues).forEach(function (keypath) {\n  \t\t\tif (_this3.newKeys && !_this3.newKeys[keypath]) return;\n\n  \t\t\tvar newValue = _this3.newValues[keypath];\n  \t\t\tvar oldValue = _this3.oldValues[keypath];\n\n  \t\t\tif (_this3.strict && newValue === oldValue) return;\n  \t\t\tif (isEqual(newValue, oldValue)) return;\n\n  \t\t\tvar wildcards = _this3.pattern.exec(keypath).slice(1);\n  \t\t\tvar args = [newValue, oldValue, keypath].concat(wildcards);\n\n  \t\t\t_this3.callback.apply(_this3.context, args);\n  \t\t});\n\n  \t\tthis.oldValues = this.newValues;\n  \t\tthis.newKeys = null;\n  \t\tthis.dirty = false;\n  \t};\n\n  \tPatternObserver.prototype.shuffle = function shuffle(newIndices) {\n  \t\tif (!isArray(this.baseModel.value)) return;\n\n  \t\tvar base = this.baseModel.getKeypath();\n  \t\tvar max = this.baseModel.value.length;\n  \t\tvar suffix = this.keys.length > 1 ? '.' + this.keys.slice(1).join('.') : '';\n\n  \t\tthis.newKeys = {};\n  \t\tfor (var i = 0; i < newIndices.length; i++) {\n  \t\t\tif (newIndices[i] === -1 || newIndices[i] === i) continue;\n  \t\t\tthis.newKeys[base + '.' + i + suffix] = true;\n  \t\t}\n\n  \t\tfor (var i = newIndices.touchedFrom; i < max; i++) {\n  \t\t\tthis.newKeys[base + '.' + i + suffix] = true;\n  \t\t}\n  \t};\n\n  \tPatternObserver.prototype.handleChange = function handleChange() {\n  \t\tvar _this4 = this;\n\n  \t\tif (!this.dirty) {\n  \t\t\tthis.newValues = {};\n\n  \t\t\t// handle case where previously extant keypath no longer exists -\n  \t\t\t// observer should still fire, with undefined as new value\n  \t\t\t// TODO huh. according to the test suite that's not the case...\n  \t\t\t// Object.keys( this.oldValues ).forEach( keypath => {\n  \t\t\t// \tthis.newValues[ keypath ] = undefined;\n  \t\t\t// });\n\n  \t\t\tthis.baseModel.findMatches(this.keys).forEach(function (model) {\n  \t\t\t\tvar keypath = model.getKeypath();\n  \t\t\t\t_this4.newValues[keypath] = model.get();\n  \t\t\t});\n\n  \t\t\trunloop.addObserver(this, this.defer);\n  \t\t\tthis.dirty = true;\n\n  \t\t\tif (this.once) this.cancel();\n  \t\t}\n  \t};\n\n  \treturn PatternObserver;\n  })();\n\n  var comparators = {};\n\n  function getComparator(option) {\n  \tif (!option) return null; // use existing arrays\n  \tif (option === true) return JSON.stringify;\n  \tif (typeof option === 'function') return option;\n\n  \tif (typeof option === 'string') {\n  \t\treturn comparators[option] || (comparators[option] = function (thing) {\n  \t\t\treturn thing[option];\n  \t\t});\n  \t}\n\n  \tthrow new Error('If supplied, options.compare must be a string, function, or `true`'); // TODO link to docs\n  }\n  function Ractive$merge(keypath, array, options) {\n  \tvar model = this.viewmodel.joinAll(splitKeypath(keypath));\n  \tvar promise = runloop.start(this, true);\n  \tvar value = model.get();\n\n  \tif (array === value) {\n  \t\tthrow new Error('You cannot merge an array with itself'); // TODO link to docs\n  \t} else if (!isArray(value) || !isArray(array)) {\n  \t\t\tthrow new Error('You cannot merge an array with a non-array');\n  \t\t}\n\n  \tvar comparator = getComparator(options && options.compare);\n  \tmodel.merge(array, comparator);\n\n  \trunloop.end();\n  \treturn promise;\n  }\n\n  var insertHook = new Hook('insert');\n  function Ractive$insert(target, anchor) {\n  \tif (!this.fragment.rendered) {\n  \t\t// TODO create, and link to, documentation explaining this\n  \t\tthrow new Error('The API has changed - you must call `ractive.render(target[, anchor])` to render your Ractive instance. Once rendered you can use `ractive.insert()`.');\n  \t}\n\n  \ttarget = getElement(target);\n  \tanchor = getElement(anchor) || null;\n\n  \tif (!target) {\n  \t\tthrow new Error('You must specify a valid target to insert into');\n  \t}\n\n  \ttarget.insertBefore(this.detach(), anchor);\n  \tthis.el = target;\n\n  \t(target.__ractive_instances__ || (target.__ractive_instances__ = [])).push(this);\n  \tthis.isDetached = false;\n\n  \tfireInsertHook(this);\n  }\n\n  function fireInsertHook(ractive) {\n  \tinsertHook.fire(ractive);\n\n  \tractive.findAllComponents('*').forEach(function (child) {\n  \t\tfireInsertHook(child.instance);\n  \t});\n  }\n\n  function Ractive$get(keypath) {\n  \tif (!keypath) return this.viewmodel.get(true);\n\n  \tvar keys = splitKeypath(keypath);\n  \tvar key = keys[0];\n\n  \tvar model = undefined;\n\n  \tif (!this.viewmodel.has(key)) {\n  \t\t// if this is an inline component, we may need to create\n  \t\t// an implicit mapping\n  \t\tif (this.component) {\n  \t\t\tmodel = resolveReference(this.component.parentFragment, key);\n\n  \t\t\tif (model) {\n  \t\t\t\tthis.viewmodel.map(key, model);\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \tmodel = this.viewmodel.joinAll(keys);\n  \treturn model.get(true);\n  }\n\n  function Ractive$fire(eventName) {\n  \tfor (var _len = arguments.length, args = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n  \t\targs[_key - 1] = arguments[_key];\n  \t}\n\n  \tfireEvent(this, eventName, { args: args });\n  }\n\n  function Ractive$findParent(selector) {\n\n  \tif (this.parent) {\n  \t\tif (this.parent.component && this.parent.component.name === selector) {\n  \t\t\treturn this.parent;\n  \t\t} else {\n  \t\t\treturn this.parent.findParent(selector);\n  \t\t}\n  \t}\n\n  \treturn null;\n  }\n\n  function Ractive$findContainer(selector) {\n  \tif (this.container) {\n  \t\tif (this.container.component && this.container.component.name === selector) {\n  \t\t\treturn this.container;\n  \t\t} else {\n  \t\t\treturn this.container.findContainer(selector);\n  \t\t}\n  \t}\n\n  \treturn null;\n  }\n\n  function Ractive$findComponent(selector) {\n  \treturn this.fragment.findComponent(selector);\n  }\n\n  function sortByDocumentPosition(node, otherNode) {\n  \tif (node.compareDocumentPosition) {\n  \t\tvar bitmask = node.compareDocumentPosition(otherNode);\n  \t\treturn bitmask & 2 ? 1 : -1;\n  \t}\n\n  \t// In old IE, we can piggy back on the mechanism for\n  \t// comparing component positions\n  \treturn sortByItemPosition(node, otherNode);\n  }\n\n  function sortByItemPosition(a, b) {\n  \tvar ancestryA = getAncestry(a.component || a._ractive.proxy);\n  \tvar ancestryB = getAncestry(b.component || b._ractive.proxy);\n\n  \tvar oldestA = lastItem(ancestryA);\n  \tvar oldestB = lastItem(ancestryB);\n  \tvar mutualAncestor = undefined;\n\n  \t// remove items from the end of both ancestries as long as they are identical\n  \t// - the final one removed is the closest mutual ancestor\n  \twhile (oldestA && oldestA === oldestB) {\n  \t\tancestryA.pop();\n  \t\tancestryB.pop();\n\n  \t\tmutualAncestor = oldestA;\n\n  \t\toldestA = lastItem(ancestryA);\n  \t\toldestB = lastItem(ancestryB);\n  \t}\n\n  \t// now that we have the mutual ancestor, we can find which is earliest\n  \toldestA = oldestA.component || oldestA;\n  \toldestB = oldestB.component || oldestB;\n\n  \tvar fragmentA = oldestA.parentFragment;\n  \tvar fragmentB = oldestB.parentFragment;\n\n  \t// if both items share a parent fragment, our job is easy\n  \tif (fragmentA === fragmentB) {\n  \t\tvar indexA = fragmentA.items.indexOf(oldestA);\n  \t\tvar indexB = fragmentB.items.indexOf(oldestB);\n\n  \t\t// if it's the same index, it means one contains the other,\n  \t\t// so we see which has the longest ancestry\n  \t\treturn indexA - indexB || ancestryA.length - ancestryB.length;\n  \t}\n\n  \t// if mutual ancestor is a section, we first test to see which section\n  \t// fragment comes first\n  \tvar fragments = mutualAncestor.iterations;\n  \tif (fragments) {\n  \t\tvar indexA = fragments.indexOf(fragmentA);\n  \t\tvar indexB = fragments.indexOf(fragmentB);\n\n  \t\treturn indexA - indexB || ancestryA.length - ancestryB.length;\n  \t}\n\n  \tthrow new Error('An unexpected condition was met while comparing the position of two components. Please file an issue at https://github.com/ractivejs/ractive/issues - thanks!');\n  }\n\n  function getParent(item) {\n  \tvar parentFragment = item.parentFragment;\n\n  \tif (parentFragment) return parentFragment.owner;\n\n  \tif (item.component && (parentFragment = item.component.parentFragment)) {\n  \t\treturn parentFragment.owner;\n  \t}\n  }\n\n  function getAncestry(item) {\n  \tvar ancestry = [item];\n  \tvar ancestor = getParent(item);\n\n  \twhile (ancestor) {\n  \t\tancestry.push(ancestor);\n  \t\tancestor = getParent(ancestor);\n  \t}\n\n  \treturn ancestry;\n  }\n\n  var Query = (function () {\n  \tfunction Query(ractive, selector, live, isComponentQuery) {\n  \t\tclassCallCheck(this, Query);\n\n  \t\tthis.ractive = ractive;\n  \t\tthis.selector = selector;\n  \t\tthis.live = live;\n  \t\tthis.isComponentQuery = isComponentQuery;\n\n  \t\tthis.result = [];\n\n  \t\tthis.dirty = true;\n  \t}\n\n  \tQuery.prototype.add = function add(item) {\n  \t\tthis.result.push(item);\n  \t\tthis.makeDirty();\n  \t};\n\n  \tQuery.prototype.cancel = function cancel() {\n  \t\tvar liveQueries = this._root[this.isComponentQuery ? 'liveComponentQueries' : 'liveQueries'];\n  \t\tvar selector = this.selector;\n\n  \t\tvar index = liveQueries.indexOf(selector);\n\n  \t\tif (index !== -1) {\n  \t\t\tliveQueries.splice(index, 1);\n  \t\t\tliveQueries[selector] = null;\n  \t\t}\n  \t};\n\n  \tQuery.prototype.init = function init() {\n  \t\tthis.dirty = false;\n  \t};\n\n  \tQuery.prototype.makeDirty = function makeDirty() {\n  \t\tvar _this = this;\n\n  \t\tif (!this.dirty) {\n  \t\t\tthis.dirty = true;\n\n  \t\t\t// Once the DOM has been updated, ensure the query\n  \t\t\t// is correctly ordered\n  \t\t\trunloop.scheduleTask(function () {\n  \t\t\t\treturn _this.update();\n  \t\t\t});\n  \t\t}\n  \t};\n\n  \tQuery.prototype.remove = function remove(nodeOrComponent) {\n  \t\tvar index = this.result.indexOf(this.isComponentQuery ? nodeOrComponent.instance : nodeOrComponent);\n  \t\tif (index !== -1) this.result.splice(index, 1);\n  \t};\n\n  \tQuery.prototype.update = function update() {\n  \t\tthis.result.sort(this.isComponentQuery ? sortByItemPosition : sortByDocumentPosition);\n  \t\tthis.dirty = false;\n  \t};\n\n  \tQuery.prototype.test = function test(item) {\n  \t\treturn this.isComponentQuery ? !this.selector || item.name === this.selector : item ? matches(item, this.selector) : null;\n  \t};\n\n  \treturn Query;\n  })();\n\n  function Ractive$findAllComponents(selector, options) {\n  \toptions = options || {};\n  \tvar liveQueries = this._liveComponentQueries;\n\n  \t// Shortcut: if we're maintaining a live query with this\n  \t// selector, we don't need to traverse the parallel DOM\n  \tvar query = liveQueries[selector];\n  \tif (query) {\n  \t\t// Either return the exact same query, or (if not live) a snapshot\n  \t\treturn options && options.live ? query : query.slice();\n  \t}\n\n  \tquery = new Query(this, selector, !!options.live, true);\n\n  \t// Add this to the list of live queries Ractive needs to maintain,\n  \t// if applicable\n  \tif (query.live) {\n  \t\tliveQueries.push(selector);\n  \t\tliveQueries['_' + selector] = query;\n  \t}\n\n  \tthis.fragment.findAllComponents(selector, query);\n\n  \tquery.init();\n  \treturn query.result;\n  }\n\n  function Ractive$findAll(selector, options) {\n  \tif (!this.el) return [];\n\n  \toptions = options || {};\n  \tvar liveQueries = this._liveQueries;\n\n  \t// Shortcut: if we're maintaining a live query with this\n  \t// selector, we don't need to traverse the parallel DOM\n  \tvar query = liveQueries[selector];\n  \tif (query) {\n  \t\t// Either return the exact same query, or (if not live) a snapshot\n  \t\treturn options && options.live ? query : query.slice();\n  \t}\n\n  \tquery = new Query(this, selector, !!options.live, false);\n\n  \t// Add this to the list of live queries Ractive needs to maintain,\n  \t// if applicable\n  \tif (query.live) {\n  \t\tliveQueries.push(selector);\n  \t\tliveQueries['_' + selector] = query;\n  \t}\n\n  \tthis.fragment.findAll(selector, query);\n\n  \tquery.init();\n  \treturn query.result;\n  }\n\n  function Ractive$find(selector) {\n  \tif (!this.el) {\n  \t\treturn null;\n  \t}\n\n  \treturn this.fragment.find(selector);\n  }\n\n  var detachHook = new Hook('detach');\n  function Ractive$detach() {\n  \tif (this.isDetached) {\n  \t\treturn this.el;\n  \t}\n\n  \tif (this.el) {\n  \t\tremoveFromArray(this.el.__ractive_instances__, this);\n  \t}\n\n  \tthis.el = this.fragment.detach();\n  \tthis.isDetached = true;\n\n  \tdetachHook.fire(this);\n  \treturn this.el;\n  }\n\n  // These are a subset of the easing equations found at\n  // https://raw.github.com/danro/easing-js - license info\n  // follows:\n\n  // --------------------------------------------------\n  // easing.js v0.5.4\n  // Generic set of easing functions with AMD support\n  // https://github.com/danro/easing-js\n  // This code may be freely distributed under the MIT license\n  // http://danro.mit-license.org/\n  // --------------------------------------------------\n  // All functions adapted from Thomas Fuchs & Jeremy Kahn\n  // Easing Equations (c) 2003 Robert Penner, BSD license\n  // https://raw.github.com/danro/easing-js/master/LICENSE\n  // --------------------------------------------------\n\n  // In that library, the functions named easeIn, easeOut, and\n  // easeInOut below are named easeInCubic, easeOutCubic, and\n  // (you guessed it) easeInOutCubic.\n  //\n  // You can add additional easing functions to this list, and they\n  // will be globally available.\n\n  var easing = {\n  \tlinear: function (pos) {\n  \t\treturn pos;\n  \t},\n  \teaseIn: function (pos) {\n  \t\treturn Math.pow(pos, 3);\n  \t},\n  \teaseOut: function (pos) {\n  \t\treturn Math.pow(pos - 1, 3) + 1;\n  \t},\n  \teaseInOut: function (pos) {\n  \t\tif ((pos /= 0.5) < 1) {\n  \t\t\treturn 0.5 * Math.pow(pos, 3);\n  \t\t}\n  \t\treturn 0.5 * (Math.pow(pos - 2, 3) + 2);\n  \t}\n  };\n\n  var noAnimation = { stop: noop };\n  var linear = easing.linear;\n\n  function getOptions(options, instance) {\n  \toptions = options || {};\n\n  \tvar easing = undefined;\n  \tif (options.easing) {\n  \t\teasing = typeof options.easing === 'function' ? options.easing : instance.easing[options.easing];\n  \t}\n\n  \treturn {\n  \t\teasing: easing || linear,\n  \t\tduration: 'duration' in options ? options.duration : 400,\n  \t\tcomplete: options.complete || noop,\n  \t\tstep: options.step || noop\n  \t};\n  }\n  function Ractive$animate(keypath, to, options) {\n  \tif (typeof keypath === 'object') {\n  \t\tvar keys = Object.keys(keypath);\n\n  \t\tthrow new Error('ractive.animate(...) no longer supports objects. Instead of ractive.animate({\\n  ' + keys.map(function (key) {\n  \t\t\treturn '\\'' + key + '\\': ' + keypath[key];\n  \t\t}).join('\\n  ') + '\\n}, {...}), do\\n\\n' + keys.map(function (key) {\n  \t\t\treturn 'ractive.animate(\\'' + key + '\\', ' + keypath[key] + ', {...});';\n  \t\t}).join('\\n') + '\\n');\n  \t}\n\n  \toptions = getOptions(options);\n\n  \tvar model = this.viewmodel.joinAll(splitKeypath(keypath));\n  \tvar from = model.get();\n\n  \t// don't bother animating values that stay the same\n  \tif (isEqual(from, to)) {\n  \t\toptions.complete(options.to);\n  \t\treturn noAnimation; // TODO should this have .then and .catch methods?\n  \t}\n\n  \tvar interpolator = interpolate(from, to, this, options.interpolator);\n\n  \t// if we can't interpolate the value, set it immediately\n  \tif (!interpolator) {\n  \t\trunloop.start();\n  \t\tmodel.set(to);\n  \t\trunloop.end();\n\n  \t\treturn noAnimation;\n  \t}\n\n  \treturn model.animate(from, to, options, interpolator);\n  }\n\n  function Ractive$add(keypath, d) {\n  \treturn add(this, keypath, d === undefined ? 1 : +d);\n  }\n\n  var proto$1 = {\n  \tadd: Ractive$add,\n  \tanimate: Ractive$animate,\n  \tdetach: Ractive$detach,\n  \tfind: Ractive$find,\n  \tfindAll: Ractive$findAll,\n  \tfindAllComponents: Ractive$findAllComponents,\n  \tfindComponent: Ractive$findComponent,\n  \tfindContainer: Ractive$findContainer,\n  \tfindParent: Ractive$findParent,\n  \tfire: Ractive$fire,\n  \tget: Ractive$get,\n  \tinsert: Ractive$insert,\n  \tmerge: Ractive$merge,\n  \tobserve: observe,\n  \tobserveList: observeList,\n  \tobserveOnce: observeOnce,\n  \t// TODO reinstate these\n  \t// observeListOnce,\n  \toff: Ractive$off,\n  \ton: Ractive$on,\n  \tonce: Ractive$once,\n  \tpop: pop,\n  \tpush: push,\n  \trender: Ractive$render,\n  \treset: Ractive$reset,\n  \tresetPartial: resetPartial,\n  \tresetTemplate: Ractive$resetTemplate,\n  \treverse: reverse,\n  \tset: Ractive$set,\n  \tshift: shift,\n  \tsort: sort,\n  \tsplice: splice,\n  \tsubtract: Ractive$subtract,\n  \tteardown: Ractive$teardown,\n  \ttoggle: Ractive$toggle,\n  \ttoHTML: Ractive$toHTML,\n  \ttoHtml: Ractive$toHTML,\n  \tunrender: Ractive$unrender,\n  \tunshift: unshift,\n  \tupdate: Ractive$update,\n  \tupdateModel: Ractive$updateModel\n  };\n\n  function getNodeInfo (node) {\n  \tif (!node || !node._ractive) return {};\n\n  \tvar storage = node._ractive;\n\n  \treturn {\n  \t\tractive: storage.ractive,\n  \t\tkeypath: storage.context.getKeypath(),\n  \t\tindex: extend({}, storage.fragment.indexRefs),\n  \t\tkey: extend({}, storage.fragment.keyRefs)\n  \t};\n  }\n\n  function wrap$1 (method, superMethod, force) {\n\n  \tif (force || needsSuper$1(method, superMethod)) {\n\n  \t\treturn function () {\n\n  \t\t\tvar hasSuper = ('_super' in this),\n  \t\t\t    _super = this._super,\n  \t\t\t    result;\n\n  \t\t\tthis._super = superMethod;\n\n  \t\t\tresult = method.apply(this, arguments);\n\n  \t\t\tif (hasSuper) {\n  \t\t\t\tthis._super = _super;\n  \t\t\t}\n\n  \t\t\treturn result;\n  \t\t};\n  \t} else {\n  \t\treturn method;\n  \t}\n  }\n\n  function needsSuper$1(method, superMethod) {\n  \treturn typeof superMethod === 'function' && /_super/.test(method);\n  }\n\n  function unwrap(Child) {\n  \tvar options = {};\n\n  \twhile (Child) {\n  \t\taddRegistries(Child, options);\n  \t\taddOtherOptions(Child, options);\n\n  \t\tif (Child._Parent !== Ractive) {\n  \t\t\tChild = Child._Parent;\n  \t\t} else {\n  \t\t\tChild = false;\n  \t\t}\n  \t}\n\n  \treturn options;\n  }\n\n  function addRegistries(Child, options) {\n  \tregistries.forEach(function (r) {\n  \t\taddRegistry(r.useDefaults ? Child.prototype : Child, options, r.name);\n  \t});\n  }\n\n  function addRegistry(target, options, name) {\n  \tvar registry,\n  \t    keys = Object.keys(target[name]);\n\n  \tif (!keys.length) {\n  \t\treturn;\n  \t}\n\n  \tif (!(registry = options[name])) {\n  \t\tregistry = options[name] = {};\n  \t}\n\n  \tkeys.filter(function (key) {\n  \t\treturn !(key in registry);\n  \t}).forEach(function (key) {\n  \t\treturn registry[key] = target[name][key];\n  \t});\n  }\n\n  function addOtherOptions(Child, options) {\n  \tObject.keys(Child.prototype).forEach(function (key) {\n  \t\tif (key === 'computed') {\n  \t\t\treturn;\n  \t\t}\n\n  \t\tvar value = Child.prototype[key];\n\n  \t\tif (!(key in options)) {\n  \t\t\toptions[key] = value._method ? value._method : value;\n  \t\t}\n\n  \t\t// is it a wrapped function?\n  \t\telse if (typeof options[key] === 'function' && typeof value === 'function' && options[key]._method) {\n\n  \t\t\t\tvar result = undefined,\n  \t\t\t\t    needsSuper = value._method;\n\n  \t\t\t\tif (needsSuper) {\n  \t\t\t\t\tvalue = value._method;\n  \t\t\t\t}\n\n  \t\t\t\t// rewrap bound directly to parent fn\n  \t\t\t\tresult = wrap$1(options[key]._method, value);\n\n  \t\t\t\tif (needsSuper) {\n  \t\t\t\t\tresult._method = result;\n  \t\t\t\t}\n\n  \t\t\t\toptions[key] = result;\n  \t\t\t}\n  \t});\n  }\n\n  function extend$1() {\n  \tfor (var _len = arguments.length, options = Array(_len), _key = 0; _key < _len; _key++) {\n  \t\toptions[_key] = arguments[_key];\n  \t}\n\n  \tif (!options.length) {\n  \t\treturn extendOne(this);\n  \t} else {\n  \t\treturn options.reduce(extendOne, this);\n  \t}\n  }\n\n  function extendOne(Parent) {\n  \tvar options = arguments.length <= 1 || arguments[1] === undefined ? {} : arguments[1];\n\n  \tvar Child, proto;\n\n  \t// if we're extending with another Ractive instance...\n  \t//\n  \t//   var Human = Ractive.extend(...), Spider = Ractive.extend(...);\n  \t//   var Spiderman = Human.extend( Spider );\n  \t//\n  \t// ...inherit prototype methods and default options as well\n  \tif (options.prototype instanceof Ractive) {\n  \t\toptions = unwrap(options);\n  \t}\n\n  \tChild = function (options) {\n  \t\tif (!(this instanceof Child)) return new Child(options);\n\n  \t\tconstruct(this, options || {});\n  \t\tinitialise(this, options || {}, {});\n  \t};\n\n  \tproto = create(Parent.prototype);\n  \tproto.constructor = Child;\n\n  \t// Static properties\n  \tdefineProperties(Child, {\n  \t\t// alias prototype as defaults\n  \t\tdefaults: { value: proto },\n\n  \t\t// extendable\n  \t\textend: { value: extend$1, writable: true, configurable: true },\n\n  \t\t// Parent - for IE8, can't use Object.getPrototypeOf\n  \t\t_Parent: { value: Parent }\n  \t});\n\n  \t// extend configuration\n  \tconfig.extend(Parent, proto, options);\n\n  \tdataConfigurator.extend(Parent, proto, options);\n\n  \tif (options.computed) {\n  \t\tproto.computed = extend(create(Parent.prototype.computed), options.computed);\n  \t}\n\n  \tChild.prototype = proto;\n\n  \treturn Child;\n  }\n\n  // Ractive.js makes liberal use of things like Array.prototype.indexOf. In\n  // older browsers, these are made available via a shim - here, we do a quick\n  // pre-flight check to make sure that either a) we're not in a shit browser,\n  // or b) we're using a Ractive-legacy.js build\n  var FUNCTION = 'function';\n\n  if (typeof Date.now !== FUNCTION || typeof String.prototype.trim !== FUNCTION || typeof Object.keys !== FUNCTION || typeof Array.prototype.indexOf !== FUNCTION || typeof Array.prototype.forEach !== FUNCTION || typeof Array.prototype.map !== FUNCTION || typeof Array.prototype.filter !== FUNCTION || win && typeof win.addEventListener !== FUNCTION) {\n  \tthrow new Error('It looks like you\\'re attempting to use Ractive.js in an older browser. You\\'ll need to use one of the \\'legacy builds\\' in order to continue - see http://docs.ractivejs.org/latest/legacy-builds for more information.');\n  }\n  function Ractive(options) {\n  \tif (!(this instanceof Ractive)) return new Ractive(options);\n\n  \tconstruct(this, options || {});\n  \tinitialise(this, options || {}, {});\n  }\n\n  extend(Ractive.prototype, proto$1, defaults);\n  Ractive.prototype.constructor = Ractive;\n\n  // alias prototype as `defaults`\n  Ractive.defaults = Ractive.prototype;\n\n  // static properties\n  defineProperties(Ractive, {\n\n  \t// debug flag\n  \tDEBUG: { writable: true, value: true },\n  \tDEBUG_PROMISES: { writable: true, value: true },\n\n  \t// static methods:\n  \textend: { value: extend$1 },\n  \tgetNodeInfo: { value: getNodeInfo },\n  \tparse: { value: parse },\n\n  \t// namespaced constructors\n  \tPromise: { value: Promise$1 },\n\n  \t// support\n  \tenhance: { writable: true, value: false },\n  \tsvg: { value: svg },\n  \tmagic: { value: magicSupported },\n\n  \t// version\n  \tVERSION: { value: '0.8.0-edge' },\n\n  \t// plugins\n  \tadaptors: { writable: true, value: {} },\n  \tcomponents: { writable: true, value: {} },\n  \tdecorators: { writable: true, value: {} },\n  \teasing: { writable: true, value: easing },\n  \tevents: { writable: true, value: {} },\n  \tinterpolators: { writable: true, value: interpolators$1 },\n  \tpartials: { writable: true, value: {} },\n  \ttransitions: { writable: true, value: {} }\n  });\n\n  return Ractive;\n\n}));"],"names":["model","warnOnceIfDebug","localKey","template","r","ractive","_this3","instance","parentFragment","get","findContext","joinKey","viewmodel","map","this","fragment","rebind","Component","prototype","render","target","occupants","checkYielders","eventHandlers","forEach","_render","updateLiveQueries","rendered","setupEvents","_this4","handlers","Object","keys","v","key","eventNames","split","eventName","event","RactiveEvent","push","EventDirective","toString","toHTML","unbind","complexMappings","_unbind","teardown","_observers","cancel","removeFromLiveComponentQueries","el","__ractive_instances__","removeFromArray","teardownHook$1","fire","unrender","shouldDestroy","_this5","_unrender","liveQueries","query","remove","update","_update","dirty","Item","Text","_Item","options","classCallCheck","call","type","TEXT","inherits","bind","detach","detachNode","node","firstNode","n","nodeType","shift","nodeValue","doc","createTextNode","insertBefore","appendChild","escape","escapeHtml","valueOf","constructors","ALIAS","Alias","DOCTYPE","Doctype","INTERPOLATOR","Interpolator","PARTIAL","Partial","SECTION","Section","TRIPLE","Triple","YIELDER","Yielder","specialElements","doctype","form","Form","input","Input","option","Option","select","Select","textarea","Textarea","ReferenceResolver","reference","callback","normalise","splitKeypath","resolved","context","addUnresolved","componentParent","parent","attemptResolution","resolveAmbiguousReference","forceResolution","joinAll","unresolved","Fragment","owner","isRoot","component","indexRefs","keyRefs","cssIds","resolvers","dirtyArgs","dirtyValue","createItems","items","_bind","bound","bubble","runloop","addFragment","_this","index","createItem","docFrag","createDocumentFragment","item","find","selector","len","length","i","undefined","found","findAll","findComponent","name","findAllComponents","findNextNode","nextItem","findParentNode","ELEMENT","Error","findRepeatingFragment","isIteration","getArgsList","values","source","processItems","_guid","parsed","parseJSON","argsList","value","_rebind","resetTemplate","wasBound","wasRendered","parentNode","anchor","resolve","resolver","toHtml","toEscapedString","_toString","join","unrenderAndDestroy","shouldRerender","completeHook","Hook","resetHook","renderHook","unrenderHook","makeArrayMethod","pop","onceOptions","init","once","ListObserver","keypath","getKeypath","pending","register","sliced","shuffle","handleChange","slice","negativeOne","newIndices","newValue","inserted","deleted","start","hadIndex","newIndex","oldIndex","isArray","Observer","oldValue","defer","strict","dispatch","unregister","addObserver","PatternObserver","baseModel","_this2","pattern","replace","baseKeypath","RegExp","oldValues","newValues","findMatches","newKeys","isEqual","wildcards","exec","args","concat","apply","base","max","suffix","touchedFrom","comparators","insertHook","Query","live","isComponentQuery","result","add","makeDirty","_root","indexOf","splice","scheduleTask","nodeOrComponent","sort","sortByItemPosition","sortByDocumentPosition","test","matches","detachHook","easing","linear","pos","easeIn","Math","pow","easeOut","easeInOut","noAnimation","stop","noop","proto$1","Ractive$add","animate","Ractive$animate","Ractive$detach","Ractive$find","Ractive$findAll","Ractive$findAllComponents","Ractive$findComponent","findContainer","Ractive$findContainer","findParent","Ractive$findParent","Ractive$fire","Ractive$get","insert","Ractive$insert","merge","Ractive$merge","observe","observeList","observeOnce","off","Ractive$off","on","Ractive$on","Ractive$once","Ractive$render","reset","Ractive$reset","resetPartial","Ractive$resetTemplate","reverse","set","Ractive$set","subtract","Ractive$subtract","Ractive$teardown","toggle","Ractive$toggle","Ractive$toHTML","Ractive$unrender","unshift","Ractive$update","updateModel","Ractive$updateModel","FUNCTION","Date","now","String","trim","Array","filter","win","addEventListener","extend","Ractive","defaults","constructor","defineProperties","DEBUG","writable","DEBUG_PROMISES","extend$1","getNodeInfo","parse","Promise","Promise$1","enhance","svg","magic","magicSupported","VERSION","adaptors","components","decorators","events","interpolators","interpolators$1","partials","transitions","parentForm","formBindings","Binding","registerTwowayBinding","root","attribute","locked","getValue","end","interpolator","element","_ractive","binding","setFromNode","unregisterTwowayBinding","CheckboxBinding","_Binding","handleDomEvent","attachEvent","removeEventListener","getInitialValue","getAttribute","checked","BindingGroup","hash","bindings","push$1","CheckboxNameBinding","checkboxName","group","getBindingGroup","getValue$1","noInitialValue","existingValue","bindingValue","arrayContains","changed","wasChecked","isChecked","wasUndefined","valueSoFar","ContentEditableBinding","arguments","innerHTML","lazy","GenericBinding","timeout","a","isNumeric","handler","handleDelay","handleBlur","MultipleSelectBinding","forceUpdate","selectedValues","selected","optionValue","previousValue","arrayContentsMatch","selectedOptions","setValue","initialValue","NumericBinding","_GenericBinding","parseFloat","isNaN","siblings","RadioBinding","getSiblings","RadioNameBinding","getValue$2","nameAttributeBinding","getKeypathModel","SingleSelectBinding","optionWasSelected","attributeByName","disabled","Element","e","toLowerCase","isVoid","voidElementNames","attributes","Attribute","conditionalAttributes","m","ConditionalAttribute","o","decorator","Decorator","fn","findInViewHierarchy","CustomEvent","DOMEvent","f","noContent","createTwowayBinding","shouldBind","twoway","selectBinding","makeDirty$1","namespace","getNamespace","existing","nodeName","toUpperCase","namespaceURI","createElement","defineProperty","proxy","setAttribute","x","children","toArray","childNodes","_name","removeAttribute","updateLiveQueries$1","transitionTemplate","t0","t1","transitionsEnabled","transition","Transition","registerTransition","_introTransition","tagName","attrs","stringifyAttribute","isSelected","inputIsCheckedRadio","str","complete","detachWhenReady","t2","_transition","id","nodes","removeFromLiveQueries","_Element","defaultValue","_Input","isBindable","sync","defaultSelected","selectNode","selectValue","isMultiple","shouldSelect","valueContains","findParentSelect","selectedAttribute","handleReset","mutatorMethods","patchedArrayProto","methodName","method","_len","_key","getNewIndices","setting","wrappers","processWrapper","patchArrayMethods","unpatchArrayMethods","__proto__","array","configurable","unpatch","patch","errorMessage","arrayAdaptor","object","wrap","ArrayWrapper","__model","instances","storage","magicAdaptor","MagicWrapper","err","css","styleElement","head$1","styleSheet","inDom","magicAdaptor$1","originalDescriptors","originalDescriptor","getOwnPropertyDescriptor","childKeypath","escapeKey","descriptor","createOrWrapDescriptor","__magic","revert","dependants","MagicArrayWrapper","magicWrapper","arrayWrapper","magicArrayAdaptor","dataConfigurator","Parent","proto","data","isObject","warnIfDebug","combine$1","prop","Computation","_Model","signature","isReadonly","setter","computationContext","dependencies","childByKey","deps","boundsSensitive","shouldCapture","capture","adapt","startCapturing","getter","message","console","groupCollapsed","functionBody","prettify","getterString","stack","getterUseStack","truncateStack","error","groupEnd","stopCapturing","setDependencies","_handleChange","clearUnresolveds","hasOwnProperty","child","ComputationChild","mark","Model","RootModel","changes","mappings","computations","applyChanges","_changeHash","flush","compute","computation","has","origin","wrapper","shouldTeardown","_mark","retrieve","updateFromBindings","cascade","constructHook","registryNames","uid","HookQueue","hook","inProcess","queue","begin","getChildQueue","prefix$1","styles","getElementsByTagName","s","cssText","css$1","selectorsPattern","commentsPattern","selectorUnitPattern","excludePattern","dataRvcGuidPattern","uid$1","cssConfigurator","noCssTransform","transformCss","cssId","adaptConfigurator","combine$3","ensureArray","registryNames$1","Registry","useDefaults","configure","registry","create","_fn","isOwner","registries","custom","templateConfigurator","defaultKeys","isStandardKey","makeObj","isBlacklisted","order","config","c","configHook","initHook","renderHook$1","completeHook$1","listen","directive","unlisten","ComponentConstructor","COMPONENT","p","content","_partials","yielders","container","construct","_inlinePartials","childData","t","resolve$1","initialise","isolated","resolveAliases","aliases","Mustache","isStatic","_Mustache","getString","safeToStringValue","string","refName","getPartialTemplate","named","setTemplate","partialTemplate","forceResetTemplate","RepeatedFragment","iterations","indexRef","keyRef","indexByKey","pendingNewIndices","previousIterations","createIteration","refs","getRefs","z","iteration","unrenderAndDestroy$1","updatePostShuffle","wasArray","toRemove","oldKeys","_fragment","newLength","indices","previousNewIndex","reinsertFrom","existingFragment","sectionType","templateSectionType","SECTION_UNLESS","SECTION_IF","SECTION_EACH","lastType","getType","newFragment","SECTION_WITH","SECTION_IF_WITH","isEmpty","fragmentShouldExist","elementCache","ieBug","ieBlacklist","TABLE","THEAD","TBODY","TR","SELECT","queryResult","querySelector","queryAllResult","querySelectorAll","numNodes","j","html","insertHtml","decodeCharacterReferences","containerFragment","propertyNames","accept-charset","accesskey","bgcolor","class","codebase","colspan","contenteditable","datetime","dirname","for","http-equiv","ismap","maxlength","novalidate","pubdate","readonly","rowspan","tabindex","usemap","determineNameAndNamespace","updateDelegate","booleanAttributes","propertyName","useProperty","isTwoway","isBoolean","getUpdateDelegate","div$1","isSvg","svg$1","parseAttributes","notIn","missingDecorator","dynamicName","dynamicArgs","d","nameFragment","argsFragment","intermediary","warnOnce","missingPlugin","nameChanged","starMaps","wildcardCache","eventPattern","argumentsPattern","dollarArgsPattern","passthru","models","argsFn","action","g","ref","argMatch","argument","dollarMatch","resolveReference","createFunction","passedArgs","obj","oldEvent","fireEvent","fatal","original","eventPlugin","prefix$2","isClient","prefixCache","testStyle","style","camelCase","capped","charAt","substring","vendors","vendor","prefix$3","visible","hidden","prefix$4","i$2","onChange","onHide","onShow","number","from","to","delta","intermediate","min","interpolate","properties","hasOwn","unprefixPattern","vendorPattern","createTransitions","canUseCssTransitions","cannotUseCssTransitions","TRANSITION","TRANSITIONEND","CSS_TRANSITIONS_ENABLED","TRANSITION_DURATION","TRANSITION_PROPERTY","TRANSITION_TIMING_FUNCTION","webkitTransition","changedProperties","setTimeout","checkComplete","jsTransitionsComplete","cssTransitionsComplete","isIntro","transitionEndHandler","unprefix","hashPrefix","hyphenate","duration","originalValue","propertiesToTransitionInJs","getStyle","Ticker","step","_prop","delay","createTransitions$1","getComputedStyle","legacy","params","animateStyle","setStyle","fulfil","computedStyle","current","props","processParams","originalStyle","completed","noReset","resetStyle","_manager","twowayBinding","isUnresolved","warnAboutAmbiguity","findParentForm","resetValue","promise","flushChanges","batch","previousBatch","addToArray","fragments","observer","deferredObservers","immediateObservers","transitionManager","thing","detachQueue","task","postRender","_batch","tasks","updateHook","arrayProto","unrenderHook$1","badArguments","noRegistryFunctionReturn","teardownHook","errorMessage$1","TEMPLATE_VERSION","mathml","xlink","xml","xmlns","namespaces","ns","createElementNS","div","methodNames","makeFunction","i$1","unprefixed","j$1","prefixed","substr","cloneNode","exportedShims","hasDontEnumBug","propertyIsEnumerable","dontEnums","dontEnumsLength","TypeError","needle","mapper","isActuallyString","mapped","reduce","opt_initialValue","valueIsSet","filtered","every","iterator","Function","Empty","ctx","Event","head","origCreateElement","appearsToBeIELessEqual8","property","currentTarget","srcElement","timeStamp","preventDefault","returnValue","stopPropagation","cancelBubble","listener","listeners","detachEvent","firstChild","getPixelSize","fontSize","sizeWithSuffix","size","getBorderPixelSize","parentElement","currentStyle","rootSize","clientWidth","clientHeight","bcr","borderSizes","display","position","width","height","borderRight","getBoundingClientRect","right","left","setShortStyleProperty","borderSuffix","b","l","CSSStyleDeclaration","normalProps","fontWeight","lineHeight","letterSpacing","getPropertyPriority","getPropertyValue","removeProperty","setProperty","getPropertyCSSValue","desc","F","stringMiddlePattern","escapeSequencePattern","lineContinuationPattern","INVERTED","CLOSING","COMMENT","DELIMCHANGE","CLOSING_TAG","INLINE_PARTIAL","NUMBER_LITERAL","STRING_LITERAL","ARRAY_LITERAL","OBJECT_LITERAL","BOOLEAN_LITERAL","REGEXP_LITERAL","GLOBAL","KEY_VALUE_PAIR","REFERENCE","REFINEMENT","MEMBER","PREFIX_OPERATOR","BRACKETED","CONDITIONAL","INFIX_OPERATOR","INVOCATION","ELSE","ELSEIF","expectedExpression","expectedParen","numberPattern$1","globals","keywords","getSingleQuotedString","makeQuotedStringMatcher","getDoubleQuotedString","namePattern$1","identifier","regexpPattern","prefixPattern","readTypeOf","makePrefixSequenceMatcher","legalReference","relaxedName","symbol","fallthrough","parser","expression","matchString","allowWhitespace","readExpression","matcher","prefixOperators","readMemberOrInvocation","readLogicalOr","makeInfixSequenceMatcher","readTypeof","remaining","infixOperators","Parser","ParseError","readLogicalOr$1","arrayMemberPattern","yieldPattern","handlebarsBlockCodes","each","if","if-with","with","unless","elsePattern","elsePattern$1","legalAlias","asRE","indexRefPattern","keyIndexRefPattern","handlebarsBlockPattern","pattern$1","regExpCache","htmlEntities","quot","amp","apos","lt","gt","nbsp","iexcl","cent","pound","curren","yen","brvbar","sect","uml","copy","ordf","laquo","not","shy","reg","macr","deg","plusmn","sup2","sup3","acute","micro","para","middot","cedil","sup1","ordm","raquo","frac14","frac12","frac34","iquest","Agrave","Aacute","Acirc","Atilde","Auml","Aring","AElig","Ccedil","Egrave","Eacute","Ecirc","Euml","Igrave","Iacute","Icirc","Iuml","ETH","Ntilde","Ograve","Oacute","Ocirc","Otilde","Ouml","times","Oslash","Ugrave","Uacute","Ucirc","Uuml","Yacute","THORN","szlig","agrave","aacute","acirc","atilde","auml","aring","aelig","ccedil","egrave","eacute","ecirc","euml","igrave","iacute","icirc","iuml","eth","ntilde","ograve","oacute","ocirc","otilde","ouml","divide","oslash","ugrave","uacute","ucirc","uuml","yacute","thorn","yuml","OElig","oelig","Scaron","scaron","Yuml","fnof","circ","tilde","Alpha","Beta","Gamma","Delta","Epsilon","Zeta","Eta","Theta","Iota","Kappa","Lambda","Mu","Nu","Xi","Omicron","Pi","Rho","Sigma","Tau","Upsilon","Phi","Chi","Psi","Omega","alpha","beta","gamma","epsilon","zeta","eta","theta","iota","kappa","lambda","mu","nu","xi","omicron","pi","rho","sigmaf","sigma","tau","upsilon","phi","chi","psi","omega","thetasym","upsih","piv","ensp","emsp","thinsp","zwnj","zwj","lrm","rlm","ndash","mdash","lsquo","rsquo","sbquo","ldquo","rdquo","bdquo","dagger","Dagger","bull","hellip","permil","prime","Prime","lsaquo","rsaquo","oline","frasl","euro","image","weierp","real","trade","alefsym","larr","uarr","rarr","darr","harr","crarr","lArr","uArr","rArr","dArr","hArr","forall","part","exist","empty","nabla","isin","notin","ni","prod","sum","minus","lowast","radic","infin","ang","and","or","cap","cup","int","there4","sim","cong","asymp","ne","equiv","le","ge","sub","sup","nsub","sube","supe","oplus","otimes","perp","sdot","lceil","rceil","lfloor","rfloor","lang","rang","loz","spades","clubs","hearts","diams","controlCharacters","entityPattern","lessThan","greaterThan","leadingLinebreak","trailingLinebreak","contiguousWhitespace","preserveWhitespaceElements","leadingWhitespace$1","trailingWhitespace","leadingNewLine","trailingNewLine","delimiterChangePattern","whitespacePattern","delimiterChangeToken","exclude","closingTagPattern","attributeNamePattern","unquotedAttributeValueTextPattern","leadingWhitespace","lineStart","lines","lineEnds","line","lineEnd","read","leftover","postProcess","converters","getLinePos","char","columnNum","lineNum","numTabs","annotation","match","character","shortMessage","matchPattern","nextChar","Child","ExpressionParser","Parser$1","specials","true","false","null","specialsPattern","numberPattern","placeholderPattern","placeholderAtStartPattern","onlyWhitespace","JsonParser","placeholder","special","stringLiteral","readStringLiteral","$1","pair","getKeyValuePair","valueToken","methodCallPattern","methodCallExcessPattern","disallowedContents","tagNamePattern","validTagNameFollower","onPattern","proxyEventPattern","reservedEventNames","directives","intro-outro","intro","outro","li","dt","dd","rt","rp","optgroup","thead","tbody","tfoot","tr","td","th","OPEN_COMMENT","CLOSE_COMMENT","partialDefinitionSectionPattern","startPattern","namePattern","finishPattern","STANDARD_READERS","readPartial","readUnescaped","readSection","readYielder","readInterpolator","readComment","TRIPLE_READERS","readTriple","STATIC_READERS","StandardParser","READERS","readMustache","readHtmlComment","readElement","readText","PARTIAL_READERS","readPartialDefinitionComment","readPartialDefinitionSection","tripleDelimiters","staticDelimiters","staticTripleDelimiters","standardDelimiters","delimiters","tags","isTriple","open","close","readers","sortMustacheTags","sectionDepth","elementStack","script","sanitize","elements","eventAttributes","stripComments","preserveWhitespace","sanitizeElements","sanitizeEventAttributes","includeLinePositions","textOnlyMode","cleanup","readTemplate","requestAnimationFrame","parseOptions","parser$1","fromId","isHashedId","isParsed","getParseOptions","createHelper","createHelper$1","doParse","parseIfString","getDynamicTemplate","_config","extendPartials","captureGroup","lastTime","currTime","timeToCall","rAF","getTime","performance","tickers","running","tick","elapsed","eased","abort","prefixers","KeyModel","dependant","KeypathModel","hasProp","originatingModel","indexModels","unresolvedByKey","ticker","unescapeKey","adaptor","getPrefixer","fulfilPromise","applyValue","parentValue","createBranch","previousOriginatingModel","specificKey","hasKey","branch","discard","existingMatches","_loop","member","getIndexModel","fragmentIndex","getKeyModel","keypathModel","comparator","oldArray","newArray","oldLength","usedIndices","firstUnusedIndex","_merged","dep","updateKeypathDependants","_teardown","_updateFromBindings","_updateKeypathDependants","functionCache","ExpressionProxy","ReferenceExpressionProxy","baseResolver","members","selectedOption","selectedIndex","element$1","colonIndex","namespacePrefix","updateId","updateMultipleSelectValue","updateSelectValue","updateValue","updateContentEditableValue","updateRadioValue","updateRadioName","updateCheckboxName","updateIEStyleAttribute","updateBoolean","updateNamespacedAttribute","updateAttribute","updateClassName","valueAttribute","className","setAttributeNS","haystack","enqueue","_eventQueue","dequeue","getPotentialWildcardMatches","starMap","wildcardKeypath","getStarMap","star","num","binary","ones","parseInt","digit","_noArg","getWildcardNames","fireEventAs","subscribers","initialFire","_subs","notifySubscribers","fullName","originalEvent","stopEvent","hyphenatedStr","interpol","_liveQueries","description","all","res","clearTimeout","bindName","bindChecked","typeAttribute","nameAttribute","_ref","enumerable","validate","childValue","parentIsFn","childIsFn","callDataFunction","fromProperties","primary","secondary","fnBody","tabs","minIndent","prev","Infinity","truncated","createFunctionFromString","hasThis","getComputationSignature","setterString","welcome","initialiseProperties","deprecateRactiveData","getAdaptors","computed","combine","protoAdapt","lookup","modifyArrays","_liveComponentQueries","hookQueue","childQueue","trim$1","extractString","unit","transformSelector","selectorUnits","modifiers","transformed","appended","prepended","dataAttr","selectors","superMethod","getSuperMethod","_parent","hasSuper","oldSuper","_super","_method","_ret","getMessage","deprecated","correct","isError","deprecateOption","deprecatedOption","deprecate","append","extendOtherMethods","userOptions","getElement","logIfDebug","noIntro","then","getComponentConstructor","findInstance","_Parent","ElementConstructor","guid","counter","placeholderId","collect","dest","partial","collection","rerender","others","removeChild","notEmptyString","observers","createObserver","keypaths","wildcardIndex","_model","getComparator","JSON","stringify","compare","isDetached","fireInsertHook","otherNode","compareDocumentPosition","bitmask","ancestryA","getAncestry","ancestryB","oldestA","lastItem","oldestB","mutualAncestor","fragmentA","fragmentB","indexA","indexB","getParent","ancestry","ancestor","getOptions","wrap$1","force","needsSuper$1","unwrap","addRegistries","addOtherOptions","addRegistry","needsSuper","extendOne","subClass","superClass","setPrototypeOf","Constructor","window","document","hasConsole","navigator","appName","warn","log","printWarning","implementation","hasFeature","refPattern","splitPattern","escapeKeyPattern","unescapeKeyPattern","alreadyWarned","welcomeIntro","welcomeMessage","hasGroup","_Promise","deprecations","replacement","arg","PENDING","FULFILLED","REJECTED","dispatchHandlers","makeResolver","reject","fulfilledHandlers","rejectedHandlers","state","newState","makeDispatcher","wait","onFulfilled","onRejected","promise2","processResolutionHandler","forward","p1result","promises","processPromise","reason","TransitionManager","intros","outros","totalChildren","outroChildren","outrosComplete","addChild","list","decrementOutros","check","decrementTotal","detachNodes","_detachNodes","ready","changeHook","returnPromise","global","factory","exports","module","define","amd","parts","format","_len2","_key2","_len3","_key3","isFinite","arrayLike","called","resolvePromise","rejectPromise","y","tm","spliceArguments","removeStart","removeEnd","balance","getSpliceEquivalent","output","getElementById","sources","tag","readNumberLiteral$1","readBooleanLiteral","okQuote","literal","done","next","charCodeAt","readKey","token","readKeyValuePair","refKey","k","readKeyValuePairs","pairs","keyValuePairs","readObjectLiteral","readExpressionList","expr","expressions","readArrayLiteral","expressionList","readNumberLiteral","readLiteral","readReference","startPos","prefix","lastDotIndex","relaxedNames","lastIndexOf","readBracketedExpression","readPrimary","readRefinement","strictRefinement","refinement","getConditional","ifTrue","ifFalse","readExpressionOrReference","expectedFollowers","flattenExpression","extractRefs","refineExpression","mustache","referenceExpression","getReferenceExpression","rx","yielder","readClosing","closing","readElse","readElseIf","readAliases","alias","readAlias","section","hasElse","block","unlessBlock","conditions","closed","expectedClose","aliasOnly","extra","createUnlessBlock","combine$2","invert","parensIfNecessary","triple","escapeRegExp","getLowestIndex","needles","search","entity","code","fromCharCode","validateCode","disallowed","barrier","inside","inAttribute","stripStandalones","backOne","backTwo","lastSectionItem","isString","isComment","isSection","trimWhitespace","leadingPattern","trailingPattern","removeLeadingWhitespace","removeTrailingWhitespace","previousItem","preserveWhitespaceInsideFragment","removeLeadingWhitespaceInsideFragment","removeTrailingWhitespaceInsideFragment","isPreserveWhitespaceElement","readDelimiterChange","opening","readMustacheOfType","reader","rewind","readClosingTag","readAttribute","attr","readAttributeValue","valueStart","startDepth","readQuotedAttributeValue","readUnquotedAttributeValue","readUnquotedAttributeValueToken","text","tokens","quoteMark","readQuotedStringToken","processDirective","parentParser","directiveName","directiveArgs","addProxyEvent","selfClosing","hasPartials","closingTag","lowerCaseName","canContain","closingTagName","endIndex","comment","endPattern","helper","noThrow","textContent","val","initial","existingPartials","newPartials","overwrite","badReference","localViewmodel","hasContextChain","crossedComponentBoundary","repeater","prefixKeypath","rootKeypath","rootDot","relativeKeypath","registryName","getPartialFromRegistry","findParentPartial","findOwner","findConstructor","hasIndexRef"],"mappings":"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GAEnBwoB,IAAiBC,KAAM,GAAIC,IAAK,GAAIC,KAAM,GAAIC,GAAI,GAAIC,GAAI,GAAIC,KAAM,IAAKC,MAAO,IAAKC,KAAM,IAAKC,MAAO,IAAKC,OAAQ,IAAKC,IAAK,IAAKC,OAAQ,IAAKC,KAAM,IAAKC,IAAK,IAAKC,KAAM,IAAKC,KAAM,IAAKC,MAAO,IAAKC,IAAK,IAAKC,IAAK,IAAKC,IAAK,IAAKC,KAAM,IAAKC,IAAK,IAAKC,OAAQ,IAAKC,KAAM,IAAKC,KAAM,IAAKC,MAAO,IAAKC,MAAO,IAAKC,KAAM,IAAKC,OAAQ,IAAKC,MAAO,IAAKC,KAAM,IAAKC,KAAM,IAAKC,MAAO,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,MAAO,IAAKC,OAAQ,IAAKC,KAAM,IAAKC,MAAO,IAAKC,MAAO,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,MAAO,IAAKC,KAAM,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,MAAO,IAAKC,KAAM,IAAKC,IAAK,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,MAAO,IAAKC,OAAQ,IAAKC,KAAM,IAAKC,MAAO,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,MAAO,IAAKC,KAAM,IAAKC,OAAQ,IAAKC,MAAO,IAAKC,MAAO,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,MAAO,IAAKC,OAAQ,IAAKC,KAAM,IAAKC,MAAO,IAAKC,MAAO,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,MAAO,IAAKC,KAAM,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,MAAO,IAAKC,KAAM,IAAKC,IAAK,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,MAAO,IAAKC,OAAQ,IAAKC,KAAM,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,MAAO,IAAKC,KAAM,IAAKC,OAAQ,IAAKC,MAAO,IAAKC,KAAM,IAAKC,MAAO,IAAKC,MAAO,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,KAAM,IAAKC,KAAM,IAAKC,KAAM,IA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"}