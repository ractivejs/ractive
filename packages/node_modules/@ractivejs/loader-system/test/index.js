/* eslint-env browser, qunit */
import { translate } from '@ractivejs/loader-system'

QUnit.module('loader-system')

// The loader effectivelly just a wrapper around toParts and toCJS.

const specs = [
  'reference',
  'reordered',
  'script-only',
  'style-only',
  'template-only',
  'links-only',
  'duplicate-link-href',
  'duplicate-link-name',
  'empty-top-levels',
  'script-with-mustache',
  'style-with-mustache',
  'duplicate-require',
  'non-dependency-requires'
]

specs.forEach(spec => {
  QUnit.test(spec, assert => {
    const source = fetch(`/base/test/samples/${spec}/component.ractive.html`).then(r => r.text())
    const expectedCode = fetch(`/base/test/samples/${spec}/component.js`).then(r => r.text())
    const expectedMap = fetch(`/base/test/samples/${spec}/component.js.map`).then(r => r.json())

    return Promise.all([source, expectedCode, expectedMap]).then(([source, expectedCode, expectedMap]) => {
      const load = {name: `component.ractive.html`, source, metadata: {}}
      const code = translate(load)

      assert.strictEqual(code, expectedCode)
      assert.deepEqual(load.metadata.sourceMap, expectedMap)
    })
  })
})
