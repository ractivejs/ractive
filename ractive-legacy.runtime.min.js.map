{"version":3,"file":"ractive-legacy.runtime.min.js","sources":["ractive-legacy.runtime.js"],"sourcesContent":["/*\n\tRactive.js v0.8.0-edge\n\tSat Apr 02 2016 12:54:14 GMT+0000 (UTC) - commit 330ec64a4420831a067d0144f06e0245aa48b1b4\n\n\thttp://ractivejs.org\n\thttp://twitter.com/RactiveJS\n\n\tReleased under the MIT License.\n*/\n\n\n(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n  typeof define === 'function' && define.amd ? define(factory) :\n  global.Ractive = factory();\n}(this, function () { 'use strict';\n\nvar inherits = function (subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass);\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      enumerable: false,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n};\n\nvar toConsumableArray = function (arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) arr2[i] = arr[i];\n\n    return arr2;\n  } else {\n    return Array.from(arr);\n  }\n};\n\nvar classCallCheck = function (instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n};\n\n  /*global console, navigator */\n\n  var win = typeof window !== 'undefined' ? window : null;\n  var doc = win ? document : null;\n\n  var isClient = !!doc;\n  var isJsdom = typeof navigator !== 'undefined' && /jsDom/.test(navigator.appName);\n  var hasConsole = typeof console !== 'undefined' && typeof console.warn === 'function' && typeof console.warn.apply === 'function';\n\n  var magicSupported = undefined;\n  try {\n  \tObject.defineProperty({}, 'test', { value: 0 });\n  \tmagicSupported = true;\n  } catch (e) {\n  \tmagicSupported = false;\n  }\n\n  var svg = doc ? doc.implementation.hasFeature('http://www.w3.org/TR/SVG11/feature#BasicStructure', '1.1') : false;\n\n  var vendors = ['o', 'ms', 'moz', 'webkit'];\n\n  var defaults = {\n  \t// render placement:\n  \tel: void 0,\n  \tappend: false,\n\n  \t// template:\n  \ttemplate: null,\n\n  \t// parse:\n  \tdelimiters: ['{{', '}}'],\n  \ttripleDelimiters: ['{{{', '}}}'],\n  \tstaticDelimiters: ['[[', ']]'],\n  \tstaticTripleDelimiters: ['[[[', ']]]'],\n  \tcsp: true,\n  \tinterpolate: false,\n  \tpreserveWhitespace: false,\n  \tsanitize: false,\n  \tstripComments: true,\n\n  \t// data & binding:\n  \tdata: {},\n  \tcomputed: {},\n  \tmagic: false,\n  \tmodifyArrays: true,\n  \tadapt: [],\n  \tisolated: false,\n  \ttwoway: true,\n  \tlazy: false,\n\n  \t// transitions:\n  \tnoIntro: false,\n  \ttransitionsEnabled: true,\n  \tcomplete: void 0,\n\n  \t// css:\n  \tcss: null,\n  \tnoCssTransform: false\n  };\n\n  var refPattern = /\\[\\s*(\\*|[0-9]|[1-9][0-9]+)\\s*\\]/g;\n  var splitPattern = /([^\\\\](?:\\\\\\\\)*)\\./;\n  var escapeKeyPattern = /\\\\|\\./g;\n  var unescapeKeyPattern = /((?:\\\\)+)\\1|\\\\(\\.)/g;\n\n  function escapeKey(key) {\n  \tif (typeof key === 'string') {\n  \t\treturn key.replace(escapeKeyPattern, '\\\\$&');\n  \t}\n\n  \treturn key;\n  }\n\n  function normalise(ref) {\n  \treturn ref ? ref.replace(refPattern, '.$1') : '';\n  }\n\n  function splitKeypath(keypath) {\n  \tvar result = [],\n  \t    match = undefined;\n\n  \tkeypath = normalise(keypath);\n\n  \twhile (match = splitPattern.exec(keypath)) {\n  \t\tvar index = match.index + match[1].length;\n  \t\tresult.push(keypath.substr(0, index));\n  \t\tkeypath = keypath.substr(index + 1);\n  \t}\n\n  \tresult.push(keypath);\n\n  \treturn result;\n  }\n\n  function unescapeKey(key) {\n  \tif (typeof key === 'string') {\n  \t\treturn key.replace(unescapeKeyPattern, '$1$2');\n  \t}\n\n  \treturn key;\n  }\n\n  function noop () {}\n\n  var alreadyWarned = {};\n  var log;\n  var printWarning;\n  var welcome;\n  if (hasConsole) {\n  \t(function () {\n  \t\tvar welcomeIntro = ['%cRactive.js %c0.8.0-edge %cin debug mode, %cmore...', 'color: rgb(114, 157, 52); font-weight: normal;', 'color: rgb(85, 85, 85); font-weight: normal;', 'color: rgb(85, 85, 85); font-weight: normal;', 'color: rgb(82, 140, 224); font-weight: normal; text-decoration: underline;'];\n  \t\tvar welcomeMessage = 'You\\'re running Ractive 0.8.0-edge in debug mode - messages will be printed to the console to help you fix problems and optimise your application.\\n\\nTo disable debug mode, add this line at the start of your app:\\n  Ractive.DEBUG = false;\\n\\nTo disable debug mode when your app is minified, add this snippet:\\n  Ractive.DEBUG = /unminified/.test(function(){/*unminified*/});\\n\\nGet help and support:\\n  http://docs.ractivejs.org\\n  http://stackoverflow.com/questions/tagged/ractivejs\\n  http://groups.google.com/forum/#!forum/ractive-js\\n  http://twitter.com/ractivejs\\n\\nFound a bug? Raise an issue:\\n  https://github.com/ractivejs/ractive/issues\\n\\n';\n\n  \t\twelcome = function () {\n  \t\t\tvar hasGroup = !!console.groupCollapsed;\n  \t\t\tconsole[hasGroup ? 'groupCollapsed' : 'log'].apply(console, welcomeIntro);\n  \t\t\tconsole.log(welcomeMessage);\n  \t\t\tif (hasGroup) {\n  \t\t\t\tconsole.groupEnd(welcomeIntro);\n  \t\t\t}\n\n  \t\t\twelcome = noop;\n  \t\t};\n\n  \t\tprintWarning = function (message, args) {\n  \t\t\twelcome();\n\n  \t\t\t// extract information about the instance this message pertains to, if applicable\n  \t\t\tif (typeof args[args.length - 1] === 'object') {\n  \t\t\t\tvar options = args.pop();\n  \t\t\t\tvar ractive = options ? options.ractive : null;\n\n  \t\t\t\tif (ractive) {\n  \t\t\t\t\t// if this is an instance of a component that we know the name of, add\n  \t\t\t\t\t// it to the message\n  \t\t\t\t\tvar _name = undefined;\n  \t\t\t\t\tif (ractive.component && (_name = ractive.component.name)) {\n  \t\t\t\t\t\tmessage = '<' + _name + '> ' + message;\n  \t\t\t\t\t}\n\n  \t\t\t\t\tvar node = undefined;\n  \t\t\t\t\tif (node = options.node || ractive.fragment && ractive.fragment.rendered && ractive.find('*')) {\n  \t\t\t\t\t\targs.push(node);\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\tconsole.warn.apply(console, ['%cRactive.js: %c' + message, 'color: rgb(114, 157, 52);', 'color: rgb(85, 85, 85);'].concat(args));\n  \t\t};\n\n  \t\tlog = function () {\n  \t\t\tconsole.log.apply(console, arguments);\n  \t\t};\n  \t})();\n  } else {\n  \tprintWarning = log = welcome = noop;\n  }\n\n  function format(message, args) {\n  \treturn message.replace(/%s/g, function () {\n  \t\treturn args.shift();\n  \t});\n  }\n\n  function fatal(message) {\n  \tfor (var _len = arguments.length, args = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n  \t\targs[_key - 1] = arguments[_key];\n  \t}\n\n  \tmessage = format(message, args);\n  \tthrow new Error(message);\n  }\n\n  function logIfDebug() {\n  \tif (Ractive.DEBUG) {\n  \t\tlog.apply(null, arguments);\n  \t}\n  }\n\n  function warn(message) {\n  \tfor (var _len2 = arguments.length, args = Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {\n  \t\targs[_key2 - 1] = arguments[_key2];\n  \t}\n\n  \tmessage = format(message, args);\n  \tprintWarning(message, args);\n  }\n\n  function warnOnce(message) {\n  \tfor (var _len3 = arguments.length, args = Array(_len3 > 1 ? _len3 - 1 : 0), _key3 = 1; _key3 < _len3; _key3++) {\n  \t\targs[_key3 - 1] = arguments[_key3];\n  \t}\n\n  \tmessage = format(message, args);\n\n  \tif (alreadyWarned[message]) {\n  \t\treturn;\n  \t}\n\n  \talreadyWarned[message] = true;\n  \tprintWarning(message, args);\n  }\n\n  function warnIfDebug() {\n  \tif (Ractive.DEBUG) {\n  \t\twarn.apply(null, arguments);\n  \t}\n  }\n\n  function warnOnceIfDebug() {\n  \tif (Ractive.DEBUG) {\n  \t\twarnOnce.apply(null, arguments);\n  \t}\n  }\n\n  // TODO: deprecate in future release\n  var deprecations = {\n  \tconstruct: {\n  \t\tdeprecated: 'beforeInit',\n  \t\treplacement: 'onconstruct'\n  \t},\n  \trender: {\n  \t\tdeprecated: 'init',\n  \t\tmessage: 'The \"init\" method has been deprecated ' + 'and will likely be removed in a future release. ' + 'You can either use the \"oninit\" method which will fire ' + 'only once prior to, and regardless of, any eventual ractive ' + 'instance being rendered, or if you need to access the ' + 'rendered DOM, use \"onrender\" instead. ' + 'See http://docs.ractivejs.org/latest/migrating for more information.'\n  \t},\n  \tcomplete: {\n  \t\tdeprecated: 'complete',\n  \t\treplacement: 'oncomplete'\n  \t}\n  };\n\n  var Hook = (function () {\n  \tfunction Hook(event) {\n  \t\tclassCallCheck(this, Hook);\n\n  \t\tthis.event = event;\n  \t\tthis.method = 'on' + event;\n  \t\tthis.deprecate = deprecations[event];\n  \t}\n\n  \tHook.prototype.call = function call(method, ractive, arg) {\n  \t\tif (ractive[method]) {\n  \t\t\targ ? ractive[method](arg) : ractive[method]();\n  \t\t\treturn true;\n  \t\t}\n  \t};\n\n  \tHook.prototype.fire = function fire(ractive, arg) {\n  \t\tthis.call(this.method, ractive, arg);\n\n  \t\t// handle deprecations\n  \t\tif (!ractive[this.method] && this.deprecate && this.call(this.deprecate.deprecated, ractive, arg)) {\n  \t\t\tif (this.deprecate.message) {\n  \t\t\t\twarnIfDebug(this.deprecate.message);\n  \t\t\t} else {\n  \t\t\t\twarnIfDebug('The method \"%s\" has been deprecated in favor of \"%s\" and will likely be removed in a future release. See http://docs.ractivejs.org/latest/migrating for more information.', this.deprecate.deprecated, this.deprecate.replacement);\n  \t\t\t}\n  \t\t}\n\n  \t\t// TODO should probably use internal method, in case ractive.fire was overwritten\n  \t\targ ? ractive.fire(this.event, arg) : ractive.fire(this.event);\n  \t};\n\n  \treturn Hook;\n  })();\n\n  var toString = Object.prototype.toString;\n  // thanks, http://perfectionkills.com/instanceof-considered-harmful-or-how-to-write-a-robust-isarray/\n\n  function isArray(thing) {\n  \treturn toString.call(thing) === '[object Array]';\n  }\n\n  function isEqual(a, b) {\n  \tif (a === null && b === null) {\n  \t\treturn true;\n  \t}\n\n  \tif (typeof a === 'object' || typeof b === 'object') {\n  \t\treturn false;\n  \t}\n\n  \treturn a === b;\n  }\n\n  // http://stackoverflow.com/questions/18082/validate-numbers-in-javascript-isnumeric\n\n  function isNumeric(thing) {\n  \treturn !isNaN(parseFloat(thing)) && isFinite(thing);\n  }\n\n  function isObject(thing) {\n  \treturn thing && toString.call(thing) === '[object Object]';\n  }\n\n  function addToArray(array, value) {\n  \tvar index = array.indexOf(value);\n\n  \tif (index === -1) {\n  \t\tarray.push(value);\n  \t}\n  }\n\n  function arrayContains(array, value) {\n  \tfor (var i = 0, c = array.length; i < c; i++) {\n  \t\tif (array[i] == value) {\n  \t\t\treturn true;\n  \t\t}\n  \t}\n\n  \treturn false;\n  }\n\n  function arrayContentsMatch(a, b) {\n  \tvar i;\n\n  \tif (!isArray(a) || !isArray(b)) {\n  \t\treturn false;\n  \t}\n\n  \tif (a.length !== b.length) {\n  \t\treturn false;\n  \t}\n\n  \ti = a.length;\n  \twhile (i--) {\n  \t\tif (a[i] !== b[i]) {\n  \t\t\treturn false;\n  \t\t}\n  \t}\n\n  \treturn true;\n  }\n\n  function ensureArray(x) {\n  \tif (typeof x === 'string') {\n  \t\treturn [x];\n  \t}\n\n  \tif (x === undefined) {\n  \t\treturn [];\n  \t}\n\n  \treturn x;\n  }\n\n  function lastItem(array) {\n  \treturn array[array.length - 1];\n  }\n\n  function removeFromArray(array, member) {\n  \tif (!array) {\n  \t\treturn;\n  \t}\n\n  \tvar index = array.indexOf(member);\n\n  \tif (index !== -1) {\n  \t\tarray.splice(index, 1);\n  \t}\n  }\n\n  function toArray(arrayLike) {\n  \tvar array = [],\n  \t    i = arrayLike.length;\n  \twhile (i--) {\n  \t\tarray[i] = arrayLike[i];\n  \t}\n\n  \treturn array;\n  }\n\n  var _Promise;\n  var PENDING = {};\n  var FULFILLED = {};\n  var REJECTED = {};\n  if (typeof Promise === 'function') {\n  \t// use native Promise\n  \t_Promise = Promise;\n  } else {\n  \t_Promise = function (callback) {\n  \t\tvar fulfilledHandlers = [],\n  \t\t    rejectedHandlers = [],\n  \t\t    state = PENDING,\n  \t\t    result,\n  \t\t    dispatchHandlers,\n  \t\t    makeResolver,\n  \t\t    fulfil,\n  \t\t    reject,\n  \t\t    promise;\n\n  \t\tmakeResolver = function (newState) {\n  \t\t\treturn function (value) {\n  \t\t\t\tif (state !== PENDING) {\n  \t\t\t\t\treturn;\n  \t\t\t\t}\n\n  \t\t\t\tresult = value;\n  \t\t\t\tstate = newState;\n\n  \t\t\t\tdispatchHandlers = makeDispatcher(state === FULFILLED ? fulfilledHandlers : rejectedHandlers, result);\n\n  \t\t\t\t// dispatch onFulfilled and onRejected handlers asynchronously\n  \t\t\t\twait(dispatchHandlers);\n  \t\t\t};\n  \t\t};\n\n  \t\tfulfil = makeResolver(FULFILLED);\n  \t\treject = makeResolver(REJECTED);\n\n  \t\ttry {\n  \t\t\tcallback(fulfil, reject);\n  \t\t} catch (err) {\n  \t\t\treject(err);\n  \t\t}\n\n  \t\tpromise = {\n  \t\t\t// `then()` returns a Promise - 2.2.7\n  \t\t\tthen: function (onFulfilled, onRejected) {\n  \t\t\t\tvar promise2 = new _Promise(function (fulfil, reject) {\n\n  \t\t\t\t\tvar processResolutionHandler = function (handler, handlers, forward) {\n\n  \t\t\t\t\t\t// 2.2.1.1\n  \t\t\t\t\t\tif (typeof handler === 'function') {\n  \t\t\t\t\t\t\thandlers.push(function (p1result) {\n  \t\t\t\t\t\t\t\tvar x;\n\n  \t\t\t\t\t\t\t\ttry {\n  \t\t\t\t\t\t\t\t\tx = handler(p1result);\n  \t\t\t\t\t\t\t\t\tresolve(promise2, x, fulfil, reject);\n  \t\t\t\t\t\t\t\t} catch (err) {\n  \t\t\t\t\t\t\t\t\treject(err);\n  \t\t\t\t\t\t\t\t}\n  \t\t\t\t\t\t\t});\n  \t\t\t\t\t\t} else {\n  \t\t\t\t\t\t\t// Forward the result of promise1 to promise2, if resolution handlers\n  \t\t\t\t\t\t\t// are not given\n  \t\t\t\t\t\t\thandlers.push(forward);\n  \t\t\t\t\t\t}\n  \t\t\t\t\t};\n\n  \t\t\t\t\t// 2.2\n  \t\t\t\t\tprocessResolutionHandler(onFulfilled, fulfilledHandlers, fulfil);\n  \t\t\t\t\tprocessResolutionHandler(onRejected, rejectedHandlers, reject);\n\n  \t\t\t\t\tif (state !== PENDING) {\n  \t\t\t\t\t\t// If the promise has resolved already, dispatch the appropriate handlers asynchronously\n  \t\t\t\t\t\twait(dispatchHandlers);\n  \t\t\t\t\t}\n  \t\t\t\t});\n\n  \t\t\t\treturn promise2;\n  \t\t\t}\n  \t\t};\n\n  \t\tpromise['catch'] = function (onRejected) {\n  \t\t\treturn this.then(null, onRejected);\n  \t\t};\n\n  \t\treturn promise;\n  \t};\n\n  \t_Promise.all = function (promises) {\n  \t\treturn new _Promise(function (fulfil, reject) {\n  \t\t\tvar result = [],\n  \t\t\t    pending,\n  \t\t\t    i,\n  \t\t\t    processPromise;\n\n  \t\t\tif (!promises.length) {\n  \t\t\t\tfulfil(result);\n  \t\t\t\treturn;\n  \t\t\t}\n\n  \t\t\tprocessPromise = function (promise, i) {\n  \t\t\t\tif (promise && typeof promise.then === 'function') {\n  \t\t\t\t\tpromise.then(function (value) {\n  \t\t\t\t\t\tresult[i] = value;\n  \t\t\t\t\t\t--pending || fulfil(result);\n  \t\t\t\t\t}, reject);\n  \t\t\t\t} else {\n  \t\t\t\t\tresult[i] = promise;\n  \t\t\t\t\t--pending || fulfil(result);\n  \t\t\t\t}\n  \t\t\t};\n\n  \t\t\tpending = i = promises.length;\n  \t\t\twhile (i--) {\n  \t\t\t\tprocessPromise(promises[i], i);\n  \t\t\t}\n  \t\t});\n  \t};\n\n  \t_Promise.resolve = function (value) {\n  \t\treturn new _Promise(function (fulfil) {\n  \t\t\tfulfil(value);\n  \t\t});\n  \t};\n\n  \t_Promise.reject = function (reason) {\n  \t\treturn new _Promise(function (fulfil, reject) {\n  \t\t\treject(reason);\n  \t\t});\n  \t};\n  }\n\n  var Promise$1 = _Promise;\n\n  // TODO use MutationObservers or something to simulate setImmediate\n  function wait(callback) {\n  \tsetTimeout(callback, 0);\n  }\n\n  function makeDispatcher(handlers, result) {\n  \treturn function () {\n  \t\tvar handler;\n\n  \t\twhile (handler = handlers.shift()) {\n  \t\t\thandler(result);\n  \t\t}\n  \t};\n  }\n\n  function resolve(promise, x, fulfil, reject) {\n  \t// Promise Resolution Procedure\n  \tvar then;\n\n  \t// 2.3.1\n  \tif (x === promise) {\n  \t\tthrow new TypeError('A promise\\'s fulfillment handler cannot return the same promise');\n  \t}\n\n  \t// 2.3.2\n  \tif (x instanceof _Promise) {\n  \t\tx.then(fulfil, reject);\n  \t}\n\n  \t// 2.3.3\n  \telse if (x && (typeof x === 'object' || typeof x === 'function')) {\n  \t\t\ttry {\n  \t\t\t\tthen = x.then; // 2.3.3.1\n  \t\t\t} catch (e) {\n  \t\t\t\treject(e); // 2.3.3.2\n  \t\t\t\treturn;\n  \t\t\t}\n\n  \t\t\t// 2.3.3.3\n  \t\t\tif (typeof then === 'function') {\n  \t\t\t\tvar called, resolvePromise, rejectPromise;\n\n  \t\t\t\tresolvePromise = function (y) {\n  \t\t\t\t\tif (called) {\n  \t\t\t\t\t\treturn;\n  \t\t\t\t\t}\n  \t\t\t\t\tcalled = true;\n  \t\t\t\t\tresolve(promise, y, fulfil, reject);\n  \t\t\t\t};\n\n  \t\t\t\trejectPromise = function (r) {\n  \t\t\t\t\tif (called) {\n  \t\t\t\t\t\treturn;\n  \t\t\t\t\t}\n  \t\t\t\t\tcalled = true;\n  \t\t\t\t\treject(r);\n  \t\t\t\t};\n\n  \t\t\t\ttry {\n  \t\t\t\t\tthen.call(x, resolvePromise, rejectPromise);\n  \t\t\t\t} catch (e) {\n  \t\t\t\t\tif (!called) {\n  \t\t\t\t\t\t// 2.3.3.3.4.1\n  \t\t\t\t\t\treject(e); // 2.3.3.3.4.2\n  \t\t\t\t\t\tcalled = true;\n  \t\t\t\t\t\treturn;\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t\t} else {\n  \t\t\t\tfulfil(x);\n  \t\t\t}\n  \t\t} else {\n  \t\t\tfulfil(x);\n  \t\t}\n  }\n\n  var TransitionManager = (function () {\n  \tfunction TransitionManager(callback, parent) {\n  \t\tclassCallCheck(this, TransitionManager);\n\n  \t\tthis.callback = callback;\n  \t\tthis.parent = parent;\n\n  \t\tthis.intros = [];\n  \t\tthis.outros = [];\n\n  \t\tthis.children = [];\n  \t\tthis.totalChildren = this.outroChildren = 0;\n\n  \t\tthis.detachQueue = [];\n  \t\tthis.outrosComplete = false;\n\n  \t\tif (parent) {\n  \t\t\tparent.addChild(this);\n  \t\t}\n  \t}\n\n  \tTransitionManager.prototype.add = function add(transition) {\n  \t\tvar list = transition.isIntro ? this.intros : this.outros;\n  \t\tlist.push(transition);\n  \t};\n\n  \tTransitionManager.prototype.addChild = function addChild(child) {\n  \t\tthis.children.push(child);\n\n  \t\tthis.totalChildren += 1;\n  \t\tthis.outroChildren += 1;\n  \t};\n\n  \tTransitionManager.prototype.decrementOutros = function decrementOutros() {\n  \t\tthis.outroChildren -= 1;\n  \t\tcheck(this);\n  \t};\n\n  \tTransitionManager.prototype.decrementTotal = function decrementTotal() {\n  \t\tthis.totalChildren -= 1;\n  \t\tcheck(this);\n  \t};\n\n  \tTransitionManager.prototype.detachNodes = function detachNodes() {\n  \t\tthis.detachQueue.forEach(detach);\n  \t\tthis.children.forEach(_detachNodes);\n  \t};\n\n  \tTransitionManager.prototype.remove = function remove(transition) {\n  \t\tvar list = transition.isIntro ? this.intros : this.outros;\n  \t\tremoveFromArray(list, transition);\n  \t\tcheck(this);\n  \t};\n\n  \tTransitionManager.prototype.start = function start() {\n  \t\tthis.intros.concat(this.outros).forEach(function (t) {\n  \t\t\treturn t.start();\n  \t\t});\n  \t\tthis.ready = true;\n  \t\tcheck(this);\n  \t};\n\n  \treturn TransitionManager;\n  })();\n\n  function detach(element) {\n  \telement.detach();\n  }\n\n  function _detachNodes(tm) {\n  \t// _ to avoid transpiler quirk\n  \ttm.detachNodes();\n  }\n\n  function check(tm) {\n  \tif (!tm.ready || tm.outros.length || tm.outroChildren) return;\n\n  \t// If all outros are complete, and we haven't already done this,\n  \t// we notify the parent if there is one, otherwise\n  \t// start detaching nodes\n  \tif (!tm.outrosComplete) {\n  \t\tif (tm.parent && !tm.parent.outrosComplete) {\n  \t\t\ttm.parent.decrementOutros(tm);\n  \t\t} else {\n  \t\t\ttm.detachNodes();\n  \t\t}\n\n  \t\ttm.outrosComplete = true;\n  \t}\n\n  \t// Once everything is done, we can notify parent transition\n  \t// manager and call the callback\n  \tif (!tm.intros.length && !tm.totalChildren) {\n  \t\tif (typeof tm.callback === 'function') {\n  \t\t\ttm.callback();\n  \t\t}\n\n  \t\tif (tm.parent) {\n  \t\t\ttm.parent.decrementTotal();\n  \t\t}\n  \t}\n  }\n\n  var changeHook = new Hook('change');\n\n  var batch = undefined;\n\n  var runloop = {\n  \tstart: function (instance, returnPromise) {\n  \t\tvar promise, fulfilPromise;\n\n  \t\tif (returnPromise) {\n  \t\t\tpromise = new Promise$1(function (f) {\n  \t\t\t\treturn fulfilPromise = f;\n  \t\t\t});\n  \t\t}\n\n  \t\tbatch = {\n  \t\t\tpreviousBatch: batch,\n  \t\t\ttransitionManager: new TransitionManager(fulfilPromise, batch && batch.transitionManager),\n  \t\t\tfragments: [],\n  \t\t\ttasks: [],\n  \t\t\timmediateObservers: [],\n  \t\t\tdeferredObservers: [],\n  \t\t\tinstance: instance\n  \t\t};\n\n  \t\treturn promise;\n  \t},\n\n  \tend: function () {\n  \t\tflushChanges();\n  \t\tbatch = batch.previousBatch;\n  \t},\n\n  \taddFragment: function (fragment) {\n  \t\taddToArray(batch.fragments, fragment);\n  \t},\n\n  \taddObserver: function (observer, defer) {\n  \t\taddToArray(defer ? batch.deferredObservers : batch.immediateObservers, observer);\n  \t},\n\n  \tregisterTransition: function (transition) {\n  \t\ttransition._manager = batch.transitionManager;\n  \t\tbatch.transitionManager.add(transition);\n  \t},\n\n  \t// synchronise node detachments with transition ends\n  \tdetachWhenReady: function (thing) {\n  \t\tbatch.transitionManager.detachQueue.push(thing);\n  \t},\n\n  \tscheduleTask: function (task, postRender) {\n  \t\tvar _batch;\n\n  \t\tif (!batch) {\n  \t\t\ttask();\n  \t\t} else {\n  \t\t\t_batch = batch;\n  \t\t\twhile (postRender && _batch.previousBatch) {\n  \t\t\t\t// this can't happen until the DOM has been fully updated\n  \t\t\t\t// otherwise in some situations (with components inside elements)\n  \t\t\t\t// transitions and decorators will initialise prematurely\n  \t\t\t\t_batch = _batch.previousBatch;\n  \t\t\t}\n\n  \t\t\t_batch.tasks.push(task);\n  \t\t}\n  \t}\n  };\n\n  function dispatch(observer) {\n  \tobserver.dispatch();\n  }\n\n  function flushChanges() {\n  \tvar which = batch.immediateObservers;\n  \tbatch.immediateObservers = [];\n  \twhich.forEach(dispatch);\n\n  \t// Now that changes have been fully propagated, we can update the DOM\n  \t// and complete other tasks\n  \tvar i = batch.fragments.length;\n  \tvar fragment = undefined;\n\n  \twhich = batch.fragments;\n  \tbatch.fragments = [];\n\n  \twhile (i--) {\n  \t\tfragment = which[i];\n\n  \t\t// TODO deprecate this. It's annoying and serves no useful function\n  \t\tvar ractive = fragment.ractive;\n  \t\tchangeHook.fire(ractive, ractive.viewmodel.changes);\n  \t\tractive.viewmodel.changes = {};\n\n  \t\tfragment.update();\n  \t}\n\n  \tbatch.transitionManager.start();\n\n  \twhich = batch.deferredObservers;\n  \tbatch.deferredObservers = [];\n  \twhich.forEach(dispatch);\n\n  \tvar tasks = batch.tasks;\n  \tbatch.tasks = [];\n\n  \tfor (i = 0; i < tasks.length; i += 1) {\n  \t\ttasks[i]();\n  \t}\n\n  \t// If updating the view caused some model blowback - e.g. a triple\n  \t// containing <option> elements caused the binding on the <select>\n  \t// to update - then we start over\n  \tif (batch.fragments.length || batch.immediateObservers.length || batch.deferredObservers.length) return flushChanges();\n  }\n\n  function Ractive$updateModel(keypath, cascade) {\n  \tvar promise = runloop.start(this, true);\n\n  \tif (!keypath) {\n  \t\tthis.viewmodel.updateFromBindings(true);\n  \t} else {\n  \t\tthis.viewmodel.joinAll(splitKeypath(keypath)).updateFromBindings(cascade !== false);\n  \t}\n\n  \trunloop.end();\n\n  \treturn promise;\n  }\n\n  var updateHook = new Hook('update');\n  function Ractive$update(keypath) {\n  \tif (keypath) keypath = splitKeypath(keypath);\n\n  \tvar model = keypath ? this.viewmodel.joinAll(keypath) : this.viewmodel;\n\n  \tvar promise = runloop.start(this, true);\n\n  \tmodel.mark();\n\n  \tif (keypath) {\n  \t\t// there may be unresolved refs that are now resolvable up the context tree\n  \t\tvar _parent = model.parent;\n  \t\twhile (keypath.length && _parent) {\n  \t\t\tif (_parent.clearUnresolveds) _parent.clearUnresolveds(keypath.pop());\n  \t\t\t_parent = _parent.parent;\n  \t\t}\n  \t}\n\n  \trunloop.end();\n\n  \tupdateHook.fire(this, model);\n\n  \treturn promise;\n  }\n\n  // This function takes an array, the name of a mutator method, and the\n  // arguments to call that mutator method with, and returns an array that\n  // maps the old indices to their new indices.\n\n  // So if you had something like this...\n  //\n  //     array = [ 'a', 'b', 'c', 'd' ];\n  //     array.push( 'e' );\n  //\n  // ...you'd get `[ 0, 1, 2, 3 ]` - in other words, none of the old indices\n  // have changed. If you then did this...\n  //\n  //     array.unshift( 'z' );\n  //\n  // ...the indices would be `[ 1, 2, 3, 4, 5 ]` - every item has been moved\n  // one higher to make room for the 'z'. If you removed an item, the new index\n  // would be -1...\n  //\n  //     array.splice( 2, 2 );\n  //\n  // ...this would result in [ 0, 1, -1, -1, 2, 3 ].\n  //\n  // This information is used to enable fast, non-destructive shuffling of list\n  // sections when you do e.g. `ractive.splice( 'items', 2, 2 );\n\n  function getNewIndices(length, methodName, args) {\n  \tvar spliceArguments,\n  \t    newIndices = [],\n  \t    removeStart,\n  \t    removeEnd,\n  \t    balance,\n  \t    i;\n\n  \tspliceArguments = getSpliceEquivalent(length, methodName, args);\n\n  \tif (!spliceArguments) {\n  \t\treturn null; // TODO support reverse and sort?\n  \t}\n\n  \tbalance = spliceArguments.length - 2 - spliceArguments[1];\n\n  \tremoveStart = Math.min(length, spliceArguments[0]);\n  \tremoveEnd = removeStart + spliceArguments[1];\n\n  \tfor (i = 0; i < removeStart; i += 1) {\n  \t\tnewIndices.push(i);\n  \t}\n\n  \tfor (; i < removeEnd; i += 1) {\n  \t\tnewIndices.push(-1);\n  \t}\n\n  \tfor (; i < length; i += 1) {\n  \t\tnewIndices.push(i + balance);\n  \t}\n\n  \t// there is a net shift for the rest of the array starting with index + balance\n  \tif (balance !== 0) {\n  \t\tnewIndices.touchedFrom = spliceArguments[0];\n  \t} else {\n  \t\tnewIndices.touchedFrom = length;\n  \t}\n\n  \treturn newIndices;\n  }\n\n  // The pop, push, shift an unshift methods can all be represented\n  // as an equivalent splice\n  function getSpliceEquivalent(length, methodName, args) {\n  \tswitch (methodName) {\n  \t\tcase 'splice':\n  \t\t\tif (args[0] !== undefined && args[0] < 0) {\n  \t\t\t\targs[0] = length + Math.max(args[0], -length);\n  \t\t\t}\n\n  \t\t\twhile (args.length < 2) {\n  \t\t\t\targs.push(length - args[0]);\n  \t\t\t}\n\n  \t\t\t// ensure we only remove elements that exist\n  \t\t\targs[1] = Math.min(args[1], length - args[0]);\n\n  \t\t\treturn args;\n\n  \t\tcase 'sort':\n  \t\tcase 'reverse':\n  \t\t\treturn null;\n\n  \t\tcase 'pop':\n  \t\t\tif (length) {\n  \t\t\t\treturn [length - 1, 1];\n  \t\t\t}\n  \t\t\treturn [0, 0];\n\n  \t\tcase 'push':\n  \t\t\treturn [length, 0].concat(args);\n\n  \t\tcase 'shift':\n  \t\t\treturn [0, length ? 1 : 0];\n\n  \t\tcase 'unshift':\n  \t\t\treturn [0, 0].concat(args);\n  \t}\n  }\n\n  var arrayProto = Array.prototype;\n\n  function makeArrayMethod (methodName) {\n  \treturn function (keypath) {\n  \t\tvar model = this.viewmodel.joinAll(splitKeypath(keypath));\n  \t\tvar array = model.get();\n\n  \t\tif (!isArray(array)) {\n  \t\t\tthrow new Error('shuffle array method ' + methodName + ' called on non-array at ' + model.getKeypath());\n  \t\t}\n\n  \t\tfor (var _len = arguments.length, args = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n  \t\t\targs[_key - 1] = arguments[_key];\n  \t\t}\n\n  \t\tvar newIndices = getNewIndices(array.length, methodName, args);\n  \t\tvar result = arrayProto[methodName].apply(array, args);\n\n  \t\tvar promise = runloop.start(this, true).then(function () {\n  \t\t\treturn result;\n  \t\t});\n\n  \t\tif (newIndices) {\n  \t\t\tmodel.shuffle(newIndices);\n  \t\t} else {\n  \t\t\tmodel.set(result);\n  \t\t}\n\n  \t\trunloop.end();\n\n  \t\treturn promise;\n  \t};\n  }\n\n  var unshift = makeArrayMethod('unshift');\n\n  var unrenderHook$1 = new Hook('unrender');\n  function Ractive$unrender() {\n  \tif (!this.fragment.rendered) {\n  \t\twarnIfDebug('ractive.unrender() was called on a Ractive instance that was not rendered');\n  \t\treturn Promise$1.resolve();\n  \t}\n\n  \tvar promise = runloop.start(this, true);\n\n  \t// If this is a component, and the component isn't marked for destruction,\n  \t// don't detach nodes from the DOM unnecessarily\n  \tvar shouldDestroy = !this.component || this.component.shouldDestroy || this.shouldDestroy;\n  \tthis.fragment.unrender(shouldDestroy);\n\n  \tremoveFromArray(this.el.__ractive_instances__, this);\n\n  \tunrenderHook$1.fire(this);\n\n  \trunloop.end();\n  \treturn promise;\n  }\n\n  function unlink(here) {\n  \tvar ln = this._links[here];\n\n  \tif (ln) {\n  \t\tln.unlink();\n  \t\tdelete this._links[here];\n  \t\treturn this.set(here, ln.intialValue);\n  \t} else {\n  \t\treturn Promise$1.resolve(true);\n  \t}\n  }\n\n  function Ractive$toHTML() {\n  \treturn this.fragment.toString(true);\n  }\n\n  var PREFIX = '/* Ractive.js component styles */';\n\n  // Holds current definitions of styles.\n  var styleDefinitions = [];\n\n  // Flag to tell if we need to update the CSS\n  var isDirty = false;\n\n  // These only make sense on the browser. See additional setup below.\n  var styleElement = null;\n  var styleSheet = null;\n  var styleProperty = null;\n\n  function addCSS(styleDefinition) {\n  \tstyleDefinitions.push(styleDefinition);\n  \tisDirty = true;\n  }\n\n  function applyCSS() {\n\n  \t// Apply only seems to make sense when we're in the DOM. Server-side renders\n  \t// can call toCSS to get the updated CSS.\n  \tif (!doc || !isDirty) return;\n\n  \tstyleElement[styleProperty] = getCSS(null);\n\n  \tisDirty = false;\n  }\n\n  function getCSS(cssIds) {\n\n  \tvar filteredStyleDefinitions = cssIds ? styleDefinitions.filter(function (style) {\n  \t\treturn ~cssIds.indexOf(style.id);\n  \t}) : styleDefinitions;\n\n  \treturn filteredStyleDefinitions.reduce(function (styles, style) {\n  \t\treturn styles + '\\n\\n/* {' + style.id + '} */\\n' + style.styles;\n  \t}, PREFIX);\n  }\n\n  // If we're on the browser, additional setup needed.\n  if (doc && (!styleElement || !styleElement.parentNode)) {\n\n  \tstyleElement = doc.createElement('style');\n  \tstyleElement.type = 'text/css';\n\n  \tdoc.getElementsByTagName('head')[0].appendChild(styleElement);\n\n  \tstyleSheet = styleElement.styleSheet;\n\n  \tstyleProperty = styleSheet ? 'cssText' : 'innerHTML';\n  }\n\n  function Ractive$toCSS() {\n  \tvar cssIds = [this.cssId].concat(toConsumableArray(this.findAllComponents().map(function (c) {\n  \t\treturn c.cssId;\n  \t})));\n  \tvar uniqueCssIds = Object.keys(cssIds.reduce(function (ids, id) {\n  \t\treturn ids[id] = true, ids;\n  \t}, {}));\n  \treturn getCSS(uniqueCssIds);\n  }\n\n  // Error messages that are used (or could be) in multiple places\n  var badArguments = 'Bad arguments';\n  var noRegistryFunctionReturn = 'A function was specified for \"%s\" %s, but no %s was returned';\n  var missingPlugin = function (name, type) {\n    return 'Missing \"' + name + '\" ' + type + ' plugin. You may need to download a plugin via http://docs.ractivejs.org/latest/plugins#' + type + 's';\n  };\n\n  function Ractive$toggle(keypath) {\n  \tif (typeof keypath !== 'string') {\n  \t\tthrow new TypeError(badArguments);\n  \t}\n\n  \tvar changes = undefined;\n\n  \tif (/\\*/.test(keypath)) {\n  \t\tchanges = {};\n\n  \t\tthis.viewmodel.findMatches(splitKeypath(keypath)).forEach(function (model) {\n  \t\t\tchanges[model.getKeypath()] = !model.get();\n  \t\t});\n\n  \t\treturn this.set(changes);\n  \t}\n\n  \treturn this.set(keypath, !this.get(keypath));\n  }\n\n  function _bind(x) {\n    x.bind();\n  }\n\n  function cancel(x) {\n    x.cancel();\n  }\n\n  function _handleChange(x) {\n    x.handleChange();\n  }\n\n  function _mark(x) {\n    x.mark();\n  }\n\n  function _render(x) {\n    x.render();\n  }\n\n  function _rebind(x) {\n    x.rebind();\n  }\n\n  function _teardown(x) {\n    x.teardown();\n  }\n\n  function _unbind(x) {\n    x.unbind();\n  }\n\n  function _unrender(x) {\n    x.unrender();\n  }\n\n  function unrenderAndDestroy$1(x) {\n    x.unrender(true);\n  }\n\n  function _update(x) {\n    x.update();\n  }\n\n  function _toString(x) {\n    return x.toString();\n  }\n\n  function toEscapedString(x) {\n    return x.toString(true);\n  }\n\n  var teardownHook = new Hook('teardown');\n\n  // Teardown. This goes through the root fragment and all its children, removing observers\n  // and generally cleaning up after itself\n\n  function Ractive$teardown() {\n  \tvar _this = this;\n\n  \tthis.fragment.unbind();\n  \tthis.viewmodel.teardown();\n\n  \tthis._observers.forEach(cancel);\n\n  \tif (this.fragment.rendered && this.el.__ractive_instances__) {\n  \t\tremoveFromArray(this.el.__ractive_instances__, this);\n  \t}\n\n  \tthis.shouldDestroy = true;\n  \tvar promise = this.fragment.rendered ? this.unrender() : Promise$1.resolve();\n\n  \tObject.keys(this._links).forEach(function (k) {\n  \t\treturn _this._links[k].unlink();\n  \t});\n\n  \tteardownHook.fire(this);\n\n  \treturn promise;\n  }\n\n  var errorMessage$1 = 'Cannot add to a non-numeric value';\n  function add(ractive, keypath, d) {\n  \tif (typeof keypath !== 'string' || !isNumeric(d)) {\n  \t\tthrow new Error('Bad arguments');\n  \t}\n\n  \tvar changes = undefined;\n\n  \tif (/\\*/.test(keypath)) {\n  \t\tchanges = {};\n\n  \t\tractive.viewmodel.findMatches(splitKeypath(keypath)).forEach(function (model) {\n  \t\t\tvar value = model.get();\n\n  \t\t\tif (!isNumeric(value)) throw new Error(errorMessage$1);\n\n  \t\t\tchanges[model.getKeypath()] = value + d;\n  \t\t});\n\n  \t\treturn ractive.set(changes);\n  \t}\n\n  \tvar value = ractive.get(keypath);\n\n  \tif (!isNumeric(value)) {\n  \t\tthrow new Error(errorMessage$1);\n  \t}\n\n  \treturn ractive.set(keypath, +value + d);\n  }\n\n  function Ractive$subtract(keypath, d) {\n  \treturn add(this, keypath, d === undefined ? -1 : -d);\n  }\n\n  var splice = makeArrayMethod('splice');\n\n  var sort = makeArrayMethod('sort');\n\n  var shift = makeArrayMethod('shift');\n\n  function bind(fn, context) {\n  \tif (!/this/.test(fn.toString())) return fn;\n\n  \tvar bound = fn.bind(context);\n  \tfor (var prop in fn) {\n  \t\tbound[prop] = fn[prop];\n  \t}return bound;\n  }\n\n  function Ractive$set(keypath, value) {\n  \tvar promise = runloop.start(this, true);\n\n  \t// Set multiple keypaths in one go\n  \tif (isObject(keypath)) {\n  \t\tvar map = keypath;\n\n  \t\tfor (var k in map) {\n  \t\t\tif (map.hasOwnProperty(k)) {\n  \t\t\t\tset(this, k, map[k]);\n  \t\t\t}\n  \t\t}\n  \t}\n  \t// Set a single keypath\n  \telse {\n  \t\t\tset(this, keypath, value);\n  \t\t}\n\n  \trunloop.end();\n\n  \treturn promise;\n  }\n\n  function set(ractive, keypath, value) {\n  \tif (typeof value === 'function') value = bind(value, ractive);\n\n  \tif (/\\*/.test(keypath)) {\n  \t\tractive.viewmodel.findMatches(splitKeypath(keypath)).forEach(function (model) {\n  \t\t\tmodel.set(value);\n  \t\t});\n  \t} else {\n  \t\tvar model = ractive.viewmodel.joinAll(splitKeypath(keypath));\n  \t\tmodel.set(value);\n  \t}\n  }\n\n  var reverse = makeArrayMethod('reverse');\n\n  var TEMPLATE_VERSION = 3;\n\n  var pattern = /\\$\\{([^\\}]+)\\}/g;\n\n  function fromExpression(body) {\n  \tvar length = arguments.length <= 1 || arguments[1] === undefined ? 0 : arguments[1];\n\n  \tvar args = new Array(length);\n\n  \twhile (length--) {\n  \t\targs[length] = '_' + length;\n  \t}\n\n  \t// Functions created directly with new Function() look like this:\n  \t//     function anonymous (_0 /**/) { return _0*2 }\n  \t//\n  \t// With this workaround, we get a little more compact:\n  \t//     function (_0){return _0*2}\n  \treturn new Function([], 'return function (' + args.join(',') + '){return(' + body + ');};')();\n  }\n\n  function fromComputationString(str, bindTo) {\n  \tvar hasThis = undefined;\n\n  \tvar functionBody = 'return (' + str.replace(pattern, function (match, keypath) {\n  \t\thasThis = true;\n  \t\treturn '__ractive.get(\"' + keypath + '\")';\n  \t}) + ');';\n\n  \tif (hasThis) functionBody = 'var __ractive = this; ' + functionBody;\n  \tvar fn = new Function(functionBody);\n  \treturn hasThis ? fn.bind(bindTo) : fn;\n  }\n\n  var html = 'http://www.w3.org/1999/xhtml';\n  var mathml = 'http://www.w3.org/1998/Math/MathML';\n  var svg$1 = 'http://www.w3.org/2000/svg';\n  var xlink = 'http://www.w3.org/1999/xlink';\n  var xml = 'http://www.w3.org/XML/1998/namespace';\n  var xmlns = 'http://www.w3.org/2000/xmlns';\n\n  var namespaces = { html: html, mathml: mathml, svg: svg$1, xlink: xlink, xml: xml, xmlns: xmlns };\n\n  var createElement;\n  var matches;\n  var div;\n  var methodNames;\n  var unprefixed;\n  var prefixed;\n  var i$1;\n  var j$1;\n  var makeFunction;\n  // Test for SVG support\n  if (!svg) {\n  \tcreateElement = function (type, ns, extend) {\n  \t\tif (ns && ns !== html) {\n  \t\t\tthrow 'This browser does not support namespaces other than http://www.w3.org/1999/xhtml. The most likely cause of this error is that you\\'re trying to render SVG in an older browser. See http://docs.ractivejs.org/latest/svg-and-older-browsers for more information';\n  \t\t}\n\n  \t\treturn extend ? doc.createElement(type, extend) : doc.createElement(type);\n  \t};\n  } else {\n  \tcreateElement = function (type, ns, extend) {\n  \t\tif (!ns || ns === html) {\n  \t\t\treturn extend ? doc.createElement(type, extend) : doc.createElement(type);\n  \t\t}\n\n  \t\treturn extend ? doc.createElementNS(ns, type, extend) : doc.createElementNS(ns, type);\n  \t};\n  }\n\n  function createDocumentFragment() {\n  \treturn doc.createDocumentFragment();\n  }\n\n  function getElement(input) {\n  \tvar output;\n\n  \tif (!input || typeof input === 'boolean') {\n  \t\treturn;\n  \t}\n\n  \tif (!win || !doc || !input) {\n  \t\treturn null;\n  \t}\n\n  \t// We already have a DOM node - no work to do. (Duck typing alert!)\n  \tif (input.nodeType) {\n  \t\treturn input;\n  \t}\n\n  \t// Get node from string\n  \tif (typeof input === 'string') {\n  \t\t// try ID first\n  \t\toutput = doc.getElementById(input);\n\n  \t\t// then as selector, if possible\n  \t\tif (!output && doc.querySelector) {\n  \t\t\toutput = doc.querySelector(input);\n  \t\t}\n\n  \t\t// did it work?\n  \t\tif (output && output.nodeType) {\n  \t\t\treturn output;\n  \t\t}\n  \t}\n\n  \t// If we've been given a collection (jQuery, Zepto etc), extract the first item\n  \tif (input[0] && input[0].nodeType) {\n  \t\treturn input[0];\n  \t}\n\n  \treturn null;\n  }\n\n  if (!isClient) {\n  \tmatches = null;\n  } else {\n  \tdiv = createElement('div');\n  \tmethodNames = ['matches', 'matchesSelector'];\n\n  \tmakeFunction = function (methodName) {\n  \t\treturn function (node, selector) {\n  \t\t\treturn node[methodName](selector);\n  \t\t};\n  \t};\n\n  \ti$1 = methodNames.length;\n\n  \twhile (i$1-- && !matches) {\n  \t\tunprefixed = methodNames[i$1];\n\n  \t\tif (div[unprefixed]) {\n  \t\t\tmatches = makeFunction(unprefixed);\n  \t\t} else {\n  \t\t\tj$1 = vendors.length;\n  \t\t\twhile (j$1--) {\n  \t\t\t\tprefixed = vendors[i$1] + unprefixed.substr(0, 1).toUpperCase() + unprefixed.substring(1);\n\n  \t\t\t\tif (div[prefixed]) {\n  \t\t\t\t\tmatches = makeFunction(prefixed);\n  \t\t\t\t\tbreak;\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \t// IE8...\n  \tif (!matches) {\n  \t\tmatches = function (node, selector) {\n  \t\t\tvar nodes, parentNode, i$1;\n\n  \t\t\tparentNode = node.parentNode;\n\n  \t\t\tif (!parentNode) {\n  \t\t\t\t// empty dummy <div>\n  \t\t\t\tdiv.innerHTML = '';\n\n  \t\t\t\tparentNode = div;\n  \t\t\t\tnode = node.cloneNode();\n\n  \t\t\t\tdiv.appendChild(node);\n  \t\t\t}\n\n  \t\t\tnodes = parentNode.querySelectorAll(selector);\n\n  \t\t\ti$1 = nodes.length;\n  \t\t\twhile (i$1--) {\n  \t\t\t\tif (nodes[i$1] === node) {\n  \t\t\t\t\treturn true;\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\treturn false;\n  \t\t};\n  \t}\n  }\n\n  function detachNode(node) {\n  \tif (node && typeof node.parentNode !== 'unknown' && node.parentNode) {\n  \t\tnode.parentNode.removeChild(node);\n  \t}\n\n  \treturn node;\n  }\n\n  function safeToStringValue(value) {\n  \treturn value == null || !value.toString ? '' : '' + value;\n  }\n\n  var exportedShims;\n\n  if (!win) {\n  \texportedShims = null;\n  } else {\n  \texportedShims = {};\n\n  \t// Shims for older browsers\n\n  \tif (!Date.now) {\n  \t\tDate.now = function () {\n  \t\t\treturn +new Date();\n  \t\t};\n  \t}\n\n  \tif (!String.prototype.trim) {\n  \t\tString.prototype.trim = function () {\n  \t\t\treturn this.replace(/^\\s+/, '').replace(/\\s+$/, '');\n  \t\t};\n  \t}\n\n  \t// Polyfill for Object.keys\n  \t// https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Object/keys\n  \tif (!Object.keys) {\n  \t\tObject.keys = (function () {\n  \t\t\tvar hasOwnProperty = Object.prototype.hasOwnProperty,\n  \t\t\t    hasDontEnumBug = !({ toString: null }).propertyIsEnumerable('toString'),\n  \t\t\t    dontEnums = ['toString', 'toLocaleString', 'valueOf', 'hasOwnProperty', 'isPrototypeOf', 'propertyIsEnumerable', 'constructor'],\n  \t\t\t    dontEnumsLength = dontEnums.length;\n\n  \t\t\treturn function (obj) {\n  \t\t\t\tif (typeof obj !== 'object' && typeof obj !== 'function' || obj === null) {\n  \t\t\t\t\tthrow new TypeError('Object.keys called on non-object');\n  \t\t\t\t}\n\n  \t\t\t\tvar result = [];\n\n  \t\t\t\tfor (var prop in obj) {\n  \t\t\t\t\tif (hasOwnProperty.call(obj, prop)) {\n  \t\t\t\t\t\tresult.push(prop);\n  \t\t\t\t\t}\n  \t\t\t\t}\n\n  \t\t\t\tif (hasDontEnumBug) {\n  \t\t\t\t\tfor (var i = 0; i < dontEnumsLength; i++) {\n  \t\t\t\t\t\tif (hasOwnProperty.call(obj, dontEnums[i])) {\n  \t\t\t\t\t\t\tresult.push(dontEnums[i]);\n  \t\t\t\t\t\t}\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t\t\treturn result;\n  \t\t\t};\n  \t\t})();\n  \t}\n\n  \t// TODO: use defineProperty to make these non-enumerable\n\n  \t// Array extras\n  \tif (!Array.prototype.indexOf) {\n  \t\tArray.prototype.indexOf = function (needle, i) {\n  \t\t\tvar len;\n\n  \t\t\tif (i === undefined) {\n  \t\t\t\ti = 0;\n  \t\t\t}\n\n  \t\t\tif (i < 0) {\n  \t\t\t\ti += this.length;\n  \t\t\t}\n\n  \t\t\tif (i < 0) {\n  \t\t\t\ti = 0;\n  \t\t\t}\n\n  \t\t\tfor (len = this.length; i < len; i++) {\n  \t\t\t\tif (this.hasOwnProperty(i) && this[i] === needle) {\n  \t\t\t\t\treturn i;\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\treturn -1;\n  \t\t};\n  \t}\n\n  \tif (!Array.prototype.forEach) {\n  \t\tArray.prototype.forEach = function (callback, context) {\n  \t\t\tvar i, len;\n\n  \t\t\tfor (i = 0, len = this.length; i < len; i += 1) {\n  \t\t\t\tif (this.hasOwnProperty(i)) {\n  \t\t\t\t\tcallback.call(context, this[i], i, this);\n  \t\t\t\t}\n  \t\t\t}\n  \t\t};\n  \t}\n\n  \tif (!Array.prototype.map) {\n  \t\tArray.prototype.map = function (mapper, context) {\n  \t\t\tvar array = this,\n  \t\t\t    i,\n  \t\t\t    len,\n  \t\t\t    mapped = [],\n  \t\t\t    isActuallyString;\n\n  \t\t\t// incredibly, if you do something like\n  \t\t\t// Array.prototype.map.call( someString, iterator )\n  \t\t\t// then `this` will become an instance of String in IE8.\n  \t\t\t// And in IE8, you then can't do string[i]. Facepalm.\n  \t\t\tif (array instanceof String) {\n  \t\t\t\tarray = array.toString();\n  \t\t\t\tisActuallyString = true;\n  \t\t\t}\n\n  \t\t\tfor (i = 0, len = array.length; i < len; i += 1) {\n  \t\t\t\tif (array.hasOwnProperty(i) || isActuallyString) {\n  \t\t\t\t\tmapped[i] = mapper.call(context, array[i], i, array);\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\treturn mapped;\n  \t\t};\n  \t}\n\n  \tif (typeof Array.prototype.reduce !== 'function') {\n  \t\tArray.prototype.reduce = function (callback, opt_initialValue) {\n  \t\t\tvar i, value, len, valueIsSet;\n\n  \t\t\tif ('function' !== typeof callback) {\n  \t\t\t\tthrow new TypeError(callback + ' is not a function');\n  \t\t\t}\n\n  \t\t\tlen = this.length;\n  \t\t\tvalueIsSet = false;\n\n  \t\t\tif (arguments.length > 1) {\n  \t\t\t\tvalue = opt_initialValue;\n  \t\t\t\tvalueIsSet = true;\n  \t\t\t}\n\n  \t\t\tfor (i = 0; i < len; i += 1) {\n  \t\t\t\tif (this.hasOwnProperty(i)) {\n  \t\t\t\t\tif (valueIsSet) {\n  \t\t\t\t\t\tvalue = callback(value, this[i], i, this);\n  \t\t\t\t\t}\n  \t\t\t\t} else {\n  \t\t\t\t\tvalue = this[i];\n  \t\t\t\t\tvalueIsSet = true;\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\tif (!valueIsSet) {\n  \t\t\t\tthrow new TypeError('Reduce of empty array with no initial value');\n  \t\t\t}\n\n  \t\t\treturn value;\n  \t\t};\n  \t}\n\n  \tif (!Array.prototype.filter) {\n  \t\tArray.prototype.filter = function (filter, context) {\n  \t\t\tvar i,\n  \t\t\t    len,\n  \t\t\t    filtered = [];\n\n  \t\t\tfor (i = 0, len = this.length; i < len; i += 1) {\n  \t\t\t\tif (this.hasOwnProperty(i) && filter.call(context, this[i], i, this)) {\n  \t\t\t\t\tfiltered[filtered.length] = this[i];\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\treturn filtered;\n  \t\t};\n  \t}\n\n  \tif (!Array.prototype.every) {\n  \t\tArray.prototype.every = function (iterator, context) {\n  \t\t\tvar t, len, i;\n\n  \t\t\tif (this == null) {\n  \t\t\t\tthrow new TypeError();\n  \t\t\t}\n\n  \t\t\tt = Object(this);\n  \t\t\tlen = t.length >>> 0;\n\n  \t\t\tif (typeof iterator !== 'function') {\n  \t\t\t\tthrow new TypeError();\n  \t\t\t}\n\n  \t\t\tfor (i = 0; i < len; i += 1) {\n  \t\t\t\tif (i in t && !iterator.call(context, t[i], i, t)) {\n  \t\t\t\t\treturn false;\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\treturn true;\n  \t\t};\n  \t}\n\n  \tif (typeof Function.prototype.bind !== 'function') {\n  \t\tFunction.prototype.bind = function (context) {\n  \t\t\tvar args,\n  \t\t\t    fn,\n  \t\t\t    Empty,\n  \t\t\t    bound,\n  \t\t\t    slice = [].slice;\n\n  \t\t\tif (typeof this !== 'function') {\n  \t\t\t\tthrow new TypeError('Function.prototype.bind called on non-function');\n  \t\t\t}\n\n  \t\t\targs = slice.call(arguments, 1);\n  \t\t\tfn = this;\n  \t\t\tEmpty = function () {};\n\n  \t\t\tbound = function () {\n  \t\t\t\tvar ctx = this instanceof Empty && context ? this : context;\n  \t\t\t\treturn fn.apply(ctx, args.concat(slice.call(arguments)));\n  \t\t\t};\n\n  \t\t\tEmpty.prototype = this.prototype;\n  \t\t\tbound.prototype = new Empty();\n\n  \t\t\treturn bound;\n  \t\t};\n  \t}\n\n  \t// https://gist.github.com/Rich-Harris/6010282 via https://gist.github.com/jonathantneal/2869388\n  \t// addEventListener polyfill IE6+\n  \tif (!win.addEventListener) {\n  \t\t(function (win, doc) {\n  \t\t\tvar Event, addEventListener, removeEventListener, head, style, origCreateElement;\n\n  \t\t\t// because sometimes inquiring minds want to know\n  \t\t\twin.appearsToBeIELessEqual8 = true;\n\n  \t\t\tEvent = function (e, element) {\n  \t\t\t\tvar property,\n  \t\t\t\t    instance = this;\n\n  \t\t\t\tfor (property in e) {\n  \t\t\t\t\tinstance[property] = e[property];\n  \t\t\t\t}\n\n  \t\t\t\tinstance.currentTarget = element;\n  \t\t\t\tinstance.target = e.srcElement || element;\n  \t\t\t\tinstance.timeStamp = +new Date();\n\n  \t\t\t\tinstance.preventDefault = function () {\n  \t\t\t\t\te.returnValue = false;\n  \t\t\t\t};\n\n  \t\t\t\tinstance.stopPropagation = function () {\n  \t\t\t\t\te.cancelBubble = true;\n  \t\t\t\t};\n  \t\t\t};\n\n  \t\t\taddEventListener = function (type, listener) {\n  \t\t\t\tvar element = this,\n  \t\t\t\t    listeners,\n  \t\t\t\t    i;\n\n  \t\t\t\tlisteners = element.listeners || (element.listeners = []);\n  \t\t\t\ti = listeners.length;\n\n  \t\t\t\tlisteners[i] = [listener, function (e) {\n  \t\t\t\t\tlistener.call(element, new Event(e, element));\n  \t\t\t\t}];\n\n  \t\t\t\telement.attachEvent('on' + type, listeners[i][1]);\n  \t\t\t};\n\n  \t\t\tremoveEventListener = function (type, listener) {\n  \t\t\t\tvar element = this,\n  \t\t\t\t    listeners,\n  \t\t\t\t    i;\n\n  \t\t\t\tif (!element.listeners) {\n  \t\t\t\t\treturn;\n  \t\t\t\t}\n\n  \t\t\t\tlisteners = element.listeners;\n  \t\t\t\ti = listeners.length;\n\n  \t\t\t\twhile (i--) {\n  \t\t\t\t\tif (listeners[i][0] === listener) {\n  \t\t\t\t\t\telement.detachEvent('on' + type, listeners[i][1]);\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t\t};\n\n  \t\t\twin.addEventListener = doc.addEventListener = addEventListener;\n  \t\t\twin.removeEventListener = doc.removeEventListener = removeEventListener;\n\n  \t\t\tif ('Element' in win) {\n  \t\t\t\twin.Element.prototype.addEventListener = addEventListener;\n  \t\t\t\twin.Element.prototype.removeEventListener = removeEventListener;\n  \t\t\t} else {\n  \t\t\t\t// First, intercept any calls to document.createElement - this is necessary\n  \t\t\t\t// because the CSS hack (see below) doesn't come into play until after a\n  \t\t\t\t// node is added to the DOM, which is too late for a lot of Ractive setup work\n  \t\t\t\torigCreateElement = doc.createElement;\n\n  \t\t\t\tdoc.createElement = function (tagName) {\n  \t\t\t\t\tvar el = origCreateElement(tagName);\n  \t\t\t\t\tel.addEventListener = addEventListener;\n  \t\t\t\t\tel.removeEventListener = removeEventListener;\n  \t\t\t\t\treturn el;\n  \t\t\t\t};\n\n  \t\t\t\t// Then, mop up any additional elements that weren't created via\n  \t\t\t\t// document.createElement (i.e. with innerHTML).\n  \t\t\t\thead = doc.getElementsByTagName('head')[0];\n  \t\t\t\tstyle = doc.createElement('style');\n\n  \t\t\t\thead.insertBefore(style, head.firstChild);\n\n  \t\t\t\t//style.styleSheet.cssText = '*{-ms-event-prototype:expression(!this.addEventListener&&(this.addEventListener=addEventListener)&&(this.removeEventListener=removeEventListener))}';\n  \t\t\t}\n  \t\t})(win, doc);\n  \t}\n\n  \t// The getComputedStyle polyfill interacts badly with jQuery, so we don't attach\n  \t// it to window. Instead, we export it for other modules to use as needed\n\n  \t// https://github.com/jonathantneal/Polyfills-for-IE8/blob/master/getComputedStyle.js\n  \tif (!win.getComputedStyle) {\n  \t\texportedShims.getComputedStyle = (function () {\n  \t\t\tvar borderSizes = {};\n\n  \t\t\tfunction getPixelSize(element, style, property, fontSize) {\n  \t\t\t\tvar sizeWithSuffix = style[property];\n  \t\t\t\tvar size = parseFloat(sizeWithSuffix);\n  \t\t\t\tvar suffix = sizeWithSuffix.split(/\\d/)[0];\n\n  \t\t\t\tif (isNaN(size)) {\n  \t\t\t\t\tif (/^thin|medium|thick$/.test(sizeWithSuffix)) {\n  \t\t\t\t\t\tsize = getBorderPixelSize(sizeWithSuffix);\n  \t\t\t\t\t\tsuffix = '';\n  \t\t\t\t\t} else {\n  \t\t\t\t\t\t// TODO...\n  \t\t\t\t\t}\n  \t\t\t\t}\n\n  \t\t\t\tfontSize = fontSize != null ? fontSize : /%|em/.test(suffix) && element.parentElement ? getPixelSize(element.parentElement, element.parentElement.currentStyle, 'fontSize', null) : 16;\n  \t\t\t\tvar rootSize = property == 'fontSize' ? fontSize : /width/i.test(property) ? element.clientWidth : element.clientHeight;\n\n  \t\t\t\treturn suffix == 'em' ? size * fontSize : suffix == 'in' ? size * 96 : suffix == 'pt' ? size * 96 / 72 : suffix == '%' ? size / 100 * rootSize : size;\n  \t\t\t}\n\n  \t\t\tfunction getBorderPixelSize(size) {\n  \t\t\t\tvar div, bcr;\n\n  \t\t\t\t// `thin`, `medium` and `thick` vary between browsers. (Don't ever use them.)\n  \t\t\t\tif (!borderSizes[size]) {\n  \t\t\t\t\tdiv = doc.createElement('div');\n  \t\t\t\t\tdiv.style.display = 'block';\n  \t\t\t\t\tdiv.style.position = 'fixed';\n  \t\t\t\t\tdiv.style.width = div.style.height = '0';\n  \t\t\t\t\tdiv.style.borderRight = size + ' solid black';\n\n  \t\t\t\t\tdoc.getElementsByTagName('body')[0].appendChild(div);\n  \t\t\t\t\tbcr = div.getBoundingClientRect();\n\n  \t\t\t\t\tborderSizes[size] = bcr.right - bcr.left;\n  \t\t\t\t}\n\n  \t\t\t\treturn borderSizes[size];\n  \t\t\t}\n\n  \t\t\tfunction setShortStyleProperty(style, property) {\n  \t\t\t\tvar borderSuffix = property == 'border' ? 'Width' : '';\n  \t\t\t\tvar t = property + 'Top' + borderSuffix;\n  \t\t\t\tvar r = property + 'Right' + borderSuffix;\n  \t\t\t\tvar b = property + 'Bottom' + borderSuffix;\n  \t\t\t\tvar l = property + 'Left' + borderSuffix;\n\n  \t\t\t\tstyle[property] = (style[t] == style[r] == style[b] == style[l] ? [style[t]] : style[t] == style[b] && style[l] == style[r] ? [style[t], style[r]] : style[l] == style[r] ? [style[t], style[r], style[b]] : [style[t], style[r], style[b], style[l]]).join(' ');\n  \t\t\t}\n\n  \t\t\tvar normalProps = {\n  \t\t\t\tfontWeight: 400,\n  \t\t\t\tlineHeight: 1.2, // actually varies depending on font-family, but is generally close enough...\n  \t\t\t\tletterSpacing: 0\n  \t\t\t};\n\n  \t\t\tfunction CSSStyleDeclaration(element) {\n  \t\t\t\tvar currentStyle, style, fontSize, property;\n\n  \t\t\t\tcurrentStyle = element.currentStyle;\n  \t\t\t\tstyle = this;\n  \t\t\t\tfontSize = getPixelSize(element, currentStyle, 'fontSize', null);\n\n  \t\t\t\t// TODO tidy this up, test it, send PR to jonathantneal!\n  \t\t\t\tfor (property in currentStyle) {\n  \t\t\t\t\tif (currentStyle[property] === 'normal' && normalProps.hasOwnProperty(property)) {\n  \t\t\t\t\t\tstyle[property] = normalProps[property];\n  \t\t\t\t\t} else if (/width|height|margin.|padding.|border.+W/.test(property)) {\n  \t\t\t\t\t\tif (currentStyle[property] === 'auto') {\n  \t\t\t\t\t\t\tif (/^width|height/.test(property)) {\n  \t\t\t\t\t\t\t\t// just use clientWidth/clientHeight...\n  \t\t\t\t\t\t\t\tstyle[property] = (property === 'width' ? element.clientWidth : element.clientHeight) + 'px';\n  \t\t\t\t\t\t\t} else if (/(?:padding)?Top|Bottom$/.test(property)) {\n  \t\t\t\t\t\t\t\tstyle[property] = '0px';\n  \t\t\t\t\t\t\t}\n  \t\t\t\t\t\t} else {\n  \t\t\t\t\t\t\tstyle[property] = getPixelSize(element, currentStyle, property, fontSize) + 'px';\n  \t\t\t\t\t\t}\n  \t\t\t\t\t} else if (property === 'styleFloat') {\n  \t\t\t\t\t\tstyle.float = currentStyle[property];\n  \t\t\t\t\t} else {\n  \t\t\t\t\t\tstyle[property] = currentStyle[property];\n  \t\t\t\t\t}\n  \t\t\t\t}\n\n  \t\t\t\tsetShortStyleProperty(style, 'margin');\n  \t\t\t\tsetShortStyleProperty(style, 'padding');\n  \t\t\t\tsetShortStyleProperty(style, 'border');\n\n  \t\t\t\tstyle.fontSize = fontSize + 'px';\n\n  \t\t\t\treturn style;\n  \t\t\t}\n\n  \t\t\tCSSStyleDeclaration.prototype = {\n  \t\t\t\tconstructor: CSSStyleDeclaration,\n  \t\t\t\tgetPropertyPriority: noop,\n  \t\t\t\tgetPropertyValue: function (prop) {\n  \t\t\t\t\treturn this[prop] || '';\n  \t\t\t\t},\n  \t\t\t\titem: noop,\n  \t\t\t\tremoveProperty: noop,\n  \t\t\t\tsetProperty: noop,\n  \t\t\t\tgetPropertyCSSValue: noop\n  \t\t\t};\n\n  \t\t\tfunction getComputedStyle(element) {\n  \t\t\t\treturn new CSSStyleDeclaration(element);\n  \t\t\t}\n\n  \t\t\treturn getComputedStyle;\n  \t\t})();\n  \t}\n  }\n\n  var legacy = exportedShims;\n\n  var create;\n  var defineProperty;\n  var defineProperties;\n  try {\n  \tObject.defineProperty({}, 'test', { value: 0 });\n\n  \tif (doc) {\n  \t\tObject.defineProperty(createElement('div'), 'test', { value: 0 });\n  \t}\n\n  \tdefineProperty = Object.defineProperty;\n  } catch (err) {\n  \t// Object.defineProperty doesn't exist, or we're in IE8 where you can\n  \t// only use it with DOM objects (what were you smoking, MSFT?)\n  \tdefineProperty = function (obj, prop, desc) {\n  \t\tobj[prop] = desc.value;\n  \t};\n  }\n\n  try {\n  \ttry {\n  \t\tObject.defineProperties({}, { test: { value: 0 } });\n  \t} catch (err) {\n  \t\t// TODO how do we account for this? noMagic = true;\n  \t\tthrow err;\n  \t}\n\n  \tif (doc) {\n  \t\tObject.defineProperties(createElement('div'), { test: { value: 0 } });\n  \t}\n\n  \tdefineProperties = Object.defineProperties;\n  } catch (err) {\n  \tdefineProperties = function (obj, props) {\n  \t\tvar prop;\n\n  \t\tfor (prop in props) {\n  \t\t\tif (props.hasOwnProperty(prop)) {\n  \t\t\t\tdefineProperty(obj, prop, props[prop]);\n  \t\t\t}\n  \t\t}\n  \t};\n  }\n\n  try {\n  \tObject.create(null);\n\n  \tcreate = Object.create;\n  } catch (err) {\n  \t// sigh\n  \tcreate = (function () {\n  \t\tvar F = function () {};\n\n  \t\treturn function (proto, props) {\n  \t\t\tvar obj;\n\n  \t\t\tif (proto === null) {\n  \t\t\t\treturn {};\n  \t\t\t}\n\n  \t\t\tF.prototype = proto;\n  \t\t\tobj = new F();\n\n  \t\t\tif (props) {\n  \t\t\t\tObject.defineProperties(obj, props);\n  \t\t\t}\n\n  \t\t\treturn obj;\n  \t\t};\n  \t})();\n  }\n\n  function extend(target) {\n  \tvar prop;\n\n  \tfor (var _len = arguments.length, sources = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n  \t\tsources[_key - 1] = arguments[_key];\n  \t}\n\n  \tsources.forEach(function (source) {\n  \t\tfor (prop in source) {\n  \t\t\tif (hasOwn.call(source, prop)) {\n  \t\t\t\ttarget[prop] = source[prop];\n  \t\t\t}\n  \t\t}\n  \t});\n\n  \treturn target;\n  }\n\n  function fillGaps(target) {\n  \tfor (var _len2 = arguments.length, sources = Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {\n  \t\tsources[_key2 - 1] = arguments[_key2];\n  \t}\n\n  \tsources.forEach(function (s) {\n  \t\tfor (var key in s) {\n  \t\t\tif (hasOwn.call(s, key) && !(key in target)) {\n  \t\t\t\ttarget[key] = s[key];\n  \t\t\t}\n  \t\t}\n  \t});\n\n  \treturn target;\n  }\n\n  var hasOwn = Object.prototype.hasOwnProperty;\n\n  var functions = create(null);\n  function getFunction(str, i) {\n  \tif (functions[str]) return functions[str];\n  \treturn functions[str] = createFunction(str, i);\n  }\n\n  function addFunctions(template) {\n  \tif (!template) return;\n\n  \tvar exp = template.e;\n\n  \tif (!exp) return;\n\n  \tObject.keys(exp).forEach(function (str) {\n  \t\tif (functions[str]) return;\n  \t\tfunctions[str] = exp[str];\n  \t});\n  }\n\n  var parse = null;\n\n  var parseOptions = ['delimiters', 'tripleDelimiters', 'staticDelimiters', 'staticTripleDelimiters', 'csp', 'interpolate', 'preserveWhitespace', 'sanitize', 'stripComments'];\n\n  var TEMPLATE_INSTRUCTIONS = 'Either preparse or use a ractive runtime source that includes the parser. ';\n\n  var COMPUTATION_INSTRUCTIONS = 'Either use:\\n\\n\\tRactive.parse.computedStrings( component.computed )\\n\\nat build time to pre-convert the strings to functions, or use functions instead of strings in computed properties.';\n\n  function throwNoParse(method, error, instructions) {\n  \tif (!method) {\n  \t\tfatal('Missing Ractive.parse - cannot parse ' + error + '. ' + instructions);\n  \t}\n  }\n\n  function createFunction(body, length) {\n  \tthrowNoParse(fromExpression, 'new expression function', TEMPLATE_INSTRUCTIONS);\n  \treturn fromExpression(body, length);\n  }\n\n  function createFunctionFromString(str, bindTo) {\n  \tthrowNoParse(fromComputationString, 'compution string \"${str}\"', COMPUTATION_INSTRUCTIONS);\n  \treturn fromComputationString(str, bindTo);\n  }\n\n  var parser = {\n\n  \tfromId: function (id, options) {\n  \t\tif (!doc) {\n  \t\t\tif (options && options.noThrow) {\n  \t\t\t\treturn;\n  \t\t\t}\n  \t\t\tthrow new Error('Cannot retrieve template #' + id + ' as Ractive is not running in a browser.');\n  \t\t}\n\n  \t\tif (id) id = id.replace(/^#/, '');\n\n  \t\tvar template = undefined;\n\n  \t\tif (!(template = doc.getElementById(id))) {\n  \t\t\tif (options && options.noThrow) {\n  \t\t\t\treturn;\n  \t\t\t}\n  \t\t\tthrow new Error('Could not find template element with id #' + id);\n  \t\t}\n\n  \t\tif (template.tagName.toUpperCase() !== 'SCRIPT') {\n  \t\t\tif (options && options.noThrow) {\n  \t\t\t\treturn;\n  \t\t\t}\n  \t\t\tthrow new Error('Template element with id #' + id + ', must be a <script> element');\n  \t\t}\n\n  \t\treturn 'textContent' in template ? template.textContent : template.innerHTML;\n  \t},\n\n  \tisParsed: function (template) {\n  \t\treturn !(typeof template === 'string');\n  \t},\n\n  \tgetParseOptions: function (ractive) {\n  \t\t// Could be Ractive or a Component\n  \t\tif (ractive.defaults) {\n  \t\t\tractive = ractive.defaults;\n  \t\t}\n\n  \t\treturn parseOptions.reduce(function (val, key) {\n  \t\t\tval[key] = ractive[key];\n  \t\t\treturn val;\n  \t\t}, {});\n  \t},\n\n  \tparse: function (template, options) {\n  \t\tthrowNoParse(parse, 'template', TEMPLATE_INSTRUCTIONS);\n  \t\tvar parsed = parse(template, options);\n  \t\taddFunctions(parsed);\n  \t\treturn parsed;\n  \t},\n\n  \tparseFor: function (template, ractive) {\n  \t\treturn this.parse(template, this.getParseOptions(ractive));\n  \t}\n  };\n\n  var templateConfigurator = {\n  \tname: 'template',\n\n  \textend: function (Parent, proto, options) {\n  \t\t// only assign if exists\n  \t\tif ('template' in options) {\n  \t\t\tvar template = options.template;\n\n  \t\t\tif (typeof template === 'function') {\n  \t\t\t\tproto.template = template;\n  \t\t\t} else {\n  \t\t\t\tproto.template = parseTemplate(template, proto);\n  \t\t\t}\n  \t\t}\n  \t},\n\n  \tinit: function (Parent, ractive, options) {\n  \t\t// TODO because of prototypal inheritance, we might just be able to use\n  \t\t// ractive.template, and not bother passing through the Parent object.\n  \t\t// At present that breaks the test mocks' expectations\n  \t\tvar template = 'template' in options ? options.template : Parent.prototype.template;\n  \t\ttemplate = template || { v: TEMPLATE_VERSION, t: [] };\n\n  \t\tif (typeof template === 'function') {\n  \t\t\tvar fn = template;\n  \t\t\ttemplate = getDynamicTemplate(ractive, fn);\n\n  \t\t\tractive._config.template = {\n  \t\t\t\tfn: fn,\n  \t\t\t\tresult: template\n  \t\t\t};\n  \t\t}\n\n  \t\ttemplate = parseTemplate(template, ractive);\n\n  \t\t// TODO the naming of this is confusing - ractive.template refers to [...],\n  \t\t// but Component.prototype.template refers to {v:1,t:[],p:[]}...\n  \t\t// it's unnecessary, because the developer never needs to access\n  \t\t// ractive.template\n  \t\tractive.template = template.t;\n\n  \t\tif (template.p) {\n  \t\t\textendPartials(ractive.partials, template.p);\n  \t\t}\n  \t},\n\n  \treset: function (ractive) {\n  \t\tvar result = resetValue(ractive);\n\n  \t\tif (result) {\n  \t\t\tvar parsed = parseTemplate(result, ractive);\n\n  \t\t\tractive.template = parsed.t;\n  \t\t\textendPartials(ractive.partials, parsed.p, true);\n\n  \t\t\treturn true;\n  \t\t}\n  \t}\n  };\n\n  function resetValue(ractive) {\n  \tvar initial = ractive._config.template;\n\n  \t// If this isn't a dynamic template, there's nothing to do\n  \tif (!initial || !initial.fn) {\n  \t\treturn;\n  \t}\n\n  \tvar result = getDynamicTemplate(ractive, initial.fn);\n\n  \t// TODO deep equality check to prevent unnecessary re-rendering\n  \t// in the case of already-parsed templates\n  \tif (result !== initial.result) {\n  \t\tinitial.result = result;\n  \t\treturn result;\n  \t}\n  }\n\n  function getDynamicTemplate(ractive, fn) {\n  \treturn fn.call(ractive, {\n  \t\tfromId: parser.fromId,\n  \t\tisParsed: parser.isParsed,\n  \t\tparse: function (template) {\n  \t\t\tvar options = arguments.length <= 1 || arguments[1] === undefined ? parser.getParseOptions(ractive) : arguments[1];\n\n  \t\t\treturn parser.parse(template, options);\n  \t\t}\n  \t});\n  }\n\n  function parseTemplate(template, ractive) {\n  \tif (typeof template === 'string') {\n  \t\t// parse will validate and add expression functions\n  \t\ttemplate = parseAsString(template, ractive);\n  \t} else {\n  \t\t// need to validate and add exp for already parsed template\n  \t\tvalidate$1(template);\n  \t\taddFunctions(template);\n  \t}\n\n  \treturn template;\n  }\n\n  function parseAsString(template, ractive) {\n  \t// ID of an element containing the template?\n  \tif (template[0] === '#') {\n  \t\ttemplate = parser.fromId(template);\n  \t}\n\n  \treturn parser.parseFor(template, ractive);\n  }\n\n  function validate$1(template) {\n\n  \t// Check that the template even exists\n  \tif (template == undefined) {\n  \t\tthrow new Error('The template cannot be ' + template + '.');\n  \t}\n\n  \t// Check the parsed template has a version at all\n  \telse if (typeof template.v !== 'number') {\n  \t\t\tthrow new Error('The template parser was passed a non-string template, but the template doesn\\'t have a version.  Make sure you\\'re passing in the template you think you are.');\n  \t\t}\n\n  \t\t// Check we're using the correct version\n  \t\telse if (template.v !== TEMPLATE_VERSION) {\n  \t\t\t\tthrow new Error('Mismatched template version (expected ' + TEMPLATE_VERSION + ', got ' + template.v + ') Please ensure you are using the latest version of Ractive.js in your build process as well as in your app');\n  \t\t\t}\n  }\n\n  function extendPartials(existingPartials, newPartials, overwrite) {\n  \tif (!newPartials) return;\n\n  \t// TODO there's an ambiguity here - we need to overwrite in the `reset()`\n  \t// case, but not initially...\n\n  \tfor (var key in newPartials) {\n  \t\tif (overwrite || !existingPartials.hasOwnProperty(key)) {\n  \t\t\texistingPartials[key] = newPartials[key];\n  \t\t}\n  \t}\n  }\n\n  var TEXT = 1;\n  var INTERPOLATOR = 2;\n  var TRIPLE = 3;\n  var SECTION = 4;\n  var ELEMENT = 7;\n  var PARTIAL = 8;\n  var COMPONENT = 15;\n  var YIELDER = 16;\n  var DOCTYPE = 18;\n  var ALIAS = 19;\n\n  var NUMBER_LITERAL = 20;\n  var STRING_LITERAL = 21;\n  var REFERENCE = 30;\n  var SECTION_IF = 50;\n  var SECTION_UNLESS = 51;\n  var SECTION_EACH = 52;\n  var SECTION_WITH = 53;\n  var SECTION_IF_WITH = 54;\n\n  var Item = (function () {\n  \tfunction Item(options) {\n  \t\tclassCallCheck(this, Item);\n\n  \t\tthis.parentFragment = options.parentFragment;\n  \t\tthis.ractive = options.parentFragment.ractive;\n\n  \t\tthis.template = options.template;\n  \t\tthis.index = options.index;\n  \t\tthis.type = options.template.t;\n\n  \t\tthis.dirty = false;\n  \t}\n\n  \tItem.prototype.bubble = function bubble() {\n  \t\tif (!this.dirty) {\n  \t\t\tthis.dirty = true;\n  \t\t\tthis.parentFragment.bubble();\n  \t\t}\n  \t};\n\n  \tItem.prototype.find = function find() {\n  \t\treturn null;\n  \t};\n\n  \tItem.prototype.findAll = function findAll() {\n  \t\t// noop\n  \t};\n\n  \tItem.prototype.findComponent = function findComponent() {\n  \t\treturn null;\n  \t};\n\n  \tItem.prototype.findAllComponents = function findAllComponents() {\n  \t\t// noop;\n  \t};\n\n  \tItem.prototype.findNextNode = function findNextNode() {\n  \t\treturn this.parentFragment.findNextNode(this);\n  \t};\n\n  \tItem.prototype.valueOf = function valueOf() {\n  \t\treturn this.toString();\n  \t};\n\n  \treturn Item;\n  })();\n\n  function badReference(key) {\n  \tthrow new Error('An index or key reference (' + key + ') cannot have child properties');\n  }\n  function resolveAmbiguousReference(fragment, ref) {\n  \tvar localViewmodel = fragment.findContext().root;\n  \tvar keys = splitKeypath(ref);\n  \tvar key = keys[0];\n\n  \tvar hasContextChain = undefined;\n  \tvar crossedComponentBoundary = undefined;\n  \tvar aliases = undefined;\n\n  \twhile (fragment) {\n  \t\t// repeated fragments\n  \t\tif (fragment.isIteration) {\n  \t\t\tif (key === fragment.parent.keyRef) {\n  \t\t\t\tif (keys.length > 1) badReference(key);\n  \t\t\t\treturn fragment.context.getKeyModel();\n  \t\t\t}\n\n  \t\t\tif (key === fragment.parent.indexRef) {\n  \t\t\t\tif (keys.length > 1) badReference(key);\n  \t\t\t\treturn fragment.context.getIndexModel(fragment.index);\n  \t\t\t}\n  \t\t}\n\n  \t\t// alias node or iteration\n  \t\tif (((aliases = fragment.owner.aliases) || (aliases = fragment.aliases)) && aliases.hasOwnProperty(key)) {\n  \t\t\tvar model = aliases[key];\n\n  \t\t\tif (keys.length === 1) return model;else if (typeof model.joinAll === 'function') {\n  \t\t\t\treturn model.joinAll(keys.slice(1));\n  \t\t\t}\n  \t\t}\n\n  \t\tif (fragment.context) {\n  \t\t\t// TODO better encapsulate the component check\n  \t\t\tif (!fragment.isRoot || fragment.ractive.component) hasContextChain = true;\n\n  \t\t\tif (fragment.context.has(key)) {\n  \t\t\t\tif (crossedComponentBoundary) {\n  \t\t\t\t\tlocalViewmodel.map(key, fragment.context.joinKey(key));\n  \t\t\t\t}\n\n  \t\t\t\treturn fragment.context.joinAll(keys);\n  \t\t\t}\n  \t\t}\n\n  \t\tif (fragment.componentParent && !fragment.ractive.isolated) {\n  \t\t\t// ascend through component boundary\n  \t\t\tfragment = fragment.componentParent;\n  \t\t\tcrossedComponentBoundary = true;\n  \t\t} else {\n  \t\t\tfragment = fragment.parent;\n  \t\t}\n  \t}\n\n  \tif (!hasContextChain) {\n  \t\treturn localViewmodel.joinAll(keys);\n  \t}\n  }\n\n  var stack = [];\n  var captureGroup = undefined;\n\n  function startCapturing() {\n  \tstack.push(captureGroup = []);\n  }\n\n  function stopCapturing() {\n  \tvar dependencies = stack.pop();\n  \tcaptureGroup = stack[stack.length - 1];\n  \treturn dependencies;\n  }\n\n  function capture(model) {\n  \tif (captureGroup) {\n  \t\tcaptureGroup.push(model);\n  \t}\n  }\n\n  var requestAnimationFrame;\n\n  // If window doesn't exist, we don't need requestAnimationFrame\n  if (!win) {\n  \trequestAnimationFrame = null;\n  } else {\n  \t// https://gist.github.com/paulirish/1579671\n  \t(function (vendors, lastTime, win) {\n\n  \t\tvar x, setTimeout;\n\n  \t\tif (win.requestAnimationFrame) {\n  \t\t\treturn;\n  \t\t}\n\n  \t\tfor (x = 0; x < vendors.length && !win.requestAnimationFrame; ++x) {\n  \t\t\twin.requestAnimationFrame = win[vendors[x] + 'RequestAnimationFrame'];\n  \t\t}\n\n  \t\tif (!win.requestAnimationFrame) {\n  \t\t\tsetTimeout = win.setTimeout;\n\n  \t\t\twin.requestAnimationFrame = function (callback) {\n  \t\t\t\tvar currTime, timeToCall, id;\n\n  \t\t\t\tcurrTime = Date.now();\n  \t\t\t\ttimeToCall = Math.max(0, 16 - (currTime - lastTime));\n  \t\t\t\tid = setTimeout(function () {\n  \t\t\t\t\tcallback(currTime + timeToCall);\n  \t\t\t\t}, timeToCall);\n\n  \t\t\t\tlastTime = currTime + timeToCall;\n  \t\t\t\treturn id;\n  \t\t\t};\n  \t\t}\n  \t})(vendors, 0, win);\n\n  \trequestAnimationFrame = win.requestAnimationFrame;\n  }\n\n  var rAF = requestAnimationFrame;\n\n  var getTime = win && win.performance && typeof win.performance.now === 'function' ? function () {\n  \treturn win.performance.now();\n  } : function () {\n  \treturn Date.now();\n  };\n\n  // TODO what happens if a transition is aborted?\n\n  var tickers = [];\n  var running = false;\n\n  function tick() {\n  \trunloop.start();\n\n  \tvar now = getTime();\n\n  \tvar i = undefined;\n  \tvar ticker = undefined;\n\n  \tfor (i = 0; i < tickers.length; i += 1) {\n  \t\tticker = tickers[i];\n\n  \t\tif (!ticker.tick(now)) {\n  \t\t\t// ticker is complete, remove it from the stack, and decrement i so we don't miss one\n  \t\t\ttickers.splice(i--, 1);\n  \t\t}\n  \t}\n\n  \trunloop.end();\n\n  \tif (tickers.length) {\n  \t\trAF(tick);\n  \t} else {\n  \t\trunning = false;\n  \t}\n  }\n\n  var Ticker = (function () {\n  \tfunction Ticker(options) {\n  \t\tclassCallCheck(this, Ticker);\n\n  \t\tthis.duration = options.duration;\n  \t\tthis.step = options.step;\n  \t\tthis.complete = options.complete;\n  \t\tthis.easing = options.easing;\n\n  \t\tthis.start = getTime();\n  \t\tthis.end = this.start + this.duration;\n\n  \t\tthis.running = true;\n\n  \t\ttickers.push(this);\n  \t\tif (!running) rAF(tick);\n  \t}\n\n  \tTicker.prototype.tick = function tick(now) {\n  \t\tif (!this.running) return false;\n\n  \t\tif (now > this.end) {\n  \t\t\tif (this.step) this.step(1);\n  \t\t\tif (this.complete) this.complete(1);\n\n  \t\t\treturn false;\n  \t\t}\n\n  \t\tvar elapsed = now - this.start;\n  \t\tvar eased = this.easing(elapsed / this.duration);\n\n  \t\tif (this.step) this.step(eased);\n\n  \t\treturn true;\n  \t};\n\n  \tTicker.prototype.stop = function stop() {\n  \t\tif (this.abort) this.abort();\n  \t\tthis.running = false;\n  \t};\n\n  \treturn Ticker;\n  })();\n\n  var prefixers = {};\n\n  // TODO this is legacy. sooner we can replace the old adaptor API the better\n  function prefixKeypath(obj, prefix) {\n  \tvar prefixed = {},\n  \t    key;\n\n  \tif (!prefix) {\n  \t\treturn obj;\n  \t}\n\n  \tprefix += '.';\n\n  \tfor (key in obj) {\n  \t\tif (obj.hasOwnProperty(key)) {\n  \t\t\tprefixed[prefix + key] = obj[key];\n  \t\t}\n  \t}\n\n  \treturn prefixed;\n  }\n  function getPrefixer(rootKeypath) {\n  \tvar rootDot;\n\n  \tif (!prefixers[rootKeypath]) {\n  \t\trootDot = rootKeypath ? rootKeypath + '.' : '';\n\n  \t\tprefixers[rootKeypath] = function (relativeKeypath, value) {\n  \t\t\tvar obj;\n\n  \t\t\tif (typeof relativeKeypath === 'string') {\n  \t\t\t\tobj = {};\n  \t\t\t\tobj[rootDot + relativeKeypath] = value;\n  \t\t\t\treturn obj;\n  \t\t\t}\n\n  \t\t\tif (typeof relativeKeypath === 'object') {\n  \t\t\t\t// 'relativeKeypath' is in fact a hash, not a keypath\n  \t\t\t\treturn rootDot ? prefixKeypath(relativeKeypath, rootKeypath) : relativeKeypath;\n  \t\t\t}\n  \t\t};\n  \t}\n\n  \treturn prefixers[rootKeypath];\n  }\n\n  var KeyModel = (function () {\n  \tfunction KeyModel(key) {\n  \t\tclassCallCheck(this, KeyModel);\n\n  \t\tthis.value = key;\n  \t\tthis.isReadonly = true;\n  \t\tthis.dependants = [];\n  \t}\n\n  \tKeyModel.prototype.get = function get() {\n  \t\treturn unescapeKey(this.value);\n  \t};\n\n  \tKeyModel.prototype.getKeypath = function getKeypath() {\n  \t\treturn unescapeKey(this.value);\n  \t};\n\n  \tKeyModel.prototype.rebind = function rebind(key) {\n  \t\tthis.value = key;\n  \t\tthis.dependants.forEach(_handleChange);\n  \t};\n\n  \tKeyModel.prototype.register = function register(dependant) {\n  \t\tthis.dependants.push(dependant);\n  \t};\n\n  \tKeyModel.prototype.unregister = function unregister(dependant) {\n  \t\tremoveFromArray(this.dependants, dependant);\n  \t};\n\n  \treturn KeyModel;\n  })();\n\n  var KeypathModel = (function () {\n  \tfunction KeypathModel(parent, ractive) {\n  \t\tclassCallCheck(this, KeypathModel);\n\n  \t\tthis.parent = parent;\n  \t\tthis.ractive = ractive;\n  \t\tthis.value = ractive ? parent.getKeypath(ractive) : parent.getKeypath();\n  \t\tthis.dependants = [];\n  \t\tthis.children = [];\n  \t}\n\n  \tKeypathModel.prototype.addChild = function addChild(model) {\n  \t\tthis.children.push(model);\n  \t\tmodel.owner = this;\n  \t};\n\n  \tKeypathModel.prototype.get = function get() {\n  \t\treturn this.value;\n  \t};\n\n  \tKeypathModel.prototype.getKeypath = function getKeypath() {\n  \t\treturn this.value;\n  \t};\n\n  \tKeypathModel.prototype.handleChange = function handleChange() {\n  \t\tthis.value = this.ractive ? this.parent.getKeypath(this.ractive) : this.parent.getKeypath();\n  \t\tif (this.ractive && this.owner) {\n  \t\t\tthis.ractive.viewmodel.keypathModels[this.owner.value] = this;\n  \t\t}\n  \t\tthis.children.forEach(_handleChange);\n  \t\tthis.dependants.forEach(_handleChange);\n  \t};\n\n  \tKeypathModel.prototype.register = function register(dependant) {\n  \t\tthis.dependants.push(dependant);\n  \t};\n\n  \tKeypathModel.prototype.removeChild = function removeChild(model) {\n  \t\tremoveFromArray(this.children, model);\n  \t};\n\n  \tKeypathModel.prototype.teardown = function teardown() {\n  \t\tif (this.owner) this.owner.removeChild(this);\n  \t\tthis.children.forEach(_teardown);\n  \t};\n\n  \tKeypathModel.prototype.unregister = function unregister(dependant) {\n  \t\tremoveFromArray(this.dependants, dependant);\n  \t};\n\n  \treturn KeypathModel;\n  })();\n\n  var hasProp$1 = Object.prototype.hasOwnProperty;\n\n  function _updateFromBindings(model) {\n  \tmodel.updateFromBindings(true);\n  }\n\n  function _updateKeypathDependants(model) {\n  \tmodel.updateKeypathDependants();\n  }\n\n  var originatingModel = null;\n\n  var Model = (function () {\n  \tfunction Model(parent, key) {\n  \t\tclassCallCheck(this, Model);\n\n  \t\tthis.deps = [];\n\n  \t\tthis.children = [];\n  \t\tthis.childByKey = {};\n\n  \t\tthis.indexModels = [];\n\n  \t\tthis.unresolved = [];\n  \t\tthis.unresolvedByKey = {};\n\n  \t\tthis.bindings = [];\n\n  \t\tthis.value = undefined;\n\n  \t\tthis.ticker = null;\n\n  \t\tif (parent) {\n  \t\t\tthis.parent = parent;\n  \t\t\tthis.root = parent.root;\n  \t\t\tthis.key = unescapeKey(key);\n  \t\t\tthis.isReadonly = parent.isReadonly;\n\n  \t\t\tif (parent.value) {\n  \t\t\t\tthis.value = parent.value[this.key];\n  \t\t\t\tthis.adapt();\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \tModel.prototype.adapt = function adapt() {\n  \t\tvar adaptors = this.root.adaptors;\n  \t\tvar len = adaptors.length;\n\n  \t\t// Exit early if no adaptors\n  \t\tif (len === 0) return;\n\n  \t\tvar value = this.value;\n\n  \t\t// TODO remove this legacy nonsense\n  \t\tvar ractive = this.root.ractive;\n  \t\tvar keypath = this.getKeypath();\n\n  \t\tvar i = undefined;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tvar adaptor = adaptors[i];\n  \t\t\tif (adaptor.filter(value, keypath, ractive)) {\n  \t\t\t\tthis.wrapper = adaptor.wrap(ractive, value, keypath, getPrefixer(keypath));\n  \t\t\t\tthis.wrapper.value = this.value;\n  \t\t\t\tthis.wrapper.__model = this; // massive temporary hack to enable array adaptor\n\n  \t\t\t\tthis.value = this.wrapper.get();\n\n  \t\t\t\tbreak;\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tModel.prototype.addUnresolved = function addUnresolved(key, resolver) {\n  \t\tif (!this.unresolvedByKey[key]) {\n  \t\t\tthis.unresolved.push(key);\n  \t\t\tthis.unresolvedByKey[key] = [];\n  \t\t}\n\n  \t\tthis.unresolvedByKey[key].push(resolver);\n  \t};\n\n  \tModel.prototype.animate = function animate(from, to, options, interpolator) {\n  \t\tvar _this = this;\n\n  \t\tif (this.ticker) this.ticker.stop();\n\n  \t\tvar fulfilPromise = undefined;\n  \t\tvar promise = new Promise$1(function (fulfil) {\n  \t\t\treturn fulfilPromise = fulfil;\n  \t\t});\n\n  \t\tthis.ticker = new Ticker({\n  \t\t\tduration: options.duration,\n  \t\t\teasing: options.easing,\n  \t\t\tstep: function (t) {\n  \t\t\t\tvar value = interpolator(t);\n  \t\t\t\t_this.applyValue(value);\n  \t\t\t\tif (options.step) options.step(t, value);\n  \t\t\t},\n  \t\t\tcomplete: function () {\n  \t\t\t\t_this.applyValue(to);\n  \t\t\t\tif (options.complete) options.complete(to);\n\n  \t\t\t\t_this.ticker = null;\n  \t\t\t\tfulfilPromise();\n  \t\t\t}\n  \t\t});\n\n  \t\tpromise.stop = this.ticker.stop;\n  \t\treturn promise;\n  \t};\n\n  \tModel.prototype.applyValue = function applyValue(value) {\n  \t\tif (isEqual(value, this.value)) return;\n\n  \t\t// TODO deprecate this nonsense\n  \t\tthis.root.changes[this.getKeypath()] = value;\n\n  \t\tif (this.parent.wrapper && this.parent.wrapper.set) {\n  \t\t\tthis.parent.wrapper.set(this.key, value);\n  \t\t\tthis.parent.value = this.parent.wrapper.get();\n\n  \t\t\tthis.value = this.parent.value[this.key];\n  \t\t\t// TODO should this value be adapted? probably\n  \t\t} else if (this.wrapper) {\n  \t\t\t\tvar shouldTeardown = !this.wrapper.reset || this.wrapper.reset(value) === false;\n\n  \t\t\t\tif (shouldTeardown) {\n  \t\t\t\t\tthis.wrapper.teardown();\n  \t\t\t\t\tthis.wrapper = null;\n  \t\t\t\t\tvar parentValue = this.parent.value || this.parent.createBranch(this.key);\n  \t\t\t\t\tparentValue[this.key] = this.value = value;\n  \t\t\t\t\tthis.adapt();\n  \t\t\t\t} else {\n  \t\t\t\t\tthis.value = this.wrapper.get();\n  \t\t\t\t}\n  \t\t\t} else {\n  \t\t\t\tvar parentValue = this.parent.value || this.parent.createBranch(this.key);\n  \t\t\t\tparentValue[this.key] = value;\n\n  \t\t\t\tthis.value = value;\n  \t\t\t\tthis.adapt();\n  \t\t\t}\n\n  \t\tthis.parent.clearUnresolveds();\n  \t\tthis.clearUnresolveds();\n\n  \t\t// notify dependants\n  \t\tvar previousOriginatingModel = originatingModel; // for the array.length special case\n  \t\toriginatingModel = this;\n\n  \t\tthis.children.forEach(_mark);\n  \t\tthis.deps.forEach(_handleChange);\n\n  \t\tvar parent = this.parent;\n  \t\twhile (parent) {\n  \t\t\tparent.deps.forEach(_handleChange);\n  \t\t\tparent = parent.parent;\n  \t\t}\n\n  \t\toriginatingModel = previousOriginatingModel;\n  \t};\n\n  \tModel.prototype.clearUnresolveds = function clearUnresolveds(specificKey) {\n  \t\tvar i = this.unresolved.length;\n\n  \t\twhile (i--) {\n  \t\t\tvar key = this.unresolved[i];\n\n  \t\t\tif (specificKey && key !== specificKey) continue;\n\n  \t\t\tvar resolvers = this.unresolvedByKey[key];\n  \t\t\tvar hasKey = this.has(key);\n\n  \t\t\tvar j = resolvers.length;\n  \t\t\twhile (j--) {\n  \t\t\t\tif (hasKey) resolvers[j].attemptResolution();\n  \t\t\t\tif (resolvers[j].resolved) resolvers.splice(j, 1);\n  \t\t\t}\n\n  \t\t\tif (!resolvers.length) {\n  \t\t\t\tthis.unresolved.splice(i, 1);\n  \t\t\t\tthis.unresolvedByKey[key] = null;\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tModel.prototype.createBranch = function createBranch(key) {\n  \t\tvar branch = isNumeric(key) ? [] : {};\n  \t\tthis.set(branch);\n\n  \t\treturn branch;\n  \t};\n\n  \tModel.prototype.findMatches = function findMatches(keys) {\n  \t\tvar len = keys.length;\n\n  \t\tvar existingMatches = [this];\n  \t\tvar matches = undefined;\n  \t\tvar i = undefined;\n\n  \t\tvar _loop = function () {\n  \t\t\tvar key = keys[i];\n\n  \t\t\tif (key === '*') {\n  \t\t\t\tmatches = [];\n  \t\t\t\texistingMatches.forEach(function (model) {\n  \t\t\t\t\tmatches.push.apply(matches, model.getValueChildren(model.get()));\n  \t\t\t\t});\n  \t\t\t} else {\n  \t\t\t\tmatches = existingMatches.map(function (model) {\n  \t\t\t\t\treturn model.joinKey(key);\n  \t\t\t\t});\n  \t\t\t}\n\n  \t\t\texistingMatches = matches;\n  \t\t};\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\t_loop();\n  \t\t}\n\n  \t\treturn matches;\n  \t};\n\n  \tModel.prototype.get = function get(shouldCapture) {\n  \t\tif (shouldCapture) capture(this);\n  \t\treturn this.value;\n  \t};\n\n  \tModel.prototype.getIndexModel = function getIndexModel(fragmentIndex) {\n  \t\tvar indexModels = this.parent.indexModels;\n\n  \t\t// non-numeric keys are a special of a numeric index in a object iteration\n  \t\tif (typeof this.key === 'string' && fragmentIndex !== undefined) {\n  \t\t\treturn new KeyModel(fragmentIndex);\n  \t\t} else if (!indexModels[this.key]) {\n  \t\t\tindexModels[this.key] = new KeyModel(this.key);\n  \t\t}\n\n  \t\treturn indexModels[this.key];\n  \t};\n\n  \tModel.prototype.getKeyModel = function getKeyModel() {\n  \t\t// TODO... different to IndexModel because key can never change\n  \t\treturn new KeyModel(escapeKey(this.key));\n  \t};\n\n  \tModel.prototype.getKeypathModel = function getKeypathModel(ractive) {\n  \t\tvar keypath = this.getKeypath(),\n  \t\t    model = this.keypathModel || (this.keypathModel = new KeypathModel(this));\n\n  \t\tif (ractive && ractive.component) {\n  \t\t\tvar mapped = this.getKeypath(ractive);\n  \t\t\tif (mapped !== keypath) {\n  \t\t\t\tvar map = ractive.viewmodel.keypathModels || (ractive.viewmodel.keypathModels = {});\n  \t\t\t\tvar child = map[keypath] || (map[keypath] = new KeypathModel(this, ractive));\n  \t\t\t\tmodel.addChild(child);\n  \t\t\t\treturn child;\n  \t\t\t}\n  \t\t}\n\n  \t\treturn model;\n  \t};\n\n  \tModel.prototype.getKeypath = function getKeypath(ractive) {\n  \t\tvar root = this.parent.isRoot ? escapeKey(this.key) : this.parent.getKeypath() + '.' + escapeKey(this.key);\n\n  \t\tif (ractive && ractive.component) {\n  \t\t\tvar map = ractive.viewmodel.mappings;\n  \t\t\tfor (var k in map) {\n  \t\t\t\tif (root.indexOf(map[k].getKeypath()) >= 0) {\n  \t\t\t\t\troot = root.replace(map[k].getKeypath(), k);\n  \t\t\t\t\tbreak;\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\treturn root;\n  \t};\n\n  \tModel.prototype.getValueChildren = function getValueChildren(value) {\n  \t\tvar _this2 = this;\n\n  \t\tvar children = undefined;\n  \t\tif (isArray(value)) {\n  \t\t\tchildren = [];\n  \t\t\t// special case - array.length. This is a horrible kludge, but\n  \t\t\t// it'll do for now. Alternatives welcome\n  \t\t\tif (originatingModel && originatingModel.parent === this && originatingModel.key === 'length') {\n  \t\t\t\tchildren.push(originatingModel);\n  \t\t\t}\n  \t\t\tvalue.forEach(function (m, i) {\n  \t\t\t\tchildren.push(_this2.joinKey(i));\n  \t\t\t});\n  \t\t} else if (isObject(value) || typeof value === 'function') {\n  \t\t\tchildren = Object.keys(value).map(function (key) {\n  \t\t\t\treturn _this2.joinKey(key);\n  \t\t\t});\n  \t\t} else if (value != null) {\n  \t\t\t// TODO: this will return incorrect keypath if model is mapped\n  \t\t\tthrow new Error('Cannot get values of ' + this.getKeypath() + '.* as ' + this.getKeypath() + ' is not an array, object or function');\n  \t\t}\n\n  \t\treturn children;\n  \t};\n\n  \tModel.prototype.has = function has(key) {\n  \t\tvar value = this.get();\n  \t\tif (!value) return false;\n\n  \t\tkey = unescapeKey(key);\n  \t\tif (hasProp$1.call(value, key)) return true;\n\n  \t\t// We climb up the constructor chain to find if one of them contains the key\n  \t\tvar constructor = value.constructor;\n  \t\twhile (constructor !== Function && constructor !== Array && constructor !== Object) {\n  \t\t\tif (hasProp$1.call(constructor.prototype, key)) return true;\n  \t\t\tconstructor = constructor.constructor;\n  \t\t}\n\n  \t\treturn false;\n  \t};\n\n  \tModel.prototype.joinKey = function joinKey(key) {\n  \t\tif (key === undefined || key === '') return this;\n\n  \t\tif (!this.childByKey.hasOwnProperty(key)) {\n  \t\t\tvar child = new Model(this, key);\n  \t\t\tthis.children.push(child);\n  \t\t\tthis.childByKey[key] = child;\n  \t\t}\n\n  \t\treturn this.childByKey[key];\n  \t};\n\n  \tModel.prototype.joinAll = function joinAll(keys) {\n  \t\tvar model = this;\n  \t\tfor (var i = 0; i < keys.length; i += 1) {\n  \t\t\tmodel = model.joinKey(keys[i]);\n  \t\t}\n\n  \t\treturn model;\n  \t};\n\n  \tModel.prototype.mark = function mark() {\n  \t\tvar value = this.retrieve();\n\n  \t\tif (!isEqual(value, this.value)) {\n  \t\t\tthis.value = value;\n\n  \t\t\tthis.children.forEach(_mark);\n\n  \t\t\tthis.deps.forEach(_handleChange);\n  \t\t\tthis.clearUnresolveds();\n  \t\t}\n  \t};\n\n  \tModel.prototype.merge = function merge(array, comparator) {\n  \t\tvar oldArray = comparator ? this.value.map(comparator) : this.value;\n  \t\tvar newArray = comparator ? array.map(comparator) : array;\n\n  \t\tvar oldLength = oldArray.length;\n\n  \t\tvar usedIndices = {};\n  \t\tvar firstUnusedIndex = 0;\n\n  \t\tvar newIndices = oldArray.map(function (item) {\n  \t\t\tvar index = undefined;\n  \t\t\tvar start = firstUnusedIndex;\n\n  \t\t\tdo {\n  \t\t\t\tindex = newArray.indexOf(item, start);\n\n  \t\t\t\tif (index === -1) {\n  \t\t\t\t\treturn -1;\n  \t\t\t\t}\n\n  \t\t\t\tstart = index + 1;\n  \t\t\t} while (usedIndices[index] === true && start < oldLength);\n\n  \t\t\t// keep track of the first unused index, so we don't search\n  \t\t\t// the whole of newArray for each item in oldArray unnecessarily\n  \t\t\tif (index === firstUnusedIndex) {\n  \t\t\t\tfirstUnusedIndex += 1;\n  \t\t\t}\n  \t\t\t// allow next instance of next \"equal\" to be found item\n  \t\t\tusedIndices[index] = true;\n  \t\t\treturn index;\n  \t\t});\n\n  \t\tthis.parent.value[this.key] = array;\n  \t\tthis._merged = true;\n  \t\tthis.shuffle(newIndices);\n  \t};\n\n  \tModel.prototype.register = function register(dep) {\n  \t\tthis.deps.push(dep);\n  \t};\n\n  \tModel.prototype.registerTwowayBinding = function registerTwowayBinding(binding) {\n  \t\tthis.bindings.push(binding);\n  \t};\n\n  \tModel.prototype.retrieve = function retrieve() {\n  \t\treturn this.parent.value ? this.parent.value[this.key] : undefined;\n  \t};\n\n  \tModel.prototype.set = function set(value) {\n  \t\tif (this.ticker) this.ticker.stop();\n  \t\tthis.applyValue(value);\n  \t};\n\n  \tModel.prototype.shuffle = function shuffle(newIndices) {\n  \t\tvar _this3 = this;\n\n  \t\tvar indexModels = [];\n\n  \t\tnewIndices.forEach(function (newIndex, oldIndex) {\n  \t\t\tif (! ~newIndex) return;\n\n  \t\t\tvar model = _this3.indexModels[oldIndex];\n\n  \t\t\tif (!model) return;\n\n  \t\t\tindexModels[newIndex] = model;\n\n  \t\t\tif (newIndex !== oldIndex) {\n  \t\t\t\tmodel.rebind(newIndex);\n  \t\t\t}\n  \t\t});\n\n  \t\tthis.indexModels = indexModels;\n\n  \t\t// shuffles need to happen before marks...\n  \t\tthis.deps.forEach(function (dep) {\n  \t\t\tif (dep.shuffle) dep.shuffle(newIndices);\n  \t\t});\n\n  \t\tthis.updateKeypathDependants();\n  \t\tthis.mark();\n\n  \t\t// ...but handleChange must happen after (TODO document why)\n  \t\tthis.deps.forEach(function (dep) {\n  \t\t\tif (!dep.shuffle) dep.handleChange();\n  \t\t});\n  \t};\n\n  \tModel.prototype.teardown = function teardown() {\n  \t\tthis.children.forEach(_teardown);\n  \t\tif (this.wrapper) this.wrapper.teardown();\n  \t\tif (this.keypathModels) {\n  \t\t\tfor (var k in this.keypathModels) {\n  \t\t\t\tthis.keypathModels[k].teardown();\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tModel.prototype.unregister = function unregister(dependant) {\n  \t\tremoveFromArray(this.deps, dependant);\n  \t};\n\n  \tModel.prototype.unregisterTwowayBinding = function unregisterTwowayBinding(binding) {\n  \t\tremoveFromArray(this.bindings, binding);\n  \t};\n\n  \tModel.prototype.updateFromBindings = function updateFromBindings(cascade) {\n  \t\tvar i = this.bindings.length;\n  \t\twhile (i--) {\n  \t\t\tvar value = this.bindings[i].getValue();\n  \t\t\tif (value !== this.value) this.set(value);\n  \t\t}\n\n  \t\tif (cascade) {\n  \t\t\tthis.children.forEach(_updateFromBindings);\n  \t\t}\n  \t};\n\n  \tModel.prototype.updateKeypathDependants = function updateKeypathDependants() {\n  \t\tthis.children.forEach(_updateKeypathDependants);\n  \t\tif (this.keypathModel) this.keypathModel.handleChange();\n  \t};\n\n  \treturn Model;\n  })();\n\n  var GlobalModel = (function (_Model) {\n  \tinherits(GlobalModel, _Model);\n\n  \tfunction GlobalModel() {\n  \t\tclassCallCheck(this, GlobalModel);\n\n  \t\t_Model.call(this, null, '@global');\n  \t\tthis.value = typeof global !== 'undefined' ? global : window;\n  \t\tthis.isRoot = true;\n  \t\tthis.root = this;\n  \t\tthis.adaptors = [];\n  \t\tthis.changes = {};\n  \t}\n\n  \tGlobalModel.prototype.getKeypath = function getKeypath() {\n  \t\treturn '@global';\n  \t};\n\n  \treturn GlobalModel;\n  })(Model);\n\n  var GlobalModel$1 = new GlobalModel();\n\n  function resolveReference(fragment, ref) {\n  \tvar context = fragment.findContext();\n\n  \t// special references\n  \t// TODO does `this` become `.` at parse time?\n  \tif (ref === '.' || ref === 'this') return context;\n  \tif (ref === '@keypath') return context.getKeypathModel(fragment.ractive);\n  \tif (ref === '@rootpath') return context.getKeypathModel();\n  \tif (ref === '@index') {\n  \t\tvar repeater = fragment.findRepeatingFragment();\n  \t\t// make sure the found fragment is actually an iteration\n  \t\tif (!repeater.isIteration) return;\n  \t\treturn repeater.context.getIndexModel(repeater.index);\n  \t}\n  \tif (ref === '@key') return fragment.findRepeatingFragment().context.getKeyModel();\n  \tif (ref === '@ractive') {\n  \t\treturn fragment.ractive.viewmodel.getRactiveModel();\n  \t}\n  \tif (ref === '@global') {\n  \t\treturn GlobalModel$1;\n  \t}\n\n  \t// ancestor references\n  \tif (ref[0] === '~') return fragment.ractive.viewmodel.joinAll(splitKeypath(ref.slice(2)));\n  \tif (ref[0] === '.') {\n  \t\tvar parts = ref.split('/');\n\n  \t\twhile (parts[0] === '.' || parts[0] === '..') {\n  \t\t\tvar part = parts.shift();\n\n  \t\t\tif (part === '..') {\n  \t\t\t\tcontext = context.parent;\n  \t\t\t}\n  \t\t}\n\n  \t\tref = parts.join('/');\n\n  \t\t// special case - `{{.foo}}` means the same as `{{./foo}}`\n  \t\tif (ref[0] === '.') ref = ref.slice(1);\n  \t\treturn context.joinAll(splitKeypath(ref));\n  \t}\n\n  \treturn resolveAmbiguousReference(fragment, ref);\n  }\n\n  var ComputationChild = (function (_Model) {\n  \tinherits(ComputationChild, _Model);\n\n  \tfunction ComputationChild() {\n  \t\tclassCallCheck(this, ComputationChild);\n\n  \t\t_Model.apply(this, arguments);\n  \t}\n\n  \tComputationChild.prototype.get = function get(shouldCapture) {\n  \t\tif (shouldCapture) capture(this);\n\n  \t\tvar parentValue = this.parent.get();\n  \t\treturn parentValue ? parentValue[this.key] : undefined;\n  \t};\n\n  \tComputationChild.prototype.handleChange = function handleChange() {\n  \t\tthis.dirty = true;\n\n  \t\tthis.deps.forEach(_handleChange);\n  \t\tthis.children.forEach(_handleChange);\n  \t\tthis.clearUnresolveds(); // TODO is this necessary?\n  \t};\n\n  \tComputationChild.prototype.joinKey = function joinKey(key) {\n  \t\tif (key === undefined || key === '') return this;\n\n  \t\tif (!this.childByKey.hasOwnProperty(key)) {\n  \t\t\tvar child = new ComputationChild(this, key);\n  \t\t\tthis.children.push(child);\n  \t\t\tthis.childByKey[key] = child;\n  \t\t}\n\n  \t\treturn this.childByKey[key];\n  \t};\n\n  \t// TODO this causes problems with inter-component mappings\n  \t// set () {\n  \t// \tthrow new Error( `Cannot set read-only property of computed value (${this.getKeypath()})` );\n  \t// }\n  \treturn ComputationChild;\n  })(Model);\n\n  function getValue(model) {\n  \treturn model ? model.get(true) : undefined;\n  }\n\n  var ExpressionProxy = (function (_Model) {\n  \tinherits(ExpressionProxy, _Model);\n\n  \tfunction ExpressionProxy(fragment, template) {\n  \t\tvar _this = this;\n\n  \t\tclassCallCheck(this, ExpressionProxy);\n\n  \t\t_Model.call(this, fragment.ractive.viewmodel, null);\n\n  \t\tthis.fragment = fragment;\n  \t\tthis.template = template;\n\n  \t\tthis.isReadonly = true;\n\n  \t\tthis.fn = getFunction(template.s, template.r.length);\n  \t\tthis.computation = null;\n\n  \t\tthis.resolvers = [];\n  \t\tthis.models = this.template.r.map(function (ref, index) {\n  \t\t\tvar model = resolveReference(_this.fragment, ref);\n  \t\t\tvar resolver = undefined;\n\n  \t\t\tif (!model) {\n  \t\t\t\tresolver = _this.fragment.resolve(ref, function (model) {\n  \t\t\t\t\tremoveFromArray(_this.resolvers, resolver);\n  \t\t\t\t\t_this.models[index] = model;\n  \t\t\t\t\t_this.bubble();\n  \t\t\t\t});\n\n  \t\t\t\t_this.resolvers.push(resolver);\n  \t\t\t}\n\n  \t\t\treturn model;\n  \t\t});\n\n  \t\tthis.bubble();\n  \t}\n\n  \tExpressionProxy.prototype.bubble = function bubble() {\n  \t\tvar _this2 = this;\n\n  \t\tvar ractive = this.fragment.ractive;\n\n  \t\t// TODO the @ prevents computed props from shadowing keypaths, but the real\n  \t\t// question is why it's a computed prop in the first place... (hint, it's\n  \t\t// to do with {{else}} blocks)\n  \t\tvar key = '@' + this.template.s.replace(/_(\\d+)/g, function (match, i) {\n  \t\t\tif (i >= _this2.models.length) return match;\n\n  \t\t\tvar model = _this2.models[i];\n  \t\t\treturn model ? model.getKeypath() : '@undefined';\n  \t\t});\n\n  \t\t// TODO can/should we reuse computations?\n  \t\tvar signature = {\n  \t\t\tgetter: function () {\n  \t\t\t\tvar values = _this2.models.map(getValue);\n  \t\t\t\treturn _this2.fn.apply(ractive, values);\n  \t\t\t},\n  \t\t\tgetterString: key\n  \t\t};\n\n  \t\tvar computation = ractive.viewmodel.compute(key, signature);\n\n  \t\tthis.value = computation.get(); // TODO should not need this, eventually\n\n  \t\tif (this.computation) {\n  \t\t\tthis.computation.unregister(this);\n  \t\t\t// notify children...\n  \t\t}\n\n  \t\tthis.computation = computation;\n  \t\tcomputation.register(this);\n\n  \t\tthis.handleChange();\n  \t};\n\n  \tExpressionProxy.prototype.get = function get(shouldCapture) {\n  \t\treturn this.computation.get(shouldCapture);\n  \t};\n\n  \tExpressionProxy.prototype.getKeypath = function getKeypath() {\n  \t\treturn this.computation ? this.computation.getKeypath() : '@undefined';\n  \t};\n\n  \tExpressionProxy.prototype.handleChange = function handleChange() {\n  \t\tthis.deps.forEach(_handleChange);\n  \t\tthis.children.forEach(_handleChange);\n\n  \t\tthis.clearUnresolveds();\n  \t};\n\n  \tExpressionProxy.prototype.joinKey = function joinKey(key) {\n  \t\tif (key === undefined || key === '') return this;\n\n  \t\tif (!this.childByKey.hasOwnProperty(key)) {\n  \t\t\tvar child = new ComputationChild(this, key);\n  \t\t\tthis.children.push(child);\n  \t\t\tthis.childByKey[key] = child;\n  \t\t}\n\n  \t\treturn this.childByKey[key];\n  \t};\n\n  \tExpressionProxy.prototype.mark = function mark() {\n  \t\tthis.handleChange();\n  \t};\n\n  \tExpressionProxy.prototype.retrieve = function retrieve() {\n  \t\treturn this.get();\n  \t};\n\n  \tExpressionProxy.prototype.unbind = function unbind() {\n  \t\tthis.resolvers.forEach(_unbind);\n  \t};\n\n  \treturn ExpressionProxy;\n  })(Model);\n\n  var ReferenceExpressionChild = (function (_Model) {\n  \tinherits(ReferenceExpressionChild, _Model);\n\n  \tfunction ReferenceExpressionChild(parent, key) {\n  \t\tclassCallCheck(this, ReferenceExpressionChild);\n\n  \t\t_Model.call(this, parent, key);\n  \t}\n\n  \tReferenceExpressionChild.prototype.applyValue = function applyValue(value) {\n  \t\tif (isEqual(value, this.value)) return;\n\n  \t\tvar parent = this.parent,\n  \t\t    keys = [this.key];\n  \t\twhile (parent) {\n  \t\t\tif (parent.base) {\n  \t\t\t\tvar target = parent.model.joinAll(keys);\n  \t\t\t\ttarget.applyValue(value);\n  \t\t\t\tbreak;\n  \t\t\t}\n\n  \t\t\tkeys.unshift(parent.key);\n\n  \t\t\tparent = parent.parent;\n  \t\t}\n  \t};\n\n  \tReferenceExpressionChild.prototype.joinKey = function joinKey(key) {\n  \t\tif (key === undefined || key === '') return this;\n\n  \t\tif (!this.childByKey.hasOwnProperty(key)) {\n  \t\t\tvar child = new ReferenceExpressionChild(this, key);\n  \t\t\tthis.children.push(child);\n  \t\t\tthis.childByKey[key] = child;\n  \t\t}\n\n  \t\treturn this.childByKey[key];\n  \t};\n\n  \treturn ReferenceExpressionChild;\n  })(Model);\n\n  var ReferenceExpressionProxy = (function (_Model2) {\n  \tinherits(ReferenceExpressionProxy, _Model2);\n\n  \tfunction ReferenceExpressionProxy(fragment, template) {\n  \t\tvar _this = this;\n\n  \t\tclassCallCheck(this, ReferenceExpressionProxy);\n\n  \t\t_Model2.call(this, null, null);\n  \t\tthis.root = fragment.ractive.viewmodel;\n\n  \t\tthis.resolvers = [];\n\n  \t\tthis.base = resolve$1(fragment, template);\n  \t\tvar baseResolver = undefined;\n\n  \t\tif (!this.base) {\n  \t\t\tbaseResolver = fragment.resolve(template.r, function (model) {\n  \t\t\t\t_this.base = model;\n  \t\t\t\t_this.bubble();\n\n  \t\t\t\tremoveFromArray(_this.resolvers, baseResolver);\n  \t\t\t});\n\n  \t\t\tthis.resolvers.push(baseResolver);\n  \t\t}\n\n  \t\tvar intermediary = {\n  \t\t\thandleChange: function () {\n  \t\t\t\treturn _this.bubble();\n  \t\t\t}\n  \t\t};\n\n  \t\tthis.members = template.m.map(function (template, i) {\n  \t\t\tif (typeof template === 'string') {\n  \t\t\t\treturn { get: function () {\n  \t\t\t\t\t\treturn template;\n  \t\t\t\t\t} };\n  \t\t\t}\n\n  \t\t\tvar model = undefined;\n  \t\t\tvar resolver = undefined;\n\n  \t\t\tif (template.t === REFERENCE) {\n  \t\t\t\tmodel = resolveReference(fragment, template.n);\n\n  \t\t\t\tif (model) {\n  \t\t\t\t\tmodel.register(intermediary);\n  \t\t\t\t} else {\n  \t\t\t\t\tresolver = fragment.resolve(template.n, function (model) {\n  \t\t\t\t\t\t_this.members[i] = model;\n\n  \t\t\t\t\t\tmodel.register(intermediary);\n  \t\t\t\t\t\t_this.bubble();\n\n  \t\t\t\t\t\tremoveFromArray(_this.resolvers, resolver);\n  \t\t\t\t\t});\n\n  \t\t\t\t\t_this.resolvers.push(resolver);\n  \t\t\t\t}\n\n  \t\t\t\treturn model;\n  \t\t\t}\n\n  \t\t\tmodel = new ExpressionProxy(fragment, template);\n  \t\t\tmodel.register(intermediary);\n  \t\t\treturn model;\n  \t\t});\n\n  \t\tthis.isUnresolved = true;\n  \t\tthis.bubble();\n  \t}\n\n  \tReferenceExpressionProxy.prototype.bubble = function bubble() {\n  \t\tif (!this.base) return;\n\n  \t\t// if some members are not resolved, abort\n  \t\tvar i = this.members.length;\n  \t\twhile (i--) {\n  \t\t\tif (!this.members[i]) return;\n  \t\t}\n\n  \t\tthis.isUnresolved = false;\n\n  \t\tvar keys = this.members.map(function (model) {\n  \t\t\treturn escapeKey(String(model.get()));\n  \t\t});\n  \t\tvar model = this.base.joinAll(keys);\n\n  \t\tif (this.model) {\n  \t\t\tthis.model.unregister(this);\n  \t\t\tthis.model.unregisterTwowayBinding(this);\n  \t\t}\n\n  \t\tthis.model = model;\n  \t\tthis.parent = model.parent;\n\n  \t\tmodel.register(this);\n  \t\tmodel.registerTwowayBinding(this);\n\n  \t\tif (this.keypathModel) this.keypathModel.handleChange();\n\n  \t\tthis.mark();\n  \t};\n\n  \tReferenceExpressionProxy.prototype.forceResolution = function forceResolution() {\n  \t\tthis.resolvers.forEach(function (resolver) {\n  \t\t\treturn resolver.forceResolution();\n  \t\t});\n  \t\tthis.bubble();\n  \t};\n\n  \tReferenceExpressionProxy.prototype.get = function get() {\n  \t\treturn this.model ? this.model.get() : undefined;\n  \t};\n\n  \t// indirect two-way bindings\n\n  \tReferenceExpressionProxy.prototype.getValue = function getValue() {\n  \t\tvar i = this.bindings.length;\n  \t\twhile (i--) {\n  \t\t\tvar value = this.bindings[i].getValue();\n  \t\t\tif (value !== this.value) return value;\n  \t\t}\n\n  \t\treturn this.value;\n  \t};\n\n  \tReferenceExpressionProxy.prototype.getKeypath = function getKeypath() {\n  \t\treturn this.model ? this.model.getKeypath() : '@undefined';\n  \t};\n\n  \tReferenceExpressionProxy.prototype.handleChange = function handleChange() {\n  \t\tthis.mark();\n  \t};\n\n  \tReferenceExpressionProxy.prototype.joinKey = function joinKey(key) {\n  \t\tif (key === undefined || key === '') return this;\n\n  \t\tif (!this.childByKey.hasOwnProperty(key)) {\n  \t\t\tvar child = new ReferenceExpressionChild(this, key);\n  \t\t\tthis.children.push(child);\n  \t\t\tthis.childByKey[key] = child;\n  \t\t}\n\n  \t\treturn this.childByKey[key];\n  \t};\n\n  \tReferenceExpressionProxy.prototype.retrieve = function retrieve() {\n  \t\treturn this.get();\n  \t};\n\n  \tReferenceExpressionProxy.prototype.set = function set(value) {\n  \t\tif (!this.model) throw new Error('Unresolved reference expression. This should not happen!');\n  \t\tthis.model.set(value);\n  \t};\n\n  \tReferenceExpressionProxy.prototype.unbind = function unbind() {\n  \t\tthis.resolvers.forEach(_unbind);\n  \t};\n\n  \treturn ReferenceExpressionProxy;\n  })(Model);\n\n  function resolve$1(fragment, template) {\n  \tif (template.r) {\n  \t\treturn resolveReference(fragment, template.r);\n  \t} else if (template.x) {\n  \t\treturn new ExpressionProxy(fragment, template.x);\n  \t} else {\n  \t\treturn new ReferenceExpressionProxy(fragment, template.rx);\n  \t}\n  }\n\n  function resolveAliases(section) {\n  \tif (section.template.z) {\n  \t\tsection.aliases = {};\n\n  \t\tvar refs = section.template.z;\n  \t\tfor (var i = 0; i < refs.length; i++) {\n  \t\t\tsection.aliases[refs[i].n] = resolve$1(section.parentFragment, refs[i].x);\n  \t\t}\n  \t}\n  }\n\n  var Alias = (function (_Item) {\n  \tinherits(Alias, _Item);\n\n  \tfunction Alias(options) {\n  \t\tclassCallCheck(this, Alias);\n\n  \t\t_Item.call(this, options);\n\n  \t\tthis.fragment = null;\n  \t}\n\n  \tAlias.prototype.bind = function bind() {\n  \t\tresolveAliases(this);\n\n  \t\tthis.fragment = new Fragment({\n  \t\t\towner: this,\n  \t\t\ttemplate: this.template.f\n  \t\t}).bind();\n  \t};\n\n  \tAlias.prototype.detach = function detach() {\n  \t\treturn this.fragment ? this.fragment.detach() : createDocumentFragment();\n  \t};\n\n  \tAlias.prototype.find = function find(selector) {\n  \t\tif (this.fragment) {\n  \t\t\treturn this.fragment.find(selector);\n  \t\t}\n  \t};\n\n  \tAlias.prototype.findAll = function findAll(selector, query) {\n  \t\tif (this.fragment) {\n  \t\t\tthis.fragment.findAll(selector, query);\n  \t\t}\n  \t};\n\n  \tAlias.prototype.findComponent = function findComponent(name) {\n  \t\tif (this.fragment) {\n  \t\t\treturn this.fragment.findComponent(name);\n  \t\t}\n  \t};\n\n  \tAlias.prototype.findAllComponents = function findAllComponents(name, query) {\n  \t\tif (this.fragment) {\n  \t\t\tthis.fragment.findAllComponents(name, query);\n  \t\t}\n  \t};\n\n  \tAlias.prototype.firstNode = function firstNode(skipParent) {\n  \t\treturn this.fragment && this.fragment.firstNode(skipParent);\n  \t};\n\n  \tAlias.prototype.rebind = function rebind() {\n  \t\tresolveAliases(this);\n  \t\tif (this.fragment) this.fragment.rebind();\n  \t};\n\n  \tAlias.prototype.render = function render(target) {\n  \t\tthis.rendered = true;\n  \t\tif (this.fragment) this.fragment.render(target);\n  \t};\n\n  \tAlias.prototype.toString = function toString(escape) {\n  \t\treturn this.fragment ? this.fragment.toString(escape) : '';\n  \t};\n\n  \tAlias.prototype.unbind = function unbind() {\n  \t\tthis.aliases = {};\n  \t\tif (this.fragment) this.fragment.unbind();\n  \t};\n\n  \tAlias.prototype.unrender = function unrender(shouldDestroy) {\n  \t\tif (this.rendered && this.fragment) this.fragment.unrender(shouldDestroy);\n  \t\tthis.rendered = false;\n  \t};\n\n  \tAlias.prototype.update = function update() {\n  \t\tif (this.dirty) {\n  \t\t\tthis.dirty = false;\n  \t\t\tthis.fragment.update();\n  \t\t}\n  \t};\n\n  \treturn Alias;\n  })(Item);\n\n  var Doctype = (function (_Item) {\n  \tinherits(Doctype, _Item);\n\n  \tfunction Doctype() {\n  \t\tclassCallCheck(this, Doctype);\n\n  \t\t_Item.apply(this, arguments);\n  \t}\n\n  \tDoctype.prototype.bind = function bind() {\n  \t\t// noop\n  \t};\n\n  \tDoctype.prototype.render = function render() {\n  \t\t// noop\n  \t};\n\n  \tDoctype.prototype.teardown = function teardown() {\n  \t\t// noop\n  \t};\n\n  \tDoctype.prototype.toString = function toString() {\n  \t\treturn '<!DOCTYPE' + this.template.a + '>';\n  \t};\n\n  \tDoctype.prototype.unbind = function unbind() {\n  \t\t// noop\n  \t};\n\n  \tDoctype.prototype.unrender = function unrender() {\n  \t\t// noop\n  \t};\n\n  \treturn Doctype;\n  })(Item);\n\n  var Mustache = (function (_Item) {\n  \tinherits(Mustache, _Item);\n\n  \tfunction Mustache(options) {\n  \t\tclassCallCheck(this, Mustache);\n\n  \t\t_Item.call(this, options);\n\n  \t\tthis.parentFragment = options.parentFragment;\n  \t\tthis.template = options.template;\n  \t\tthis.index = options.index;\n\n  \t\tthis.isStatic = !!options.template.s;\n\n  \t\tthis.model = null;\n  \t\tthis.dirty = false;\n  \t}\n\n  \tMustache.prototype.bind = function bind() {\n  \t\tvar _this = this;\n\n  \t\t// try to find a model for this view\n  \t\tvar model = resolve$1(this.parentFragment, this.template);\n  \t\tvar value = model ? model.get() : undefined;\n\n  \t\tif (this.isStatic) {\n  \t\t\tthis.model = { get: function () {\n  \t\t\t\t\treturn value;\n  \t\t\t\t} };\n  \t\t\treturn;\n  \t\t}\n\n  \t\tif (model) {\n  \t\t\tmodel.register(this);\n  \t\t\tthis.model = model;\n  \t\t} else {\n  \t\t\tthis.resolver = this.parentFragment.resolve(this.template.r, function (model) {\n  \t\t\t\t_this.model = model;\n  \t\t\t\tmodel.register(_this);\n\n  \t\t\t\t_this.handleChange();\n  \t\t\t\t_this.resolver = null;\n  \t\t\t});\n  \t\t}\n  \t};\n\n  \tMustache.prototype.handleChange = function handleChange() {\n  \t\tthis.bubble();\n  \t};\n\n  \tMustache.prototype.rebind = function rebind() {\n  \t\tif (this.isStatic || !this.model) return;\n\n  \t\tvar model = resolve$1(this.parentFragment, this.template);\n\n  \t\tif (model === this.model) return;\n\n  \t\tthis.model.unregister(this);\n\n  \t\tthis.model = model;\n\n  \t\tif (model) {\n  \t\t\tmodel.register(this);\n  \t\t\tthis.handleChange();\n  \t\t}\n  \t};\n\n  \tMustache.prototype.unbind = function unbind() {\n  \t\tif (!this.isStatic) {\n  \t\t\tthis.model && this.model.unregister(this);\n  \t\t\tthis.model = undefined;\n  \t\t\tthis.resolver && this.resolver.unbind();\n  \t\t}\n  \t};\n\n  \treturn Mustache;\n  })(Item);\n\n  // https://github.com/kangax/html-minifier/issues/63#issuecomment-37763316\n  var booleanAttributes = /^(allowFullscreen|async|autofocus|autoplay|checked|compact|controls|declare|default|defaultChecked|defaultMuted|defaultSelected|defer|disabled|enabled|formNoValidate|hidden|indeterminate|inert|isMap|itemScope|loop|multiple|muted|noHref|noResize|noShade|noValidate|noWrap|open|pauseOnExit|readOnly|required|reversed|scoped|seamless|selected|sortable|translate|trueSpeed|typeMustMatch|visible)$/i;\n  var voidElementNames = /^(?:area|base|br|col|command|doctype|embed|hr|img|input|keygen|link|meta|param|source|track|wbr)$/i;\n\n  var htmlEntities = { quot: 34, amp: 38, apos: 39, lt: 60, gt: 62, nbsp: 160, iexcl: 161, cent: 162, pound: 163, curren: 164, yen: 165, brvbar: 166, sect: 167, uml: 168, copy: 169, ordf: 170, laquo: 171, not: 172, shy: 173, reg: 174, macr: 175, deg: 176, plusmn: 177, sup2: 178, sup3: 179, acute: 180, micro: 181, para: 182, middot: 183, cedil: 184, sup1: 185, ordm: 186, raquo: 187, frac14: 188, frac12: 189, frac34: 190, iquest: 191, Agrave: 192, Aacute: 193, Acirc: 194, Atilde: 195, Auml: 196, Aring: 197, AElig: 198, Ccedil: 199, Egrave: 200, Eacute: 201, Ecirc: 202, Euml: 203, Igrave: 204, Iacute: 205, Icirc: 206, Iuml: 207, ETH: 208, Ntilde: 209, Ograve: 210, Oacute: 211, Ocirc: 212, Otilde: 213, Ouml: 214, times: 215, Oslash: 216, Ugrave: 217, Uacute: 218, Ucirc: 219, Uuml: 220, Yacute: 221, THORN: 222, szlig: 223, agrave: 224, aacute: 225, acirc: 226, atilde: 227, auml: 228, aring: 229, aelig: 230, ccedil: 231, egrave: 232, eacute: 233, ecirc: 234, euml: 235, igrave: 236, iacute: 237, icirc: 238, iuml: 239, eth: 240, ntilde: 241, ograve: 242, oacute: 243, ocirc: 244, otilde: 245, ouml: 246, divide: 247, oslash: 248, ugrave: 249, uacute: 250, ucirc: 251, uuml: 252, yacute: 253, thorn: 254, yuml: 255, OElig: 338, oelig: 339, Scaron: 352, scaron: 353, Yuml: 376, fnof: 402, circ: 710, tilde: 732, Alpha: 913, Beta: 914, Gamma: 915, Delta: 916, Epsilon: 917, Zeta: 918, Eta: 919, Theta: 920, Iota: 921, Kappa: 922, Lambda: 923, Mu: 924, Nu: 925, Xi: 926, Omicron: 927, Pi: 928, Rho: 929, Sigma: 931, Tau: 932, Upsilon: 933, Phi: 934, Chi: 935, Psi: 936, Omega: 937, alpha: 945, beta: 946, gamma: 947, delta: 948, epsilon: 949, zeta: 950, eta: 951, theta: 952, iota: 953, kappa: 954, lambda: 955, mu: 956, nu: 957, xi: 958, omicron: 959, pi: 960, rho: 961, sigmaf: 962, sigma: 963, tau: 964, upsilon: 965, phi: 966, chi: 967, psi: 968, omega: 969, thetasym: 977, upsih: 978, piv: 982, ensp: 8194, emsp: 8195, thinsp: 8201, zwnj: 8204, zwj: 8205, lrm: 8206, rlm: 8207, ndash: 8211, mdash: 8212, lsquo: 8216, rsquo: 8217, sbquo: 8218, ldquo: 8220, rdquo: 8221, bdquo: 8222, dagger: 8224, Dagger: 8225, bull: 8226, hellip: 8230, permil: 8240, prime: 8242, Prime: 8243, lsaquo: 8249, rsaquo: 8250, oline: 8254, frasl: 8260, euro: 8364, image: 8465, weierp: 8472, real: 8476, trade: 8482, alefsym: 8501, larr: 8592, uarr: 8593, rarr: 8594, darr: 8595, harr: 8596, crarr: 8629, lArr: 8656, uArr: 8657, rArr: 8658, dArr: 8659, hArr: 8660, forall: 8704, part: 8706, exist: 8707, empty: 8709, nabla: 8711, isin: 8712, notin: 8713, ni: 8715, prod: 8719, sum: 8721, minus: 8722, lowast: 8727, radic: 8730, prop: 8733, infin: 8734, ang: 8736, and: 8743, or: 8744, cap: 8745, cup: 8746, 'int': 8747, there4: 8756, sim: 8764, cong: 8773, asymp: 8776, ne: 8800, equiv: 8801, le: 8804, ge: 8805, sub: 8834, sup: 8835, nsub: 8836, sube: 8838, supe: 8839, oplus: 8853, otimes: 8855, perp: 8869, sdot: 8901, lceil: 8968, rceil: 8969, lfloor: 8970, rfloor: 8971, lang: 9001, rang: 9002, loz: 9674, spades: 9824, clubs: 9827, hearts: 9829, diams: 9830 };\n  var controlCharacters = [8364, 129, 8218, 402, 8222, 8230, 8224, 8225, 710, 8240, 352, 8249, 338, 141, 381, 143, 144, 8216, 8217, 8220, 8221, 8226, 8211, 8212, 732, 8482, 353, 8250, 339, 157, 382, 376];\n  var entityPattern = new RegExp('&(#?(?:x[\\\\w\\\\d]+|\\\\d+|' + Object.keys(htmlEntities).join('|') + '));?', 'g');\n  var codePointSupport = typeof String.fromCodePoint === 'function';\n  var codeToChar = codePointSupport ? String.fromCodePoint : String.fromCharCode;\n\n  function decodeCharacterReferences(html) {\n  \treturn html.replace(entityPattern, function (match, entity) {\n  \t\tvar code;\n\n  \t\t// Handle named entities\n  \t\tif (entity[0] !== '#') {\n  \t\t\tcode = htmlEntities[entity];\n  \t\t} else if (entity[1] === 'x') {\n  \t\t\tcode = parseInt(entity.substring(2), 16);\n  \t\t} else {\n  \t\t\tcode = parseInt(entity.substring(1), 10);\n  \t\t}\n\n  \t\tif (!code) {\n  \t\t\treturn match;\n  \t\t}\n\n  \t\treturn codeToChar(validateCode(code));\n  \t});\n  }\n\n  var lessThan = /</g;\n  var greaterThan = />/g;\n  var amp = /&/g;\n  var invalid = 65533;\n\n  function escapeHtml(str) {\n  \treturn str.replace(amp, '&amp;').replace(lessThan, '&lt;').replace(greaterThan, '&gt;');\n  }\n\n  // some code points are verboten. If we were inserting HTML, the browser would replace the illegal\n  // code points with alternatives in some cases - since we're bypassing that mechanism, we need\n  // to replace them ourselves\n  //\n  // Source: http://en.wikipedia.org/wiki/Character_encodings_in_HTML#Illegal_characters\n  function validateCode(code) {\n  \tif (!code) {\n  \t\treturn invalid;\n  \t}\n\n  \t// line feed becomes generic whitespace\n  \tif (code === 10) {\n  \t\treturn 32;\n  \t}\n\n  \t// ASCII range. (Why someone would use HTML entities for ASCII characters I don't know, but...)\n  \tif (code < 128) {\n  \t\treturn code;\n  \t}\n\n  \t// code points 128-159 are dealt with leniently by browsers, but they're incorrect. We need\n  \t// to correct the mistake or we'll end up with missing  signs and so on\n  \tif (code <= 159) {\n  \t\treturn controlCharacters[code - 128];\n  \t}\n\n  \t// basic multilingual plane\n  \tif (code < 55296) {\n  \t\treturn code;\n  \t}\n\n  \t// UTF-16 surrogate halves\n  \tif (code <= 57343) {\n  \t\treturn invalid;\n  \t}\n\n  \t// rest of the basic multilingual plane\n  \tif (code <= 65535) {\n  \t\treturn code;\n  \t} else if (!codePointSupport) {\n  \t\treturn invalid;\n  \t}\n\n  \t// supplementary multilingual plane 0x10000 - 0x1ffff\n  \tif (code >= 65536 && code <= 131071) {\n  \t\treturn code;\n  \t}\n\n  \t// supplementary ideographic plane 0x20000 - 0x2ffff\n  \tif (code >= 131072 && code <= 196607) {\n  \t\treturn code;\n  \t}\n\n  \treturn invalid;\n  }\n\n  var Interpolator = (function (_Mustache) {\n  \tinherits(Interpolator, _Mustache);\n\n  \tfunction Interpolator() {\n  \t\tclassCallCheck(this, Interpolator);\n\n  \t\t_Mustache.apply(this, arguments);\n  \t}\n\n  \tInterpolator.prototype.detach = function detach() {\n  \t\treturn detachNode(this.node);\n  \t};\n\n  \tInterpolator.prototype.firstNode = function firstNode() {\n  \t\treturn this.node;\n  \t};\n\n  \tInterpolator.prototype.getString = function getString() {\n  \t\treturn this.model ? safeToStringValue(this.model.get()) : '';\n  \t};\n\n  \tInterpolator.prototype.render = function render(target, occupants) {\n  \t\tvar value = this.getString();\n\n  \t\tthis.rendered = true;\n\n  \t\tif (occupants) {\n  \t\t\tvar n = occupants[0];\n  \t\t\tif (n && n.nodeType === 3) {\n  \t\t\t\toccupants.shift();\n  \t\t\t\tif (n.nodeValue !== value) {\n  \t\t\t\t\tn.nodeValue = value;\n  \t\t\t\t}\n  \t\t\t} else {\n  \t\t\t\tn = this.node = doc.createTextNode(value);\n  \t\t\t\tif (occupants[0]) {\n  \t\t\t\t\ttarget.insertBefore(n, occupants[0]);\n  \t\t\t\t} else {\n  \t\t\t\t\ttarget.appendChild(n);\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\tthis.node = n;\n  \t\t} else {\n  \t\t\tthis.node = doc.createTextNode(value);\n  \t\t\ttarget.appendChild(this.node);\n  \t\t}\n  \t};\n\n  \tInterpolator.prototype.toString = function toString(escape) {\n  \t\tvar string = this.getString();\n  \t\treturn escape ? escapeHtml(string) : string;\n  \t};\n\n  \tInterpolator.prototype.unrender = function unrender(shouldDestroy) {\n  \t\tif (shouldDestroy) this.detach();\n  \t\tthis.rendered = false;\n  \t};\n\n  \tInterpolator.prototype.update = function update() {\n  \t\tif (this.dirty) {\n  \t\t\tthis.dirty = false;\n  \t\t\tif (this.rendered) {\n  \t\t\t\tthis.node.data = this.getString();\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tInterpolator.prototype.valueOf = function valueOf() {\n  \t\treturn this.model ? this.model.get() : undefined;\n  \t};\n\n  \treturn Interpolator;\n  })(Mustache);\n\n  function findInViewHierarchy(registryName, ractive, name) {\n  \tvar instance = findInstance(registryName, ractive, name);\n  \treturn instance ? instance[registryName][name] : null;\n  }\n\n  function findInstance(registryName, ractive, name) {\n  \twhile (ractive) {\n  \t\tif (name in ractive[registryName]) {\n  \t\t\treturn ractive;\n  \t\t}\n\n  \t\tif (ractive.isolated) {\n  \t\t\treturn null;\n  \t\t}\n\n  \t\tractive = ractive.parent;\n  \t}\n  }\n\n  function getPartialTemplate(ractive, name, parentFragment) {\n  \t// If the partial in instance or view heirarchy instances, great\n  \tvar partial = getPartialFromRegistry(ractive, name, parentFragment || {});\n  \tif (partial) return partial;\n\n  \t// Does it exist on the page as a script tag?\n  \tpartial = parser.fromId(name, { noThrow: true });\n  \tif (partial) {\n  \t\t// parse and register to this ractive instance\n  \t\tvar parsed = parser.parseFor(partial, ractive);\n\n  \t\t// register extra partials on the ractive instance if they don't already exist\n  \t\tif (parsed.p) fillGaps(ractive.partials, parsed.p);\n\n  \t\t// register (and return main partial if there are others in the template)\n  \t\treturn ractive.partials[name] = parsed.t;\n  \t}\n  }\n\n  function getPartialFromRegistry(ractive, name, parentFragment) {\n  \t// if there was an instance up-hierarchy, cool\n  \tvar partial = findParentPartial(name, parentFragment.owner);\n  \tif (partial) return partial;\n\n  \t// find first instance in the ractive or view hierarchy that has this partial\n  \tvar instance = findInstance('partials', ractive, name);\n\n  \tif (!instance) {\n  \t\treturn;\n  \t}\n\n  \tpartial = instance.partials[name];\n\n  \t// partial is a function?\n  \tvar fn = undefined;\n  \tif (typeof partial === 'function') {\n  \t\tfn = partial.bind(instance);\n  \t\tfn.isOwner = instance.partials.hasOwnProperty(name);\n  \t\tpartial = fn.call(ractive, parser);\n  \t}\n\n  \tif (!partial && partial !== '') {\n  \t\twarnIfDebug(noRegistryFunctionReturn, name, 'partial', 'partial', { ractive: ractive });\n  \t\treturn;\n  \t}\n\n  \t// If this was added manually to the registry,\n  \t// but hasn't been parsed, parse it now\n  \tif (!parser.isParsed(partial)) {\n  \t\t// use the parseOptions of the ractive instance on which it was found\n  \t\tvar parsed = parser.parseFor(partial, instance);\n\n  \t\t// Partials cannot contain nested partials!\n  \t\t// TODO add a test for this\n  \t\tif (parsed.p) {\n  \t\t\twarnIfDebug('Partials ({{>%s}}) cannot contain nested inline partials', name, { ractive: ractive });\n  \t\t}\n\n  \t\t// if fn, use instance to store result, otherwise needs to go\n  \t\t// in the correct point in prototype chain on instance or constructor\n  \t\tvar target = fn ? instance : findOwner(instance, name);\n\n  \t\t// may be a template with partials, which need to be registered and main template extracted\n  \t\ttarget.partials[name] = partial = parsed.t;\n  \t}\n\n  \t// store for reset\n  \tif (fn) partial._fn = fn;\n\n  \treturn partial.v ? partial.t : partial;\n  }\n\n  function findOwner(ractive, key) {\n  \treturn ractive.partials.hasOwnProperty(key) ? ractive : findConstructor(ractive.constructor, key);\n  }\n\n  function findConstructor(constructor, key) {\n  \tif (!constructor) {\n  \t\treturn;\n  \t}\n  \treturn constructor.partials.hasOwnProperty(key) ? constructor : findConstructor(constructor._Parent, key);\n  }\n\n  function findParentPartial(name, parent) {\n  \tif (parent) {\n  \t\tif (parent.template && parent.template.p && parent.template.p[name]) {\n  \t\t\treturn parent.template.p[name];\n  \t\t} else if (parent.parentFragment && parent.parentFragment.owner) {\n  \t\t\treturn findParentPartial(name, parent.parentFragment.owner);\n  \t\t}\n  \t}\n  }\n\n  var Partial = (function (_Mustache) {\n  \tinherits(Partial, _Mustache);\n\n  \tfunction Partial() {\n  \t\tclassCallCheck(this, Partial);\n\n  \t\t_Mustache.apply(this, arguments);\n  \t}\n\n  \tPartial.prototype.bind = function bind() {\n  \t\t// keep track of the reference name for future resets\n  \t\tthis.refName = this.template.r;\n\n  \t\t// name matches take priority over expressions\n  \t\tvar template = this.refName ? getPartialTemplate(this.ractive, this.refName, this.parentFragment) || null : null;\n  \t\tvar templateObj = undefined;\n\n  \t\tif (template) {\n  \t\t\tthis.named = true;\n  \t\t\tthis.setTemplate(this.template.r, template);\n  \t\t}\n\n  \t\tif (!template) {\n  \t\t\t_Mustache.prototype.bind.call(this);\n  \t\t\tif (this.model && (templateObj = this.model.get()) && typeof templateObj === 'object' && (typeof templateObj.template === 'string' || isArray(templateObj.t))) {\n  \t\t\t\tif (templateObj.template) {\n  \t\t\t\t\ttemplateObj = parsePartial(this.template.r, templateObj.template, this.ractive);\n  \t\t\t\t}\n  \t\t\t\tthis.setTemplate(this.template.r, templateObj.t);\n  \t\t\t} else if ((!this.model || typeof this.model.get() !== 'string') && this.refName) {\n  \t\t\t\tthis.setTemplate(this.refName, template);\n  \t\t\t} else {\n  \t\t\t\tthis.setTemplate(this.model.get());\n  \t\t\t}\n  \t\t}\n\n  \t\tthis.fragment = new Fragment({\n  \t\t\towner: this,\n  \t\t\ttemplate: this.partialTemplate\n  \t\t}).bind();\n  \t};\n\n  \tPartial.prototype.detach = function detach() {\n  \t\treturn this.fragment.detach();\n  \t};\n\n  \tPartial.prototype.find = function find(selector) {\n  \t\treturn this.fragment.find(selector);\n  \t};\n\n  \tPartial.prototype.findAll = function findAll(selector, query) {\n  \t\tthis.fragment.findAll(selector, query);\n  \t};\n\n  \tPartial.prototype.findComponent = function findComponent(name) {\n  \t\treturn this.fragment.findComponent(name);\n  \t};\n\n  \tPartial.prototype.findAllComponents = function findAllComponents(name, query) {\n  \t\tthis.fragment.findAllComponents(name, query);\n  \t};\n\n  \tPartial.prototype.firstNode = function firstNode(skipParent) {\n  \t\treturn this.fragment.firstNode(skipParent);\n  \t};\n\n  \tPartial.prototype.forceResetTemplate = function forceResetTemplate() {\n  \t\tthis.partialTemplate = undefined;\n\n  \t\t// on reset, check for the reference name first\n  \t\tif (this.refName) {\n  \t\t\tthis.partialTemplate = getPartialTemplate(this.ractive, this.refName, this.parentFragment);\n  \t\t}\n\n  \t\t// then look for the resolved name\n  \t\tif (!this.partialTemplate) {\n  \t\t\tthis.partialTemplate = getPartialTemplate(this.ractive, this.name, this.parentFragment);\n  \t\t}\n\n  \t\tif (!this.partialTemplate) {\n  \t\t\twarnOnceIfDebug('Could not find template for partial \\'' + this.name + '\\'');\n  \t\t\tthis.partialTemplate = [];\n  \t\t}\n\n  \t\tthis.fragment.resetTemplate(this.partialTemplate);\n  \t\tthis.bubble();\n  \t};\n\n  \tPartial.prototype.rebind = function rebind() {\n  \t\t_Mustache.prototype.unbind.call(this);\n  \t\t_Mustache.prototype.bind.call(this);\n  \t\tthis.fragment.rebind();\n  \t};\n\n  \tPartial.prototype.render = function render(target, occupants) {\n  \t\tthis.fragment.render(target, occupants);\n  \t};\n\n  \tPartial.prototype.setTemplate = function setTemplate(name, template) {\n  \t\tthis.name = name;\n\n  \t\tif (!template && template !== null) template = getPartialTemplate(this.ractive, name, this.parentFragment);\n\n  \t\tif (!template) {\n  \t\t\twarnOnceIfDebug('Could not find template for partial \\'' + name + '\\'');\n  \t\t}\n\n  \t\tthis.partialTemplate = template || [];\n  \t};\n\n  \tPartial.prototype.toString = function toString(escape) {\n  \t\treturn this.fragment.toString(escape);\n  \t};\n\n  \tPartial.prototype.unbind = function unbind() {\n  \t\t_Mustache.prototype.unbind.call(this);\n  \t\tthis.fragment.unbind();\n  \t};\n\n  \tPartial.prototype.unrender = function unrender(shouldDestroy) {\n  \t\tthis.fragment.unrender(shouldDestroy);\n  \t};\n\n  \tPartial.prototype.update = function update() {\n  \t\tvar template = undefined;\n\n  \t\tif (this.dirty) {\n  \t\t\tthis.dirty = false;\n\n  \t\t\tif (!this.named) {\n  \t\t\t\tif (this.model) {\n  \t\t\t\t\ttemplate = this.model.get();\n  \t\t\t\t}\n\n  \t\t\t\tif (template && typeof template === 'string' && template !== this.name) {\n  \t\t\t\t\tthis.setTemplate(template);\n  \t\t\t\t\tthis.fragment.resetTemplate(this.partialTemplate);\n  \t\t\t\t} else if (template && typeof template === 'object' && (typeof template.template === 'string' || isArray(template.t))) {\n  \t\t\t\t\tif (template.template) {\n  \t\t\t\t\t\ttemplate = parsePartial(this.name, template.template, this.ractive);\n  \t\t\t\t\t}\n  \t\t\t\t\tthis.setTemplate(this.name, template.t);\n  \t\t\t\t\tthis.fragment.resetTemplate(this.partialTemplate);\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\tthis.fragment.update();\n  \t\t}\n  \t};\n\n  \treturn Partial;\n  })(Mustache);\n\n  function parsePartial(name, partial, ractive) {\n  \tvar parsed = undefined;\n\n  \ttry {\n  \t\tparsed = parser.parse(partial, parser.getParseOptions(ractive));\n  \t} catch (e) {\n  \t\twarnIfDebug('Could not parse partial from expression \\'' + name + '\\'\\n' + e.message);\n  \t}\n\n  \treturn parsed || { t: [] };\n  }\n\n  var RepeatedFragment = (function () {\n  \tfunction RepeatedFragment(options) {\n  \t\tclassCallCheck(this, RepeatedFragment);\n\n  \t\tthis.parent = options.owner.parentFragment;\n\n  \t\t// bit of a hack, so reference resolution works without another\n  \t\t// layer of indirection\n  \t\tthis.parentFragment = this;\n  \t\tthis.owner = options.owner;\n  \t\tthis.ractive = this.parent.ractive;\n\n  \t\t// encapsulated styles should be inherited until they get applied by an element\n  \t\tthis.cssIds = 'cssIds' in options ? options.cssIds : this.parent ? this.parent.cssIds : null;\n\n  \t\tthis.context = null;\n  \t\tthis.rendered = false;\n  \t\tthis.iterations = [];\n\n  \t\tthis.template = options.template;\n\n  \t\tthis.indexRef = options.indexRef;\n  \t\tthis.keyRef = options.keyRef;\n  \t\tthis.indexByKey = null; // for `{{#each object}}...`\n\n  \t\tthis.pendingNewIndices = null;\n  \t\tthis.previousIterations = null;\n\n  \t\t// track array versus object so updates of type rest\n  \t\tthis.isArray = false;\n  \t}\n\n  \tRepeatedFragment.prototype.bind = function bind(context) {\n  \t\tvar _this = this;\n\n  \t\tthis.context = context;\n  \t\tvar value = context.get();\n\n  \t\t// {{#each array}}...\n  \t\tif (this.isArray = isArray(value)) {\n  \t\t\t// we can't use map, because of sparse arrays\n  \t\t\tthis.iterations = [];\n  \t\t\tfor (var i = 0; i < value.length; i += 1) {\n  \t\t\t\tthis.iterations[i] = this.createIteration(i, i);\n  \t\t\t}\n  \t\t}\n\n  \t\t// {{#each object}}...\n  \t\telse if (isObject(value)) {\n  \t\t\t\tthis.isArray = false;\n\n  \t\t\t\t// TODO this is a dreadful hack. There must be a neater way\n  \t\t\t\tif (this.indexRef) {\n  \t\t\t\t\tvar refs = this.indexRef.split(',');\n  \t\t\t\t\tthis.keyRef = refs[0];\n  \t\t\t\t\tthis.indexRef = refs[1];\n  \t\t\t\t}\n\n  \t\t\t\tthis.indexByKey = {};\n  \t\t\t\tthis.iterations = Object.keys(value).map(function (key, index) {\n  \t\t\t\t\t_this.indexByKey[key] = index;\n  \t\t\t\t\treturn _this.createIteration(key, index);\n  \t\t\t\t});\n  \t\t\t}\n\n  \t\treturn this;\n  \t};\n\n  \tRepeatedFragment.prototype.bubble = function bubble() {\n  \t\tthis.owner.bubble();\n  \t};\n\n  \tRepeatedFragment.prototype.createIteration = function createIteration(key, index) {\n  \t\tvar fragment = new Fragment({\n  \t\t\towner: this,\n  \t\t\ttemplate: this.template\n  \t\t});\n\n  \t\t// TODO this is a bit hacky\n  \t\tfragment.key = key;\n  \t\tfragment.index = index;\n  \t\tfragment.isIteration = true;\n\n  \t\tvar model = this.context.joinKey(key);\n\n  \t\t// set up an iteration alias if there is one\n  \t\tif (this.owner.template.z) {\n  \t\t\tfragment.aliases = {};\n  \t\t\tfragment.aliases[this.owner.template.z[0].n] = model;\n  \t\t}\n\n  \t\treturn fragment.bind(model);\n  \t};\n\n  \tRepeatedFragment.prototype.detach = function detach() {\n  \t\tvar docFrag = createDocumentFragment();\n  \t\tthis.iterations.forEach(function (fragment) {\n  \t\t\treturn docFrag.appendChild(fragment.detach());\n  \t\t});\n  \t\treturn docFrag;\n  \t};\n\n  \tRepeatedFragment.prototype.find = function find(selector) {\n  \t\tvar len = this.iterations.length;\n  \t\tvar i = undefined;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tvar found = this.iterations[i].find(selector);\n  \t\t\tif (found) return found;\n  \t\t}\n  \t};\n\n  \tRepeatedFragment.prototype.findAll = function findAll(selector, query) {\n  \t\tvar len = this.iterations.length;\n  \t\tvar i = undefined;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tthis.iterations[i].findAll(selector, query);\n  \t\t}\n  \t};\n\n  \tRepeatedFragment.prototype.findComponent = function findComponent(name) {\n  \t\tvar len = this.iterations.length;\n  \t\tvar i = undefined;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tvar found = this.iterations[i].findComponent(name);\n  \t\t\tif (found) return found;\n  \t\t}\n  \t};\n\n  \tRepeatedFragment.prototype.findAllComponents = function findAllComponents(name, query) {\n  \t\tvar len = this.iterations.length;\n  \t\tvar i = undefined;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tthis.iterations[i].findAllComponents(name, query);\n  \t\t}\n  \t};\n\n  \tRepeatedFragment.prototype.findNextNode = function findNextNode(iteration) {\n  \t\tif (iteration.index < this.iterations.length - 1) {\n  \t\t\tfor (var i = iteration.index + 1; i < this.iterations.length; i++) {\n  \t\t\t\tvar node = this.iterations[i].firstNode(true);\n  \t\t\t\tif (node) return node;\n  \t\t\t}\n  \t\t}\n\n  \t\treturn this.owner.findNextNode();\n  \t};\n\n  \tRepeatedFragment.prototype.firstNode = function firstNode(skipParent) {\n  \t\treturn this.iterations[0] ? this.iterations[0].firstNode(skipParent) : null;\n  \t};\n\n  \tRepeatedFragment.prototype.rebind = function rebind(context) {\n  \t\tvar _this2 = this;\n\n  \t\tthis.context = context;\n\n  \t\tthis.iterations.forEach(function (fragment) {\n  \t\t\tvar model = context.joinKey(fragment.key || fragment.index);\n  \t\t\tif (_this2.owner.template.z) {\n  \t\t\t\tfragment.aliases = {};\n  \t\t\t\tfragment.aliases[_this2.owner.template.z[0].n] = model;\n  \t\t\t}\n  \t\t\tfragment.rebind(model);\n  \t\t});\n  \t};\n\n  \tRepeatedFragment.prototype.render = function render(target, occupants) {\n  \t\t// TODO use docFrag.cloneNode...\n\n  \t\tif (this.iterations) {\n  \t\t\tthis.iterations.forEach(function (fragment) {\n  \t\t\t\treturn fragment.render(target, occupants);\n  \t\t\t});\n  \t\t}\n\n  \t\tthis.rendered = true;\n  \t};\n\n  \tRepeatedFragment.prototype.shuffle = function shuffle(newIndices) {\n  \t\tvar _this3 = this;\n\n  \t\tif (!this.pendingNewIndices) this.previousIterations = this.iterations.slice();\n\n  \t\tif (!this.pendingNewIndices) this.pendingNewIndices = [];\n\n  \t\tthis.pendingNewIndices.push(newIndices);\n\n  \t\tvar iterations = [];\n\n  \t\tnewIndices.forEach(function (newIndex, oldIndex) {\n  \t\t\tif (newIndex === -1) return;\n\n  \t\t\tvar fragment = _this3.iterations[oldIndex];\n  \t\t\titerations[newIndex] = fragment;\n\n  \t\t\tif (newIndex !== oldIndex && fragment) fragment.dirty = true;\n  \t\t});\n\n  \t\tthis.iterations = iterations;\n\n  \t\tthis.bubble();\n  \t};\n\n  \tRepeatedFragment.prototype.toString = function toString(escape) {\n  \t\treturn this.iterations ? this.iterations.map(escape ? toEscapedString : _toString).join('') : '';\n  \t};\n\n  \tRepeatedFragment.prototype.unbind = function unbind() {\n  \t\tthis.iterations.forEach(_unbind);\n  \t\treturn this;\n  \t};\n\n  \tRepeatedFragment.prototype.unrender = function unrender(shouldDestroy) {\n  \t\tthis.iterations.forEach(shouldDestroy ? unrenderAndDestroy$1 : _unrender);\n  \t\tif (this.pendingNewIndices && this.previousIterations) {\n  \t\t\tthis.previousIterations.forEach(function (fragment) {\n  \t\t\t\tif (fragment.rendered) shouldDestroy ? unrenderAndDestroy$1(fragment) : _unrender(fragment);\n  \t\t\t});\n  \t\t}\n  \t\tthis.rendered = false;\n  \t};\n\n  \t// TODO smart update\n\n  \tRepeatedFragment.prototype.update = function update() {\n  \t\tvar _this4 = this;\n\n  \t\t// skip dirty check, since this is basically just a facade\n\n  \t\tif (this.pendingNewIndices) {\n  \t\t\tthis.updatePostShuffle();\n  \t\t\treturn;\n  \t\t}\n\n  \t\tif (this.updating) return;\n  \t\tthis.updating = true;\n\n  \t\tvar value = this.context.get(),\n  \t\t    wasArray = this.isArray;\n\n  \t\tvar toRemove = undefined;\n  \t\tvar oldKeys = undefined;\n  \t\tvar reset = true;\n  \t\tvar i = undefined;\n\n  \t\tif (this.isArray = isArray(value)) {\n  \t\t\tif (wasArray) {\n  \t\t\t\treset = false;\n  \t\t\t\tif (this.iterations.length > value.length) {\n  \t\t\t\t\ttoRemove = this.iterations.splice(value.length);\n  \t\t\t\t}\n  \t\t\t}\n  \t\t} else if (isObject(value) && !wasArray) {\n  \t\t\treset = false;\n  \t\t\ttoRemove = [];\n  \t\t\toldKeys = {};\n  \t\t\ti = this.iterations.length;\n\n  \t\t\twhile (i--) {\n  \t\t\t\tvar _fragment = this.iterations[i];\n  \t\t\t\tif (_fragment.key in value) {\n  \t\t\t\t\toldKeys[_fragment.key] = true;\n  \t\t\t\t} else {\n  \t\t\t\t\tthis.iterations.splice(i, 1);\n  \t\t\t\t\ttoRemove.push(_fragment);\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\tif (reset) {\n  \t\t\ttoRemove = this.iterations;\n  \t\t\tthis.iterations = [];\n  \t\t}\n\n  \t\tif (toRemove) {\n  \t\t\ttoRemove.forEach(function (fragment) {\n  \t\t\t\tfragment.unbind();\n  \t\t\t\tfragment.unrender(true);\n  \t\t\t});\n  \t\t}\n\n  \t\t// update the remaining ones\n  \t\tthis.iterations.forEach(_update);\n\n  \t\t// add new iterations\n  \t\tvar newLength = isArray(value) ? value.length : isObject(value) ? Object.keys(value).length : 0;\n\n  \t\tvar docFrag = undefined;\n  \t\tvar fragment = undefined;\n\n  \t\tif (newLength > this.iterations.length) {\n  \t\t\tdocFrag = this.rendered ? createDocumentFragment() : null;\n  \t\t\ti = this.iterations.length;\n\n  \t\t\tif (isArray(value)) {\n  \t\t\t\twhile (i < value.length) {\n  \t\t\t\t\tfragment = this.createIteration(i, i);\n\n  \t\t\t\t\tthis.iterations.push(fragment);\n  \t\t\t\t\tif (this.rendered) fragment.render(docFrag);\n\n  \t\t\t\t\ti += 1;\n  \t\t\t\t}\n  \t\t\t} else if (isObject(value)) {\n  \t\t\t\tObject.keys(value).forEach(function (key) {\n  \t\t\t\t\tif (!oldKeys || !(key in oldKeys)) {\n  \t\t\t\t\t\tfragment = _this4.createIteration(key, i);\n\n  \t\t\t\t\t\t_this4.iterations.push(fragment);\n  \t\t\t\t\t\tif (_this4.rendered) fragment.render(docFrag);\n\n  \t\t\t\t\t\ti += 1;\n  \t\t\t\t\t}\n  \t\t\t\t});\n  \t\t\t}\n\n  \t\t\tif (this.rendered) {\n  \t\t\t\tvar parentNode = this.parent.findParentNode();\n  \t\t\t\tvar anchor = this.parent.findNextNode(this.owner);\n\n  \t\t\t\tparentNode.insertBefore(docFrag, anchor);\n  \t\t\t}\n  \t\t}\n\n  \t\tthis.updating = false;\n  \t};\n\n  \tRepeatedFragment.prototype.updatePostShuffle = function updatePostShuffle() {\n  \t\tvar _this5 = this;\n\n  \t\tvar newIndices = this.pendingNewIndices[0];\n\n  \t\t// map first shuffle through\n  \t\tthis.pendingNewIndices.slice(1).forEach(function (indices) {\n  \t\t\tnewIndices.forEach(function (newIndex, oldIndex) {\n  \t\t\t\tnewIndices[oldIndex] = indices[newIndex];\n  \t\t\t});\n  \t\t});\n\n  \t\t// This algorithm (for detaching incorrectly-ordered fragments from the DOM and\n  \t\t// storing them in a document fragment for later reinsertion) seems a bit hokey,\n  \t\t// but it seems to work for now\n  \t\tvar len = this.context.get().length;\n  \t\tvar i = undefined,\n  \t\t    maxIdx = 0,\n  \t\t    merged = false;\n\n  \t\tnewIndices.forEach(function (newIndex, oldIndex) {\n  \t\t\tvar fragment = _this5.previousIterations[oldIndex];\n\n  \t\t\t// check for merged shuffles\n  \t\t\tif (!merged && newIndex !== -1) {\n  \t\t\t\tif (newIndex < maxIdx) merged = true;\n  \t\t\t\tif (newIndex > maxIdx) maxIdx = newIndex;\n  \t\t\t}\n\n  \t\t\tif (newIndex === -1) {\n  \t\t\t\tfragment.unbind().unrender(true);\n  \t\t\t} else {\n  \t\t\t\tfragment.index = newIndex;\n  \t\t\t\tvar model = _this5.context.joinKey(newIndex);\n  \t\t\t\tif (_this5.owner.template.z) {\n  \t\t\t\t\tfragment.aliases = {};\n  \t\t\t\t\tfragment.aliases[_this5.owner.template.z[0].n] = model;\n  \t\t\t\t}\n  \t\t\t\tfragment.rebind(model);\n  \t\t\t}\n  \t\t});\n\n  \t\t// create new iterations\n  \t\tvar docFrag = this.rendered ? createDocumentFragment() : null;\n  \t\tvar parentNode = this.rendered ? this.parent.findParentNode() : null;\n\n  \t\tif (merged) {\n  \t\t\tfor (i = 0; i < len; i += 1) {\n  \t\t\t\tvar frag = this.iterations[i];\n\n  \t\t\t\tif (this.rendered) {\n  \t\t\t\t\tif (frag) {\n  \t\t\t\t\t\tdocFrag.appendChild(frag.detach());\n  \t\t\t\t\t} else {\n  \t\t\t\t\t\tthis.iterations[i] = this.createIteration(i, i);\n  \t\t\t\t\t\tthis.iterations[i].render(docFrag);\n  \t\t\t\t\t}\n  \t\t\t\t}\n\n  \t\t\t\tif (!this.rendered) {\n  \t\t\t\t\tif (!frag) {\n  \t\t\t\t\t\tthis.iterations[i] = this.createIteration(i, i);\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t\t}\n  \t\t} else {\n  \t\t\tfor (i = 0; i < len; i++) {\n  \t\t\t\tvar frag = this.iterations[i];\n\n  \t\t\t\tif (this.rendered) {\n  \t\t\t\t\tif (frag && docFrag.childNodes.length) {\n  \t\t\t\t\t\tparentNode.insertBefore(docFrag, frag.firstNode());\n  \t\t\t\t\t}\n\n  \t\t\t\t\tif (!frag) {\n  \t\t\t\t\t\tfrag = this.iterations[i] = this.createIteration(i, i);\n  \t\t\t\t\t\tfrag.render(docFrag);\n  \t\t\t\t\t}\n  \t\t\t\t} else if (!frag) {\n  \t\t\t\t\tthis.iterations[i] = this.createIteration(i, i);\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\tif (this.rendered && docFrag.childNodes.length) {\n  \t\t\tparentNode.insertBefore(docFrag, this.owner.findNextNode());\n  \t\t}\n\n  \t\tthis.iterations.forEach(_update);\n\n  \t\tthis.pendingNewIndices = null;\n  \t};\n\n  \treturn RepeatedFragment;\n  })();\n\n  function isEmpty(value) {\n  \treturn !value || isArray(value) && value.length === 0 || isObject(value) && Object.keys(value).length === 0;\n  }\n\n  function getType(value, hasIndexRef) {\n  \tif (hasIndexRef || isArray(value)) return SECTION_EACH;\n  \tif (isObject(value) || typeof value === 'function') return SECTION_WITH;\n  \tif (value === undefined) return null;\n  \treturn SECTION_IF;\n  }\n\n  var Section = (function (_Mustache) {\n  \tinherits(Section, _Mustache);\n\n  \tfunction Section(options) {\n  \t\tclassCallCheck(this, Section);\n\n  \t\t_Mustache.call(this, options);\n\n  \t\tthis.sectionType = options.template.n || null;\n  \t\tthis.templateSectionType = this.sectionType;\n  \t\tthis.fragment = null;\n  \t}\n\n  \tSection.prototype.bind = function bind() {\n  \t\t_Mustache.prototype.bind.call(this);\n\n  \t\t// if we managed to bind, we need to create children\n  \t\tif (this.model) {\n  \t\t\tthis.dirty = true;\n  \t\t\tthis.update();\n  \t\t} else if (this.sectionType && this.sectionType === SECTION_UNLESS) {\n  \t\t\tthis.fragment = new Fragment({\n  \t\t\t\towner: this,\n  \t\t\t\ttemplate: this.template.f\n  \t\t\t}).bind();\n  \t\t}\n  \t};\n\n  \tSection.prototype.detach = function detach() {\n  \t\treturn this.fragment ? this.fragment.detach() : createDocumentFragment();\n  \t};\n\n  \tSection.prototype.find = function find(selector) {\n  \t\tif (this.fragment) {\n  \t\t\treturn this.fragment.find(selector);\n  \t\t}\n  \t};\n\n  \tSection.prototype.findAll = function findAll(selector, query) {\n  \t\tif (this.fragment) {\n  \t\t\tthis.fragment.findAll(selector, query);\n  \t\t}\n  \t};\n\n  \tSection.prototype.findComponent = function findComponent(name) {\n  \t\tif (this.fragment) {\n  \t\t\treturn this.fragment.findComponent(name);\n  \t\t}\n  \t};\n\n  \tSection.prototype.findAllComponents = function findAllComponents(name, query) {\n  \t\tif (this.fragment) {\n  \t\t\tthis.fragment.findAllComponents(name, query);\n  \t\t}\n  \t};\n\n  \tSection.prototype.firstNode = function firstNode(skipParent) {\n  \t\treturn this.fragment && this.fragment.firstNode(skipParent);\n  \t};\n\n  \tSection.prototype.rebind = function rebind() {\n  \t\t_Mustache.prototype.rebind.call(this);\n\n  \t\tif (this.fragment) {\n  \t\t\tthis.fragment.rebind(this.sectionType === SECTION_IF || this.sectionType === SECTION_UNLESS ? null : this.model);\n  \t\t}\n  \t};\n\n  \tSection.prototype.render = function render(target, occupants) {\n  \t\tthis.rendered = true;\n  \t\tif (this.fragment) this.fragment.render(target, occupants);\n  \t};\n\n  \tSection.prototype.shuffle = function shuffle(newIndices) {\n  \t\tif (this.fragment && this.sectionType === SECTION_EACH) {\n  \t\t\tthis.fragment.shuffle(newIndices);\n  \t\t}\n  \t};\n\n  \tSection.prototype.toString = function toString(escape) {\n  \t\treturn this.fragment ? this.fragment.toString(escape) : '';\n  \t};\n\n  \tSection.prototype.unbind = function unbind() {\n  \t\t_Mustache.prototype.unbind.call(this);\n  \t\tif (this.fragment) this.fragment.unbind();\n  \t};\n\n  \tSection.prototype.unrender = function unrender(shouldDestroy) {\n  \t\tif (this.rendered && this.fragment) this.fragment.unrender(shouldDestroy);\n  \t\tthis.rendered = false;\n  \t};\n\n  \tSection.prototype.update = function update() {\n  \t\tif (!this.dirty) return;\n  \t\tif (!this.model && this.sectionType !== SECTION_UNLESS) return;\n\n  \t\tthis.dirty = false;\n\n  \t\tvar value = !this.model ? undefined : this.model.isRoot ? this.model.value : this.model.get();\n  \t\tvar lastType = this.sectionType;\n\n  \t\t// watch for switching section types\n  \t\tif (this.sectionType === null || this.templateSectionType === null) this.sectionType = getType(value, this.template.i);\n  \t\tif (lastType && lastType !== this.sectionType && this.fragment) {\n  \t\t\tif (this.rendered) {\n  \t\t\t\tthis.fragment.unbind().unrender(true);\n  \t\t\t}\n\n  \t\t\tthis.fragment = null;\n  \t\t}\n\n  \t\tvar newFragment = undefined;\n\n  \t\tif (this.sectionType === SECTION_EACH) {\n  \t\t\tif (this.fragment) {\n  \t\t\t\tthis.fragment.update();\n  \t\t\t} else {\n  \t\t\t\t// TODO can this happen?\n  \t\t\t\tnewFragment = new RepeatedFragment({\n  \t\t\t\t\towner: this,\n  \t\t\t\t\ttemplate: this.template.f,\n  \t\t\t\t\tindexRef: this.template.i\n  \t\t\t\t}).bind(this.model);\n  \t\t\t}\n  \t\t}\n\n  \t\t// WITH is now IF_WITH; WITH is only used for {{>partial context}}\n  \t\telse if (this.sectionType === SECTION_WITH) {\n  \t\t\t\tif (this.fragment) {\n  \t\t\t\t\tthis.fragment.update();\n  \t\t\t\t} else {\n  \t\t\t\t\tnewFragment = new Fragment({\n  \t\t\t\t\t\towner: this,\n  \t\t\t\t\t\ttemplate: this.template.f\n  \t\t\t\t\t}).bind(this.model);\n  \t\t\t\t}\n  \t\t\t} else if (this.sectionType === SECTION_IF_WITH) {\n  \t\t\t\tif (this.fragment) {\n  \t\t\t\t\tif (isEmpty(value)) {\n  \t\t\t\t\t\tif (this.rendered) {\n  \t\t\t\t\t\t\tthis.fragment.unbind().unrender(true);\n  \t\t\t\t\t\t}\n\n  \t\t\t\t\t\tthis.fragment = null;\n  \t\t\t\t\t} else {\n  \t\t\t\t\t\tthis.fragment.update();\n  \t\t\t\t\t}\n  \t\t\t\t} else if (!isEmpty(value)) {\n  \t\t\t\t\tnewFragment = new Fragment({\n  \t\t\t\t\t\towner: this,\n  \t\t\t\t\t\ttemplate: this.template.f\n  \t\t\t\t\t}).bind(this.model);\n  \t\t\t\t}\n  \t\t\t} else {\n  \t\t\t\tvar fragmentShouldExist = this.sectionType === SECTION_UNLESS ? isEmpty(value) : !!value && !isEmpty(value);\n\n  \t\t\t\tif (this.fragment) {\n  \t\t\t\t\tif (fragmentShouldExist) {\n  \t\t\t\t\t\tthis.fragment.update();\n  \t\t\t\t\t} else {\n  \t\t\t\t\t\tif (this.rendered) {\n  \t\t\t\t\t\t\tthis.fragment.unbind().unrender(true);\n  \t\t\t\t\t\t}\n\n  \t\t\t\t\t\tthis.fragment = null;\n  \t\t\t\t\t}\n  \t\t\t\t} else if (fragmentShouldExist) {\n  \t\t\t\t\tnewFragment = new Fragment({\n  \t\t\t\t\t\towner: this,\n  \t\t\t\t\t\ttemplate: this.template.f\n  \t\t\t\t\t}).bind(null);\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\tif (newFragment) {\n  \t\t\tif (this.rendered) {\n  \t\t\t\tvar parentNode = this.parentFragment.findParentNode();\n  \t\t\t\tvar anchor = this.parentFragment.findNextNode(this);\n\n  \t\t\t\tif (anchor) {\n  \t\t\t\t\tvar docFrag = createDocumentFragment();\n  \t\t\t\t\tnewFragment.render(docFrag);\n\n  \t\t\t\t\t// we use anchor.parentNode, not parentNode, because the sibling\n  \t\t\t\t\t// may be temporarily detached as a result of a shuffle\n  \t\t\t\t\tanchor.parentNode.insertBefore(docFrag, anchor);\n  \t\t\t\t} else {\n  \t\t\t\t\tnewFragment.render(parentNode);\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\tthis.fragment = newFragment;\n  \t\t}\n  \t};\n\n  \treturn Section;\n  })(Mustache);\n\n  var elementCache = {};\n\n  var ieBug = undefined;\n  var ieBlacklist = undefined;\n\n  try {\n  \tcreateElement('table').innerHTML = 'foo';\n  } catch (err) {\n  \tieBug = true;\n\n  \tieBlacklist = {\n  \t\tTABLE: ['<table class=\"x\">', '</table>'],\n  \t\tTHEAD: ['<table><thead class=\"x\">', '</thead></table>'],\n  \t\tTBODY: ['<table><tbody class=\"x\">', '</tbody></table>'],\n  \t\tTR: ['<table><tr class=\"x\">', '</tr></table>'],\n  \t\tSELECT: ['<select class=\"x\">', '</select>']\n  \t};\n  }\n\n  function insertHtml (html, node, docFrag) {\n  \tvar nodes = [];\n\n  \t// render 0 and false\n  \tif (html == null || html === '') return nodes;\n\n  \tvar container = undefined;\n  \tvar wrapper = undefined;\n  \tvar selectedOption = undefined;\n\n  \tif (ieBug && (wrapper = ieBlacklist[node.tagName])) {\n  \t\tcontainer = element('DIV');\n  \t\tcontainer.innerHTML = wrapper[0] + html + wrapper[1];\n  \t\tcontainer = container.querySelector('.x');\n\n  \t\tif (container.tagName === 'SELECT') {\n  \t\t\tselectedOption = container.options[container.selectedIndex];\n  \t\t}\n  \t} else if (node.namespaceURI === svg$1) {\n  \t\tcontainer = element('DIV');\n  \t\tcontainer.innerHTML = '<svg class=\"x\">' + html + '</svg>';\n  \t\tcontainer = container.querySelector('.x');\n  \t} else {\n  \t\tcontainer = element(node.tagName);\n  \t\tcontainer.innerHTML = html;\n\n  \t\tif (container.tagName === 'SELECT') {\n  \t\t\tselectedOption = container.options[container.selectedIndex];\n  \t\t}\n  \t}\n\n  \tvar child = undefined;\n  \twhile (child = container.firstChild) {\n  \t\tnodes.push(child);\n  \t\tdocFrag.appendChild(child);\n  \t}\n\n  \t// This is really annoying. Extracting <option> nodes from the\n  \t// temporary container <select> causes the remaining ones to\n  \t// become selected. So now we have to deselect them. IE8, you\n  \t// amaze me. You really do\n  \t// ...and now Chrome too\n  \tvar i = undefined;\n  \tif (node.tagName === 'SELECT') {\n  \t\ti = nodes.length;\n  \t\twhile (i--) {\n  \t\t\tif (nodes[i] !== selectedOption) {\n  \t\t\t\tnodes[i].selected = false;\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \treturn nodes;\n  }\n\n  function element(tagName) {\n  \treturn elementCache[tagName] || (elementCache[tagName] = createElement(tagName));\n  }\n\n  var Triple = (function (_Mustache) {\n  \tinherits(Triple, _Mustache);\n\n  \tfunction Triple(options) {\n  \t\tclassCallCheck(this, Triple);\n\n  \t\t_Mustache.call(this, options);\n  \t}\n\n  \tTriple.prototype.detach = function detach() {\n  \t\tvar docFrag = createDocumentFragment();\n  \t\tthis.nodes.forEach(function (node) {\n  \t\t\treturn docFrag.appendChild(node);\n  \t\t});\n  \t\treturn docFrag;\n  \t};\n\n  \tTriple.prototype.find = function find(selector) {\n  \t\tvar len = this.nodes.length;\n  \t\tvar i = undefined;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tvar node = this.nodes[i];\n\n  \t\t\tif (node.nodeType !== 1) continue;\n\n  \t\t\tif (matches(node, selector)) return node;\n\n  \t\t\tvar queryResult = node.querySelector(selector);\n  \t\t\tif (queryResult) return queryResult;\n  \t\t}\n\n  \t\treturn null;\n  \t};\n\n  \tTriple.prototype.findAll = function findAll(selector, query) {\n  \t\tvar len = this.nodes.length;\n  \t\tvar i = undefined;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tvar node = this.nodes[i];\n\n  \t\t\tif (node.nodeType !== 1) continue;\n\n  \t\t\tif (query.test(node)) query.add(node);\n\n  \t\t\tvar queryAllResult = node.querySelectorAll(selector);\n  \t\t\tif (queryAllResult) {\n  \t\t\t\tvar numNodes = queryAllResult.length;\n  \t\t\t\tvar j = undefined;\n\n  \t\t\t\tfor (j = 0; j < numNodes; j += 1) {\n  \t\t\t\t\tquery.add(queryAllResult[j]);\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tTriple.prototype.findComponent = function findComponent() {\n  \t\treturn null;\n  \t};\n\n  \tTriple.prototype.firstNode = function firstNode() {\n  \t\treturn this.nodes[0];\n  \t};\n\n  \tTriple.prototype.render = function render(target) {\n  \t\tvar html = this.model ? this.model.get() : '';\n  \t\tthis.nodes = insertHtml(html, this.parentFragment.findParentNode(), target);\n  \t\tthis.rendered = true;\n  \t};\n\n  \tTriple.prototype.toString = function toString() {\n  \t\treturn this.model && this.model.get() != null ? decodeCharacterReferences('' + this.model.get()) : '';\n  \t};\n\n  \tTriple.prototype.unrender = function unrender() {\n  \t\tif (this.nodes) this.nodes.forEach(function (node) {\n  \t\t\treturn detachNode(node);\n  \t\t});\n  \t\tthis.rendered = false;\n  \t};\n\n  \tTriple.prototype.update = function update() {\n  \t\tif (this.rendered && this.dirty) {\n  \t\t\tthis.dirty = false;\n\n  \t\t\tthis.unrender();\n  \t\t\tvar docFrag = createDocumentFragment();\n  \t\t\tthis.render(docFrag);\n\n  \t\t\tvar parentNode = this.parentFragment.findParentNode();\n  \t\t\tvar anchor = this.parentFragment.findNextNode(this);\n\n  \t\t\tparentNode.insertBefore(docFrag, anchor);\n  \t\t}\n  \t};\n\n  \treturn Triple;\n  })(Mustache);\n\n  var Yielder = (function (_Item) {\n  \tinherits(Yielder, _Item);\n\n  \tfunction Yielder(options) {\n  \t\tclassCallCheck(this, Yielder);\n\n  \t\t_Item.call(this, options);\n\n  \t\tthis.container = options.parentFragment.ractive;\n  \t\tthis.component = this.container.component;\n\n  \t\tthis.containerFragment = options.parentFragment;\n  \t\tthis.parentFragment = this.component.parentFragment;\n\n  \t\t// {{yield}} is equivalent to {{yield content}}\n  \t\tthis.name = options.template.n || '';\n  \t}\n\n  \tYielder.prototype.bind = function bind() {\n  \t\tvar name = this.name;\n\n  \t\t(this.component.yielders[name] || (this.component.yielders[name] = [])).push(this);\n\n  \t\t// TODO don't parse here\n  \t\tvar template = this.container._inlinePartials[name || 'content'];\n\n  \t\tif (typeof template === 'string') {\n  \t\t\ttemplate = parse(template).t;\n  \t\t}\n\n  \t\tif (!template) {\n  \t\t\twarnIfDebug('Could not find template for partial \"' + name + '\"', { ractive: this.ractive });\n  \t\t\ttemplate = [];\n  \t\t}\n\n  \t\tthis.fragment = new Fragment({\n  \t\t\towner: this,\n  \t\t\tractive: this.container.parent,\n  \t\t\ttemplate: template\n  \t\t}).bind();\n  \t};\n\n  \tYielder.prototype.bubble = function bubble() {\n  \t\tif (!this.dirty) {\n  \t\t\tthis.containerFragment.bubble();\n  \t\t\tthis.dirty = true;\n  \t\t}\n  \t};\n\n  \tYielder.prototype.detach = function detach() {\n  \t\treturn this.fragment.detach();\n  \t};\n\n  \tYielder.prototype.find = function find(selector) {\n  \t\treturn this.fragment.find(selector);\n  \t};\n\n  \tYielder.prototype.findAll = function findAll(selector, queryResult) {\n  \t\tthis.fragment.find(selector, queryResult);\n  \t};\n\n  \tYielder.prototype.findComponent = function findComponent(name) {\n  \t\treturn this.fragment.findComponent(name);\n  \t};\n\n  \tYielder.prototype.findAllComponents = function findAllComponents(name, queryResult) {\n  \t\tthis.fragment.findAllComponents(name, queryResult);\n  \t};\n\n  \tYielder.prototype.findNextNode = function findNextNode() {\n  \t\treturn this.containerFragment.findNextNode(this);\n  \t};\n\n  \tYielder.prototype.firstNode = function firstNode(skipParent) {\n  \t\treturn this.fragment.firstNode(skipParent);\n  \t};\n\n  \tYielder.prototype.rebind = function rebind() {\n  \t\tthis.fragment.rebind();\n  \t};\n\n  \tYielder.prototype.render = function render(target, occupants) {\n  \t\treturn this.fragment.render(target, occupants);\n  \t};\n\n  \tYielder.prototype.setTemplate = function setTemplate(name) {\n  \t\tvar template = this.parentFragment.ractive.partials[name];\n\n  \t\tif (typeof template === 'string') {\n  \t\t\ttemplate = parse(template).t;\n  \t\t}\n\n  \t\tthis.partialTemplate = template || []; // TODO warn on missing partial\n  \t};\n\n  \tYielder.prototype.toString = function toString(escape) {\n  \t\treturn this.fragment.toString(escape);\n  \t};\n\n  \tYielder.prototype.unbind = function unbind() {\n  \t\tthis.fragment.unbind();\n  \t\tremoveFromArray(this.component.yielders[this.name], this);\n  \t};\n\n  \tYielder.prototype.unrender = function unrender(shouldDestroy) {\n  \t\tthis.fragment.unrender(shouldDestroy);\n  \t};\n\n  \tYielder.prototype.update = function update() {\n  \t\tthis.dirty = false;\n  \t\tthis.fragment.update();\n  \t};\n\n  \treturn Yielder;\n  })(Item);\n\n  var textTypes = [undefined, 'text', 'search', 'url', 'email', 'hidden', 'password', 'search', 'reset', 'submit'];\n  function getUpdateDelegate(attribute) {\n  \tvar element = attribute.element;\n  \tvar name = attribute.name;\n\n  \tif (name === 'id') return updateId;\n\n  \tif (name === 'value') {\n  \t\t// special case - selects\n  \t\tif (element.name === 'select' && name === 'value') {\n  \t\t\treturn element.getAttribute('multiple') ? updateMultipleSelectValue : updateSelectValue;\n  \t\t}\n\n  \t\tif (element.name === 'textarea') return updateStringValue;\n\n  \t\t// special case - contenteditable\n  \t\tif (element.getAttribute('contenteditable') != null) return updateContentEditableValue;\n\n  \t\t// special case - <input>\n  \t\tif (element.name === 'input') {\n  \t\t\tvar type = element.getAttribute('type');\n\n  \t\t\t// type='file' value='{{fileList}}'>\n  \t\t\tif (type === 'file') return noop; // read-only\n\n  \t\t\t// type='radio' name='{{twoway}}'\n  \t\t\tif (type === 'radio' && element.binding && element.binding.attribute.name === 'name') return updateRadioValue;\n\n  \t\t\tif (~textTypes.indexOf(type)) return updateStringValue;\n  \t\t}\n\n  \t\treturn updateValue;\n  \t}\n\n  \tvar node = element.node;\n\n  \t// special case - <input type='radio' name='{{twoway}}' value='foo'>\n  \tif (attribute.isTwoway && name === 'name') {\n  \t\tif (node.type === 'radio') return updateRadioName;\n  \t\tif (node.type === 'checkbox') return updateCheckboxName;\n  \t}\n\n  \t// special case - style attributes in Internet Exploder\n  \tif (name === 'style' && node.style.setAttribute) return updateIEStyleAttribute;\n\n  \t// special case - class names. IE fucks things up, again\n  \tif (name === 'class' && (!node.namespaceURI || node.namespaceURI === html)) return updateClassName;\n\n  \tif (attribute.isBoolean) return updateBoolean;\n\n  \tif (attribute.namespace && attribute.namespace !== attribute.node.namespaceURI) return updateNamespacedAttribute;\n\n  \treturn updateAttribute;\n  }\n\n  function updateId() {\n  \tvar node = this.node;\n\n  \tvar value = this.getValue();\n\n  \tdelete this.ractive.nodes[node.id];\n  \tthis.ractive.nodes[value] = node;\n\n  \tnode.id = value;\n  }\n\n  function updateMultipleSelectValue() {\n  \tvar value = this.getValue();\n\n  \tif (!isArray(value)) value = [value];\n\n  \tvar options = this.node.options;\n  \tvar i = options.length;\n\n  \twhile (i--) {\n  \t\tvar option = options[i];\n  \t\tvar optionValue = option._ractive ? option._ractive.value : option.value; // options inserted via a triple don't have _ractive\n\n  \t\toption.selected = arrayContains(value, optionValue);\n  \t}\n  }\n\n  function updateSelectValue() {\n  \tvar value = this.getValue();\n\n  \tif (!this.locked) {\n  \t\t// TODO is locked still a thing?\n  \t\tthis.node._ractive.value = value;\n\n  \t\tvar options = this.node.options;\n  \t\tvar i = options.length;\n\n  \t\twhile (i--) {\n  \t\t\tvar option = options[i];\n  \t\t\tvar optionValue = option._ractive ? option._ractive.value : option.value; // options inserted via a triple don't have _ractive\n\n  \t\t\tif (optionValue == value) {\n  \t\t\t\t// double equals as we may be comparing numbers with strings\n  \t\t\t\toption.selected = true;\n  \t\t\t\tbreak;\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \t// if we're still here, it means the new value didn't match any of the options...\n  \t// TODO figure out what to do in this situation\n  }\n\n  function updateContentEditableValue() {\n  \tvar value = this.getValue();\n\n  \tif (!this.locked) {\n  \t\tthis.node.innerHTML = value === undefined ? '' : value;\n  \t}\n  }\n\n  function updateRadioValue() {\n  \tvar node = this.node;\n  \tvar wasChecked = node.checked;\n\n  \tvar value = this.getValue();\n\n  \t//node.value = this.element.getAttribute( 'value' );\n  \tnode.value = this.node._ractive.value = value;\n  \tnode.checked = value === this.element.getAttribute('name');\n\n  \t// This is a special case - if the input was checked, and the value\n  \t// changed so that it's no longer checked, the twoway binding is\n  \t// most likely out of date. To fix it we have to jump through some\n  \t// hoops... this is a little kludgy but it works\n  \tif (wasChecked && !node.checked && this.element.binding && this.element.binding.rendered) {\n  \t\tthis.element.binding.group.model.set(this.element.binding.group.getValue());\n  \t}\n  }\n\n  function updateValue() {\n  \tif (!this.locked) {\n  \t\tvar value = this.getValue();\n\n  \t\tthis.node.value = this.node._ractive.value = value;\n  \t\tthis.node.setAttribute('value', value);\n  \t}\n  }\n\n  function updateStringValue() {\n  \tif (!this.locked) {\n  \t\tvar value = this.getValue();\n\n  \t\tthis.node._ractive.value = value;\n\n  \t\tthis.node.value = safeToStringValue(value);\n  \t\tthis.node.setAttribute('value', safeToStringValue(value));\n  \t}\n  }\n\n  function updateRadioName() {\n  \tthis.node.checked = this.getValue() == this.node._ractive.value;\n  }\n\n  function updateCheckboxName() {\n  \tvar element = this.element;\n  \tvar node = this.node;\n\n  \tvar binding = element.binding;\n\n  \tvar value = this.getValue();\n  \tvar valueAttribute = element.getAttribute('value');\n\n  \tif (!isArray(value)) {\n  \t\tbinding.isChecked = node.checked = value == valueAttribute;\n  \t} else {\n  \t\tvar i = value.length;\n  \t\twhile (i--) {\n  \t\t\tif (valueAttribute == value[i]) {\n  \t\t\t\tbinding.isChecked = node.checked = true;\n  \t\t\t\treturn;\n  \t\t\t}\n  \t\t}\n  \t\tbinding.isChecked = node.checked = false;\n  \t}\n  }\n\n  function updateIEStyleAttribute() {\n  \tthis.node.style.setAttribute('cssText', this.getValue() || '');\n  }\n\n  function updateClassName() {\n  \tthis.node.className = safeToStringValue(this.getValue());\n  }\n\n  function updateBoolean() {\n  \t// with two-way binding, only update if the change wasn't initiated by the user\n  \t// otherwise the cursor will often be sent to the wrong place\n  \tif (!this.locked) {\n  \t\tif (this.useProperty) {\n  \t\t\tthis.node[this.propertyName] = this.getValue();\n  \t\t} else {\n  \t\t\tif (this.getValue()) {\n  \t\t\t\tthis.node.setAttribute(this.propertyName, '');\n  \t\t\t} else {\n  \t\t\t\tthis.node.removeAttribute(this.propertyName);\n  \t\t\t}\n  \t\t}\n  \t}\n  }\n\n  function updateAttribute() {\n  \tthis.node.setAttribute(this.name, safeToStringValue(this.getString()));\n  }\n\n  function updateNamespacedAttribute() {\n  \tthis.node.setAttributeNS(this.namespace, this.name.slice(this.name.indexOf(':') + 1), safeToStringValue(this.getString()));\n  }\n\n  var propertyNames = {\n  \t'accept-charset': 'acceptCharset',\n  \taccesskey: 'accessKey',\n  \tbgcolor: 'bgColor',\n  \t'class': 'className',\n  \tcodebase: 'codeBase',\n  \tcolspan: 'colSpan',\n  \tcontenteditable: 'contentEditable',\n  \tdatetime: 'dateTime',\n  \tdirname: 'dirName',\n  \t'for': 'htmlFor',\n  \t'http-equiv': 'httpEquiv',\n  \tismap: 'isMap',\n  \tmaxlength: 'maxLength',\n  \tnovalidate: 'noValidate',\n  \tpubdate: 'pubDate',\n  \treadonly: 'readOnly',\n  \trowspan: 'rowSpan',\n  \ttabindex: 'tabIndex',\n  \tusemap: 'useMap'\n  };\n\n  function lookupNamespace(node, prefix) {\n  \tvar qualified = 'xmlns:' + prefix;\n\n  \twhile (node) {\n  \t\tif (node.hasAttribute(qualified)) return node.getAttribute(qualified);\n  \t\tnode = node.parentNode;\n  \t}\n\n  \treturn namespaces[prefix];\n  }\n\n  var Attribute = (function (_Item) {\n  \tinherits(Attribute, _Item);\n\n  \tfunction Attribute(options) {\n  \t\tclassCallCheck(this, Attribute);\n\n  \t\t_Item.call(this, options);\n\n  \t\tthis.name = options.name;\n  \t\tthis.namespace = null;\n  \t\tthis.element = options.element;\n  \t\tthis.parentFragment = options.element.parentFragment; // shared\n  \t\tthis.ractive = this.parentFragment.ractive;\n\n  \t\tthis.rendered = false;\n  \t\tthis.updateDelegate = null;\n  \t\tthis.fragment = null;\n  \t\tthis.value = null;\n\n  \t\tif (!isArray(options.template)) {\n  \t\t\tthis.value = options.template;\n  \t\t\tif (this.value === 0) {\n  \t\t\t\tthis.value = '';\n  \t\t\t}\n  \t\t} else {\n  \t\t\tthis.fragment = new Fragment({\n  \t\t\t\towner: this,\n  \t\t\t\ttemplate: options.template\n  \t\t\t});\n  \t\t}\n\n  \t\tthis.interpolator = this.fragment && this.fragment.items.length === 1 && this.fragment.items[0].type === INTERPOLATOR && this.fragment.items[0];\n  \t}\n\n  \tAttribute.prototype.bind = function bind() {\n  \t\tif (this.fragment) {\n  \t\t\tthis.fragment.bind();\n  \t\t}\n  \t};\n\n  \tAttribute.prototype.bubble = function bubble() {\n  \t\tif (!this.dirty) {\n  \t\t\tthis.element.bubble();\n  \t\t\tthis.dirty = true;\n  \t\t}\n  \t};\n\n  \tAttribute.prototype.getString = function getString() {\n  \t\treturn this.fragment ? this.fragment.toString() : this.value != null ? '' + this.value : '';\n  \t};\n\n  \t// TODO could getValue ever be called for a static attribute,\n  \t// or can we assume that this.fragment exists?\n\n  \tAttribute.prototype.getValue = function getValue() {\n  \t\treturn this.fragment ? this.fragment.valueOf() : booleanAttributes.test(this.name) ? true : this.value;\n  \t};\n\n  \tAttribute.prototype.rebind = function rebind() {\n  \t\tif (this.fragment) this.fragment.rebind();\n  \t};\n\n  \tAttribute.prototype.render = function render() {\n  \t\tvar node = this.element.node;\n  \t\tthis.node = node;\n\n  \t\t// should we use direct property access, or setAttribute?\n  \t\tif (!node.namespaceURI || node.namespaceURI === namespaces.html) {\n  \t\t\tthis.propertyName = propertyNames[this.name] || this.name;\n\n  \t\t\tif (node[this.propertyName] !== undefined) {\n  \t\t\t\tthis.useProperty = true;\n  \t\t\t}\n\n  \t\t\t// is attribute a boolean attribute or 'value'? If so we're better off doing e.g.\n  \t\t\t// node.selected = true rather than node.setAttribute( 'selected', '' )\n  \t\t\tif (booleanAttributes.test(this.name) || this.isTwoway) {\n  \t\t\t\tthis.isBoolean = true;\n  \t\t\t}\n\n  \t\t\tif (this.propertyName === 'value') {\n  \t\t\t\tnode._ractive.value = this.value;\n  \t\t\t}\n  \t\t}\n\n  \t\tif (node.namespaceURI) {\n  \t\t\tvar index = this.name.indexOf(':');\n  \t\t\tif (index !== -1) {\n  \t\t\t\tthis.namespace = lookupNamespace(node, this.name.slice(0, index));\n  \t\t\t} else {\n  \t\t\t\tthis.namespace = node.namespaceURI;\n  \t\t\t}\n  \t\t}\n\n  \t\tthis.rendered = true;\n  \t\tthis.updateDelegate = getUpdateDelegate(this);\n  \t\tthis.updateDelegate();\n  \t};\n\n  \tAttribute.prototype.toString = function toString() {\n  \t\tvar value = this.getValue();\n\n  \t\t// Special case - select and textarea values (should not be stringified)\n  \t\tif (this.name === 'value' && (this.element.getAttribute('contenteditable') !== undefined || this.element.name === 'select' || this.element.name === 'textarea')) {\n  \t\t\treturn;\n  \t\t}\n\n  \t\t// Special case  bound radio `name` attributes\n  \t\tif (this.name === 'name' && this.element.name === 'input' && this.interpolator && this.element.getAttribute('type') === 'radio') {\n  \t\t\treturn 'name=\"{{' + this.interpolator.model.getKeypath() + '}}\"';\n  \t\t}\n\n  \t\tif (booleanAttributes.test(this.name)) return value ? this.name : '';\n  \t\tif (value == null) return '';\n\n  \t\tvar str = safeToStringValue(this.getString()).replace(/&/g, '&amp;').replace(/\"/g, '&quot;').replace(/'/g, '&#39;');\n\n  \t\treturn str ? this.name + '=\"' + str + '\"' : this.name;\n  \t};\n\n  \tAttribute.prototype.unbind = function unbind() {\n  \t\tif (this.fragment) this.fragment.unbind();\n  \t};\n\n  \tAttribute.prototype.update = function update() {\n  \t\tif (this.dirty) {\n  \t\t\tthis.dirty = false;\n  \t\t\tif (this.fragment) this.fragment.update();\n  \t\t\tif (this.rendered) this.updateDelegate();\n  \t\t}\n  \t};\n\n  \treturn Attribute;\n  })(Item);\n\n  var div$1 = doc ? createElement('div') : null;\n\n  var ConditionalAttribute = (function (_Item) {\n  \tinherits(ConditionalAttribute, _Item);\n\n  \tfunction ConditionalAttribute(options) {\n  \t\tclassCallCheck(this, ConditionalAttribute);\n\n  \t\t_Item.call(this, options);\n\n  \t\tthis.attributes = [];\n\n  \t\tthis.owner = options.owner;\n\n  \t\tthis.fragment = new Fragment({\n  \t\t\tractive: this.ractive,\n  \t\t\towner: this,\n  \t\t\ttemplate: [this.template]\n  \t\t});\n\n  \t\tthis.dirty = false;\n  \t}\n\n  \tConditionalAttribute.prototype.bind = function bind() {\n  \t\tthis.fragment.bind();\n  \t};\n\n  \tConditionalAttribute.prototype.bubble = function bubble() {\n  \t\tif (!this.dirty) {\n  \t\t\tthis.dirty = true;\n  \t\t\tthis.owner.bubble();\n  \t\t}\n  \t};\n\n  \tConditionalAttribute.prototype.rebind = function rebind() {\n  \t\tthis.fragment.rebind();\n  \t};\n\n  \tConditionalAttribute.prototype.render = function render() {\n  \t\tthis.node = this.owner.node;\n  \t\tthis.isSvg = this.node.namespaceURI === svg$1;\n\n  \t\tthis.rendered = true;\n  \t\tthis.dirty = true; // TODO this seems hacky, but necessary for tests to pass in browser AND node.js\n  \t\tthis.update();\n  \t};\n\n  \tConditionalAttribute.prototype.toString = function toString() {\n  \t\treturn this.fragment.toString();\n  \t};\n\n  \tConditionalAttribute.prototype.unbind = function unbind() {\n  \t\tthis.fragment.unbind();\n  \t};\n\n  \tConditionalAttribute.prototype.unrender = function unrender() {\n  \t\tthis.rendered = false;\n  \t};\n\n  \tConditionalAttribute.prototype.update = function update() {\n  \t\tvar _this = this;\n\n  \t\tvar str = undefined;\n  \t\tvar attrs = undefined;\n\n  \t\tif (this.dirty) {\n  \t\t\tthis.dirty = false;\n\n  \t\t\tthis.fragment.update();\n\n  \t\t\tif (this.rendered) {\n  \t\t\t\tstr = this.fragment.toString();\n  \t\t\t\tattrs = parseAttributes(str, this.isSvg);\n\n  \t\t\t\t// any attributes that previously existed but no longer do\n  \t\t\t\t// must be removed\n  \t\t\t\tthis.attributes.filter(function (a) {\n  \t\t\t\t\treturn notIn(attrs, a);\n  \t\t\t\t}).forEach(function (a) {\n  \t\t\t\t\t_this.node.removeAttribute(a.name);\n  \t\t\t\t});\n\n  \t\t\t\tattrs.forEach(function (a) {\n  \t\t\t\t\t_this.node.setAttribute(a.name, a.value);\n  \t\t\t\t});\n\n  \t\t\t\tthis.attributes = attrs;\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \treturn ConditionalAttribute;\n  })(Item);\n\n  function parseAttributes(str, isSvg) {\n  \tvar tagName = isSvg ? 'svg' : 'div';\n  \treturn str ? (div$1.innerHTML = '<' + tagName + ' ' + str + '></' + tagName + '>') && toArray(div$1.childNodes[0].attributes) : [];\n  }\n\n  function notIn(haystack, needle) {\n  \tvar i = haystack.length;\n\n  \twhile (i--) {\n  \t\tif (haystack[i].name === needle.name) {\n  \t\t\treturn false;\n  \t\t}\n  \t}\n\n  \treturn true;\n  }\n\n  var missingDecorator = {\n  \tupdate: noop,\n  \tteardown: noop\n  };\n\n  var Decorator = (function () {\n  \tfunction Decorator(owner, template) {\n  \t\tclassCallCheck(this, Decorator);\n\n  \t\tthis.owner = owner;\n  \t\tthis.template = template;\n\n  \t\tthis.parentFragment = owner.parentFragment;\n  \t\tthis.ractive = owner.ractive;\n\n  \t\tthis.dynamicName = typeof template.n === 'object';\n  \t\tthis.dynamicArgs = !!template.d;\n\n  \t\tif (this.dynamicName) {\n  \t\t\tthis.nameFragment = new Fragment({\n  \t\t\t\towner: this,\n  \t\t\t\ttemplate: template.n\n  \t\t\t});\n  \t\t} else {\n  \t\t\tthis.name = template.n || template;\n  \t\t}\n\n  \t\tif (this.dynamicArgs) {\n  \t\t\tthis.argsFragment = new Fragment({\n  \t\t\t\towner: this,\n  \t\t\t\ttemplate: template.d\n  \t\t\t});\n  \t\t} else {\n  \t\t\tthis.args = template.a || [];\n  \t\t}\n\n  \t\tthis.node = null;\n  \t\tthis.intermediary = null;\n  \t}\n\n  \tDecorator.prototype.bind = function bind() {\n  \t\tif (this.dynamicName) {\n  \t\t\tthis.nameFragment.bind();\n  \t\t\tthis.name = this.nameFragment.toString();\n  \t\t}\n\n  \t\tif (this.dynamicArgs) this.argsFragment.bind();\n  \t};\n\n  \tDecorator.prototype.bubble = function bubble() {\n  \t\tif (!this.dirty) {\n  \t\t\tthis.dirty = true;\n  \t\t\tthis.owner.bubble();\n  \t\t}\n  \t};\n\n  \tDecorator.prototype.rebind = function rebind() {\n  \t\tif (this.dynamicName) this.nameFragment.rebind();\n  \t\tif (this.dynamicArgs) this.argsFragment.rebind();\n  \t};\n\n  \tDecorator.prototype.render = function render() {\n  \t\tvar fn = findInViewHierarchy('decorators', this.ractive, this.name);\n\n  \t\tif (!fn) {\n  \t\t\twarnOnce(missingPlugin(this.name, 'decorator'));\n  \t\t\tthis.intermediary = missingDecorator;\n  \t\t\treturn;\n  \t\t}\n\n  \t\tthis.node = this.owner.node;\n\n  \t\tvar args = this.dynamicArgs ? this.argsFragment.getArgsList() : this.args;\n  \t\tthis.intermediary = fn.apply(this.ractive, [this.node].concat(args));\n\n  \t\tif (!this.intermediary || !this.intermediary.teardown) {\n  \t\t\tthrow new Error('The \\'' + this.name + '\\' decorator must return an object with a teardown method');\n  \t\t}\n  \t};\n\n  \tDecorator.prototype.unbind = function unbind() {\n  \t\tif (this.dynamicName) this.nameFragment.unbind();\n  \t\tif (this.dynamicArgs) this.argsFragment.unbind();\n  \t};\n\n  \tDecorator.prototype.unrender = function unrender() {\n  \t\tif (this.intermediary) this.intermediary.teardown();\n  \t};\n\n  \tDecorator.prototype.update = function update() {\n  \t\tif (!this.dirty) return;\n\n  \t\tthis.dirty = false;\n\n  \t\tvar nameChanged = false;\n\n  \t\tif (this.dynamicName && this.nameFragment.dirty) {\n  \t\t\tvar _name = this.nameFragment.toString();\n  \t\t\tnameChanged = _name !== this.name;\n  \t\t\tthis.name = _name;\n  \t\t}\n\n  \t\tif (this.intermediary) {\n  \t\t\tif (nameChanged || !this.intermediary.update) {\n  \t\t\t\tthis.unrender();\n  \t\t\t\tthis.render();\n  \t\t\t} else {\n  \t\t\t\tif (this.dynamicArgs) {\n  \t\t\t\t\tif (this.argsFragment.dirty) {\n  \t\t\t\t\t\tvar args = this.argsFragment.getArgsList();\n  \t\t\t\t\t\tthis.intermediary.update.apply(this.ractive, args);\n  \t\t\t\t\t}\n  \t\t\t\t} else {\n  \t\t\t\t\tthis.intermediary.update.apply(this.ractive, this.args);\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\t// need to run these for unrender/render cases\n  \t\t// so can't just be in conditional if above\n\n  \t\tif (this.dynamicName && this.nameFragment.dirty) {\n  \t\t\tthis.nameFragment.update();\n  \t\t}\n\n  \t\tif (this.dynamicArgs && this.argsFragment.dirty) {\n  \t\t\tthis.argsFragment.update();\n  \t\t}\n  \t};\n\n  \treturn Decorator;\n  })();\n\n  function enqueue(ractive, event) {\n  \tif (ractive.event) {\n  \t\tractive._eventQueue.push(ractive.event);\n  \t}\n\n  \tractive.event = event;\n  }\n\n  function dequeue(ractive) {\n  \tif (ractive._eventQueue.length) {\n  \t\tractive.event = ractive._eventQueue.pop();\n  \t} else {\n  \t\tractive.event = null;\n  \t}\n  }\n\n  var starMaps = {};\n\n  // This function takes a keypath such as 'foo.bar.baz', and returns\n  // all the variants of that keypath that include a wildcard in place\n  // of a key, such as 'foo.bar.*', 'foo.*.baz', 'foo.*.*' and so on.\n  // These are then checked against the dependants map (ractive.viewmodel.depsMap)\n  // to see if any pattern observers are downstream of one or more of\n  // these wildcard keypaths (e.g. 'foo.bar.*.status')\n\n  function getPotentialWildcardMatches(keypath) {\n  \tvar keys, starMap, mapper, i, result, wildcardKeypath;\n\n  \tkeys = splitKeypath(keypath);\n  \tif (!(starMap = starMaps[keys.length])) {\n  \t\tstarMap = getStarMap(keys.length);\n  \t}\n\n  \tresult = [];\n\n  \tmapper = function (star, i) {\n  \t\treturn star ? '*' : keys[i];\n  \t};\n\n  \ti = starMap.length;\n  \twhile (i--) {\n  \t\twildcardKeypath = starMap[i].map(mapper).join('.');\n\n  \t\tif (!result.hasOwnProperty(wildcardKeypath)) {\n  \t\t\tresult.push(wildcardKeypath);\n  \t\t\tresult[wildcardKeypath] = true;\n  \t\t}\n  \t}\n\n  \treturn result;\n  }\n\n  // This function returns all the possible true/false combinations for\n  // a given number - e.g. for two, the possible combinations are\n  // [ true, true ], [ true, false ], [ false, true ], [ false, false ].\n  // It does so by getting all the binary values between 0 and e.g. 11\n  function getStarMap(num) {\n  \tvar ones = '',\n  \t    max,\n  \t    binary,\n  \t    starMap,\n  \t    mapper,\n  \t    i,\n  \t    j,\n  \t    l,\n  \t    map;\n\n  \tif (!starMaps[num]) {\n  \t\tstarMap = [];\n\n  \t\twhile (ones.length < num) {\n  \t\t\tones += 1;\n  \t\t}\n\n  \t\tmax = parseInt(ones, 2);\n\n  \t\tmapper = function (digit) {\n  \t\t\treturn digit === '1';\n  \t\t};\n\n  \t\tfor (i = 0; i <= max; i += 1) {\n  \t\t\tbinary = i.toString(2);\n  \t\t\twhile (binary.length < num) {\n  \t\t\t\tbinary = '0' + binary;\n  \t\t\t}\n\n  \t\t\tmap = [];\n  \t\t\tl = binary.length;\n  \t\t\tfor (j = 0; j < l; j++) {\n  \t\t\t\tmap.push(mapper(binary[j]));\n  \t\t\t}\n  \t\t\tstarMap[i] = map;\n  \t\t}\n\n  \t\tstarMaps[num] = starMap;\n  \t}\n\n  \treturn starMaps[num];\n  }\n\n  var wildcardCache = {};\n  function fireEvent(ractive, eventName) {\n  \tvar options = arguments.length <= 2 || arguments[2] === undefined ? {} : arguments[2];\n\n  \tif (!eventName) {\n  \t\treturn;\n  \t}\n\n  \tif (!options.event) {\n  \t\toptions.event = {\n  \t\t\tname: eventName,\n  \t\t\t// until event not included as argument default\n  \t\t\t_noArg: true\n  \t\t};\n  \t} else {\n  \t\toptions.event.name = eventName;\n  \t}\n\n  \tvar eventNames = getWildcardNames(eventName);\n\n  \tfireEventAs(ractive, eventNames, options.event, options.args, true);\n  }\n\n  function getWildcardNames(eventName) {\n  \tif (wildcardCache.hasOwnProperty(eventName)) {\n  \t\treturn wildcardCache[eventName];\n  \t} else {\n  \t\treturn wildcardCache[eventName] = getPotentialWildcardMatches(eventName);\n  \t}\n  }\n\n  function fireEventAs(ractive, eventNames, event, args) {\n  \tvar initialFire = arguments.length <= 4 || arguments[4] === undefined ? false : arguments[4];\n\n  \tvar subscribers,\n  \t    i,\n  \t    bubble = true;\n\n  \tenqueue(ractive, event);\n\n  \tfor (i = eventNames.length; i >= 0; i--) {\n  \t\tsubscribers = ractive._subs[eventNames[i]];\n\n  \t\tif (subscribers) {\n  \t\t\tbubble = notifySubscribers(ractive, subscribers, event, args) && bubble;\n  \t\t}\n  \t}\n\n  \tdequeue(ractive);\n\n  \tif (ractive.parent && bubble) {\n\n  \t\tif (initialFire && ractive.component) {\n  \t\t\tvar fullName = ractive.component.name + '.' + eventNames[eventNames.length - 1];\n  \t\t\teventNames = getWildcardNames(fullName);\n\n  \t\t\tif (event && !event.component) {\n  \t\t\t\tevent.component = ractive;\n  \t\t\t}\n  \t\t}\n\n  \t\tfireEventAs(ractive.parent, eventNames, event, args);\n  \t}\n  }\n\n  function notifySubscribers(ractive, subscribers, event, args) {\n  \tvar originalEvent = null,\n  \t    stopEvent = false;\n\n  \tif (event && !event._noArg) {\n  \t\targs = [event].concat(args);\n  \t}\n\n  \t// subscribers can be modified inflight, e.g. \"once\" functionality\n  \t// so we need to copy to make sure everyone gets called\n  \tsubscribers = subscribers.slice();\n\n  \tfor (var i = 0, len = subscribers.length; i < len; i += 1) {\n  \t\tif (subscribers[i].apply(ractive, args) === false) {\n  \t\t\tstopEvent = true;\n  \t\t}\n  \t}\n\n  \tif (event && !event._noArg && stopEvent && (originalEvent = event.original)) {\n  \t\toriginalEvent.preventDefault && originalEvent.preventDefault();\n  \t\toriginalEvent.stopPropagation && originalEvent.stopPropagation();\n  \t}\n\n  \treturn !stopEvent;\n  }\n\n  function gatherRefs(fragment) {\n  \tvar key = {},\n  \t    index = {};\n\n  \t// walk up the template gather refs as we go\n  \twhile (fragment) {\n  \t\tif (fragment.parent && (fragment.parent.indexRef || fragment.parent.keyRef)) {\n  \t\t\tvar ref = fragment.parent.indexRef;\n  \t\t\tif (ref && !(ref in index)) index[ref] = fragment.index;\n  \t\t\tref = fragment.parent.keyRef;\n  \t\t\tif (ref && !(ref in key)) key[ref] = fragment.key;\n  \t\t}\n\n  \t\tif (fragment.componentParent && !fragment.ractive.isolated) {\n  \t\t\tfragment = fragment.componentParent;\n  \t\t} else {\n  \t\t\tfragment = fragment.parent;\n  \t\t}\n  \t}\n\n  \treturn { key: key, index: index };\n  }\n\n  var eventPattern = /^event(?:\\.(.+))?$/;\n  var argumentsPattern = /^arguments\\.(\\d*)$/;\n  var dollarArgsPattern = /^\\$(\\d*)$/;\n\n  var EventDirective = (function () {\n  \tfunction EventDirective(owner, event, template) {\n  \t\tclassCallCheck(this, EventDirective);\n\n  \t\tthis.owner = owner;\n  \t\tthis.event = event;\n  \t\tthis.template = template;\n\n  \t\tthis.ractive = owner.parentFragment.ractive;\n  \t\tthis.parentFragment = owner.parentFragment;\n\n  \t\tthis.context = null;\n  \t\tthis.passthru = false;\n\n  \t\t// method calls\n  \t\tthis.method = null;\n  \t\tthis.resolvers = null;\n  \t\tthis.models = null;\n  \t\tthis.argsFn = null;\n\n  \t\t// handler directive\n  \t\tthis.action = null;\n  \t\tthis.args = null;\n  \t}\n\n  \tEventDirective.prototype.bind = function bind() {\n  \t\tvar _this = this;\n\n  \t\tthis.context = this.parentFragment.findContext();\n\n  \t\tvar template = this.template;\n\n  \t\tif (template.m) {\n  \t\t\tthis.method = template.m;\n\n  \t\t\t// pass-thru \"...arguments\"\n  \t\t\tthis.passthru = !!template.g;\n\n  \t\t\tif (template.a) {\n  \t\t\t\tthis.resolvers = [];\n  \t\t\t\tthis.models = template.a.r.map(function (ref, i) {\n\n  \t\t\t\t\tif (eventPattern.test(ref)) {\n  \t\t\t\t\t\t// on-click=\"foo(event.node)\"\n  \t\t\t\t\t\treturn {\n  \t\t\t\t\t\t\tevent: true,\n  \t\t\t\t\t\t\tkeys: ref.length > 5 ? splitKeypath(ref.slice(6)) : [],\n  \t\t\t\t\t\t\tunbind: noop\n  \t\t\t\t\t\t};\n  \t\t\t\t\t}\n\n  \t\t\t\t\tvar argMatch = argumentsPattern.exec(ref);\n  \t\t\t\t\tif (argMatch) {\n  \t\t\t\t\t\t// on-click=\"foo(arguments[0])\"\n  \t\t\t\t\t\treturn {\n  \t\t\t\t\t\t\targument: true,\n  \t\t\t\t\t\t\tindex: argMatch[1]\n  \t\t\t\t\t\t};\n  \t\t\t\t\t}\n\n  \t\t\t\t\tvar dollarMatch = dollarArgsPattern.exec(ref);\n  \t\t\t\t\tif (dollarMatch) {\n  \t\t\t\t\t\t// on-click=\"foo($1)\"\n  \t\t\t\t\t\treturn {\n  \t\t\t\t\t\t\targument: true,\n  \t\t\t\t\t\t\tindex: dollarMatch[1] - 1\n  \t\t\t\t\t\t};\n  \t\t\t\t\t}\n\n  \t\t\t\t\tvar resolver = undefined;\n\n  \t\t\t\t\tvar model = resolveReference(_this.parentFragment, ref);\n  \t\t\t\t\tif (!model) {\n  \t\t\t\t\t\tresolver = _this.parentFragment.resolve(ref, function (model) {\n  \t\t\t\t\t\t\t_this.models[i] = model;\n  \t\t\t\t\t\t\tremoveFromArray(_this.resolvers, resolver);\n  \t\t\t\t\t\t});\n\n  \t\t\t\t\t\t_this.resolvers.push(resolver);\n  \t\t\t\t\t}\n\n  \t\t\t\t\treturn model;\n  \t\t\t\t});\n\n  \t\t\t\tthis.argsFn = getFunction(template.a.s, template.a.r.length);\n  \t\t\t}\n  \t\t} else {\n  \t\t\t// TODO deprecate this style of directive\n  \t\t\tthis.action = typeof template === 'string' ? // on-click='foo'\n  \t\t\ttemplate : typeof template.n === 'string' ? // on-click='{{dynamic}}'\n  \t\t\ttemplate.n : new Fragment({\n  \t\t\t\towner: this,\n  \t\t\t\ttemplate: template.n\n  \t\t\t});\n\n  \t\t\tthis.args = template.a ? // static arguments\n  \t\t\ttypeof template.a === 'string' ? [template.a] : template.a : template.d ? // dynamic arguments\n  \t\t\tnew Fragment({\n  \t\t\t\towner: this,\n  \t\t\t\ttemplate: template.d\n  \t\t\t}) : []; // no arguments\n  \t\t}\n\n  \t\tif (this.template.n && typeof this.template.n !== 'string') this.action.bind();\n  \t\tif (this.template.d) this.args.bind();\n  \t};\n\n  \tEventDirective.prototype.bubble = function bubble() {\n  \t\tif (!this.dirty) {\n  \t\t\tthis.dirty = true;\n  \t\t\tthis.owner.bubble();\n  \t\t}\n  \t};\n\n  \tEventDirective.prototype.fire = function fire(event) {\n  \t\tvar passedArgs = arguments.length <= 1 || arguments[1] === undefined ? [] : arguments[1];\n\n  \t\t// augment event object\n  \t\tif (event) {\n  \t\t\tvar refs = gatherRefs(this.parentFragment);\n  \t\t\tevent.keypath = this.context.getKeypath(this.ractive);\n  \t\t\tevent.rootpath = this.context.getKeypath();\n  \t\t\tevent.context = this.context.get();\n  \t\t\tevent.index = refs.index;\n  \t\t\tevent.key = refs.key;\n  \t\t}\n\n  \t\tif (this.method) {\n  \t\t\tif (typeof this.ractive[this.method] !== 'function') {\n  \t\t\t\tthrow new Error('Attempted to call a non-existent method (\"' + this.method + '\")');\n  \t\t\t}\n\n  \t\t\tvar args = undefined;\n\n  \t\t\tif (event) passedArgs.unshift(event);\n\n  \t\t\tif (this.models) {\n  \t\t\t\tvar values = this.models.map(function (model) {\n  \t\t\t\t\tif (!model) return undefined;\n\n  \t\t\t\t\tif (model.event) {\n  \t\t\t\t\t\tvar obj = event;\n  \t\t\t\t\t\tvar keys = model.keys.slice();\n\n  \t\t\t\t\t\twhile (keys.length) obj = obj[keys.shift()];\n  \t\t\t\t\t\treturn obj;\n  \t\t\t\t\t}\n\n  \t\t\t\t\tif (model.argument) {\n  \t\t\t\t\t\treturn passedArgs ? passedArgs[model.index] : void 0;\n  \t\t\t\t\t}\n\n  \t\t\t\t\tif (model.wrapper) {\n  \t\t\t\t\t\treturn model.wrapper.value;\n  \t\t\t\t\t}\n\n  \t\t\t\t\treturn model.get();\n  \t\t\t\t});\n\n  \t\t\t\targs = this.argsFn.apply(null, values);\n  \t\t\t}\n\n  \t\t\tif (this.passthru) {\n  \t\t\t\targs = args ? args.concat(passedArgs) : passedArgs;\n  \t\t\t}\n\n  \t\t\t// make event available as `this.event`\n  \t\t\tvar ractive = this.ractive;\n  \t\t\tvar oldEvent = ractive.event;\n\n  \t\t\tractive.event = event;\n  \t\t\tvar result = ractive[this.method].apply(ractive, args);\n\n  \t\t\t// Auto prevent and stop if return is explicitly false\n  \t\t\tvar original = undefined;\n  \t\t\tif (result === false && (original = event.original)) {\n  \t\t\t\toriginal.preventDefault && original.preventDefault();\n  \t\t\t\toriginal.stopPropagation && original.stopPropagation();\n  \t\t\t}\n\n  \t\t\tractive.event = oldEvent;\n  \t\t} else {\n  \t\t\tvar action = this.action.toString();\n  \t\t\tvar args = this.template.d ? this.args.getArgsList() : this.args;\n\n  \t\t\tif (passedArgs.length) args = args.concat(passedArgs);\n\n  \t\t\tif (event) event.name = action;\n\n  \t\t\tfireEvent(this.ractive, action, {\n  \t\t\t\tevent: event,\n  \t\t\t\targs: args\n  \t\t\t});\n  \t\t}\n  \t};\n\n  \tEventDirective.prototype.rebind = function rebind() {\n  \t\tthis.unbind();\n  \t\tthis.bind();\n  \t};\n\n  \tEventDirective.prototype.render = function render() {\n  \t\tthis.event.listen(this);\n  \t};\n\n  \tEventDirective.prototype.unbind = function unbind() {\n  \t\tvar template = this.template;\n\n  \t\tif (template.m) {\n  \t\t\tif (this.resolvers) this.resolvers.forEach(_unbind);\n  \t\t\tthis.resolvers = [];\n\n  \t\t\tthis.models = null;\n  \t\t} else {\n  \t\t\t// TODO this is brittle and non-explicit, fix it\n  \t\t\tif (this.action.unbind) this.action.unbind();\n  \t\t\tif (this.args.unbind) this.args.unbind();\n  \t\t}\n  \t};\n\n  \tEventDirective.prototype.unrender = function unrender() {\n  \t\tthis.event.unlisten();\n  \t};\n\n  \tEventDirective.prototype.update = function update() {\n  \t\tif (this.method || !this.dirty) return; // nothing to do\n\n  \t\tthis.dirty = false;\n\n  \t\t// ugh legacy\n  \t\tif (this.action.update) this.action.update();\n  \t\tif (this.template.d) this.args.update();\n  \t};\n\n  \treturn EventDirective;\n  })();\n\n  var DOMEvent = (function () {\n  \tfunction DOMEvent(name, owner) {\n  \t\tclassCallCheck(this, DOMEvent);\n\n  \t\tif (name.indexOf('*') !== -1) {\n  \t\t\tfatal('Only component proxy-events may contain \"*\" wildcards, <' + owner.name + ' on-' + name + '=\"...\"/> is not valid');\n  \t\t}\n\n  \t\tthis.name = name;\n  \t\tthis.owner = owner;\n  \t\tthis.node = null;\n  \t\tthis.handler = null;\n  \t}\n\n  \tDOMEvent.prototype.listen = function listen(directive) {\n  \t\tvar node = this.node = this.owner.node;\n  \t\tvar name = this.name;\n\n  \t\tif (!('on' + name in node)) {\n  \t\t\twarnOnce(missingPlugin(name, 'events'));\n  \t\t}\n\n  \t\tnode.addEventListener(name, this.handler = function (event) {\n  \t\t\tdirective.fire({\n  \t\t\t\tnode: node,\n  \t\t\t\toriginal: event\n  \t\t\t});\n  \t\t}, false);\n  \t};\n\n  \tDOMEvent.prototype.unlisten = function unlisten() {\n  \t\tthis.node.removeEventListener(this.name, this.handler, false);\n  \t};\n\n  \treturn DOMEvent;\n  })();\n\n  var CustomEvent = (function () {\n  \tfunction CustomEvent(eventPlugin, owner) {\n  \t\tclassCallCheck(this, CustomEvent);\n\n  \t\tthis.eventPlugin = eventPlugin;\n  \t\tthis.owner = owner;\n  \t\tthis.handler = null;\n  \t}\n\n  \tCustomEvent.prototype.listen = function listen(directive) {\n  \t\tvar node = this.owner.node;\n\n  \t\tthis.handler = this.eventPlugin(node, function () {\n  \t\t\tvar event = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];\n\n  \t\t\tevent.node = event.node || node;\n  \t\t\tdirective.fire(event);\n  \t\t});\n  \t};\n\n  \tCustomEvent.prototype.unlisten = function unlisten() {\n  \t\tthis.handler.teardown();\n  \t};\n\n  \treturn CustomEvent;\n  })();\n\n  function camelCase (hyphenatedStr) {\n  \treturn hyphenatedStr.replace(/-([a-zA-Z])/g, function (match, $1) {\n  \t\treturn $1.toUpperCase();\n  \t});\n  }\n\n  var prefix = undefined;\n\n  if (!isClient) {\n  \tprefix = null;\n  } else {\n  \t(function () {\n  \t\tvar prefixCache = {};\n  \t\tvar testStyle = createElement('div').style;\n\n  \t\tprefix = function (prop) {\n  \t\t\tprop = camelCase(prop);\n\n  \t\t\tif (!prefixCache[prop]) {\n  \t\t\t\tif (testStyle[prop] !== undefined) {\n  \t\t\t\t\tprefixCache[prop] = prop;\n  \t\t\t\t} else {\n  \t\t\t\t\t// test vendors...\n  \t\t\t\t\tvar capped = prop.charAt(0).toUpperCase() + prop.substring(1);\n\n  \t\t\t\t\tvar i = vendors.length;\n  \t\t\t\t\twhile (i--) {\n  \t\t\t\t\t\tvar vendor = vendors[i];\n  \t\t\t\t\t\tif (testStyle[vendor + capped] !== undefined) {\n  \t\t\t\t\t\t\tprefixCache[prop] = vendor + capped;\n  \t\t\t\t\t\t\tbreak;\n  \t\t\t\t\t\t}\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\treturn prefixCache[prop];\n  \t\t};\n  \t})();\n  }\n\n  var prefix$1 = prefix;\n\n  var visible = undefined;\n  var hidden = 'hidden';\n\n  if (doc) {\n  \tvar prefix$2 = undefined;\n\n  \tif (hidden in doc) {\n  \t\tprefix$2 = '';\n  \t} else {\n  \t\tvar i$2 = vendors.length;\n  \t\twhile (i$2--) {\n  \t\t\tvar vendor = vendors[i$2];\n  \t\t\thidden = vendor + 'Hidden';\n\n  \t\t\tif (hidden in doc) {\n  \t\t\t\tprefix$2 = vendor;\n  \t\t\t\tbreak;\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \tif (prefix$2 !== undefined) {\n  \t\tdoc.addEventListener(prefix$2 + 'visibilitychange', onChange);\n  \t\tonChange();\n  \t} else {\n  \t\t// gah, we're in an old browser\n  \t\tif ('onfocusout' in doc) {\n  \t\t\tdoc.addEventListener('focusout', onHide);\n  \t\t\tdoc.addEventListener('focusin', onShow);\n  \t\t} else {\n  \t\t\twin.addEventListener('pagehide', onHide);\n  \t\t\twin.addEventListener('blur', onHide);\n\n  \t\t\twin.addEventListener('pageshow', onShow);\n  \t\t\twin.addEventListener('focus', onShow);\n  \t\t}\n\n  \t\tvisible = true; // until proven otherwise. Not ideal but hey\n  \t}\n  }\n\n  function onChange() {\n  \tvisible = !doc[hidden];\n  }\n\n  function onHide() {\n  \tvisible = false;\n  }\n\n  function onShow() {\n  \tvisible = true;\n  }\n\n  function snap(to) {\n  \treturn function () {\n  \t\treturn to;\n  \t};\n  }\n\n  var interpolators = {\n  \tnumber: function (from, to) {\n  \t\tvar delta;\n\n  \t\tif (!isNumeric(from) || !isNumeric(to)) {\n  \t\t\treturn null;\n  \t\t}\n\n  \t\tfrom = +from;\n  \t\tto = +to;\n\n  \t\tdelta = to - from;\n\n  \t\tif (!delta) {\n  \t\t\treturn function () {\n  \t\t\t\treturn from;\n  \t\t\t};\n  \t\t}\n\n  \t\treturn function (t) {\n  \t\t\treturn from + t * delta;\n  \t\t};\n  \t},\n\n  \tarray: function (from, to) {\n  \t\tvar intermediate, interpolators, len, i;\n\n  \t\tif (!isArray(from) || !isArray(to)) {\n  \t\t\treturn null;\n  \t\t}\n\n  \t\tintermediate = [];\n  \t\tinterpolators = [];\n\n  \t\ti = len = Math.min(from.length, to.length);\n  \t\twhile (i--) {\n  \t\t\tinterpolators[i] = interpolate(from[i], to[i]);\n  \t\t}\n\n  \t\t// surplus values - don't interpolate, but don't exclude them either\n  \t\tfor (i = len; i < from.length; i += 1) {\n  \t\t\tintermediate[i] = from[i];\n  \t\t}\n\n  \t\tfor (i = len; i < to.length; i += 1) {\n  \t\t\tintermediate[i] = to[i];\n  \t\t}\n\n  \t\treturn function (t) {\n  \t\t\tvar i = len;\n\n  \t\t\twhile (i--) {\n  \t\t\t\tintermediate[i] = interpolators[i](t);\n  \t\t\t}\n\n  \t\t\treturn intermediate;\n  \t\t};\n  \t},\n\n  \tobject: function (from, to) {\n  \t\tvar properties, len, interpolators, intermediate, prop;\n\n  \t\tif (!isObject(from) || !isObject(to)) {\n  \t\t\treturn null;\n  \t\t}\n\n  \t\tproperties = [];\n  \t\tintermediate = {};\n  \t\tinterpolators = {};\n\n  \t\tfor (prop in from) {\n  \t\t\tif (hasOwn.call(from, prop)) {\n  \t\t\t\tif (hasOwn.call(to, prop)) {\n  \t\t\t\t\tproperties.push(prop);\n  \t\t\t\t\tinterpolators[prop] = interpolate(from[prop], to[prop]) || snap(to[prop]);\n  \t\t\t\t} else {\n  \t\t\t\t\tintermediate[prop] = from[prop];\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\tfor (prop in to) {\n  \t\t\tif (hasOwn.call(to, prop) && !hasOwn.call(from, prop)) {\n  \t\t\t\tintermediate[prop] = to[prop];\n  \t\t\t}\n  \t\t}\n\n  \t\tlen = properties.length;\n\n  \t\treturn function (t) {\n  \t\t\tvar i = len,\n  \t\t\t    prop;\n\n  \t\t\twhile (i--) {\n  \t\t\t\tprop = properties[i];\n\n  \t\t\t\tintermediate[prop] = interpolators[prop](t);\n  \t\t\t}\n\n  \t\t\treturn intermediate;\n  \t\t};\n  \t}\n  };\n\n  var interpolators$1 = interpolators;\n\n  function interpolate(from, to, ractive, type) {\n  \tif (from === to) return null;\n\n  \tif (type) {\n  \t\tvar interpol = findInViewHierarchy('interpolators', ractive, type);\n  \t\tif (interpol) return interpol(from, to) || null;\n\n  \t\tfatal(missingPlugin(type, 'interpolator'));\n  \t}\n\n  \treturn interpolators$1.number(from, to) || interpolators$1.array(from, to) || interpolators$1.object(from, to) || null;\n  }\n\n  var unprefixPattern = new RegExp('^-(?:' + vendors.join('|') + ')-');\n\n  function unprefix (prop) {\n  \treturn prop.replace(unprefixPattern, '');\n  }\n\n  var vendorPattern = new RegExp('^(?:' + vendors.join('|') + ')([A-Z])');\n\n  function hyphenate (str) {\n  \tif (!str) return ''; // edge case\n\n  \tif (vendorPattern.test(str)) str = '-' + str;\n\n  \treturn str.replace(/[A-Z]/g, function (match) {\n  \t\treturn '-' + match.toLowerCase();\n  \t});\n  }\n\n  var createTransitions = undefined;\n\n  if (!isClient) {\n  \tcreateTransitions = null;\n  } else {\n  \t(function () {\n  \t\tvar testStyle = createElement('div').style;\n  \t\tvar linear = function (x) {\n  \t\t\treturn x;\n  \t\t};\n\n  \t\tvar canUseCssTransitions = {};\n  \t\tvar cannotUseCssTransitions = {};\n\n  \t\t// determine some facts about our environment\n  \t\tvar TRANSITION = undefined;\n  \t\tvar TRANSITIONEND = undefined;\n  \t\tvar CSS_TRANSITIONS_ENABLED = undefined;\n  \t\tvar TRANSITION_DURATION = undefined;\n  \t\tvar TRANSITION_PROPERTY = undefined;\n  \t\tvar TRANSITION_TIMING_FUNCTION = undefined;\n\n  \t\tif (testStyle.transition !== undefined) {\n  \t\t\tTRANSITION = 'transition';\n  \t\t\tTRANSITIONEND = 'transitionend';\n  \t\t\tCSS_TRANSITIONS_ENABLED = true;\n  \t\t} else if (testStyle.webkitTransition !== undefined) {\n  \t\t\tTRANSITION = 'webkitTransition';\n  \t\t\tTRANSITIONEND = 'webkitTransitionEnd';\n  \t\t\tCSS_TRANSITIONS_ENABLED = true;\n  \t\t} else {\n  \t\t\tCSS_TRANSITIONS_ENABLED = false;\n  \t\t}\n\n  \t\tif (TRANSITION) {\n  \t\t\tTRANSITION_DURATION = TRANSITION + 'Duration';\n  \t\t\tTRANSITION_PROPERTY = TRANSITION + 'Property';\n  \t\t\tTRANSITION_TIMING_FUNCTION = TRANSITION + 'TimingFunction';\n  \t\t}\n\n  \t\tcreateTransitions = function (t, to, options, changedProperties, resolve) {\n\n  \t\t\t// Wait a beat (otherwise the target styles will be applied immediately)\n  \t\t\t// TODO use a fastdom-style mechanism?\n  \t\t\tsetTimeout(function () {\n  \t\t\t\tvar jsTransitionsComplete = undefined;\n  \t\t\t\tvar cssTransitionsComplete = undefined;\n\n  \t\t\t\tfunction checkComplete() {\n  \t\t\t\t\tif (jsTransitionsComplete && cssTransitionsComplete) {\n  \t\t\t\t\t\t// will changes to events and fire have an unexpected consequence here?\n  \t\t\t\t\t\tt.ractive.fire(t.name + ':end', t.node, t.isIntro);\n  \t\t\t\t\t\tresolve();\n  \t\t\t\t\t}\n  \t\t\t\t}\n\n  \t\t\t\t// this is used to keep track of which elements can use CSS to animate\n  \t\t\t\t// which properties\n  \t\t\t\tvar hashPrefix = (t.node.namespaceURI || '') + t.node.tagName;\n\n  \t\t\t\tt.node.style[TRANSITION_PROPERTY] = changedProperties.map(prefix$1).map(hyphenate).join(',');\n  \t\t\t\tt.node.style[TRANSITION_TIMING_FUNCTION] = hyphenate(options.easing || 'linear');\n  \t\t\t\tt.node.style[TRANSITION_DURATION] = options.duration / 1000 + 's';\n\n  \t\t\t\tfunction transitionEndHandler(event) {\n  \t\t\t\t\tvar index = changedProperties.indexOf(camelCase(unprefix(event.propertyName)));\n  \t\t\t\t\tif (index !== -1) {\n  \t\t\t\t\t\tchangedProperties.splice(index, 1);\n  \t\t\t\t\t}\n\n  \t\t\t\t\tif (changedProperties.length) {\n  \t\t\t\t\t\t// still transitioning...\n  \t\t\t\t\t\treturn;\n  \t\t\t\t\t}\n\n  \t\t\t\t\tt.node.removeEventListener(TRANSITIONEND, transitionEndHandler, false);\n\n  \t\t\t\t\tcssTransitionsComplete = true;\n  \t\t\t\t\tcheckComplete();\n  \t\t\t\t}\n\n  \t\t\t\tt.node.addEventListener(TRANSITIONEND, transitionEndHandler, false);\n\n  \t\t\t\tsetTimeout(function () {\n  \t\t\t\t\tvar i = changedProperties.length;\n  \t\t\t\t\tvar hash = undefined;\n  \t\t\t\t\tvar originalValue = undefined;\n  \t\t\t\t\tvar index = undefined;\n  \t\t\t\t\tvar propertiesToTransitionInJs = [];\n  \t\t\t\t\tvar prop = undefined;\n  \t\t\t\t\tvar suffix = undefined;\n  \t\t\t\t\tvar interpolator = undefined;\n\n  \t\t\t\t\twhile (i--) {\n  \t\t\t\t\t\tprop = changedProperties[i];\n  \t\t\t\t\t\thash = hashPrefix + prop;\n\n  \t\t\t\t\t\tif (CSS_TRANSITIONS_ENABLED && !cannotUseCssTransitions[hash]) {\n  \t\t\t\t\t\t\tt.node.style[prefix$1(prop)] = to[prop];\n\n  \t\t\t\t\t\t\t// If we're not sure if CSS transitions are supported for\n  \t\t\t\t\t\t\t// this tag/property combo, find out now\n  \t\t\t\t\t\t\tif (!canUseCssTransitions[hash]) {\n  \t\t\t\t\t\t\t\toriginalValue = t.getStyle(prop);\n\n  \t\t\t\t\t\t\t\t// if this property is transitionable in this browser,\n  \t\t\t\t\t\t\t\t// the current style will be different from the target style\n  \t\t\t\t\t\t\t\tcanUseCssTransitions[hash] = t.getStyle(prop) != to[prop];\n  \t\t\t\t\t\t\t\tcannotUseCssTransitions[hash] = !canUseCssTransitions[hash];\n\n  \t\t\t\t\t\t\t\t// Reset, if we're going to use timers after all\n  \t\t\t\t\t\t\t\tif (cannotUseCssTransitions[hash]) {\n  \t\t\t\t\t\t\t\t\tt.node.style[prefix$1(prop)] = originalValue;\n  \t\t\t\t\t\t\t\t}\n  \t\t\t\t\t\t\t}\n  \t\t\t\t\t\t}\n\n  \t\t\t\t\t\tif (!CSS_TRANSITIONS_ENABLED || cannotUseCssTransitions[hash]) {\n  \t\t\t\t\t\t\t// we need to fall back to timer-based stuff\n  \t\t\t\t\t\t\tif (originalValue === undefined) {\n  \t\t\t\t\t\t\t\toriginalValue = t.getStyle(prop);\n  \t\t\t\t\t\t\t}\n\n  \t\t\t\t\t\t\t// need to remove this from changedProperties, otherwise transitionEndHandler\n  \t\t\t\t\t\t\t// will get confused\n  \t\t\t\t\t\t\tindex = changedProperties.indexOf(prop);\n  \t\t\t\t\t\t\tif (index === -1) {\n  \t\t\t\t\t\t\t\twarnIfDebug('Something very strange happened with transitions. Please raise an issue at https://github.com/ractivejs/ractive/issues - thanks!', { node: t.node });\n  \t\t\t\t\t\t\t} else {\n  \t\t\t\t\t\t\t\tchangedProperties.splice(index, 1);\n  \t\t\t\t\t\t\t}\n\n  \t\t\t\t\t\t\t// TODO Determine whether this property is animatable at all\n\n  \t\t\t\t\t\t\tsuffix = /[^\\d]*$/.exec(to[prop])[0];\n  \t\t\t\t\t\t\tinterpolator = interpolate(parseFloat(originalValue), parseFloat(to[prop])) || function () {\n  \t\t\t\t\t\t\t\treturn to[prop];\n  \t\t\t\t\t\t\t};\n\n  \t\t\t\t\t\t\t// ...then kick off a timer-based transition\n  \t\t\t\t\t\t\tpropertiesToTransitionInJs.push({\n  \t\t\t\t\t\t\t\tname: prefix$1(prop),\n  \t\t\t\t\t\t\t\tinterpolator: interpolator,\n  \t\t\t\t\t\t\t\tsuffix: suffix\n  \t\t\t\t\t\t\t});\n  \t\t\t\t\t\t}\n  \t\t\t\t\t}\n\n  \t\t\t\t\t// javascript transitions\n  \t\t\t\t\tif (propertiesToTransitionInJs.length) {\n  \t\t\t\t\t\tvar easing = undefined;\n\n  \t\t\t\t\t\tif (typeof options.easing === 'string') {\n  \t\t\t\t\t\t\teasing = t.ractive.easing[options.easing];\n\n  \t\t\t\t\t\t\tif (!easing) {\n  \t\t\t\t\t\t\t\twarnOnceIfDebug(missingPlugin(options.easing, 'easing'));\n  \t\t\t\t\t\t\t\teasing = linear;\n  \t\t\t\t\t\t\t}\n  \t\t\t\t\t\t} else if (typeof options.easing === 'function') {\n  \t\t\t\t\t\t\teasing = options.easing;\n  \t\t\t\t\t\t} else {\n  \t\t\t\t\t\t\teasing = linear;\n  \t\t\t\t\t\t}\n\n  \t\t\t\t\t\tnew Ticker({\n  \t\t\t\t\t\t\tduration: options.duration,\n  \t\t\t\t\t\t\teasing: easing,\n  \t\t\t\t\t\t\tstep: function (pos) {\n  \t\t\t\t\t\t\t\tvar i = propertiesToTransitionInJs.length;\n  \t\t\t\t\t\t\t\twhile (i--) {\n  \t\t\t\t\t\t\t\t\tvar _prop = propertiesToTransitionInJs[i];\n  \t\t\t\t\t\t\t\t\tt.node.style[_prop.name] = _prop.interpolator(pos) + _prop.suffix;\n  \t\t\t\t\t\t\t\t}\n  \t\t\t\t\t\t\t},\n  \t\t\t\t\t\t\tcomplete: function () {\n  \t\t\t\t\t\t\t\tjsTransitionsComplete = true;\n  \t\t\t\t\t\t\t\tcheckComplete();\n  \t\t\t\t\t\t\t}\n  \t\t\t\t\t\t});\n  \t\t\t\t\t} else {\n  \t\t\t\t\t\tjsTransitionsComplete = true;\n  \t\t\t\t\t}\n\n  \t\t\t\t\tif (!changedProperties.length) {\n  \t\t\t\t\t\t// We need to cancel the transitionEndHandler, and deal with\n  \t\t\t\t\t\t// the fact that it will never fire\n  \t\t\t\t\t\tt.node.removeEventListener(TRANSITIONEND, transitionEndHandler, false);\n  \t\t\t\t\t\tcssTransitionsComplete = true;\n  \t\t\t\t\t\tcheckComplete();\n  \t\t\t\t\t}\n  \t\t\t\t}, 0);\n  \t\t\t}, options.delay || 0);\n  \t\t};\n  \t})();\n  }\n\n  var createTransitions$1 = createTransitions;\n\n  function resetStyle(node, style) {\n  \tif (style) {\n  \t\tnode.setAttribute('style', style);\n  \t} else {\n  \t\t// Next line is necessary, to remove empty style attribute!\n  \t\t// See http://stackoverflow.com/a/7167553\n  \t\tnode.getAttribute('style');\n  \t\tnode.removeAttribute('style');\n  \t}\n  }\n\n  var getComputedStyle = win && (win.getComputedStyle || legacy.getComputedStyle);\n  var resolved = Promise$1.resolve();\n\n  var Transition = (function () {\n  \tfunction Transition(owner, template, isIntro) {\n  \t\tclassCallCheck(this, Transition);\n\n  \t\tthis.owner = owner;\n  \t\tthis.isIntro = isIntro;\n  \t\tthis.ractive = owner.ractive;\n\n  \t\tvar ractive = owner.ractive;\n\n  \t\tvar name = template.n || template;\n\n  \t\tif (typeof name !== 'string') {\n  \t\t\tvar fragment = new Fragment({\n  \t\t\t\towner: owner,\n  \t\t\t\ttemplate: name\n  \t\t\t}).bind(); // TODO need a way to capture values without bind()\n\n  \t\t\tname = fragment.toString();\n  \t\t\tfragment.unbind();\n\n  \t\t\tif (name === '') {\n  \t\t\t\t// empty string okay, just no transition\n  \t\t\t\treturn;\n  \t\t\t}\n  \t\t}\n\n  \t\tthis.name = name;\n\n  \t\tif (template.a) {\n  \t\t\tthis.params = template.a;\n  \t\t} else if (template.d) {\n  \t\t\t// TODO is there a way to interpret dynamic arguments without all the\n  \t\t\t// 'dependency thrashing'?\n  \t\t\tvar fragment = new Fragment({\n  \t\t\t\towner: owner,\n  \t\t\t\ttemplate: template.d\n  \t\t\t}).bind();\n\n  \t\t\tthis.params = fragment.getArgsList();\n  \t\t\tfragment.unbind();\n  \t\t}\n\n  \t\tthis._fn = findInViewHierarchy('transitions', ractive, name);\n\n  \t\tif (!this._fn) {\n  \t\t\twarnOnceIfDebug(missingPlugin(name, 'transition'), { ractive: ractive });\n  \t\t}\n  \t}\n\n  \tTransition.prototype.animateStyle = function animateStyle(style, value, options) {\n  \t\tvar _this = this;\n\n  \t\tif (arguments.length === 4) {\n  \t\t\tthrow new Error('t.animateStyle() returns a promise - use .then() instead of passing a callback');\n  \t\t}\n\n  \t\t// Special case - page isn't visible. Don't animate anything, because\n  \t\t// that way you'll never get CSS transitionend events\n  \t\tif (!visible) {\n  \t\t\tthis.setStyle(style, value);\n  \t\t\treturn resolved;\n  \t\t}\n\n  \t\tvar to = undefined;\n\n  \t\tif (typeof style === 'string') {\n  \t\t\tto = {};\n  \t\t\tto[style] = value;\n  \t\t} else {\n  \t\t\tto = style;\n\n  \t\t\t// shuffle arguments\n  \t\t\toptions = value;\n  \t\t}\n\n  \t\t// As of 0.3.9, transition authors should supply an `option` object with\n  \t\t// `duration` and `easing` properties (and optional `delay`), plus a\n  \t\t// callback function that gets called after the animation completes\n\n  \t\t// TODO remove this check in a future version\n  \t\tif (!options) {\n  \t\t\twarnOnceIfDebug('The \"%s\" transition does not supply an options object to `t.animateStyle()`. This will break in a future version of Ractive. For more info see https://github.com/RactiveJS/Ractive/issues/340', this.name);\n  \t\t\toptions = this;\n  \t\t}\n\n  \t\treturn new Promise$1(function (fulfil) {\n  \t\t\t// Edge case - if duration is zero, set style synchronously and complete\n  \t\t\tif (!options.duration) {\n  \t\t\t\t_this.setStyle(to);\n  \t\t\t\tfulfil();\n  \t\t\t\treturn;\n  \t\t\t}\n\n  \t\t\t// Get a list of the properties we're animating\n  \t\t\tvar propertyNames = Object.keys(to);\n  \t\t\tvar changedProperties = [];\n\n  \t\t\t// Store the current styles\n  \t\t\tvar computedStyle = getComputedStyle(_this.node);\n\n  \t\t\tvar i = propertyNames.length;\n  \t\t\twhile (i--) {\n  \t\t\t\tvar prop = propertyNames[i];\n  \t\t\t\tvar current = computedStyle[prefix$1(prop)];\n\n  \t\t\t\tif (current === '0px') current = 0;\n\n  \t\t\t\t// we need to know if we're actually changing anything\n  \t\t\t\tif (current != to[prop]) {\n  \t\t\t\t\t// use != instead of !==, so we can compare strings with numbers\n  \t\t\t\t\tchangedProperties.push(prop);\n\n  \t\t\t\t\t// make the computed style explicit, so we can animate where\n  \t\t\t\t\t// e.g. height='auto'\n  \t\t\t\t\t_this.node.style[prefix$1(prop)] = current;\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\t// If we're not actually changing anything, the transitionend event\n  \t\t\t// will never fire! So we complete early\n  \t\t\tif (!changedProperties.length) {\n  \t\t\t\tfulfil();\n  \t\t\t\treturn;\n  \t\t\t}\n\n  \t\t\tcreateTransitions$1(_this, to, options, changedProperties, fulfil);\n  \t\t});\n  \t};\n\n  \tTransition.prototype.getStyle = function getStyle(props) {\n  \t\tvar computedStyle = getComputedStyle(this.node);\n\n  \t\tif (typeof props === 'string') {\n  \t\t\tvar value = computedStyle[prefix$1(props)];\n  \t\t\treturn value === '0px' ? 0 : value;\n  \t\t}\n\n  \t\tif (!isArray(props)) {\n  \t\t\tthrow new Error('Transition$getStyle must be passed a string, or an array of strings representing CSS properties');\n  \t\t}\n\n  \t\tvar styles = {};\n\n  \t\tvar i = props.length;\n  \t\twhile (i--) {\n  \t\t\tvar prop = props[i];\n  \t\t\tvar value = computedStyle[prefix$1(prop)];\n\n  \t\t\tif (value === '0px') value = 0;\n  \t\t\tstyles[prop] = value;\n  \t\t}\n\n  \t\treturn styles;\n  \t};\n\n  \tTransition.prototype.processParams = function processParams(params, defaults) {\n  \t\tif (typeof params === 'number') {\n  \t\t\tparams = { duration: params };\n  \t\t} else if (typeof params === 'string') {\n  \t\t\tif (params === 'slow') {\n  \t\t\t\tparams = { duration: 600 };\n  \t\t\t} else if (params === 'fast') {\n  \t\t\t\tparams = { duration: 200 };\n  \t\t\t} else {\n  \t\t\t\tparams = { duration: 400 };\n  \t\t\t}\n  \t\t} else if (!params) {\n  \t\t\tparams = {};\n  \t\t}\n\n  \t\treturn extend({}, defaults, params);\n  \t};\n\n  \tTransition.prototype.setStyle = function setStyle(style, value) {\n  \t\tif (typeof style === 'string') {\n  \t\t\tthis.node.style[prefix$1(style)] = value;\n  \t\t} else {\n  \t\t\tvar prop = undefined;\n  \t\t\tfor (prop in style) {\n  \t\t\t\tif (style.hasOwnProperty(prop)) {\n  \t\t\t\t\tthis.node.style[prefix$1(prop)] = style[prop];\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\treturn this;\n  \t};\n\n  \tTransition.prototype.start = function start() {\n  \t\tvar _this2 = this;\n\n  \t\tvar node = this.node = this.owner.node;\n  \t\tvar originalStyle = node.getAttribute('style');\n\n  \t\tvar completed = undefined;\n\n  \t\t// create t.complete() - we don't want this on the prototype,\n  \t\t// because we don't want `this` silliness when passing it as\n  \t\t// an argument\n  \t\tthis.complete = function (noReset) {\n  \t\t\tif (completed) {\n  \t\t\t\treturn;\n  \t\t\t}\n\n  \t\t\tif (!noReset && _this2.isIntro) {\n  \t\t\t\tresetStyle(node, originalStyle);\n  \t\t\t}\n\n  \t\t\t_this2._manager.remove(_this2);\n\n  \t\t\tcompleted = true;\n  \t\t};\n\n  \t\t// If the transition function doesn't exist, abort\n  \t\tif (!this._fn) {\n  \t\t\tthis.complete();\n  \t\t\treturn;\n  \t\t}\n\n  \t\tthis._fn.apply(this.ractive, [this].concat(this.params));\n  \t};\n\n  \treturn Transition;\n  })();\n\n  function updateLiveQueries$1(element) {\n  \t// Does this need to be added to any live queries?\n  \tvar node = element.node;\n  \tvar instance = element.ractive;\n\n  \tdo {\n  \t\tvar liveQueries = instance._liveQueries;\n\n  \t\tvar i = liveQueries.length;\n  \t\twhile (i--) {\n  \t\t\tvar selector = liveQueries[i];\n  \t\t\tvar query = liveQueries[\"_\" + selector];\n\n  \t\t\tif (query.test(node)) {\n  \t\t\t\tquery.add(node);\n  \t\t\t\t// keep register of applicable selectors, for when we teardown\n  \t\t\t\telement.liveQueries.push(query);\n  \t\t\t}\n  \t\t}\n  \t} while (instance = instance.parent);\n  }\n\n  // TODO element.parent currently undefined\n  function findParentForm(element) {\n  \twhile (element = element.parent) {\n  \t\tif (element.name === 'form') {\n  \t\t\treturn element;\n  \t\t}\n  \t}\n  }\n\n  function warnAboutAmbiguity(description, ractive) {\n  \twarnOnceIfDebug('The ' + description + ' being used for two-way binding is ambiguous, and may cause unexpected results. Consider initialising your data to eliminate the ambiguity', { ractive: ractive });\n  }\n\n  var Binding = (function () {\n  \tfunction Binding(element) {\n  \t\tvar name = arguments.length <= 1 || arguments[1] === undefined ? 'value' : arguments[1];\n  \t\tclassCallCheck(this, Binding);\n\n  \t\tthis.element = element;\n  \t\tthis.ractive = element.ractive;\n  \t\tthis.attribute = element.attributeByName[name];\n\n  \t\tvar interpolator = this.attribute.interpolator;\n  \t\tinterpolator.twowayBinding = this;\n\n  \t\tvar model = interpolator.model;\n\n  \t\t// not bound?\n  \t\tif (!model) {\n  \t\t\t// try to force resolution\n  \t\t\tinterpolator.resolver.forceResolution();\n  \t\t\tmodel = interpolator.model;\n\n  \t\t\twarnAboutAmbiguity('\\'' + interpolator.template.r + '\\' reference', this.ractive);\n  \t\t} else if (model.isUnresolved) {\n  \t\t\t// reference expressions (e.g. foo[bar])\n  \t\t\tmodel.forceResolution();\n  \t\t\twarnAboutAmbiguity('expression', this.ractive);\n  \t\t}\n\n  \t\t// TODO include index/key/keypath refs as read-only\n  \t\telse if (model.isReadonly) {\n  \t\t\t\tvar keypath = model.getKeypath().replace(/^@/, '');\n  \t\t\t\twarnOnceIfDebug('Cannot use two-way binding on <' + element.name + '> element: ' + keypath + ' is read-only. To suppress this warning use <' + element.name + ' twoway=\\'false\\'...>', { ractive: this.ractive });\n  \t\t\t\treturn false;\n  \t\t\t}\n\n  \t\tthis.attribute.isTwoway = true;\n  \t\tthis.model = model;\n\n  \t\t// initialise value, if it's undefined\n  \t\tvar value = model.get();\n  \t\tthis.wasUndefined = value === undefined;\n\n  \t\tif (value === undefined && this.getInitialValue) {\n  \t\t\tvalue = this.getInitialValue();\n  \t\t\tmodel.set(value);\n  \t\t}\n\n  \t\tvar parentForm = findParentForm(element);\n  \t\tif (parentForm) {\n  \t\t\tthis.resetValue = value;\n  \t\t\tparentForm.formBindings.push(this);\n  \t\t}\n  \t}\n\n  \tBinding.prototype.bind = function bind() {\n  \t\tthis.model.registerTwowayBinding(this);\n  \t};\n\n  \tBinding.prototype.handleChange = function handleChange() {\n  \t\tvar _this = this;\n\n  \t\trunloop.start(this.root);\n  \t\tthis.attribute.locked = true;\n  \t\tthis.model.set(this.getValue());\n  \t\trunloop.scheduleTask(function () {\n  \t\t\treturn _this.attribute.locked = false;\n  \t\t});\n  \t\trunloop.end();\n  \t};\n\n  \tBinding.prototype.rebind = function rebind() {\n  \t\t// TODO what does this work with CheckboxNameBinding et al?\n  \t\tthis.unbind();\n  \t\tthis.model = this.attribute.interpolator.model;\n  \t\tthis.bind();\n  \t};\n\n  \tBinding.prototype.render = function render() {\n  \t\tthis.node = this.element.node;\n  \t\tthis.node._ractive.binding = this;\n  \t\tthis.rendered = true; // TODO is this used anywhere?\n  \t};\n\n  \tBinding.prototype.setFromNode = function setFromNode(node) {\n  \t\tthis.model.set(node.value);\n  \t};\n\n  \tBinding.prototype.unbind = function unbind() {\n  \t\tthis.model.unregisterTwowayBinding(this);\n  \t};\n\n  \tBinding.prototype.unrender = function unrender() {\n  \t\t// noop?\n  \t};\n\n  \treturn Binding;\n  })();\n\n  // This is the handler for DOM events that would lead to a change in the model\n  // (i.e. change, sometimes, input, and occasionally click and keyup)\n\n  function handleDomEvent() {\n  \tthis._ractive.binding.handleChange();\n  }\n\n  var CheckboxBinding = (function (_Binding) {\n  \tinherits(CheckboxBinding, _Binding);\n\n  \tfunction CheckboxBinding(element) {\n  \t\tclassCallCheck(this, CheckboxBinding);\n\n  \t\t_Binding.call(this, element, 'checked');\n  \t}\n\n  \tCheckboxBinding.prototype.render = function render() {\n  \t\t_Binding.prototype.render.call(this);\n\n  \t\tthis.node.addEventListener('change', handleDomEvent, false);\n\n  \t\tif (this.node.attachEvent) {\n  \t\t\tthis.node.addEventListener('click', handleDomEvent, false);\n  \t\t}\n  \t};\n\n  \tCheckboxBinding.prototype.unrender = function unrender() {\n  \t\tthis.node.removeEventListener('change', handleDomEvent, false);\n  \t\tthis.node.removeEventListener('click', handleDomEvent, false);\n  \t};\n\n  \tCheckboxBinding.prototype.getInitialValue = function getInitialValue() {\n  \t\treturn !!this.element.getAttribute('checked');\n  \t};\n\n  \tCheckboxBinding.prototype.getValue = function getValue() {\n  \t\treturn this.node.checked;\n  \t};\n\n  \tCheckboxBinding.prototype.setFromNode = function setFromNode(node) {\n  \t\tthis.model.set(node.checked);\n  \t};\n\n  \treturn CheckboxBinding;\n  })(Binding);\n\n  function getBindingGroup(group, model, getValue) {\n  \tvar hash = group + \"-bindingGroup\";\n  \treturn model[hash] || (model[hash] = new BindingGroup(hash, model, getValue));\n  }\n\n  var BindingGroup = (function () {\n  \tfunction BindingGroup(hash, model, getValue) {\n  \t\tvar _this = this;\n\n  \t\tclassCallCheck(this, BindingGroup);\n\n  \t\tthis.model = model;\n  \t\tthis.hash = hash;\n  \t\tthis.getValue = function () {\n  \t\t\t_this.value = getValue.call(_this);\n  \t\t\treturn _this.value;\n  \t\t};\n\n  \t\tthis.bindings = [];\n  \t}\n\n  \tBindingGroup.prototype.add = function add(binding) {\n  \t\tthis.bindings.push(binding);\n  \t};\n\n  \tBindingGroup.prototype.bind = function bind() {\n  \t\tthis.value = this.model.get();\n  \t\tthis.model.registerTwowayBinding(this);\n  \t\tthis.bound = true;\n  \t};\n\n  \tBindingGroup.prototype.remove = function remove(binding) {\n  \t\tremoveFromArray(this.bindings, binding);\n  \t\tif (!this.bindings.length) {\n  \t\t\tthis.unbind();\n  \t\t}\n  \t};\n\n  \tBindingGroup.prototype.unbind = function unbind() {\n  \t\tthis.model.unregisterTwowayBinding(this);\n  \t\tthis.bound = false;\n  \t\tdelete this.model[this.hash];\n  \t};\n\n  \treturn BindingGroup;\n  })();\n\n  var push$1 = [].push;\n\n  function getValue$1() {\n  \tvar all = this.bindings.filter(function (b) {\n  \t\treturn b.node && b.node.checked;\n  \t}).map(function (b) {\n  \t\treturn b.element.getAttribute('value');\n  \t});\n  \tvar res = [];\n  \tall.forEach(function (v) {\n  \t\tif (!arrayContains(res, v)) res.push(v);\n  \t});\n  \treturn res;\n  }\n\n  var CheckboxNameBinding = (function (_Binding) {\n  \tinherits(CheckboxNameBinding, _Binding);\n\n  \tfunction CheckboxNameBinding(element) {\n  \t\tclassCallCheck(this, CheckboxNameBinding);\n\n  \t\t_Binding.call(this, element, 'name');\n\n  \t\tthis.checkboxName = true; // so that ractive.updateModel() knows what to do with this\n\n  \t\t// Each input has a reference to an array containing it and its\n  \t\t// group, as two-way binding depends on being able to ascertain\n  \t\t// the status of all inputs within the group\n  \t\tthis.group = getBindingGroup('checkboxes', this.model, getValue$1);\n  \t\tthis.group.add(this);\n\n  \t\tif (this.noInitialValue) {\n  \t\t\tthis.group.noInitialValue = true;\n  \t\t}\n\n  \t\t// If no initial value was set, and this input is checked, we\n  \t\t// update the model\n  \t\tif (this.group.noInitialValue && this.element.getAttribute('checked')) {\n  \t\t\tvar existingValue = this.model.get();\n  \t\t\tvar bindingValue = this.element.getAttribute('value');\n\n  \t\t\tif (!arrayContains(existingValue, bindingValue)) {\n  \t\t\t\tpush$1.call(existingValue, bindingValue); // to avoid triggering runloop with array adaptor\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \tCheckboxNameBinding.prototype.bind = function bind() {\n  \t\tif (!this.group.bound) {\n  \t\t\tthis.group.bind();\n  \t\t}\n  \t};\n\n  \tCheckboxNameBinding.prototype.changed = function changed() {\n  \t\tvar wasChecked = !!this.isChecked;\n  \t\tthis.isChecked = this.node.checked;\n  \t\treturn this.isChecked === wasChecked;\n  \t};\n\n  \tCheckboxNameBinding.prototype.getInitialValue = function getInitialValue() {\n  \t\t// This only gets called once per group (of inputs that\n  \t\t// share a name), because it only gets called if there\n  \t\t// isn't an initial value. By the same token, we can make\n  \t\t// a note of that fact that there was no initial value,\n  \t\t// and populate it using any `checked` attributes that\n  \t\t// exist (which users should avoid, but which we should\n  \t\t// support anyway to avoid breaking expectations)\n  \t\tthis.noInitialValue = true; // TODO are noInitialValue and wasUndefined the same thing?\n  \t\treturn [];\n  \t};\n\n  \tCheckboxNameBinding.prototype.getValue = function getValue() {\n  \t\treturn this.group.value;\n  \t};\n\n  \tCheckboxNameBinding.prototype.handleChange = function handleChange() {\n  \t\tthis.isChecked = this.element.node.checked;\n  \t\tthis.group.value = this.model.get();\n  \t\tvar value = this.element.getAttribute('value');\n  \t\tif (this.isChecked && !arrayContains(this.group.value, value)) {\n  \t\t\tthis.group.value.push(value);\n  \t\t} else if (!this.isChecked && arrayContains(this.group.value, value)) {\n  \t\t\tremoveFromArray(this.group.value, value);\n  \t\t}\n  \t\t_Binding.prototype.handleChange.call(this);\n  \t};\n\n  \tCheckboxNameBinding.prototype.render = function render() {\n  \t\t_Binding.prototype.render.call(this);\n\n  \t\tvar node = this.node;\n\n  \t\tvar existingValue = this.model.get();\n  \t\tvar bindingValue = this.element.getAttribute('value');\n\n  \t\tif (isArray(existingValue)) {\n  \t\t\tthis.isChecked = arrayContains(existingValue, bindingValue);\n  \t\t} else {\n  \t\t\tthis.isChecked = existingValue == bindingValue;\n  \t\t}\n\n  \t\tnode.name = '{{' + this.model.getKeypath() + '}}';\n  \t\tnode.checked = this.isChecked;\n\n  \t\tnode.addEventListener('change', handleDomEvent, false);\n\n  \t\t// in case of IE emergency, bind to click event as well\n  \t\tif (node.attachEvent) {\n  \t\t\tnode.addEventListener('click', handleDomEvent, false);\n  \t\t}\n  \t};\n\n  \tCheckboxNameBinding.prototype.setFromNode = function setFromNode(node) {\n  \t\tthis.group.bindings.forEach(function (binding) {\n  \t\t\treturn binding.wasUndefined = true;\n  \t\t});\n\n  \t\tif (node.checked) {\n  \t\t\tvar valueSoFar = this.group.getValue();\n  \t\t\tvalueSoFar.push(this.element.getAttribute('value'));\n\n  \t\t\tthis.group.model.set(valueSoFar);\n  \t\t}\n  \t};\n\n  \tCheckboxNameBinding.prototype.unbind = function unbind() {\n  \t\tthis.group.remove(this);\n  \t};\n\n  \tCheckboxNameBinding.prototype.unrender = function unrender() {\n  \t\tvar node = this.element.node;\n\n  \t\tnode.removeEventListener('change', handleDomEvent, false);\n  \t\tnode.removeEventListener('click', handleDomEvent, false);\n  \t};\n\n  \treturn CheckboxNameBinding;\n  })(Binding);\n\n  var ContentEditableBinding = (function (_Binding) {\n  \tinherits(ContentEditableBinding, _Binding);\n\n  \tfunction ContentEditableBinding() {\n  \t\tclassCallCheck(this, ContentEditableBinding);\n\n  \t\t_Binding.apply(this, arguments);\n  \t}\n\n  \tContentEditableBinding.prototype.getInitialValue = function getInitialValue() {\n  \t\treturn this.element.fragment ? this.element.fragment.toString() : '';\n  \t};\n\n  \tContentEditableBinding.prototype.getValue = function getValue() {\n  \t\treturn this.element.node.innerHTML;\n  \t};\n\n  \tContentEditableBinding.prototype.render = function render() {\n  \t\t_Binding.prototype.render.call(this);\n\n  \t\tvar node = this.node;\n\n  \t\tnode.addEventListener('change', handleDomEvent, false);\n  \t\tnode.addEventListener('blur', handleDomEvent, false);\n\n  \t\tif (!this.ractive.lazy) {\n  \t\t\tnode.addEventListener('input', handleDomEvent, false);\n\n  \t\t\tif (node.attachEvent) {\n  \t\t\t\tnode.addEventListener('keyup', handleDomEvent, false);\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tContentEditableBinding.prototype.setFromNode = function setFromNode(node) {\n  \t\tthis.model.set(node.innerHTML);\n  \t};\n\n  \tContentEditableBinding.prototype.unrender = function unrender() {\n  \t\tvar node = this.node;\n\n  \t\tnode.removeEventListener('blur', handleDomEvent, false);\n  \t\tnode.removeEventListener('change', handleDomEvent, false);\n  \t\tnode.removeEventListener('input', handleDomEvent, false);\n  \t\tnode.removeEventListener('keyup', handleDomEvent, false);\n  \t};\n\n  \treturn ContentEditableBinding;\n  })(Binding);\n\n  function handleBlur() {\n  \thandleDomEvent.call(this);\n\n  \tvar value = this._ractive.binding.model.get();\n  \tthis.value = value == undefined ? '' : value;\n  }\n\n  function handleDelay(delay) {\n  \tvar timeout = undefined;\n\n  \treturn function () {\n  \t\tvar _this = this;\n\n  \t\tif (timeout) clearTimeout(timeout);\n\n  \t\ttimeout = setTimeout(function () {\n  \t\t\tvar binding = _this._ractive.binding;\n  \t\t\tif (binding.rendered) handleDomEvent.call(_this);\n  \t\t\ttimeout = null;\n  \t\t}, delay);\n  \t};\n  }\n\n  var GenericBinding = (function (_Binding) {\n  \tinherits(GenericBinding, _Binding);\n\n  \tfunction GenericBinding() {\n  \t\tclassCallCheck(this, GenericBinding);\n\n  \t\t_Binding.apply(this, arguments);\n  \t}\n\n  \tGenericBinding.prototype.getInitialValue = function getInitialValue() {\n  \t\treturn '';\n  \t};\n\n  \tGenericBinding.prototype.getValue = function getValue() {\n  \t\treturn this.node.value;\n  \t};\n\n  \tGenericBinding.prototype.render = function render() {\n  \t\t_Binding.prototype.render.call(this);\n\n  \t\t// any lazy setting for this element overrides the root\n  \t\t// if the value is a number, it's a timeout\n  \t\tvar lazy = this.ractive.lazy;\n  \t\tvar timeout = false;\n\n  \t\t// TODO handle at parse time\n  \t\tif (this.element.template.a && 'lazy' in this.element.template.a) {\n  \t\t\tlazy = this.element.template.a.lazy;\n  \t\t\tif (lazy === 0) lazy = true; // empty attribute\n  \t\t}\n\n  \t\t// TODO handle this at parse time as well?\n  \t\tif (lazy === 'false') lazy = false;\n\n  \t\tif (isNumeric(lazy)) {\n  \t\t\ttimeout = +lazy;\n  \t\t\tlazy = false;\n  \t\t}\n\n  \t\tthis.handler = timeout ? handleDelay(timeout) : handleDomEvent;\n\n  \t\tvar node = this.node;\n\n  \t\tnode.addEventListener('change', handleDomEvent, false);\n\n  \t\tif (!lazy) {\n  \t\t\tnode.addEventListener('input', this.handler, false);\n\n  \t\t\tif (node.attachEvent) {\n  \t\t\t\tnode.addEventListener('keyup', this.handler, false);\n  \t\t\t}\n  \t\t}\n\n  \t\tnode.addEventListener('blur', handleBlur, false);\n  \t};\n\n  \tGenericBinding.prototype.unrender = function unrender() {\n  \t\tvar node = this.element.node;\n  \t\tthis.rendered = false;\n\n  \t\tnode.removeEventListener('change', handleDomEvent, false);\n  \t\tnode.removeEventListener('input', this.handler, false);\n  \t\tnode.removeEventListener('keyup', this.handler, false);\n  \t\tnode.removeEventListener('blur', handleBlur, false);\n  \t};\n\n  \treturn GenericBinding;\n  })(Binding);\n\n  var MultipleSelectBinding = (function (_Binding) {\n  \tinherits(MultipleSelectBinding, _Binding);\n\n  \tfunction MultipleSelectBinding() {\n  \t\tclassCallCheck(this, MultipleSelectBinding);\n\n  \t\t_Binding.apply(this, arguments);\n  \t}\n\n  \tMultipleSelectBinding.prototype.forceUpdate = function forceUpdate() {\n  \t\tvar _this = this;\n\n  \t\tvar value = this.getValue();\n\n  \t\tif (value !== undefined) {\n  \t\t\tthis.attribute.locked = true;\n  \t\t\trunloop.scheduleTask(function () {\n  \t\t\t\treturn _this.attribute.locked = false;\n  \t\t\t});\n  \t\t\tthis.model.set(value);\n  \t\t}\n  \t};\n\n  \tMultipleSelectBinding.prototype.getInitialValue = function getInitialValue() {\n  \t\treturn this.element.options.filter(function (option) {\n  \t\t\treturn option.getAttribute('selected');\n  \t\t}).map(function (option) {\n  \t\t\treturn option.getAttribute('value');\n  \t\t});\n  \t};\n\n  \tMultipleSelectBinding.prototype.getValue = function getValue() {\n  \t\tvar options = this.element.node.options;\n  \t\tvar len = options.length;\n\n  \t\tvar selectedValues = [];\n\n  \t\tfor (var i = 0; i < len; i += 1) {\n  \t\t\tvar option = options[i];\n\n  \t\t\tif (option.selected) {\n  \t\t\t\tvar optionValue = option._ractive ? option._ractive.value : option.value;\n  \t\t\t\tselectedValues.push(optionValue);\n  \t\t\t}\n  \t\t}\n\n  \t\treturn selectedValues;\n  \t};\n\n  \tMultipleSelectBinding.prototype.handleChange = function handleChange() {\n  \t\tvar attribute = this.attribute;\n  \t\tvar previousValue = attribute.getValue();\n\n  \t\tvar value = this.getValue();\n\n  \t\tif (previousValue === undefined || !arrayContentsMatch(value, previousValue)) {\n  \t\t\t_Binding.prototype.handleChange.call(this);\n  \t\t}\n\n  \t\treturn this;\n  \t};\n\n  \tMultipleSelectBinding.prototype.render = function render() {\n  \t\t_Binding.prototype.render.call(this);\n\n  \t\tthis.node.addEventListener('change', handleDomEvent, false);\n\n  \t\tif (this.model.get() === undefined) {\n  \t\t\t// get value from DOM, if possible\n  \t\t\tthis.handleChange();\n  \t\t}\n  \t};\n\n  \tMultipleSelectBinding.prototype.setFromNode = function setFromNode(node) {\n  \t\tvar i = node.selectedOptions.length;\n  \t\tvar result = new Array(i);\n\n  \t\twhile (i--) {\n  \t\t\tvar option = node.selectedOptions[i];\n  \t\t\tresult[i] = option._ractive ? option._ractive.value : option.value;\n  \t\t}\n\n  \t\tthis.model.set(result);\n  \t};\n\n  \tMultipleSelectBinding.prototype.setValue = function setValue() {\n  \t\tthrow new Error('TODO not implemented yet');\n  \t};\n\n  \tMultipleSelectBinding.prototype.unrender = function unrender() {\n  \t\tthis.node.removeEventListener('change', handleDomEvent, false);\n  \t};\n\n  \tMultipleSelectBinding.prototype.updateModel = function updateModel() {\n  \t\tif (this.attribute.value === undefined || !this.attribute.value.length) {\n  \t\t\tthis.keypath.set(this.initialValue);\n  \t\t}\n  \t};\n\n  \treturn MultipleSelectBinding;\n  })(Binding);\n\n  var NumericBinding = (function (_GenericBinding) {\n  \tinherits(NumericBinding, _GenericBinding);\n\n  \tfunction NumericBinding() {\n  \t\tclassCallCheck(this, NumericBinding);\n\n  \t\t_GenericBinding.apply(this, arguments);\n  \t}\n\n  \tNumericBinding.prototype.getInitialValue = function getInitialValue() {\n  \t\treturn undefined;\n  \t};\n\n  \tNumericBinding.prototype.getValue = function getValue() {\n  \t\tvar value = parseFloat(this.node.value);\n  \t\treturn isNaN(value) ? undefined : value;\n  \t};\n\n  \tNumericBinding.prototype.setFromNode = function setFromNode(node) {\n  \t\tvar value = parseFloat(node.value);\n  \t\tif (!isNaN(value)) this.model.set(value);\n  \t};\n\n  \treturn NumericBinding;\n  })(GenericBinding);\n\n  var siblings = {};\n\n  function getSiblings(hash) {\n  \treturn siblings[hash] || (siblings[hash] = []);\n  }\n\n  var RadioBinding = (function (_Binding) {\n  \tinherits(RadioBinding, _Binding);\n\n  \tfunction RadioBinding(element) {\n  \t\tclassCallCheck(this, RadioBinding);\n\n  \t\t_Binding.call(this, element, 'checked');\n\n  \t\tthis.siblings = getSiblings(this.ractive._guid + this.element.getAttribute('name'));\n  \t\tthis.siblings.push(this);\n  \t}\n\n  \tRadioBinding.prototype.getValue = function getValue() {\n  \t\treturn this.node.checked;\n  \t};\n\n  \tRadioBinding.prototype.handleChange = function handleChange() {\n  \t\trunloop.start(this.root);\n\n  \t\tthis.siblings.forEach(function (binding) {\n  \t\t\tbinding.model.set(binding.getValue());\n  \t\t});\n\n  \t\trunloop.end();\n  \t};\n\n  \tRadioBinding.prototype.render = function render() {\n  \t\t_Binding.prototype.render.call(this);\n\n  \t\tthis.node.addEventListener('change', handleDomEvent, false);\n\n  \t\tif (this.node.attachEvent) {\n  \t\t\tthis.node.addEventListener('click', handleDomEvent, false);\n  \t\t}\n  \t};\n\n  \tRadioBinding.prototype.setFromNode = function setFromNode(node) {\n  \t\tthis.model.set(node.checked);\n  \t};\n\n  \tRadioBinding.prototype.unbind = function unbind() {\n  \t\tremoveFromArray(this.siblings, this);\n  \t};\n\n  \tRadioBinding.prototype.unrender = function unrender() {\n  \t\tthis.node.removeEventListener('change', handleDomEvent, false);\n  \t\tthis.node.removeEventListener('click', handleDomEvent, false);\n  \t};\n\n  \treturn RadioBinding;\n  })(Binding);\n\n  function getValue$2() {\n  \tvar checked = this.bindings.filter(function (b) {\n  \t\treturn b.node.checked;\n  \t});\n  \tif (checked.length > 0) {\n  \t\treturn checked[0].element.getAttribute('value');\n  \t}\n  }\n\n  var RadioNameBinding = (function (_Binding) {\n  \tinherits(RadioNameBinding, _Binding);\n\n  \tfunction RadioNameBinding(element) {\n  \t\tclassCallCheck(this, RadioNameBinding);\n\n  \t\t_Binding.call(this, element, 'name');\n\n  \t\tthis.group = getBindingGroup('radioname', this.model, getValue$2);\n  \t\tthis.group.add(this);\n\n  \t\tif (element.checked) {\n  \t\t\tthis.group.value = this.getValue();\n  \t\t}\n  \t}\n\n  \tRadioNameBinding.prototype.bind = function bind() {\n  \t\tvar _this = this;\n\n  \t\tif (!this.group.bound) {\n  \t\t\tthis.group.bind();\n  \t\t}\n\n  \t\t// update name keypath when necessary\n  \t\tthis.nameAttributeBinding = {\n  \t\t\thandleChange: function () {\n  \t\t\t\treturn _this.node.name = '{{' + _this.model.getKeypath() + '}}';\n  \t\t\t}\n  \t\t};\n\n  \t\tthis.model.getKeypathModel().register(this.nameAttributeBinding);\n  \t};\n\n  \tRadioNameBinding.prototype.getInitialValue = function getInitialValue() {\n  \t\tif (this.element.getAttribute('checked')) {\n  \t\t\treturn this.element.getAttribute('value');\n  \t\t}\n  \t};\n\n  \tRadioNameBinding.prototype.getValue = function getValue() {\n  \t\treturn this.element.getAttribute('value');\n  \t};\n\n  \tRadioNameBinding.prototype.handleChange = function handleChange() {\n  \t\t// If this <input> is the one that's checked, then the value of its\n  \t\t// `name` model gets set to its value\n  \t\tif (this.node.checked) {\n  \t\t\tthis.group.value = this.getValue();\n  \t\t\t_Binding.prototype.handleChange.call(this);\n  \t\t}\n  \t};\n\n  \tRadioNameBinding.prototype.render = function render() {\n  \t\t_Binding.prototype.render.call(this);\n\n  \t\tvar node = this.node;\n\n  \t\tnode.name = '{{' + this.model.getKeypath() + '}}';\n  \t\tnode.checked = this.model.get() == this.element.getAttribute('value');\n\n  \t\tnode.addEventListener('change', handleDomEvent, false);\n\n  \t\tif (node.attachEvent) {\n  \t\t\tnode.addEventListener('click', handleDomEvent, false);\n  \t\t}\n  \t};\n\n  \tRadioNameBinding.prototype.setFromNode = function setFromNode(node) {\n  \t\tif (node.checked) {\n  \t\t\tthis.group.model.set(this.element.getAttribute('value'));\n  \t\t}\n  \t};\n\n  \tRadioNameBinding.prototype.unbind = function unbind() {\n  \t\tthis.group.remove(this);\n\n  \t\tthis.model.getKeypathModel().unregister(this.nameAttributeBinding);\n  \t};\n\n  \tRadioNameBinding.prototype.unrender = function unrender() {\n  \t\tvar node = this.node;\n\n  \t\tnode.removeEventListener('change', handleDomEvent, false);\n  \t\tnode.removeEventListener('click', handleDomEvent, false);\n  \t};\n\n  \treturn RadioNameBinding;\n  })(Binding);\n\n  var SingleSelectBinding = (function (_Binding) {\n  \tinherits(SingleSelectBinding, _Binding);\n\n  \tfunction SingleSelectBinding() {\n  \t\tclassCallCheck(this, SingleSelectBinding);\n\n  \t\t_Binding.apply(this, arguments);\n  \t}\n\n  \tSingleSelectBinding.prototype.forceUpdate = function forceUpdate() {\n  \t\tvar _this = this;\n\n  \t\tvar value = this.getValue();\n\n  \t\tif (value !== undefined) {\n  \t\t\tthis.attribute.locked = true;\n  \t\t\trunloop.scheduleTask(function () {\n  \t\t\t\treturn _this.attribute.locked = false;\n  \t\t\t});\n  \t\t\tthis.model.set(value);\n  \t\t}\n  \t};\n\n  \tSingleSelectBinding.prototype.getInitialValue = function getInitialValue() {\n  \t\tif (this.element.getAttribute('value') !== undefined) {\n  \t\t\treturn;\n  \t\t}\n\n  \t\tvar options = this.element.options;\n  \t\tvar len = options.length;\n\n  \t\tif (!len) return;\n\n  \t\tvar value = undefined;\n  \t\tvar optionWasSelected = undefined;\n  \t\tvar i = len;\n\n  \t\t// take the final selected option...\n  \t\twhile (i--) {\n  \t\t\tvar option = options[i];\n\n  \t\t\tif (option.getAttribute('selected')) {\n  \t\t\t\tif (!option.getAttribute('disabled')) {\n  \t\t\t\t\tvalue = option.getAttribute('value');\n  \t\t\t\t}\n\n  \t\t\t\toptionWasSelected = true;\n  \t\t\t\tbreak;\n  \t\t\t}\n  \t\t}\n\n  \t\t// or the first non-disabled option, if none are selected\n  \t\tif (!optionWasSelected) {\n  \t\t\twhile (++i < len) {\n  \t\t\t\tif (!options[i].getAttribute('disabled')) {\n  \t\t\t\t\tvalue = options[i].getAttribute('value');\n  \t\t\t\t\tbreak;\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\t// This is an optimisation (aka hack) that allows us to forgo some\n  \t\t// other more expensive work\n  \t\t// TODO does it still work? seems at odds with new architecture\n  \t\tif (value !== undefined) {\n  \t\t\tthis.element.attributeByName.value.value = value;\n  \t\t}\n\n  \t\treturn value;\n  \t};\n\n  \tSingleSelectBinding.prototype.getValue = function getValue() {\n  \t\tvar options = this.node.options;\n  \t\tvar len = options.length;\n\n  \t\tvar i = undefined;\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tvar option = options[i];\n\n  \t\t\tif (options[i].selected && !options[i].disabled) {\n  \t\t\t\treturn option._ractive ? option._ractive.value : option.value;\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tSingleSelectBinding.prototype.render = function render() {\n  \t\t_Binding.prototype.render.call(this);\n  \t\tthis.node.addEventListener('change', handleDomEvent, false);\n  \t};\n\n  \tSingleSelectBinding.prototype.setFromNode = function setFromNode(node) {\n  \t\tvar option = node.selectedOptions[0];\n  \t\tthis.model.set(option._ractive ? option._ractive.value : option.value);\n  \t};\n\n  \t// TODO this method is an anomaly... is it necessary?\n\n  \tSingleSelectBinding.prototype.setValue = function setValue(value) {\n  \t\tthis.model.set(value);\n  \t};\n\n  \tSingleSelectBinding.prototype.unrender = function unrender() {\n  \t\tthis.node.removeEventListener('change', handleDomEvent, false);\n  \t};\n\n  \treturn SingleSelectBinding;\n  })(Binding);\n\n  function isBindable(attribute) {\n  \treturn attribute && attribute.template.length === 1 && attribute.template[0].t === INTERPOLATOR && !attribute.template[0].s;\n  }\n\n  function selectBinding(element) {\n  \tvar attributes = element.attributeByName;\n\n  \t// contenteditable - bind if the contenteditable attribute is true\n  \t// or is bindable and may thus become true...\n  \tif (element.getAttribute('contenteditable') || isBindable(attributes.contenteditable)) {\n  \t\t// ...and this element also has a value attribute to bind\n  \t\treturn isBindable(attributes.value) ? ContentEditableBinding : null;\n  \t}\n\n  \t// <input>\n  \tif (element.name === 'input') {\n  \t\tvar type = element.getAttribute('type');\n\n  \t\tif (type === 'radio' || type === 'checkbox') {\n  \t\t\tvar bindName = isBindable(attributes.name);\n  \t\t\tvar bindChecked = isBindable(attributes.checked);\n\n  \t\t\t// for radios we can either bind the name attribute, or the checked attribute - not both\n  \t\t\tif (bindName && bindChecked) {\n  \t\t\t\tif (type === 'radio') {\n  \t\t\t\t\twarnIfDebug('A radio input can have two-way binding on its name attribute, or its checked attribute - not both', { ractive: element.root });\n  \t\t\t\t} else {\n  \t\t\t\t\t// A checkbox with bindings for both name and checked - see https://github.com/ractivejs/ractive/issues/1749\n  \t\t\t\t\treturn CheckboxBinding;\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\tif (bindName) {\n  \t\t\t\treturn type === 'radio' ? RadioNameBinding : CheckboxNameBinding;\n  \t\t\t}\n\n  \t\t\tif (bindChecked) {\n  \t\t\t\treturn type === 'radio' ? RadioBinding : CheckboxBinding;\n  \t\t\t}\n  \t\t}\n\n  \t\tif (type === 'file' && isBindable(attributes.value)) {\n  \t\t\treturn Binding;\n  \t\t}\n\n  \t\tif (isBindable(attributes.value)) {\n  \t\t\treturn type === 'number' || type === 'range' ? NumericBinding : GenericBinding;\n  \t\t}\n\n  \t\treturn null;\n  \t}\n\n  \t// <select>\n  \tif (element.name === 'select' && isBindable(attributes.value)) {\n  \t\treturn element.getAttribute('multiple') ? MultipleSelectBinding : SingleSelectBinding;\n  \t}\n\n  \t// <textarea>\n  \tif (element.name === 'textarea' && isBindable(attributes.value)) {\n  \t\treturn GenericBinding;\n  \t}\n  }\n\n  function makeDirty$1(query) {\n  \tquery.makeDirty();\n  }\n\n  var Element = (function (_Item) {\n  \tinherits(Element, _Item);\n\n  \tfunction Element(options) {\n  \t\tvar _this = this;\n\n  \t\tclassCallCheck(this, Element);\n\n  \t\t_Item.call(this, options);\n\n  \t\tthis.liveQueries = []; // TODO rare case. can we handle differently?\n\n  \t\tthis.name = options.template.e.toLowerCase();\n  \t\tthis.isVoid = voidElementNames.test(this.name);\n\n  \t\t// find parent element\n  \t\tvar fragment = this.parentFragment;\n  \t\twhile (fragment) {\n  \t\t\tif (fragment.owner.type === ELEMENT) {\n  \t\t\t\tthis.parent = fragment.owner;\n  \t\t\t\tbreak;\n  \t\t\t}\n  \t\t\tfragment = fragment.parent;\n  \t\t}\n\n  \t\tif (this.parent && this.parent.name === 'option') {\n  \t\t\tthrow new Error('An <option> element cannot contain other elements (encountered <' + this.name + '>)');\n  \t\t}\n\n  \t\t// create attributes\n  \t\tthis.attributeByName = {};\n  \t\tthis.attributes = [];\n\n  \t\tif (this.template.a) {\n  \t\t\tObject.keys(this.template.a).forEach(function (name) {\n  \t\t\t\t// TODO process this at parse time\n  \t\t\t\tif (name === 'twoway' || name === 'lazy') return;\n\n  \t\t\t\tvar attribute = new Attribute({\n  \t\t\t\t\tname: name,\n  \t\t\t\t\telement: _this,\n  \t\t\t\t\tparentFragment: _this.parentFragment,\n  \t\t\t\t\ttemplate: _this.template.a[name]\n  \t\t\t\t});\n\n  \t\t\t\t_this.attributeByName[name] = attribute;\n\n  \t\t\t\tif (name !== 'value' && name !== 'type') _this.attributes.push(attribute);\n  \t\t\t});\n\n  \t\t\tif (this.attributeByName.type) this.attributes.unshift(this.attributeByName.type);\n  \t\t\tif (this.attributeByName.value) this.attributes.push(this.attributeByName.value);\n  \t\t}\n\n  \t\t// create conditional attributes\n  \t\tthis.conditionalAttributes = (this.template.m || []).map(function (template) {\n  \t\t\treturn new ConditionalAttribute({\n  \t\t\t\towner: _this,\n  \t\t\t\tparentFragment: _this.parentFragment,\n  \t\t\t\ttemplate: template\n  \t\t\t});\n  \t\t});\n\n  \t\t// create decorator\n  \t\tif (this.template.o) {\n  \t\t\tthis.decorator = new Decorator(this, this.template.o);\n  \t\t}\n\n  \t\t// attach event handlers\n  \t\tthis.eventHandlers = [];\n  \t\tif (this.template.v) {\n  \t\t\tObject.keys(this.template.v).forEach(function (key) {\n  \t\t\t\tvar eventNames = key.split('-');\n  \t\t\t\tvar template = _this.template.v[key];\n\n  \t\t\t\teventNames.forEach(function (eventName) {\n  \t\t\t\t\tvar fn = findInViewHierarchy('events', _this.ractive, eventName);\n  \t\t\t\t\t// we need to pass in \"this\" in order to get\n  \t\t\t\t\t// access to node when it is created.\n  \t\t\t\t\tvar event = fn ? new CustomEvent(fn, _this) : new DOMEvent(eventName, _this);\n  \t\t\t\t\t_this.eventHandlers.push(new EventDirective(_this, event, template));\n  \t\t\t\t});\n  \t\t\t});\n  \t\t}\n\n  \t\t// create children\n  \t\tif (options.template.f && !options.noContent) {\n  \t\t\tthis.fragment = new Fragment({\n  \t\t\t\ttemplate: options.template.f,\n  \t\t\t\towner: this,\n  \t\t\t\tcssIds: null\n  \t\t\t});\n  \t\t}\n\n  \t\tthis.binding = null; // filled in later\n  \t}\n\n  \tElement.prototype.bind = function bind() {\n  \t\tthis.attributes.forEach(_bind);\n  \t\tthis.conditionalAttributes.forEach(_bind);\n  \t\tthis.eventHandlers.forEach(_bind);\n\n  \t\tif (this.decorator) this.decorator.bind();\n  \t\tif (this.fragment) this.fragment.bind();\n\n  \t\t// create two-way binding if necessary\n  \t\tif (this.binding = this.createTwowayBinding()) this.binding.bind();\n  \t};\n\n  \tElement.prototype.createTwowayBinding = function createTwowayBinding() {\n  \t\tvar attributes = this.template.a;\n\n  \t\tif (!attributes) return null;\n\n  \t\tvar shouldBind = 'twoway' in attributes ? attributes.twoway === 0 || attributes.twoway === 'true' : // covers `twoway` and `twoway='true'`\n  \t\tthis.ractive.twoway;\n\n  \t\tif (!shouldBind) return null;\n\n  \t\tvar Binding = selectBinding(this);\n\n  \t\tif (!Binding) return null;\n\n  \t\tvar binding = new Binding(this);\n\n  \t\treturn binding && binding.model ? binding : null;\n  \t};\n\n  \tElement.prototype.detach = function detach() {\n  \t\tif (this.decorator) this.decorator.unrender();\n  \t\treturn detachNode(this.node);\n  \t};\n\n  \tElement.prototype.find = function find(selector) {\n  \t\tif (matches(this.node, selector)) return this.node;\n  \t\tif (this.fragment) {\n  \t\t\treturn this.fragment.find(selector);\n  \t\t}\n  \t};\n\n  \tElement.prototype.findAll = function findAll(selector, query) {\n  \t\t// Add this node to the query, if applicable, and register the\n  \t\t// query on this element\n  \t\tvar matches = query.test(this.node);\n  \t\tif (matches) {\n  \t\t\tquery.add(this.node);\n  \t\t\tif (query.live) this.liveQueries.push(query);\n  \t\t}\n\n  \t\tif (this.fragment) {\n  \t\t\tthis.fragment.findAll(selector, query);\n  \t\t}\n  \t};\n\n  \tElement.prototype.findComponent = function findComponent(name) {\n  \t\tif (this.fragment) {\n  \t\t\treturn this.fragment.findComponent(name);\n  \t\t}\n  \t};\n\n  \tElement.prototype.findAllComponents = function findAllComponents(name, query) {\n  \t\tif (this.fragment) {\n  \t\t\tthis.fragment.findAllComponents(name, query);\n  \t\t}\n  \t};\n\n  \tElement.prototype.findNextNode = function findNextNode() {\n  \t\treturn null;\n  \t};\n\n  \tElement.prototype.firstNode = function firstNode() {\n  \t\treturn this.node;\n  \t};\n\n  \tElement.prototype.getAttribute = function getAttribute(name) {\n  \t\tvar attribute = this.attributeByName[name];\n  \t\treturn attribute ? attribute.getValue() : undefined;\n  \t};\n\n  \tElement.prototype.rebind = function rebind() {\n  \t\tthis.attributes.forEach(_rebind);\n  \t\tthis.conditionalAttributes.forEach(_rebind);\n  \t\tthis.eventHandlers.forEach(_rebind);\n  \t\tif (this.decorator) this.decorator.rebind();\n  \t\tif (this.fragment) this.fragment.rebind();\n  \t\tif (this.binding) this.binding.rebind();\n\n  \t\tthis.liveQueries.forEach(makeDirty$1);\n  \t};\n\n  \tElement.prototype.render = function render(target, occupants) {\n  \t\tvar _this2 = this;\n\n  \t\t// TODO determine correct namespace\n  \t\tthis.namespace = getNamespace(this);\n\n  \t\tvar node = undefined;\n  \t\tvar existing = false;\n\n  \t\tif (occupants) {\n  \t\t\tvar n = undefined;\n  \t\t\twhile (n = occupants.shift()) {\n  \t\t\t\tif (n.nodeName === this.template.e.toUpperCase() && n.namespaceURI === this.namespace) {\n  \t\t\t\t\tthis.node = node = n;\n  \t\t\t\t\texisting = true;\n  \t\t\t\t\tbreak;\n  \t\t\t\t} else {\n  \t\t\t\t\tdetachNode(n);\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\tif (!node) {\n  \t\t\tnode = createElement(this.template.e, this.namespace, this.getAttribute('is'));\n  \t\t\tthis.node = node;\n  \t\t}\n\n  \t\tdefineProperty(node, '_ractive', {\n  \t\t\tvalue: {\n  \t\t\t\tproxy: this,\n  \t\t\t\tfragment: this.parentFragment\n  \t\t\t}\n  \t\t});\n\n  \t\t// Is this a top-level node of a component? If so, we may need to add\n  \t\t// a data-ractive-css attribute, for CSS encapsulation\n  \t\tif (this.parentFragment.cssIds) {\n  \t\t\tnode.setAttribute('data-ractive-css', this.parentFragment.cssIds.map(function (x) {\n  \t\t\t\treturn '{' + x + '}';\n  \t\t\t}).join(' '));\n  \t\t}\n\n  \t\tif (existing && this.foundNode) this.foundNode(node);\n\n  \t\tif (this.fragment) {\n  \t\t\tvar children = existing ? toArray(node.childNodes) : undefined;\n  \t\t\tthis.fragment.render(node, children);\n\n  \t\t\t// clean up leftover children\n  \t\t\tif (children) {\n  \t\t\t\tchildren.forEach(detachNode);\n  \t\t\t}\n  \t\t}\n\n  \t\tif (existing) {\n  \t\t\t// store initial values for two-way binding\n  \t\t\tif (this.binding && this.binding.wasUndefined) this.binding.setFromNode(node);\n\n  \t\t\t// remove unused attributes\n  \t\t\tvar i = node.attributes.length;\n  \t\t\twhile (i--) {\n  \t\t\t\tvar _name = node.attributes[i].name;\n  \t\t\t\tif (!this.template.a || !(_name in this.template.a)) node.removeAttribute(_name);\n  \t\t\t}\n  \t\t}\n\n  \t\tthis.attributes.forEach(_render);\n  \t\tthis.conditionalAttributes.forEach(_render);\n\n  \t\tif (this.decorator) runloop.scheduleTask(function () {\n  \t\t\treturn _this2.decorator.render();\n  \t\t}, true);\n  \t\tif (this.binding) this.binding.render();\n\n  \t\tthis.eventHandlers.forEach(_render);\n\n  \t\tupdateLiveQueries$1(this);\n\n  \t\t// transitions\n  \t\tvar transitionTemplate = this.template.t0 || this.template.t1;\n  \t\tif (transitionTemplate && this.ractive.transitionsEnabled) {\n  \t\t\tvar transition = new Transition(this, transitionTemplate, true);\n  \t\t\trunloop.registerTransition(transition);\n\n  \t\t\tthis._introTransition = transition; // so we can abort if it gets removed\n  \t\t}\n\n  \t\tif (!existing) {\n  \t\t\ttarget.appendChild(node);\n  \t\t}\n\n  \t\tthis.rendered = true;\n  \t};\n\n  \tElement.prototype.toString = function toString() {\n  \t\tvar tagName = this.template.e;\n\n  \t\tvar attrs = this.attributes.map(stringifyAttribute).join('') + this.conditionalAttributes.map(stringifyAttribute).join('');\n\n  \t\t// Special case - selected options\n  \t\tif (this.name === 'option' && this.isSelected()) {\n  \t\t\tattrs += ' selected';\n  \t\t}\n\n  \t\t// Special case - two-way radio name bindings\n  \t\tif (this.name === 'input' && inputIsCheckedRadio(this)) {\n  \t\t\tattrs += ' checked';\n  \t\t}\n\n  \t\tvar str = '<' + tagName + attrs + '>';\n\n  \t\tif (this.isVoid) return str;\n\n  \t\t// Special case - textarea\n  \t\tif (this.name === 'textarea' && this.getAttribute('value') !== undefined) {\n  \t\t\tstr += escapeHtml(this.getAttribute('value'));\n  \t\t}\n\n  \t\t// Special case - contenteditable\n  \t\telse if (this.getAttribute('contenteditable') !== undefined) {\n  \t\t\t\tstr += this.getAttribute('value') || '';\n  \t\t\t}\n\n  \t\tif (this.fragment) {\n  \t\t\tstr += this.fragment.toString(!/^(?:script|style)$/i.test(this.template.e)); // escape text unless script/style\n  \t\t}\n\n  \t\tstr += '</' + tagName + '>';\n  \t\treturn str;\n  \t};\n\n  \tElement.prototype.unbind = function unbind() {\n  \t\tthis.attributes.forEach(_unbind);\n  \t\tthis.conditionalAttributes.forEach(_unbind);\n\n  \t\tif (this.decorator) this.decorator.unbind();\n  \t\tif (this.fragment) this.fragment.unbind();\n  \t};\n\n  \tElement.prototype.unrender = function unrender(shouldDestroy) {\n  \t\tif (!this.rendered) return;\n  \t\tthis.rendered = false;\n\n  \t\t// unrendering before intro completed? complete it now\n  \t\t// TODO should be an API for aborting transitions\n  \t\tvar transition = this._introTransition;\n  \t\tif (transition) transition.complete();\n\n  \t\t// Detach as soon as we can\n  \t\tif (this.name === 'option') {\n  \t\t\t// <option> elements detach immediately, so that\n  \t\t\t// their parent <select> element syncs correctly, and\n  \t\t\t// since option elements can't have transitions anyway\n  \t\t\tthis.detach();\n  \t\t} else if (shouldDestroy) {\n  \t\t\trunloop.detachWhenReady(this);\n  \t\t}\n\n  \t\tif (this.fragment) this.fragment.unrender();\n\n  \t\tthis.eventHandlers.forEach(_unrender);\n\n  \t\tif (this.binding) this.binding.unrender();\n  \t\tif (!shouldDestroy && this.decorator) this.decorator.unrender();\n\n  \t\t// outro transition\n  \t\tvar transitionTemplate = this.template.t0 || this.template.t2;\n  \t\tif (transitionTemplate && this.ractive.transitionsEnabled) {\n  \t\t\tvar _transition = new Transition(this, transitionTemplate, false);\n  \t\t\trunloop.registerTransition(_transition);\n  \t\t}\n\n  \t\t// special case\n  \t\tvar id = this.attributeByName.id;\n  \t\tif (id) {\n  \t\t\tdelete this.ractive.nodes[id.getValue()];\n  \t\t}\n\n  \t\tremoveFromLiveQueries(this);\n  \t\t// TODO forms are a special case\n  \t};\n\n  \tElement.prototype.update = function update() {\n  \t\tif (this.dirty) {\n  \t\t\tthis.dirty = false;\n\n  \t\t\tthis.attributes.forEach(_update);\n  \t\t\tthis.conditionalAttributes.forEach(_update);\n  \t\t\tthis.eventHandlers.forEach(_update);\n\n  \t\t\tif (this.decorator) this.decorator.update();\n  \t\t\tif (this.fragment) this.fragment.update();\n  \t\t}\n  \t};\n\n  \treturn Element;\n  })(Item);\n\n  function inputIsCheckedRadio(element) {\n  \tvar attributes = element.attributeByName;\n\n  \tvar typeAttribute = attributes.type;\n  \tvar valueAttribute = attributes.value;\n  \tvar nameAttribute = attributes.name;\n\n  \tif (!typeAttribute || typeAttribute.value !== 'radio' || !valueAttribute || !nameAttribute.interpolator) {\n  \t\treturn;\n  \t}\n\n  \tif (valueAttribute.getValue() === nameAttribute.interpolator.model.get()) {\n  \t\treturn true;\n  \t}\n  }\n\n  function stringifyAttribute(attribute) {\n  \tvar str = attribute.toString();\n  \treturn str ? ' ' + str : '';\n  }\n\n  function removeFromLiveQueries(element) {\n  \tvar i = element.liveQueries.length;\n  \twhile (i--) {\n  \t\tvar query = element.liveQueries[i];\n  \t\tquery.remove(element.node);\n  \t}\n  }\n\n  function getNamespace(element) {\n  \t// Use specified namespace...\n  \tvar xmlns = element.getAttribute('xmlns');\n  \tif (xmlns) return xmlns;\n\n  \t// ...or SVG namespace, if this is an <svg> element\n  \tif (element.name === 'svg') return svg$1;\n\n  \tvar parent = element.parent;\n\n  \tif (parent) {\n  \t\t// ...or HTML, if the parent is a <foreignObject>\n  \t\tif (parent.name === 'foreignobject') return html;\n\n  \t\t// ...or inherit from the parent node\n  \t\treturn parent.node.namespaceURI;\n  \t}\n\n  \treturn element.ractive.el.namespaceURI;\n  }\n\n  var Input = (function (_Element) {\n  \tinherits(Input, _Element);\n\n  \tfunction Input() {\n  \t\tclassCallCheck(this, Input);\n\n  \t\t_Element.apply(this, arguments);\n  \t}\n\n  \tInput.prototype.render = function render(target, occupants) {\n  \t\t_Element.prototype.render.call(this, target, occupants);\n  \t\tthis.node.defaultValue = this.node.value;\n  \t};\n\n  \treturn Input;\n  })(Element);\n\n  var Textarea = (function (_Input) {\n  \tinherits(Textarea, _Input);\n\n  \tfunction Textarea(options) {\n  \t\tclassCallCheck(this, Textarea);\n\n  \t\tvar template = options.template;\n\n  \t\t// if there is a bindable value, there should be no body\n  \t\tif (template.a && template.a.value && isBindable({ template: template.a.value })) {\n  \t\t\toptions.noContent = true;\n  \t\t}\n\n  \t\t// otherwise, if there is a single bindable interpolator as content, move it to the value attr\n  \t\telse if (template.f && (!template.a || !template.a.value) && isBindable({ template: template.f })) {\n  \t\t\t\tif (!template.a) template.a = {};\n  \t\t\t\ttemplate.a.value = template.f;\n  \t\t\t\toptions.noContent = true;\n  \t\t\t}\n\n  \t\t_Input.call(this, options);\n  \t}\n\n  \tTextarea.prototype.bubble = function bubble() {\n  \t\tvar _this = this;\n\n  \t\tif (!this.dirty) {\n  \t\t\tthis.dirty = true;\n\n  \t\t\tif (this.rendered && !this.binding && this.fragment) {\n  \t\t\t\trunloop.scheduleTask(function () {\n  \t\t\t\t\t_this.dirty = false;\n  \t\t\t\t\t_this.node.value = _this.fragment.toString();\n  \t\t\t\t});\n  \t\t\t}\n\n  \t\t\tthis.parentFragment.bubble(); // default behaviour\n  \t\t}\n  \t};\n\n  \treturn Textarea;\n  })(Input);\n\n  function valueContains(selectValue, optionValue) {\n  \tvar i = selectValue.length;\n  \twhile (i--) {\n  \t\tif (selectValue[i] == optionValue) return true;\n  \t}\n  }\n\n  var Select = (function (_Element) {\n  \tinherits(Select, _Element);\n\n  \tfunction Select(options) {\n  \t\tclassCallCheck(this, Select);\n\n  \t\t_Element.call(this, options);\n  \t\tthis.options = [];\n  \t}\n\n  \tSelect.prototype.foundNode = function foundNode(node) {\n  \t\tif (this.binding && node.selectedOptions.length > 0) this.selectedOptions = toArray(node.selectedOptions);\n  \t};\n\n  \tSelect.prototype.render = function render(target, occupants) {\n  \t\t_Element.prototype.render.call(this, target, occupants);\n  \t\tthis.sync();\n\n  \t\tvar node = this.node;\n\n  \t\tvar i = node.options.length;\n  \t\twhile (i--) {\n  \t\t\tnode.options[i].defaultSelected = node.options[i].selected;\n  \t\t}\n\n  \t\tthis.rendered = true;\n  \t};\n\n  \tSelect.prototype.sync = function sync() {\n  \t\tvar _this = this;\n\n  \t\tvar selectNode = this.node;\n\n  \t\tif (!selectNode) return;\n\n  \t\tvar options = toArray(selectNode.options);\n\n  \t\tif (this.selectedOptions) {\n  \t\t\toptions.forEach(function (o) {\n  \t\t\t\tif (_this.selectedOptions.indexOf(o) >= 0) o.selected = true;else o.selected = false;\n  \t\t\t});\n  \t\t\tthis.binding.setFromNode(selectNode);\n  \t\t\tdelete this.selectedOptions;\n  \t\t\treturn;\n  \t\t}\n\n  \t\tvar selectValue = this.getAttribute('value');\n  \t\tvar isMultiple = this.getAttribute('multiple');\n\n  \t\t// If the <select> has a specified value, that should override\n  \t\t// these options\n  \t\tif (selectValue !== undefined) {\n  \t\t\tvar optionWasSelected = undefined;\n\n  \t\t\toptions.forEach(function (o) {\n  \t\t\t\tvar optionValue = o._ractive ? o._ractive.value : o.value;\n  \t\t\t\tvar shouldSelect = isMultiple ? valueContains(selectValue, optionValue) : selectValue == optionValue;\n\n  \t\t\t\tif (shouldSelect) {\n  \t\t\t\t\toptionWasSelected = true;\n  \t\t\t\t}\n\n  \t\t\t\to.selected = shouldSelect;\n  \t\t\t});\n\n  \t\t\tif (!optionWasSelected && !isMultiple) {\n  \t\t\t\tif (options[0]) {\n  \t\t\t\t\toptions[0].selected = true;\n  \t\t\t\t}\n\n  \t\t\t\tif (this.binding) {\n  \t\t\t\t\tthis.binding.forceUpdate();\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\t// Otherwise the value should be initialised according to which\n  \t\t// <option> element is selected, if twoway binding is in effect\n  \t\telse if (this.binding) {\n  \t\t\t\tthis.binding.forceUpdate();\n  \t\t\t}\n  \t};\n\n  \tSelect.prototype.update = function update() {\n  \t\t_Element.prototype.update.call(this);\n  \t\tthis.sync();\n  \t};\n\n  \treturn Select;\n  })(Element);\n\n  function findParentSelect(element) {\n  \twhile (element) {\n  \t\tif (element.name === 'select') return element;\n  \t\telement = element.parent;\n  \t}\n  }\n\n  var Option = (function (_Element) {\n  \tinherits(Option, _Element);\n\n  \tfunction Option(options) {\n  \t\tclassCallCheck(this, Option);\n\n  \t\tvar template = options.template;\n  \t\tif (!template.a) template.a = {};\n\n  \t\t// If the value attribute is missing, use the element's content,\n  \t\t// as long as it isn't disabled\n  \t\tif (template.a.value === undefined && !('disabled' in template)) {\n  \t\t\ttemplate.a.value = template.f || '';\n  \t\t}\n\n  \t\t_Element.call(this, options);\n\n  \t\tthis.select = findParentSelect(this.parent);\n  \t}\n\n  \tOption.prototype.bind = function bind() {\n  \t\tif (!this.select) {\n  \t\t\t_Element.prototype.bind.call(this);\n  \t\t\treturn;\n  \t\t}\n\n  \t\t// If the select has a value, it overrides the `selected` attribute on\n  \t\t// this option - so we delete the attribute\n  \t\tvar selectedAttribute = this.attributeByName.selected;\n  \t\tif (selectedAttribute && this.select.getAttribute('value') !== undefined) {\n  \t\t\tvar index = this.attributes.indexOf(selectedAttribute);\n  \t\t\tthis.attributes.splice(index, 1);\n  \t\t\tdelete this.attributeByName.selected;\n  \t\t}\n\n  \t\t_Element.prototype.bind.call(this);\n  \t\tthis.select.options.push(this);\n  \t};\n\n  \tOption.prototype.isSelected = function isSelected() {\n  \t\tvar optionValue = this.getAttribute('value');\n\n  \t\tif (optionValue === undefined || !this.select) {\n  \t\t\treturn false;\n  \t\t}\n\n  \t\tvar selectValue = this.select.getAttribute('value');\n\n  \t\tif (selectValue == optionValue) {\n  \t\t\treturn true;\n  \t\t}\n\n  \t\tif (this.select.getAttribute('multiple') && isArray(selectValue)) {\n  \t\t\tvar i = selectValue.length;\n  \t\t\twhile (i--) {\n  \t\t\t\tif (selectValue[i] == optionValue) {\n  \t\t\t\t\treturn true;\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tOption.prototype.unbind = function unbind() {\n  \t\t_Element.prototype.unbind.call(this);\n\n  \t\tif (this.select) {\n  \t\t\tremoveFromArray(this.select.options, this);\n  \t\t}\n  \t};\n\n  \treturn Option;\n  })(Element);\n\n  var Form = (function (_Element) {\n  \tinherits(Form, _Element);\n\n  \tfunction Form(options) {\n  \t\tclassCallCheck(this, Form);\n\n  \t\t_Element.call(this, options);\n  \t\tthis.formBindings = [];\n  \t}\n\n  \tForm.prototype.render = function render(target, occupants) {\n  \t\t_Element.prototype.render.call(this, target, occupants);\n  \t\tthis.node.addEventListener('reset', handleReset, false);\n  \t};\n\n  \tForm.prototype.unrender = function unrender(shouldDestroy) {\n  \t\tthis.node.removeEventListener('reset', handleReset, false);\n  \t\t_Element.prototype.unrender.call(this, shouldDestroy);\n  \t};\n\n  \treturn Form;\n  })(Element);\n\n  function handleReset() {\n  \tvar element = this._ractive.proxy;\n\n  \trunloop.start();\n  \telement.formBindings.forEach(updateModel);\n  \trunloop.end();\n  }\n\n  function updateModel(binding) {\n  \tbinding.model.set(binding.resetValue);\n  }\n\n  function processWrapper (wrapper, array, methodName, newIndices) {\n  \tvar __model = wrapper.__model;\n\n  \tif (newIndices) {\n  \t\t__model.shuffle(newIndices);\n  \t} else {\n  \t\t// If this is a sort or reverse, we just do root.set()...\n  \t\t// TODO use merge logic?\n  \t\t//root.viewmodel.mark( keypath );\n  \t}\n  }\n\n  var mutatorMethods = ['pop', 'push', 'reverse', 'shift', 'sort', 'splice', 'unshift'];\n  var patchedArrayProto = [];\n\n  mutatorMethods.forEach(function (methodName) {\n  \tvar method = function () {\n  \t\tfor (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n  \t\t\targs[_key] = arguments[_key];\n  \t\t}\n\n  \t\tvar newIndices = getNewIndices(this.length, methodName, args);\n\n  \t\t// apply the underlying method\n  \t\tvar result = Array.prototype[methodName].apply(this, arguments);\n\n  \t\t// trigger changes\n  \t\trunloop.start();\n\n  \t\tthis._ractive.setting = true;\n  \t\tvar i = this._ractive.wrappers.length;\n  \t\twhile (i--) {\n  \t\t\tprocessWrapper(this._ractive.wrappers[i], this, methodName, newIndices);\n  \t\t}\n\n  \t\trunloop.end();\n\n  \t\tthis._ractive.setting = false;\n  \t\treturn result;\n  \t};\n\n  \tdefineProperty(patchedArrayProto, methodName, {\n  \t\tvalue: method\n  \t});\n  });\n\n  var patchArrayMethods = undefined;\n  var unpatchArrayMethods = undefined;\n\n  // can we use prototype chain injection?\n  // http://perfectionkills.com/how-ecmascript-5-still-does-not-allow-to-subclass-an-array/#wrappers_prototype_chain_injection\n  if (({}).__proto__) {\n  \t// yes, we can\n  \tpatchArrayMethods = function (array) {\n  \t\treturn array.__proto__ = patchedArrayProto;\n  \t};\n  \tunpatchArrayMethods = function (array) {\n  \t\treturn array.__proto__ = Array.prototype;\n  \t};\n  } else {\n  \t// no, we can't\n  \tpatchArrayMethods = function (array) {\n  \t\tvar i = mutatorMethods.length;\n  \t\twhile (i--) {\n  \t\t\tvar methodName = mutatorMethods[i];\n  \t\t\tdefineProperty(array, methodName, {\n  \t\t\t\tvalue: patchedArrayProto[methodName],\n  \t\t\t\tconfigurable: true\n  \t\t\t});\n  \t\t}\n  \t};\n\n  \tunpatchArrayMethods = function (array) {\n  \t\tvar i = mutatorMethods.length;\n  \t\twhile (i--) {\n  \t\t\tdelete array[mutatorMethods[i]];\n  \t\t}\n  \t};\n  }\n\n  patchArrayMethods.unpatch = unpatchArrayMethods; // TODO export separately?\n  var patch = patchArrayMethods;\n\n  var errorMessage = 'Something went wrong in a rather interesting way';\n\n  var arrayAdaptor = {\n  \tfilter: function (object) {\n  \t\t// wrap the array if a) b) it's an array, and b) either it hasn't been wrapped already,\n  \t\t// or the array didn't trigger the get() itself\n  \t\treturn isArray(object) && (!object._ractive || !object._ractive.setting);\n  \t},\n  \twrap: function (ractive, array, keypath) {\n  \t\treturn new ArrayWrapper(ractive, array, keypath);\n  \t}\n  };\n\n  var ArrayWrapper = (function () {\n  \tfunction ArrayWrapper(ractive, array) {\n  \t\tclassCallCheck(this, ArrayWrapper);\n\n  \t\tthis.root = ractive;\n  \t\tthis.value = array;\n  \t\tthis.__model = null; // filled in later\n\n  \t\t// if this array hasn't already been ractified, ractify it\n  \t\tif (!array._ractive) {\n  \t\t\t// define a non-enumerable _ractive property to store the wrappers\n  \t\t\tdefineProperty(array, '_ractive', {\n  \t\t\t\tvalue: {\n  \t\t\t\t\twrappers: [],\n  \t\t\t\t\tinstances: [],\n  \t\t\t\t\tsetting: false\n  \t\t\t\t},\n  \t\t\t\tconfigurable: true\n  \t\t\t});\n\n  \t\t\tpatch(array);\n  \t\t}\n\n  \t\t// store the ractive instance, so we can handle transitions later\n  \t\tif (!array._ractive.instances[ractive._guid]) {\n  \t\t\tarray._ractive.instances[ractive._guid] = 0;\n  \t\t\tarray._ractive.instances.push(ractive);\n  \t\t}\n\n  \t\tarray._ractive.instances[ractive._guid] += 1;\n  \t\tarray._ractive.wrappers.push(this);\n  \t}\n\n  \tArrayWrapper.prototype.get = function get() {\n  \t\treturn this.value;\n  \t};\n\n  \tArrayWrapper.prototype.teardown = function teardown() {\n  \t\tvar array, storage, wrappers, instances, index;\n\n  \t\tarray = this.value;\n  \t\tstorage = array._ractive;\n  \t\twrappers = storage.wrappers;\n  \t\tinstances = storage.instances;\n\n  \t\t// if teardown() was invoked because we're clearing the cache as a result of\n  \t\t// a change that the array itself triggered, we can save ourselves the teardown\n  \t\t// and immediate setup\n  \t\tif (storage.setting) {\n  \t\t\treturn false; // so that we don't remove it from cached wrappers\n  \t\t}\n\n  \t\tindex = wrappers.indexOf(this);\n  \t\tif (index === -1) {\n  \t\t\tthrow new Error(errorMessage);\n  \t\t}\n\n  \t\twrappers.splice(index, 1);\n\n  \t\t// if nothing else depends on this array, we can revert it to its\n  \t\t// natural state\n  \t\tif (!wrappers.length) {\n  \t\t\tdelete array._ractive;\n  \t\t\tpatch.unpatch(this.value);\n  \t\t} else {\n  \t\t\t// remove ractive instance if possible\n  \t\t\tinstances[this.root._guid] -= 1;\n  \t\t\tif (!instances[this.root._guid]) {\n  \t\t\t\tindex = instances.indexOf(this.root);\n\n  \t\t\t\tif (index === -1) {\n  \t\t\t\t\tthrow new Error(errorMessage);\n  \t\t\t\t}\n\n  \t\t\t\tinstances.splice(index, 1);\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \treturn ArrayWrapper;\n  })();\n\n  var magicAdaptor = undefined;\n\n  try {\n  \tObject.defineProperty({}, 'test', { value: 0 });\n\n  \tmagicAdaptor = {\n  \t\tfilter: function (value) {\n  \t\t\treturn value && typeof value === 'object';\n  \t\t},\n  \t\twrap: function (ractive, value, keypath) {\n  \t\t\treturn new MagicWrapper(ractive, value, keypath);\n  \t\t}\n  \t};\n  } catch (err) {\n  \tmagicAdaptor = false;\n  }\n\n  var magicAdaptor$1 = magicAdaptor;\n\n  function createOrWrapDescriptor(originalDescriptor, ractive, keypath) {\n  \tif (originalDescriptor.set && originalDescriptor.set.__magic) {\n  \t\toriginalDescriptor.set.__magic.dependants.push({ ractive: ractive, keypath: keypath });\n  \t\treturn originalDescriptor;\n  \t}\n\n  \tvar setting = undefined;\n\n  \tvar dependants = [{ ractive: ractive, keypath: keypath }];\n\n  \tvar descriptor = {\n  \t\tget: function () {\n  \t\t\treturn 'value' in originalDescriptor ? originalDescriptor.value : originalDescriptor.get();\n  \t\t},\n  \t\tset: function (value) {\n  \t\t\tif (setting) return;\n\n  \t\t\tif ('value' in originalDescriptor) {\n  \t\t\t\toriginalDescriptor.value = value;\n  \t\t\t} else {\n  \t\t\t\toriginalDescriptor.set(value);\n  \t\t\t}\n\n  \t\t\tsetting = true;\n  \t\t\tdependants.forEach(function (_ref) {\n  \t\t\t\tvar ractive = _ref.ractive;\n  \t\t\t\tvar keypath = _ref.keypath;\n\n  \t\t\t\tractive.set(keypath, value);\n  \t\t\t});\n  \t\t\tsetting = false;\n  \t\t},\n  \t\tenumerable: true\n  \t};\n\n  \tdescriptor.set.__magic = { dependants: dependants, originalDescriptor: originalDescriptor };\n\n  \treturn descriptor;\n  }\n\n  function revert(descriptor, ractive, keypath) {\n  \tif (!descriptor.set || !descriptor.set.__magic) return true;\n\n  \tvar dependants = descriptor.set.__magic;\n  \tvar i = dependants.length;\n  \twhile (i--) {\n  \t\tvar dependant = dependants[i];\n  \t\tif (dependant.ractive === ractive && dependant.keypath === keypath) {\n  \t\t\tdependants.splice(i, 1);\n  \t\t\treturn false;\n  \t\t}\n  \t}\n  }\n\n  var MagicWrapper = (function () {\n  \tfunction MagicWrapper(ractive, value, keypath) {\n  \t\tvar _this = this;\n\n  \t\tclassCallCheck(this, MagicWrapper);\n\n  \t\tthis.ractive = ractive;\n  \t\tthis.value = value;\n  \t\tthis.keypath = keypath;\n\n  \t\tthis.originalDescriptors = {};\n\n  \t\t// wrap all properties with getters\n  \t\tObject.keys(value).forEach(function (key) {\n  \t\t\tvar originalDescriptor = Object.getOwnPropertyDescriptor(_this.value, key);\n  \t\t\t_this.originalDescriptors[key] = originalDescriptor;\n\n  \t\t\tvar childKeypath = keypath ? keypath + '.' + escapeKey(key) : escapeKey(key);\n\n  \t\t\tvar descriptor = createOrWrapDescriptor(originalDescriptor, ractive, childKeypath);\n\n  \t\t\tObject.defineProperty(_this.value, key, descriptor);\n  \t\t});\n  \t}\n\n  \tMagicWrapper.prototype.get = function get() {\n  \t\treturn this.value;\n  \t};\n\n  \tMagicWrapper.prototype.reset = function reset() {\n  \t\tthrow new Error('TODO magic adaptor reset'); // does this ever happen?\n  \t};\n\n  \tMagicWrapper.prototype.set = function set(key, value) {\n  \t\tthis.value[key] = value;\n  \t};\n\n  \tMagicWrapper.prototype.teardown = function teardown() {\n  \t\tvar _this2 = this;\n\n  \t\tObject.keys(this.value).forEach(function (key) {\n  \t\t\tvar descriptor = Object.getOwnPropertyDescriptor(_this2.value, key);\n  \t\t\tif (!descriptor.set || !descriptor.set.__magic) return;\n\n  \t\t\trevert(descriptor);\n\n  \t\t\tif (descriptor.set.__magic.dependants.length === 1) {\n  \t\t\t\tObject.defineProperty(_this2.value, key, descriptor.set.__magic.originalDescriptor);\n  \t\t\t}\n  \t\t});\n  \t};\n\n  \treturn MagicWrapper;\n  })();\n\n  var MagicArrayWrapper = (function () {\n  \tfunction MagicArrayWrapper(ractive, array, keypath) {\n  \t\tclassCallCheck(this, MagicArrayWrapper);\n\n  \t\tthis.value = array;\n\n  \t\tthis.magic = true;\n\n  \t\tthis.magicWrapper = magicAdaptor$1.wrap(ractive, array, keypath);\n  \t\tthis.arrayWrapper = arrayAdaptor.wrap(ractive, array, keypath);\n\n  \t\t// ugh, this really is a terrible hack\n  \t\tObject.defineProperty(this, '__model', {\n  \t\t\tget: function () {\n  \t\t\t\treturn this.arrayWrapper.__model;\n  \t\t\t},\n  \t\t\tset: function (model) {\n  \t\t\t\tthis.arrayWrapper.__model = model;\n  \t\t\t}\n  \t\t});\n  \t}\n\n  \tMagicArrayWrapper.prototype.get = function get() {\n  \t\treturn this.value;\n  \t};\n\n  \tMagicArrayWrapper.prototype.teardown = function teardown() {\n  \t\tthis.arrayWrapper.teardown();\n  \t\tthis.magicWrapper.teardown();\n  \t};\n\n  \tMagicArrayWrapper.prototype.reset = function reset(value) {\n  \t\treturn this.magicWrapper.reset(value);\n  \t};\n\n  \treturn MagicArrayWrapper;\n  })();\n\n  var magicArrayAdaptor = {\n  \tfilter: function (object, keypath, ractive) {\n  \t\treturn magicAdaptor$1.filter(object, keypath, ractive) && arrayAdaptor.filter(object);\n  \t},\n\n  \twrap: function (ractive, array, keypath) {\n  \t\treturn new MagicArrayWrapper(ractive, array, keypath);\n  \t}\n  };\n\n  function validate(data) {\n  \t// Warn if userOptions.data is a non-POJO\n  \tif (data && data.constructor !== Object) {\n  \t\tif (typeof data === 'function') {\n  \t\t\t// TODO do we need to support this in the new Ractive() case?\n  \t\t} else if (typeof data !== 'object') {\n  \t\t\t\tfatal('data option must be an object or a function, `' + data + '` is not valid');\n  \t\t\t} else {\n  \t\t\t\twarnIfDebug('If supplied, options.data should be a plain JavaScript object - using a non-POJO as the root object may work, but is discouraged');\n  \t\t\t}\n  \t}\n  }\n\n  var dataConfigurator = {\n  \tname: 'data',\n\n  \textend: function (Parent, proto, options) {\n  \t\tvar key = undefined;\n  \t\tvar value = undefined;\n\n  \t\t// check for non-primitives, which could cause mutation-related bugs\n  \t\tif (options.data && isObject(options.data)) {\n  \t\t\tfor (key in options.data) {\n  \t\t\t\tvalue = options.data[key];\n\n  \t\t\t\tif (value && typeof value === 'object') {\n  \t\t\t\t\tif (isObject(value) || isArray(value)) {\n  \t\t\t\t\t\twarnIfDebug('Passing a `data` option with object and array properties to Ractive.extend() is discouraged, as mutating them is likely to cause bugs. Consider using a data function instead:\\n\\n  // this...\\n  data: function () {\\n    return {\\n      myObject: {}\\n    };\\n  })\\n\\n  // instead of this:\\n  data: {\\n    myObject: {}\\n  }');\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\tproto.data = combine$1(proto.data, options.data);\n  \t},\n\n  \tinit: function (Parent, ractive, options) {\n  \t\tvar result = combine$1(Parent.prototype.data, options.data);\n\n  \t\tif (typeof result === 'function') result = result.call(ractive);\n\n  \t\t// bind functions to the ractive instance at the top level,\n  \t\t// unless it's a non-POJO (in which case alarm bells should ring)\n  \t\tif (result && result.constructor === Object) {\n  \t\t\tfor (var prop in result) {\n  \t\t\t\tif (typeof result[prop] === 'function') result[prop] = bind(result[prop], ractive);\n  \t\t\t}\n  \t\t}\n\n  \t\treturn result || {};\n  \t},\n\n  \treset: function (ractive) {\n  \t\tvar result = this.init(ractive.constructor, ractive, ractive.viewmodel);\n  \t\tractive.viewmodel.root.set(result);\n  \t\treturn true;\n  \t}\n  };\n\n  function combine$1(parentValue, childValue) {\n  \tvalidate(childValue);\n\n  \tvar parentIsFn = typeof parentValue === 'function';\n  \tvar childIsFn = typeof childValue === 'function';\n\n  \t// Very important, otherwise child instance can become\n  \t// the default data object on Ractive or a component.\n  \t// then ractive.set() ends up setting on the prototype!\n  \tif (!childValue && !parentIsFn) {\n  \t\tchildValue = {};\n  \t}\n\n  \t// Fast path, where we just need to copy properties from\n  \t// parent to child\n  \tif (!parentIsFn && !childIsFn) {\n  \t\treturn fromProperties(childValue, parentValue);\n  \t}\n\n  \treturn function () {\n  \t\tvar child = childIsFn ? callDataFunction(childValue, this) : childValue;\n  \t\tvar parent = parentIsFn ? callDataFunction(parentValue, this) : parentValue;\n\n  \t\treturn fromProperties(child, parent);\n  \t};\n  }\n\n  function callDataFunction(fn, context) {\n  \tvar data = fn.call(context);\n\n  \tif (!data) return;\n\n  \tif (typeof data !== 'object') {\n  \t\tfatal('Data function must return an object');\n  \t}\n\n  \tif (data.constructor !== Object) {\n  \t\twarnOnceIfDebug('Data function returned something other than a plain JavaScript object. This might work, but is strongly discouraged');\n  \t}\n\n  \treturn data;\n  }\n\n  function fromProperties(primary, secondary) {\n  \tif (primary && secondary) {\n  \t\tfor (var key in secondary) {\n  \t\t\tif (!(key in primary)) {\n  \t\t\t\tprimary[key] = secondary[key];\n  \t\t\t}\n  \t\t}\n\n  \t\treturn primary;\n  \t}\n\n  \treturn primary || secondary;\n  }\n\n  // TODO this is probably a bit anal, maybe we should leave it out\n  function prettify(fnBody) {\n  \tvar lines = fnBody.replace(/^\\t+/gm, function (tabs) {\n  \t\treturn tabs.split('\\t').join('  ');\n  \t}).split('\\n');\n\n  \tvar minIndent = lines.length < 2 ? 0 : lines.slice(1).reduce(function (prev, line) {\n  \t\treturn Math.min(prev, /^\\s*/.exec(line)[0].length);\n  \t}, Infinity);\n\n  \treturn lines.map(function (line, i) {\n  \t\treturn '    ' + (i ? line.substring(minIndent) : line);\n  \t}).join('\\n');\n  }\n\n  // Ditto. This function truncates the stack to only include app code\n  function truncateStack(stack) {\n  \tif (!stack) return '';\n\n  \tvar lines = stack.split('\\n');\n  \tvar name = Computation.name + '.getValue';\n\n  \tvar truncated = [];\n\n  \tvar len = lines.length;\n  \tfor (var i = 1; i < len; i += 1) {\n  \t\tvar line = lines[i];\n\n  \t\tif (~line.indexOf(name)) {\n  \t\t\treturn truncated.join('\\n');\n  \t\t} else {\n  \t\t\ttruncated.push(line);\n  \t\t}\n  \t}\n  }\n\n  var Computation = (function (_Model) {\n  \tinherits(Computation, _Model);\n\n  \tfunction Computation(viewmodel, signature, key) {\n  \t\tclassCallCheck(this, Computation);\n\n  \t\t_Model.call(this, null, null);\n\n  \t\tthis.root = this.parent = viewmodel;\n  \t\tthis.signature = signature;\n\n  \t\tthis.key = key; // not actually used, but helps with debugging\n  \t\tthis.isExpression = key && key[0] === '@';\n\n  \t\tthis.isReadonly = !this.signature.setter;\n\n  \t\tthis.context = viewmodel.computationContext;\n\n  \t\tthis.dependencies = [];\n\n  \t\tthis.children = [];\n  \t\tthis.childByKey = {};\n\n  \t\tthis.deps = [];\n\n  \t\tthis.boundsSensitive = true;\n  \t\tthis.dirty = true;\n\n  \t\t// TODO: is there a less hackish way to do this?\n  \t\tthis.shuffle = undefined;\n  \t}\n\n  \tComputation.prototype.get = function get(shouldCapture) {\n  \t\tif (shouldCapture) capture(this);\n\n  \t\tif (this.dirty) {\n  \t\t\tthis.dirty = false;\n  \t\t\tthis.value = this.getValue();\n  \t\t\tthis.adapt();\n  \t\t}\n\n  \t\treturn this.value;\n  \t};\n\n  \tComputation.prototype.getValue = function getValue() {\n  \t\tstartCapturing();\n  \t\tvar result = undefined;\n\n  \t\ttry {\n  \t\t\tresult = this.signature.getter.call(this.context);\n  \t\t} catch (err) {\n  \t\t\twarnIfDebug('Failed to compute ' + this.getKeypath() + ': ' + (err.message || err));\n\n  \t\t\t// TODO this is all well and good in Chrome, but...\n  \t\t\t// ...also, should encapsulate this stuff better, and only\n  \t\t\t// show it if Ractive.DEBUG\n  \t\t\tif (console.groupCollapsed) console.groupCollapsed('%cshow details', 'color: rgb(82, 140, 224); font-weight: normal; text-decoration: underline;');\n  \t\t\tvar functionBody = prettify(this.signature.getterString);\n  \t\t\tvar stack = this.signature.getterUseStack ? '\\n\\n' + truncateStack(err.stack) : '';\n  \t\t\tconsole.error(err.name + ': ' + err.message + '\\n\\n' + functionBody + stack);\n  \t\t\tif (console.groupCollapsed) console.groupEnd();\n  \t\t}\n\n  \t\tvar dependencies = stopCapturing();\n  \t\tthis.setDependencies(dependencies);\n\n  \t\treturn result;\n  \t};\n\n  \tComputation.prototype.handleChange = function handleChange() {\n  \t\tthis.dirty = true;\n\n  \t\tthis.deps.forEach(_handleChange);\n  \t\tthis.children.forEach(_handleChange);\n  \t\tthis.clearUnresolveds(); // TODO same question as on Model - necessary for primitives?\n  \t};\n\n  \tComputation.prototype.joinKey = function joinKey(key) {\n  \t\tif (key === undefined || key === '') return this;\n\n  \t\tif (!this.childByKey.hasOwnProperty(key)) {\n  \t\t\tvar child = new ComputationChild(this, key);\n  \t\t\tthis.children.push(child);\n  \t\t\tthis.childByKey[key] = child;\n  \t\t}\n\n  \t\treturn this.childByKey[key];\n  \t};\n\n  \tComputation.prototype.mark = function mark() {\n  \t\tthis.handleChange();\n  \t};\n\n  \tComputation.prototype.set = function set(value) {\n  \t\tif (!this.signature.setter) {\n  \t\t\tthrow new Error('Cannot set read-only computed value \\'' + this.key + '\\'');\n  \t\t}\n\n  \t\tthis.signature.setter(value);\n  \t};\n\n  \tComputation.prototype.setDependencies = function setDependencies(dependencies) {\n  \t\t// unregister any soft dependencies we no longer have\n  \t\tvar i = this.dependencies.length;\n  \t\twhile (i--) {\n  \t\t\tvar model = this.dependencies[i];\n  \t\t\tif (! ~dependencies.indexOf(model)) model.unregister(this);\n  \t\t}\n\n  \t\t// and add any new ones\n  \t\ti = dependencies.length;\n  \t\twhile (i--) {\n  \t\t\tvar model = dependencies[i];\n  \t\t\tif (! ~this.dependencies.indexOf(model)) model.register(this);\n  \t\t}\n\n  \t\tthis.dependencies = dependencies;\n  \t};\n\n  \treturn Computation;\n  })(Model);\n\n  var RactiveModel = (function (_Model) {\n  \tinherits(RactiveModel, _Model);\n\n  \tfunction RactiveModel(ractive) {\n  \t\tclassCallCheck(this, RactiveModel);\n\n  \t\t_Model.call(this, null, '');\n  \t\tthis.value = ractive;\n  \t\tthis.isRoot = true;\n  \t\tthis.root = this;\n  \t\tthis.adaptors = [];\n  \t\tthis.ractive = ractive;\n  \t\tthis.changes = {};\n  \t}\n\n  \tRactiveModel.prototype.getKeypath = function getKeypath() {\n  \t\treturn '@ractive';\n  \t};\n\n  \treturn RactiveModel;\n  })(Model);\n\n  var hasProp = Object.prototype.hasOwnProperty;\n\n  var RootModel = (function (_Model) {\n  \tinherits(RootModel, _Model);\n\n  \tfunction RootModel(options) {\n  \t\tclassCallCheck(this, RootModel);\n\n  \t\t_Model.call(this, null, null);\n\n  \t\t// TODO deprecate this\n  \t\tthis.changes = {};\n\n  \t\tthis.isRoot = true;\n  \t\tthis.root = this;\n  \t\tthis.ractive = options.ractive; // TODO sever this link\n\n  \t\tthis.value = options.data;\n  \t\tthis.adaptors = options.adapt;\n  \t\tthis.adapt();\n\n  \t\tthis.mappings = {};\n\n  \t\tthis.computationContext = options.ractive;\n  \t\tthis.computations = {};\n  \t}\n\n  \tRootModel.prototype.applyChanges = function applyChanges() {\n  \t\tthis._changeHash = {};\n  \t\tthis.flush();\n\n  \t\treturn this._changeHash;\n  \t};\n\n  \tRootModel.prototype.compute = function compute(key, signature) {\n  \t\tvar computation = new Computation(this, signature, key);\n  \t\tthis.computations[key] = computation;\n\n  \t\treturn computation;\n  \t};\n\n  \tRootModel.prototype.extendChildren = function extendChildren(fn) {\n  \t\tvar mappings = this.mappings;\n  \t\tObject.keys(mappings).forEach(function (key) {\n  \t\t\tfn(key, mappings[key]);\n  \t\t});\n\n  \t\tvar computations = this.computations;\n  \t\tObject.keys(computations).forEach(function (key) {\n  \t\t\tvar computation = computations[key];\n  \t\t\t// exclude template expressions\n  \t\t\tif (!computation.isExpression) {\n  \t\t\t\tfn(key, computation);\n  \t\t\t}\n  \t\t});\n  \t};\n\n  \tRootModel.prototype.get = function get(shouldCapture) {\n  \t\tif (shouldCapture) capture(this);\n  \t\tvar result = extend({}, this.value);\n\n  \t\tthis.extendChildren(function (key, model) {\n  \t\t\tresult[key] = model.value;\n  \t\t});\n\n  \t\treturn result;\n  \t};\n\n  \tRootModel.prototype.getKeypath = function getKeypath() {\n  \t\treturn '';\n  \t};\n\n  \tRootModel.prototype.getRactiveModel = function getRactiveModel() {\n  \t\treturn this.ractiveModel || (this.ractiveModel = new RactiveModel(this.ractive));\n  \t};\n\n  \tRootModel.prototype.getValueChildren = function getValueChildren() {\n  \t\tvar children = _Model.prototype.getValueChildren.call(this, this.value);\n\n  \t\tthis.extendChildren(function (key, model) {\n  \t\t\tchildren.push(model);\n  \t\t});\n\n  \t\treturn children;\n  \t};\n\n  \tRootModel.prototype.handleChange = function handleChange() {\n  \t\tthis.deps.forEach(_handleChange);\n  \t};\n\n  \tRootModel.prototype.has = function has(key) {\n  \t\tif (key in this.mappings || key in this.computations) return true;\n\n  \t\tvar value = this.value;\n\n  \t\tkey = unescapeKey(key);\n  \t\tif (hasProp.call(value, key)) return true;\n\n  \t\t// We climb up the constructor chain to find if one of them contains the key\n  \t\tvar constructor = value.constructor;\n  \t\twhile (constructor !== Function && constructor !== Array && constructor !== Object) {\n  \t\t\tif (hasProp.call(constructor.prototype, key)) return true;\n  \t\t\tconstructor = constructor.constructor;\n  \t\t}\n\n  \t\treturn false;\n  \t};\n\n  \tRootModel.prototype.joinKey = function joinKey(key) {\n  \t\tif (key === '@global') return GlobalModel$1;\n  \t\tif (key === '@ractive') return this.getRactiveModel();\n\n  \t\treturn this.mappings.hasOwnProperty(key) ? this.mappings[key] : this.computations.hasOwnProperty(key) ? this.computations[key] : _Model.prototype.joinKey.call(this, key);\n  \t};\n\n  \tRootModel.prototype.map = function map(localKey, origin) {\n  \t\t// TODO remapping\n  \t\tthis.mappings[localKey] = origin;\n  \t\torigin.register(this);\n  \t};\n\n  \tRootModel.prototype.set = function set(value) {\n  \t\t// TODO wrapping root node is a baaaad idea. We should prevent this\n  \t\tvar wrapper = this.wrapper;\n  \t\tif (wrapper) {\n  \t\t\tvar shouldTeardown = !wrapper.reset || wrapper.reset(value) === false;\n\n  \t\t\tif (shouldTeardown) {\n  \t\t\t\twrapper.teardown();\n  \t\t\t\tthis.wrapper = null;\n  \t\t\t\tthis.value = value;\n  \t\t\t\tthis.adapt();\n  \t\t\t}\n  \t\t} else {\n  \t\t\tthis.value = value;\n  \t\t\tthis.adapt();\n  \t\t}\n\n  \t\tthis.deps.forEach(_handleChange);\n  \t\tthis.children.forEach(_mark);\n  \t\tthis.clearUnresolveds(); // TODO do we need to do this with primitive values? if not, what about e.g. unresolved `length` property of null -> string?\n  \t};\n\n  \tRootModel.prototype.retrieve = function retrieve() {\n  \t\treturn this.value;\n  \t};\n\n  \tRootModel.prototype.update = function update() {\n  \t\t// noop\n  \t};\n\n  \tRootModel.prototype.updateFromBindings = function updateFromBindings(cascade) {\n  \t\tvar _this = this;\n\n  \t\t_Model.prototype.updateFromBindings.call(this, cascade);\n\n  \t\tif (cascade) {\n  \t\t\t// TODO computations as well?\n  \t\t\tObject.keys(this.mappings).forEach(function (key) {\n  \t\t\t\tvar model = _this.mappings[key];\n  \t\t\t\tmodel.updateFromBindings(cascade);\n  \t\t\t});\n  \t\t}\n  \t};\n\n  \treturn RootModel;\n  })(Model);\n\n  function getComputationSignature(ractive, key, signature) {\n  \tvar getter = undefined;\n  \tvar setter = undefined;\n\n  \t// useful for debugging\n  \tvar getterString = undefined;\n  \tvar getterUseStack = undefined;\n  \tvar setterString = undefined;\n\n  \tif (typeof signature === 'function') {\n  \t\tgetter = bind(signature, ractive);\n  \t\tgetterString = signature.toString();\n  \t\tgetterUseStack = true;\n  \t}\n\n  \tif (typeof signature === 'string') {\n  \t\tgetter = createFunctionFromString(signature, ractive);\n  \t\tgetterString = signature;\n  \t}\n\n  \tif (typeof signature === 'object') {\n  \t\tif (typeof signature.get === 'string') {\n  \t\t\tgetter = createFunctionFromString(signature.get, ractive);\n  \t\t\tgetterString = signature.get;\n  \t\t} else if (typeof signature.get === 'function') {\n  \t\t\tgetter = bind(signature.get, ractive);\n  \t\t\tgetterString = signature.get.toString();\n  \t\t\tgetterUseStack = true;\n  \t\t} else {\n  \t\t\tfatal('`%s` computation must have a `get()` method', key);\n  \t\t}\n\n  \t\tif (typeof signature.set === 'function') {\n  \t\t\tsetter = bind(signature.set, ractive);\n  \t\t\tsetterString = signature.set.toString();\n  \t\t}\n  \t}\n\n  \treturn {\n  \t\tgetter: getter,\n  \t\tsetter: setter,\n  \t\tgetterString: getterString,\n  \t\tsetterString: setterString,\n  \t\tgetterUseStack: getterUseStack\n  \t};\n  }\n\n  var constructHook = new Hook('construct');\n\n  var registryNames = ['adaptors', 'components', 'decorators', 'easing', 'events', 'interpolators', 'partials', 'transitions'];\n\n  var uid = 0;\n  function construct(ractive, options) {\n  \tif (Ractive.DEBUG) welcome();\n\n  \tinitialiseProperties(ractive);\n\n  \t// TODO remove this, eventually\n  \tdefineProperty(ractive, 'data', { get: deprecateRactiveData });\n\n  \t// TODO don't allow `onconstruct` with `new Ractive()`, there's no need for it\n  \tconstructHook.fire(ractive, options);\n\n  \t// Add registries\n  \tregistryNames.forEach(function (name) {\n  \t\tractive[name] = extend(create(ractive.constructor[name] || null), options[name]);\n  \t});\n\n  \t// Create a viewmodel\n  \tvar viewmodel = new RootModel({\n  \t\tadapt: getAdaptors(ractive, ractive.adapt, options),\n  \t\tdata: dataConfigurator.init(ractive.constructor, ractive, options),\n  \t\tractive: ractive\n  \t});\n\n  \tractive.viewmodel = viewmodel;\n\n  \t// Add computed properties\n  \tvar computed = extend(create(ractive.constructor.prototype.computed), options.computed);\n\n  \tfor (var key in computed) {\n  \t\tvar signature = getComputationSignature(ractive, key, computed[key]);\n  \t\tviewmodel.compute(key, signature);\n  \t}\n  }\n\n  function combine(a, b) {\n  \tvar c = a.slice();\n  \tvar i = b.length;\n\n  \twhile (i--) {\n  \t\tif (! ~c.indexOf(b[i])) {\n  \t\t\tc.push(b[i]);\n  \t\t}\n  \t}\n\n  \treturn c;\n  }\n\n  function getAdaptors(ractive, protoAdapt, options) {\n  \tprotoAdapt = protoAdapt.map(lookup);\n  \tvar adapt = ensureArray(options.adapt).map(lookup);\n\n  \tadapt = combine(protoAdapt, adapt);\n\n  \tvar magic = 'magic' in options ? options.magic : ractive.magic;\n  \tvar modifyArrays = 'modifyArrays' in options ? options.modifyArrays : ractive.modifyArrays;\n\n  \tif (magic) {\n  \t\tif (!magicSupported) {\n  \t\t\tthrow new Error('Getters and setters (magic mode) are not supported in this browser');\n  \t\t}\n\n  \t\tif (modifyArrays) {\n  \t\t\tadapt.push(magicArrayAdaptor);\n  \t\t}\n\n  \t\tadapt.push(magicAdaptor$1);\n  \t}\n\n  \tif (modifyArrays) {\n  \t\tadapt.push(arrayAdaptor);\n  \t}\n\n  \treturn adapt;\n\n  \tfunction lookup(adaptor) {\n  \t\tif (typeof adaptor === 'string') {\n  \t\t\tadaptor = findInViewHierarchy('adaptors', ractive, adaptor);\n\n  \t\t\tif (!adaptor) {\n  \t\t\t\tfatal(missingPlugin(adaptor, 'adaptor'));\n  \t\t\t}\n  \t\t}\n\n  \t\treturn adaptor;\n  \t}\n  }\n\n  function initialiseProperties(ractive) {\n  \t// Generate a unique identifier, for places where you'd use a weak map if it\n  \t// existed\n  \tractive._guid = 'r-' + uid++;\n\n  \t// events\n  \tractive._subs = create(null);\n\n  \t// storage for item configuration from instantiation to reset,\n  \t// like dynamic functions or original values\n  \tractive._config = {};\n\n  \t// nodes registry\n  \tractive.nodes = {};\n\n  \t// events\n  \tractive.event = null;\n  \tractive._eventQueue = [];\n\n  \t// live queries\n  \tractive._liveQueries = [];\n  \tractive._liveComponentQueries = [];\n\n  \t// observers\n  \tractive._observers = [];\n\n  \t// links\n  \tractive._links = {};\n\n  \tif (!ractive.component) {\n  \t\tractive.root = ractive;\n  \t\tractive.parent = ractive.container = null; // TODO container still applicable?\n  \t}\n  }\n\n  function deprecateRactiveData() {\n  \tthrow new Error('Using `ractive.data` is no longer supported - you must use the `ractive.get()` API instead');\n  }\n\n  function getChildQueue(queue, ractive) {\n  \treturn queue[ractive._guid] || (queue[ractive._guid] = []);\n  }\n\n  function fire(hookQueue, ractive) {\n  \tvar childQueue = getChildQueue(hookQueue.queue, ractive);\n\n  \thookQueue.hook.fire(ractive);\n\n  \t// queue is \"live\" because components can end up being\n  \t// added while hooks fire on parents that modify data values.\n  \twhile (childQueue.length) {\n  \t\tfire(hookQueue, childQueue.shift());\n  \t}\n\n  \tdelete hookQueue.queue[ractive._guid];\n  }\n\n  var HookQueue = (function () {\n  \tfunction HookQueue(event) {\n  \t\tclassCallCheck(this, HookQueue);\n\n  \t\tthis.hook = new Hook(event);\n  \t\tthis.inProcess = {};\n  \t\tthis.queue = {};\n  \t}\n\n  \tHookQueue.prototype.begin = function begin(ractive) {\n  \t\tthis.inProcess[ractive._guid] = true;\n  \t};\n\n  \tHookQueue.prototype.end = function end(ractive) {\n  \t\tvar parent = ractive.parent;\n\n  \t\t// If this is *isn't* a child of a component that's in process,\n  \t\t// it should call methods or fire at this point\n  \t\tif (!parent || !this.inProcess[parent._guid]) {\n  \t\t\tfire(this, ractive);\n  \t\t}\n  \t\t// elsewise, handoff to parent to fire when ready\n  \t\telse {\n  \t\t\t\tgetChildQueue(this.queue, parent).push(ractive);\n  \t\t\t}\n\n  \t\tdelete this.inProcess[ractive._guid];\n  \t};\n\n  \treturn HookQueue;\n  })();\n\n  var selectorsPattern = /(?:^|\\})?\\s*([^\\{\\}]+)\\s*\\{/g;\n  var commentsPattern = /\\/\\*.*?\\*\\//g;\n  var selectorUnitPattern = /((?:(?:\\[[^\\]+]\\])|(?:[^\\s\\+\\>~:]))+)((?:::?[^\\s\\+\\>\\~\\(:]+(?:\\([^\\)]+\\))?)*\\s*[\\s\\+\\>\\~]?)\\s*/g;\n  var excludePattern = /^(?:@|\\d+%)/;\n  var dataRvcGuidPattern = /\\[data-ractive-css~=\"\\{[a-z0-9-]+\\}\"]/g;\n\n  function trim$1(str) {\n  \treturn str.trim();\n  }\n\n  function extractString(unit) {\n  \treturn unit.str;\n  }\n\n  function transformSelector(selector, parent) {\n  \tvar selectorUnits = [];\n  \tvar match = undefined;\n\n  \twhile (match = selectorUnitPattern.exec(selector)) {\n  \t\tselectorUnits.push({\n  \t\t\tstr: match[0],\n  \t\t\tbase: match[1],\n  \t\t\tmodifiers: match[2]\n  \t\t});\n  \t}\n\n  \t// For each simple selector within the selector, we need to create a version\n  \t// that a) combines with the id, and b) is inside the id\n  \tvar base = selectorUnits.map(extractString);\n\n  \tvar transformed = [];\n  \tvar i = selectorUnits.length;\n\n  \twhile (i--) {\n  \t\tvar appended = base.slice();\n\n  \t\t// Pseudo-selectors should go after the attribute selector\n  \t\tvar unit = selectorUnits[i];\n  \t\tappended[i] = unit.base + parent + unit.modifiers || '';\n\n  \t\tvar prepended = base.slice();\n  \t\tprepended[i] = parent + ' ' + prepended[i];\n\n  \t\ttransformed.push(appended.join(' '), prepended.join(' '));\n  \t}\n\n  \treturn transformed.join(', ');\n  }\n  function transformCss(css, id) {\n  \tvar dataAttr = '[data-ractive-css~=\"{' + id + '}\"]';\n\n  \tvar transformed = undefined;\n\n  \tif (dataRvcGuidPattern.test(css)) {\n  \t\ttransformed = css.replace(dataRvcGuidPattern, dataAttr);\n  \t} else {\n  \t\ttransformed = css.replace(commentsPattern, '').replace(selectorsPattern, function (match, $1) {\n  \t\t\t// don't transform at-rules and keyframe declarations\n  \t\t\tif (excludePattern.test($1)) return match;\n\n  \t\t\tvar selectors = $1.split(',').map(trim$1);\n  \t\t\tvar transformed = selectors.map(function (selector) {\n  \t\t\t\treturn transformSelector(selector, dataAttr);\n  \t\t\t}).join(', ') + ' ';\n\n  \t\t\treturn match.replace($1, transformed);\n  \t\t});\n  \t}\n\n  \treturn transformed;\n  }\n\n  function s4() {\n  \treturn Math.floor((1 + Math.random()) * 0x10000).toString(16).substring(1);\n  }\n\n  function uuid() {\n  \treturn s4() + s4() + '-' + s4() + '-' + s4() + '-' + s4() + '-' + s4() + s4() + s4();\n  }\n\n  var cssConfigurator = {\n  \tname: 'css',\n\n  \t// Called when creating a new component definition\n  \textend: function (Parent, proto, options) {\n  \t\tif (!options.css) return;\n\n  \t\tvar id = uuid();\n  \t\tvar styles = options.noCssTransform ? options.css : transformCss(options.css, id);\n\n  \t\tproto.cssId = id;\n\n  \t\taddCSS({ id: id, styles: styles });\n  \t},\n\n  \t// Called when creating a new component instance\n  \tinit: function (Parent, target, options) {\n  \t\tif (!options.css) return;\n\n  \t\twarnIfDebug('\\nThe css option is currently not supported on a per-instance basis and will be discarded. Instead, we recommend instantiating from a component definition with a css option.\\n\\nconst Component = Ractive.extend({\\n\\t...\\n\\tcss: \\'/* your css */\\',\\n\\t...\\n});\\n\\nconst componentInstance = new Component({ ... })\\n\\t\\t');\n  \t}\n\n  };\n\n  var adaptConfigurator = {\n  \textend: function (Parent, proto, options) {\n  \t\tproto.adapt = combine$2(proto.adapt, ensureArray(options.adapt));\n  \t},\n\n  \tinit: function () {}\n  };\n\n  function combine$2(a, b) {\n  \tvar c = a.slice();\n  \tvar i = b.length;\n\n  \twhile (i--) {\n  \t\tif (! ~c.indexOf(b[i])) {\n  \t\t\tc.push(b[i]);\n  \t\t}\n  \t}\n\n  \treturn c;\n  }\n\n  var registryNames$1 = ['adaptors', 'components', 'computed', 'decorators', 'easing', 'events', 'interpolators', 'partials', 'transitions'];\n\n  var Registry = (function () {\n  \tfunction Registry(name, useDefaults) {\n  \t\tclassCallCheck(this, Registry);\n\n  \t\tthis.name = name;\n  \t\tthis.useDefaults = useDefaults;\n  \t}\n\n  \tRegistry.prototype.extend = function extend(Parent, proto, options) {\n  \t\tthis.configure(this.useDefaults ? Parent.defaults : Parent, this.useDefaults ? proto : proto.constructor, options);\n  \t};\n\n  \tRegistry.prototype.init = function init() {\n  \t\t// noop\n  \t};\n\n  \tRegistry.prototype.configure = function configure(Parent, target, options) {\n  \t\tvar name = this.name;\n  \t\tvar option = options[name];\n\n  \t\tvar registry = create(Parent[name]);\n\n  \t\tfor (var key in option) {\n  \t\t\tregistry[key] = option[key];\n  \t\t}\n\n  \t\ttarget[name] = registry;\n  \t};\n\n  \tRegistry.prototype.reset = function reset(ractive) {\n  \t\tvar registry = ractive[this.name];\n  \t\tvar changed = false;\n\n  \t\tObject.keys(registry).forEach(function (key) {\n  \t\t\tvar item = registry[key];\n\n  \t\t\tif (item._fn) {\n  \t\t\t\tif (item._fn.isOwner) {\n  \t\t\t\t\tregistry[key] = item._fn;\n  \t\t\t\t} else {\n  \t\t\t\t\tdelete registry[key];\n  \t\t\t\t}\n  \t\t\t\tchanged = true;\n  \t\t\t}\n  \t\t});\n\n  \t\treturn changed;\n  \t};\n\n  \treturn Registry;\n  })();\n\n  var registries = registryNames$1.map(function (name) {\n  \treturn new Registry(name, name === 'computed');\n  });\n\n  function wrap(parent, name, method) {\n  \tif (!/_super/.test(method)) return method;\n\n  \tfunction wrapper() {\n  \t\tvar superMethod = getSuperMethod(wrapper._parent, name);\n  \t\tvar hasSuper = ('_super' in this);\n  \t\tvar oldSuper = this._super;\n\n  \t\tthis._super = superMethod;\n\n  \t\tvar result = method.apply(this, arguments);\n\n  \t\tif (hasSuper) {\n  \t\t\tthis._super = oldSuper;\n  \t\t} else {\n  \t\t\tdelete this._super;\n  \t\t}\n\n  \t\treturn result;\n  \t}\n\n  \twrapper._parent = parent;\n  \twrapper._method = method;\n\n  \treturn wrapper;\n  }\n\n  function getSuperMethod(parent, name) {\n  \tif (name in parent) {\n  \t\tvar _ret = (function () {\n  \t\t\tvar value = parent[name];\n\n  \t\t\treturn {\n  \t\t\t\tv: typeof value === 'function' ? value : function () {\n  \t\t\t\t\treturn value;\n  \t\t\t\t}\n  \t\t\t};\n  \t\t})();\n\n  \t\tif (typeof _ret === 'object') return _ret.v;\n  \t}\n\n  \treturn noop;\n  }\n\n  function getMessage(deprecated, correct, isError) {\n  \treturn 'options.' + deprecated + ' has been deprecated in favour of options.' + correct + '.' + (isError ? ' You cannot specify both options, please use options.' + correct + '.' : '');\n  }\n\n  function deprecateOption(options, deprecatedOption, correct) {\n  \tif (deprecatedOption in options) {\n  \t\tif (!(correct in options)) {\n  \t\t\twarnIfDebug(getMessage(deprecatedOption, correct));\n  \t\t\toptions[correct] = options[deprecatedOption];\n  \t\t} else {\n  \t\t\tthrow new Error(getMessage(deprecatedOption, correct, true));\n  \t\t}\n  \t}\n  }\n  function deprecate(options) {\n  \tdeprecateOption(options, 'beforeInit', 'onconstruct');\n  \tdeprecateOption(options, 'init', 'onrender');\n  \tdeprecateOption(options, 'complete', 'oncomplete');\n  \tdeprecateOption(options, 'eventDefinitions', 'events');\n\n  \t// Using extend with Component instead of options,\n  \t// like Human.extend( Spider ) means adaptors as a registry\n  \t// gets copied to options. So we have to check if actually an array\n  \tif (isArray(options.adaptors)) {\n  \t\tdeprecateOption(options, 'adaptors', 'adapt');\n  \t}\n  }\n\n  var custom = {\n  \tadapt: adaptConfigurator,\n  \tcss: cssConfigurator,\n  \tdata: dataConfigurator,\n  \ttemplate: templateConfigurator\n  };\n\n  var defaultKeys = Object.keys(defaults);\n\n  var isStandardKey = makeObj(defaultKeys.filter(function (key) {\n  \treturn !custom[key];\n  }));\n\n  // blacklisted keys that we don't double extend\n  var isBlacklisted = makeObj(defaultKeys.concat(registries.map(function (r) {\n  \treturn r.name;\n  })));\n\n  var order = [].concat(defaultKeys.filter(function (key) {\n  \treturn !registries[key] && !custom[key];\n  }), registries,\n  //custom.data,\n  custom.template, custom.css);\n\n  var config = {\n  \textend: function (Parent, proto, options) {\n  \t\treturn configure('extend', Parent, proto, options);\n  \t},\n\n  \tinit: function (Parent, ractive, options) {\n  \t\treturn configure('init', Parent, ractive, options);\n  \t},\n\n  \treset: function (ractive) {\n  \t\treturn order.filter(function (c) {\n  \t\t\treturn c.reset && c.reset(ractive);\n  \t\t}).map(function (c) {\n  \t\t\treturn c.name;\n  \t\t});\n  \t},\n\n  \t// this defines the order. TODO this isn't used anywhere in the codebase,\n  \t// only in the test suite - should get rid of it\n  \torder: order\n  };\n\n  function configure(method, Parent, target, options) {\n  \tdeprecate(options);\n\n  \tfor (var key in options) {\n  \t\tif (isStandardKey.hasOwnProperty(key)) {\n  \t\t\tvar value = options[key];\n\n  \t\t\t// warn the developer if they passed a function and ignore its value\n\n  \t\t\t// NOTE: we allow some functions on \"el\" because we duck type element lists\n  \t\t\t// and some libraries or ef'ed-up virtual browsers (phantomJS) return a\n  \t\t\t// function object as the result of querySelector methods\n  \t\t\tif (key !== 'el' && typeof value === 'function') {\n  \t\t\t\twarnIfDebug(key + ' is a Ractive option that does not expect a function and will be ignored', method === 'init' ? target : null);\n  \t\t\t} else {\n  \t\t\t\ttarget[key] = value;\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \t// disallow combination of `append` and `enhance`\n  \tif (options.append && options.enhance) {\n  \t\tthrow new Error('Cannot use append and enhance at the same time');\n  \t}\n\n  \tregistries.forEach(function (registry) {\n  \t\tregistry[method](Parent, target, options);\n  \t});\n\n  \tadaptConfigurator[method](Parent, target, options);\n  \ttemplateConfigurator[method](Parent, target, options);\n  \tcssConfigurator[method](Parent, target, options);\n\n  \textendOtherMethods(Parent.prototype, target, options);\n  }\n\n  function extendOtherMethods(parent, target, options) {\n  \tfor (var key in options) {\n  \t\tif (!isBlacklisted[key] && options.hasOwnProperty(key)) {\n  \t\t\tvar member = options[key];\n\n  \t\t\t// if this is a method that overwrites a method, wrap it:\n  \t\t\tif (typeof member === 'function') {\n  \t\t\t\tmember = wrap(parent, key, member);\n  \t\t\t}\n\n  \t\t\ttarget[key] = member;\n  \t\t}\n  \t}\n  }\n\n  function makeObj(array) {\n  \tvar obj = {};\n  \tarray.forEach(function (x) {\n  \t\treturn obj[x] = true;\n  \t});\n  \treturn obj;\n  }\n\n  var configHook = new Hook('config');\n  var initHook = new HookQueue('init');\n  function initialise(ractive, userOptions, options) {\n  \tObject.keys(ractive.viewmodel.computations).forEach(function (key) {\n  \t\tvar computation = ractive.viewmodel.computations[key];\n\n  \t\tif (ractive.viewmodel.value.hasOwnProperty(key)) {\n  \t\t\tcomputation.set(ractive.viewmodel.value[key]);\n  \t\t}\n  \t});\n\n  \t// init config from Parent and options\n  \tconfig.init(ractive.constructor, ractive, userOptions);\n\n  \tconfigHook.fire(ractive);\n  \tinitHook.begin(ractive);\n\n  \tvar fragment = undefined;\n\n  \t// Render virtual DOM\n  \tif (ractive.template) {\n  \t\tvar cssIds = undefined;\n\n  \t\tif (options.cssIds || ractive.cssId) {\n  \t\t\tcssIds = options.cssIds ? options.cssIds.slice() : [];\n\n  \t\t\tif (ractive.cssId) {\n  \t\t\t\tcssIds.push(ractive.cssId);\n  \t\t\t}\n  \t\t}\n\n  \t\tractive.fragment = fragment = new Fragment({\n  \t\t\towner: ractive,\n  \t\t\ttemplate: ractive.template,\n  \t\t\tcssIds: cssIds\n  \t\t}).bind(ractive.viewmodel);\n  \t}\n\n  \tinitHook.end(ractive);\n\n  \tif (fragment) {\n  \t\t// render automatically ( if `el` is specified )\n  \t\tvar el = getElement(ractive.el);\n  \t\tif (el) {\n  \t\t\tvar promise = ractive.render(el, ractive.append);\n\n  \t\t\tif (Ractive.DEBUG_PROMISES) {\n  \t\t\t\tpromise['catch'](function (err) {\n  \t\t\t\t\twarnOnceIfDebug('Promise debugging is enabled, to help solve errors that happen asynchronously. Some browsers will log unhandled promise rejections, in which case you can safely disable promise debugging:\\n  Ractive.DEBUG_PROMISES = false;');\n  \t\t\t\t\twarnIfDebug('An error happened during rendering', { ractive: ractive });\n  \t\t\t\t\terr.stack && logIfDebug(err.stack);\n\n  \t\t\t\t\tthrow err;\n  \t\t\t\t});\n  \t\t\t}\n  \t\t}\n  \t}\n  }\n\n  var renderHook$1 = new Hook('render');\n  var completeHook$1 = new Hook('complete');\n  function render(ractive, target, anchor, occupants) {\n  \t// if `noIntro` is `true`, temporarily disable transitions\n  \tvar transitionsEnabled = ractive.transitionsEnabled;\n  \tif (ractive.noIntro) ractive.transitionsEnabled = false;\n\n  \tvar promise = runloop.start(ractive, true);\n  \trunloop.scheduleTask(function () {\n  \t\treturn renderHook$1.fire(ractive);\n  \t}, true);\n\n  \tif (ractive.fragment.rendered) {\n  \t\tthrow new Error('You cannot call ractive.render() on an already rendered instance! Call ractive.unrender() first');\n  \t}\n\n  \tanchor = getElement(anchor) || ractive.anchor;\n\n  \tractive.el = target;\n  \tractive.anchor = anchor;\n\n  \t// ensure encapsulated CSS is up-to-date\n  \tif (ractive.cssId) applyCSS();\n\n  \tif (target) {\n  \t\t(target.__ractive_instances__ || (target.__ractive_instances__ = [])).push(ractive);\n\n  \t\tif (anchor) {\n  \t\t\tvar docFrag = doc.createDocumentFragment();\n  \t\t\tractive.fragment.render(docFrag);\n  \t\t\ttarget.insertBefore(docFrag, anchor);\n  \t\t} else {\n  \t\t\tractive.fragment.render(target, occupants);\n  \t\t}\n  \t}\n\n  \trunloop.end();\n  \tractive.transitionsEnabled = transitionsEnabled;\n\n  \treturn promise.then(function () {\n  \t\treturn completeHook$1.fire(ractive);\n  \t});\n  }\n\n  var Parser;\n  var ParseError;\n  var leadingWhitespace = /^\\s+/;\n  ParseError = function (message) {\n  \tthis.name = 'ParseError';\n  \tthis.message = message;\n  \ttry {\n  \t\tthrow new Error(message);\n  \t} catch (e) {\n  \t\tthis.stack = e.stack;\n  \t}\n  };\n\n  ParseError.prototype = Error.prototype;\n\n  Parser = function (str, options) {\n  \tvar items,\n  \t    item,\n  \t    lineStart = 0;\n\n  \tthis.str = str;\n  \tthis.options = options || {};\n  \tthis.pos = 0;\n\n  \tthis.lines = this.str.split('\\n');\n  \tthis.lineEnds = this.lines.map(function (line) {\n  \t\tvar lineEnd = lineStart + line.length + 1; // +1 for the newline\n\n  \t\tlineStart = lineEnd;\n  \t\treturn lineEnd;\n  \t}, 0);\n\n  \t// Custom init logic\n  \tif (this.init) this.init(str, options);\n\n  \titems = [];\n\n  \twhile (this.pos < this.str.length && (item = this.read())) {\n  \t\titems.push(item);\n  \t}\n\n  \tthis.leftover = this.remaining();\n  \tthis.result = this.postProcess ? this.postProcess(items, options) : items;\n  };\n\n  Parser.prototype = {\n  \tread: function (converters) {\n  \t\tvar pos, i, len, item;\n\n  \t\tif (!converters) converters = this.converters;\n\n  \t\tpos = this.pos;\n\n  \t\tlen = converters.length;\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tthis.pos = pos; // reset for each attempt\n\n  \t\t\tif (item = converters[i](this)) {\n  \t\t\t\treturn item;\n  \t\t\t}\n  \t\t}\n\n  \t\treturn null;\n  \t},\n\n  \tgetLinePos: function (char) {\n  \t\tvar lineNum = 0,\n  \t\t    lineStart = 0,\n  \t\t    columnNum;\n\n  \t\twhile (char >= this.lineEnds[lineNum]) {\n  \t\t\tlineStart = this.lineEnds[lineNum];\n  \t\t\tlineNum += 1;\n  \t\t}\n\n  \t\tcolumnNum = char - lineStart;\n  \t\treturn [lineNum + 1, columnNum + 1, char]; // line/col should be one-based, not zero-based!\n  \t},\n\n  \terror: function (message) {\n  \t\tvar pos = this.getLinePos(this.pos);\n  \t\tvar lineNum = pos[0];\n  \t\tvar columnNum = pos[1];\n\n  \t\tvar line = this.lines[pos[0] - 1];\n  \t\tvar numTabs = 0;\n  \t\tvar annotation = line.replace(/\\t/g, function (match, char) {\n  \t\t\tif (char < pos[1]) {\n  \t\t\t\tnumTabs += 1;\n  \t\t\t}\n\n  \t\t\treturn '  ';\n  \t\t}) + '\\n' + new Array(pos[1] + numTabs).join(' ') + '^----';\n\n  \t\tvar error = new ParseError(message + ' at line ' + lineNum + ' character ' + columnNum + ':\\n' + annotation);\n\n  \t\terror.line = pos[0];\n  \t\terror.character = pos[1];\n  \t\terror.shortMessage = message;\n\n  \t\tthrow error;\n  \t},\n\n  \tmatchString: function (string) {\n  \t\tif (this.str.substr(this.pos, string.length) === string) {\n  \t\t\tthis.pos += string.length;\n  \t\t\treturn string;\n  \t\t}\n  \t},\n\n  \tmatchPattern: function (pattern) {\n  \t\tvar match;\n\n  \t\tif (match = pattern.exec(this.remaining())) {\n  \t\t\tthis.pos += match[0].length;\n  \t\t\treturn match[1] || match[0];\n  \t\t}\n  \t},\n\n  \tallowWhitespace: function () {\n  \t\tthis.matchPattern(leadingWhitespace);\n  \t},\n\n  \tremaining: function () {\n  \t\treturn this.str.substring(this.pos);\n  \t},\n\n  \tnextChar: function () {\n  \t\treturn this.str.charAt(this.pos);\n  \t}\n  };\n\n  Parser.extend = function (proto) {\n  \tvar Parent = this,\n  \t    Child,\n  \t    key;\n\n  \tChild = function (str, options) {\n  \t\tParser.call(this, str, options);\n  \t};\n\n  \tChild.prototype = create(Parent.prototype);\n\n  \tfor (key in proto) {\n  \t\tif (hasOwn.call(proto, key)) {\n  \t\t\tChild.prototype[key] = proto[key];\n  \t\t}\n  \t}\n\n  \tChild.extend = Parser.extend;\n  \treturn Child;\n  };\n\n  var Parser$1 = Parser;\n\n  var stringMiddlePattern;\n  var escapeSequencePattern;\n  var lineContinuationPattern;\n  // Match one or more characters until: \", ', \\, or EOL/EOF.\n  // EOL/EOF is written as (?!.) (meaning there's no non-newline char next).\n  stringMiddlePattern = /^(?=.)[^\"'\\\\]+?(?:(?!.)|(?=[\"'\\\\]))/;\n\n  // Match one escape sequence, including the backslash.\n  escapeSequencePattern = /^\\\\(?:['\"\\\\bfnrt]|0(?![0-9])|x[0-9a-fA-F]{2}|u[0-9a-fA-F]{4}|(?=.)[^ux0-9])/;\n\n  // Match one ES5 line continuation (backslash + line terminator).\n  lineContinuationPattern = /^\\\\(?:\\r\\n|[\\u000A\\u000D\\u2028\\u2029])/;\n\n  // Helper for defining getDoubleQuotedString and getSingleQuotedString.\n  function makeQuotedStringMatcher (okQuote) {\n  \treturn function (parser) {\n  \t\tvar literal = '\"';\n  \t\tvar done = false;\n  \t\tvar next = undefined;\n\n  \t\twhile (!done) {\n  \t\t\tnext = parser.matchPattern(stringMiddlePattern) || parser.matchPattern(escapeSequencePattern) || parser.matchString(okQuote);\n  \t\t\tif (next) {\n  \t\t\t\tif (next === '\"') {\n  \t\t\t\t\tliteral += '\\\\\"';\n  \t\t\t\t} else if (next === '\\\\\\'') {\n  \t\t\t\t\tliteral += '\\'';\n  \t\t\t\t} else {\n  \t\t\t\t\tliteral += next;\n  \t\t\t\t}\n  \t\t\t} else {\n  \t\t\t\tnext = parser.matchPattern(lineContinuationPattern);\n  \t\t\t\tif (next) {\n  \t\t\t\t\t// convert \\(newline-like) into a \\u escape, which is allowed in JSON\n  \t\t\t\t\tliteral += '\\\\u' + ('000' + next.charCodeAt(1).toString(16)).slice(-4);\n  \t\t\t\t} else {\n  \t\t\t\t\tdone = true;\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\tliteral += '\"';\n\n  \t\t// use JSON.parse to interpret escapes\n  \t\treturn JSON.parse(literal);\n  \t};\n  }\n\n  var getSingleQuotedString = makeQuotedStringMatcher('\"');\n  var getDoubleQuotedString = makeQuotedStringMatcher('\\'');\n\n  function readStringLiteral (parser) {\n  \tvar start, string;\n\n  \tstart = parser.pos;\n\n  \tif (parser.matchString('\"')) {\n  \t\tstring = getDoubleQuotedString(parser);\n\n  \t\tif (!parser.matchString('\"')) {\n  \t\t\tparser.pos = start;\n  \t\t\treturn null;\n  \t\t}\n\n  \t\treturn {\n  \t\t\tt: STRING_LITERAL,\n  \t\t\tv: string\n  \t\t};\n  \t}\n\n  \tif (parser.matchString('\\'')) {\n  \t\tstring = getSingleQuotedString(parser);\n\n  \t\tif (!parser.matchString('\\'')) {\n  \t\t\tparser.pos = start;\n  \t\t\treturn null;\n  \t\t}\n\n  \t\treturn {\n  \t\t\tt: STRING_LITERAL,\n  \t\t\tv: string\n  \t\t};\n  \t}\n\n  \treturn null;\n  }\n\n  // bulletproof number regex from https://gist.github.com/Rich-Harris/7544330\n  var numberPattern$1 = /^(?:[+-]?)0*(?:(?:(?:[1-9]\\d*)?\\.\\d+)|(?:(?:0|[1-9]\\d*)\\.)|(?:0|[1-9]\\d*))(?:[eE][+-]?\\d+)?/;\n  function readNumberLiteral(parser) {\n  \tvar result;\n\n  \tif (result = parser.matchPattern(numberPattern$1)) {\n  \t\treturn {\n  \t\t\tt: NUMBER_LITERAL,\n  \t\t\tv: result\n  \t\t};\n  \t}\n\n  \treturn null;\n  }\n\n  var name = /^[a-zA-Z_$][a-zA-Z_$0-9]*/;\n\n  var identifier = /^[a-zA-Z_$][a-zA-Z_$0-9]*$/;\n\n  // http://mathiasbynens.be/notes/javascript-properties\n  // can be any name, string literal, or number literal\n\n  function readKey(parser) {\n  \tvar token;\n\n  \tif (token = readStringLiteral(parser)) {\n  \t\treturn identifier.test(token.v) ? token.v : '\"' + token.v.replace(/\"/g, '\\\\\"') + '\"';\n  \t}\n\n  \tif (token = readNumberLiteral(parser)) {\n  \t\treturn token.v;\n  \t}\n\n  \tif (token = parser.matchPattern(name)) {\n  \t\treturn token;\n  \t}\n\n  \treturn null;\n  }\n\n  // simple JSON parser, without the restrictions of JSON parse\n  // (i.e. having to double-quote keys).\n  //\n  // If passed a hash of values as the second argument, ${placeholders}\n  // will be replaced with those values\n\n  var specials = {\n  \t'true': true,\n  \t'false': false,\n  \t'null': null,\n  \tundefined: undefined\n  };\n\n  var specialsPattern = new RegExp('^(?:' + Object.keys(specials).join('|') + ')');\n  var numberPattern = /^(?:[+-]?)(?:(?:(?:0|[1-9]\\d*)?\\.\\d+)|(?:(?:0|[1-9]\\d*)\\.)|(?:0|[1-9]\\d*))(?:[eE][+-]?\\d+)?/;\n  var placeholderPattern = /\\$\\{([^\\}]+)\\}/g;\n  var placeholderAtStartPattern = /^\\$\\{([^\\}]+)\\}/;\n  var onlyWhitespace = /^\\s*$/;\n\n  var JsonParser = Parser$1.extend({\n  \tinit: function (str, options) {\n  \t\tthis.values = options.values;\n  \t\tthis.allowWhitespace();\n  \t},\n\n  \tpostProcess: function (result) {\n  \t\tif (result.length !== 1 || !onlyWhitespace.test(this.leftover)) {\n  \t\t\treturn null;\n  \t\t}\n\n  \t\treturn { value: result[0].v };\n  \t},\n\n  \tconverters: [function getPlaceholder(parser) {\n  \t\tif (!parser.values) return null;\n\n  \t\tvar placeholder = parser.matchPattern(placeholderAtStartPattern);\n\n  \t\tif (placeholder && parser.values.hasOwnProperty(placeholder)) {\n  \t\t\treturn { v: parser.values[placeholder] };\n  \t\t}\n  \t}, function getSpecial(parser) {\n  \t\tvar special = parser.matchPattern(specialsPattern);\n  \t\tif (special) return { v: specials[special] };\n  \t}, function getNumber(parser) {\n  \t\tvar number = parser.matchPattern(numberPattern);\n  \t\tif (number) return { v: +number };\n  \t}, function getString(parser) {\n  \t\tvar stringLiteral = readStringLiteral(parser);\n  \t\tvar values = parser.values;\n\n  \t\tif (stringLiteral && values) {\n  \t\t\treturn {\n  \t\t\t\tv: stringLiteral.v.replace(placeholderPattern, function (match, $1) {\n  \t\t\t\t\treturn $1 in values ? values[$1] : $1;\n  \t\t\t\t})\n  \t\t\t};\n  \t\t}\n\n  \t\treturn stringLiteral;\n  \t}, function getObject(parser) {\n  \t\tif (!parser.matchString('{')) return null;\n\n  \t\tvar result = {};\n\n  \t\tparser.allowWhitespace();\n\n  \t\tif (parser.matchString('}')) {\n  \t\t\treturn { v: result };\n  \t\t}\n\n  \t\tvar pair = undefined;\n  \t\twhile (pair = getKeyValuePair(parser)) {\n  \t\t\tresult[pair.key] = pair.value;\n\n  \t\t\tparser.allowWhitespace();\n\n  \t\t\tif (parser.matchString('}')) {\n  \t\t\t\treturn { v: result };\n  \t\t\t}\n\n  \t\t\tif (!parser.matchString(',')) {\n  \t\t\t\treturn null;\n  \t\t\t}\n  \t\t}\n\n  \t\treturn null;\n  \t}, function getArray(parser) {\n  \t\tif (!parser.matchString('[')) return null;\n\n  \t\tvar result = [];\n\n  \t\tparser.allowWhitespace();\n\n  \t\tif (parser.matchString(']')) {\n  \t\t\treturn { v: result };\n  \t\t}\n\n  \t\tvar valueToken = undefined;\n  \t\twhile (valueToken = parser.read()) {\n  \t\t\tresult.push(valueToken.v);\n\n  \t\t\tparser.allowWhitespace();\n\n  \t\t\tif (parser.matchString(']')) {\n  \t\t\t\treturn { v: result };\n  \t\t\t}\n\n  \t\t\tif (!parser.matchString(',')) {\n  \t\t\t\treturn null;\n  \t\t\t}\n\n  \t\t\tparser.allowWhitespace();\n  \t\t}\n\n  \t\treturn null;\n  \t}]\n  });\n\n  function getKeyValuePair(parser) {\n  \tparser.allowWhitespace();\n\n  \tvar key = readKey(parser);\n\n  \tif (!key) return null;\n\n  \tvar pair = { key: key };\n\n  \tparser.allowWhitespace();\n  \tif (!parser.matchString(':')) {\n  \t\treturn null;\n  \t}\n  \tparser.allowWhitespace();\n\n  \tvar valueToken = parser.read();\n\n  \tif (!valueToken) return null;\n\n  \tpair.value = valueToken.v;\n  \treturn pair;\n  }\n\n  function parseJSON (str, values) {\n  \tvar parser = new JsonParser(str, { values: values });\n  \treturn parser.result;\n  }\n\n  var RactiveEvent = (function () {\n  \tfunction RactiveEvent(ractive, name) {\n  \t\tclassCallCheck(this, RactiveEvent);\n\n  \t\tthis.ractive = ractive;\n  \t\tthis.name = name;\n  \t\tthis.handler = null;\n  \t}\n\n  \tRactiveEvent.prototype.listen = function listen(directive) {\n  \t\tvar ractive = this.ractive;\n\n  \t\tthis.handler = ractive.on(this.name, function () {\n  \t\t\tvar event = undefined;\n\n  \t\t\t// semi-weak test, but what else? tag the event obj ._isEvent ?\n  \t\t\tif (arguments.length && arguments[0] && arguments[0].node) {\n  \t\t\t\tevent = Array.prototype.shift.call(arguments);\n  \t\t\t\tevent.component = ractive;\n  \t\t\t}\n\n  \t\t\tvar args = Array.prototype.slice.call(arguments);\n  \t\t\tdirective.fire(event, args);\n\n  \t\t\t// cancel bubbling\n  \t\t\treturn false;\n  \t\t});\n  \t};\n\n  \tRactiveEvent.prototype.unlisten = function unlisten() {\n  \t\tthis.handler.cancel();\n  \t};\n\n  \treturn RactiveEvent;\n  })();\n\n  // TODO it's unfortunate that this has to run every time a\n  // component is rendered... is there a better way?\n\n  function updateLiveQueries(component) {\n  \t// Does this need to be added to any live queries?\n  \tvar instance = component.ractive;\n\n  \tdo {\n  \t\tvar liveQueries = instance._liveComponentQueries;\n\n  \t\tvar i = liveQueries.length;\n  \t\twhile (i--) {\n  \t\t\tvar _name = liveQueries[i];\n  \t\t\tvar query = liveQueries[\"_\" + _name];\n\n  \t\t\tif (query.test(component)) {\n  \t\t\t\tquery.add(component.instance);\n  \t\t\t\t// keep register of applicable selectors, for when we teardown\n  \t\t\t\tcomponent.liveQueries.push(query);\n  \t\t\t}\n  \t\t}\n  \t} while (instance = instance.parent);\n  }\n\n  function removeFromLiveComponentQueries(component) {\n  \tvar instance = component.ractive;\n\n  \twhile (instance) {\n  \t\tvar query = instance._liveComponentQueries['_' + component.name];\n  \t\tif (query) query.remove(component);\n\n  \t\tinstance = instance.parent;\n  \t}\n  }\n\n  function makeDirty(query) {\n  \tquery.makeDirty();\n  }\n\n  var teardownHook$1 = new Hook('teardown');\n\n  var Component = (function (_Item) {\n  \tinherits(Component, _Item);\n\n  \tfunction Component(options, ComponentConstructor) {\n  \t\tclassCallCheck(this, Component);\n\n  \t\t_Item.call(this, options);\n  \t\tthis.type = COMPONENT; // override ELEMENT from super\n\n  \t\tvar instance = create(ComponentConstructor.prototype);\n\n  \t\tthis.instance = instance;\n  \t\tthis.name = options.template.e;\n  \t\tthis.parentFragment = options.parentFragment;\n  \t\tthis.complexMappings = [];\n\n  \t\tthis.liveQueries = [];\n\n  \t\tif (instance.el) {\n  \t\t\twarnIfDebug('The <' + this.name + '> component has a default \\'el\\' property; it has been disregarded');\n  \t\t}\n\n  \t\tvar partials = options.template.p || {};\n  \t\tif (!('content' in partials)) partials.content = options.template.f || [];\n  \t\tthis._partials = partials; // TEMP\n\n  \t\tthis.yielders = {};\n\n  \t\t// find container\n  \t\tvar fragment = options.parentFragment;\n  \t\tvar container = undefined;\n  \t\twhile (fragment) {\n  \t\t\tif (fragment.owner.type === YIELDER) {\n  \t\t\t\tcontainer = fragment.owner.container;\n  \t\t\t\tbreak;\n  \t\t\t}\n\n  \t\t\tfragment = fragment.parent;\n  \t\t}\n\n  \t\t// add component-instance-specific properties\n  \t\tinstance.parent = this.parentFragment.ractive;\n  \t\tinstance.container = container || null;\n  \t\tinstance.root = instance.parent.root;\n  \t\tinstance.component = this;\n\n  \t\tconstruct(this.instance, { partials: partials });\n\n  \t\t// for hackability, this could be an open option\n  \t\t// for any ractive instance, but for now, just\n  \t\t// for components and just for ractive...\n  \t\tinstance._inlinePartials = partials;\n\n  \t\tthis.eventHandlers = [];\n  \t\tif (this.template.v) this.setupEvents();\n  \t}\n\n  \tComponent.prototype.bind = function bind() {\n  \t\tvar _this = this;\n\n  \t\tvar viewmodel = this.instance.viewmodel;\n  \t\tvar childData = viewmodel.value;\n\n  \t\t// determine mappings\n  \t\tif (this.template.a) {\n  \t\t\tObject.keys(this.template.a).forEach(function (localKey) {\n  \t\t\t\tvar template = _this.template.a[localKey];\n  \t\t\t\tvar model = undefined;\n  \t\t\t\tvar fragment = undefined;\n\n  \t\t\t\tif (template === 0) {\n  \t\t\t\t\t// empty attributes are `true`\n  \t\t\t\t\tviewmodel.joinKey(localKey).set(true);\n  \t\t\t\t} else if (typeof template === 'string') {\n  \t\t\t\t\tvar parsed = parseJSON(template);\n  \t\t\t\t\tviewmodel.joinKey(localKey).set(parsed ? parsed.value : template);\n  \t\t\t\t} else if (isArray(template)) {\n  \t\t\t\t\tif (template.length === 1 && template[0].t === INTERPOLATOR) {\n  \t\t\t\t\t\tmodel = resolve$1(_this.parentFragment, template[0]);\n\n  \t\t\t\t\t\tif (!model) {\n  \t\t\t\t\t\t\twarnOnceIfDebug('The ' + localKey + '=\\'{{' + template[0].r + '}}\\' mapping is ambiguous, and may cause unexpected results. Consider initialising your data to eliminate the ambiguity', { ractive: _this.instance }); // TODO add docs page explaining this\n  \t\t\t\t\t\t\t_this.parentFragment.ractive.get(localKey); // side-effect: create mappings as necessary\n  \t\t\t\t\t\t\tmodel = _this.parentFragment.findContext().joinKey(localKey);\n  \t\t\t\t\t\t}\n\n  \t\t\t\t\t\tviewmodel.map(localKey, model);\n\n  \t\t\t\t\t\tif (model.get() === undefined && localKey in childData) {\n  \t\t\t\t\t\t\tmodel.set(childData[localKey]);\n  \t\t\t\t\t\t}\n  \t\t\t\t\t} else {\n  \t\t\t\t\t\tfragment = new Fragment({\n  \t\t\t\t\t\t\towner: _this,\n  \t\t\t\t\t\t\ttemplate: template\n  \t\t\t\t\t\t}).bind();\n\n  \t\t\t\t\t\tmodel = viewmodel.joinKey(localKey);\n  \t\t\t\t\t\tmodel.set(fragment.valueOf());\n\n  \t\t\t\t\t\t// this is a *bit* of a hack\n  \t\t\t\t\t\tfragment.bubble = function () {\n  \t\t\t\t\t\t\tFragment.prototype.bubble.call(fragment);\n  \t\t\t\t\t\t\tfragment.update();\n  \t\t\t\t\t\t\tmodel.set(fragment.valueOf());\n  \t\t\t\t\t\t};\n\n  \t\t\t\t\t\t_this.complexMappings.push(fragment);\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t\t});\n  \t\t}\n\n  \t\tinitialise(this.instance, {\n  \t\t\tpartials: this._partials\n  \t\t}, {\n  \t\t\tcssIds: this.parentFragment.cssIds\n  \t\t});\n\n  \t\tthis.eventHandlers.forEach(_bind);\n  \t};\n\n  \tComponent.prototype.bubble = function bubble() {\n  \t\tif (!this.dirty) {\n  \t\t\tthis.dirty = true;\n  \t\t\tthis.parentFragment.bubble();\n  \t\t}\n  \t};\n\n  \tComponent.prototype.checkYielders = function checkYielders() {\n  \t\tvar _this2 = this;\n\n  \t\tObject.keys(this.yielders).forEach(function (name) {\n  \t\t\tif (_this2.yielders[name].length > 1) {\n  \t\t\t\trunloop.end();\n  \t\t\t\tthrow new Error('A component template can only have one {{yield' + (name ? ' ' + name : '') + '}} declaration at a time');\n  \t\t\t}\n  \t\t});\n  \t};\n\n  \tComponent.prototype.detach = function detach() {\n  \t\treturn this.instance.fragment.detach();\n  \t};\n\n  \tComponent.prototype.find = function find(selector) {\n  \t\treturn this.instance.fragment.find(selector);\n  \t};\n\n  \tComponent.prototype.findAll = function findAll(selector, query) {\n  \t\tthis.instance.fragment.findAll(selector, query);\n  \t};\n\n  \tComponent.prototype.findComponent = function findComponent(name) {\n  \t\tif (!name || this.name === name) return this.instance;\n\n  \t\tif (this.instance.fragment) {\n  \t\t\treturn this.instance.fragment.findComponent(name);\n  \t\t}\n  \t};\n\n  \tComponent.prototype.findAllComponents = function findAllComponents(name, query) {\n  \t\tif (query.test(this)) {\n  \t\t\tquery.add(this.instance);\n\n  \t\t\tif (query.live) {\n  \t\t\t\tthis.liveQueries.push(query);\n  \t\t\t}\n  \t\t}\n\n  \t\tthis.instance.fragment.findAllComponents(name, query);\n  \t};\n\n  \tComponent.prototype.firstNode = function firstNode(skipParent) {\n  \t\treturn this.instance.fragment.firstNode(skipParent);\n  \t};\n\n  \tComponent.prototype.rebind = function rebind() {\n  \t\tvar _this3 = this;\n\n  \t\tthis.complexMappings.forEach(_rebind);\n\n  \t\tthis.liveQueries.forEach(makeDirty);\n\n  \t\t// update relevant mappings\n  \t\tvar viewmodel = this.instance.viewmodel;\n  \t\tviewmodel.mappings = {};\n\n  \t\tif (this.template.a) {\n  \t\t\tObject.keys(this.template.a).forEach(function (localKey) {\n  \t\t\t\tvar template = _this3.template.a[localKey];\n  \t\t\t\tvar model = undefined;\n\n  \t\t\t\tif (isArray(template) && template.length === 1 && template[0].t === INTERPOLATOR) {\n  \t\t\t\t\tmodel = resolve$1(_this3.parentFragment, template[0]);\n\n  \t\t\t\t\tif (!model) {\n  \t\t\t\t\t\t// TODO is this even possible?\n  \t\t\t\t\t\twarnOnceIfDebug('The ' + localKey + '=\\'{{' + template[0].r + '}}\\' mapping is ambiguous, and may cause unexpected results. Consider initialising your data to eliminate the ambiguity', { ractive: _this3.instance });\n  \t\t\t\t\t\t_this3.parentFragment.ractive.get(localKey); // side-effect: create mappings as necessary\n  \t\t\t\t\t\tmodel = _this3.parentFragment.findContext().joinKey(localKey);\n  \t\t\t\t\t}\n\n  \t\t\t\t\tviewmodel.map(localKey, model);\n  \t\t\t\t}\n  \t\t\t});\n  \t\t}\n\n  \t\tthis.instance.fragment.rebind(viewmodel);\n  \t};\n\n  \tComponent.prototype.render = function render$$(target, occupants) {\n  \t\trender(this.instance, target, null, occupants);\n\n  \t\tthis.checkYielders();\n  \t\tthis.eventHandlers.forEach(_render);\n  \t\tupdateLiveQueries(this);\n\n  \t\tthis.rendered = true;\n  \t};\n\n  \tComponent.prototype.setupEvents = function setupEvents() {\n  \t\tvar _this4 = this;\n\n  \t\tvar handlers = this.eventHandlers;\n\n  \t\tObject.keys(this.template.v).forEach(function (key) {\n  \t\t\tvar eventNames = key.split('-');\n  \t\t\tvar template = _this4.template.v[key];\n\n  \t\t\teventNames.forEach(function (eventName) {\n  \t\t\t\tvar event = new RactiveEvent(_this4.instance, eventName);\n  \t\t\t\thandlers.push(new EventDirective(_this4, event, template));\n  \t\t\t});\n  \t\t});\n  \t};\n\n  \tComponent.prototype.toString = function toString() {\n  \t\treturn this.instance.toHTML();\n  \t};\n\n  \tComponent.prototype.unbind = function unbind() {\n  \t\tthis.complexMappings.forEach(_unbind);\n\n  \t\tvar instance = this.instance;\n  \t\tinstance.viewmodel.teardown();\n  \t\tinstance.fragment.unbind();\n  \t\tinstance._observers.forEach(cancel);\n\n  \t\tremoveFromLiveComponentQueries(this);\n\n  \t\tif (instance.fragment.rendered && instance.el.__ractive_instances__) {\n  \t\t\tremoveFromArray(instance.el.__ractive_instances__, instance);\n  \t\t}\n\n  \t\tObject.keys(instance._links).forEach(function (k) {\n  \t\t\treturn instance._links[k].unlink();\n  \t\t});\n\n  \t\tteardownHook$1.fire(instance);\n  \t};\n\n  \tComponent.prototype.unrender = function unrender(shouldDestroy) {\n  \t\tvar _this5 = this;\n\n  \t\tthis.shouldDestroy = shouldDestroy;\n  \t\tthis.instance.unrender();\n  \t\tthis.eventHandlers.forEach(_unrender);\n  \t\tthis.liveQueries.forEach(function (query) {\n  \t\t\treturn query.remove(_this5.instance);\n  \t\t});\n  \t};\n\n  \tComponent.prototype.update = function update() {\n  \t\tthis.dirty = false;\n  \t\tthis.instance.fragment.update();\n  \t\tthis.checkYielders();\n  \t\tthis.eventHandlers.forEach(_update);\n  \t\tthis.complexMappings.forEach(_update);\n  \t};\n\n  \treturn Component;\n  })(Item);\n\n  var Text = (function (_Item) {\n  \tinherits(Text, _Item);\n\n  \tfunction Text(options) {\n  \t\tclassCallCheck(this, Text);\n\n  \t\t_Item.call(this, options);\n  \t\tthis.type = TEXT;\n  \t}\n\n  \tText.prototype.bind = function bind() {\n  \t\t// noop\n  \t};\n\n  \tText.prototype.detach = function detach() {\n  \t\treturn detachNode(this.node);\n  \t};\n\n  \tText.prototype.firstNode = function firstNode() {\n  \t\treturn this.node;\n  \t};\n\n  \tText.prototype.rebind = function rebind() {\n  \t\t// noop\n  \t};\n\n  \tText.prototype.render = function render(target, occupants) {\n  \t\tthis.rendered = true;\n\n  \t\tif (occupants) {\n  \t\t\tvar n = occupants[0];\n  \t\t\tif (n && n.nodeType === 3) {\n  \t\t\t\toccupants.shift();\n  \t\t\t\tif (n.nodeValue !== this.template) {\n  \t\t\t\t\tn.nodeValue = this.template;\n  \t\t\t\t}\n  \t\t\t} else {\n  \t\t\t\tn = this.node = doc.createTextNode(this.template);\n  \t\t\t\tif (occupants[0]) {\n  \t\t\t\t\ttarget.insertBefore(n, occupants[0]);\n  \t\t\t\t} else {\n  \t\t\t\t\ttarget.appendChild(n);\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\tthis.node = n;\n  \t\t} else {\n  \t\t\tthis.node = doc.createTextNode(this.template);\n  \t\t\ttarget.appendChild(this.node);\n  \t\t}\n  \t};\n\n  \tText.prototype.toString = function toString(escape) {\n  \t\treturn escape ? escapeHtml(this.template) : this.template;\n  \t};\n\n  \tText.prototype.unbind = function unbind() {\n  \t\t// noop\n  \t};\n\n  \tText.prototype.unrender = function unrender(shouldDestroy) {\n  \t\tif (this.rendered && shouldDestroy) this.detach();\n  \t\tthis.rendered = false;\n  \t};\n\n  \tText.prototype.update = function update() {\n  \t\t// noop\n  \t};\n\n  \tText.prototype.valueOf = function valueOf() {\n  \t\treturn this.template;\n  \t};\n\n  \treturn Text;\n  })(Item);\n\n  // finds the component constructor in the registry or view hierarchy registries\n\n  function getComponentConstructor(ractive, name) {\n  \tvar instance = findInstance('components', ractive, name);\n  \tvar Component = undefined;\n\n  \tif (instance) {\n  \t\tComponent = instance.components[name];\n\n  \t\t// best test we have for not Ractive.extend\n  \t\tif (!Component._Parent) {\n  \t\t\t// function option, execute and store for reset\n  \t\t\tvar fn = Component.bind(instance);\n  \t\t\tfn.isOwner = instance.components.hasOwnProperty(name);\n  \t\t\tComponent = fn();\n\n  \t\t\tif (!Component) {\n  \t\t\t\twarnIfDebug(noRegistryFunctionReturn, name, 'component', 'component', { ractive: ractive });\n  \t\t\t\treturn;\n  \t\t\t}\n\n  \t\t\tif (typeof Component === 'string') {\n  \t\t\t\t// allow string lookup\n  \t\t\t\tComponent = getComponentConstructor(ractive, Component);\n  \t\t\t}\n\n  \t\t\tComponent._fn = fn;\n  \t\t\tinstance.components[name] = Component;\n  \t\t}\n  \t}\n\n  \treturn Component;\n  }\n\n  var constructors = {};\n  constructors[ALIAS] = Alias;\n  constructors[DOCTYPE] = Doctype;\n  constructors[INTERPOLATOR] = Interpolator;\n  constructors[PARTIAL] = Partial;\n  constructors[SECTION] = Section;\n  constructors[TRIPLE] = Triple;\n  constructors[YIELDER] = Yielder;\n\n  var specialElements = {\n  \tdoctype: Doctype,\n  \tform: Form,\n  \tinput: Input,\n  \toption: Option,\n  \tselect: Select,\n  \ttextarea: Textarea\n  };\n  function createItem(options) {\n  \tif (typeof options.template === 'string') {\n  \t\treturn new Text(options);\n  \t}\n\n  \tif (options.template.t === ELEMENT) {\n  \t\t// could be component or element\n  \t\tvar ComponentConstructor = getComponentConstructor(options.parentFragment.ractive, options.template.e);\n  \t\tif (ComponentConstructor) {\n  \t\t\treturn new Component(options, ComponentConstructor);\n  \t\t}\n\n  \t\tvar tagName = options.template.e.toLowerCase();\n\n  \t\tvar ElementConstructor = specialElements[tagName] || Element;\n  \t\treturn new ElementConstructor(options);\n  \t}\n\n  \tvar Item = constructors[options.template.t];\n\n  \tif (!Item) throw new Error('Unrecognised item type ' + options.template.t);\n\n  \treturn new Item(options);\n  }\n\n  var ReferenceResolver = (function () {\n  \tfunction ReferenceResolver(fragment, reference, callback) {\n  \t\tclassCallCheck(this, ReferenceResolver);\n\n  \t\tthis.fragment = fragment;\n  \t\tthis.reference = normalise(reference);\n  \t\tthis.callback = callback;\n\n  \t\tthis.keys = splitKeypath(reference);\n  \t\tthis.resolved = false;\n\n  \t\t// TODO the consumer should take care of addUnresolved\n  \t\t// we attach to all the contexts between here and the root\n  \t\t// - whenever their values change, they can quickly\n  \t\t// check to see if we can resolve\n  \t\twhile (fragment) {\n  \t\t\tif (fragment.context) {\n  \t\t\t\tfragment.context.addUnresolved(this.keys[0], this);\n  \t\t\t}\n\n  \t\t\tfragment = fragment.componentParent || fragment.parent;\n  \t\t}\n  \t}\n\n  \tReferenceResolver.prototype.attemptResolution = function attemptResolution() {\n  \t\tif (this.resolved) return;\n\n  \t\tvar model = resolveAmbiguousReference(this.fragment, this.reference);\n\n  \t\tif (model) {\n  \t\t\tthis.resolved = true;\n  \t\t\tthis.callback(model);\n  \t\t}\n  \t};\n\n  \tReferenceResolver.prototype.forceResolution = function forceResolution() {\n  \t\tif (this.resolved) return;\n\n  \t\tvar model = this.fragment.findContext().joinAll(this.keys);\n  \t\tthis.callback(model);\n  \t\tthis.resolved = true;\n  \t};\n\n  \tReferenceResolver.prototype.unbind = function unbind() {\n  \t\tremoveFromArray(this.fragment.unresolved, this);\n  \t};\n\n  \treturn ReferenceResolver;\n  })();\n\n  // TODO all this code needs to die\n\n  function processItems(items, values, guid) {\n  \tvar counter = arguments.length <= 3 || arguments[3] === undefined ? 0 : arguments[3];\n\n  \treturn items.map(function (item) {\n  \t\tif (item.type === TEXT) {\n  \t\t\treturn item.template;\n  \t\t}\n\n  \t\tif (item.fragment) {\n  \t\t\tif (item.fragment.iterations) {\n  \t\t\t\treturn item.fragment.iterations.map(function (fragment) {\n  \t\t\t\t\treturn processItems(fragment.items, values, guid, counter);\n  \t\t\t\t}).join('');\n  \t\t\t} else {\n  \t\t\t\treturn processItems(item.fragment.items, values, guid, counter);\n  \t\t\t}\n  \t\t}\n\n  \t\tvar placeholderId = guid + '-' + counter++;\n\n  \t\tvalues[placeholderId] = item.model ? item.model.wrapper ? item.model.wrapper.value : item.model.get() : undefined;\n\n  \t\treturn '${' + placeholderId + '}';\n  \t}).join('');\n  }\n\n  function unrenderAndDestroy(item) {\n  \titem.unrender(true);\n  }\n\n  var Fragment = (function () {\n  \tfunction Fragment(options) {\n  \t\tclassCallCheck(this, Fragment);\n\n  \t\tthis.owner = options.owner; // The item that owns this fragment - an element, section, partial, or attribute\n\n  \t\tthis.isRoot = !options.owner.parentFragment;\n  \t\tthis.parent = this.isRoot ? null : this.owner.parentFragment;\n  \t\tthis.ractive = options.ractive || (this.isRoot ? options.owner : this.parent.ractive);\n\n  \t\tthis.componentParent = this.isRoot && this.ractive.component ? this.ractive.component.parentFragment : null;\n\n  \t\tthis.context = null;\n  \t\tthis.rendered = false;\n\n  \t\t// encapsulated styles should be inherited until they get applied by an element\n  \t\tthis.cssIds = 'cssIds' in options ? options.cssIds : this.parent ? this.parent.cssIds : null;\n\n  \t\tthis.resolvers = [];\n\n  \t\tthis.dirty = false;\n  \t\tthis.dirtyArgs = this.dirtyValue = true; // TODO getArgsList is nonsense - should deprecate legacy directives style\n\n  \t\tthis.template = options.template || [];\n  \t\tthis.createItems();\n  \t}\n\n  \tFragment.prototype.bind = function bind(context) {\n  \t\tthis.context = context;\n  \t\tthis.items.forEach(_bind);\n  \t\tthis.bound = true;\n\n  \t\t// in rare cases, a forced resolution (or similar) will cause the\n  \t\t// fragment to be dirty before it's even finished binding. In those\n  \t\t// cases we update immediately\n  \t\tif (this.dirty) this.update();\n\n  \t\treturn this;\n  \t};\n\n  \tFragment.prototype.bubble = function bubble() {\n  \t\tthis.dirtyArgs = this.dirtyValue = true;\n\n  \t\tif (!this.dirty) {\n  \t\t\tthis.dirty = true;\n\n  \t\t\tif (this.isRoot) {\n  \t\t\t\t// TODO encapsulate 'is component root, but not overall root' check?\n  \t\t\t\tif (this.ractive.component) {\n  \t\t\t\t\tthis.ractive.component.bubble();\n  \t\t\t\t} else if (this.bound) {\n  \t\t\t\t\trunloop.addFragment(this);\n  \t\t\t\t}\n  \t\t\t} else {\n  \t\t\t\tthis.owner.bubble();\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tFragment.prototype.createItems = function createItems() {\n  \t\tvar _this = this;\n\n  \t\tthis.items = this.template.map(function (template, index) {\n  \t\t\treturn createItem({ parentFragment: _this, template: template, index: index });\n  \t\t});\n  \t};\n\n  \tFragment.prototype.detach = function detach() {\n  \t\tvar docFrag = createDocumentFragment();\n  \t\tthis.items.forEach(function (item) {\n  \t\t\treturn docFrag.appendChild(item.detach());\n  \t\t});\n  \t\treturn docFrag;\n  \t};\n\n  \tFragment.prototype.find = function find(selector) {\n  \t\tvar len = this.items.length;\n  \t\tvar i = undefined;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tvar found = this.items[i].find(selector);\n  \t\t\tif (found) return found;\n  \t\t}\n  \t};\n\n  \tFragment.prototype.findAll = function findAll(selector, query) {\n  \t\tif (this.items) {\n  \t\t\tvar len = this.items.length;\n  \t\t\tvar i = undefined;\n\n  \t\t\tfor (i = 0; i < len; i += 1) {\n  \t\t\t\tvar item = this.items[i];\n\n  \t\t\t\tif (item.findAll) {\n  \t\t\t\t\titem.findAll(selector, query);\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\treturn query;\n  \t};\n\n  \tFragment.prototype.findComponent = function findComponent(name) {\n  \t\tvar len = this.items.length;\n  \t\tvar i = undefined;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tvar found = this.items[i].findComponent(name);\n  \t\t\tif (found) return found;\n  \t\t}\n  \t};\n\n  \tFragment.prototype.findAllComponents = function findAllComponents(name, query) {\n  \t\tif (this.items) {\n  \t\t\tvar len = this.items.length;\n  \t\t\tvar i = undefined;\n\n  \t\t\tfor (i = 0; i < len; i += 1) {\n  \t\t\t\tvar item = this.items[i];\n\n  \t\t\t\tif (item.findAllComponents) {\n  \t\t\t\t\titem.findAllComponents(name, query);\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\treturn query;\n  \t};\n\n  \tFragment.prototype.findContext = function findContext() {\n  \t\tvar fragment = this;\n  \t\twhile (!fragment.context) fragment = fragment.parent;\n  \t\treturn fragment.context;\n  \t};\n\n  \tFragment.prototype.findNextNode = function findNextNode(item) {\n  \t\t// search for the next node going forward\n  \t\tfor (var i = item.index + 1; i < this.items.length; i++) {\n  \t\t\tif (!this.items[i]) continue;\n\n  \t\t\tvar node = this.items[i].firstNode(true);\n  \t\t\tif (node) return node;\n  \t\t}\n\n  \t\t// if this is the root fragment, and there are no more items,\n  \t\t// it means we're at the end...\n  \t\tif (this.isRoot) {\n  \t\t\tif (this.ractive.component) {\n  \t\t\t\treturn this.ractive.component.parentFragment.findNextNode(this.ractive.component);\n  \t\t\t}\n\n  \t\t\t// TODO possible edge case with other content\n  \t\t\t// appended to this.ractive.el?\n  \t\t\treturn null;\n  \t\t}\n\n  \t\treturn this.owner.findNextNode(this); // the argument is in case the parent is a RepeatedFragment\n  \t};\n\n  \tFragment.prototype.findParentNode = function findParentNode() {\n  \t\tvar fragment = this;\n\n  \t\tdo {\n  \t\t\tif (fragment.owner.type === ELEMENT) {\n  \t\t\t\treturn fragment.owner.node;\n  \t\t\t}\n\n  \t\t\tif (fragment.isRoot && !fragment.ractive.component) {\n  \t\t\t\t// TODO encapsulate check\n  \t\t\t\treturn fragment.ractive.el;\n  \t\t\t}\n\n  \t\t\tif (fragment.owner.type === YIELDER) {\n  \t\t\t\tfragment = fragment.owner.containerFragment;\n  \t\t\t} else {\n  \t\t\t\tfragment = fragment.componentParent || fragment.parent; // TODO ugh\n  \t\t\t}\n  \t\t} while (fragment);\n\n  \t\tthrow new Error('Could not find parent node'); // TODO link to issue tracker\n  \t};\n\n  \tFragment.prototype.findRepeatingFragment = function findRepeatingFragment() {\n  \t\tvar fragment = this;\n  \t\t// TODO better check than fragment.parent.iterations\n  \t\twhile (fragment.parent && !fragment.isIteration) {\n  \t\t\tfragment = fragment.parent || fragment.componentParent;\n  \t\t}\n\n  \t\treturn fragment;\n  \t};\n\n  \tFragment.prototype.firstNode = function firstNode(skipParent) {\n  \t\tvar node = undefined;\n  \t\tfor (var i = 0; i < this.items.length; i++) {\n  \t\t\tnode = this.items[i].firstNode(true);\n\n  \t\t\tif (node) {\n  \t\t\t\treturn node;\n  \t\t\t}\n  \t\t}\n\n  \t\tif (skipParent) return null;\n\n  \t\treturn this.parent.findNextNode(this.owner);\n  \t};\n\n  \t// TODO ideally, this would be deprecated in favour of an\n  \t// expression-like approach\n\n  \tFragment.prototype.getArgsList = function getArgsList() {\n  \t\tif (this.dirtyArgs) {\n  \t\t\tvar values = {};\n  \t\t\tvar source = processItems(this.items, values, this.ractive._guid);\n  \t\t\tvar parsed = parseJSON('[' + source + ']', values);\n\n  \t\t\tthis.argsList = parsed ? parsed.value : [this.toString()];\n\n  \t\t\tthis.dirtyArgs = false;\n  \t\t}\n\n  \t\treturn this.argsList;\n  \t};\n\n  \tFragment.prototype.rebind = function rebind(context) {\n  \t\tthis.context = context;\n\n  \t\tthis.items.forEach(_rebind);\n  \t};\n\n  \tFragment.prototype.render = function render(target, occupants) {\n  \t\tif (this.rendered) throw new Error('Fragment is already rendered!');\n  \t\tthis.rendered = true;\n\n  \t\tthis.items.forEach(function (item) {\n  \t\t\treturn item.render(target, occupants);\n  \t\t});\n  \t};\n\n  \tFragment.prototype.resetTemplate = function resetTemplate(template) {\n  \t\tvar wasBound = this.bound;\n  \t\tvar wasRendered = this.rendered;\n\n  \t\t// TODO ensure transitions are disabled globally during reset\n\n  \t\tif (wasBound) {\n  \t\t\tif (wasRendered) this.unrender(true);\n  \t\t\tthis.unbind();\n  \t\t}\n\n  \t\tthis.template = template;\n  \t\tthis.createItems();\n\n  \t\tif (wasBound) {\n  \t\t\tthis.bind(this.context);\n\n  \t\t\tif (wasRendered) {\n  \t\t\t\tvar parentNode = this.findParentNode();\n  \t\t\t\tvar anchor = this.parent ? this.parent.findNextNode(this.owner) : null;\n\n  \t\t\t\tif (anchor) {\n  \t\t\t\t\tvar docFrag = createDocumentFragment();\n  \t\t\t\t\tthis.render(docFrag);\n  \t\t\t\t\tparentNode.insertBefore(docFrag, anchor);\n  \t\t\t\t} else {\n  \t\t\t\t\tthis.render(parentNode);\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tFragment.prototype.resolve = function resolve(template, callback) {\n  \t\tif (!this.context) {\n  \t\t\treturn this.parent.resolve(template, callback);\n  \t\t}\n\n  \t\tvar resolver = new ReferenceResolver(this, template, callback);\n  \t\tthis.resolvers.push(resolver);\n\n  \t\treturn resolver; // so we can e.g. force resolution\n  \t};\n\n  \tFragment.prototype.toHtml = function toHtml() {\n  \t\treturn this.toString();\n  \t};\n\n  \tFragment.prototype.toString = function toString(escape) {\n  \t\treturn this.items.map(escape ? toEscapedString : _toString).join('');\n  \t};\n\n  \tFragment.prototype.unbind = function unbind() {\n  \t\tthis.items.forEach(_unbind);\n  \t\tthis.bound = false;\n\n  \t\treturn this;\n  \t};\n\n  \tFragment.prototype.unrender = function unrender(shouldDestroy) {\n  \t\tthis.items.forEach(shouldDestroy ? unrenderAndDestroy : _unrender);\n  \t\tthis.rendered = false;\n  \t};\n\n  \tFragment.prototype.update = function update() {\n  \t\tif (this.dirty && !this.updating) {\n  \t\t\tthis.dirty = false;\n  \t\t\tthis.updating = true;\n  \t\t\tthis.items.forEach(_update);\n  \t\t\tthis.updating = false;\n  \t\t}\n  \t};\n\n  \tFragment.prototype.valueOf = function valueOf() {\n  \t\tif (this.items.length === 1) {\n  \t\t\treturn this.items[0].valueOf();\n  \t\t}\n\n  \t\tif (this.dirtyValue) {\n  \t\t\tvar values = {};\n  \t\t\tvar source = processItems(this.items, values, this.ractive._guid);\n  \t\t\tvar parsed = parseJSON(source, values);\n\n  \t\t\tthis.value = parsed ? parsed.value : this.toString();\n\n  \t\t\tthis.dirtyValue = false;\n  \t\t}\n\n  \t\treturn this.value;\n  \t};\n\n  \treturn Fragment;\n  })();\n\n  // TODO should resetTemplate be asynchronous? i.e. should it be a case\n  // of outro, update template, intro? I reckon probably not, since that\n  // could be achieved with unrender-resetTemplate-render. Also, it should\n  // conceptually be similar to resetPartial, which couldn't be async\n\n  function Ractive$resetTemplate(template) {\n  \ttemplateConfigurator.init(null, this, { template: template });\n\n  \tvar transitionsEnabled = this.transitionsEnabled;\n  \tthis.transitionsEnabled = false;\n\n  \t// Is this is a component, we need to set the `shouldDestroy`\n  \t// flag, otherwise it will assume by default that a parent node\n  \t// will be detached, and therefore it doesn't need to bother\n  \t// detaching its own nodes\n  \tvar component = this.component;\n  \tif (component) component.shouldDestroy = true;\n  \tthis.unrender();\n  \tif (component) component.shouldDestroy = false;\n\n  \t// remove existing fragment and create new one\n  \tthis.fragment.unbind().unrender(true);\n\n  \tthis.fragment = new Fragment({\n  \t\ttemplate: this.template,\n  \t\troot: this,\n  \t\towner: this\n  \t});\n\n  \tvar docFrag = createDocumentFragment();\n  \tthis.fragment.bind(this.viewmodel).render(docFrag);\n  \tthis.el.insertBefore(docFrag, this.anchor);\n\n  \tthis.transitionsEnabled = transitionsEnabled;\n  }\n\n  function collect(source, name, dest) {\n  \tsource.forEach(function (item) {\n  \t\t// queue to rerender if the item is a partial and the current name matches\n  \t\tif (item.type === PARTIAL && (item.refName === name || item.name === name)) {\n  \t\t\tdest.push(item);\n  \t\t\treturn; // go no further\n  \t\t}\n\n  \t\t// if it has a fragment, process its items\n  \t\tif (item.fragment) {\n  \t\t\tcollect(item.fragment.iterations || item.fragment.items, name, dest);\n  \t\t}\n\n  \t\t// or if it is itself a fragment, process its items\n  \t\telse if (isArray(item.items)) {\n  \t\t\t\tcollect(item.items, name, dest);\n  \t\t\t}\n\n  \t\t\t// or if it is a component, step in and process its items\n  \t\t\telse if (item.type === COMPONENT && item.instance) {\n  \t\t\t\t\t// ...unless the partial is shadowed\n  \t\t\t\t\tif (item.instance.partials[name]) return;\n  \t\t\t\t\tcollect(item.instance.fragment.items, name, dest);\n  \t\t\t\t}\n\n  \t\t// if the item is an element, process its attributes too\n  \t\tif (item.type === ELEMENT) {\n  \t\t\tif (isArray(item.attributes)) {\n  \t\t\t\tcollect(item.attributes, name, dest);\n  \t\t\t}\n\n  \t\t\tif (isArray(item.conditionalAttributes)) {\n  \t\t\t\tcollect(item.conditionalAttributes, name, dest);\n  \t\t\t}\n  \t\t}\n  \t});\n  }\n\n  function forceResetTemplate(partial) {\n  \tpartial.forceResetTemplate();\n  }\n\n  function resetPartial (name, partial) {\n  \tvar collection = [];\n  \tcollect(this.fragment.items, name, collection);\n\n  \tvar promise = runloop.start(this, true);\n\n  \tthis.partials[name] = partial;\n  \tcollection.forEach(forceResetTemplate);\n\n  \trunloop.end();\n\n  \treturn promise;\n  }\n\n  var shouldRerender = ['template', 'partials', 'components', 'decorators', 'events'];\n\n  var completeHook = new Hook('complete');\n  var resetHook = new Hook('reset');\n  var renderHook = new Hook('render');\n  var unrenderHook = new Hook('unrender');\n  function Ractive$reset(data) {\n  \tdata = data || {};\n\n  \tif (typeof data !== 'object') {\n  \t\tthrow new Error('The reset method takes either no arguments, or an object containing new data');\n  \t}\n\n  \t// TEMP need to tidy this up\n  \tdata = dataConfigurator.init(this.constructor, this, { data: data });\n\n  \tvar promise = runloop.start(this, true);\n\n  \t// If the root object is wrapped, try and use the wrapper's reset value\n  \tvar wrapper = this.viewmodel.wrapper;\n  \tif (wrapper && wrapper.reset) {\n  \t\tif (wrapper.reset(data) === false) {\n  \t\t\t// reset was rejected, we need to replace the object\n  \t\t\tthis.viewmodel.set(data);\n  \t\t}\n  \t} else {\n  \t\tthis.viewmodel.set(data);\n  \t}\n\n  \t// reset config items and track if need to rerender\n  \tvar changes = config.reset(this);\n  \tvar rerender = undefined;\n\n  \tvar i = changes.length;\n  \twhile (i--) {\n  \t\tif (shouldRerender.indexOf(changes[i]) > -1) {\n  \t\t\trerender = true;\n  \t\t\tbreak;\n  \t\t}\n  \t}\n\n  \tif (rerender) {\n  \t\tunrenderHook.fire(this);\n  \t\tthis.fragment.resetTemplate(this.template);\n  \t\trenderHook.fire(this);\n  \t\tcompleteHook.fire(this);\n  \t}\n\n  \trunloop.end();\n\n  \tresetHook.fire(this, data);\n\n  \treturn promise;\n  }\n\n  function Ractive$render(target, anchor) {\n  \ttarget = getElement(target) || this.el;\n\n  \tif (!this.append && target) {\n  \t\t// Teardown any existing instances *before* trying to set up the new one -\n  \t\t// avoids certain weird bugs\n  \t\tvar others = target.__ractive_instances__;\n  \t\tif (others) others.forEach(_teardown);\n\n  \t\t// make sure we are the only occupants\n  \t\tif (!this.enhance) {\n  \t\t\ttarget.innerHTML = ''; // TODO is this quicker than removeChild? Initial research inconclusive\n  \t\t}\n  \t}\n\n  \tvar occupants = this.enhance ? toArray(target.childNodes) : null;\n  \tvar promise = render(this, target, anchor, occupants);\n\n  \tif (occupants) {\n  \t\twhile (occupants.length) target.removeChild(occupants.pop());\n  \t}\n\n  \treturn promise;\n  }\n\n  var push = makeArrayMethod('push');\n\n  var pop = makeArrayMethod('pop');\n\n  function Ractive$once(eventName, handler) {\n  \tvar listener = this.on(eventName, function () {\n  \t\thandler.apply(this, arguments);\n  \t\tlistener.cancel();\n  \t});\n\n  \t// so we can still do listener.cancel() manually\n  \treturn listener;\n  }\n\n  function trim (str) {\n    return str.trim();\n  }\n\n  function notEmptyString (str) {\n    return str !== '';\n  }\n\n  function Ractive$on(eventName, callback) {\n  \tvar _this = this;\n\n  \t// allow multiple listeners to be bound in one go\n  \tif (typeof eventName === 'object') {\n  \t\tvar _ret = (function () {\n  \t\t\tvar listeners = [];\n  \t\t\tvar n = undefined;\n\n  \t\t\tfor (n in eventName) {\n  \t\t\t\tif (eventName.hasOwnProperty(n)) {\n  \t\t\t\t\tlisteners.push(_this.on(n, eventName[n]));\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\treturn {\n  \t\t\t\tv: {\n  \t\t\t\t\tcancel: function () {\n  \t\t\t\t\t\tvar listener = undefined;\n  \t\t\t\t\t\twhile (listener = listeners.pop()) listener.cancel();\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t\t};\n  \t\t})();\n\n  \t\tif (typeof _ret === 'object') return _ret.v;\n  \t}\n\n  \t// Handle multiple space-separated event names\n  \tvar eventNames = eventName.split(' ').map(trim).filter(notEmptyString);\n\n  \teventNames.forEach(function (eventName) {\n  \t\t(_this._subs[eventName] || (_this._subs[eventName] = [])).push(callback);\n  \t});\n\n  \treturn {\n  \t\tcancel: function () {\n  \t\t\treturn _this.off(eventName, callback);\n  \t\t}\n  \t};\n  }\n\n  function Ractive$off(eventName, callback) {\n  \tvar _this = this;\n\n  \t// if no arguments specified, remove all callbacks\n  \tif (!eventName) {\n  \t\t// TODO use this code instead, once the following issue has been resolved\n  \t\t// in PhantomJS (tests are unpassable otherwise!)\n  \t\t// https://github.com/ariya/phantomjs/issues/11856\n  \t\t// defineProperty( this, '_subs', { value: create( null ), configurable: true });\n  \t\tfor (eventName in this._subs) {\n  \t\t\tdelete this._subs[eventName];\n  \t\t}\n  \t} else {\n  \t\t// Handle multiple space-separated event names\n  \t\tvar eventNames = eventName.split(' ').map(trim).filter(notEmptyString);\n\n  \t\teventNames.forEach(function (eventName) {\n  \t\t\tvar subscribers = _this._subs[eventName];\n\n  \t\t\t// If we have subscribers for this event...\n  \t\t\tif (subscribers) {\n  \t\t\t\t// ...if a callback was specified, only remove that\n  \t\t\t\tif (callback) {\n  \t\t\t\t\tvar index = subscribers.indexOf(callback);\n  \t\t\t\t\tif (index !== -1) {\n  \t\t\t\t\t\tsubscribers.splice(index, 1);\n  \t\t\t\t\t}\n  \t\t\t\t}\n\n  \t\t\t\t// ...otherwise remove all callbacks\n  \t\t\t\telse {\n  \t\t\t\t\t\t_this._subs[eventName] = [];\n  \t\t\t\t\t}\n  \t\t\t}\n  \t\t});\n  \t}\n\n  \treturn this;\n  }\n\n  var onceOptions = { init: false, once: true };\n  function observeOnce(keypath, callback, options) {\n  \tif (isObject(keypath) || typeof keypath === 'function') {\n  \t\toptions = extend(callback || {}, onceOptions);\n  \t\treturn this.observe(keypath, options);\n  \t}\n\n  \toptions = extend(options || {}, onceOptions);\n  \treturn this.observe(keypath, callback, options);\n  }\n\n  function observeList(keypath, callback, options) {\n  \tif (typeof keypath !== 'string') {\n  \t\tthrow new Error('ractive.observeList() must be passed a string as its first argument');\n  \t}\n\n  \tvar model = this.viewmodel.joinAll(splitKeypath(keypath));\n  \tvar observer = new ListObserver(this, model, callback, options || {});\n\n  \t// add observer to the Ractive instance, so it can be\n  \t// cancelled on ractive.teardown()\n  \tthis._observers.push(observer);\n\n  \treturn {\n  \t\tcancel: function () {\n  \t\t\tobserver.cancel();\n  \t\t}\n  \t};\n  }\n\n  function negativeOne() {\n  \treturn -1;\n  }\n\n  var ListObserver = (function () {\n  \tfunction ListObserver(context, model, callback, options) {\n  \t\tclassCallCheck(this, ListObserver);\n\n  \t\tthis.context = context;\n  \t\tthis.model = model;\n  \t\tthis.keypath = model.getKeypath();\n  \t\tthis.callback = callback;\n\n  \t\tthis.pending = null;\n\n  \t\tmodel.register(this);\n\n  \t\tif (options.init !== false) {\n  \t\t\tthis.sliced = [];\n  \t\t\tthis.shuffle([]);\n  \t\t\tthis.handleChange();\n  \t\t} else {\n  \t\t\tthis.sliced = this.slice();\n  \t\t}\n  \t}\n\n  \tListObserver.prototype.handleChange = function handleChange() {\n  \t\tif (this.pending) {\n  \t\t\t// post-shuffle\n  \t\t\tthis.callback(this.pending);\n  \t\t\tthis.pending = null;\n  \t\t} else {\n  \t\t\t// entire array changed\n  \t\t\tthis.shuffle(this.sliced.map(negativeOne));\n  \t\t\tthis.handleChange();\n  \t\t}\n  \t};\n\n  \tListObserver.prototype.shuffle = function shuffle(newIndices) {\n  \t\tvar _this = this;\n\n  \t\tvar newValue = this.slice();\n\n  \t\tvar inserted = [];\n  \t\tvar deleted = [];\n  \t\tvar start = undefined;\n\n  \t\tvar hadIndex = {};\n\n  \t\tnewIndices.forEach(function (newIndex, oldIndex) {\n  \t\t\thadIndex[newIndex] = true;\n\n  \t\t\tif (newIndex !== oldIndex && start === undefined) {\n  \t\t\t\tstart = oldIndex;\n  \t\t\t}\n\n  \t\t\tif (newIndex === -1) {\n  \t\t\t\tdeleted.push(_this.sliced[oldIndex]);\n  \t\t\t}\n  \t\t});\n\n  \t\tif (start === undefined) start = newIndices.length;\n\n  \t\tvar len = newValue.length;\n  \t\tfor (var i = 0; i < len; i += 1) {\n  \t\t\tif (!hadIndex[i]) inserted.push(newValue[i]);\n  \t\t}\n\n  \t\tthis.pending = { inserted: inserted, deleted: deleted, start: start };\n  \t\tthis.sliced = newValue;\n  \t};\n\n  \tListObserver.prototype.slice = function slice() {\n  \t\tvar value = this.model.get();\n  \t\treturn isArray(value) ? value.slice() : [];\n  \t};\n\n  \treturn ListObserver;\n  })();\n\n  function observe(keypath, callback, options) {\n  \tvar _this = this;\n\n  \tvar observers = [];\n  \tvar map = undefined;\n\n  \tif (isObject(keypath)) {\n  \t\tmap = keypath;\n  \t\toptions = callback || {};\n\n  \t\tObject.keys(map).forEach(function (keypath) {\n  \t\t\tvar callback = map[keypath];\n\n  \t\t\tkeypath.split(' ').forEach(function (keypath) {\n  \t\t\t\tobservers.push(createObserver(_this, keypath, callback, options));\n  \t\t\t});\n  \t\t});\n  \t} else {\n  \t\tvar keypaths = undefined;\n\n  \t\tif (typeof keypath === 'function') {\n  \t\t\toptions = callback;\n  \t\t\tcallback = keypath;\n  \t\t\tkeypaths = [''];\n  \t\t} else {\n  \t\t\tkeypaths = keypath.split(' ');\n  \t\t}\n\n  \t\tkeypaths.forEach(function (keypath) {\n  \t\t\tobservers.push(createObserver(_this, keypath, callback, options || {}));\n  \t\t});\n  \t}\n\n  \t// add observers to the Ractive instance, so they can be\n  \t// cancelled on ractive.teardown()\n  \tthis._observers.push.apply(this._observers, observers);\n\n  \treturn {\n  \t\tcancel: function () {\n  \t\t\tobservers.forEach(cancel);\n  \t\t}\n  \t};\n  }\n\n  function createObserver(ractive, keypath, callback, options) {\n  \tvar viewmodel = ractive.viewmodel;\n\n  \tvar keys = splitKeypath(keypath);\n  \tvar wildcardIndex = keys.indexOf('*');\n\n  \t// normal keypath - no wildcards\n  \tif (! ~wildcardIndex) {\n  \t\tvar key = keys[0];\n\n  \t\t// if not the root model itself, check if viewmodel has key.\n  \t\tif (key !== '' && !viewmodel.has(key)) {\n  \t\t\t// if this is an inline component, we may need to create an implicit mapping\n  \t\t\tif (ractive.component) {\n  \t\t\t\tvar _model = resolveReference(ractive.component.parentFragment, key);\n  \t\t\t\tif (_model) viewmodel.map(key, _model);\n  \t\t\t}\n  \t\t}\n\n  \t\tvar model = viewmodel.joinAll(keys);\n  \t\treturn new Observer(ractive, model, callback, options);\n  \t}\n\n  \t// pattern observers - more complex case\n  \tvar baseModel = wildcardIndex === 0 ? viewmodel : viewmodel.joinAll(keys.slice(0, wildcardIndex));\n\n  \treturn new PatternObserver(ractive, baseModel, keys.splice(wildcardIndex), callback, options);\n  }\n\n  var Observer = (function () {\n  \tfunction Observer(ractive, model, callback, options) {\n  \t\tclassCallCheck(this, Observer);\n\n  \t\tthis.context = options.context || ractive;\n  \t\tthis.model = model;\n  \t\tthis.keypath = model.getKeypath(ractive);\n  \t\tthis.callback = callback;\n\n  \t\tthis.oldValue = undefined;\n  \t\tthis.newValue = model.get();\n\n  \t\tthis.defer = options.defer;\n  \t\tthis.once = options.once;\n  \t\tthis.strict = options.strict;\n\n  \t\tthis.dirty = false;\n\n  \t\tif (options.init !== false) {\n  \t\t\tthis.dispatch();\n  \t\t} else {\n  \t\t\tthis.oldValue = this.newValue;\n  \t\t}\n\n  \t\tmodel.register(this);\n  \t}\n\n  \tObserver.prototype.cancel = function cancel() {\n  \t\tthis.model.unregister(this);\n  \t};\n\n  \tObserver.prototype.dispatch = function dispatch() {\n  \t\tthis.callback.call(this.context, this.newValue, this.oldValue, this.keypath);\n  \t\tthis.oldValue = this.newValue;\n  \t\tthis.dirty = false;\n  \t};\n\n  \tObserver.prototype.handleChange = function handleChange() {\n  \t\tif (!this.dirty) {\n  \t\t\tthis.newValue = this.model.get();\n\n  \t\t\tif (this.strict && this.newValue === this.oldValue) return;\n\n  \t\t\trunloop.addObserver(this, this.defer);\n  \t\t\tthis.dirty = true;\n\n  \t\t\tif (this.once) this.cancel();\n  \t\t}\n  \t};\n\n  \treturn Observer;\n  })();\n\n  var PatternObserver = (function () {\n  \tfunction PatternObserver(ractive, baseModel, keys, callback, options) {\n  \t\tvar _this2 = this;\n\n  \t\tclassCallCheck(this, PatternObserver);\n\n  \t\tthis.context = options.context || ractive;\n  \t\tthis.ractive = ractive;\n  \t\tthis.baseModel = baseModel;\n  \t\tthis.keys = keys;\n  \t\tthis.callback = callback;\n\n  \t\tvar pattern = keys.join('\\\\.').replace(/\\*/g, '(.+)');\n  \t\tvar baseKeypath = baseModel.getKeypath(ractive);\n  \t\tthis.pattern = new RegExp('^' + (baseKeypath ? baseKeypath + '\\\\.' : '') + pattern + '$');\n\n  \t\tthis.oldValues = {};\n  \t\tthis.newValues = {};\n\n  \t\tthis.defer = options.defer;\n  \t\tthis.once = options.once;\n  \t\tthis.strict = options.strict;\n\n  \t\tthis.dirty = false;\n\n  \t\tvar models = baseModel.findMatches(this.keys);\n\n  \t\tmodels.forEach(function (model) {\n  \t\t\t_this2.newValues[model.getKeypath(_this2.ractive)] = model.get();\n  \t\t});\n\n  \t\tif (options.init !== false) {\n  \t\t\tthis.dispatch();\n  \t\t} else {\n  \t\t\tthis.oldValues = this.newValues;\n  \t\t}\n\n  \t\tbaseModel.register(this);\n  \t}\n\n  \tPatternObserver.prototype.cancel = function cancel() {\n  \t\tthis.baseModel.unregister(this);\n  \t};\n\n  \tPatternObserver.prototype.dispatch = function dispatch() {\n  \t\tvar _this3 = this;\n\n  \t\tObject.keys(this.newValues).forEach(function (keypath) {\n  \t\t\tif (_this3.newKeys && !_this3.newKeys[keypath]) return;\n\n  \t\t\tvar newValue = _this3.newValues[keypath];\n  \t\t\tvar oldValue = _this3.oldValues[keypath];\n\n  \t\t\tif (_this3.strict && newValue === oldValue) return;\n  \t\t\tif (isEqual(newValue, oldValue)) return;\n\n  \t\t\tvar args = [newValue, oldValue, keypath];\n  \t\t\tif (keypath) {\n  \t\t\t\tvar wildcards = _this3.pattern.exec(keypath).slice(1);\n  \t\t\t\targs = args.concat(wildcards);\n  \t\t\t}\n\n  \t\t\t_this3.callback.apply(_this3.context, args);\n  \t\t});\n\n  \t\tthis.oldValues = this.newValues;\n  \t\tthis.newKeys = null;\n  \t\tthis.dirty = false;\n  \t};\n\n  \tPatternObserver.prototype.shuffle = function shuffle(newIndices) {\n  \t\tif (!isArray(this.baseModel.value)) return;\n\n  \t\tvar base = this.baseModel.getKeypath(this.ractive);\n  \t\tvar max = this.baseModel.value.length;\n  \t\tvar suffix = this.keys.length > 1 ? '.' + this.keys.slice(1).join('.') : '';\n\n  \t\tthis.newKeys = {};\n  \t\tfor (var i = 0; i < newIndices.length; i++) {\n  \t\t\tif (newIndices[i] === -1 || newIndices[i] === i) continue;\n  \t\t\tthis.newKeys[base + '.' + i + suffix] = true;\n  \t\t}\n\n  \t\tfor (var i = newIndices.touchedFrom; i < max; i++) {\n  \t\t\tthis.newKeys[base + '.' + i + suffix] = true;\n  \t\t}\n  \t};\n\n  \tPatternObserver.prototype.handleChange = function handleChange() {\n  \t\tvar _this4 = this;\n\n  \t\tif (!this.dirty) {\n  \t\t\tthis.newValues = {};\n\n  \t\t\t// handle case where previously extant keypath no longer exists -\n  \t\t\t// observer should still fire, with undefined as new value\n  \t\t\t// TODO huh. according to the test suite that's not the case...\n  \t\t\t// Object.keys( this.oldValues ).forEach( keypath => {\n  \t\t\t// \tthis.newValues[ keypath ] = undefined;\n  \t\t\t// });\n\n  \t\t\tthis.baseModel.findMatches(this.keys).forEach(function (model) {\n  \t\t\t\tvar keypath = model.getKeypath(_this4.ractive);\n  \t\t\t\t_this4.newValues[keypath] = model.get();\n  \t\t\t});\n\n  \t\t\trunloop.addObserver(this, this.defer);\n  \t\t\tthis.dirty = true;\n\n  \t\t\tif (this.once) this.cancel();\n  \t\t}\n  \t};\n\n  \treturn PatternObserver;\n  })();\n\n  var comparators = {};\n\n  function getComparator(option) {\n  \tif (!option) return null; // use existing arrays\n  \tif (option === true) return JSON.stringify;\n  \tif (typeof option === 'function') return option;\n\n  \tif (typeof option === 'string') {\n  \t\treturn comparators[option] || (comparators[option] = function (thing) {\n  \t\t\treturn thing[option];\n  \t\t});\n  \t}\n\n  \tthrow new Error('If supplied, options.compare must be a string, function, or `true`'); // TODO link to docs\n  }\n  function Ractive$merge(keypath, array, options) {\n  \tvar model = this.viewmodel.joinAll(splitKeypath(keypath));\n  \tvar promise = runloop.start(this, true);\n  \tvar value = model.get();\n\n  \tif (array === value) {\n  \t\tthrow new Error('You cannot merge an array with itself'); // TODO link to docs\n  \t} else if (!isArray(value) || !isArray(array)) {\n  \t\t\tthrow new Error('You cannot merge an array with a non-array');\n  \t\t}\n\n  \tvar comparator = getComparator(options && options.compare);\n  \tmodel.merge(array, comparator);\n\n  \trunloop.end();\n  \treturn promise;\n  }\n\n  function link(there, here) {\n  \tif (here === there || (there + '.').indexOf(here + '.') === 0 || (here + '.').indexOf(there + '.') === 0) {\n  \t\tthrow new Error('A keypath cannot be linked to itself.');\n  \t}\n\n  \tvar unlink = undefined,\n  \t    run = undefined,\n  \t    model = undefined;\n\n  \tvar ln = this._links[here];\n\n  \tif (ln) {\n  \t\tif (ln.source.model.str !== there || ln.dest.model.str !== here) {\n  \t\t\tunlink = this.unlink(here);\n  \t\t} else {\n  \t\t\treturn Promise$1.resolve(true);\n  \t\t}\n  \t}\n\n  \trun = runloop.start();\n\n  \t// may need to allow a mapping to resolve implicitly\n  \tvar sourcePath = splitKeypath(there);\n  \tif (!this.viewmodel.has(sourcePath[0]) && this.component) {\n  \t\tmodel = resolveReference(this.component.parentFragment, sourcePath[0]);\n\n  \t\tif (model) {\n  \t\t\tthis.viewmodel.map(sourcePath[0], model);\n  \t\t}\n  \t}\n\n  \tln = new Link(this.viewmodel.joinAll(sourcePath), this.viewmodel.joinAll(splitKeypath(here)), this);\n  \tthis._links[here] = ln;\n  \tln.source.handleChange();\n\n  \trunloop.end();\n\n  \treturn Promise$1.all([unlink, run]);\n  }\n\n  var Link = (function () {\n  \tfunction Link(source, dest, ractive) {\n  \t\tclassCallCheck(this, Link);\n\n  \t\tthis.source = new LinkSide(source, this);\n  \t\tthis.dest = new LinkSide(dest, this);\n  \t\tthis.ractive = ractive;\n  \t\tthis.locked = false;\n  \t\tthis.initialValue = dest.get();\n  \t}\n\n  \tLink.prototype.sync = function sync(side) {\n  \t\tif (!this.locked) {\n  \t\t\tthis.locked = true;\n\n  \t\t\tif (side === this.dest) {\n  \t\t\t\tthis.source.model.set(this.dest.model.get());\n  \t\t\t} else {\n  \t\t\t\tthis.dest.model.set(this.source.model.get());\n  \t\t\t}\n\n  \t\t\tthis.locked = false;\n  \t\t}\n  \t};\n\n  \tLink.prototype.unlink = function unlink() {\n  \t\tthis.source.model.unregister(this.source);\n  \t\tthis.dest.model.unregister(this.dest);\n  \t};\n\n  \treturn Link;\n  })();\n\n  var LinkSide = (function () {\n  \tfunction LinkSide(model, owner) {\n  \t\tclassCallCheck(this, LinkSide);\n\n  \t\tthis.model = model;\n  \t\tthis.owner = owner;\n  \t\tmodel.register(this);\n  \t}\n\n  \tLinkSide.prototype.handleChange = function handleChange() {\n  \t\tthis.owner.sync(this);\n  \t};\n\n  \treturn LinkSide;\n  })();\n\n  var insertHook = new Hook('insert');\n  function Ractive$insert(target, anchor) {\n  \tif (!this.fragment.rendered) {\n  \t\t// TODO create, and link to, documentation explaining this\n  \t\tthrow new Error('The API has changed - you must call `ractive.render(target[, anchor])` to render your Ractive instance. Once rendered you can use `ractive.insert()`.');\n  \t}\n\n  \ttarget = getElement(target);\n  \tanchor = getElement(anchor) || null;\n\n  \tif (!target) {\n  \t\tthrow new Error('You must specify a valid target to insert into');\n  \t}\n\n  \ttarget.insertBefore(this.detach(), anchor);\n  \tthis.el = target;\n\n  \t(target.__ractive_instances__ || (target.__ractive_instances__ = [])).push(this);\n  \tthis.isDetached = false;\n\n  \tfireInsertHook(this);\n  }\n\n  function fireInsertHook(ractive) {\n  \tinsertHook.fire(ractive);\n\n  \tractive.findAllComponents('*').forEach(function (child) {\n  \t\tfireInsertHook(child.instance);\n  \t});\n  }\n\n  function Ractive$get(keypath) {\n  \tif (!keypath) return this.viewmodel.get(true);\n\n  \tvar keys = splitKeypath(keypath);\n  \tvar key = keys[0];\n\n  \tvar model = undefined;\n\n  \tif (!this.viewmodel.has(key)) {\n  \t\t// if this is an inline component, we may need to create\n  \t\t// an implicit mapping\n  \t\tif (this.component && !this.isolated) {\n  \t\t\tmodel = resolveReference(this.component.parentFragment, key);\n\n  \t\t\tif (model) {\n  \t\t\t\tthis.viewmodel.map(key, model);\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \tmodel = this.viewmodel.joinAll(keys);\n  \treturn model.get(true);\n  }\n\n  function Ractive$fire(eventName) {\n  \tfor (var _len = arguments.length, args = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n  \t\targs[_key - 1] = arguments[_key];\n  \t}\n\n  \tfireEvent(this, eventName, { args: args });\n  }\n\n  function Ractive$findParent(selector) {\n\n  \tif (this.parent) {\n  \t\tif (this.parent.component && this.parent.component.name === selector) {\n  \t\t\treturn this.parent;\n  \t\t} else {\n  \t\t\treturn this.parent.findParent(selector);\n  \t\t}\n  \t}\n\n  \treturn null;\n  }\n\n  function Ractive$findContainer(selector) {\n  \tif (this.container) {\n  \t\tif (this.container.component && this.container.component.name === selector) {\n  \t\t\treturn this.container;\n  \t\t} else {\n  \t\t\treturn this.container.findContainer(selector);\n  \t\t}\n  \t}\n\n  \treturn null;\n  }\n\n  function Ractive$findComponent(selector) {\n  \treturn this.fragment.findComponent(selector);\n  }\n\n  function sortByDocumentPosition(node, otherNode) {\n  \tif (node.compareDocumentPosition) {\n  \t\tvar bitmask = node.compareDocumentPosition(otherNode);\n  \t\treturn bitmask & 2 ? 1 : -1;\n  \t}\n\n  \t// In old IE, we can piggy back on the mechanism for\n  \t// comparing component positions\n  \treturn sortByItemPosition(node, otherNode);\n  }\n\n  function sortByItemPosition(a, b) {\n  \tvar ancestryA = getAncestry(a.component || a._ractive.proxy);\n  \tvar ancestryB = getAncestry(b.component || b._ractive.proxy);\n\n  \tvar oldestA = lastItem(ancestryA);\n  \tvar oldestB = lastItem(ancestryB);\n  \tvar mutualAncestor = undefined;\n\n  \t// remove items from the end of both ancestries as long as they are identical\n  \t// - the final one removed is the closest mutual ancestor\n  \twhile (oldestA && oldestA === oldestB) {\n  \t\tancestryA.pop();\n  \t\tancestryB.pop();\n\n  \t\tmutualAncestor = oldestA;\n\n  \t\toldestA = lastItem(ancestryA);\n  \t\toldestB = lastItem(ancestryB);\n  \t}\n\n  \t// now that we have the mutual ancestor, we can find which is earliest\n  \toldestA = oldestA.component || oldestA;\n  \toldestB = oldestB.component || oldestB;\n\n  \tvar fragmentA = oldestA.parentFragment;\n  \tvar fragmentB = oldestB.parentFragment;\n\n  \t// if both items share a parent fragment, our job is easy\n  \tif (fragmentA === fragmentB) {\n  \t\tvar indexA = fragmentA.items.indexOf(oldestA);\n  \t\tvar indexB = fragmentB.items.indexOf(oldestB);\n\n  \t\t// if it's the same index, it means one contains the other,\n  \t\t// so we see which has the longest ancestry\n  \t\treturn indexA - indexB || ancestryA.length - ancestryB.length;\n  \t}\n\n  \t// if mutual ancestor is a section, we first test to see which section\n  \t// fragment comes first\n  \tvar fragments = mutualAncestor.iterations;\n  \tif (fragments) {\n  \t\tvar indexA = fragments.indexOf(fragmentA);\n  \t\tvar indexB = fragments.indexOf(fragmentB);\n\n  \t\treturn indexA - indexB || ancestryA.length - ancestryB.length;\n  \t}\n\n  \tthrow new Error('An unexpected condition was met while comparing the position of two components. Please file an issue at https://github.com/ractivejs/ractive/issues - thanks!');\n  }\n\n  function getParent(item) {\n  \tvar parentFragment = item.parentFragment;\n\n  \tif (parentFragment) return parentFragment.owner;\n\n  \tif (item.component && (parentFragment = item.component.parentFragment)) {\n  \t\treturn parentFragment.owner;\n  \t}\n  }\n\n  function getAncestry(item) {\n  \tvar ancestry = [item];\n  \tvar ancestor = getParent(item);\n\n  \twhile (ancestor) {\n  \t\tancestry.push(ancestor);\n  \t\tancestor = getParent(ancestor);\n  \t}\n\n  \treturn ancestry;\n  }\n\n  var Query = (function () {\n  \tfunction Query(ractive, selector, live, isComponentQuery) {\n  \t\tclassCallCheck(this, Query);\n\n  \t\tthis.ractive = ractive;\n  \t\tthis.selector = selector;\n  \t\tthis.live = live;\n  \t\tthis.isComponentQuery = isComponentQuery;\n\n  \t\tthis.result = [];\n\n  \t\tthis.dirty = true;\n  \t}\n\n  \tQuery.prototype.add = function add(item) {\n  \t\tthis.result.push(item);\n  \t\tthis.makeDirty();\n  \t};\n\n  \tQuery.prototype.cancel = function cancel() {\n  \t\tvar liveQueries = this._root[this.isComponentQuery ? 'liveComponentQueries' : 'liveQueries'];\n  \t\tvar selector = this.selector;\n\n  \t\tvar index = liveQueries.indexOf(selector);\n\n  \t\tif (index !== -1) {\n  \t\t\tliveQueries.splice(index, 1);\n  \t\t\tliveQueries[selector] = null;\n  \t\t}\n  \t};\n\n  \tQuery.prototype.init = function init() {\n  \t\tthis.dirty = false;\n  \t};\n\n  \tQuery.prototype.makeDirty = function makeDirty() {\n  \t\tvar _this = this;\n\n  \t\tif (!this.dirty) {\n  \t\t\tthis.dirty = true;\n\n  \t\t\t// Once the DOM has been updated, ensure the query\n  \t\t\t// is correctly ordered\n  \t\t\trunloop.scheduleTask(function () {\n  \t\t\t\treturn _this.update();\n  \t\t\t});\n  \t\t}\n  \t};\n\n  \tQuery.prototype.remove = function remove(nodeOrComponent) {\n  \t\tvar index = this.result.indexOf(this.isComponentQuery ? nodeOrComponent.instance : nodeOrComponent);\n  \t\tif (index !== -1) this.result.splice(index, 1);\n  \t};\n\n  \tQuery.prototype.update = function update() {\n  \t\tthis.result.sort(this.isComponentQuery ? sortByItemPosition : sortByDocumentPosition);\n  \t\tthis.dirty = false;\n  \t};\n\n  \tQuery.prototype.test = function test(item) {\n  \t\treturn this.isComponentQuery ? !this.selector || item.name === this.selector : item ? matches(item, this.selector) : null;\n  \t};\n\n  \treturn Query;\n  })();\n\n  function Ractive$findAllComponents(selector, options) {\n  \toptions = options || {};\n  \tvar liveQueries = this._liveComponentQueries;\n\n  \t// Shortcut: if we're maintaining a live query with this\n  \t// selector, we don't need to traverse the parallel DOM\n  \tvar query = liveQueries[selector];\n  \tif (query) {\n  \t\t// Either return the exact same query, or (if not live) a snapshot\n  \t\treturn options && options.live ? query : query.slice();\n  \t}\n\n  \tquery = new Query(this, selector, !!options.live, true);\n\n  \t// Add this to the list of live queries Ractive needs to maintain,\n  \t// if applicable\n  \tif (query.live) {\n  \t\tliveQueries.push(selector);\n  \t\tliveQueries['_' + selector] = query;\n  \t}\n\n  \tthis.fragment.findAllComponents(selector, query);\n\n  \tquery.init();\n  \treturn query.result;\n  }\n\n  function Ractive$findAll(selector, options) {\n  \tif (!this.el) throw new Error('Cannot call ractive.findAll(\\'' + selector + '\\', ...) unless instance is rendered to the DOM');\n\n  \toptions = options || {};\n  \tvar liveQueries = this._liveQueries;\n\n  \t// Shortcut: if we're maintaining a live query with this\n  \t// selector, we don't need to traverse the parallel DOM\n  \tvar query = liveQueries[selector];\n  \tif (query) {\n  \t\t// Either return the exact same query, or (if not live) a snapshot\n  \t\treturn options && options.live ? query : query.slice();\n  \t}\n\n  \tquery = new Query(this, selector, !!options.live, false);\n\n  \t// Add this to the list of live queries Ractive needs to maintain,\n  \t// if applicable\n  \tif (query.live) {\n  \t\tliveQueries.push(selector);\n  \t\tliveQueries['_' + selector] = query;\n  \t}\n\n  \tthis.fragment.findAll(selector, query);\n\n  \tquery.init();\n  \treturn query.result;\n  }\n\n  function Ractive$find(selector) {\n  \tif (!this.el) throw new Error(\"Cannot call ractive.find('\" + selector + \"') unless instance is rendered to the DOM\");\n\n  \treturn this.fragment.find(selector);\n  }\n\n  var detachHook = new Hook('detach');\n  function Ractive$detach() {\n  \tif (this.isDetached) {\n  \t\treturn this.el;\n  \t}\n\n  \tif (this.el) {\n  \t\tremoveFromArray(this.el.__ractive_instances__, this);\n  \t}\n\n  \tthis.el = this.fragment.detach();\n  \tthis.isDetached = true;\n\n  \tdetachHook.fire(this);\n  \treturn this.el;\n  }\n\n  // These are a subset of the easing equations found at\n  // https://raw.github.com/danro/easing-js - license info\n  // follows:\n\n  // --------------------------------------------------\n  // easing.js v0.5.4\n  // Generic set of easing functions with AMD support\n  // https://github.com/danro/easing-js\n  // This code may be freely distributed under the MIT license\n  // http://danro.mit-license.org/\n  // --------------------------------------------------\n  // All functions adapted from Thomas Fuchs & Jeremy Kahn\n  // Easing Equations (c) 2003 Robert Penner, BSD license\n  // https://raw.github.com/danro/easing-js/master/LICENSE\n  // --------------------------------------------------\n\n  // In that library, the functions named easeIn, easeOut, and\n  // easeInOut below are named easeInCubic, easeOutCubic, and\n  // (you guessed it) easeInOutCubic.\n  //\n  // You can add additional easing functions to this list, and they\n  // will be globally available.\n\n  var easing = {\n  \tlinear: function (pos) {\n  \t\treturn pos;\n  \t},\n  \teaseIn: function (pos) {\n  \t\treturn Math.pow(pos, 3);\n  \t},\n  \teaseOut: function (pos) {\n  \t\treturn Math.pow(pos - 1, 3) + 1;\n  \t},\n  \teaseInOut: function (pos) {\n  \t\tif ((pos /= 0.5) < 1) {\n  \t\t\treturn 0.5 * Math.pow(pos, 3);\n  \t\t}\n  \t\treturn 0.5 * (Math.pow(pos - 2, 3) + 2);\n  \t}\n  };\n\n  var noAnimation = Promise$1.resolve();\n  defineProperty(noAnimation, 'stop', { value: noop });\n\n  var linear = easing.linear;\n\n  function getOptions(options, instance) {\n  \toptions = options || {};\n\n  \tvar easing = undefined;\n  \tif (options.easing) {\n  \t\teasing = typeof options.easing === 'function' ? options.easing : instance.easing[options.easing];\n  \t}\n\n  \treturn {\n  \t\teasing: easing || linear,\n  \t\tduration: 'duration' in options ? options.duration : 400,\n  \t\tcomplete: options.complete || noop,\n  \t\tstep: options.step || noop\n  \t};\n  }\n  function Ractive$animate(keypath, to, options) {\n  \tif (typeof keypath === 'object') {\n  \t\tvar keys = Object.keys(keypath);\n\n  \t\tthrow new Error('ractive.animate(...) no longer supports objects. Instead of ractive.animate({\\n  ' + keys.map(function (key) {\n  \t\t\treturn '\\'' + key + '\\': ' + keypath[key];\n  \t\t}).join('\\n  ') + '\\n}, {...}), do\\n\\n' + keys.map(function (key) {\n  \t\t\treturn 'ractive.animate(\\'' + key + '\\', ' + keypath[key] + ', {...});';\n  \t\t}).join('\\n') + '\\n');\n  \t}\n\n  \toptions = getOptions(options, this);\n\n  \tvar model = this.viewmodel.joinAll(splitKeypath(keypath));\n  \tvar from = model.get();\n\n  \t// don't bother animating values that stay the same\n  \tif (isEqual(from, to)) {\n  \t\toptions.complete(options.to);\n  \t\treturn noAnimation; // TODO should this have .then and .catch methods?\n  \t}\n\n  \tvar interpolator = interpolate(from, to, this, options.interpolator);\n\n  \t// if we can't interpolate the value, set it immediately\n  \tif (!interpolator) {\n  \t\trunloop.start();\n  \t\tmodel.set(to);\n  \t\trunloop.end();\n\n  \t\treturn noAnimation;\n  \t}\n\n  \treturn model.animate(from, to, options, interpolator);\n  }\n\n  function Ractive$add(keypath, d) {\n  \treturn add(this, keypath, d === undefined ? 1 : +d);\n  }\n\n  var proto$1 = {\n  \tadd: Ractive$add,\n  \tanimate: Ractive$animate,\n  \tdetach: Ractive$detach,\n  \tfind: Ractive$find,\n  \tfindAll: Ractive$findAll,\n  \tfindAllComponents: Ractive$findAllComponents,\n  \tfindComponent: Ractive$findComponent,\n  \tfindContainer: Ractive$findContainer,\n  \tfindParent: Ractive$findParent,\n  \tfire: Ractive$fire,\n  \tget: Ractive$get,\n  \tinsert: Ractive$insert,\n  \tlink: link,\n  \tmerge: Ractive$merge,\n  \tobserve: observe,\n  \tobserveList: observeList,\n  \tobserveOnce: observeOnce,\n  \t// TODO reinstate these\n  \t// observeListOnce,\n  \toff: Ractive$off,\n  \ton: Ractive$on,\n  \tonce: Ractive$once,\n  \tpop: pop,\n  \tpush: push,\n  \trender: Ractive$render,\n  \treset: Ractive$reset,\n  \tresetPartial: resetPartial,\n  \tresetTemplate: Ractive$resetTemplate,\n  \treverse: reverse,\n  \tset: Ractive$set,\n  \tshift: shift,\n  \tsort: sort,\n  \tsplice: splice,\n  \tsubtract: Ractive$subtract,\n  \tteardown: Ractive$teardown,\n  \ttoggle: Ractive$toggle,\n  \ttoCSS: Ractive$toCSS,\n  \ttoCss: Ractive$toCSS,\n  \ttoHTML: Ractive$toHTML,\n  \ttoHtml: Ractive$toHTML,\n  \tunlink: unlink,\n  \tunrender: Ractive$unrender,\n  \tunshift: unshift,\n  \tupdate: Ractive$update,\n  \tupdateModel: Ractive$updateModel\n  };\n\n  function joinKeys() {\n  \tfor (var _len = arguments.length, keys = Array(_len), _key = 0; _key < _len; _key++) {\n  \t\tkeys[_key] = arguments[_key];\n  \t}\n\n  \treturn keys.map(escapeKey).join('.');\n  }\n\n  function splitKeypath$1(keypath) {\n  \treturn splitKeypath(keypath).map(unescapeKey);\n  }\n\n  function getNodeInfo (node) {\n  \tif (!node || !node._ractive) return {};\n\n  \tvar storage = node._ractive;\n  \tvar ractive = storage.fragment.ractive;\n\n  \tvar _gatherRefs = gatherRefs(storage.fragment);\n\n  \tvar key = _gatherRefs.key;\n  \tvar index = _gatherRefs.index;\n\n  \tvar context = storage.fragment.findContext();\n\n  \treturn {\n  \t\tractive: ractive,\n  \t\tkeypath: context.getKeypath(ractive),\n  \t\trootpath: context.getKeypath(),\n  \t\tindex: index,\n  \t\tkey: key\n  \t};\n  }\n\n  function wrap$1 (method, superMethod, force) {\n\n  \tif (force || needsSuper$1(method, superMethod)) {\n\n  \t\treturn function () {\n\n  \t\t\tvar hasSuper = ('_super' in this),\n  \t\t\t    _super = this._super,\n  \t\t\t    result;\n\n  \t\t\tthis._super = superMethod;\n\n  \t\t\tresult = method.apply(this, arguments);\n\n  \t\t\tif (hasSuper) {\n  \t\t\t\tthis._super = _super;\n  \t\t\t}\n\n  \t\t\treturn result;\n  \t\t};\n  \t} else {\n  \t\treturn method;\n  \t}\n  }\n\n  function needsSuper$1(method, superMethod) {\n  \treturn typeof superMethod === 'function' && /_super/.test(method);\n  }\n\n  function unwrap(Child) {\n  \tvar options = {};\n\n  \twhile (Child) {\n  \t\taddRegistries(Child, options);\n  \t\taddOtherOptions(Child, options);\n\n  \t\tif (Child._Parent !== Ractive) {\n  \t\t\tChild = Child._Parent;\n  \t\t} else {\n  \t\t\tChild = false;\n  \t\t}\n  \t}\n\n  \treturn options;\n  }\n\n  function addRegistries(Child, options) {\n  \tregistries.forEach(function (r) {\n  \t\taddRegistry(r.useDefaults ? Child.prototype : Child, options, r.name);\n  \t});\n  }\n\n  function addRegistry(target, options, name) {\n  \tvar registry,\n  \t    keys = Object.keys(target[name]);\n\n  \tif (!keys.length) {\n  \t\treturn;\n  \t}\n\n  \tif (!(registry = options[name])) {\n  \t\tregistry = options[name] = {};\n  \t}\n\n  \tkeys.filter(function (key) {\n  \t\treturn !(key in registry);\n  \t}).forEach(function (key) {\n  \t\treturn registry[key] = target[name][key];\n  \t});\n  }\n\n  function addOtherOptions(Child, options) {\n  \tObject.keys(Child.prototype).forEach(function (key) {\n  \t\tif (key === 'computed') {\n  \t\t\treturn;\n  \t\t}\n\n  \t\tvar value = Child.prototype[key];\n\n  \t\tif (!(key in options)) {\n  \t\t\toptions[key] = value._method ? value._method : value;\n  \t\t}\n\n  \t\t// is it a wrapped function?\n  \t\telse if (typeof options[key] === 'function' && typeof value === 'function' && options[key]._method) {\n\n  \t\t\t\tvar result = undefined,\n  \t\t\t\t    needsSuper = value._method;\n\n  \t\t\t\tif (needsSuper) {\n  \t\t\t\t\tvalue = value._method;\n  \t\t\t\t}\n\n  \t\t\t\t// rewrap bound directly to parent fn\n  \t\t\t\tresult = wrap$1(options[key]._method, value);\n\n  \t\t\t\tif (needsSuper) {\n  \t\t\t\t\tresult._method = result;\n  \t\t\t\t}\n\n  \t\t\t\toptions[key] = result;\n  \t\t\t}\n  \t});\n  }\n\n  function extend$1() {\n  \tfor (var _len = arguments.length, options = Array(_len), _key = 0; _key < _len; _key++) {\n  \t\toptions[_key] = arguments[_key];\n  \t}\n\n  \tif (!options.length) {\n  \t\treturn extendOne(this);\n  \t} else {\n  \t\treturn options.reduce(extendOne, this);\n  \t}\n  }\n\n  function extendOne(Parent) {\n  \tvar options = arguments.length <= 1 || arguments[1] === undefined ? {} : arguments[1];\n\n  \tvar Child, proto;\n\n  \t// if we're extending with another Ractive instance...\n  \t//\n  \t//   var Human = Ractive.extend(...), Spider = Ractive.extend(...);\n  \t//   var Spiderman = Human.extend( Spider );\n  \t//\n  \t// ...inherit prototype methods and default options as well\n  \tif (options.prototype instanceof Ractive) {\n  \t\toptions = unwrap(options);\n  \t}\n\n  \tChild = function (options) {\n  \t\tif (!(this instanceof Child)) return new Child(options);\n\n  \t\tconstruct(this, options || {});\n  \t\tinitialise(this, options || {}, {});\n  \t};\n\n  \tproto = create(Parent.prototype);\n  \tproto.constructor = Child;\n\n  \t// Static properties\n  \tdefineProperties(Child, {\n  \t\t// alias prototype as defaults\n  \t\tdefaults: { value: proto },\n\n  \t\t// extendable\n  \t\textend: { value: extend$1, writable: true, configurable: true },\n\n  \t\t// Parent - for IE8, can't use Object.getPrototypeOf\n  \t\t_Parent: { value: Parent }\n  \t});\n\n  \t// extend configuration\n  \tconfig.extend(Parent, proto, options);\n\n  \tdataConfigurator.extend(Parent, proto, options);\n\n  \tif (options.computed) {\n  \t\tproto.computed = extend(create(Parent.prototype.computed), options.computed);\n  \t}\n\n  \tChild.prototype = proto;\n\n  \treturn Child;\n  }\n\n  // Ractive.js makes liberal use of things like Array.prototype.indexOf. In\n  // older browsers, these are made available via a shim - here, we do a quick\n  // pre-flight check to make sure that either a) we're not in a shit browser,\n  // or b) we're using a Ractive-legacy.js build\n  var FUNCTION = 'function';\n\n  if (typeof Date.now !== FUNCTION || typeof String.prototype.trim !== FUNCTION || typeof Object.keys !== FUNCTION || typeof Array.prototype.indexOf !== FUNCTION || typeof Array.prototype.forEach !== FUNCTION || typeof Array.prototype.map !== FUNCTION || typeof Array.prototype.filter !== FUNCTION || win && typeof win.addEventListener !== FUNCTION) {\n  \tthrow new Error('It looks like you\\'re attempting to use Ractive.js in an older browser. You\\'ll need to use one of the \\'legacy builds\\' in order to continue - see http://docs.ractivejs.org/latest/legacy-builds for more information.');\n  }\n  function Ractive(options) {\n  \tif (!(this instanceof Ractive)) return new Ractive(options);\n\n  \tconstruct(this, options || {});\n  \tinitialise(this, options || {}, {});\n  }\n\n  extend(Ractive.prototype, proto$1, defaults);\n  Ractive.prototype.constructor = Ractive;\n\n  // alias prototype as `defaults`\n  Ractive.defaults = Ractive.prototype;\n\n  // static properties\n  defineProperties(Ractive, {\n\n  \t// debug flag\n  \tDEBUG: { writable: true, value: true },\n  \tDEBUG_PROMISES: { writable: true, value: true },\n\n  \t// static methods:\n  \textend: { value: extend$1 },\n  \tescapeKey: { value: escapeKey },\n  \tgetNodeInfo: { value: getNodeInfo },\n  \tjoinKeys: { value: joinKeys },\n  \tparse: { value: parse },\n  \tsplitKeypath: { value: splitKeypath$1 },\n  \tunescapeKey: { value: unescapeKey },\n  \tgetCSS: { value: getCSS },\n\n  \t// namespaced constructors\n  \tPromise: { value: Promise$1 },\n\n  \t// support\n  \tenhance: { writable: true, value: false },\n  \tsvg: { value: svg },\n  \tmagic: { value: magicSupported },\n\n  \t// version\n  \tVERSION: { value: '0.8.0-edge' },\n\n  \t// plugins\n  \tadaptors: { writable: true, value: {} },\n  \tcomponents: { writable: true, value: {} },\n  \tdecorators: { writable: true, value: {} },\n  \teasing: { writable: true, value: easing },\n  \tevents: { writable: true, value: {} },\n  \tinterpolators: { writable: true, value: interpolators$1 },\n  \tpartials: { writable: true, value: {} },\n  \ttransitions: { writable: true, value: {} }\n  });\n\n  return Ractive;\n\n}));"],"names":["Form","prototype","unrender","shouldDestroy","this","node","removeEventListener","handleReset","_Element","call","Element","mutatorMethods","patchedArrayProto","forEach","methodName","method","_len","arguments","length","args","Array","_key","newIndices","getNewIndices","result","apply","runloop","start","_ractive","setting","i","wrappers","processWrapper","end","defineProperty","value","patchArrayMethods","undefined","unpatchArrayMethods","__proto__","array","configurable","unpatch","patch","errorMessage","arrayAdaptor","filter","object","isArray","wrap","ractive","keypath","ArrayWrapper","classCallCheck","root","__model","instances","_guid","push","get","teardown","storage","index","indexOf","Error","splice","magicAdaptor","Object","MagicWrapper","err","Parser","ParseError","magicAdaptor$1","_this","originalDescriptors","keys","key","originalDescriptor","getOwnPropertyDescriptor","childKeypath","escapeKey","descriptor","createOrWrapDescriptor","reset","set","_this2","__magic","revert","dependants","MagicArrayWrapper","magic","magicWrapper","arrayWrapper","model","magicArrayAdaptor","dataConfigurator","name","extend","Parent","proto","options","data","isObject","warnIfDebug","combine$1","init","constructor","prop","bind","viewmodel","Computation","_Model","signature","parent","isExpression","isReadonly","setter","context","computationContext","dependencies","children","childByKey","deps","boundsSensitive","dirty","shuffle","inherits","shouldCapture","capture","getValue","adapt","startCapturing","getter","getKeypath","message","console","groupCollapsed","functionBody","prettify","getterString","stack","getterUseStack","truncateStack","error","groupEnd","stopCapturing","setDependencies","handleChange","_handleChange","clearUnresolveds","joinKey","hasOwnProperty","child","ComputationChild","mark","unregister","register","Model","RactiveModel","isRoot","adaptors","changes","hasProp","RootModel","mappings","computations","applyChanges","_changeHash","flush","compute","computation","extendChildren","fn","getRactiveModel","ractiveModel","getValueChildren","has","unescapeKey","Function","GlobalModel$1","map","localKey","origin","wrapper","shouldTeardown","_mark","retrieve","update","updateFromBindings","cascade","constructHook","Hook","registryNames","uid","HookQueue","event","hook","inProcess","queue","begin","getChildQueue","fire","selectorsPattern","commentsPattern","selectorUnitPattern","excludePattern","dataRvcGuidPattern","cssConfigurator","css","id","uuid","styles","noCssTransform","transformCss","cssId","addCSS","target","adaptConfigurator","combine$2","ensureArray","registryNames$1","Registry","useDefaults","configure","defaults","option","registry","create","changed","item","_fn","isOwner","registries","custom","template","templateConfigurator","defaultKeys","isStandardKey","makeObj","isBlacklisted","concat","r","order","config","c","configHook","initHook","renderHook$1","completeHook$1","leadingWhitespace","e","str","items","lineStart","pos","lines","split","lineEnds","line","lineEnd","read","leftover","remaining","postProcess","converters","len","getLinePos","char","columnNum","lineNum","numTabs","annotation","replace","match","join","character","shortMessage","matchString","string","substr","matchPattern","pattern","exec","allowWhitespace","substring","nextChar","charAt","Child","hasOwn","stringMiddlePattern","escapeSequencePattern","lineContinuationPattern","Parser$1","getSingleQuotedString","makeQuotedStringMatcher","getDoubleQuotedString","numberPattern$1","identifier","specials","true","false","null","specialsPattern","RegExp","numberPattern","placeholderPattern","placeholderAtStartPattern","onlyWhitespace","JsonParser","values","test","v","parser","placeholder","special","number","stringLiteral","readStringLiteral","$1","pair","getKeyValuePair","valueToken","RactiveEvent","handler","listen","directive","on","shift","component","slice","unlisten","cancel","teardownHook$1","Component","_Item","ComponentConstructor","type","COMPONENT","instance","parentFragment","complexMappings","liveQueries","el","partials","p","content","f","_partials","yielders","fragment","container","owner","YIELDER","construct","_inlinePartials","eventHandlers","setupEvents","childData","a","parsed","parseJSON","t","INTERPOLATOR","resolve$1","warnOnceIfDebug","findContext","Fragment","valueOf","bubble","initialise","cssIds","_bind","checkYielders","detach","find","selector","findAll","query","findComponent","findAllComponents","add","live","firstNode","skipParent","rebind","_this3","_rebind","makeDirty","render","occupants","_render","updateLiveQueries","rendered","_this4","handlers","eventNames","eventName","EventDirective","toString","toHTML","unbind","_unbind","_observers","removeFromLiveComponentQueries","__ractive_instances__","removeFromArray","_links","k","unlink","_this5","_unrender","remove","_update","Item","Text","TEXT","detachNode","n","nodeType","nodeValue","doc","createTextNode","insertBefore","appendChild","escape","escapeHtml","constructors","ALIAS","Alias","DOCTYPE","Doctype","Interpolator","PARTIAL","Partial","SECTION","Section","TRIPLE","Triple","Yielder","specialElements","doctype","form","input","Input","Option","select","Select","textarea","Textarea","ReferenceResolver","reference","callback","normalise","splitKeypath","resolved","addUnresolved","componentParent","attemptResolution","resolveAmbiguousReference","forceResolution","joinAll","unresolved","resolvers","dirtyArgs","dirtyValue","createItems","bound","addFragment","createItem","docFrag","createDocumentFragment","found","findNextNode","findParentNode","ELEMENT","containerFragment","findRepeatingFragment","isIteration","getArgsList","source","processItems","argsList","resetTemplate","wasBound","wasRendered","parentNode","anchor","resolve","resolver","toHtml","toEscapedString","_toString","unrenderAndDestroy","updating","shouldRerender","completeHook","resetHook","renderHook","unrenderHook","makeArrayMethod","pop","onceOptions","once","ListObserver","pending","sliced","negativeOne","newValue","inserted","deleted","hadIndex","newIndex","oldIndex","Observer","oldValue","defer","strict","dispatch","addObserver","PatternObserver","baseModel","baseKeypath","oldValues","newValues","models","findMatches","newKeys","isEqual","wildcards","base","max","suffix","touchedFrom","comparators","Link","dest","LinkSide","locked","initialValue","sync","side","insertHook","Query","isComponentQuery","_root","scheduleTask","nodeOrComponent","sort","sortByItemPosition","sortByDocumentPosition","matches","detachHook","easing","linear","easeIn","Math","pow","easeOut","easeInOut","noAnimation","Promise$1","noop","proto$1","Ractive$add","animate","Ractive$animate","Ractive$detach","Ractive$find","Ractive$findAll","Ractive$findAllComponents","Ractive$findComponent","findContainer","Ractive$findContainer","findParent","Ractive$findParent","Ractive$fire","Ractive$get","insert","Ractive$insert","link","merge","Ractive$merge","observe","observeList","observeOnce","off","Ractive$off","Ractive$on","Ractive$once","Ractive$render","Ractive$reset","resetPartial","Ractive$resetTemplate","reverse","Ractive$set","subtract","Ractive$subtract","Ractive$teardown","toggle","Ractive$toggle","toCSS","Ractive$toCSS","toCss","Ractive$toHTML","Ractive$unrender","unshift","Ractive$update","updateModel","Ractive$updateModel","FUNCTION","Date","now","String","trim","win","addEventListener","Ractive","defineProperties","DEBUG","writable","DEBUG_PROMISES","extend$1","getNodeInfo","joinKeys","parse","splitKeypath$1","getCSS","Promise","enhance","svg","magicSupported","VERSION","components","decorators","events","interpolators","interpolators$1","transitions","attributes","ConditionalAttribute","isSvg","namespaceURI","svg$1","attrs","parseAttributes","notIn","removeAttribute","setAttribute","missingDecorator","Decorator","dynamicName","dynamicArgs","d","nameFragment","argsFragment","intermediary","findInViewHierarchy","warnOnce","missingPlugin","nameChanged","_name","starMaps","wildcardCache","eventPattern","argumentsPattern","dollarArgsPattern","passthru","argsFn","action","m","g","ref","argMatch","argument","dollarMatch","resolveReference","getFunction","s","passedArgs","refs","gatherRefs","rootpath","obj","oldEvent","original","preventDefault","stopPropagation","fireEvent","DOMEvent","fatal","CustomEvent","eventPlugin","prefix","isClient","prefixCache","testStyle","createElement","style","camelCase","capped","toUpperCase","vendors","vendor","prefix$1","visible","hidden","prefix$2","i$2","onChange","onHide","onShow","from","to","delta","isNumeric","intermediate","min","interpolate","properties","snap","unprefixPattern","vendorPattern","createTransitions","x","canUseCssTransitions","cannotUseCssTransitions","TRANSITION","TRANSITIONEND","CSS_TRANSITIONS_ENABLED","TRANSITION_DURATION","TRANSITION_PROPERTY","TRANSITION_TIMING_FUNCTION","transition","webkitTransition","changedProperties","setTimeout","checkComplete","jsTransitionsComplete","cssTransitionsComplete","isIntro","transitionEndHandler","unprefix","propertyName","hashPrefix","tagName","hyphenate","duration","hash","originalValue","propertiesToTransitionInJs","interpolator","getStyle","parseFloat","Ticker","step","_prop","complete","delay","createTransitions$1","getComputedStyle","legacy","Transition","params","animateStyle","setStyle","fulfil","propertyNames","computedStyle","current","props","processParams","originalStyle","getAttribute","completed","noReset","resetStyle","_manager","Binding","element","attribute","attributeByName","twowayBinding","isUnresolved","warnAboutAmbiguity","isTwoway","wasUndefined","getInitialValue","parentForm","findParentForm","resetValue","formBindings","registerTwowayBinding","binding","setFromNode","unregisterTwowayBinding","CheckboxBinding","_Binding","handleDomEvent","attachEvent","checked","BindingGroup","bindings","push$1","CheckboxNameBinding","checkboxName","group","getBindingGroup","getValue$1","noInitialValue","existingValue","bindingValue","arrayContains","wasChecked","isChecked","valueSoFar","ContentEditableBinding","innerHTML","lazy","GenericBinding","timeout","handleDelay","handleBlur","MultipleSelectBinding","forceUpdate","selectedValues","selected","optionValue","previousValue","arrayContentsMatch","selectedOptions","setValue","NumericBinding","_GenericBinding","isNaN","siblings","RadioBinding","getSiblings","RadioNameBinding","getValue$2","nameAttributeBinding","getKeypathModel","SingleSelectBinding","optionWasSelected","disabled","toLowerCase","isVoid","voidElementNames","Attribute","conditionalAttributes","o","decorator","noContent","createTwowayBinding","shouldBind","twoway","selectBinding","makeDirty$1","namespace","getNamespace","existing","nodeName","proxy","foundNode","toArray","childNodes","updateLiveQueries$1","transitionTemplate","t0","t1","transitionsEnabled","registerTransition","_introTransition","stringifyAttribute","isSelected","inputIsCheckedRadio","detachWhenReady","t2","_transition","nodes","removeFromLiveQueries","defaultValue","_Input","isBindable","defaultSelected","selectNode","selectValue","isMultiple","shouldSelect","valueContains","findParentSelect","selectedAttribute","fragmentIndex","KeyModel","indexModels","getKeyModel","keypathModel","KeypathModel","mapped","keypathModels","addChild","originatingModel","hasProp$1","comparator","oldArray","newArray","oldLength","usedIndices","firstUnusedIndex","_merged","dep","ticker","stop","applyValue","updateKeypathDependants","_teardown","dependant","_updateFromBindings","_updateKeypathDependants","GlobalModel","global","window","parentValue","ExpressionProxy","ReferenceExpressionChild","ReferenceExpressionProxy","_Model2","baseResolver","members","REFERENCE","resolveAliases","aliases","Mustache","isStatic","booleanAttributes","htmlEntities","quot","amp","apos","lt","gt","nbsp","iexcl","cent","pound","curren","yen","brvbar","sect","uml","copy","ordf","laquo","not","shy","reg","macr","deg","plusmn","sup2","sup3","acute","micro","para","middot","cedil","sup1","ordm","raquo","frac14","frac12","frac34","iquest","Agrave","Aacute","Acirc","Atilde","Auml","Aring","AElig","Ccedil","Egrave","Eacute","Ecirc","Euml","Igrave","Iacute","Icirc","Iuml","ETH","Ntilde","Ograve","Oacute","Ocirc","Otilde","Ouml","times","Oslash","Ugrave","Uacute","Ucirc","Uuml","Yacute","THORN","szlig","agrave","aacute","acirc","atilde","auml","aring","aelig","ccedil","egrave","eacute","ecirc","euml","igrave","iacute","icirc","iuml","eth","ntilde","ograve","oacute","ocirc","otilde","ouml","divide","oslash","ugrave","uacute","ucirc","uuml","yacute","thorn","yuml","OElig","oelig","Scaron","scaron","Yuml","fnof","circ","tilde","Alpha","Beta","Gamma","Delta","Epsilon","Zeta","Eta","Theta","Iota","Kappa","Lambda","Mu","Nu","Xi","Omicron","Pi","Rho","Sigma","Tau","Upsilon","Phi","Chi","Psi","Omega","alpha","beta","gamma","epsilon","zeta","eta","theta","iota","kappa","lambda","mu","nu","xi","omicron","pi","rho","sigmaf","sigma","tau","upsilon","phi","chi","psi","omega","thetasym","upsih","piv","ensp","emsp","thinsp","zwnj","zwj","lrm","rlm","ndash","mdash","lsquo","rsquo","sbquo","ldquo","rdquo","bdquo","dagger","Dagger","bull","hellip","permil","prime","Prime","lsaquo","rsaquo","oline","frasl","euro","image","weierp","real","trade","alefsym","larr","uarr","rarr","darr","harr","crarr","lArr","uArr","rArr","dArr","hArr","forall","part","exist","empty","nabla","isin","notin","ni","prod","sum","minus","lowast","radic","infin","ang","and","or","cap","cup","int","there4","sim","cong","asymp","ne","equiv","le","ge","sub","sup","nsub","sube","supe","oplus","otimes","perp","sdot","lceil","rceil","lfloor","rfloor","lang","rang","loz","spades","clubs","hearts","diams","controlCharacters","entityPattern","codePointSupport","fromCodePoint","codeToChar","fromCharCode","lessThan","greaterThan","invalid","_Mustache","getString","safeToStringValue","refName","getPartialTemplate","templateObj","named","setTemplate","parsePartial","partialTemplate","forceResetTemplate","RepeatedFragment","iterations","indexRef","keyRef","indexByKey","pendingNewIndices","previousIterations","createIteration","z","iteration","unrenderAndDestroy$1","updatePostShuffle","wasArray","toRemove","oldKeys","_fragment","newLength","indices","maxIdx","merged","frag","sectionType","templateSectionType","SECTION_UNLESS","SECTION_IF","SECTION_EACH","lastType","getType","newFragment","SECTION_WITH","SECTION_IF_WITH","isEmpty","fragmentShouldExist","elementCache","ieBug","ieBlacklist","TABLE","THEAD","TBODY","TR","SELECT","queryResult","querySelector","queryAllResult","querySelectorAll","numNodes","j","html","insertHtml","decodeCharacterReferences","textTypes","accept-charset","accesskey","bgcolor","class","codebase","colspan","contenteditable","datetime","dirname","for","http-equiv","ismap","maxlength","novalidate","pubdate","readonly","rowspan","tabindex","usemap","updateDelegate","namespaces","useProperty","isBoolean","lookupNamespace","getUpdateDelegate","div$1","collect","partial","collection","promise","rerender","getElement","append","others","removeChild","listener","notEmptyString","_ret","listeners","_subs","subscribers","observer","observers","createObserver","keypaths","wildcardIndex","_model","getComparator","JSON","stringify","thing","compare","there","here","run","ln","sourcePath","all","isDetached","fireInsertHook","isolated","otherNode","compareDocumentPosition","bitmask","b","ancestryA","getAncestry","ancestryB","oldestA","lastItem","oldestB","mutualAncestor","fragmentA","fragmentB","indexA","indexB","fragments","getParent","ancestry","ancestor","_liveComponentQueries","_liveQueries","getOptions","_gatherRefs","wrap$1","superMethod","force","needsSuper$1","hasSuper","_super","unwrap","addRegistries","addOtherOptions","_Parent","addRegistry","_method","needsSuper","reduce","extendOne","computed","subClass","superClass","TypeError","enumerable","setPrototypeOf","toConsumableArray","arr","arr2","Constructor","document","hasConsole","navigator","appName","warn","log","printWarning","welcome","implementation","hasFeature","delimiters","tripleDelimiters","staticDelimiters","staticTripleDelimiters","csp","preserveWhitespace","sanitize","stripComments","modifyArrays","noIntro","refPattern","splitPattern","escapeKeyPattern","unescapeKeyPattern","alreadyWarned","welcomeIntro","welcomeMessage","hasGroup","_Promise","deprecations","deprecated","replacement","deprecate","arg","PENDING","FULFILLED","REJECTED","dispatchHandlers","makeResolver","reject","fulfilledHandlers","rejectedHandlers","state","newState","makeDispatcher","wait","then","onFulfilled","onRejected","promise2","processResolutionHandler","forward","p1result","promises","processPromise","reason","TransitionManager","intros","outros","totalChildren","outroChildren","detachQueue","outrosComplete","list","decrementOutros","check","decrementTotal","detachNodes","_detachNodes","ready","changeHook","batch","returnPromise","fulfilPromise","previousBatch","transitionManager","tasks","immediateObservers","deferredObservers","flushChanges","addToArray","task","postRender","_batch","updateHook","arrayProto","unrenderHook$1","PREFIX","styleDefinitions","isDirty","styleElement","styleSheet","styleProperty","getElementsByTagName","div","methodNames","unprefixed","prefixed","i$1","j$1","makeFunction","badArguments","noRegistryFunctionReturn","teardownHook","errorMessage$1","TEMPLATE_VERSION","mathml","xlink","xml","xmlns","ns","createElementNS","cloneNode","exportedShims","hasDontEnumBug","propertyIsEnumerable","dontEnums","dontEnumsLength","needle","mapper","isActuallyString","opt_initialValue","valueIsSet","filtered","every","iterator","Empty","ctx","Event","head","origCreateElement","appearsToBeIELessEqual8","property","currentTarget","srcElement","timeStamp","returnValue","cancelBubble","detachEvent","firstChild","getPixelSize","fontSize","sizeWithSuffix","size","getBorderPixelSize","parentElement","currentStyle","rootSize","clientWidth","clientHeight","bcr","borderSizes","display","position","width","height","borderRight","getBoundingClientRect","right","left","setShortStyleProperty","borderSuffix","l","CSSStyleDeclaration","normalProps","fontWeight","lineHeight","letterSpacing","getPropertyPriority","getPropertyValue","removeProperty","setProperty","getPropertyCSSValue","desc","F","requestAnimationFrame","functions","parseOptions","TEMPLATE_INSTRUCTIONS","COMPUTATION_INSTRUCTIONS","fromId","noThrow","getElementById","textContent","isParsed","getParseOptions","val","throwNoParse","addFunctions","parseFor","parseTemplate","getDynamicTemplate","_config","extendPartials","NUMBER_LITERAL","STRING_LITERAL","captureGroup","lastTime","currTime","timeToCall","rAF","getTime","performance","tickers","running","tick","elapsed","eased","abort","prefixers","unresolvedByKey","adaptor","getPrefixer","createBranch","previousOriginatingModel","specificKey","hasKey","branch","existingMatches","_loop","getIndexModel","factory","exports","module","define","amd","format","logIfDebug","_len2","_key2","_len3","_key3","isFinite","member","arrayLike","called","resolvePromise","rejectPromise","y","tm","which","_parent","spliceArguments","removeStart","removeEnd","balance","getSpliceEquivalent","intialValue","styleDefinition","applyCSS","filteredStyleDefinitions","uniqueCssIds","ids","fromExpression","body","fromComputationString","bindTo","hasThis","output","sources","fillGaps","createFunction","exp","instructions","createFunctionFromString","initial","parseAsString","validate$1","existingPartials","newPartials","overwrite","badReference","localViewmodel","hasContextChain","crossedComponentBoundary","prefixKeypath","rootKeypath","rootDot","relativeKeypath","repeater","parts","rx","section","entity","code","parseInt","validateCode","registryName","findInstance","getPartialFromRegistry","findParentPartial","findOwner","findConstructor","hasIndexRef","selectedOption","selectedIndex","updateId","updateMultipleSelectValue","updateSelectValue","updateStringValue","updateContentEditableValue","updateRadioValue","updateValue","updateRadioName","updateCheckboxName","updateIEStyleAttribute","updateBoolean","updateNamespacedAttribute","updateAttribute","updateClassName","valueAttribute","className","setAttributeNS","qualified","hasAttribute","haystack","enqueue","_eventQueue","dequeue","getPotentialWildcardMatches","starMap","wildcardKeypath","getStarMap","star","num","binary","ones","digit","_noArg","getWildcardNames","fireEventAs","initialFire","notifySubscribers","fullName","originalEvent","stopEvent","hyphenatedStr","interpol","description","res","clearTimeout","bindName","bindChecked","typeAttribute","nameAttribute","_ref","validate","childValue","parentIsFn","childIsFn","callDataFunction","fromProperties","primary","secondary","fnBody","tabs","minIndent","prev","Infinity","truncated","getComputationSignature","setterString","initialiseProperties","deprecateRactiveData","getAdaptors","combine","protoAdapt","lookup","hookQueue","childQueue","trim$1","extractString","unit","transformSelector","selectorUnits","modifiers","transformed","appended","prepended","dataAttr","selectors","s4","floor","random","getSuperMethod","oldSuper","getMessage","correct","isError","deprecateOption","deprecatedOption","extendOtherMethods","userOptions","okQuote","literal","done","next","charCodeAt","readNumberLiteral","readKey","token","getComponentConstructor","ElementConstructor","guid","counter","placeholderId"],"mappings":"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"}